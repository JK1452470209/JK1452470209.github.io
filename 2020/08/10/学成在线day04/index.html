<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>å­¦æˆåœ¨çº¿day04ï¼šé¡µé¢é™æ€åŒ– - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ç§äººåšå®¢</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äºæˆ‘
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-10 11:09">
      2020-08-10
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      9.3k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      110
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p>
</blockquote>
<p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day04</code> çš„å†…å®¹</p>
<ul>
<li>é¡µé¢é™æ€åŒ–çš„åŸºæœ¬æ¦‚å¿µ</li>
<li><code>Freemarker</code> æ¡†æ¶åŸºç¡€å…¥é—¨</li>
<li>ä½¿ç”¨ <code>MongoDB</code> æä¾›çš„ <code>GridFS</code> æ¥å®ç°é¡µé¢æ•°æ®çš„åˆ†å¸ƒå¼å‚¨å­˜</li>
<li>ä½¿ç”¨ <code>freemarker</code> æ¡†æ¶å®ç°é¡µé¢é™æ€åŒ–ä»¥åŠå‘å¸ƒ</li>
</ul>
<h1 id="ä¸€ã€é¡µé¢é™æ€åŒ–éœ€æ±‚"><a href="#ä¸€ã€é¡µé¢é™æ€åŒ–éœ€æ±‚" class="headerlink" title="ä¸€ã€é¡µé¢é™æ€åŒ–éœ€æ±‚"></a>ä¸€ã€é¡µé¢é™æ€åŒ–éœ€æ±‚</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><ol>
<li><p><strong>ä¸ºä»€ä¹ˆè¦è¿›è¡Œé¡µé¢ç®¡ç†ï¼Ÿ</strong></p>
<p>æœ¬é¡¹ç›®çš„ <code>cms</code> ç³»ç»Ÿçš„åŠŸèƒ½å°±æ˜¯æ ¹æ®è¿è¥çš„éœ€è¦ï¼Œå¯¹é—¨æˆ·ç­‰å­ç³»ç»Ÿçš„éƒ¨åˆ†é¡µé¢è¿›è¡Œç®¡ç†ï¼Œä»è€Œå®ç°å¿«é€Ÿçš„æ ¹æ®ç”¨æˆ·éœ€æ±‚ä¿®æ”¹é¡µé¢çš„å†…å®¹å¹¶ä¸Šçº¿éœ€æ±‚ã€‚</p>
</li>
<li><p><strong>å¦‚ä½•ä¿®æ”¹é¡µé¢çš„å†…å®¹ï¼Ÿ</strong></p>
<p>åœ¨å¼€å‘ä¸­ä¿®æ”¹é¡µé¢çš„å†…å®¹æ˜¯éœ€è¦äººå·¥ç¼–å†™ <code>html</code> ä»¥åŠ <code>js</code> æ–‡ä»¶ï¼Œ <code>cms</code> ç³»ç»Ÿæ˜¯é€šè¿‡ç¨‹åºè‡ªåŠ¨åŒ–çš„å¯¹é¡µé¢çš„å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œé€šè¿‡é¡µé¢é™æ€åŒ–æŠ€æœ¯ç”Ÿæˆ <code>html</code> é¡µé¢ã€‚</p>
</li>
<li><p><strong>å¦‚ä½•å¯¹é¡µé¢è¿›è¡Œé™æ€åŒ–ï¼Ÿ</strong></p>
<p>ä¸€ä¸ªé¡µé¢ç­‰äº <code>æ¨¡æ¿</code> + <code>æ•°æ®</code>ï¼Œåœ¨æ·»åŠ é¡µé¢çš„æ—¶å€™æˆ‘ä»¬é€‰æ‹©äº†é¡µé¢çš„æ¨¡æ¿ã€‚</p>
</li>
<li><p><strong>é¡µé¢é™æ€åŒ–ä»¥åŠé¡µé¢å‘å¸ƒçš„æµç¨‹</strong></p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image1" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image1.png" srcset="/img/loading.gif" alt="å‘å¸ƒæµç¨‹å›¾"></a></p>
<p>â€‹</p>
<p>â€‹</p>
</li>
</ol>
<h2 id="ä¸šåŠ¡æµç¨‹"><a href="#ä¸šåŠ¡æµç¨‹" class="headerlink" title="ä¸šåŠ¡æµç¨‹"></a>ä¸šåŠ¡æµç¨‹</h2><p>ä¸šåŠ¡æµç¨‹å¦‚ä¸‹</p>
<ol>
<li>è·å–æ¨¡å‹æ•°æ®</li>
<li>åˆ¶ä½œæ¨¡æ¿</li>
<li>å¯¹é¡µé¢è¿›è¡Œé™æ€åŒ–</li>
<li>å°†é™æ€åŒ–ç”Ÿæˆçš„ <code>html</code> é¡µé¢å­˜æ”¾åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­</li>
<li>å°†å­˜æ”¾åœ¨æ–‡ä»¶ç³»ç»Ÿçš„ <code>html</code> é¡µé¢å‘å¸ƒåˆ°æœåŠ¡å™¨</li>
</ol>
<h1 id="äºŒã€FreeMarkerç ”ç©¶"><a href="#äºŒã€FreeMarkerç ”ç©¶" class="headerlink" title="äºŒã€FreeMarkerç ”ç©¶"></a>äºŒã€FreeMarkerç ”ç©¶</h1><h2 id="1-FreeMarkerä»‹ç»"><a href="#1-FreeMarkerä»‹ç»" class="headerlink" title="1. FreeMarkerä»‹ç»"></a>1. FreeMarkerä»‹ç»</h2><ol>
<li><p><code>freemarker</code> æ˜¯ä¸€ä¸ªç”¨ <code>Java</code> å¼€å‘çš„æ¨¡æ¿å¼•æ“</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image2" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image2.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å¸¸ç”¨çš„ <code>java</code> æ¨¡æ¿å¼•æ“è¿˜æœ‰å“ªäº›?</p>
<p>Jspã€Freemarkerã€Thymeleafã€Velocity ç­‰</p>
</li>
<li><p>æ¨¡æ¿+æ•°æ®æ¨¡å‹ = è¾“å‡º</p>
<p><code>freemarker</code> å¹¶ä¸å…³å¿ƒæ•°æ®çš„æ¥æºï¼Œåªæ˜¯æ ¹æ®æ¨¡æ¿çš„å†…å®¹ï¼Œå°†æ•°æ®æ¨¡å‹åœ¨æ¨¡æ¿ä¸­æ˜¾ç¤ºå¹¶è¾“å‡ºå…·ä½“çš„ï¼ˆé€šå¸¸ä¸º <code>html</code> ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ï¼‰</p>
<ol>
<li><p><strong>æ•°æ®æ¨¡å‹</strong></p>
<p>æ•°æ®æ¨¡å‹åœ¨ <code>java</code> ä¸­å¯ä»¥æ˜¯åŸºæœ¬ç±»å‹ä¹Ÿå¯ä»¥æ˜¯ Listã€Mapã€Pojo ç­‰å¤æ‚ç±»å‹</p>
</li>
<li><p><strong>æ¥è‡ªå®˜æ–¹çš„ä¾‹å­</strong>ï¼šï¼ˆ<a href="https://freemarker.apache.org/docs/dgui_quickstart_basics.html%EF%BC%89" target="_blank" rel="noopener">https://freemarker.apache.org/docs/dgui_quickstart_basics.htmlï¼‰</a></p>
<p>æ•°æ®æ¨¡å‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image3" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image3.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ¨¡æ¿ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image4" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image4.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>è¾“å‡ºï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image5" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image5.png" srcset="/img/loading.gif" alt="img"></a></p>
</li>
</ol>
</li>
</ol>
<h2 id="2-FreeMark-å¿«é€Ÿå…¥é—¨"><a href="#2-FreeMark-å¿«é€Ÿå…¥é—¨" class="headerlink" title="2. FreeMark å¿«é€Ÿå…¥é—¨"></a>2. FreeMark å¿«é€Ÿå…¥é—¨</h2><p>freemarker ä½œä¸º <code>Springmvc</code> ä¸€ç§è§†å›¾çš„æ ¼å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>SpringMvc</code> æ”¯æŒ <code>freemarker</code> è§†å›¾æ ¼å¼ã€‚</p>
<p>éœ€è¦åˆ›å»º <code>Spring boot</code> + <code>Freemarker</code>å·¥ç¨‹ç”¨äºæµ‹è¯•çš„æ¨¡æ¿ã€‚</p>
<h3 id="1ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹"><a href="#1ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹" class="headerlink" title="1ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹"></a>1ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹</h3><p>æˆ‘ä»¬åœ¨åŸæœ‰çš„å·¥ç¨‹ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª<code>test-freemarker</code> çš„ <code>maven</code> æ¨¡å—ï¼Œæµ‹è¯•å·¥ç¨‹ä¸“é—¨ç”¨äºfreemarkerçš„åŠŸèƒ½æµ‹è¯•ä¸æ¨¡æ¿çš„æµ‹è¯•ã€‚</p>
<p>pomå¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span>
<span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span>
<span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0</span></span>
<span class="hljs-tag"><span class="hljs-string">http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../xc-framework-parent/pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>test-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div>

<h3 id="2ã€é…ç½®æ–‡ä»¶"><a href="#2ã€é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€é…ç½®æ–‡ä»¶"></a>2ã€é…ç½®æ–‡ä»¶</h3><p>é…ç½® <code>application.yml</code> å’Œ <code>logback-spring.xml</code>ï¼Œä» <code>cms</code> å·¥ç¨‹æ‹·è´è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿›è¡Œæ›´æ”¹ï¼Œ <code>logback-spring.xml</code> æ— éœ€æ›´æ”¹ï¼Œ<code>application.yml</code> å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs yml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8088</span> <span class="hljs-comment">#æœåŠ¡ç«¯å£</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">testâ€freemarker</span> <span class="hljs-comment">#æŒ‡å®šæœåŠ¡å</span>
  <span class="hljs-attr">freemarker:</span>
    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#å…³é—­æ¨¡æ¿ç¼“å­˜ï¼Œæ–¹ä¾¿æµ‹è¯•</span>
    <span class="hljs-attr">settings:</span>
      <span class="hljs-attr">template_update_delay:</span> <span class="hljs-number">0</span> <span class="hljs-comment">#æ£€æŸ¥æ¨¡æ¿æ›´æ–°å»¶è¿Ÿæ—¶é—´ï¼Œè®¾ç½®ä¸º0è¡¨ç¤ºç«‹å³æ£€æŸ¥ï¼Œå¦‚æœæ—¶é—´å¤§äº0ä¼šæœ‰ç¼“å­˜ä¸æ–¹ä¾¿</span></code></pre></div>

<h3 id="3ã€åˆ›å»ºæ¨¡å‹ç±»"><a href="#3ã€åˆ›å»ºæ¨¡å‹ç±»" class="headerlink" title="3ã€åˆ›å»ºæ¨¡å‹ç±»"></a>3ã€åˆ›å»ºæ¨¡å‹ç±»</h3><p>åœ¨ <code>freemarker</code> çš„æµ‹è¯•å·¥ç¨‹ä¸‹åˆ›å»ºæ¨¡å‹ç±»å‹ç”¨äºæµ‹è¯•ï¼›</p>
<p>åˆ›å»º <code>com.xuecheng.test.freemarker.model</code> åŒ…ï¼Œå¹¶æ„å»ºä¸€ä¸ª <code>Student</code> æ¨¡å‹ç±»ç”¨äºåé¢çš„æµ‹è¯•</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.freemarker.model;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.ToString;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;
    <span class="hljs-keyword">private</span> String name;<span class="hljs-comment">//å§“å</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;<span class="hljs-comment">//å¹´é¾„</span>
    <span class="hljs-keyword">private</span> Date birthday;<span class="hljs-comment">//ç”Ÿæ—¥</span>
    <span class="hljs-keyword">private</span> Float money;<span class="hljs-comment">//é’±åŒ…</span>
    <span class="hljs-keyword">private</span> List&lt;Student&gt; friends;<span class="hljs-comment">//æœ‹å‹åˆ—è¡¨</span>
    <span class="hljs-keyword">private</span> Student bestFriend;<span class="hljs-comment">//æœ€å¥½çš„æœ‹å‹</span>
&#125;</code></pre></div>

<h3 id="4ã€åˆ›å»ºæ¨¡æ¿"><a href="#4ã€åˆ›å»ºæ¨¡æ¿" class="headerlink" title="4ã€åˆ›å»ºæ¨¡æ¿"></a>4ã€åˆ›å»ºæ¨¡æ¿</h3><p>åœ¨ <code>src/main/resources</code> ä¸‹åˆ›å»º <code>templates</code>ï¼Œæ­¤ç›®å½•ä¸º <code>freemarker</code> çš„é»˜è®¤æ¨¡æ¿å­˜æ”¾ç›®å½•ï¼›</p>
<p>åœ¨ <code>templates</code> ä¸‹åˆ›å»ºæ¨¡æ¿æ–‡ä»¶ <code>test1.ftl</code>ï¼Œæ¨¡æ¿ä¸­çš„ <code>${name}</code> æœ€ç»ˆä¼šè¢«<code>freemarker</code> æ›¿æ¢æˆå…·ä½“çš„æ•°æ®ã€‚</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utfâ€8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
Hello $&#123;name&#125;!
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>

<h3 id="5ã€-åˆ›å»º-controller"><a href="#5ã€-åˆ›å»º-controller" class="headerlink" title="5ã€ åˆ›å»º controller"></a>5ã€ åˆ›å»º controller</h3><p>åˆ›å»º <code>Controller</code> ç±»ï¼Œå‘ <code>Map</code> ä¸­æ·»åŠ  <code>name</code>ï¼Œæœ€åè¿”å›æ¨¡æ¿æ–‡ä»¶ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/freemarker"</span>)
<span class="hljs-meta">@Controller</span>  <span class="hljs-comment">//è¿™é‡Œä¸»è¦ä¸è¦ä½¿ç”¨RestController,RestControlleré»˜è®¤è¿”å›jsonæ•°æ®,ä½¿æ¨¡æ¿å¼•æ“å¤±æ•ˆ</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreemarkerController</span> </span>&#123;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æµ‹è¯•1</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map freemarkerå¼•æ“ä¼šè‡ªåŠ¨ä»Mapå½¢å‚ä¸­è¯»å–å˜é‡è¿›è¡Œæ¸²æŸ“</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/test1"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">freemarker</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span></span>&#123;
        map.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"é»‘é©¬ç¨‹åºå‘˜"</span>);
        <span class="hljs-comment">//è¿”å›æ¨¡æ¿æ–‡ä»¶åç§°</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"test1"</span>;
    &#125;
&#125;</code></pre></div>

<h3 id="6ã€åˆ›å»ºå¯åŠ¨ç±»"><a href="#6ã€åˆ›å»ºå¯åŠ¨ç±»" class="headerlink" title="6ã€åˆ›å»ºå¯åŠ¨ç±»"></a>6ã€åˆ›å»ºå¯åŠ¨ç±»</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.freemarker;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreemarkerTestApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(FreemarkerTestApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;
    &#125;
&#125;</code></pre></div>

<h3 id="7ã€æµ‹è¯•"><a href="#7ã€æµ‹è¯•" class="headerlink" title="7ã€æµ‹è¯•"></a>7ã€æµ‹è¯•</h3><p>è®¿é—® <a href="http://localhost:8088/freemarker/test1" target="_blank" rel="noopener">http://localhost:8088/freemarker/test1</a> æµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image6" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image6.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-Freemarker-åŸºç¡€è¯­æ³•"><a href="#3-Freemarker-åŸºç¡€è¯­æ³•" class="headerlink" title="3.Freemarker åŸºç¡€è¯­æ³•"></a>3.Freemarker åŸºç¡€è¯­æ³•</h2><h3 id="1ã€æ ¸å¿ƒæŒ‡ä»¤"><a href="#1ã€æ ¸å¿ƒæŒ‡ä»¤" class="headerlink" title="1ã€æ ¸å¿ƒæŒ‡ä»¤"></a>1ã€æ ¸å¿ƒæŒ‡ä»¤</h3><h4 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h4><p><code>Freemarker</code> é™æ€åŒ–ä¾èµ–æ•°æ®æ¨¡å‹å’Œæ¨¡æ¿ï¼Œä¸‹è¾¹å®šä¹‰æ•°æ®æ¨¡å‹ï¼›</p>
<p>ä¸‹è¾¹æ–¹æ³•å½¢å‚ <code>map</code> å³ä¸º <code>freemarker</code> é™æ€åŒ–æ‰€éœ€è¦çš„æ•°æ®æ¨¡å‹ï¼Œåœ¨ <code>map</code> ä¸­å¡«å……æ•°æ®ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.freemarker.controller;
<span class="hljs-keyword">import</span> com.xuecheng.test.freemarker.model.Student;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Date;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/freemarker"</span>)
<span class="hljs-meta">@Controller</span>  <span class="hljs-comment">//è¿™é‡Œä¸»è¦ä¸è¦ä½¿ç”¨RestController,RestControlleré»˜è®¤è¿”å›jsonæ•°æ®,ä½¿æ¨¡æ¿å¼•æ“å¤±æ•ˆ</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreemarkerController</span> </span>&#123;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æµ‹è¯•1</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map freemarkerå¼•æ“ä¼šè‡ªåŠ¨ä»Mapå½¢å‚ä¸­è¯»å–å˜é‡è¿›è¡Œæ¸²æŸ“</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/test1"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">freemarker</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span></span>&#123;
        map.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"é»‘é©¬ç¨‹åºå‘˜"</span>);
        <span class="hljs-comment">//å­¦ç”Ÿå¯¹è±¡1</span>
        Student stu1 = <span class="hljs-keyword">new</span> Student();
        stu1.setName(<span class="hljs-string">"å°æ˜"</span>);
        stu1.setAge(<span class="hljs-number">18</span>);
        stu1.setMoney(<span class="hljs-number">1888.123f</span>);
        stu1.setBirthday(<span class="hljs-keyword">new</span> Date());
        <span class="hljs-comment">//å­¦ç”Ÿå¯¹è±¡2</span>
        Student stu2 = <span class="hljs-keyword">new</span> Student();
        stu2.setName(<span class="hljs-string">"å°çº¢"</span>);
        stu2.setAge(<span class="hljs-number">22</span>);
        stu2.setMoney(<span class="hljs-number">1888.123f</span>);
        stu2.setBirthday(<span class="hljs-keyword">new</span> Date());
        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªListå¯¹è±¡ï¼Œç”¨äºå‚¨å­˜ä¸Šé¢è¿™ä¸¤ä¸ªå­¦ç”Ÿå¯¹è±¡</span>
        ArrayList&lt;Object&gt; stus = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        stus.add(stu1);
        stus.add(stu2);
        <span class="hljs-comment">//å‘æ•°æ®æ¨¡å‹ä¸­æ”¾å…¥List</span>
        map.put(<span class="hljs-string">"stus"</span>,stus);
        <span class="hljs-comment">//è¿”å›æ¨¡æ¿æ–‡ä»¶åç§°</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">"test1"</span>;
    &#125;
&#125;</code></pre></div>

<h4 id="ListæŒ‡ä»¤"><a href="#ListæŒ‡ä»¤" class="headerlink" title="ListæŒ‡ä»¤"></a>ListæŒ‡ä»¤</h4><p>æœ¬èŠ‚å®šä¹‰freemarkeræ¨¡æ¿ï¼Œæ¨¡æ¿ä¸­ä½¿ç”¨freemarkerçš„æŒ‡ä»¤ï¼Œå…³äºfreemarkerçš„æŒ‡ä»¤éœ€è¦çŸ¥é“ï¼š</p>
<div class="hljs"><pre><code class="hljs html">1ã€æ³¨é‡Šï¼Œå³<span class="hljs-tag">&lt;<span class="hljs-name">#â€â€å’Œâ€â€</span>&gt;</span>ï¼Œä»‹äºå…¶ä¹‹é—´çš„å†…å®¹ä¼šè¢«freemarkerå¿½ç•¥

2ã€æ’å€¼ï¼ˆInterpolationï¼‰ï¼šå³$&#123;..&#125;éƒ¨åˆ†,freemarkerä¼šç”¨çœŸå®çš„å€¼ä»£æ›¿$&#123;..&#125;

3ã€FTLæŒ‡ä»¤ï¼šå’ŒHTMLæ ‡è®°ç±»ä¼¼ï¼Œåå­—å‰åŠ #äºˆä»¥åŒºåˆ†ï¼ŒFreemarkerä¼šè§£ææ ‡ç­¾ä¸­çš„è¡¨è¾¾å¼æˆ–é€»è¾‘ã€‚

4ã€æ–‡æœ¬ï¼Œä»…æ–‡æœ¬ä¿¡æ¯ï¼Œè¿™äº›ä¸æ˜¯freemarkerçš„æ³¨é‡Šã€æ’å€¼ã€FTLæŒ‡ä»¤çš„å†…å®¹ä¼šè¢«freemarkerå¿½ç•¥è§£æï¼Œç›´æ¥è¾“å‡ºå†…å®¹</code></pre></div>

<p>åœ¨ <code>test1.ftl</code> æ¨¡æ¿ä¸­ä½¿ç”¨listæŒ‡ä»¤éå†æ•°æ®æ¨¡å‹ä¸­çš„æ•°æ®ï¼š</p>
<div class="hljs"><pre><code class="hljs jsp">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;meta charset=<span class="hljs-string">"utfâ€8"</span>&gt;
    &lt;title&gt;Hello World!&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
Hello $&#123;name&#125;!

&lt;p&gt;åœ¨test1.ftlæ¨¡æ¿ä¸­ä½¿ç”¨listæŒ‡ä»¤éå†æ•°æ®æ¨¡å‹ä¸­çš„æ•°æ®ï¼š&lt;/p&gt;
&lt;table&gt;
    &lt;thead&gt;
        &lt;td&gt;åºå·&lt;/td&gt;
        &lt;td&gt;å§“å&lt;/td&gt;
        &lt;td&gt;å¹´é¾„&lt;/td&gt;
        &lt;td&gt;é’±åŒ…&lt;/td&gt;
    &lt;/thead&gt;
    &lt;#list stus as stu&gt;
        &lt;tr&gt;
            &lt;#--ä½¿ç”¨ _index æ¥éå†çš„åºå·--&gt;
            &lt;td&gt;$&#123;stu_index + 1&#125;&lt;/td&gt;
            &lt;td&gt;$&#123;stu.name&#125;&lt;/td&gt;
            &lt;td&gt;$&#123;stu.age&#125;&lt;/td&gt;
            &lt;td&gt;$&#123;stu.money&#125;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/#list&gt;
&lt;/table&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre></div>

<p>æ•ˆæœ</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image7" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image7.png" srcset="/img/loading.gif" alt="LISTè¾“å‡ºæ•ˆæœ"></a></p>
<h4 id="éå†Mapæ•°æ®"><a href="#éå†Mapæ•°æ®" class="headerlink" title="éå†Mapæ•°æ®"></a>éå†Mapæ•°æ®</h4><p>1ã€æ•°æ®æ¨¡å‹</p>
<p>åœ¨<code>controller</code> å†…ä½¿ç”¨<code>map</code>æŒ‡ä»¤éå†æ•°æ®æ¨¡å‹ä¸­çš„ <code>stuMap</code>ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//å‡†å¤‡mapæ•°æ®</span>
HashMap&lt;Object, Object&gt; stuMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
stuMap.put(<span class="hljs-string">"stu1"</span>,stu1);
stuMap.put(<span class="hljs-string">"stu2"</span>,stu2);
<span class="hljs-comment">//åƒæ•°æ®æ¨¡å‹å†…æ”¾æ•°æ®</span>
map.put(<span class="hljs-string">"stu1"</span>,stu1);
<span class="hljs-comment">//å‘æ•°æ®æ¨¡å‹æ”¾å…¥stuMap</span>
map.put(<span class="hljs-string">"stuMap"</span>, stuMap);</code></pre></div>

<p>2ã€æ¨¡æ¿</p>
<div class="hljs"><pre><code class="hljs html">é€šè¿‡Mapè¾“å‡ºstu1çš„å­¦ç”Ÿä¿¡æ¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
å§“åï¼š$&#123;stuMap['stu1'].name&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
å¹´é¾„ï¼š$&#123;stuMap['stu1'].age&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>

é€šè¿‡Mapè¾“å‡ºstu1çš„å­¦ç”Ÿä¿¡æ¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
å§“åï¼š$&#123;stuMap.stu1.name&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
å¹´é¾„ï¼š$&#123;stuMap.stu1.age&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>


<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ä½¿ç”¨mapæŒ‡ä»¤éå†æ•°æ®æ¨¡å‹ä¸­çš„stuMapã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åºå·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>é’±åŒ…<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stuMap</span>?<span class="hljs-attr">keys</span> <span class="hljs-attr">as</span> <span class="hljs-attr">k</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;k_index + 1&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stuMap[k].name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stuMap[k].age&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stuMap[k].money&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></code></pre></div>

<p>3ã€è¾“å‡º</p>
<p><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image8.png" srcset="/img/loading.gif" alt></p>
<h4 id="ifæŒ‡ä»¤"><a href="#ifæŒ‡ä»¤" class="headerlink" title="ifæŒ‡ä»¤"></a>ifæŒ‡ä»¤</h4><p>if æŒ‡ä»¤å³åˆ¤æ–­æŒ‡ä»¤ï¼Œæ˜¯å¸¸ç”¨çš„FTLæŒ‡ä»¤ï¼Œfreemarkeråœ¨è§£ææ—¶é‡åˆ°ifä¼šè¿›è¡Œåˆ¤æ–­ï¼Œæ¡ä»¶ä¸ºçœŸåˆ™è¾“å‡ºifä¸­é—´çš„å†…å®¹ï¼Œå¦åˆ™è·³è¿‡å†…å®¹ä¸å†è¾“å‡ºã€‚</p>
<ol>
<li><p><strong>æ•°æ®æ¨¡å‹ï¼š</strong></p>
<p>ä½¿ç”¨listæŒ‡ä»¤ä¸­æµ‹è¯•æ•°æ®æ¨¡å‹ã€‚</p>
</li>
<li><p><strong>æ¨¡æ¿</strong></p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åºå·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>é’±åŒ…<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stus</span> <span class="hljs-attr">as</span> <span class="hljs-attr">stu</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">#--ä½¿ç”¨</span> <span class="hljs-attr">_index</span> æ¥éå†çš„åºå·<span class="hljs-attr">--</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu_index + 1&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            &lt;td &lt;#if stu.name == 'å°æ˜'&gt;style="background: red" &lt;/#if&gt;&gt;$&#123;stu.name&#125;&lt;/td&gt;
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.age&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.money&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></code></pre></div>

<p>é€šè¿‡é˜…è¯»ä¸Šè¾¹çš„ä»£ç ï¼Œå®ç°çš„åŠŸèƒ½æ˜¯ï¼šå¦‚æœå§“åä¸º â€œ<code>å°æ˜</code>â€ åˆ™èƒŒæ™¯è‰²æ˜¾ç¤ºä¸ºçº¢è‰²ã€‚</p>
</li>
<li><p><strong>è¾“å‡º</strong></p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image9" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image9.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>é€šè¿‡æµ‹è¯•å‘ç° å§“åä¸ºå°æ˜çš„èƒŒæ™¯è‰²ä¸ºçº¢è‰²ã€‚</p>
</li>
</ol>
<h4 id="ä¸‰å…ƒè¿ç®—"><a href="#ä¸‰å…ƒè¿ç®—" class="headerlink" title="ä¸‰å…ƒè¿ç®—"></a>ä¸‰å…ƒè¿ç®—</h4><div class="hljs"><pre><code class="hljs js">$&#123; (type == <span class="hljs-string">'SPOT'</span>) ?string(<span class="hljs-string">'çƒ­ç‚¹è¯'</span>,<span class="hljs-string">'çƒ­ç‚¹æœç´¢'</span>)&#125;</code></pre></div>

<h3 id="2ã€å…¶ä»–æŒ‡ä»¤"><a href="#2ã€å…¶ä»–æŒ‡ä»¤" class="headerlink" title="2ã€å…¶ä»–æŒ‡ä»¤"></a>2ã€å…¶ä»–æŒ‡ä»¤</h3><h4 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h4><ol>
<li>ç®—æ•°è¿ç®—ç¬¦ FreeMarkerè¡¨è¾¾å¼ä¸­å®Œå…¨æ”¯æŒç®—æœ¯è¿ç®—,FreeMarkeræ”¯æŒçš„ç®—æœ¯è¿ç®—ç¬¦åŒ…æ‹¬:+, - , * , / , %</li>
<li>é€»è¾‘è¿ç®—ç¬¦ é€»è¾‘è¿ç®—ç¬¦æœ‰å¦‚ä¸‹å‡ ä¸ª: é€»è¾‘ä¸:&amp;&amp; é€»è¾‘æˆ–:|| é€»è¾‘é:! é€»è¾‘è¿ç®—ç¬¦åªèƒ½ä½œç”¨äºå¸ƒå°”å€¼,å¦åˆ™å°†äº§ç”Ÿé”™è¯¯</li>
<li>æ¯”è¾ƒè¿ç®—ç¬¦ è¡¨è¾¾å¼ä¸­æ”¯æŒçš„æ¯”è¾ƒè¿ç®—ç¬¦æœ‰å¦‚ä¸‹å‡ ä¸ª: 1 =æˆ–è€…==:åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰. 2 !=:åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸ç­‰. 3 &gt;<br>æˆ–è€…gt:åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºå³è¾¹å€¼</li>
<li><code>&gt;=</code> æˆ–è€… <code>gte:</code> åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºç­‰äºå³è¾¹å€¼</li>
<li><code>&lt;</code> æˆ–è€… <code>lt:</code> åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºå³è¾¹å€¼</li>
<li><code>&lt;=</code> æˆ–è€… <code>lte:</code> åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºç­‰äºå³è¾¹å€¼ï¼Œæ³¨æ„: <code>=</code> å’Œ <code>!=</code> å¯ä»¥ç”¨äºå­—ç¬¦</li>
</ol>
<p>ä¸²,æ•°å€¼å’Œæ—¥æœŸæ¥æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰,ä½†=å’Œ!=ä¸¤è¾¹å¿…é¡»æ˜¯ç›¸åŒç±»å‹çš„å€¼,å¦åˆ™ä¼šäº§ç”Ÿé”™è¯¯</p>
<p>è€Œä¸” <code>FreeMarker</code> æ˜¯ç²¾ç¡®æ¯”è¾ƒ, <code>&quot;x&quot;,&quot;x &quot;,&quot;X&quot;</code> æ˜¯ä¸ç­‰çš„.å…¶å®ƒçš„è¿è¡Œç¬¦å¯ä»¥ä½œç”¨</p>
<p>äºæ•°å­—å’Œæ—¥æœŸ,ä½†ä¸èƒ½ä½œç”¨äºå­—ç¬¦ä¸²,å¤§éƒ¨åˆ†çš„æ—¶å€™,ä½¿ç”¨gtç­‰å­—æ¯è¿ç®—ç¬¦ä»£æ›¿ <code>&gt;</code> ä¼šæœ‰æ›´å¥½çš„æ•ˆæœ,å› ä¸º <code>FreeMarker</code> ä¼šæŠŠ <code>&gt;</code> è§£é‡Šæˆ <code>FTL</code> æ ‡ç­¾çš„ç»“æŸå­—ç¬¦, å½“ç„¶,ä¹Ÿå¯ä»¥ä½¿ <strong>æ‹¬å·</strong> æ¥é¿å…è¿™ç§æƒ…å†µ, å¦‚:<code>&lt;#if (x&gt;y)&gt;</code></p>
<h4 id="ç©ºå€¼å¤„ç†"><a href="#ç©ºå€¼å¤„ç†" class="headerlink" title="ç©ºå€¼å¤„ç†"></a>ç©ºå€¼å¤„ç†</h4><ol>
<li><p>åˆ¤æ–­æŸå˜é‡æ˜¯å¦å­˜åœ¨ä½¿ç”¨ â€œ??â€ ç”¨æ³•ä¸º:variable??,å¦‚æœè¯¥å˜é‡å­˜åœ¨,è¿”å›true,å¦åˆ™è¿”å›false</p>
<p>ä¾‹ï¼šä¸ºé˜²æ­¢stusä¸ºç©ºæŠ¥é”™å¯ä»¥åŠ ä¸Šåˆ¤æ–­å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">stus</span>??&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stus</span> <span class="hljs-attr">as</span> <span class="hljs-attr">stu</span>&gt;</span>
......
<span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span></code></pre></div>
</li>
<li><p>ç¼ºå¤±å˜é‡é»˜è®¤å€¼ä½¿ç”¨ <code>â€œ!â€</code> ä½¿ç”¨ <code>!</code> è¦ä»¥æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ï¼Œå½“å˜é‡ä¸ºç©ºæ—¶æ˜¾ç¤ºé»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼š <code>${name!&#39;&#39;}</code> è¡¨ç¤ºå¦‚æœ <code>name</code> ä¸ºç©ºæ˜¾ç¤ºç©ºå­—ç¬¦ä¸²ã€‚</p>
<p>å¦‚æœæ˜¯åµŒå¥—å¯¹è±¡åˆ™å»ºè®®ä½¿ç”¨ï¼ˆï¼‰æ‹¬èµ·æ¥ã€‚</p>
<p>ä¾‹ï¼š ${(stu.bestFriend.name)!â€™â€™}è¡¨ç¤ºï¼Œå¦‚æœstuæˆ–bestFriendæˆ–nameä¸ºç©ºé»˜è®¤æ˜¾ç¤ºç©ºå­—ç¬¦ä¸²ã€‚</p>
</li>
</ol>
<h4 id="å†…å»ºå‡½æ•°"><a href="#å†…å»ºå‡½æ•°" class="headerlink" title="å†…å»ºå‡½æ•°"></a>å†…å»ºå‡½æ•°</h4><p>å†…å»ºå‡½æ•°è¯­æ³•æ ¼å¼ï¼š å˜é‡+?+å‡½æ•°åç§°</p>
<ol>
<li><p>å¾—åˆ°æŸä¸ªé›†åˆçš„å¤§å°ï¼š<code>${é›†åˆå?size}</code></p>
</li>
<li><p>æ—¥æœŸæ ¼å¼åŒ–</p>
<div class="hljs"><pre><code class="hljs html">æ˜¾ç¤ºå¹´æœˆæ—¥: $&#123;today?date&#125;
æ˜¾ç¤ºæ—¶åˆ†ç§’ï¼š$&#123;today?time&#125;
æ˜¾ç¤ºæ—¥æœŸ+æ—¶é—´ï¼š$&#123;today?datetime&#125; <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>
è‡ªå®šä¹‰æ ¼å¼åŒ–ï¼š $&#123;today?string("yyyyå¹´MMæœˆ")&#125;</code></pre></div>
</li>
<li><p>å†…å»ºå‡½æ•° <code>c</code></p>
<p><code>map.put(&quot;point&quot;, 102920122);</code></p>
<p><code>point</code> æ˜¯æ•°å­—å‹ï¼Œä½¿ç”¨ <code>${point}</code> ä¼šæ˜¾ç¤ºè¿™ä¸ªæ•°å­—çš„å€¼ï¼Œå¹¶ä¸”æ¯ä¸‰ä½ä½¿ç”¨é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼šâ€œ102,920,122â€</p>
<p>å¦‚æœä¸æƒ³æ˜¾ç¤ºä¸ºæ¯ä¸‰ä½åˆ†éš”çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨ <code>c</code> å‡½æ•°å°†æ•°å­—å‹è½¬æˆå­—ç¬¦ä¸²è¾“å‡º</p>
<p>ä¾‹å¦‚ï¼š<code>${point?c}</code></p>
</li>
<li><p>å°†jsonå­—ç¬¦ä¸²è½¬æˆå¯¹è±¡</p>
<p>ä¸€ä¸ªä¾‹å­ï¼š</p>
<p>å…¶ä¸­ç”¨åˆ°äº† assignæ ‡ç­¾ï¼Œassignçš„ä½œç”¨æ˜¯å®šä¹‰ä¸€ä¸ªå˜é‡ã€‚</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">#assign</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"&#123;'bank':'å·¥å•†é“¶è¡Œ','account':'10101920201920212'&#125;"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">#assign</span> <span class="hljs-attr">data</span>=<span class="hljs-string">text?eval</span> /&gt;</span>
å¼€æˆ·è¡Œï¼š$&#123;data.bank&#125; è´¦å·ï¼š$&#123;data.account&#125;</code></pre></div>

</li>
</ol>
<h4 id="å®Œæ•´çš„æ¨¡æ¿"><a href="#å®Œæ•´çš„æ¨¡æ¿" class="headerlink" title="å®Œæ•´çš„æ¨¡æ¿"></a>å®Œæ•´çš„æ¨¡æ¿</h4><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utfâ€8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
Hello $&#123;name&#125;!
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
    åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯é‡‘ç‡•é¾™åŠå…¬æ¥¼ä¸€å±‚ ç”µè¯ï¼š400-618-9090<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åºå·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>é’±åŒ…<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stus</span> <span class="hljs-attr">as</span> <span class="hljs-attr">stu</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu_index + 1&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    &lt;td &lt;#if stu.name =='å°æ˜'&gt;style="background:red;"&lt;/#if&gt;&gt;$&#123;stu.name&#125;&lt;/td&gt;
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.age&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span>$&#123;stu.money&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
è¾“å‡ºstu1çš„å­¦ç”Ÿä¿¡æ¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
å§“åï¼š$&#123;stuMap['stu1'].name&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
å¹´é¾„ï¼š$&#123;stuMap['stu1'].age&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
è¾“å‡ºstu1çš„å­¦ç”Ÿä¿¡æ¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
å§“åï¼š$&#123;stu1.name&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
å¹´é¾„ï¼š$&#123;stu1.age&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
éå†è¾“å‡ºä¸¤ä¸ªå­¦ç”Ÿä¿¡æ¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åºå·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>é’±åŒ…<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stuMap</span>?<span class="hljs-attr">keys</span> <span class="hljs-attr">as</span> <span class="hljs-attr">k</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;k_index + 1&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stuMap[k].name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stuMap[k].age&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span>$&#123;stuMap[k].money&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å‡ºç”Ÿæ—¥æœŸ<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>é’±åŒ…<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>æœ€å¥½çš„æœ‹å‹<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>æœ‹å‹ä¸ªæ•°<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>æœ‹å‹åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">stus</span>??&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stus</span> <span class="hljs-attr">as</span> <span class="hljs-attr">stu</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.name!''&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.age&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;(stu.birthday?date)!''&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.money&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;(stu.bestFriend.name)!''&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;(stu.friends?size)!0&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">stu.friends</span>??&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stu.friends</span> <span class="hljs-attr">as</span> <span class="hljs-attr">firend</span>&gt;</span>
    $&#123;firend.name!''&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">#assign</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"&#123;'bank':'å·¥å•†é“¶è¡Œ','account':'10101920201920212'&#125;"</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">#assign</span> <span class="hljs-attr">data</span>=<span class="hljs-string">text?eval</span> /&gt;</span>
å¼€æˆ·è¡Œï¼š$&#123;data.bank&#125; è´¦å·ï¼š$&#123;data.account&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>&gt;</code></pre></div>

<h3 id="3ã€é™æ€åŒ–æµ‹è¯•"><a href="#3ã€é™æ€åŒ–æµ‹è¯•" class="headerlink" title="3ã€é™æ€åŒ–æµ‹è¯•"></a>3ã€é™æ€åŒ–æµ‹è¯•</h3><p>åœ¨cmsä¸­ä½¿ç”¨freemarkerå°†é¡µé¢ç”Ÿæˆhtmlæ–‡ä»¶ï¼Œæœ¬èŠ‚æµ‹è¯•htmlæ–‡ä»¶ç”Ÿæˆçš„æ–¹æ³•ï¼š</p>
<p><strong>1ã€ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶é™æ€åŒ–</strong></p>
<p>å®šä¹‰æ¨¡æ¿æ–‡ä»¶ï¼Œä½¿ç”¨freemarkeré™æ€åŒ–ç¨‹åºç”Ÿæˆhtmlæ–‡ä»¶ã€‚</p>
<p><strong>2ã€ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²é™æ€åŒ–</strong></p>
<p>å®šä¹‰æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œä½¿ç”¨freemarkeré™æ€åŒ–ç¨‹åºç”Ÿæˆhtmlæ–‡ä»¶ã€‚</p>
<h4 id="ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶é™æ€åŒ–"><a href="#ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶é™æ€åŒ–" class="headerlink" title="ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶é™æ€åŒ–"></a>ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶é™æ€åŒ–</h4><p>åœ¨ <code>test</code> ä¸‹åˆ›å»ºæµ‹è¯•ç±»ï¼Œå¹¶ä¸”å°†<code>main</code>ä¸‹çš„ <code>resource/templates</code> æ‹·è´åˆ° <code>test</code> ä¸‹ï¼Œæœ¬æ¬¡æµ‹è¯•ä½¿ç”¨ä¹‹å‰æˆ‘ä»¬åœ¨ <code>main</code> ä¸‹åˆ›å»ºçš„æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºæµ‹è¯•ç±»ã€‚ ç›®å½•ç»“æ„å¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image10" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image10.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>åˆ›å»ºæµ‹è¯•ç±»</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åŸºäºæ¨¡æ¿ç”Ÿæˆé™æ€æ–‡ä»¶</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGenerateHtml</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;
    <span class="hljs-comment">//åˆ›å»ºé…ç½®ç±»</span>
    Configuration configuration = <span class="hljs-keyword">new</span> Configuration(Configuration.getVersion());
    <span class="hljs-comment">//è®¾ç½®æ¨¡æ¿è·¯å¾„</span>
    String classPath = <span class="hljs-keyword">this</span>.getClass().getResource(<span class="hljs-string">"/"</span>).getPath();
    classPath = java.net.URLDecoder.decode(classPath,<span class="hljs-string">"utf-8"</span>); <span class="hljs-comment">//è·¯å¾„åŒ…å«ä¸­æ–‡éœ€è¦è¿›è¡Œè½¬ç </span>
    configuration.setDirectoryForTemplateLoading(<span class="hljs-keyword">new</span> File(classPath +<span class="hljs-string">"/templates"</span>));
    <span class="hljs-comment">//è®¾ç½®å­—ç¬¦é›†</span>
    configuration.setDefaultEncoding(<span class="hljs-string">"utf-8"</span>);
    <span class="hljs-comment">//åŠ è½½æ¨¡æ¿</span>
    Template template = configuration.getTemplate(<span class="hljs-string">"test1.ftl"</span>);
    <span class="hljs-comment">//æ•°æ®æ¨¡å‹</span>
    Map map = getMap();
    <span class="hljs-comment">//é™æ€åŒ–</span>
    String content = FreeMarkerTemplateUtils.processTemplateIntoString(template, map);
    <span class="hljs-comment">//é™æ€åŒ–å†…å®¹</span>
    InputStream inputStream = IOUtils.toInputStream(content);
    <span class="hljs-comment">//è¾“å‡ºåˆ°æ–‡ä»¶</span>
    FileOutputStream fileOutputStream = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-keyword">new</span> File(<span class="hljs-string">"d:/test1.html"</span>));
    <span class="hljs-keyword">int</span> copy = IOUtils.copy(inputStream, fileOutputStream);
&#125;

<span class="hljs-function"><span class="hljs-keyword">public</span> Map <span class="hljs-title">getMap</span><span class="hljs-params">()</span></span>&#123;
    Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    map.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"é»‘é©¬ç¨‹åºå‘˜"</span>);
    <span class="hljs-comment">//å­¦ç”Ÿå¯¹è±¡1</span>
    Student stu1 = <span class="hljs-keyword">new</span> Student();
    stu1.setName(<span class="hljs-string">"å°æ˜"</span>);
    stu1.setAge(<span class="hljs-number">18</span>);
    stu1.setMoney(<span class="hljs-number">1888.123f</span>);
    stu1.setBirthday(<span class="hljs-keyword">new</span> Date());
    <span class="hljs-comment">//å­¦ç”Ÿå¯¹è±¡2</span>
    Student stu2 = <span class="hljs-keyword">new</span> Student();
    stu2.setName(<span class="hljs-string">"å°çº¢"</span>);
    stu2.setAge(<span class="hljs-number">22</span>);
    stu2.setMoney(<span class="hljs-number">1888.123f</span>);
    stu2.setBirthday(<span class="hljs-keyword">new</span> Date());
    <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªListå¯¹è±¡ï¼Œç”¨äºå‚¨å­˜ä¸Šé¢è¿™ä¸¤ä¸ªå­¦ç”Ÿå¯¹è±¡</span>
    ArrayList&lt;Object&gt; stus = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    stus.add(stu1);
    stus.add(stu2);
    <span class="hljs-comment">//å‘æ•°æ®æ¨¡å‹ä¸­æ”¾å…¥List</span>
    map.put(<span class="hljs-string">"stus"</span>,stus);
    <span class="hljs-comment">//å‡†å¤‡mapæ•°æ®</span>
    HashMap&lt;Object, Object&gt; stuMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    stuMap.put(<span class="hljs-string">"stu1"</span>,stu1);
    stuMap.put(<span class="hljs-string">"stu2"</span>,stu2);
    <span class="hljs-comment">//åƒæ•°æ®æ¨¡å‹å†…æ”¾æ•°æ®</span>
    map.put(<span class="hljs-string">"stu1"</span>,stu1);
    <span class="hljs-comment">//å‘æ•°æ®æ¨¡å‹æ”¾å…¥stuMap</span>
    map.put(<span class="hljs-string">"stuMap"</span>, stuMap);
    <span class="hljs-keyword">return</span> map;
&#125;</code></pre></div>

<p>è¿è¡Œæµ‹è¯•ï¼Œå¾—åˆ°htmlæ¨¡æ¿</p>
<p><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image11.png" srcset="/img/loading.gif" alt="img"></p>
<h4 id="ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²é™æ€åŒ–"><a href="#ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²é™æ€åŒ–" class="headerlink" title="ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²é™æ€åŒ–"></a>ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²é™æ€åŒ–</h4><p>è¯¦ç»†ä»£ç çœç•¥ï¼Œä½¿ç”¨å­—ç¬¦ä¸²å’Œä½¿ç”¨æ¨¡æ¿çš„åŒºåˆ«æ˜¯ è¿™é‡Œç›´æ¥å®šä¹‰ä¸€ä¸ª <code>HTML</code> çš„å­—ç¬¦ä¸²å˜é‡ï¼Œä¾‹å¦‚</p>
<div class="hljs"><pre><code class="hljs java">String templateString=<span class="hljs-string">""</span> +
    <span class="hljs-string">"&lt;html&gt;\n"</span> +
    <span class="hljs-string">" &lt;head&gt;&lt;/head&gt;\n"</span> +
    <span class="hljs-string">" &lt;body&gt;\n"</span> +
    <span class="hljs-string">" åç§°ï¼š$&#123;name&#125;\n"</span> +
    <span class="hljs-string">" &lt;/body&gt;\n"</span> +
    <span class="hljs-string">"&lt;/html&gt;"</span>;</code></pre></div>

<p>è€Œå‰é¢çš„ä¾‹å­æ˜¯ä»ftlæ¨¡æ¿ä¸­è·å–å†…å®¹</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åŠ è½½æ¨¡æ¿</span>
Template template = configuration.getTemplate(<span class="hljs-string">"test1.ftl"</span>);</code></pre></div>

<h2 id="4-ç« èŠ‚æ€»ç»“"><a href="#4-ç« èŠ‚æ€»ç»“" class="headerlink" title="4. ç« èŠ‚æ€»ç»“"></a>4. ç« èŠ‚æ€»ç»“</h2><p>æœ¬ç« èŠ‚ä¸»è¦ä»‹ç»äº† <code>Freemarker</code> æ¨¡æ¿å¼•æ“çš„è¯­æ³•ä»‹ç»å’ŒåŸºæœ¬çš„åº”ç”¨ï¼Œå¹¶äº†è§£äº† <code>Freemarker</code> åœ¨è¿›è¡Œæ¨¡æ¿æ¸²æŸ“æ—¶çš„APIè°ƒç”¨è¿‡ç¨‹ã€‚</p>
<h1 id="ä¸‰ã€é¡µé¢é™æ€åŒ–å®æˆ˜"><a href="#ä¸‰ã€é¡µé¢é™æ€åŒ–å®æˆ˜" class="headerlink" title="ä¸‰ã€é¡µé¢é™æ€åŒ–å®æˆ˜"></a>ä¸‰ã€é¡µé¢é™æ€åŒ–å®æˆ˜</h1><h2 id="1-é¡µé¢é™æ€åŒ–æµç¨‹"><a href="#1-é¡µé¢é™æ€åŒ–æµç¨‹" class="headerlink" title="1.é¡µé¢é™æ€åŒ–æµç¨‹"></a>1.é¡µé¢é™æ€åŒ–æµç¨‹</h2><p>é€šè¿‡ä¸Šè¾¹å¯¹ <code>FreeMarker</code> çš„ç ”ç©¶æˆ‘ä»¬å¾—å‡ºï¼š<strong>æ¨¡æ¿ + æ•°æ®æ¨¡å‹ = è¾“å‡º</strong>ï¼Œé¡µé¢é™æ€åŒ–éœ€è¦å‡†å¤‡æ•°æ®æ¨¡å‹å’Œæ¨¡æ¿ï¼Œå…ˆçŸ¥é“æ•°æ®æ¨¡å‹çš„ç»“æ„æ‰å¯ä»¥ç¼–å†™æ¨¡æ¿ï¼Œå› ä¸ºåœ¨æ¨¡æ¿ä¸­è¦å¼•ç”¨æ•°æ®æ¨¡å‹ä¸­çš„æ•°æ®ï¼Œæœ¬èŠ‚å°†ç³»ç»Ÿè®²è§£ <code>CMS</code> é¡µé¢æ•°æ®æ¨¡å‹è·å–ã€æ¨¡æ¿ç®¡ç†åŠé™æ€åŒ–çš„è¿‡ç¨‹ã€‚</p>
<p>ä¸‹è¾¹æˆ‘ä»¬è®¨è®ºä¸€ä¸ªé—®é¢˜ï¼š<strong>å¦‚ä½•è·å–é¡µé¢çš„æ•°æ®æ¨¡å‹ï¼Ÿ</strong></p>
<p><code>CMS</code> ç®¡ç†äº†å„ç§é¡µé¢ï¼Œ<code>CMS</code> å¯¹é¡µé¢è¿›è¡Œé™æ€åŒ–æ—¶éœ€è¦æ•°æ®æ¨¡å‹ï¼Œä½†æ˜¯ <code>CMS</code> å¹¶ä¸çŸ¥é“æ¯ä¸ªé¡µé¢çš„æ•°æ®æ¨¡å‹çš„å…·ä½“å†…å®¹ï¼Œå®ƒåªç®¡æ‰§è¡Œé™æ€åŒ–ç¨‹åºä¾¿å¯å¯¹é¡µé¢è¿›è¡Œé™æ€åŒ–ï¼Œæ‰€ä»¥ <code>CMS</code> é™æ€åŒ–ç¨‹åºéœ€è¦é€šè¿‡ä¸€ç§é€šç”¨çš„æ–¹æ³•æ¥è·å–æ•°æ®æ¨¡å‹ã€‚</p>
<p>åœ¨ç¼–è¾‘é¡µé¢ä¿¡æ¯æ—¶æŒ‡å®šä¸€ä¸ª <code>DataUrl</code> ï¼Œæ­¤ <code>DataUrl</code> ä¾¿æ˜¯è·å–æ•°æ®æ¨¡å‹çš„ <code>Url</code>ï¼Œå®ƒåŸºäº <code>Http</code>æ–¹å¼ï¼Œ<code>CMS</code> å¯¹é¡µé¢è¿›è¡Œé™æ€åŒ–æ—¶ä¼šä»é¡µé¢ä¿¡æ¯ä¸­è¯»å– <code>DataUrl</code>ï¼Œé€šè¿‡ <code>Http</code> è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•è¯·æ±‚ <code>DataUrl</code> è·å–æ•°æ®æ¨¡å‹ ã€‚</p>
<p>ç®¡ç†å‘˜æ€ä¹ˆçŸ¥é“ <code>DataUrl</code> çš„å†…å®¹å‘¢ï¼Ÿ</p>
<p><strong>ä¸¾ä¾‹è¯´æ˜</strong>ï¼š</p>
<p>æ­¤é¡µé¢æ˜¯è½®æ’­å›¾é¡µé¢ï¼Œå®ƒçš„ <code>DataUrl</code> ç”±å¼€å‘è½®æ’­å›¾ç®¡ç†çš„ç¨‹åºå‘˜æä¾›ã€‚</p>
<p>æ­¤é¡µé¢æ˜¯ç²¾å“è¯¾ç¨‹æ¨èé¡µé¢ï¼Œå®ƒçš„ <code>DataUrl</code> ç”±ç²¾å“è¯¾ç¨‹æ¨èçš„ç¨‹åºå‘˜æä¾›ã€‚</p>
<p>æ­¤é¡µé¢æ˜¯è¯¾ç¨‹è¯¦æƒ…é¡µé¢ï¼Œå®ƒçš„ <code>DataUrl</code> ç”±è¯¾ç¨‹ç®¡ç†çš„ç¨‹åºå‘˜æä¾›ã€‚</p>
<p>é¡µé¢é™æ€åŒ–æµç¨‹å¦‚ä¸‹å›¾ï¼š</p>
<p>1ã€é™æ€åŒ–ç¨‹åºé¦–å…ˆè¯»å–é¡µé¢è·å–DataUrlã€‚</p>
<p>2ã€é™æ€åŒ–ç¨‹åºè¿œç¨‹è¯·æ±‚DataUrlå¾—åˆ°æ•°æ®æ¨¡å‹ã€‚</p>
<p>3ã€è·å–é¡µé¢æ¨¡æ¿ã€‚</p>
<p>4ã€æ‰§è¡Œé¡µé¢é™æ€åŒ–</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image12" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image12.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="2-æ•°æ®æ¨¡å‹"><a href="#2-æ•°æ®æ¨¡å‹" class="headerlink" title="2. æ•°æ®æ¨¡å‹"></a>2. æ•°æ®æ¨¡å‹</h2><h3 id="1ã€è½®æ’­å›¾DataUrlæ¥å£"><a href="#1ã€è½®æ’­å›¾DataUrlæ¥å£" class="headerlink" title="1ã€è½®æ’­å›¾DataUrlæ¥å£"></a>1ã€è½®æ’­å›¾DataUrlæ¥å£</h3><h4 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><p><code>CMS</code> ä¸­æœ‰è½®æ’­å›¾ç®¡ç†ã€ç²¾å“è¯¾ç¨‹æ¨èçš„åŠŸèƒ½ï¼Œä»¥è½®æ’­å›¾ç®¡ç†ä¸ºä¾‹è¯´æ˜ï¼šè½®æ’­å›¾ç®¡ç†æ˜¯é€šè¿‡å¯è§†åŒ–çš„æ“ä½œç•Œé¢ç”±ç®¡ç†å‘˜æŒ‡å®šè½®æ’­å›¾å›¾ç‰‡åœ°å€ï¼Œæœ€åå°†è½®æ’­å›¾å›¾ç‰‡åœ°å€ä¿å­˜åœ¨ <code>cms_config</code> é›†åˆä¸­ï¼Œä¸‹è¾¹æ˜¯è½®æ’­å›¾æ•°æ®æ¨¡å‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image13" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image13.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>é’ˆå¯¹é¦–é¡µçš„è½®æ’­å›¾ä¿¡æ¯ã€ç²¾å“æ¨èç­‰ä¿¡æ¯çš„è·å–ç»Ÿä¸€æä¾›ä¸€ä¸ª <code>Url</code> ä¾›é™æ€åŒ–ç¨‹åºè°ƒç”¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±çŸ¥é“äº†è½®æ’­å›¾é¡µé¢ã€ç²¾å“è¯¾ç¨‹æ¨èé¡µé¢çš„ <code>DataUrl</code>ï¼Œç®¡ç†åœ¨é¡µé¢é…ç½®ä¸­å°†æ­¤ <code>Url</code> é…ç½®åœ¨é¡µé¢ä¿¡æ¯ä¸­ã€‚æœ¬å°èŠ‚å¼€å‘ä¸€ä¸ªæŸ¥è¯¢è½®æ’­å›¾ã€ç²¾å“æ¨èä¿¡æ¯çš„æ¥å£ï¼Œæ­¤æ¥å£ä¾›é™æ€åŒ–ç¨‹åºè°ƒç”¨è·å–æ•°æ®æ¨¡å‹ ã€‚</p>
<h4 id="æ¥å£å®šä¹‰"><a href="#æ¥å£å®šä¹‰" class="headerlink" title="æ¥å£å®šä¹‰"></a>æ¥å£å®šä¹‰</h4><p>è½®æ’­å›¾ä¿¡æ¯ã€ç²¾å“æ¨èç­‰ä¿¡æ¯å­˜å‚¨åœ¨MongoDBçš„cms_configé›†åˆä¸­ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image14" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image14.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>cms_configæœ‰å›ºå®šçš„æ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.cms;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.ToString;
<span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-meta">@Document</span>(collection = <span class="hljs-string">"cms_config"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsConfig</span> </span>&#123;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> String id; <span class="hljs-comment">//ä¸»é”®</span>
    <span class="hljs-keyword">private</span> String name; <span class="hljs-comment">//æ•°æ®æ¨¡å‹åç§°</span>
    <span class="hljs-keyword">private</span> List&lt;CmsConfigModel&gt; model;  <span class="hljs-comment">//æ•°æ®æ¨¡å‹é¡¹ç›®</span>

&#125;</code></pre></div>

<p>æ•°æ®ç±»å‹é¡¹ç›®çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.cms;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.ToString;

<span class="hljs-keyword">import</span> java.util.Map;


<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsConfigModel</span> </span>&#123;
    <span class="hljs-keyword">private</span> String key;  <span class="hljs-comment">//ä¸»é”®</span>
    <span class="hljs-keyword">private</span> String name; <span class="hljs-comment">//é¡¹ç›®åç§°</span>
    <span class="hljs-keyword">private</span> String url;  <span class="hljs-comment">//é¡¹ç›®url</span>
    <span class="hljs-keyword">private</span> Map mapValue;  <span class="hljs-comment">//é¡¹ç›®å¤æ‚å€¼</span>
    <span class="hljs-keyword">private</span> String value;  <span class="hljs-comment">//é¡¹ç›®ç®€å•å€¼</span>
&#125;</code></pre></div>

<p>ä¸Šè¾¹çš„æ•°æ®ç»“æ„å¯ä»¥å¯¹ç…§ <code>cms_config</code> çš„æ•°æ®è¿›è¡Œåˆ†æã€‚</p>
<p>å…¶ä¸­ï¼Œåœ¨ <code>mapValue</code> ä¸­å¯ä»¥å‚¨å­˜ä¸€äº›å¤æ‚çš„æ•°æ®çš„æ¨¡å‹å†…å®¹ã€‚</p>
<p>æ ¹æ®é…ç½®ä¿¡æ¯IdæŸ¥è¯¢é…ç½®ä¿¡æ¯ï¼Œå®šä¹‰æ¥å£å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.api.cms;

<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsConfig;
<span class="hljs-keyword">import</span> io.swagger.annotations.Api;
<span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;

<span class="hljs-meta">@Api</span>(value=<span class="hljs-string">"cmsé…ç½®ç®¡ç†æ¥å£"</span>,description = <span class="hljs-string">"cmsé…ç½®ç®¡ç†æ¥å£ï¼Œæä¾›æ•°æ®æ¨¡å‹çš„ç®¡ç†ã€æŸ¥è¯¢æ¥å£"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsConfigControllerApi</span> </span>&#123;

    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æ ¹æ®idæŸ¥è¯¢CMSé…ç½®ä¿¡æ¯"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsConfig <span class="hljs-title">getModel</span><span class="hljs-params">(String id)</span></span>;
&#125;</code></pre></div>

<h4 id="Daoå±‚"><a href="#Daoå±‚" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.dao;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsConfig;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsConfigRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsConfig</span>,<span class="hljs-title">String</span>&gt; </span>&#123;
&#125;</code></pre></div>

<h4 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p>åœ¨åŸserviceå±‚æ·»åŠ ï¼ˆæ­¤å¤„åº”æ–°åˆ›å»ºä¸€ä¸ªServiceï¼‰</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æ ¹æ®idæŸ¥è¯¢cmsconfig</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsConfig <span class="hljs-title">getConfigById</span><span class="hljs-params">(String id)</span></span>&#123;
        Optional&lt;CmsConfig&gt; optional = cmsConfigRepository.findById(id);
        <span class="hljs-keyword">if</span> (optional.isPresent())&#123;
            CmsConfig cmsConfig = optional.get();
            <span class="hljs-keyword">return</span> cmsConfig;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;</code></pre></div>

<h4 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.controller;

<span class="hljs-keyword">import</span> com.xuecheng.api.cms.CmsConfigControllerApi;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsConfig;
<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.service.CmsConfigService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;


<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/cms/config"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsConfigController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CmsConfigControllerApi</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    CmsConfigService cmsConfigService;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/getmodel/&#123;id&#125;"</span>)
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsConfig <span class="hljs-title">getModel</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id) </span>&#123;
        CmsConfig configById = cmsConfigService.getConfigById(id);
        <span class="hljs-keyword">return</span> configById;
    &#125;
&#125;</code></pre></div>

<h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>ä½¿ç”¨postmanæµ‹è¯•æ¥å£ï¼š</p>
<p>getè¯·æ±‚ï¼š<a href="http://localhost:31001/cms/config/getmodel/5a791725dd573c3574ee333f" target="_blank" rel="noopener">http://localhost:31001/cms/config/getmodel/5a791725dd573c3574ee333f</a> ï¼ˆè½®æ’­å›¾ä¿¡æ¯ï¼‰</p>
<h3 id="2ã€è¿œç¨‹è¯·æ±‚æ¥å£"><a href="#2ã€è¿œç¨‹è¯·æ±‚æ¥å£" class="headerlink" title="2ã€è¿œç¨‹è¯·æ±‚æ¥å£"></a>2ã€è¿œç¨‹è¯·æ±‚æ¥å£</h3><p><code>SpringMVC</code> æä¾› <code>RestTemplate</code> è¯·æ±‚ <code>http</code> æ¥å£ï¼Œ<code>RestTemplate</code> çš„åº•å±‚å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ <code>http</code> å®¢æˆ·ç«¯å·¥å…·å®ç° <code>http</code> çš„è¯·æ±‚ï¼Œå¸¸ç”¨çš„ <code>http</code> å®¢æˆ·ç«¯å·¥å…·æœ‰ <code>Apache HttpClient</code>ã€<code>OkHttpClient</code> ç­‰ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨ <code>OkHttpClient</code> å®Œæˆ <code>http</code> è¯·æ±‚ï¼ŒåŸå› ä¹Ÿæ˜¯å› ä¸ºå®ƒçš„æ€§èƒ½æ¯”è¾ƒå‡ºä¼—ã€‚</p>
<h4 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h4><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></code></pre></div>

<h4 id="é…ç½®-RestTemplate"><a href="#é…ç½®-RestTemplate" class="headerlink" title="é…ç½® RestTemplate"></a>é…ç½® RestTemplate</h4><p>åœ¨<code>SpringBoot</code>å¯åŠ¨ç±»ä¸­é…ç½® <code>RestTemplate</code></p>
<div class="hljs"><pre><code class="hljs java">...
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCmsApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(ManageCmsApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate(<span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory());
    &#125;
&#125;</code></pre></div>

<h4 id="3ã€æµ‹è¯•-RestTemplate"><a href="#3ã€æµ‹è¯•-RestTemplate" class="headerlink" title="3ã€æµ‹è¯• RestTemplate"></a>3ã€æµ‹è¯• RestTemplate</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">RestTemplateTest</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    RestTemplate restTemplate;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testRestTemplate</span><span class="hljs-params">()</span></span>&#123;
        ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(<span class="hljs-string">"http://localhost:31001/cms/config/getmodel/5a791725dd573c3574ee333f"</span>, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
        System.out.println(forEntity);
    &#125;
&#125;</code></pre></div>

<p>è¿è¡Œæµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image15" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image15.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-æ¨¡æ¿ç®¡ç†"><a href="#3-æ¨¡æ¿ç®¡ç†" class="headerlink" title="3.æ¨¡æ¿ç®¡ç†"></a>3.æ¨¡æ¿ç®¡ç†</h2><h3 id="1ã€æ¨¡æ¿ç®¡ç†ä¸šåŠ¡æµç¨‹"><a href="#1ã€æ¨¡æ¿ç®¡ç†ä¸šåŠ¡æµç¨‹" class="headerlink" title="1ã€æ¨¡æ¿ç®¡ç†ä¸šåŠ¡æµç¨‹"></a>1ã€æ¨¡æ¿ç®¡ç†ä¸šåŠ¡æµç¨‹</h3><p>CMSæä¾›æ¨¡æ¿ç®¡ç†åŠŸèƒ½ï¼Œä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image16" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image16.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1ã€è¦å¢åŠ æ–°æ¨¡æ¿é¦–å…ˆéœ€è¦åˆ¶ä½œæ¨¡æ¿ï¼Œæ¨¡æ¿çš„å†…å®¹å°±æ˜¯ <code>Freemarker ftl</code> æ¨¡æ¿å†…å®¹ã€‚</p>
<p>2ã€é€šè¿‡æ¨¡æ¿ç®¡ç†æ¨¡å—åŠŸèƒ½æ–°å¢æ¨¡æ¿ã€ä¿®æ”¹æ¨¡æ¿ã€åˆ é™¤æ¨¡æ¿ã€‚</p>
<p>3ã€æ¨¡æ¿ä¿¡æ¯å­˜å‚¨åœ¨ <code>MongoDB</code> æ•°æ®åº“ï¼Œå…¶ä¸­æ¨¡æ¿ä¿¡æ¯å­˜å‚¨åœ¨ <code>cms_template</code> é›†åˆä¸­ï¼Œæ¨¡æ¿æ–‡ä»¶å­˜å‚¨åœ¨ <code>GridFS</code> æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p>
<p>ä¸‹è¾¹æ˜¯ä¸€ä¸ªæ¨¡æ¿çš„ä¾‹å­ï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5a962b52b00ffc514038faf7"</span>),
    <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsTemplate"</span>,
    <span class="hljs-attr">"siteId"</span> : <span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>,
    <span class="hljs-attr">"templateName"</span> : <span class="hljs-string">"é¦–é¡µ"</span>,
    <span class="hljs-attr">"templateParameter"</span> : <span class="hljs-string">""</span>,
    <span class="hljs-attr">"templateFileId"</span> : <span class="hljs-string">"5a962b52b00ffc514038faf5"</span>
&#125;</code></pre></div>

<p>ä¸Šè¾¹æ¨¡æ¿ä¿¡æ¯ä¸­ <code>templateFileId</code> æ˜¯æ¨¡æ¿æ–‡ä»¶çš„IDï¼Œæ­¤IDå¯¹åº” <code>GridFS</code> æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶IDã€‚</p>
<h3 id="2ã€æ¨¡æ¿åˆ¶ä½œ"><a href="#2ã€æ¨¡æ¿åˆ¶ä½œ" class="headerlink" title="2ã€æ¨¡æ¿åˆ¶ä½œ"></a>2ã€æ¨¡æ¿åˆ¶ä½œ</h3><h4 id="ç¼–å†™æ¨¡æ¿æ–‡ä»¶"><a href="#ç¼–å†™æ¨¡æ¿æ–‡ä»¶" class="headerlink" title="ç¼–å†™æ¨¡æ¿æ–‡ä»¶"></a>ç¼–å†™æ¨¡æ¿æ–‡ä»¶</h4><p>è½®æ’­å›¾é¡µé¢åŸå‹</p>
<p>åœ¨é—¨æˆ·çš„é™æ€å·¥ç¨‹ç›®å½•æœ‰è½®æ’­å›¾çš„é™æ€é¡µé¢ï¼Œè·¯å¾„æ˜¯ï¼š<code>/include/index_banner.html</code>ã€‚</p>
<p>æ•°æ®æ¨¡å‹ä¸ºï¼š</p>
<p>é€šè¿‡http è·å–åˆ°æ•°æ®æ¨¡å‹å¦‚ä¸‹ï¼š</p>
<p>ä¸‹å›¾æ•°æ®æ¨¡å‹çš„å›¾ç‰‡è·¯å¾„æ”¹æˆå¯ä»¥æµè§ˆçš„æ­£ç¡®è·¯å¾„ã€‚</p>
<div class="hljs"><pre><code class="hljs json">&#123; 
    <span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5a791725dd573c3574ee333f"</span>), 
    <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsConfig"</span>, 
    <span class="hljs-attr">"name"</span> : <span class="hljs-string">"è½®æ’­å›¾"</span>, 
    <span class="hljs-attr">"model"</span> : [
        &#123;
            <span class="hljs-attr">"key"</span> : <span class="hljs-string">"banner1"</span>, 
            <span class="hljs-attr">"name"</span> : <span class="hljs-string">"è½®æ’­å›¾1åœ°å€"</span>, 
            <span class="hljs-attr">"value"</span> : <span class="hljs-string">"http://www.xuecheng.com/img/widget-bannerA.jpg"</span>
        &#125;, 
        &#123;
            <span class="hljs-attr">"key"</span> : <span class="hljs-string">"banner2"</span>, 
            <span class="hljs-attr">"name"</span> : <span class="hljs-string">"è½®æ’­å›¾2åœ°å€"</span>, 
            <span class="hljs-attr">"value"</span> : <span class="hljs-string">"http://www.xuecheng.com/img/widget-bannerB.jpg"</span>
        &#125;
    ]
&#125;</code></pre></div>

<p>ç¼–å†™æ¨¡æ¿</p>
<p>åœ¨freemarkeræµ‹è¯•å·¥ç¨‹ä¸­æ–°å»ºæ¨¡æ¿ <code>index_banner.ftl</code>ã€‚</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.xuecheng.com/plugins/normalize-css/normalize.css"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.xuecheng.com/plugins/bootstrap/dist/css/bootstrap.css"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.xuecheng.com/css/page-learing-index.css"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.xuecheng.com/css/page-header.css"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"banner-roll"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"banner-item"</span>&gt;</span>
        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-bannerB.jpg);"&gt;&lt;/div&gt;--&gt;
        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-bannerA.jpg);"&gt;&lt;/div&gt;--&gt;
        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-banner3.png);"&gt;&lt;/div&gt;--&gt;
        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-bannerB.jpg);"&gt;&lt;/div&gt;--&gt;
        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-bannerA.jpg);"&gt;&lt;/div&gt;--&gt;
        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-banner3.png);"&gt;&lt;/div&gt;--&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">#--æ¸²æŸ“è½®æ’­å›¾--</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">model</span>??&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">model</span> <span class="hljs-attr">as</span> <span class="hljs-attr">item</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background-image: url($&#123;item.value&#125;);"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicators"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.xuecheng.com/plugins/jquery/dist/jquery.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.xuecheng.com/plugins/bootstrap/dist/js/bootstrap.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span>
<span class="javascript">    <span class="hljs-keyword">var</span> tg = $(<span class="hljs-string">'.banner-item .item'</span>);</span>
<span class="actionscript">    <span class="hljs-keyword">var</span> num = <span class="hljs-number">0</span>;</span>
    for (i = 0; i &lt; tg.length; i++) &#123;
<span class="javascript">        $(<span class="hljs-string">'.indicators'</span>).append(<span class="hljs-string">'&lt;span&gt;&lt;/span&gt;'</span>);</span>
<span class="javascript">        $(<span class="hljs-string">'.indicators'</span>).find(<span class="hljs-string">'span'</span>).eq(num).addClass(<span class="hljs-string">'active'</span>);</span>
    &#125;

<span class="actionscript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">roll</span><span class="hljs-params">()</span> </span>&#123;</span>
        tg.eq(num).animate(&#123;
<span class="actionscript">            <span class="hljs-string">'opacity'</span>: <span class="hljs-string">'1'</span>,</span>
<span class="actionscript">            <span class="hljs-string">'z-index'</span>: num</span>
        &#125;, 1000).siblings().animate(&#123;
<span class="actionscript">            <span class="hljs-string">'opacity'</span>: <span class="hljs-string">'0'</span>,</span>
<span class="actionscript">            <span class="hljs-string">'z-index'</span>: <span class="hljs-number">0</span></span>
        &#125;, 1000);
<span class="javascript">        $(<span class="hljs-string">'.indicators'</span>).find(<span class="hljs-string">'span'</span>).eq(num).addClass(<span class="hljs-string">'active'</span>).siblings().removeClass(<span class="hljs-string">'active'</span>);</span>
        if (num &gt;= tg.length - 1) &#123;
            num = 0;
<span class="actionscript">        &#125; <span class="hljs-keyword">else</span> &#123;</span>
            num++;
        &#125;
    &#125;
<span class="javascript">    $(<span class="hljs-string">'.indicators'</span>).find(<span class="hljs-string">'span'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;</span>
<span class="javascript">        num = $(<span class="hljs-keyword">this</span>).index();</span>
        roll();
    &#125;);
<span class="actionscript">    <span class="hljs-keyword">var</span> timer = setInterval(roll, <span class="hljs-number">3000</span>);</span>
<span class="javascript">    $(<span class="hljs-string">'.banner-item'</span>).mouseover(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;</span>
        clearInterval(timer)
    &#125;);
<span class="javascript">    $(<span class="hljs-string">'.banner-item'</span>).mouseout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;</span>
        timer = setInterval(roll, 3000)
    &#125;);
<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>

<h4 id="æ¨¡æ¿æµ‹è¯•"><a href="#æ¨¡æ¿æµ‹è¯•" class="headerlink" title="æ¨¡æ¿æµ‹è¯•"></a>æ¨¡æ¿æµ‹è¯•</h4><p>åœ¨ <code>freemarker</code> æµ‹è¯•å·¥ç¨‹çš„å…¥å£æ–‡ä»¶æ³¨å†Œ <code>RestTemplate</code> çš„Bean</p>
<blockquote>
<p>åŸè®²ä¹‰åªåœ¨ cmså·¥ç¨‹ä¸‹æ³¨å†Œäº†beanï¼Œè®°å¾— <code>freemarker</code> æµ‹è¯•å·¥ç¨‹ä¸‹ä¹Ÿè¦æ³¨å†Œ</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreemarkerTestApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(FreemarkerTestApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate(<span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory());
    &#125;
&#125;</code></pre></div>

<p>åœ¨ <code>freemarker</code> æµ‹è¯•å·¥ç¨‹çš„ <code>FreemarkerController</code> ä¸‹ç¼–å†™ä¸€ä¸ªæ–¹æ³•æµ‹è¯•è½®æ’­å›¾æ¨¡æ¿ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
RestTemplate restTemplate;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ç”¨äºè°ƒè¯•banneræ¨¡æ¿</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/banner"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">indexBanner</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span></span>&#123;
    String dataUrl = <span class="hljs-string">"http://localhost:31001/cms/config/getmodel/5a791725dd573c3574ee333f"</span>;
    ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(dataUrl, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    Map body = forEntity.getBody();
    map.putAll(body); <span class="hljs-comment">//å°†è·å–åˆ°çš„æ•°æ®èµ‹å€¼ç»™mapï¼Œå¹¶æ¸²æŸ“è‡³æ¨¡æ¿å†…</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">"index-banner"</span>;
&#125;</code></pre></div>

<p>è¯·æ±‚ï¼š<a href="http://localhost:8088/freemarker/banner" target="_blank" rel="noopener">http://localhost:8088/freemarker/banner</a></p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image17" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image17.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="3ã€GridFS-ç ”ç©¶"><a href="#3ã€GridFS-ç ”ç©¶" class="headerlink" title="3ã€GridFS ç ”ç©¶"></a>3ã€GridFS ç ”ç©¶</h3><h4 id="GridFSä»‹ç»"><a href="#GridFSä»‹ç»" class="headerlink" title="GridFSä»‹ç»"></a>GridFSä»‹ç»</h4><p><code>GridFS</code> æ˜¯ <code>MongoDB</code> æä¾›çš„ç”¨äºæŒä¹…åŒ–å­˜å‚¨æ–‡ä»¶çš„æ¨¡å—ï¼ŒCMSä½¿ç”¨<code>MongoDB</code>å­˜å‚¨æ•°æ®ï¼Œä½¿ç”¨<code>GridFS</code> å¯ä»¥å¿«é€Ÿé›†æˆå¼€å‘ã€‚</p>
<p>å®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼š</p>
<p>åœ¨ <code>GridFS</code> å­˜å‚¨æ–‡ä»¶æ˜¯å°†æ–‡ä»¶åˆ†å—å­˜å‚¨ï¼Œæ–‡ä»¶ä¼šæŒ‰ç…§256KBçš„å¤§å°åˆ†å‰²æˆå¤šä¸ªå—è¿›è¡Œå­˜å‚¨ï¼Œ<code>GridFS</code> ä½¿ç”¨ä¸¤ä¸ªé›†åˆï¼ˆ<code>collection</code>ï¼‰å­˜å‚¨æ–‡ä»¶ï¼Œä¸€ä¸ªé›†åˆæ˜¯ <code>chunks</code>, ç”¨äºå­˜å‚¨æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ï¼›ä¸€ä¸ªé›†åˆæ˜¯ <code>files</code>ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ˆæ–‡ä»¶åç§°ã€å—å¤§å°ã€ä¸Šä¼ æ—¶é—´ç­‰ä¿¡æ¯ï¼‰ã€‚</p>
<p>ä» <code>GridFS</code> ä¸­è¯»å–æ–‡ä»¶è¦å¯¹æ–‡ä»¶çš„å„å„å—è¿›è¡Œç»„è£…ã€åˆå¹¶ã€‚<br>è¯¦ç»†å‚è€ƒï¼š<a href="https://docs.mongodb.com/manual/core/gridfs/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/gridfs/</a></p>
<h4 id="GridFS-å­˜å–æ–‡ä»¶æµ‹è¯•"><a href="#GridFS-å­˜å–æ–‡ä»¶æµ‹è¯•" class="headerlink" title="GridFS å­˜å–æ–‡ä»¶æµ‹è¯•"></a>GridFS å­˜å–æ–‡ä»¶æµ‹è¯•</h4><p>1ã€å­˜æ–‡ä»¶</p>
<p>è¿™é‡Œæˆ‘ä»¬åœ¨cmså·¥ç¨‹å†…è¿›è¡Œæµ‹è¯•</p>
<p>ä½¿ç”¨ <code>GridFsTemplate</code> å­˜å‚¨æ–‡ä»¶æµ‹è¯•ä»£ç ï¼š<br>å‘æµ‹è¯•ç¨‹åºæ³¨å…¥ <code>GridFsTemplate</code> ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">GridFsTest</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    GridFsTemplate gridFsTemplate;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGridFs</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> FileNotFoundException </span>&#123;
        <span class="hljs-comment">//è¦å‚¨å­˜çš„æ–‡ä»¶</span>
        File file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"d:/resources/index-banner.ftl"</span>);
        <span class="hljs-comment">//å®šä¹‰è¾“å…¥æµ</span>
        FileInputStream fileInputStream = <span class="hljs-keyword">new</span> FileInputStream(file);
        <span class="hljs-comment">//å‘GridFSå­˜å‚¨æ–‡ä»¶</span>
        ObjectId objectId = gridFsTemplate.store(fileInputStream, <span class="hljs-string">"index-banner"</span>);
        <span class="hljs-comment">//å¾—åˆ°æ–‡ä»¶ID</span>
        String fileId = objectId.toString();
        System.out.println(fileId);

    &#125;
&#125;</code></pre></div>

<p>å‚¨å­˜ç»“æœ</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image18" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image18.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>å­˜å‚¨åŸç†è¯´æ˜ï¼š</strong></p>
<p>æ–‡ä»¶å­˜å‚¨æˆåŠŸå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ <code>id</code><br>æ­¤æ–‡ä»¶ <code>id</code> æ˜¯ <code>fs.files</code> é›†åˆä¸­çš„ä¸»é”®ã€‚<br>å¯ä»¥é€šè¿‡æ–‡ä»¶ <code>id</code> æŸ¥è¯¢ <code>fs.chunks</code> è¡¨ä¸­çš„è®°å½•ï¼Œå¾—åˆ°æ–‡ä»¶çš„å†…å®¹ã€‚</p>
<p>2ã€è¯»å–æ–‡ä»¶</p>
<p>1ï¼‰åœ¨<code>config</code>åŒ…ä¸­å®šä¹‰ <code>Mongodb</code> çš„é…ç½®ç±»ï¼Œå¦‚ä¸‹ï¼š</p>
<p><code>GridFSBucket</code>ç”¨äºæ‰“å¼€ä¸‹è½½æµå¯¹è±¡</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MongoConfig</span> </span>&#123;
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;spring.data.mongodb.database&#125;"</span>)
    String db;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> GridFSBucket <span class="hljs-title">getGridFSBucket</span><span class="hljs-params">(MongoClient mongoClient)</span></span>&#123;
        MongoDatabase database = mongoClient.getDatabase(db);
        GridFSBucket gridFSBucket = GridFSBuckets.create(database);
        <span class="hljs-keyword">return</span> gridFSBucket;
    &#125;
&#125;</code></pre></div>

<p>2ï¼‰æµ‹è¯•ä»£ç å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
GridFSBucket gridFSBucket;

<span class="hljs-comment">//å–æ–‡ä»¶</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queryFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    String fileId = <span class="hljs-string">"5e79e4323304a26aecec55cd"</span>;
    <span class="hljs-comment">//æ ¹æ®IDæŸ¥è¯¢æ–‡ä»¶</span>
    GridFSFile gridFSFile = gridFsTemplate.findOne(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(fileId)));
    <span class="hljs-comment">//æ‰“å¼€ä¸‹è½½æµå¯¹è±¡</span>
    GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(gridFSFile.getObjectId());
    <span class="hljs-comment">//åˆ›å»ºgridFsResourceï¼Œç”¨äºè·å–æµå¯¹è±¡</span>
    GridFsResource gridFsResource = <span class="hljs-keyword">new</span> GridFsResource(gridFSFile, gridFSDownloadStream);
    <span class="hljs-comment">//è·å–æµä¸­çš„æ•°æ®</span>
    String s = IOUtils.toString(gridFsResource.getInputStream(), <span class="hljs-string">"utf-8"</span>);
    System.out.println(s);
&#125;</code></pre></div>

<h4 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åˆ é™¤æ–‡ä»¶</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDelFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
<span class="hljs-comment">//æ ¹æ®æ–‡ä»¶idåˆ é™¤fs.fileså’Œfs.chunksä¸­çš„è®°å½•</span>
gridFsTemplate.delete(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(<span class="hljs-string">"5b32480ed3a022164c4d2f92"</span>)));
&#125;</code></pre></div>

<h3 id="4ã€æ¨¡æ¿å‚¨å­˜"><a href="#4ã€æ¨¡æ¿å‚¨å­˜" class="headerlink" title="4ã€æ¨¡æ¿å‚¨å­˜"></a>4ã€æ¨¡æ¿å‚¨å­˜</h3><p>æ ¹æ®æ¨¡æ¿ç®¡ç†çš„æµç¨‹ï¼Œæœ€ç»ˆå°†æ¨¡æ¿ä¿¡æ¯å­˜å‚¨åˆ° <code>MongoDB</code> çš„ <code>cms_template</code> ä¸­ï¼Œå°†æ¨¡æ¿æ–‡ä»¶å­˜å‚¨åˆ° <code>GridFS</code>ä¸­ã€‚æ¨¡æ¿ç®¡ç†åŠŸèƒ½åœ¨è¯¾å ‚ä¸­ä¸å†è®²è§£ï¼Œæ•™å­¦ä¸­æ‰‹åŠ¨å‘ <code>cms_template</code> åŠ <code>GridFS</code> ä¸­å­˜å‚¨æ¨¡æ¿ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<h4 id="1ï¼‰æ·»åŠ æ¨¡æ¿"><a href="#1ï¼‰æ·»åŠ æ¨¡æ¿" class="headerlink" title="1ï¼‰æ·»åŠ æ¨¡æ¿"></a>1ï¼‰æ·»åŠ æ¨¡æ¿</h4><p>ä½¿ç”¨ <code>GridFS</code> æµ‹è¯•ä»£ç å­˜å‚¨æ¨¡æ¿æ–‡ä»¶åˆ° <code>GridFS</code>ï¼Œå¹¶å¾—åˆ°æ–‡ä»¶æ¨¡æ¿ <code>id</code>ï¼Œå‘ <code>cms_template</code> æ·»åŠ è®°å½•</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image19" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image19.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="2ï¼‰åˆ é™¤æ¨¡æ¿"><a href="#2ï¼‰åˆ é™¤æ¨¡æ¿" class="headerlink" title="2ï¼‰åˆ é™¤æ¨¡æ¿"></a>2ï¼‰åˆ é™¤æ¨¡æ¿</h4><p>ä½¿ç”¨ <code>GridFS</code> æµ‹è¯•ä»£ç æ ¹æ®æ–‡ä»¶idåˆ é™¤æ¨¡æ¿æ–‡ä»¶ã€‚</p>
<p>æ ¹æ®æ¨¡æ¿idåˆ é™¤ <code>cms_template</code> ä¸­çš„è®°å½•ã€‚</p>
<h4 id="3ï¼‰ä¿®æ”¹æ¨¡æ¿ä¿¡æ¯"><a href="#3ï¼‰ä¿®æ”¹æ¨¡æ¿ä¿¡æ¯" class="headerlink" title="3ï¼‰ä¿®æ”¹æ¨¡æ¿ä¿¡æ¯"></a>3ï¼‰ä¿®æ”¹æ¨¡æ¿ä¿¡æ¯</h4><p>ä½¿ç”¨Studio 3Tä¿®æ”¹ <code>cms_template</code> ä¸­çš„è®°å½•ã€‚</p>
<h4 id="4ï¼‰ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶"><a href="#4ï¼‰ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶" class="headerlink" title="4ï¼‰ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶"></a>4ï¼‰ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶</h4><p>1ï¼‰é€šè¿‡Studio 3Tä¿®æ”¹æ¨¡æ¿æ–‡ä»¶(æ­¤æ–¹æ³•é™æ–‡ä»¶å°äº256K)å¯ä»¥é€šè¿‡Studio 3Tä¿®æ”¹æ¨¡æ¿æ–‡ä»¶ï¼Œå…ˆæ‰¾åˆ°æ¨¡æ¿æ–‡ä»¶ï¼Œå†å¯¼å…¥è¿›å»ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image20" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image20.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="4-é™æ€åŒ–æµ‹è¯•"><a href="#4-é™æ€åŒ–æµ‹è¯•" class="headerlink" title="4. é™æ€åŒ–æµ‹è¯•"></a>4. é™æ€åŒ–æµ‹è¯•</h2><h3 id="1ã€å¡«å†™é¡µé¢-DataUrl"><a href="#1ã€å¡«å†™é¡µé¢-DataUrl" class="headerlink" title="1ã€å¡«å†™é¡µé¢ DataUrl"></a>1ã€å¡«å†™é¡µé¢ DataUrl</h3><p>ä¿®æ”¹é¡µé¢ç®¡ç†æ¨¡æ¿ä»£ç ï¼Œå®ç°ç¼–è¾‘é¡µé¢DataUrlã€‚<br>æ³¨æ„ï¼šæ­¤åœ°å€ç”±ç¨‹åºå‘˜æä¾›ç»™ç³»ç»Ÿç®¡ç†å‘˜ï¼Œç”±ç³»ç»Ÿç®¡ç†å‘˜å½•å…¥åˆ°ç³»ç»Ÿä¸­ã€‚</p>
<p><strong>ä¿®æ”¹é¡µé¢ç®¡ç†å‰ç«¯çš„ page_edit.vue</strong></p>
<p>åœ¨è¡¨å•ä¸­æ·»åŠ  <code>dataUrl</code> è¾“å…¥æ¡†ï¼š</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"æ•°æ®Url"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"dataUrl"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"pageForm.dataUrl"</span> <span class="hljs-attr">auto-complete</span>=<span class="hljs-string">"off"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></code></pre></div>

<p><code>fromData</code> è¡¨å•å†…æ·»åŠ  <code>dataUrl</code> å­—æ®µ</p>
<p><strong>ä¿®æ”¹é¡µé¢ç®¡ç†æœåŠ¡ç«¯ PageService</strong></p>
<p>åœ¨ <code>PageService.updateCmsPage</code> æ›´æ–° <code>cmsPage</code> æ•°æ®ä»£ç ä¸­æ·»åŠ ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ›´æ–°dataUrl</span>
one.setDataUrl(cmsPage.getDataUrl());</code></pre></div>

<p><strong>æ–°å¢é¡µé¢ä¹Ÿé‡å¤ä¸Šé¢çš„æ“ä½œï¼Œæ–°å¢ dataUrl çš„è¡¨å•</strong></p>
<h3 id="2ã€é™æ€åŒ–ç¨‹åº"><a href="#2ã€é™æ€åŒ–ç¨‹åº" class="headerlink" title="2ã€é™æ€åŒ–ç¨‹åº"></a>2ã€é™æ€åŒ–ç¨‹åº</h3><p>åœ¨ <code>model.response.cmscode</code> ä¸‹æ–°å¢ä¸€äº›é”™è¯¯ä»£ç </p>
<div class="hljs"><pre><code class="hljs java">CMS_PAGE_NOT_EXISTS(<span class="hljs-keyword">false</span>,<span class="hljs-number">24002</span>,<span class="hljs-string">"é¡µé¢ä¸å­˜åœ¨ï¼"</span>),
CMS_GENRATEHTML_DATAURL_IS_NULL(<span class="hljs-keyword">false</span>,<span class="hljs-number">24003</span>,<span class="hljs-string">"ä»é¡µé¢ä¿¡æ¯ä¸­æ‰¾ä¸åˆ°è·å–æ•°æ®çš„url"</span>),
CMS_GENRATEHTML_DATA_IS_NULL(<span class="hljs-keyword">false</span>,<span class="hljs-number">24004</span>,<span class="hljs-string">"æ ¹æ®é¡µé¢çš„æ•°æ®urlè·å–ä¸åˆ°æ•°æ®"</span>),
CMS_GENRATEHTML_TEMPLATE_IS_NULL(<span class="hljs-keyword">false</span>,<span class="hljs-number">24005</span>,<span class="hljs-string">"é¡µé¢æ¨¡æ¿ä¸ºç©º"</span>),
CMS_GENRATEHTML_HTML_IS_NULL(<span class="hljs-keyword">false</span>,<span class="hljs-number">24006</span>,<span class="hljs-string">"ç”Ÿæˆçš„é™æ€htmlä¸ºç©º"</span>),
CMS_GENRATEHTML_SAVE_HTML_ERROR(<span class="hljs-keyword">false</span>,<span class="hljs-number">24007</span>,<span class="hljs-string">"ä¿å­˜é™æ€htmlå‡ºé”™"</span>),
CMS_GENRATEHTML_PERVIEW_IS_NULL(<span class="hljs-keyword">false</span>,<span class="hljs-number">24008</span>,<span class="hljs-string">"é¢„è§ˆé¡µé¢ä¸ºç©º"</span>);</code></pre></div>

<h4 id="è·å–æ•°æ®æ¨¡å‹"><a href="#è·å–æ•°æ®æ¨¡å‹" class="headerlink" title="è·å–æ•°æ®æ¨¡å‹"></a>è·å–æ•°æ®æ¨¡å‹</h4><blockquote>
<p>é™æ€åŒ–ç¨‹åºè¿œç¨‹è¯·æ±‚DataUrlå¾—åˆ°æ•°æ®æ¨¡å‹</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
RestTemplate restTemplate;

<span class="hljs-comment">//ä»dataUrlä¸­è·å–é¡µé¢æ¨¡å‹æ•°æ®</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> Map <span class="hljs-title">getModelByPageId</span><span class="hljs-params">(String pageId)</span></span>&#123;
    <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>
    CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.cmsPageQueryById(pageId);
    CmsPage cmsPage = cmsPageResult.getCmsPage();
    <span class="hljs-comment">//é¡µé¢ä¸å­˜åœ¨</span>
    <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;
        ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);
    &#125;
    <span class="hljs-comment">//å–å‡ºdataUrl</span>
    String dataUrl = cmsPage.getDataUrl();
    <span class="hljs-keyword">if</span>(StringUtils.isEmpty(dataUrl))&#123;
        ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_DATAURL_IS_NULL);
    &#125;
    <span class="hljs-comment">//å‘é€è¯·æ±‚è·å–æ¨¡å‹æ•°æ®</span>
    ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(dataUrl,Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    Map body = forEntity.getBody();
    <span class="hljs-keyword">return</span> body;
&#125;</code></pre></div>

<h4 id="è·å–é¡µé¢æ¨¡æ¿"><a href="#è·å–é¡µé¢æ¨¡æ¿" class="headerlink" title="è·å–é¡µé¢æ¨¡æ¿"></a>è·å–é¡µé¢æ¨¡æ¿</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
CmsTemplateRepository templateRepository;

<span class="hljs-meta">@Autowired</span>
GridFsTemplate gridFsTemplate;

<span class="hljs-meta">@Autowired</span>
GridFSBucket gridFSBucket;

<span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿æ•°æ®</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getTemplateByPageId</span><span class="hljs-params">(String pageId)</span></span>&#123;
    <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>
    CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.cmsPageQueryById(pageId);
    CmsPage cmsPage = cmsPageResult.getCmsPage();
    <span class="hljs-comment">//é¡µé¢ä¸å­˜åœ¨</span>
    <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;
        ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);
    &#125;
    <span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿</span>
    String templateId = cmsPage.getTemplateId();
    <span class="hljs-keyword">if</span>(StringUtils.isEmpty(templateId))&#123;
        ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_TEMPLATE_IS_NULL);
    &#125;
    Optional&lt;CmsTemplate&gt; optional = templateRepository.findById(templateId);
    <span class="hljs-keyword">if</span>(optional.isPresent())&#123;
        CmsTemplate cmsTemplate = optional.get();
        <span class="hljs-comment">//è·å–æ¨¡æ¿æ–‡ä»¶id</span>
        String templateFileId = cmsTemplate.getTemplateFileId();
        <span class="hljs-comment">//å–å‡ºæ¨¡æ¿æ–‡ä»¶å†…å®¹</span>
        GridFSFile gridFSFile = gridFsTemplate.findOne(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(templateFileId)));
        <span class="hljs-comment">//æ‰“å¼€ä¸‹è½½æµå¯¹è±¡</span>
        GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(gridFSFile.getObjectId());
        <span class="hljs-comment">//åˆ›å»ºGridResource</span>
        GridFsResource gridFsResource = <span class="hljs-keyword">new</span> GridFsResource(gridFSFile, gridFSDownloadStream);

        <span class="hljs-keyword">try</span> &#123;
            String content = IOUtils.toString(gridFsResource.getInputStream(), <span class="hljs-string">"utfâ€8"</span>);
            <span class="hljs-keyword">return</span> content;
        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
            e.printStackTrace();
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
&#125;</code></pre></div>

<h4 id="æ‰§è¡Œé¡µé¢é™æ€åŒ–"><a href="#æ‰§è¡Œé¡µé¢é™æ€åŒ–" class="headerlink" title="æ‰§è¡Œé¡µé¢é™æ€åŒ–"></a>æ‰§è¡Œé¡µé¢é™æ€åŒ–</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">     * é¡µé¢é™æ€åŒ–</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageId</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> TemplateException</span>
<span class="hljs-comment">     */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPageHtml</span><span class="hljs-params">(String pageId)</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;
    <span class="hljs-comment">//è·å–é¡µé¢æ¨¡å‹æ•°æ®</span>
    Map modelByPageId = <span class="hljs-keyword">this</span>.getModelByPageId(pageId);
    <span class="hljs-keyword">if</span>(modelByPageId == <span class="hljs-keyword">null</span>)&#123;
        <span class="hljs-comment">//è·å–é¡µé¢æ¨¡å‹æ•°æ®ä¸ºç©º</span>
        ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_DATA_IS_NULL);
    &#125;
    <span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿</span>
    String templateContent = getTemplateByPageId(pageId);
    <span class="hljs-keyword">if</span>(StringUtils.isEmpty(templateContent))&#123;
        <span class="hljs-comment">//é¡µé¢æ¨¡æ¿ä¸ºç©º</span>
        ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_TEMPLATE_IS_NULL);
    &#125;
    <span class="hljs-comment">//è·å–é¡µé¢é™æ€åŒ–æ•°æ®</span>
    String html = generateHtml(templateContent, modelByPageId);
    <span class="hljs-keyword">if</span>(StringUtils.isEmpty(html))&#123;
        ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_HTML_IS_NULL);
    &#125;
    <span class="hljs-keyword">return</span> html;
&#125;

<span class="hljs-comment">//æ„å»ºé™æ€åŒ–é¡µé¢æ•°æ®</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">generateHtml</span><span class="hljs-params">(String template,Map model)</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;
    <span class="hljs-comment">//ç”Ÿæˆé…ç½®ç±»</span>
    Configuration configuration = <span class="hljs-keyword">new</span> Configuration(Configuration.getVersion());
    <span class="hljs-comment">//æ¨¡æ¿åŠ è½½å™¨</span>
    StringTemplateLoader stringTemplateLoader = <span class="hljs-keyword">new</span> StringTemplateLoader();
    stringTemplateLoader.putTemplate(<span class="hljs-string">"template"</span>,template);
    <span class="hljs-comment">//é…ç½®æ¨¡æ¿åŠ è½½å™¨</span>
    configuration.setTemplateLoader(stringTemplateLoader);

    <span class="hljs-comment">//è·å–æ¨¡æ¿</span>
    Template template1 = configuration.getTemplate(<span class="hljs-string">"template"</span>);
    String html = FreeMarkerTemplateUtils.processTemplateIntoString(template1, model);
    <span class="hljs-keyword">return</span> html;
&#125;</code></pre></div>

<p>è°ƒç”¨é€»è¾‘</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image21" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image21.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="åˆ›å»ºæµ‹è¯•çš„é¡µé¢"><a href="#åˆ›å»ºæµ‹è¯•çš„é¡µé¢" class="headerlink" title="åˆ›å»ºæµ‹è¯•çš„é¡µé¢"></a>åˆ›å»ºæµ‹è¯•çš„é¡µé¢</h4><blockquote>
<p>åŸè®²ä¹‰ä¸­è¯¥æ­¥éª¤æ˜¯çœç•¥çš„</p>
</blockquote>
<p>ä¸ºäº†æ›´æ¸…æ™°çš„äº†è§£é¡µé¢é™æ€åŒ–çš„é€»è¾‘ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªé¡µé¢æ¥è¿›è¡Œæµ‹è¯•ï¼›</p>
<p>åœ¨<code>GridFS</code> çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨å•å…ƒæµ‹è¯•ä¸­å°† <code>index-banner.ftl</code> æ–‡ä»¶çš„å†…å®¹å‚¨å­˜åˆ°äº† <code>GridFS</code> å¾—åˆ°ä¸€ä¸ª <code>fileId</code> ï¼Œæˆ‘è¿™é‡Œçš„æ˜¯ <code>5e7a20fc3304a25230861f4c</code> ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ª<code>fileId</code> åœ¨ mongoDB çš„ <code>cms_tempalte</code> é›†åˆä¸­æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªé¡µé¢æ¨¡æ¿ï¼Œåˆ›å»ºæˆåŠŸåæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹çš„æ•°æ®</p>
<div class="hljs"><pre><code class="hljs json">&#123; 
    <span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5e7a2212b1afec2187ed89ac"</span>), 
    <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsTemplate"</span>, 
    <span class="hljs-attr">"siteId"</span> : <span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>, 
    <span class="hljs-attr">"templateName"</span> : <span class="hljs-string">"è½®æ’­å›¾_æµ‹è¯•"</span>, 
    <span class="hljs-attr">"templateParameter"</span> : <span class="hljs-string">""</span>, 
    <span class="hljs-attr">"templateFileId"</span> : <span class="hljs-string">"5e7a20fc3304a25230861f4c"</span>
&#125;</code></pre></div>

<p>ç„¶åè¿›å…¥åˆ°æˆ‘ä»¬ä¹‹å‰æ„å»ºçš„æ–°å¢é¡µé¢é€‰é¡¹ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„é¡µé¢ï¼›</p>
<p>å¡«å…¥ dataUrl <code>http://localhost:31001/cms/config/getmodel/5a791725dd573c3574ee333f</code></p>
<p><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image22.png" srcset="/img/loading.gif" alt="img"></p>
<p>å¾—åˆ°è¯¥é¡µé¢çš„idä¸º <code>5e7a251a3304a252280804dc</code></p>
<h4 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestPageService</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    PageService pageService;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGetPageHtml</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;
        String pageHtml = pageService.getPageHtml(<span class="hljs-string">"5e7a251a3304a252280804dc"</span>);
        System.out.println(pageHtml);
    &#125;
&#125;</code></pre></div>

<h1 id="å››ã€é¡µé¢é¢„è§ˆ"><a href="#å››ã€é¡µé¢é¢„è§ˆ" class="headerlink" title="å››ã€é¡µé¢é¢„è§ˆ"></a>å››ã€é¡µé¢é¢„è§ˆ</h1><h2 id="1ã€é¡µé¢é¢„è§ˆå¼€å‘"><a href="#1ã€é¡µé¢é¢„è§ˆå¼€å‘" class="headerlink" title="1ã€é¡µé¢é¢„è§ˆå¼€å‘"></a>1ã€é¡µé¢é¢„è§ˆå¼€å‘</h2><h3 id="éœ€æ±‚åˆ†æ-1"><a href="#éœ€æ±‚åˆ†æ-1" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>é¡µé¢åœ¨å‘å¸ƒå‰å¢åŠ é¡µé¢é¢„è§ˆçš„æ­¥éª¤ï¼Œæ–¹ä¾¿ç”¨æˆ·æ£€æŸ¥é¡µé¢å†…å®¹æ˜¯å¦æ­£ç¡®ã€‚é¡µé¢é¢„è§ˆçš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image23" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image23.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1ã€ç”¨æˆ·è¿›å…¥ <code>cms</code> å‰ç«¯ï¼Œç‚¹å‡» â€œ<strong>é¡µé¢é¢„è§ˆ</strong>â€ åœ¨æµè§ˆå™¨è¯·æ±‚ <strong>cms</strong> é¡µé¢é¢„è§ˆé“¾æ¥ã€‚</p>
<p>2ã€<strong>cms</strong> æ ¹æ®é¡µé¢ <code>id</code> æŸ¥è¯¢<code>DataUrl</code>å¹¶è¿œç¨‹è¯·æ±‚DataUrlè·å–æ•°æ®æ¨¡å‹ã€‚</p>
<p>3ã€<strong>cms</strong> æ ¹æ®é¡µé¢idæŸ¥è¯¢é¡µé¢æ¨¡æ¿å†…å®¹</p>
<p>4ã€<strong>cms</strong> æ‰§è¡Œé¡µé¢é™æ€åŒ–ã€‚</p>
<h3 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h3><p>åœ¨cmsæœåŠ¡éœ€è¦é›†æˆfreemarkerï¼š</p>
<p>1ã€åœ¨CMSæœåŠ¡ä¸­åŠ å…¥freemarkerçš„ä¾èµ–</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--freemarker--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p>2ã€åœ¨application.ymlé…ç½®freemarker</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">31001</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">xc-service-manage-cms</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">mongodb:</span>
      <span class="hljs-attr">uri:</span> <span class="hljs-string">mongodb://root:123123@localhost:27017</span>
      <span class="hljs-attr">database:</span> <span class="hljs-string">xc_cms</span>
  <span class="hljs-attr">freemarker:</span>
    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#å…³é—­æ¨¡æ¿ç¼“å­˜ï¼Œæ–¹ä¾¿æµ‹è¯•</span>
    <span class="hljs-attr">settings:</span>
      <span class="hljs-attr">template_update_delay:</span> <span class="hljs-number">0</span></code></pre></div>

<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>é™æ€åŒ–æ–¹æ³•åœ¨é™æ€åŒ–æµ‹è¯•ç« èŠ‚å·²ç»å®ç°</p>
<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><p>è°ƒç”¨ <code>service</code> çš„é™æ€åŒ–æ–¹æ³•ï¼Œå°†é™æ€åŒ–å†…å®¹é€šè¿‡ <code>response</code> è¾“å‡ºåˆ°æµè§ˆå™¨æ˜¾ç¤º</p>
<p>åˆ›å»º <code>CmsPagePreviewController</code> ç±»ï¼Œç”¨äºé¡µé¢é¢„è§ˆï¼š</p>
<p>è¯·æ±‚é¡µé¢idï¼ŒæŸ¥è¯¢å¾—åˆ°é¡µé¢çš„æ¨¡æ¿ä¿¡æ¯ã€æ•°æ®æ¨¡å‹ <code>url</code>ï¼Œæ ¹æ®æ¨¡æ¿å’Œæ•°æ®ç”Ÿæˆé™æ€åŒ–å†…å®¹ï¼Œå¹¶è¾“å‡ºåˆ°æµè§ˆå™¨ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPagePreviewController</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseController</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    PageService pageService;

    <span class="hljs-comment">//æ¥æ”¶åˆ°é¡µé¢id</span>
    <span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/cms/preview/&#123;pageId&#125;"</span>, method = RequestMethod.GET)
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">preView</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"pageId"</span>)</span> String pageId) <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;
        String pageHtml = pageService.getPageHtml(pageId);
        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(pageHtml))&#123;
            <span class="hljs-keyword">try</span> &#123;
                <span class="hljs-comment">//é€šè¿‡responseå¯¹è±¡å°†é¡µé¢å†…å®¹è¾“å‡º</span>
                ServletOutputStream outputStream = response.getOutputStream();
                outputStream.write(pageHtml.getBytes(<span class="hljs-string">"utf-8"</span>));
            &#125; <span class="hljs-keyword">catch</span> (IOException e)&#123;
                e.printStackTrace();
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div>

<h2 id="2ã€é¡µé¢é¢„è§ˆæµ‹è¯•"><a href="#2ã€é¡µé¢é¢„è§ˆæµ‹è¯•" class="headerlink" title="2ã€é¡µé¢é¢„è§ˆæµ‹è¯•"></a>2ã€é¡µé¢é¢„è§ˆæµ‹è¯•</h2><h3 id="é…ç½®nginxä»£ç†"><a href="#é…ç½®nginxä»£ç†" class="headerlink" title="é…ç½®nginxä»£ç†"></a>é…ç½®nginxä»£ç†</h3><blockquote>
<p>è¿™é‡Œè¯´ä¸€ä¸‹æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦é€šè¿‡nginxä»£ç†æ¥é…ç½®é¡µé¢é¢„è§ˆï¼Œå› ä¸ºåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬çš„cmsèŠ‚ç‚¹å¯èƒ½ä¼šæœ‰å¤šä¸ªï¼Œéœ€è¦ä»nginxè¿›è¡Œåå‘ä»£ç†ï¼Œå®ç°è´Ÿè½½å‡è¡¡çš„ç­‰éœ€æ±‚ã€‚</p>
</blockquote>
<p>ä¸ºäº†é€šè¿‡ <code>nginx</code> è¯·æ±‚é™æ€èµ„æºï¼ˆ<code>css</code>ã€å›¾ç‰‡ç­‰ï¼‰ï¼Œé€šè¿‡ <code>nginx</code> ä»£ç†è¿›è¡Œé¡µé¢é¢„è§ˆã€‚</p>
<p>åœ¨<a href="http://www.xuecheng.xn--com:-2h5f960ibngim6ct9m7zz/">www.xuecheng.comè™šæ‹Ÿä¸»æœºé…ç½®ï¼š</a></p>
<div class="hljs"><pre><code class="hljs c">#é¡µé¢é¢„è§ˆ
location /cms/preview/ &#123;
	proxy_pass http:<span class="hljs-comment">//cms_server_pool/cms/preview/;</span>
&#125;</code></pre></div>

<p>é…ç½® <code>cms_server_pool</code> å°†è¯·æ±‚è½¬å‘åˆ° <code>cms</code>ï¼š</p>
<div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#cmsé¡µé¢é¢„è§ˆ</span>
upstream cms_server_pool&#123;
	server <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">31001</span> weight=<span class="hljs-number">10</span>;
&#125;</code></pre></div>

<p>å…¨éƒ¨é…ç½®</p>
<div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#cmsé¡µé¢é¢„è§ˆ</span>
upstream cms_server_pool&#123;
	server <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">31001</span> weight=<span class="hljs-number">10</span>;
&#125;
server&#123;
	<span class="hljs-built_in">listen</span>       <span class="hljs-number">80</span>;
	server_name  www.xuecheng.com;
	ssi on;
	ssi_silent_errors on;
	location / &#123;
		alias  C:/Users/root/Desktop/ç¬”è®°/demos/JavaEE/å¾®æœåŠ¡/Project/XueChengOnline/xcEduUI01/xc-ui-pc-<span class="hljs-keyword">static</span>-portal/;
		index  index.html;
	&#125;
	#é¡µé¢é¢„è§ˆ
	location /cms/preview/ &#123;
		proxy_pass http:<span class="hljs-comment">//cms_server_pool/cms/preview/;</span>
	&#125;
&#125;</code></pre></div>

<p>é‡æ–°åŠ è½½nginx é…ç½®æ–‡ä»¶ã€‚<br>ä»cms_pageæ‰¾ä¸€ä¸ªé¡µé¢è¿›è¡Œæµ‹è¯•ã€‚æ³¨æ„ï¼šé¡µé¢é…ç½®ä¸€å®šè¦æ­£ç¡®ï¼Œéœ€è®¾ç½®æ­£ç¡®çš„æ¨¡æ¿ <code>id</code> å’Œ<code>dataUrl</code>ã€‚</p>
<p>åœ¨æµè§ˆå™¨æ‰“å¼€ï¼š<a href="http://www.xuecheng.com/cms/preview/5e7a251a3304a252280804dc" target="_blank" rel="noopener">http://www.xuecheng.com/cms/preview/5e7a251a3304a252280804dc</a></p>
<p>5e7a251a3304a252280804dcï¼šè½®æ’­å›¾é¡µé¢çš„id ï¼ˆæ ¹æ®è‡ªå·±å®é™…ç”¨äºæµ‹è¯•çš„é¡µé¢IDï¼‰</p>
<p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image24" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image24.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="æ·»åŠ -â€œé¡µé¢é¢„è§ˆâ€-é“¾æ¥"><a href="#æ·»åŠ -â€œé¡µé¢é¢„è§ˆâ€-é“¾æ¥" class="headerlink" title="æ·»åŠ  â€œé¡µé¢é¢„è§ˆâ€ é“¾æ¥"></a>æ·»åŠ  â€œé¡µé¢é¢„è§ˆâ€ é“¾æ¥</h3><p>æ·»åŠ é¢„è§ˆæŒ‰é’®</p>
<div class="hljs"><pre><code class="hljs java"> &lt;el-table-column label=<span class="hljs-string">"æ“ä½œ"</span> width=<span class="hljs-string">"230"</span> fixed=<span class="hljs-string">"right"</span>&gt;
    &lt;template slot-scope=<span class="hljs-string">"scope"</span>&gt;
        &lt;el-button
        size=<span class="hljs-string">"mini"</span>
        type=<span class="hljs-string">"success"</span>
        <span class="hljs-meta">@click</span>=<span class="hljs-string">"preview(scope.row.pageId)"</span>&gt;é¢„è§ˆ
        &lt;/el-button&gt;
    &lt;/template&gt;
&lt;/el-table-column&gt;</code></pre></div>

<p>é¢„è§ˆå‡½æ•°</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//é¡µé¢é¢„è§ˆ</span>
preview(pageId)&#123;
  <span class="hljs-built_in">window</span>.open(<span class="hljs-string">"http://www.xuecheng.com/cms/preview/"</span>+pageId)
&#125;,</code></pre></div>

<p>æµ‹è¯•</p>
<p><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image25.gif" srcset="/img/loading.gif" alt="img"></p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">å­¦æˆåœ¨çº¿</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Freemarker/">Freemarker</a>
                    
                      <a class="hover-with-bg" href="/tags/GridFS/">GridFS</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day05ï¼šæ¶ˆæ¯ä¸­é—´ä»¶RabbitMQ</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/">
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day03ï¼šCMSé¡µé¢ç®¡ç†å¼€å‘</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

ä»£ç å—js ç”¨ä¸åˆ°ï¼Œfulidè‡ªå¸¦æœ‰ï¼Œæ·»åŠ cssæ ·å¼å³å¯å®ç°
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®å­—</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å·²ç»å‹‰å¼ºè¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">äº¬ICPè¯20000725å·</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=20000725"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>äº¬å…¬ç½‘å®‰å¤‡20000725å·</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "å­¦æˆåœ¨çº¿day04ï¼šé¡µé¢é™æ€åŒ–&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
