<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>å­¦æˆåœ¨çº¿day09ï¼šEurekaã€Feignã€è¯¾ç¨‹é¢„è§ˆå®ç° - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ç§äººåšå®¢</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äºæˆ‘
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-16 21:06">
      2020-08-16
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      9.4k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      102
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p>
</blockquote>
<p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day09</code> çš„å†…å®¹</p>
<ul>
<li>æ„å»ºåŸºäº <code>Eureka</code> çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒ</li>
<li><code>Ribbon</code> çš„åŸºæœ¬ä½¿ç”¨ï¼Œä»¥åŠä½¿ç”¨ <code>Ribbon</code> æ¥è¿›è¡ŒæœåŠ¡é—´çš„è´Ÿè½½å‡è¡¡è°ƒç”¨</li>
<li>ä½¿ç”¨ <code>Feign</code> å®ç°æœåŠ¡ä¹‹é—´çš„è¿œç¨‹è°ƒç”¨</li>
<li>è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¼€å‘</li>
</ul>
<h1 id="ä¸€ã€Eureka-æ³¨å†Œä¸­å¿ƒ"><a href="#ä¸€ã€Eureka-æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="ä¸€ã€Eureka æ³¨å†Œä¸­å¿ƒ"></a>ä¸€ã€Eureka æ³¨å†Œä¸­å¿ƒ</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åœ¨å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼ŒæœåŠ¡å±‚è¢«æ‹†åˆ†æˆäº†å¾ˆå¤šçš„å¾®æœåŠ¡ï¼Œå¾®æœåŠ¡çš„ä¿¡æ¯å¦‚ä½•ç®¡ç†ï¼ŸSpring Cloudä¸­æä¾›æœåŠ¡æ³¨å†Œä¸­å¿ƒæ¥ç®¡ç†å¾®æœåŠ¡ä¿¡æ¯ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆ è¦ç”¨æ³¨å†Œä¸­å¿ƒï¼Ÿ</strong></p>
<p>1ã€å¾®æœåŠ¡æ•°é‡ä¼—å¤šï¼Œè¦è¿›è¡Œè¿œç¨‹è°ƒç”¨å°±éœ€è¦çŸ¥é“æœåŠ¡ç«¯çš„ <code>ip</code> åœ°å€å’Œç«¯å£ï¼Œæ³¨å†Œä¸­å¿ƒå¸®åŠ©æˆ‘ä»¬ç®¡ç†è¿™äº›æœåŠ¡çš„ <code>ip</code> å’Œç«¯å£ã€‚</p>
<p>2ã€å¾®æœåŠ¡ä¼šå®æ—¶ä¸ŠæŠ¥è‡ªå·±çš„çŠ¶æ€ï¼Œæ³¨å†Œä¸­å¿ƒç»Ÿä¸€ç®¡ç†è¿™äº›å¾®æœåŠ¡çš„çŠ¶æ€ï¼Œå°†å­˜åœ¨é—®é¢˜çš„æœåŠ¡è¸¢å‡ºæœåŠ¡åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯è·å–åˆ°å¯ç”¨çš„æœåŠ¡è¿›è¡Œè°ƒç”¨ã€‚</p>
<h2 id="2-Eurekaä»‹ç»"><a href="#2-Eurekaä»‹ç»" class="headerlink" title="2. Eurekaä»‹ç»"></a>2. Eurekaä»‹ç»</h2><p><code>Spring Cloud Eureka</code> æ˜¯å¯¹ <code>Netflix</code> å…¬å¸çš„ <code>Eureka</code> çš„äºŒæ¬¡å°è£…ï¼Œå®ƒå®ç°äº†æœåŠ¡æ²»ç†çš„åŠŸèƒ½ï¼Œ<code>Spring Cloud Eureka</code> æä¾›æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯å³æ˜¯ <code>Eureka</code> æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå®¢æˆ·ç«¯å®Œæˆå¾®æœåŠ¡å‘ <code>Eureka</code> æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å‡é‡‡ç”¨Javaè¯­è¨€ç¼–å†™ã€‚ä¸‹å›¾æ˜¾ç¤ºäº† <code>Eureka Server</code> ä¸ <code>Eureka Client</code> çš„å…³ç³»ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image1" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image1.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1ã€<code>Eureka Server</code> æ˜¯æœåŠ¡ç«¯ï¼Œè´Ÿè´£ç®¡ç†å„å„å¾®æœåŠ¡ç»“ç‚¹çš„ä¿¡æ¯å’ŒçŠ¶æ€ã€‚</p>
<p>2 ã€åœ¨å¾®æœåŠ¡ä¸Šéƒ¨ç½² <code>Eureka Client</code> ç¨‹åºï¼Œè¿œç¨‹è®¿é—® <code>Eureka Server</code> å°†è‡ªå·±æ³¨å†Œåœ¨ <code>Eureka Server</code>ã€‚</p>
<p>3ã€å¾®æœåŠ¡éœ€è¦è°ƒç”¨å¦ä¸€ä¸ªå¾®æœåŠ¡æ—¶ä» <code>Eureka Server</code> ä¸­è·å–æœåŠ¡è°ƒç”¨åœ°å€ï¼Œè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚</p>
<h2 id="3-Eureka-Serveræ­å»º"><a href="#3-Eureka-Serveræ­å»º" class="headerlink" title="3. Eureka Serveræ­å»º"></a>3. Eureka Serveræ­å»º</h2><h3 id="1ã€å•æœºç¯å¢ƒæ­å»º"><a href="#1ã€å•æœºç¯å¢ƒæ­å»º" class="headerlink" title="1ã€å•æœºç¯å¢ƒæ­å»º"></a>1ã€å•æœºç¯å¢ƒæ­å»º</h3><p><strong>1ï¼‰åˆ›å»º xc-govern-center å·¥ç¨‹ï¼š</strong></p>
<p>åŒ…ç»“æ„ï¼šcom.xuecheng.govern.center</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image2" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image2.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>2ï¼‰æ·»åŠ ä¾èµ–</strong></p>
<p>åœ¨çˆ¶å·¥ç¨‹æ·»åŠ ï¼šï¼ˆæœ‰äº†åˆ™ä¸ç”¨é‡å¤æ·»åŠ ï¼‰</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div>

<p><strong>3ï¼‰å¯åŠ¨ç±»</strong></p>
<div class="hljs"><pre><code class="hljs javascript">package com.xuecheng.govern.center;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="hljs-keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

@EnableEurekaServer  <span class="hljs-comment">//æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªEurekaServer</span>
@SpringBootApplication
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GorvernCenterApplication</span> </span>&#123;
    public <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(<span class="hljs-built_in">String</span>[] args) &#123;
        SpringApplication.run(GorvernCenterApplication.class,args);
    &#125;
&#125;</code></pre></div>

<blockquote>
<p>éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šç”¨ <code>@EnableEurekaServer</code> æ ‡è¯†æ­¤æœåŠ¡ä¸ºEurekaæœåŠ¡</p>
</blockquote>
<p><strong>4ï¼‰é…ç½®æ–‡ä»¶</strong></p>
<p>ä»å…¶å®ƒæœåŠ¡æ‹·è´ <code>application.yml</code> å’Œ <code>logback-spring.xml</code>ã€‚</p>
<p>application.yml çš„é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
 <span class="hljs-attr">port:</span> <span class="hljs-number">50101</span> <span class="hljs-comment">#æœåŠ¡ç«¯å£</span>
<span class="hljs-attr">spring:</span>
 <span class="hljs-attr">application:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">xc-govern-center</span> <span class="hljs-comment">#æŒ‡å®šæœåŠ¡å</span>
<span class="hljs-attr">eureka:</span>
 <span class="hljs-attr">client:</span>
  <span class="hljs-attr">registerWithEureka:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œï¼Œæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°EurekaæœåŠ¡ä¸­</span>
  <span class="hljs-attr">fetchRegistry:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æœåŠ¡å‘ç°ï¼Œæ˜¯å¦ä»Eurekaä¸­è·å–æ³¨å†Œä¿¡æ¯</span>
  <span class="hljs-attr">serviceUrl:</span> <span class="hljs-comment">#Eurekaå®¢æˆ·ç«¯ä¸EurekaæœåŠ¡ç«¯çš„äº¤äº’åœ°å€ï¼Œé«˜å¯ç”¨çŠ¶æ€é…ç½®å¯¹æ–¹çš„åœ°å€ï¼Œå•æœºçŠ¶æ€é…ç½®è‡ªå·±ï¼ˆå¦‚æœä¸é…ç½®åˆ™é»˜è®¤æœ¬æœº8761ç«¯å£ï¼‰</span>
   <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:50101/eureka/</span>
 <span class="hljs-attr">server:</span>
  <span class="hljs-attr">enable-self-preservation:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æ˜¯å¦å¼€å¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</span>
  <span class="hljs-attr">eviction-interval-timer-in-ms:</span> <span class="hljs-number">60000</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œè¡¨æ¸…ç†é—´éš”ï¼ˆå•ä½æ¯«ç§’ï¼Œé»˜è®¤æ˜¯60*1000ï¼‰</span></code></pre></div>

<ul>
<li><code>registerWithEureka</code>ï¼šè¢«å…¶å®ƒæœåŠ¡è°ƒç”¨æ—¶éœ€å‘Eurekaæ³¨å†Œ</li>
<li><code>fetchRegistry</code>ï¼šéœ€è¦ä»Eurekaä¸­æŸ¥æ‰¾è¦è°ƒç”¨çš„ç›®æ ‡æœåŠ¡æ—¶éœ€è¦è®¾ç½®ä¸ºtrue</li>
<li><code>enable-self-preservation</code>ï¼šè‡ªä¿æŠ¤è®¾ç½®ï¼Œä¸‹è¾¹æœ‰ä»‹ç»ã€‚</li>
<li><code>eviction-interval-timer-in-ms</code>ï¼šæ¸…ç†å¤±æ•ˆç»“ç‚¹çš„é—´éš”ï¼Œåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…å¦‚æœæ²¡æœ‰æ”¶åˆ°è¯¥ç»“ç‚¹çš„ä¸ŠæŠ¥åˆ™å°†ç»“ç‚¹ä»æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤ã€‚</li>
</ul>
<p><strong>5ï¼‰å¯åŠ¨Eureka Server</strong></p>
<p>å¯åŠ¨Eureka Serverï¼Œæµè§ˆ50101ç«¯å£ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image3" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image3.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>è¯´æ˜ï¼š</p>
<p>ä¸Šå›¾çº¢è‰²æç¤ºä¿¡æ¯ï¼š<br><code>THE SELF PRESERVATION MODE IS TURNED OFF.THIS MAY NOT PROTECT INSTANCE EXPIRY IN CASE OFNETWORK/OTHER PROBLEMS.</code></p>
<p>è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼è¢«å…³é—­ã€‚åœ¨ç½‘ç»œæˆ–å…¶ä»–é—®é¢˜çš„æƒ…å†µä¸‹å¯èƒ½ä¸ä¼šä¿æŠ¤å®ä¾‹å¤±æ•ˆã€‚</p>
<p><code>Eureka Server</code> æœ‰ä¸€ç§è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå½“å¾®æœåŠ¡ä¸å†å‘ <code>Eureka Server</code> ä¸ŠæŠ¥çŠ¶æ€ï¼Œ<code>Eureka Server</code> ä¼šä»æœåŠ¡åˆ—è¡¨å°†æ­¤æœåŠ¡åˆ é™¤ï¼Œå¦‚æœå‡ºç°ç½‘ç»œå¼‚å¸¸æƒ…å†µï¼ˆå¾®æœåŠ¡æ­£å¸¸ï¼‰ï¼Œæ­¤æ—¶ <code>Eureka server</code> è¿›å…¥è‡ªä¿æŠ¤æ¨¡å¼ï¼Œä¸å†å°†å¾®æœåŠ¡ä»æœåŠ¡åˆ—è¡¨åˆ é™¤ã€‚</p>
<p>åœ¨å¼€å‘é˜¶æ®µå»ºè®®å…³é—­è‡ªä¿æŠ¤æ¨¡å¼ã€‚</p>
<p>è¯¦ç»†çš„å‚è€ƒèµ„æ–™ï¼š<a href="https://www.cnblogs.com/xishuai/p/spring-cloud-eureka-safe.html" target="_blank" rel="noopener">https://www.cnblogs.com/xishuai/p/spring-cloud-eureka-safe.html</a></p>
<h3 id="2ã€é«˜å¯ç”¨ç¯å¢ƒé…ç½®"><a href="#2ã€é«˜å¯ç”¨ç¯å¢ƒé…ç½®" class="headerlink" title="2ã€é«˜å¯ç”¨ç¯å¢ƒé…ç½®"></a>2ã€é«˜å¯ç”¨ç¯å¢ƒé…ç½®</h3><p><code>Eureka Server</code> é«˜å¯ç”¨ç¯å¢ƒéœ€è¦éƒ¨ç½²ä¸¤ä¸ª <code>Eureka server</code>ï¼Œå®ƒä»¬äº’ç›¸å‘å¯¹æ–¹æ³¨å†Œã€‚å¦‚æœåœ¨æœ¬æœºå¯åŠ¨ä¸¤ä¸ª <code>Eureka</code> éœ€è¦æ³¨æ„ä¸¤ä¸ª <code>Eureka Server</code> çš„ç«¯å£è¦è®¾ç½®ä¸ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ª <code>Eureka Server</code> å·¥ç¨‹ï¼Œå°†ç«¯å£å¯é…ç½®ï¼Œåˆ¶ä½œä¸¤ä¸ª <code>Eureka Server</code> å¯åŠ¨è„šæœ¬ï¼Œå¯åŠ¨ä¸åŒçš„ç«¯å£ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image4" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image4.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1ã€åœ¨å®é™…ä½¿ç”¨æ—¶ <code>Eureka Server</code> è‡³å°‘éƒ¨ç½²ä¸¤å°æœåŠ¡å™¨ï¼Œå®ç°é«˜å¯ç”¨ã€‚</p>
<p>2ã€ä¸¤å° <code>Eureka Server</code> äº’ç›¸æ³¨å†Œã€‚</p>
<p>3ã€å¾®æœåŠ¡éœ€è¦è¿æ¥ä¸¤å° <code>Eureka Server</code> æ³¨å†Œï¼Œå½“å…¶ä¸­ä¸€å° <code>Eureka</code> æ­»æ‰ä¹Ÿä¸ä¼šå½±å“æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚</p>
<p>4ã€å¾®æœåŠ¡ä¼šå®šæ—¶å‘ <code>Eureka server</code> å‘é€å¿ƒè·³ï¼ŒæŠ¥å‘Šè‡ªå·±çš„çŠ¶æ€ã€‚</p>
<p>5ã€å¾®æœåŠ¡ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åœ°å€ä»¥ <code>RESTful</code> æ–¹å¼å‘èµ·è¿œç¨‹è°ƒç”¨ã€‚</p>
<p>é…ç½®å¦‚ä¸‹:</p>
<p><strong>1ã€ç«¯å£é…ç½®åŠ å…¥å˜é‡</strong></p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
    <span class="hljs-attr">port:</span> <span class="hljs-string">$&#123;PORT:50101&#125;</span> <span class="hljs-comment">#æœåŠ¡ç«¯å£</span></code></pre></div>

<p><strong>2ã€åœ¨ Eureka æœåŠ¡ç«¯çš„åœ°å€åŠ å…¥å˜é‡</strong></p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span>
  <span class="hljs-attr">client:</span>
      <span class="hljs-attr">registerWithEureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œï¼Œæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°EurekaæœåŠ¡ä¸­</span>
      <span class="hljs-attr">fetchRegistry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡å‘ç°ï¼Œæ˜¯å¦ä»Eurekaä¸­è·å–æ³¨å†Œä¿¡æ¯</span>
      <span class="hljs-attr">serviceUrl:</span> <span class="hljs-comment">#Eurekaå®¢æˆ·ç«¯ä¸EurekaæœåŠ¡ç«¯çš„äº¤äº’åœ°å€ï¼Œé«˜å¯ç”¨çŠ¶æ€é…ç½®å¯¹æ–¹çš„åœ°å€ï¼Œå•æœºçŠ¶æ€é…ç½®è‡ªå·±ï¼ˆå¦‚æœä¸é…ç½®åˆ™é»˜è®¤æœ¬æœº8761ç«¯å£ï¼‰</span>
        <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">$&#123;EUREKA_SERVER:http://eureka02:50102/eureka/&#125;</span></code></pre></div>

<p><strong>3ã€ é…ç½® hostname</strong></p>
<p><code>Eureka</code> ç»„æˆé«˜å¯ç”¨ï¼Œä¸¤ä¸ª<code>Eureka</code> äº’ç›¸å‘å¯¹æ–¹æ³¨å†Œï¼Œè¿™é‡Œéœ€è¦é€šè¿‡åŸŸåæˆ–ä¸»æœºåè®¿é—®ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸¤ä¸ª <code>Eureka</code> æœåŠ¡çš„ä¸»æœºååˆ†åˆ«ä¸º <code>eureka01</code>ã€<code>eureka02</code>ã€‚</p>
<p>å®Œæ•´é…ç½®å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span>
  <span class="hljs-attr">client:</span>
      <span class="hljs-attr">registerWithEureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œï¼Œæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°EurekaæœåŠ¡ä¸­</span>
      <span class="hljs-attr">fetchRegistry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡å‘ç°ï¼Œæ˜¯å¦ä»Eurekaä¸­è·å–æ³¨å†Œä¿¡æ¯</span>
      <span class="hljs-attr">serviceUrl:</span> <span class="hljs-comment">#Eurekaå®¢æˆ·ç«¯ä¸EurekaæœåŠ¡ç«¯çš„äº¤äº’åœ°å€ï¼Œé«˜å¯ç”¨çŠ¶æ€é…ç½®å¯¹æ–¹çš„åœ°å€ï¼Œå•æœºçŠ¶æ€é…ç½®è‡ªå·±ï¼ˆå¦‚æœä¸é…ç½®åˆ™é»˜è®¤æœ¬æœº8761ç«¯å£ï¼‰</span>
        <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">$&#123;EUREKA_SERVER:http://eureka02:50102/eureka/&#125;</span>
  <span class="hljs-attr">server:</span>
        <span class="hljs-attr">enable-self-preservation:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æ˜¯å¦å¼€å¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</span>
        <span class="hljs-attr">eviction-interval-timer-in-ms:</span> <span class="hljs-number">60000</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œè¡¨æ¸…ç†é—´éš”ï¼ˆå•ä½æ¯«ç§’ï¼Œé»˜è®¤æ˜¯6ï¼‰0*1000</span>
  <span class="hljs-attr">instance:</span>
    <span class="hljs-attr">hostname:</span> <span class="hljs-string">$&#123;EUREKA_DOMAIN:eureka01&#125;</span></code></pre></div>

<p>æ³¨æ„è¿™é‡Œçš„ <code>eureka01</code>ã€<code>eureka02</code> çš„åŸŸåï¼Œåœ¨å¼€æ”¾ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨hosts æ–‡ä»¶ä¸­å¢åŠ ç›¸åº”çš„æ˜ å°„ï¼š</p>
<div class="hljs"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> eureka01
<span class="hljs-number">127.0.0.1</span> eureka02</code></pre></div>

<p><strong>4ã€åœ¨IDEAä¸­åˆ¶ä½œå¯åŠ¨è„šæœ¬</strong></p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image5" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image5.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>è¿è¡Œä¸¤ä¸ªå¯åŠ¨è„šæœ¬ï¼Œåˆ†åˆ«æµè§ˆï¼š</p>
<p><a href="http://localhost:50101/" target="_blank" rel="noopener">http://localhost:50101/</a><br><a href="http://localhost:50102/" target="_blank" rel="noopener">http://localhost:50102/</a></p>
<p>Eureka ä¸»ç”»é¢å¦‚ä¸‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image6" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image6.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="0x04-æœåŠ¡æ³¨å†Œ"><a href="#0x04-æœåŠ¡æ³¨å†Œ" class="headerlink" title="0x04 æœåŠ¡æ³¨å†Œ"></a>0x04 æœåŠ¡æ³¨å†Œ</h2><p><strong>1ã€å°† cms æ³¨å†Œåˆ° Eureka Server</strong></p>
<p>1ï¼‰åœ¨ cms æœåŠ¡ä¸­æ·»åŠ ä¾èµ–</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- å¯¼å…¥Eurekaå®¢æˆ·ç«¯çš„ä¾èµ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p>2ï¼‰åœ¨ <code>application.yml</code> ä¸­è¿›è¡Œé…ç½®</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span>
  <span class="hljs-attr">client:</span>
      <span class="hljs-attr">registerWithEureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œå¼€å…³</span>
      <span class="hljs-attr">fetchRegistry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡å‘ç°å¼€å…³</span>
      <span class="hljs-attr">serviceUrl:</span> <span class="hljs-comment">#Eurekaå®¢æˆ·ç«¯ä¸EurekaæœåŠ¡ç«¯è¿›è¡Œäº¤äº’çš„åœ°å€ï¼Œå¤šä¸ªä¸­é—´ç”¨é€—å·åˆ†éš”</span>
        <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">$&#123;EUREKA_SERVER:http://eureka01:50101/eureka/,http://eureka02:50102/eureka/&#125;,</span>
  <span class="hljs-attr">instance:</span>
      <span class="hljs-attr">prefer-ip-address:</span>  <span class="hljs-literal">true</span>  <span class="hljs-comment">#å°†è‡ªå·±çš„ipåœ°å€æ³¨å†Œåˆ°EurekaæœåŠ¡ä¸­</span>
      <span class="hljs-attr">ip-address:</span> <span class="hljs-string">$&#123;IP_ADDRESS:127.0.0.1&#125;</span>
      <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.application.name&#125;:$&#123;server.port&#125;</span> <span class="hljs-comment">#æŒ‡å®šå®ä¾‹id</span></code></pre></div>

<p>3ï¼‰åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ <code>@EnableDiscoveryClient</code></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@EnableDiscoveryClient</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EntityScan</span>(<span class="hljs-string">"com.xuecheng.framework.domain.cms"</span>) <span class="hljs-comment">//æ‰«æå…¬å…±çš„å®ä½“ç±»</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.api"</span>&#125;) <span class="hljs-comment">//æ‰«ææ¥å£</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.manage_cms"</span>&#125;)  <span class="hljs-comment">// æ‰«ææœ¬é¡¹ç›®ä¸‹çš„æ‰€æœ‰ç±»</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)  <span class="hljs-comment">// æ‰«æframework</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCmsApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(ManageCmsApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate(<span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory());
    &#125;
&#125;</code></pre></div>

<p>4ï¼‰åˆ·æ–° Eureka Server æŸ¥çœ‹æ³¨å†Œæƒ…å†µ</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image7" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image7.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>2ã€æ³¨å†Œ course æœåŠ¡</strong></p>
<p>æ–¹æ³•åŒä¸Šã€‚</p>
<p>1ã€åœ¨ <code>manage-course</code> å·¥ç¨‹ä¸­æ·»åŠ  <code>spring-cloud-starter-eureka</code> ä¾èµ–ï¼š</p>
<p>2ã€åœ¨ <code>application.yml</code> é…ç½® <code>eureka</code></p>
<p>3ã€åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ <code>@EnableDiscoveryClient</code></p>
<h1 id="äºŒã€Feign-è¿œç¨‹è°ƒç”¨"><a href="#äºŒã€Feign-è¿œç¨‹è°ƒç”¨" class="headerlink" title="äºŒã€Feign è¿œç¨‹è°ƒç”¨"></a>äºŒã€Feign è¿œç¨‹è°ƒç”¨</h1><p>åœ¨å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼ŒæœåŠ¡å±‚è¢«æ‹†åˆ†æˆäº†å¾ˆå¤šçš„å¾®æœåŠ¡ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´éš¾å…å‘ç”Ÿäº¤äº’ï¼Œæ¯”å¦‚ï¼š</p>
<p>è¯¾ç¨‹å‘å¸ƒéœ€è¦è°ƒç”¨ <code>CMS</code> æœåŠ¡ç”Ÿæˆè¯¾ç¨‹é™æ€åŒ–é¡µé¢ï¼Œæœ¬èŠ‚ç ”ç©¶å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨æ‰€ä½¿ç”¨çš„æŠ€æœ¯ã€‚</p>
<p>ä¸‹å›¾æ˜¯è¯¾ç¨‹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨ <code>CMS</code> æœåŠ¡çš„æµç¨‹å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image8" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image8.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p>1 ã€<code>cms</code> æœåŠ¡å°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒã€‚</p>
<p>2ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡ä»æ³¨å†Œä¸­å¿ƒè·å– <code>cms</code> æœåŠ¡çš„åœ°å€ã€‚</p>
<p>3ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨ <code>cms</code> æœåŠ¡ã€‚</p>
<p>Feignçš„å®ç°æ˜¯åŸºäº <code>Ribbon</code> çš„ï¼Œæ‰€ä»¥åœ¨ä»‹ç» Feign çš„ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ Ribbonï¼Œ ä»¥ä¾¿èƒ½æ›´æ·±åˆ»çš„ç†è§£ <code>Feign</code>ã€‚</p>
<h2 id="1-Ribbon-ç®€ä»‹"><a href="#1-Ribbon-ç®€ä»‹" class="headerlink" title="1. Ribbon ç®€ä»‹"></a>1. Ribbon ç®€ä»‹</h2><p><code>Ribbon</code> æ˜¯ <code>Netflix</code> å…¬å¸å¼€æºçš„ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„é¡¹ç›®ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº HTTPã€TCPçš„ <strong>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨</strong>ã€‚</p>
<p><code>Ribbon</code> çš„å¼€æºåœ°å€ï¼š<a href="https://github.com/Netflix/ribbon" target="_blank" rel="noopener">https://github.com/Netflix/ribbon</a></p>
<p><strong>1ã€ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿ</strong></p>
<p>è´Ÿè½½å‡è¡¡æ˜¯ å¾®æœåŠ¡æ¶æ„ ä¸­å¿…é¡»ä½¿ç”¨çš„æŠ€æœ¯ï¼Œé€šè¿‡ è´Ÿè½½å‡è¡¡ æ¥å®ç°ç³»ç»Ÿçš„ é«˜å¯ç”¨ã€é›†ç¾¤æ‰©å®¹ ç­‰åŠŸèƒ½ã€‚è´Ÿè½½å‡è¡¡ å¯é€šè¿‡ ç¡¬ä»¶è®¾å¤‡ åŠ è½¯ä»¶ æ¥å®ç°ï¼Œç¡¬ä»¶æ¯”å¦‚ï¼š<code>F5</code>ã€<code>Array</code> ç­‰ï¼Œè½¯ä»¶æ¯”å¦‚ï¼šLVSã€<code>Nginx</code> ç­‰ã€‚</p>
<p>å¦‚ä¸‹å›¾æ˜¯è´Ÿè½½å‡è¡¡çš„æ¶æ„å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image9" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image9.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç”¨æˆ·è¯·æ±‚å…ˆåˆ°è¾¾è´Ÿè½½å‡è¡¡å™¨ï¼ˆä¹Ÿç›¸å½“äºä¸€ä¸ªæœåŠ¡ï¼‰ï¼Œè´Ÿè½½å‡è¡¡å™¨æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å°†è¯·æ±‚è½¬å‘åˆ°å¾®æœåŠ¡ã€‚è´Ÿè½½å‡è¡¡ç®—æ³•æœ‰ï¼š<code>è½®è®­</code>ã€<code>éšæœº</code>ã€<code>åŠ æƒè½®è®­</code>ã€<code>åŠ æƒéšæœº</code>ã€<code>åœ°å€å“ˆå¸Œ</code> ç­‰æ–¹æ³•ï¼Œè´Ÿè½½å‡è¡¡å™¨ç»´æŠ¤ä¸€ä»½æœåŠ¡åˆ—è¡¨ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å°†è¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„å¾®æœåŠ¡ä¸Šã€‚æ‰€ä»¥è´Ÿè½½å‡è¡¡å¯ä»¥ä¸ºå¾®æœåŠ¡é›†ç¾¤åˆ†æ‹…è¯·æ±‚ï¼Œé™ä½ç³»ç»Ÿçš„å‹åŠ›ã€‚</p>
<p><strong>2ã€ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Ÿ</strong></p>
<p>ä¸Šå›¾æ˜¯ <code>æœåŠ¡ç«¯ è´Ÿè½½å‡è¡¡</code>ï¼Œ<code>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</code> ä¸ <code>æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡</code> çš„åŒºåˆ«åœ¨äº <strong>å®¢æˆ·ç«¯</strong> è¦ç»´æŠ¤ä¸€ä»½æœåŠ¡åˆ—è¡¨ï¼Œ<code>Ribbon</code> ä» <code>Eureka Server</code> è·å–æœåŠ¡åˆ—è¡¨ï¼Œ<code>Ribbon</code> æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•ç›´æ¥è¯·æ±‚åˆ°å…·ä½“çš„å¾®æœåŠ¡ï¼Œä¸­é—´çœå»äº†è´Ÿè½½å‡è¡¡æœåŠ¡ã€‚å¦‚ä¸‹å›¾æ˜¯ <code>Ribbon</code> è´Ÿè½½å‡è¡¡çš„æµç¨‹å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image10" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image10.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1ã€åœ¨æ¶ˆè´¹å¾®æœåŠ¡ä¸­ä½¿ç”¨ <code>Ribbon</code> å®ç°è´Ÿè½½å‡è¡¡ï¼Œ<code>Ribbon</code> å…ˆä» <code>EurekaServer</code> ä¸­è·å–æœåŠ¡åˆ—è¡¨ã€‚</p>
<p>2ã€<code>Ribbon</code> æ ¹æ®è´Ÿè½½å‡è¡¡çš„ç®—æ³•å»è°ƒç”¨å¾®æœåŠ¡ã€‚</p>
<h2 id="2-Ribbon-çš„åŸºæœ¬ä½¿ç”¨"><a href="#2-Ribbon-çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2. Ribbon çš„åŸºæœ¬ä½¿ç”¨"></a>2. Ribbon çš„åŸºæœ¬ä½¿ç”¨</h2><p>Spring Cloud å¼•å…¥<code>Ribbon</code> é…åˆ <code>restTemplate</code> å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‚Javaä¸­è¿œç¨‹è°ƒç”¨çš„æŠ€æœ¯æœ‰å¾ˆå¤šï¼Œå¦‚ï¼šwebserviceã€socketã€rmiã€Apache HttpClientã€OkHttp ç­‰ï¼Œäº’è”ç½‘é¡¹ç›®ä½¿ç”¨åŸºäº <code>http</code> çš„å®¢æˆ·ç«¯è¾ƒå¤šï¼Œæœ¬é¡¹ç›®ä½¿ç”¨ <code>OkHttp</code>ã€‚</p>
<p><strong>1ã€åœ¨å®¢æˆ·ç«¯æ·»åŠ Ribbonä¾èµ–ï¼š</strong></p>
<p>è¿™é‡Œåœ¨ è¯¾ç¨‹ç®¡ç†æœåŠ¡ é…ç½® <code>ribbon</code> ä¾èµ–</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¯¼å…¥ribbonä¾èµ–--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-ribbon<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p>ç”±äºä¾èµ–äº† <code>spring-cloud-starter-eureka</code>ï¼Œä¼šè‡ªåŠ¨æ·»åŠ  <code>spring-cloud-starter-ribbon</code> ä¾èµ–</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image11" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image11.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>2ã€é…ç½® Ribbbon å‚æ•°</strong></p>
<p>è¿™é‡Œåœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡çš„ <code>application.yml</code> ä¸­é…ç½® <code>ribbon</code> å‚æ•°</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">ribbon:</span>
  <span class="hljs-attr">MaxAutoRetries:</span> <span class="hljs-number">2</span> <span class="hljs-comment">#æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œå½“Eurekaä¸­å¯ä»¥æ‰¾åˆ°æœåŠ¡ï¼Œä½†æ˜¯æœåŠ¡è¿ä¸ä¸Šæ—¶å°†ä¼šé‡è¯•</span>
  <span class="hljs-attr">MaxAutoRetriesNextServer:</span> <span class="hljs-number">3</span> <span class="hljs-comment">#åˆ‡æ¢å®ä¾‹çš„é‡è¯•æ¬¡æ•°</span>
  <span class="hljs-attr">OkToRetryOnAllOperations:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment">#å¯¹æ‰€æœ‰æ“ä½œè¯·æ±‚éƒ½è¿›è¡Œé‡è¯•ï¼Œå¦‚æœæ˜¯getåˆ™å¯ä»¥ï¼Œå¦‚æœæ˜¯postï¼Œputç­‰æ“ä½œæ²¡æœ‰å®ç°å¹‚ç­‰çš„æƒ…å†µä¸‹æ˜¯å¾ˆå±é™©çš„,æ‰€ä»¥è®¾ç½®ä¸ºfalse</span>
  <span class="hljs-attr">ConnectTimeout:</span> <span class="hljs-number">5000</span>  <span class="hljs-comment">#è¯·æ±‚è¿æ¥çš„è¶…æ—¶æ—¶é—´</span>
  <span class="hljs-attr">ReadTimeout:</span> <span class="hljs-number">6000</span> <span class="hljs-comment">#è¯·æ±‚å¤„ç†çš„è¶…æ—¶æ—¶é—´</span></code></pre></div>

<p><strong>3ã€è´Ÿè½½å‡è¡¡æµ‹è¯•</strong></p>
<p>1ï¼‰å¯åŠ¨ä¸¤ä¸ª <code>cms</code> æœåŠ¡ï¼Œæ³¨æ„ç«¯å£è¦ä¸ä¸€è‡´</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-string">$&#123;PORT:31001&#125;</span></code></pre></div>

<p><a href="https://qnoss.codeyee.com/20200704_9/image12" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image12.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å¯åŠ¨å®Œæˆè§‚å¯Ÿ <code>Eureka Server</code> çš„æœåŠ¡åˆ—è¡¨</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image13" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image13.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>2ï¼‰å®šä¹‰ <code>RestTemplate</code>ï¼Œä½¿ç”¨ <code>@LoadBalanced</code> æ³¨è§£</p>
<p>åœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡çš„å¯åŠ¨ç±»ä¸­å®šä¹‰ <code>RestTemplate</code></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@EnableDiscoveryClient</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EntityScan</span>(<span class="hljs-string">"com.xuecheng.framework.domain.course"</span>)<span class="hljs-comment">//æ‰«æå®ä½“ç±»</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.api"</span>&#125;)<span class="hljs-comment">//æ‰«ææ¥å£</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.manage_course"</span>&#125;)
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)<span class="hljs-comment">//æ‰«æcommonä¸‹çš„æ‰€æœ‰ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCourseApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        SpringApplication.run(ManageCourseApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@LoadBalanced</span> <span class="hljs-comment">//å¼€å¯ribbonè´Ÿè½½å‡è¡¡æ‹¦æˆªå™¨</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate(<span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory());
    &#125;
&#125;</code></pre></div>

<p>3 ï¼‰æµ‹è¯•ä»£ç </p>
<p>åœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹åˆ›å»ºå•å…ƒæµ‹è¯•ä»£ç ï¼Œè¿œç¨‹è°ƒç”¨cmsçš„æŸ¥è¯¢é¡µé¢æ¥å£ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestRibbon</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    RestTemplate restTemplate;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testRibbon</span><span class="hljs-params">()</span></span>&#123;
        String serviceId = <span class="hljs-string">"xc-service-manage-cms"</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;
            ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(<span class="hljs-string">"http://"</span> + serviceId + <span class="hljs-string">"/cms/page/get/5a795ac7dd573c04508f3a56"</span>, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
            Map body = forEntity.getBody();
            System.out.println(body);
        &#125;
    &#125;
&#125;</code></pre></div>

<p>4ï¼‰è´Ÿè½½å‡è¡¡æµ‹è¯•</p>
<p>æ·»åŠ  <code>@LoadBalanced</code> æ³¨è§£åï¼Œ<code>restTemplate</code> ä¼šèµ° <code>LoadBalancerInterceptor</code> æ‹¦æˆªå™¨ï¼Œæ­¤æ‹¦æˆªå™¨ä¸­ä¼šé€šè¿‡ <code>RibbonLoadBalancerClient</code> æŸ¥è¯¢æœåŠ¡åœ°å€ï¼Œå¯ä»¥åœ¨æ­¤ç±»æ‰“æ–­ç‚¹è§‚å¯Ÿæ¯æ¬¡è°ƒç”¨çš„æœåŠ¡åœ°å€å’Œç«¯å£ï¼Œä¸¤ä¸ª <code>cms</code> æœåŠ¡ä¼šè½®æµè¢«è°ƒç”¨ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image14" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image14.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-Feign"><a href="#3-Feign" class="headerlink" title="3. Feign"></a>3. Feign</h2><h3 id="1ã€Fegin-ä»‹ç»"><a href="#1ã€Fegin-ä»‹ç»" class="headerlink" title="1ã€Fegin ä»‹ç»"></a>1ã€Fegin ä»‹ç»</h3><p><code>Feign</code>æ˜¯ <code>Netflix</code> å…¬å¸å¼€æºçš„è½»é‡çº§ <code>rest</code> <strong>å®¢æˆ·ç«¯</strong>ï¼Œä½¿ç”¨ <code>Feign</code> å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°<code>Http</code> å®¢æˆ·ç«¯ã€‚Spring Cloud å¼•å…¥ <code>Feign</code> å¹¶ä¸”é›†æˆäº† <code>Ribbon</code> å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡è°ƒç”¨ã€‚</p>
<h3 id="2ã€Feign-æµ‹è¯•"><a href="#2ã€Feign-æµ‹è¯•" class="headerlink" title="2ã€Feign æµ‹è¯•"></a>2ã€Feign æµ‹è¯•</h3><p><strong>1 ã€åœ¨å®¢æˆ·ç«¯æ·»åŠ ä¾èµ–</strong></p>
<p>åœ¨ è¯¾ç¨‹ç®¡ç†æœåŠ¡ æ·»åŠ ä¸‹è¾¹çš„ä¾èµ–ï¼š</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--feignç›¸å…³ä¾èµ–--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.netflix.feign<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>feign-okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p><strong>2ã€å®šä¹‰ FeignClient æ¥å£</strong></p>
<p>å‚è€ƒ <code>Swagger</code> æ–‡æ¡£å®šä¹‰<code>FeignClient</code>ï¼Œæ³¨æ„æ¥å£çš„ <code>Url</code>ã€è¯·æ±‚å‚æ•°ç±»å‹ã€è¿”å›å€¼ç±»å‹ä¸<code>Swagger</code> æ¥å£ä¸€è‡´ã€‚åœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡ä¸­åˆ›å»º <code>client</code>åŒ…ï¼Œå®šä¹‰æŸ¥è¯¢ <code>cms</code> é¡µé¢çš„å®¢æˆ·ç«¯çš„æ¥å£</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_course.client;

<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.response.CmsPageResult;
<span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;


<span class="hljs-meta">@FeignClient</span>(value = <span class="hljs-string">"XC-SERVICE-MANAGE-CMS"</span>)
<span class="hljs-comment">//è¿™é‡Œå¯ä»¥å°†æ‰€æœ‰æœåŠ¡åšæˆä¸€ä¸ªæšä¸¾åˆ—è¡¨</span>
<span class="hljs-comment">//@FeignClient(value = XcServiceList.XC_SERVICE_MANAGE_CMS)</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageClient</span> </span>&#123;
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/cms/page/get/&#123;id&#125;"</span>)
    <span class="hljs-comment">//è¿™é‡Œæˆ‘åœ¨CmsPageæ¥å£å®šä¹‰çš„è¿”å›ç±»å‹ä¸º CmsPageResult ç±»å‹,æ‰€ä»¥è¿œç¨‹è°ƒç”¨æ¥å£è¿™é‡Œä¹Ÿè¦æ¥æ”¶ CmsPageResult ç±»å‹</span>
    <span class="hljs-function">CmsPageResult <span class="hljs-title">findById</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id)</span>;
&#125;</code></pre></div>

<p><strong>3ã€å¯åŠ¨ç±»æ·»åŠ @EnableFeignClientsæ³¨è§£</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@EnableFeignClients</span>  <span class="hljs-comment">//å¼€å¯Feignè¿œç¨‹è°ƒç”¨åŠŸèƒ½</span>
<span class="hljs-meta">@EnableDiscoveryClient</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EntityScan</span>(<span class="hljs-string">"com.xuecheng.framework.domain.course"</span>)<span class="hljs-comment">//æ‰«æå®ä½“ç±»</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.api"</span>&#125;)<span class="hljs-comment">//æ‰«ææ¥å£</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.manage_course"</span>&#125;)
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)<span class="hljs-comment">//æ‰«æcommonä¸‹çš„æ‰€æœ‰ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCourseApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        SpringApplication.run(ManageCourseApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;
    &#125;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-meta">@LoadBalanced</span> <span class="hljs-comment">//å¼€å¯ribbonè´Ÿè½½å‡è¡¡æ‹¦æˆªå™¨</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate(<span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory());
    &#125;
&#125;</code></pre></div>

<p>4ã€<strong>æµ‹è¯•</strong></p>
<p>åˆ›å»ºä¸€ä¸ªå•å…ƒæµ‹è¯•</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestFeign</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    CmsPageClient cmsPageClient;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFeign</span><span class="hljs-params">()</span></span>&#123;
        CmsPageResult byId = cmsPageClient.findById(<span class="hljs-string">"5a795ac7dd573c04508f3a56"</span>);
        System.out.println(byId.getCmsPage());
    &#125;
&#125;</code></pre></div>

<p>è¿è¡Œæµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image15" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image15.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>Feign å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</strong></p>
<p>1ã€ å¯åŠ¨ç±»æ·»åŠ  <code>@EnableFeignClients</code> æ³¨è§£ï¼Œ<code>Spring</code>ä¼šæ‰«ææ ‡è®°äº†<code>@FeignClient</code> æ³¨è§£çš„æ¥å£ï¼Œå¹¶ç”Ÿæˆæ­¤æ¥å£çš„ä»£ç†å¯¹è±¡</p>
<p>2ã€ <code>@FeignClient(value = XcServiceList.XC_SERVICE_MANAGE_CMS)</code> å³æŒ‡å®šäº† <code>cms</code> çš„æœåŠ¡åç§°ï¼Œ<code>Feign</code> ä¼šä»æ³¨å†Œä¸­å¿ƒè·å– <code>cms</code> æœåŠ¡åˆ—è¡¨ï¼Œå¹¶é€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•è¿›è¡ŒæœåŠ¡è°ƒç”¨ã€‚</p>
<p>3ã€åœ¨æ¥å£æ–¹æ³• ä¸­ä½¿ç”¨æ³¨è§£ <code>@GetMapping(&quot;/cms/page/get/{id}&quot;)</code>ï¼ŒæŒ‡å®šè°ƒç”¨çš„<code>url</code>ï¼Œ<code>Feign</code> å°†æ ¹æ® <code>url</code> è¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚</p>
<h3 id="3ã€ä½¿ç”¨-Feign-æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ"><a href="#3ã€ä½¿ç”¨-Feign-æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ" class="headerlink" title="3ã€ä½¿ç”¨ Feign æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ"></a>3ã€ä½¿ç”¨ Feign æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ</h3><p>SpringCloud å¯¹ <code>Feign</code> è¿›è¡Œäº†å¢å¼ºå…¼å®¹äº† <code>SpringMVC</code> çš„æ³¨è§£ ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ <code>SpringMVC</code> çš„æ³¨è§£æ—¶éœ€è¦æ³¨æ„ï¼š</p>
<p>1ã€FeignClient æ¥å£ æœ‰å‚æ•°åœ¨å‚æ•°å¿…é¡»åŠ  <code>@PathVariable(&quot;XXX&quot;)</code> å’Œ <code>@RequestParam(&quot;XXX&quot;)</code></p>
<p>2ã€FeignClient è¿”å›å€¼ä¸ºå¤æ‚å¯¹è±¡æ—¶å…¶ç±»å‹å¿…é¡»æœ‰æ— å‚æ„é€ å‡½æ•°ã€‚</p>
<h1 id="ä¸‰ã€è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯æ–¹æ¡ˆ"><a href="#ä¸‰ã€è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯æ–¹æ¡ˆ"></a>ä¸‰ã€è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯æ–¹æ¡ˆ</h1><h2 id="1-éœ€æ±‚åˆ†æ-1"><a href="#1-éœ€æ±‚åˆ†æ-1" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p><strong>è¯¾ç¨‹é¢„è§ˆ</strong> æ˜¯ä¸ºäº†ä¿è¯è¯¾ç¨‹å‘å¸ƒåçš„ <strong>æ­£ç¡®æ€§</strong>ï¼Œé€šè¿‡è¯¾ç¨‹é¢„è§ˆå¯ä»¥ç›´è§‚çš„é€šè¿‡ <strong>è¯¾ç¨‹è¯¦æƒ…é¡µé¢</strong> çœ‹åˆ°è¯¾ç¨‹çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Œé€šè¿‡ è¯¾ç¨‹é¢„è§ˆ çœ‹åˆ°çš„é¡µé¢å†…å®¹ å’Œ è¯¾ç¨‹å‘å¸ƒåçš„é¡µé¢ å†…å®¹æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>ä¸‹å›¾æ˜¯è¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„é¢„è§ˆå›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image16" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image16.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="2-è¯¾ç¨‹è¯¦ç»†é¡µé¢-æŠ€æœ¯æ–¹æ¡ˆ"><a href="#2-è¯¾ç¨‹è¯¦ç»†é¡µé¢-æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="2. è¯¾ç¨‹è¯¦ç»†é¡µé¢ æŠ€æœ¯æ–¹æ¡ˆ"></a>2. è¯¾ç¨‹è¯¦ç»†é¡µé¢ æŠ€æœ¯æ–¹æ¡ˆ</h2><h3 id="1ã€æŠ€æœ¯éœ€æ±‚"><a href="#1ã€æŠ€æœ¯éœ€æ±‚" class="headerlink" title="1ã€æŠ€æœ¯éœ€æ±‚"></a>1ã€æŠ€æœ¯éœ€æ±‚</h3><p>è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ˜¯å‘ç”¨æˆ·å±•ç¤ºè¯¾ç¨‹ä¿¡æ¯çš„çª—å£ï¼Œè¯¾ç¨‹ç›¸å½“äºç½‘ç«™çš„ <strong>å•†å“</strong>ï¼Œæœ¬é¡µé¢çš„è®¿é—®é‡ä¼šéå¸¸å¤§ã€‚æ­¤é¡µé¢çš„å†…å®¹è®¾è®¡ä¸ä»…è¦å±•ç¤ºå‡ºè¯¾ç¨‹ <strong>æ ¸å¿ƒé‡è¦çš„å†…å®¹</strong> è€Œä¸”ç”¨æˆ·è®¿é—®é¡µé¢çš„ <strong>é€Ÿåº¦è¦æœ‰ä¿è¯</strong>ï¼Œæœ‰ç»Ÿè®¡æ˜¾ç¤ºæ‰“å¼€ä¸€ä¸ªé¡µé¢è¶…è¿‡4ç§’ç”¨æˆ·å°±èµ°æ‰äº†ï¼Œæ‰€ä»¥æœ¬é¡µé¢çš„æ€§èƒ½è¦æ±‚æ˜¯æœ¬é¡µé¢çš„é‡è¦éœ€æ±‚ã€‚</p>
<p>æœ¬é¡µé¢å¦ä¸€ä¸ªéœ€æ±‚å°±æ˜¯ <code>SEO</code>ï¼Œè¦éå¸¸æœ‰åˆ©äºçˆ¬è™«æŠ“å–é¡µé¢ä¸Šä¿¡æ¯ï¼Œå¹¶ä¸”ç”Ÿæˆé¡µé¢å¿«ç…§ï¼Œåˆ©äºç”¨æˆ·é€šè¿‡æœç´¢å¼•æ“æœç´¢è¯¾ç¨‹ä¿¡æ¯ã€‚</p>
<h3 id="2ã€è§£å†³æ–¹æ¡ˆ"><a href="#2ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2ã€è§£å†³æ–¹æ¡ˆ"></a>2ã€è§£å†³æ–¹æ¡ˆ</h3><p>é‚£ä¹ˆå¦‚ä½•åœ¨ä¿è¯ <code>SEO</code> çš„å‰æä¸‹æé«˜é¡µé¢çš„è®¿é—®é€Ÿåº¦ï¼Ÿ</p>
<p><strong>æ–¹æ¡ˆ1ï¼š</strong></p>
<p>å¯¹äºä¿¡æ¯è·å–ç±»çš„éœ€æ±‚ï¼Œè¦æƒ³æé«˜é¡µé¢é€Ÿåº¦å°±è¦ä½¿ç”¨ <strong>ç¼“å­˜</strong> æ¥å‡å°‘æˆ–é¿å…å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œä»è€Œæé«˜é¡µé¢çš„è®¿é—®é€Ÿåº¦ã€‚ä¸‹å›¾æ˜¯ä½¿ç”¨ç¼“å­˜ä¸ä¸ä½¿ç”¨ç¼“å­˜çš„åŒºåˆ«</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image17" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_9/image17" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ­¤é¡µé¢ä¸ºåŠ¨æ€é¡µé¢ï¼Œä¼šæ ¹æ®è¯¾ç¨‹çš„ä¸åŒè€Œä¸åŒï¼Œæ–¹æ¡ˆä¸€é‡‡ç”¨ä¼ ç»Ÿçš„ <code>JavaEE Servlet/jsp</code> çš„æ–¹å¼åœ¨ <code>Tomcat</code> å®Œæˆé¡µé¢æ¸²æŸ“ï¼Œç›¸æ¯”ä¸åŠ ç¼“å­˜é€Ÿåº¦ä¼šæœ‰æå‡ã€‚</p>
<p>ä¼˜ç‚¹ï¼šä½¿ç”¨ <code>redis</code> ä½œä¸ºç¼“å­˜ï¼Œé€Ÿåº¦æœ‰æå‡ã€‚</p>
<p>ç¼ºç‚¹ï¼šé‡‡ç”¨ <code>Servlet/jsp</code> åŠ¨æ€é¡µé¢æ¸²æŸ“æŠ€æœ¯ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ <code>Tomcat</code>ï¼Œé¢å¯¹é«˜å¹¶å‘é‡çš„è®¿é—®å­˜åœ¨æ€§èƒ½ç“¶é¢ˆã€‚</p>
<p><strong>æ–¹æ¡ˆ2ï¼š</strong></p>
<p>å¯¹äºä¸ä¼šé¢‘ç¹æ”¹å˜çš„ä¿¡æ¯å¯ä»¥é‡‡ç”¨ <strong>é¡µé¢é™æ€åŒ–</strong> çš„æŠ€æœ¯ï¼Œæå‰è®©é¡µé¢ç”Ÿæˆ <code>html</code> é™æ€é¡µé¢å­˜å‚¨åœ¨<code>nginx</code> æœåŠ¡å™¨ï¼Œç”¨æˆ·ç›´æ¥è®¿é—® <code>nginx</code> å³å¯ï¼Œå¯¹äºä¸€äº›åŠ¨æ€ä¿¡æ¯å¯ä»¥è®¿é—®æœåŠ¡ç«¯è·å– <code>json</code>æ•°æ®åœ¨é¡µé¢æ¸²æŸ“ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image18" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image18.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¼˜ç‚¹ï¼šä½¿ç”¨ <code>Nginx</code> ä½œä¸º <code>web</code> æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç›´æ¥è®¿é—® <code>html</code> é¡µé¢ï¼Œæ€§èƒ½å‡ºè‰²ã€‚</p>
<p>ç¼ºç‚¹ï¼šéœ€è¦ç»´æŠ¤å¤§é‡çš„é™æ€é¡µé¢ï¼Œå¢åŠ äº†ç»´æŠ¤çš„éš¾åº¦ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹© <strong>æ–¹æ¡ˆ2</strong> ä½œä¸ºè¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œå°†è¯¾ç¨‹è¯¦æƒ…é¡µé¢ç”Ÿæˆ <code>Html</code> é™æ€åŒ–é¡µé¢ï¼Œå¹¶å‘å¸ƒåˆ° <code>Nginx</code> ä¸Šã€‚</p>
<h2 id="3-è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯-è§£å†³æ–¹æ¡ˆ"><a href="#3-è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3. è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯ è§£å†³æ–¹æ¡ˆ"></a>3. è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯ è§£å†³æ–¹æ¡ˆ</h2><p>æ ¹æ®è¦æ±‚ï¼šè¯¾ç¨‹è¯¦æƒ…é¡µé¢é‡‡ç”¨é™æ€åŒ–æŠ€æœ¯ç”Ÿæˆ <code>Html</code> é¡µé¢ï¼Œè¯¾ç¨‹é¢„è§ˆçš„æ•ˆæœè¦ä¸æœ€ç»ˆé™æ€åŒ–çš„<code>Html</code> é¡µé¢å†…å®¹ä¸€è‡´ã€‚æ‰€ä»¥ï¼Œè¯¾ç¨‹é¢„è§ˆåŠŸèƒ½ä¹Ÿé‡‡ç”¨é™æ€åŒ–æŠ€æœ¯ç”Ÿæˆ <code>Html</code> é¡µé¢ï¼Œè¯¾ç¨‹é¢„è§ˆä½¿ç”¨çš„æ¨¡æ¿ä¸è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ¨¡æ¿ä¸€è‡´ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯è¯¾ç¨‹é¢„è§ˆçš„æ•ˆæœä¸æœ€ç»ˆè¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„æ•ˆæœä¸€è‡´ã€‚</p>
<p><strong>æ“ä½œæµç¨‹ï¼š</strong></p>
<p>1ã€åˆ¶ä½œè¯¾ç¨‹è¯¦æƒ…é¡µé¢æ¨¡æ¿</p>
<p>2ã€å¼€å‘è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ•°æ®æ¨¡å‹çš„æŸ¥è¯¢æ¥å£ï¼ˆä¸ºé™æ€åŒ–æä¾›æ•°æ®ï¼‰</p>
<p>3ã€è°ƒç”¨cmsè¯¾ç¨‹é¢„è§ˆæ¥å£é€šè¿‡æµè§ˆå™¨æµè§ˆé™æ€æ–‡ä»¶</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image19" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image19.png" srcset="/img/loading.gif" alt="img"></a></p>
<h1 id="å››ã€è¯¾ç¨‹è¯¦ç»†é¡µé¢é™æ€åŒ–"><a href="#å››ã€è¯¾ç¨‹è¯¦ç»†é¡µé¢é™æ€åŒ–" class="headerlink" title="å››ã€è¯¾ç¨‹è¯¦ç»†é¡µé¢é™æ€åŒ–"></a>å››ã€è¯¾ç¨‹è¯¦ç»†é¡µé¢é™æ€åŒ–</h1><h2 id="1-é™æ€é¡µé¢æµ‹è¯•"><a href="#1-é™æ€é¡µé¢æµ‹è¯•" class="headerlink" title="1. é™æ€é¡µé¢æµ‹è¯•"></a>1. é™æ€é¡µé¢æµ‹è¯•</h2><h3 id="1ã€é¡µé¢å†…å®¹ç»„æˆ"><a href="#1ã€é¡µé¢å†…å®¹ç»„æˆ" class="headerlink" title="1ã€é¡µé¢å†…å®¹ç»„æˆ"></a>1ã€é¡µé¢å†…å®¹ç»„æˆ</h3><p>æˆ‘ä»¬åœ¨ç¼–å†™ä¸€ä¸ªé¡µé¢æ—¶éœ€è¦çŸ¥é“å“ªäº›ä¿¡æ¯æ˜¯é™æ€ä¿¡æ¯ï¼Œå“ªäº›ä¿¡æ¯ä¸ºåŠ¨æ€ä¿¡æ¯ï¼Œä¸‹å›¾æ˜¯é¡µé¢çš„è®¾è®¡å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image20" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image20.png" srcset="/img/loading.gif" alt="img"></a></p>
<ul>
<li>æ‰“å¼€é™æ€é¡µé¢ï¼Œè§‚å¯Ÿæ¯éƒ¨åˆ†çš„å†…å®¹ã€‚</li>
<li>çº¢è‰²è¡¨ç¤ºåŠ¨æ€ä¿¡æ¯ï¼Œçº¢è‰²ä»¥å¤–è¡¨ç¤ºé™æ€ä¿¡æ¯ã€‚</li>
<li>çº¢è‰²åŠ¨æ€ä¿¡æ¯ï¼šè¡¨ç¤ºä¸€ä¸ªæŒ‰é’®ï¼Œæ ¹æ®ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€è¯¾ç¨‹çš„è´­ä¹°çŠ¶æ€æ˜¾ç¤ºæŒ‰é’®çš„åç§°åŠæŒ‰é’®çš„äº‹ä»¶ã€‚</li>
</ul>
<p>åŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯å†…å®¹ï¼š</p>
<p><strong>1ã€è¯¾ç¨‹ä¿¡æ¯</strong><br>è¯¾ç¨‹æ ‡é¢˜ã€ä»·æ ¼ã€è¯¾ç¨‹ç­‰çº§ã€æˆè¯¾æ¨¡å¼ã€è¯¾ç¨‹å›¾ç‰‡ã€è¯¾ç¨‹ä»‹ç»ã€è¯¾ç¨‹ç›®å½•ã€‚</p>
<p><strong>2ã€è¯¾ç¨‹ç»Ÿè®¡ä¿¡æ¯</strong><br>è¯¾ç¨‹æ—¶é•¿ã€è¯„åˆ†ã€æ”¶è—äººæ•°</p>
<p><strong>3ã€æ•™è‚²æœºæ„ä¿¡æ¯</strong><br>å…¬å¸åç§°ã€å…¬å¸ç®€ä»‹</p>
<p><strong>4ã€æ•™è‚²æœºæ„ç»Ÿè®¡ä¿¡æ¯</strong><br>å¥½è¯„æ•°ã€è¯¾ç¨‹æ•°ã€å­¦ç”Ÿäººæ•°</p>
<p><strong>5ã€æ•™å¸ˆä¿¡æ¯</strong><br>è€å¸ˆåç§°ã€è€å¸ˆä»‹ç»</p>
<h3 id="2ã€é¡µé¢æ‹†åˆ†"><a href="#2ã€é¡µé¢æ‹†åˆ†" class="headerlink" title="2ã€é¡µé¢æ‹†åˆ†"></a>2ã€é¡µé¢æ‹†åˆ†</h3><ol>
<li><p>æœ¬é¡µå¤´æ–‡ä»¶å’Œé—¨æˆ·ä½¿ç”¨çš„é¡µå¤´ä¸ºåŒä¸€ä¸ªæ–‡ä»¶ã€‚<br>å‚è€ƒï¼š<code>ä»£ç \é¡µé¢ä¸æ¨¡æ¿\include\header.html</code></p>
</li>
<li><p>é¡µé¢å°¾<br>æœ¬é¡µå°¾æ–‡ä»¶å’Œé—¨æˆ·ä½¿ç”¨çš„é¡µå°¾ä¸ºåŒä¸€ä¸ªæ–‡ä»¶ã€‚<br>å‚è€ƒï¼š<code>ä»£ç \é¡µé¢ä¸æ¨¡æ¿\include\footer.html</code></p>
</li>
<li><p>è¯¾ç¨‹è¯¦æƒ…ä¸»é¡µé¢<br>æ¯ä¸ªè¯¾ç¨‹å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åè§„åˆ™ä¸ºï¼š<code>è¯¾ç¨‹id.html</code>ï¼ˆè¯¾ç¨‹idåŠ¨æ€å˜åŒ–ï¼‰<br>æ¨¡æ¿é¡µé¢å‚è€ƒï¼š<code>\ä»£ç \é¡µé¢ä¸æ¨¡æ¿\course\detail\course_main_template.html</code></p>
</li>
<li><p>æ•™è‚²æœºæ„é¡µé¢<br>æ¯ä¸ªæ•™è‚²æœºæ„å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å‘½åè§„åˆ™ä¸ºï¼š<code>company_info_å…¬å¸id.html</code>ï¼ˆå…¬å¸idåŠ¨æ€å˜åŒ–ï¼‰<br>å‚è€ƒï¼š<code>ä»£ç \é¡µé¢ä¸æ¨¡æ¿\company\company_info_template.html</code></p>
</li>
<li><p>è€å¸ˆä¿¡æ¯é¡µé¢<br>æ¯ä¸ªæ•™å¸ˆä¿¡æ¯å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å‘½åè§„åˆ™ä¸ºï¼š<code>teacher_info_æ•™å¸ˆid.html</code>ï¼ˆæ•™å¸ˆidåŠ¨æ€å˜åŒ–ï¼‰</p>
<p>å‚è€ƒï¼š<code>ä»£ç  \é¡µé¢ä¸æ¨¡æ¿\teacher\teacher_info_template01.html</code></p>
</li>
<li><p>è¯¾ç¨‹ç»Ÿè®¡é¡µé¢<br>æ¯ä¸ªè¯¾ç¨‹å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å‘½åè§„åˆ™ä¸ºï¼š<code>course_stat_è¯¾ç¨‹id.json</code>ï¼ˆè¯¾ç¨‹idåŠ¨æ€å˜åŒ–ï¼‰<br>å‚è€ƒï¼š<code>\ä»£ç \é¡µé¢ä¸æ¨¡æ¿\stat\course\course_stat_template.json</code></p>
</li>
<li><p>æ•™è‚²æœºæ„ç»Ÿè®¡é¡µé¢<br>æ¯ä¸ªæ•™è‚²æœºæ„å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å‘½åè§„åˆ™ä¸ºï¼š<code>company_stat_å…¬å¸id.json</code>ï¼ˆå…¬å¸idåŠ¨æ€å˜åŒ–ï¼‰<br>å‚è€ƒï¼š<code>\ä»£ç \é¡µé¢ä¸æ¨¡æ¿\stat\company\company_stat_template.json</code></p>
</li>
</ol>
<h3 id="3ã€é¡µé¢æµ‹è¯•"><a href="#3ã€é¡µé¢æµ‹è¯•" class="headerlink" title="3ã€é¡µé¢æµ‹è¯•"></a>3ã€é¡µé¢æµ‹è¯•</h3><h4 id="1ï¼‰é¡µé¢åŠ è½½æ€è·¯"><a href="#1ï¼‰é¡µé¢åŠ è½½æ€è·¯" class="headerlink" title="1ï¼‰é¡µé¢åŠ è½½æ€è·¯"></a>1ï¼‰é¡µé¢åŠ è½½æ€è·¯</h4><p>æ‰“å¼€è¯¾ç¨‹èµ„æ–™ä¸­çš„ â€œé™æ€é¡µé¢ç›®å½•â€ ä¸­çš„è¯¾ç¨‹è¯¦æƒ…æ¨¡æ¿é¡µé¢ï¼Œç ”ç©¶é¡µé¢åŠ è½½çš„æ€è·¯ã€‚</p>
<p>æ¨¡æ¿é¡µé¢è·¯å¾„å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs html">é™æ€é¡µé¢ç›®å½•\static\course\detail\course_main_template.html</code></pre></div>

<ul>
<li><p>ä¸»é¡µé¢</p>
<p>æˆ‘ä»¬éœ€è¦åœ¨ä¸»é¡µé¢ä¸­é€šè¿‡SSIåŠ è½½ï¼šé¡µå¤´ã€é¡µå°¾ã€æ•™è‚²æœºæ„ã€æ•™å¸ˆä¿¡æ¯</p>
</li>
<li><p>å¼‚æ­¥åŠ è½½è¯¾ç¨‹ç»Ÿè®¡ä¸æ•™è‚²æœºæ„ç»Ÿè®¡ä¿¡æ¯</p>
<p>è¯¾ç¨‹ç»Ÿè®¡ä¿¡æ¯ï¼ˆjsonï¼‰ã€æ•™è‚²æœºæ„ç»Ÿè®¡ä¿¡æ¯ï¼ˆjsonï¼‰</p>
</li>
<li><p>é©¬ä¸Šå­¦ä¹ æŒ‰é’®äº‹ä»¶</p>
<p>ç”¨æˆ·ç‚¹å‡»â€œé©¬ä¸Šå­¦ä¹ â€ä¼šæ ¹æ®è¯¾ç¨‹æ”¶è´¹æƒ…å†µã€è¯¾ç¨‹è´­ä¹°æƒ…å†µæ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</p>
</li>
</ul>
<h4 id="2ï¼‰é™æ€èµ„æºè™šæ‹Ÿä¸»æœº"><a href="#2ï¼‰é™æ€èµ„æºè™šæ‹Ÿä¸»æœº" class="headerlink" title="2ï¼‰é™æ€èµ„æºè™šæ‹Ÿä¸»æœº"></a>2ï¼‰é™æ€èµ„æºè™šæ‹Ÿä¸»æœº</h4><p>é™æ€èµ„æºè™šæ‹Ÿä¸»æœºè´Ÿè´£å¤„ç†è¯¾ç¨‹è¯¦æƒ…ã€å…¬å¸ä¿¡æ¯ã€è€å¸ˆä¿¡æ¯ã€ç»Ÿè®¡ä¿¡æ¯ç­‰é¡µé¢çš„è¯·æ±‚ï¼š</p>
<p>å°†è¯¾ç¨‹èµ„æ–™ä¸­çš„ â€œ<strong>é™æ€é¡µé¢ç›®å½•</strong>â€ ä¸­çš„ç›®å½•æ‹·è´åˆ° <code>F:/develop/xuecheng/static</code> ä¸‹</p>
<p>åœ¨nginxä¸­é…ç½®é™æ€è™šæ‹Ÿä¸»æœºå¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs c">#å­¦æˆç½‘é™æ€èµ„æº
server &#123;
	<span class="hljs-built_in">listen</span>       <span class="hljs-number">91</span>;    
	server_name localhost;    
	#å…¬å¸ä¿¡æ¯    
	location /<span class="hljs-keyword">static</span>/company/ &#123;      
		alias  G:/job/code/Project/XueChengOnline/xcEduUI01/xuecheng/<span class="hljs-keyword">static</span>/company/; 
	&#125;
	#è€å¸ˆä¿¡æ¯    
	location /<span class="hljs-keyword">static</span>/teacher/ &#123;      
		alias G:/job/code/Project/XueChengOnline/xcEduUI01/xuecheng/<span class="hljs-keyword">static</span>/teacher/;        
	&#125;     
	#ç»Ÿè®¡ä¿¡æ¯    
	location /<span class="hljs-keyword">static</span>/stat/ &#123;      
		alias G:/job/code/Project/XueChengOnline/xcEduUI01/xuecheng/<span class="hljs-keyword">static</span>/stat/;        
	&#125;     
	location /course/detail/ &#123;      
		alias G:/job/code/Project/XueChengOnline/xcEduUI01/xuecheng/<span class="hljs-keyword">static</span>/course/detail/;        
	&#125;     
&#125;</code></pre></div>

<p><strong>é€šè¿‡ <a href="http://www.xuecheng.com" target="_blank" rel="noopener">www.xuecheng.com</a> è™šæ‹Ÿä¸»æœºè½¬å‘åˆ°é™æ€èµ„æº</strong></p>
<p>ç”±äºè¯¾ç¨‹é¡µé¢éœ€è¦é€šè¿‡SSIåŠ è½½é¡µå¤´å’Œé¡µå°¾æ‰€ä»¥éœ€è¦é€šè¿‡ <code>www.xuecheng.com</code> è™šæ‹Ÿä¸»æœºè½¬å‘åˆ°é™æ€èµ„æº<br>åœ¨ <code>www.xuecheng.com</code> è™šæ‹Ÿä¸»æœºåŠ å…¥å¦‚ä¸‹é…ç½®ï¼š</p>
<div class="hljs"><pre><code class="hljs c">#é™æ€é¡µé¢èµ„æº
location /<span class="hljs-keyword">static</span>/company/ &#123; 
    proxy_pass http:<span class="hljs-comment">//static_server_pool;        </span>
&#125;     
location /<span class="hljs-keyword">static</span>/teacher/ &#123;      
    proxy_pass http:<span class="hljs-comment">//static_server_pool;        </span>
&#125;     
location /<span class="hljs-keyword">static</span>/stat/ &#123;      
    proxy_pass http:<span class="hljs-comment">//static_server_pool;        </span>
&#125;     
location /course/detail/ &#123;      
    proxy_pass http:<span class="hljs-comment">//static_server_pool;        </span>
&#125;</code></pre></div>

<p>é…ç½® <code>upstream</code> å®ç°è¯·æ±‚è½¬å‘åˆ°èµ„æºæœåŠ¡è™šæ‹Ÿä¸»æœºï¼š</p>
<div class="hljs"><pre><code class="hljs c">#é™æ€èµ„æºæœåŠ¡
upstream static_server_pool&#123;
	server <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">91</span> weight=<span class="hljs-number">10</span>;
&#125;</code></pre></div>

<h4 id="3ï¼‰é—¨æˆ·é™æ€èµ„æºè·¯å¾„"><a href="#3ï¼‰é—¨æˆ·é™æ€èµ„æºè·¯å¾„" class="headerlink" title="3ï¼‰é—¨æˆ·é™æ€èµ„æºè·¯å¾„"></a>3ï¼‰é—¨æˆ·é™æ€èµ„æºè·¯å¾„</h4><p>é—¨æˆ·ä¸­çš„ä¸€äº›å›¾ç‰‡ã€æ ·å¼ç­‰é™æ€èµ„æºç»Ÿä¸€é€šè¿‡ <code>/static</code> è·¯å¾„å¯¹å¤–æä¾›æœåŠ¡ï¼Œåœ¨ <code>www.xuecheng.com</code> è™šæ‹Ÿä¸»æœºä¸­é…ç½®å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs c">#é™æ€èµ„æºï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ‰€éœ€è¦çš„å›¾ç‰‡ï¼Œjsã€cssç­‰é™æ€èµ„æº    
location /<span class="hljs-keyword">static</span>/img/ &#123;      
    alias   G:/job/code/Project/XueChengOnline/xcEduUI01/xc-ui-pc-<span class="hljs-keyword">static</span>-portal/img/;        
&#125;
location /<span class="hljs-keyword">static</span>/css/ &#123;      
    alias   G:/job/code/Project/XueChengOnline/xcEduUI01/xc-ui-pc-<span class="hljs-keyword">static</span>-portal/css/;        
&#125;     
location /<span class="hljs-keyword">static</span>/js/ &#123;      
    alias   G:/job/code/Project/XueChengOnline/xcEduUI01/xc-ui-pc-<span class="hljs-keyword">static</span>-portal/js/;        
&#125;     
location /<span class="hljs-keyword">static</span>/plugins/ &#123;      
    # è·¨åŸŸå‚æ•°
    alias   G:/job/code/Project/XueChengOnline/xcEduUI01/xc-ui-pc-<span class="hljs-keyword">static</span>-portal/plugins/;        
    add_header Access-Control-Allow-Origin http:<span class="hljs-comment">//ucenter.xuecheng.com;          </span>
    add_header Access-Control-Allow-Credentials <span class="hljs-literal">true</span>;          
    add_header Access-Control-Allow-Methods GET;        
&#125;</code></pre></div>

<p>cors è·¨åŸŸå‚æ•°ï¼š</p>
<ul>
<li>Access-Control-Allow-Originï¼šå…è®¸è·¨åŸŸè®¿é—®çš„å¤–åŸŸåœ°å€å¦‚æœå…è®¸ä»»ä½•ç«™ç‚¹è·¨åŸŸè®¿é—®åˆ™è®¾ç½®ä¸º*ï¼Œé€šå¸¸è¿™æ˜¯ä¸å»ºè®®çš„ã€‚</li>
<li>Access-Control-Allow-Credentialsï¼š å…è®¸å®¢æˆ·ç«¯æºå¸¦è¯ä¹¦è®¿é—®</li>
<li>Access-Control-Allow-Methodsï¼šå…è®¸å®¢æˆ·ç«¯è·¨åŸŸè®¿é—®çš„æ–¹æ³•</li>
</ul>
<h4 id="4ï¼‰é¡µé¢æµ‹è¯•"><a href="#4ï¼‰é¡µé¢æµ‹è¯•" class="headerlink" title="4ï¼‰é¡µé¢æµ‹è¯•"></a>4ï¼‰é¡µé¢æµ‹è¯•</h4><p>è¯·æ±‚ï¼š<a href="http://www.xuecheng.com/course/detail/course_main_template.html" target="_blank" rel="noopener">http://www.xuecheng.com/course/detail/course_main_template.html</a> æµ‹è¯•è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ¨¡æ¿æ˜¯å¦å¯ä»¥æ­£å¸¸æµè§ˆã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image21" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image21.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="5ï¼‰é¡µé¢åŠ¨æ€è„šæœ¬"><a href="#5ï¼‰é¡µé¢åŠ¨æ€è„šæœ¬" class="headerlink" title="5ï¼‰é¡µé¢åŠ¨æ€è„šæœ¬"></a>5ï¼‰é¡µé¢åŠ¨æ€è„šæœ¬</h4><p>ä¸ºäº†æ–¹ä¾¿æ—¥åçš„ç»´æŠ¤ï¼Œæˆ‘ä»¬å°† <code>javascript</code> å®ç°çš„åŠ¨æ€éƒ¨åˆ†å•ç‹¬ç¼–å†™ä¸€ä¸ª <code>html</code> æ–‡ä»¶,åœ¨é—¨æˆ·çš„ <code>include</code>ç›®å½•ä¸‹å®šä¹‰ <code>course_detail_dynamic.html</code> æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶é€šè¿‡ <code>ssi</code> åŒ…å«åœ¨è¯¾ç¨‹è¯¦æƒ…é¡µé¢ä¸­.</p>
<p>æ–‡ä»¶åœ°å€ï¼š<code>èµ„æ–™ \é™æ€é¡µé¢ç›®å½•\include\course_detail_dynamic.html</code></p>
<p>æ‰€æœ‰çš„è¯¾ç¨‹å…¬ç”¨ä¸€ä¸ª é¡µé¢åŠ¨æ€è„šæœ¬ã€‚</p>
<p>åœ¨è¯¾ç¨‹è¯¦æƒ…ä¸»é¡µé¢ä¸‹ç«¯æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œé€šè¿‡ <code>SSI</code> æŠ€æœ¯åŒ…å«è¯¾ç¨‹è¯¦æƒ…é¡µé¢åŠ¨æ€è„šæœ¬æ–‡ä»¶ï¼š</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="actionscript"><span class="hljs-keyword">var</span> courseId = <span class="hljs-string">"template"</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-comment">&lt;!--#include virtual="/include/course_detail_dynamic.html"--&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>

<p>æœ¬é¡µé¢ä½¿ç”¨ <code>vue.js</code> åŠ¨æ€è·å–ä¿¡æ¯ï¼Œä½¿ç”¨ vue çš„ <code>created</code> é’©å­å‡½æ•°åœ¨é¡µé¢åˆå§‹åŒ–å‰è·å–åŠ¨æ€çš„æ•°æ®ï¼Œè¯¦ç»†è¯·é˜…è¯»è¯¥æ–‡ä»¶ã€‚</p>
<h2 id="2-è¯¾ç¨‹æ•°æ®æ¨¡å‹æ¥å£"><a href="#2-è¯¾ç¨‹æ•°æ®æ¨¡å‹æ¥å£" class="headerlink" title="2. è¯¾ç¨‹æ•°æ®æ¨¡å‹æ¥å£"></a>2. è¯¾ç¨‹æ•°æ®æ¨¡å‹æ¥å£</h2><h3 id="1ã€APIæ¥å£å®šä¹‰"><a href="#1ã€APIæ¥å£å®šä¹‰" class="headerlink" title="1ã€APIæ¥å£å®šä¹‰"></a>1ã€APIæ¥å£å®šä¹‰</h3><p>æ•°æ®æ¨¡å‹</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.course.ext;

<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseBase;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseMarket;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CoursePic;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.ToString;

<span class="hljs-keyword">import</span> java.io.Serializable;

<span class="hljs-comment">//Serializable ?</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseView</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;
    CourseBase courseBase; <span class="hljs-comment">//è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span>
    CourseMarket courseMarket; <span class="hljs-comment">//è¯¾ç¨‹è¥é”€ä¿¡æ¯</span>
    CoursePic coursePic;  <span class="hljs-comment">//è¯¾ç¨‹å›¾ç‰‡</span>
    TeachplanNode teachplanNode; <span class="hljs-comment">//è¯¾ç¨‹è¥é”€è®¡åˆ’</span>
&#125;</code></pre></div>

<p>API æ¥å£ï¼Œå† <code>CourseControllerApi</code> ä¸‹å®šä¹‰</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è¯¾ç¨‹è§†å›¾æŸ¥è¯¢"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CourseView <span class="hljs-title">courseView</span><span class="hljs-params">(String courseId)</span></span>;</code></pre></div>

<h3 id="2ã€Dao"><a href="#2ã€Dao" class="headerlink" title="2ã€Dao"></a>2ã€Dao</h3><p>æ ¹æ®æ•°æ®æ¨¡å‹ï¼Œdao å±‚æˆ‘ä»¬å¯ä»¥æ²¿ç”¨ä¹‹å‰å¼€å‘ä¸­å®šä¹‰çš„</p>
<ul>
<li><code>CourseBaseRepository</code></li>
<li><code>CourseMarketRepository</code></li>
<li><code>CoursePicRepository</code></li>
<li><code>TeachplanMapper</code></li>
</ul>
<h3 id="3ã€Service"><a href="#3ã€Service" class="headerlink" title="3ã€Service"></a>3ã€Service</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * è·å–è¯¾ç¨‹è§†å›¾æ•°æ®æ¨¡å‹</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CourseView <span class="hljs-title">getCourseView</span><span class="hljs-params">(String courseId)</span> </span>&#123;
    CourseView courseView = <span class="hljs-keyword">new</span> CourseView();
    <span class="hljs-comment">//è·å–è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span>
    Optional&lt;CourseBase&gt; courseBaseOptional = courseBaseRepository.findById(courseId);
    <span class="hljs-keyword">if</span>(courseBaseOptional.isPresent())&#123;
        CourseBase courseBase = courseBaseOptional.get();
        courseView.setCourseBase(courseBase);
    &#125;

    <span class="hljs-comment">//è·å–è¯¾ç¨‹è¥é”€ä¿¡æ¯</span>
    CourseMarket courseMarketById = courseMarketService.findCourseMarketById(courseId);
    courseView.setCourseMarket(courseMarketById);

    <span class="hljs-comment">//è·å–è¯¾ç¨‹å›¾ç‰‡</span>
    Optional&lt;CoursePic&gt; coursePicOptional = coursePicRepository.findById(courseId);
    <span class="hljs-keyword">if</span>(coursePicOptional.isPresent())&#123;
        CoursePic coursePic = coursePicOptional.get();
        courseView.setCoursePic(coursePic);
    &#125;

    <span class="hljs-comment">//è·å–è¯¾ç¨‹è®¡åˆ’</span>
    TeachplanNode teachplanNode = teachplanMapper.selectList(courseId);
    courseView.setTeachplanNode(teachplanNode);
    <span class="hljs-keyword">return</span> courseView;
&#125;</code></pre></div>

<h3 id="4ã€Controller"><a href="#4ã€Controller" class="headerlink" title="4ã€Controller"></a>4ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">     * è¯¾ç¨‹é¢„è§ˆæ•°æ®æ¨¡å‹æŸ¥è¯¢</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseId</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/Courseview/&#123;id&#125;"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CourseView <span class="hljs-title">courseView</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String courseId) </span>&#123;
    <span class="hljs-keyword">return</span> courseService.getCourseView(courseId);
&#125;</code></pre></div>

<h3 id="5ã€æµ‹è¯•"><a href="#5ã€æµ‹è¯•" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><p>åœ¨ Swagger ä¸­æµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image22" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image22.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-è¯¾ç¨‹ä¿¡æ¯æ¨¡æ¿è®¾è®¡"><a href="#3-è¯¾ç¨‹ä¿¡æ¯æ¨¡æ¿è®¾è®¡" class="headerlink" title="3. è¯¾ç¨‹ä¿¡æ¯æ¨¡æ¿è®¾è®¡"></a>3. è¯¾ç¨‹ä¿¡æ¯æ¨¡æ¿è®¾è®¡</h2><p>åœ¨ç¡®å®šäº†é™æ€åŒ–æ‰€éœ€è¦çš„æ•°æ®æ¨¡å‹ä¹‹åï¼Œå°±å¯ä»¥ç¼–å†™é¡µé¢æ¨¡æ¿äº†ï¼Œè¯¾ç¨‹è¯¦æƒ…é¡µé¢ç”±å¤šä¸ªé™æ€åŒ–é¡µé¢ç»„æˆï¼Œæ‰€ä»¥æˆ‘ä»¬<br>éœ€è¦åˆ›å»ºå¤šä¸ªé¡µé¢æ¨¡æ¿ï¼Œæœ¬ç« èŠ‚åˆ›å»ºè¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„ä¸»æ¨¡æ¿ï¼Œå³è¯¾ç¨‹ä¿¡æ¯æ¨¡æ¿ã€‚</p>
<h3 id="1ã€æ¨¡æ¿å†…å®¹"><a href="#1ã€æ¨¡æ¿å†…å®¹" class="headerlink" title="1ã€æ¨¡æ¿å†…å®¹"></a>1ã€æ¨¡æ¿å†…å®¹</h3><p>å®Œæ•´çš„æ¨¡æ¿è¯·å‚è€ƒ <code>èµ„æ–™\è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ¨¡æ¿\course.ftl</code> æ–‡ä»¶ï¼Œä¸‹è¾¹åˆ—å‡ºæ¨¡æ¿ä¸­æ ¸å¿ƒçš„å†…å®¹ï¼š</p>
<ul>
<li><p>è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"banner-left"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tit"</span>&gt;</span>$&#123;courseBase.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pic"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"new-pic"</span>&gt;</span>ç‰¹æƒ ä»·æ ¼ï¿¥$&#123;courseMarket.price&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span>
<span class="hljs-tag">                                                                                 <span class="hljs-attr">class</span>=<span class="hljs-string">"old-pic"</span>&gt;</span>åŸä»·ï¿¥$&#123;courseMarket.price_old!&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://ucenter.xuecheng.com/#/learning/$&#123;courseBase.id&#125;/0"</span> </span>
<span class="hljs-tag">           <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"learnstatus == 1"</span> <span class="hljs-attr">v-cloak</span>&gt;</span>é©¬ä¸Šå­¦ä¹ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>  @<span class="hljs-attr">click</span>=<span class="hljs-string">"addopencourse"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"learnstatus == 2"</span> <span class="hljs-attr">v-cloak</span>&gt;</span>ç«‹å³æŠ¥å<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>  @<span class="hljs-attr">click</span>=<span class="hljs-string">"buy"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"learnstatus == 3"</span> <span class="hljs-attr">v-cloak</span>&gt;</span>ç«‹å³è´­ä¹°<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>éš¾åº¦ç­‰çº§<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">courseBase.grade</span>==<span class="hljs-string">'200001'</span>&gt;</span>        
                ä½çº§        
                <span class="hljs-tag">&lt;<span class="hljs-name">#elseif</span> <span class="hljs-attr">courseBase.grade</span>==<span class="hljs-string">'200002'</span>&gt;</span>
                    ä¸­çº§        
                    <span class="hljs-tag">&lt;<span class="hljs-name">#elseif</span> <span class="hljs-attr">courseBase.grade</span>==<span class="hljs-string">'200003'</span>&gt;</span>        
                        é«˜çº§        
                        <span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>        
                    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>è¯¾ç¨‹æ—¶é•¿<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">stat</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">"course_stat.s601001"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">stat</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>è¯„åˆ†<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">stat</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">"course_stat.s601002"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">stat</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>æˆè¯¾æ¨¡å¼<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">courseBase.studymodel</span>==<span class="hljs-string">'201001'</span>&gt;</span>
                        è‡ªç”±å­¦ä¹         
                        <span class="hljs-tag">&lt;<span class="hljs-name">#elseif</span> <span class="hljs-attr">courseBase.studymodel</span>==<span class="hljs-string">'201002'</span>&gt;</span>
                            ä»»åŠ¡å¼å­¦ä¹         
                            <span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span> 
                        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"banner-rit"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">coursePic.pic</span>??&gt;</span>    
                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://img.xuecheng.com/$&#123;coursePic.pic&#125;"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"270"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"156"</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

                    <span class="hljs-tag">&lt;<span class="hljs-name">#else</span>&gt;</span>    
                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/img/widget-video.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"270"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"156"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>        
                        <span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>    

                    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"vid-act"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"i-heart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>æ”¶è— <span class="hljs-tag">&lt;<span class="hljs-name">stat</span> <span class="hljs-attr">v-</span></span>
<span class="hljs-tag">                                                                              <span class="hljs-attr">text</span>=<span class="hljs-string">"course_stat.s601003"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">stat</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>åˆ†äº« <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"i-weixin"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"i-qq"</span>&gt;</span>
                        <span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>
</li>
<li><p>è¯¾ç¨‹è®¡åˆ’</p>
</li>
</ul>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">teachplanNode.children</span>??&gt;</span>            
        <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">teachplanNode.children</span> <span class="hljs-attr">as</span> <span class="hljs-attr">firstNode</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title act"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"i-chevron-top"</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>$&#123;firstNode.pname&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"about"</span>&gt;</span>$&#123;firstNode.description!&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"drop-down"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: $&#123;firstNode.children?</span></span>
<span class="hljs-tag"><span class="hljs-string">                                              size * 50&#125;px;"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-box"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">firstNode.children</span> <span class="hljs-attr">as</span> <span class="hljs-attr">secondNode</span>&gt;</span>
                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>$&#123;secondNode.pname&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
                            <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>

<ul>
<li>é¡µå¤´å¼•å…¥</li>
</ul>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">data-spy</span>=<span class="hljs-string">"scroll"</span> <span class="hljs-attr">data-target</span>=<span class="hljs-string">"#articleNavbar"</span> <span class="hljs-attr">data-offset</span>=<span class="hljs-string">"150"</span>&gt;</span> 
<span class="hljs-comment">&lt;!-- é¡µé¢å¤´éƒ¨ --&gt;</span>
<span class="hljs-comment">&lt;!--#include virtual="/include/header.html"--&gt;</span></code></pre></div>

<ul>
<li>é¡µå°¾å¼•å…¥</li>
</ul>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--  é¡µé¢åº•éƒ¨ --&gt;</span>
<span class="hljs-comment">&lt;!--åº•éƒ¨ç‰ˆæƒ--&gt;</span>
<span class="hljs-comment">&lt;!--#include virtual="/include/footer.html"--&gt;</span></code></pre></div>

<ul>
<li>åŠ¨æ€è„šæœ¬æ–‡ä»¶å¼•å…¥</li>
</ul>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span> 
<span class="actionscript">    <span class="hljs-comment">//è¯¾ç¨‹id</span></span>
<span class="actionscript">    <span class="hljs-keyword">var</span> courseId = <span class="hljs-string">"template"</span></span>
<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-comment">&lt;!--#include virtual="/include/course_detail_dynamic.html"--&gt;</span></code></pre></div>

<ul>
<li><p>æ•™å¸ˆä¿¡æ¯</p>
<p>ä»è¯¾ç¨‹æ•°æ®ä¸­è·å–è¯¾ç¨‹æ‰€å±çš„æ•™å¸ˆIdï¼Œè¿™é‡Œç”±äºæ•™å¸ˆä¿¡æ¯ç®¡ç†åŠŸèƒ½æ²¡æœ‰å¼€å‘æˆ‘ä»¬ä½¿ç”¨å›ºå®šçš„æ•™å¸ˆä¿¡æ¯æ–‡ä»¶</p>
</li>
</ul>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content-com course"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>è¯¾ç¨‹åˆ¶ä½œ<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!--#include virtual="/teacher/teacher_info_template01.html"--&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>

<ul>
<li><p>æ•™è‚²æœºæ„æ–‡ä»¶</p>
<p>åŒæ•™å¸ˆä¿¡æ¯ä¸€æ ·ï¼Œç”±äºæ•™è‚²æœºæ„åŠŸèƒ½æ¨¡å—æ²¡æœ‰å¼€å‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å›ºå®šçš„æ•™è‚²æœºæ„æ–‡ä»¶</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"about-teach"</span>&gt;</span> 
    <span class="hljs-comment">&lt;!--æœºæ„ä¿¡æ¯--&gt;</span>
    <span class="hljs-comment">&lt;!--#include virtual="/company/company_info_template.html"--&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>

</li>
</ul>
<h3 id="2ã€æ¨¡æ¿æµ‹è¯•"><a href="#2ã€æ¨¡æ¿æµ‹è¯•" class="headerlink" title="2ã€æ¨¡æ¿æµ‹è¯•"></a>2ã€æ¨¡æ¿æµ‹è¯•</h3><p>ä½¿ç”¨test-freemarkerå·¥ç¨‹æµ‹è¯•æ¨¡æ¿</p>
<p>ç¼–å†™æ¨¡æ¿è¿‡ç¨‹é‡‡ç”¨test-freemarkerå·¥ç¨‹æµ‹è¯•æ¨¡æ¿ã€‚</p>
<p>å°† <code>course.ftl</code> æ‹·è´åˆ° <code>test-freemarker</code> å·¥ç¨‹çš„ <code>resources/templates</code> ä¸‹ï¼Œå¹¶åœ¨ <code>test-freemarker</code> å·¥ç¨‹çš„<code>controller</code> ä¸­åŠ æµ‹è¯•æ–¹æ³•ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//è¯¾ç¨‹è¯¦æƒ…é¡µé¢æµ‹è¯•</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/course"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">course</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span></span>&#123;
    ResponseEntity&lt;Map&gt; forEntity =
restTemplate.getForEntity(<span class="hljs-string">"http://localhost:31200/course/courseview/4028e581617f945f01617f9dabc40000"</span>, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
    Map body = forEntity.getBody();
    map.put(<span class="hljs-string">"model"</span>,body);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"course"</span>;
&#125;</code></pre></div>

<p>æ³¨æ„ï¼šä¸Šè¾¹çš„æµ‹è¯•é¡µé¢ä¸æ˜¾ç¤ºæ ·å¼ï¼ŒåŸå› æ˜¯é¡µé¢é€šè¿‡ <code>SSI</code> åŒ…å«äº†é¡µé¢å¤´ï¼Œè€Œä½¿ç”¨ <code>test-freemarker</code> å·¥ç¨‹æ— æ³•åŠ è½½é¡µå¤´ï¼Œæµ‹è¯•æ¨¡æ¿ä¸»è¦æŸ¥çœ‹ <code>html</code> é¡µé¢å†…å®¹æ˜¯å¦æ­£ç¡®ï¼Œå¾…è¯¾ç¨‹é¢„è§ˆæ—¶è§£å†³æ ·å¼ä¸æ˜¾ç¤ºé—®é¢˜ã€‚</p>
<h3 id="3ã€æ¨¡æ¿ä¿å­˜"><a href="#3ã€æ¨¡æ¿ä¿å­˜" class="headerlink" title="3ã€æ¨¡æ¿ä¿å­˜"></a>3ã€æ¨¡æ¿ä¿å­˜</h3><p>æ¨¡æ¿ç¼–å†™å¹¶æµ‹è¯•é€šè¿‡åè¦åœ¨æ•°æ®åº“ä¿å­˜ï¼š</p>
<p>1ã€æ¨¡æ¿ä¿¡æ¯ä¿å­˜åœ¨ <code>xc_cms</code> æ•°æ®åº“(mongodb)çš„ <code>cms_template</code>è¡¨<br>2ã€æ¨¡æ¿æ–‡ä»¶ä¿å­˜åœ¨ <code>mongodb</code> çš„ <code>GridFS</code> ä¸­ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬åœ¨ <code>cms</code> æœåŠ¡çš„å•å…ƒæµ‹è¯•ä¸­è¿›è¡Œä¿å­˜ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//å­˜æ–‡ä»¶</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGridFs</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> FileNotFoundException </span>&#123;
    <span class="hljs-comment">//è¦å‚¨å­˜çš„æ–‡ä»¶</span>
    File file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"d:/resources/course.ftl"</span>);
    <span class="hljs-comment">//å®šä¹‰è¾“å…¥æµ</span>
    FileInputStream fileInputStream = <span class="hljs-keyword">new</span> FileInputStream(file);
    <span class="hljs-comment">//å‘GridFSå­˜å‚¨æ–‡ä»¶</span>
    ObjectId objectId = gridFsTemplate.store(fileInputStream, <span class="hljs-string">"index-banner"</span>);
    <span class="hljs-comment">//å¾—åˆ°æ–‡ä»¶ID</span>
    String fileId = objectId.toString();
    System.out.println(fileId);

&#125;</code></pre></div>

<p>ä¿å­˜æˆåŠŸéœ€è¦è®°å½•æ¨¡æ¿æ–‡ä»¶çš„idï¼Œå³ä¸Šè¾¹ä»£ç ä¸­çš„fileIdã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šå‘ <code>cms_template</code> è¡¨æ·»åŠ æ¨¡æ¿è®°å½•ï¼ˆè¯·ä¸è¦é‡å¤æ·»åŠ ï¼‰</p>
<p>ä½¿ç”¨ <code>Studio 3T</code> è¿æ¥<code>mongodb</code>ï¼Œå‘ <code>cms_template</code> æ·»åŠ è®°å½•ï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
  <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsTemplate"</span>,
  <span class="hljs-attr">"siteId"</span> : <span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>,
  <span class="hljs-attr">"templateName"</span> : <span class="hljs-string">"è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ­£å¼æ¨¡æ¿"</span>,
  <span class="hljs-attr">"templateFileId"</span> : <span class="hljs-string">"5e93d284cc53e43424beea42"</span>
&#125;</code></pre></div>

<h3 id="4ã€å…¶ä»–æ¨¡æ¿"><a href="#4ã€å…¶ä»–æ¨¡æ¿" class="headerlink" title="4ã€å…¶ä»–æ¨¡æ¿"></a>4ã€å…¶ä»–æ¨¡æ¿</h3><p>é™¤äº†è¯¾ç¨‹è¯¦æƒ…ä¸»é¡µé¢éœ€è¦è®¾è®¡æ¨¡æ¿æ‰€æœ‰é™æ€åŒ–çš„é¡µé¢éƒ½è¦è®¾è®¡æ¨¡æ¿ï¼Œå¦‚ä¸‹ï¼š</p>
<p><code>æ•™è‚²æœºæ„é¡µé¢æ¨¡æ¿</code>ã€<code>æ•™å¸ˆä¿¡æ¯é¡µé¢æ¨¡æ¿</code>ã€<code>è¯¾ç¨‹ç»Ÿè®¡ä¿¡æ¯jsonæ¨¡æ¿</code>ã€<code>æ•™è‚²æœºæ„ç»Ÿè®¡ä¿¡æ¯jsonæ¨¡æ¿</code>ã€‚</p>
<p>æœ¬é¡¹ç›®æˆ‘ä»¬å®ç°è¯¾ç¨‹è¯¦æƒ…ä¸»é¡µé¢æ¨¡æ¿çš„åˆ¶ä½œå’Œæµ‹è¯•ï¼Œå…¶å®ƒé¡µé¢æ¨¡æ¿çš„å¼€å‘å‚è€ƒè¯¾ç¨‹è¯¦æƒ…é¡µé¢å»å®ç°ã€‚</p>
<h1 id="äº”ã€è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¼€å‘"><a href="#äº”ã€è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¼€å‘" class="headerlink" title="äº”ã€è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¼€å‘"></a>äº”ã€è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¼€å‘</h1><h2 id="1-éœ€æ±‚åˆ†æ-2"><a href="#1-éœ€æ±‚åˆ†æ-2" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å°†ä½¿ç”¨ <code>cms</code> ç³»ç»Ÿæä¾›çš„é¡µé¢é¢„è§ˆåŠŸèƒ½ï¼Œä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p>
<p>1ã€ç”¨æˆ·è¿›å…¥è¯¾ç¨‹ç®¡ç†é¡µé¢ï¼Œç‚¹å‡»è¯¾ç¨‹é¢„è§ˆï¼Œè¯·æ±‚åˆ°è¯¾ç¨‹ç®¡ç†æœåŠ¡</p>
<p>2ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨ <code>cms</code> æ·»åŠ é¡µé¢æ¥å£å‘ <code>cms</code> æ·»åŠ è¯¾ç¨‹è¯¦æƒ…é¡µé¢</p>
<p>3ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡å¾—åˆ° <code>cms</code> è¿”å›è¯¾ç¨‹è¯¦æƒ…é¡µé¢ <code>id</code>ï¼Œå¹¶æ‹¼æ¥ç”Ÿæˆè¯¾ç¨‹é¢„è§ˆ <code>Url</code></p>
<p>4ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡å°†è¯¾ç¨‹é¢„è§ˆ <code>Url</code> ç»™å‰ç«¯è¿”å›</p>
<p>5ã€ç”¨æˆ·åœ¨å‰ç«¯é¡µé¢è¯·æ±‚è¯¾ç¨‹é¢„è§ˆ <code>Url</code> ï¼Œæ‰“å¼€æ–°çª—å£æ˜¾ç¤ºè¯¾ç¨‹è¯¦æƒ…å†…å®¹</p>
<h2 id="2-CMSé¡µé¢é¢„è§ˆæµ‹è¯•"><a href="#2-CMSé¡µé¢é¢„è§ˆæµ‹è¯•" class="headerlink" title="2. CMSé¡µé¢é¢„è§ˆæµ‹è¯•"></a>2. CMSé¡µé¢é¢„è§ˆæµ‹è¯•</h2><p><code>CMS</code> æœåŠ¡å·²ç»æä¾›äº†é¡µé¢é¢„è§ˆåŠŸèƒ½ï¼Œè¯¾ç¨‹é¢„è§ˆåŠŸèƒ½è¦ä½¿ç”¨ <code>CMS</code> é¡µé¢é¢„è§ˆæ¥å£å®ç°ï¼Œä¸‹è¾¹é€šè¿‡ <code>cms</code> é¡µé¢é¢„è§ˆæ¥å£æµ‹è¯•è¯¾ç¨‹é¢„è§ˆçš„æ•ˆæœã€‚</p>
<p><strong>1ã€å‘ cms_page è¡¨æ’å…¥ä¸€æ¡é¡µé¢è®°å½•æˆ–è€…ä» cms_page æ‰¾ä¸€ä¸ªé¡µé¢è¿›è¡Œæµ‹è¯•ã€‚</strong></p>
<p>æ³¨æ„ï¼šé¡µé¢é…ç½®ä¸€å®šè¦æ­£ç¡®ï¼Œéœ€è®¾ç½®æ­£ç¡®çš„æ¨¡æ¿ <code>id</code> å’Œ <code>dataUrl</code>ã€‚</p>
<p>å¦‚ä¸‹ï¼Œæ˜¯ä¸€æ¡é¡µé¢çš„è®°å½•ã€‚</p>
<div class="hljs"><pre><code class="hljs json">&#123; 
    <span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5b3469f794db44269cb2bff1"</span>), 
    <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsPage"</span>, 
    <span class="hljs-attr">"siteId"</span> : <span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>, 
    <span class="hljs-attr">"pageName"</span> : <span class="hljs-string">"4028e581617f945f01617f9dabc40000.html"</span>, 
    <span class="hljs-attr">"pageAliase"</span> : <span class="hljs-string">"bootstripè¯¾ç¨‹è¯¦æƒ…é¡µé¢"</span>, 
    <span class="hljs-attr">"pageWebPath"</span> : <span class="hljs-string">"/course/detail/"</span>, 
    <span class="hljs-attr">"pagePhysicalPath"</span> : <span class="hljs-string">"/course/detail/"</span>, 
    <span class="hljs-attr">"pageType"</span> : <span class="hljs-string">"1"</span>, 
    <span class="hljs-attr">"pageCreateTime"</span> : ISODate(<span class="hljs-string">"2018-02-03T05:37:53.256+0000"</span>), 
    <span class="hljs-attr">"templateId"</span> : <span class="hljs-string">"5e93d2e3d79e7d6ed1009b95"</span>, 
    <span class="hljs-attr">"dataUrl"</span> : <span class="hljs-string">"http://localhost:31200/course/courseview/4028e581617f945f01617f9dabc40000"</span>
&#125;</code></pre></div>

<p><strong>2ã€è¯¾ç¨‹è¯¦ç»†é¡µé¢ ä½¿ç”¨ ssi æ³¨æ„</strong></p>
<p>ç”±äº <code>Nginx</code> å…ˆè¯·æ±‚ <code>cms</code> çš„è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¾—åˆ° <code>html</code> é¡µé¢ï¼Œå†è§£æé¡µé¢ä¸­çš„ <code>ssi</code> æ ‡ç­¾ï¼Œè¿™é‡Œå¿…é¡»ä¿è¯ <code>cms</code> é¡µé¢é¢„è§ˆè¿”å›çš„é¡µé¢çš„ <code>Content-Type</code> ä¸º <code>text/html;charset=utf-8</code></p>
<p>åœ¨ <code>cms</code> é¡µé¢é¢„è§ˆçš„ <code>controller</code> æ–¹æ³•ä¸­æ·»åŠ ï¼š</p>
<div class="hljs"><pre><code class="hljs html">response.setHeader("Content-type","text/html;charset=utf-8");</code></pre></div>

<p><strong>3ã€æµ‹è¯•</strong></p>
<p>è¯·æ±‚ï¼š<a href="http://www.xuecheng.com/cms/preview/5b3469f794db44269cb2bff1%E4%BC%A0%E5%85%A5%E9%A1%B5%E9%9D%A2" target="_blank" rel="noopener">http://www.xuecheng.com/cms/preview/5b3469f794db44269cb2bff1ä¼ å…¥é¡µé¢</a> Idï¼Œæµ‹è¯•æ•ˆæœå¦‚ä¸‹:</p>
<h2 id="3-CMSæ·»åŠ é¡µé¢æ¥å£"><a href="#3-CMSæ·»åŠ é¡µé¢æ¥å£" class="headerlink" title="3. CMSæ·»åŠ é¡µé¢æ¥å£"></a>3. CMSæ·»åŠ é¡µé¢æ¥å£</h2><p>åœ¨ä¹‹å‰è¿›è¡Œ <code>cms</code> æœåŠ¡çš„å¼€å‘ä¸­ï¼Œå·²ç»å¼€å‘æœ‰é¡µé¢æ·»åŠ çš„æ¥å£ï¼Œä¸ºä»€ä¹ˆè¿˜è¦é‡æ–°å†™ä¸€ä¸ªï¼Ÿ</p>
<p>å› ä¸ºæ¯æ¬¡è¿›è¡Œè¯¾ç¨‹é¢„è§ˆéƒ½éœ€è¦è¿›è¡Œé¡µé¢æ·»åŠ çš„æ“ä½œï¼Œå¦‚æœé¡µé¢å·²ç»å­˜åœ¨åˆ™ä¸éœ€è¦é‡å¤æ·»åŠ ï¼Œåªéœ€è¦æ‰§è¡Œæ›´æ–°æ“ä½œå³å¯ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åœ¨ cmsæœåŠ¡ä¸­ å®ç°ä¸€ä¸ª <code>save</code> æ¥å£ï¼šå¦‚æœä¸å­˜åœ¨é¡µé¢åˆ™æ·»åŠ ï¼Œå¦åˆ™å°±æ›´æ–°é¡µé¢ä¿¡æ¯ã€‚</p>
<h3 id="1ã€API-æ¥å£"><a href="#1ã€API-æ¥å£" class="headerlink" title="1ã€API æ¥å£"></a>1ã€API æ¥å£</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ä¿å­˜é¡µé¢æ•°æ®</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"ä¿å­˜é¡µé¢æ•°æ®"</span>)
<span class="hljs-meta">@ApiImplicitParams</span>(&#123;
        <span class="hljs-meta">@ApiImplicitParam</span>(name=<span class="hljs-string">"cmsPage"</span>,value = <span class="hljs-string">"è¯·æäº¤jsonå½¢å¼çš„é¡µé¢æ•°æ®"</span>,required=<span class="hljs-keyword">true</span>,paramType=<span class="hljs-string">"CmsPage"</span>,dataType=<span class="hljs-string">"CmsPage"</span>),
&#125;)
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">saveCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span></span>;</code></pre></div>

<h3 id="2ã€Service"><a href="#2ã€Service" class="headerlink" title="2ã€Service"></a>2ã€Service</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ä¿å­˜é¡µé¢ï¼šå¦‚æœä¸å­˜åœ¨åˆ™æ·»åŠ ï¼Œå­˜åœ¨åˆ™æ›´æ–°ã€‚</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> cmsPage</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">saveCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;
    <span class="hljs-comment">//æ•ˆéªŒcmsPageæ˜¯å¦ä¸ºç©º</span>
    <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;
        <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸ï¼Œéæ³•å‚æ•°</span>
        ExceptionCast.cast(CommonCode.INVALID_PARAM);
    &#125;

    <span class="hljs-comment">//éªŒè¯æ•°æ®å”¯ä¸€æ€§ï¼šsizeIdã€pageNameã€pageWebPath</span>
    CmsPage one = cmsPageRepository.findByPageNameAndSiteIdAndPageWebPath(cmsPage.getPageName(), cmsPage.getSiteId(), cmsPage.getPageWebPath());

    <span class="hljs-comment">//å¦‚æœé¡µé¢å·²å­˜åœ¨åˆ™è¿›è¡Œæ›´æ–°æ“ä½œ</span>
    <span class="hljs-keyword">if</span> (cmsPage1 != <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.updateCmsPage(one.getPageId(),one);
    &#125;
    <span class="hljs-comment">//ä¸å­˜åœ¨åˆ™ç›´æ¥æ·»åŠ </span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.addCmsPage(cmsPage);
&#125;</code></pre></div>

<h3 id="3ã€Controller"><a href="#3ã€Controller" class="headerlink" title="3ã€Controller"></a>3ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ä¿å­˜é¡µé¢</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> cmsPage</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/save"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">saveCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;
    <span class="hljs-keyword">return</span> pageService.saveCmsPage(cmsPage);
&#125;</code></pre></div>

<h2 id="4-è¯¾ç¨‹é¢„è§ˆæœåŠ¡ç«¯"><a href="#4-è¯¾ç¨‹é¢„è§ˆæœåŠ¡ç«¯" class="headerlink" title="4. è¯¾ç¨‹é¢„è§ˆæœåŠ¡ç«¯"></a>4. è¯¾ç¨‹é¢„è§ˆæœåŠ¡ç«¯</h2><h3 id="1ã€API-å®šä¹‰"><a href="#1ã€API-å®šä¹‰" class="headerlink" title="1ã€API å®šä¹‰"></a>1ã€API å®šä¹‰</h3><p>æ­¤ <code>Api</code> æ˜¯è¯¾ç¨‹ç®¡ç†å‰ç«¯è¯·æ±‚æœåŠ¡ç«¯è¿›è¡Œè¯¾ç¨‹é¢„è§ˆçš„Api</p>
<p>è¯·æ±‚ï¼šè¯¾ç¨‹ <code>Id</code></p>
<p>å“åº”ï¼šçŠ¶æ€ç ï¼Œè¯¾ç¨‹é¢„è§ˆ <code>Url</code></p>
<p>1ã€å®šä¹‰å“åº”ç±»å‹</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoursePublishResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;
    String previewUrl;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CoursePublishResult</span><span class="hljs-params">(ResultCode resultCode, String previewUrl)</span> </span>&#123;
        <span class="hljs-keyword">super</span>(resultCode);
        <span class="hljs-keyword">this</span>.previewUrl = previewUrl;
    &#125;
&#125;</code></pre></div>

<p>2ã€æ¥å£å®šä¹‰å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è¯¾ç¨‹å‘å¸ƒé¢„è§ˆ"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">CoursePublishPreview</span><span class="hljs-params">(String courseId)</span></span>;</code></pre></div>

<h3 id="2ã€åˆ›å»º-Feign-Client"><a href="#2ã€åˆ›å»º-Feign-Client" class="headerlink" title="2ã€åˆ›å»º Feign Client"></a>2ã€åˆ›å»º Feign Client</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/cms/page/save"</span>)
<span class="hljs-function">CmsPageResult <span class="hljs-title">saveCmsPage</span><span class="hljs-params">(@RequestBody CmsPage cmsPage)</span></span>;</code></pre></div>

<h3 id="3ã€Service-1"><a href="#3ã€Service-1" class="headerlink" title="3ã€Service"></a>3ã€Service</h3><div class="hljs"><pre><code class="hljs java"> <span class="hljs-comment">//ä»é…ç½®æ–‡ä»¶è·å–è¯¾ç¨‹å‘å¸ƒçš„åŸºæœ¬é…ç½®</span>
<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.dataUrlPre&#125;"</span>)
<span class="hljs-keyword">private</span> String publish_dataUrlPre;
<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.pagePhysicalPath&#125;"</span>)
<span class="hljs-keyword">private</span> String publish_page_physicalpath;
<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.pageWebPath&#125;"</span>)
<span class="hljs-keyword">private</span> String publish_page_webpath;
<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.siteId&#125;"</span>)
<span class="hljs-keyword">private</span> String publish_siteId;
<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.templateId&#125;"</span>)
<span class="hljs-keyword">private</span> String publish_templateId;
<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.previewUrl&#125;"</span>)
<span class="hljs-keyword">private</span> String previewUrl;

<span class="hljs-meta">@Autowired</span>
CmsPageClient cmsPageClient;

<span class="hljs-comment">//æ ¹æ®idæŸ¥è¯¢è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CourseBase <span class="hljs-title">findCourseBaseById</span><span class="hljs-params">(String courseId)</span></span>&#123;
    <span class="hljs-comment">//è·å–è¯¾ç¨‹ä¿¡æ¯</span>
    Optional&lt;CourseBase&gt; optionalCourseBase = courseBaseRepository.findById(courseId);
    <span class="hljs-keyword">if</span>(!optionalCourseBase.isPresent())&#123;
        <span class="hljs-comment">//è¯¾ç¨‹ä¸å­˜åœ¨æŠ›å‡ºå¼‚å¸¸</span>
        ExceptionCast.cast(CourseCode.COURSE_NOTEXIST);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;
    <span class="hljs-keyword">return</span> optionalCourseBase.get();
&#125;
<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * è¯¾ç¨‹è¯¦ç»†é¡µé¢å‘å¸ƒå‰é¢„è§ˆ</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">coursePublishPreview</span><span class="hljs-params">(String courseId)</span> </span>&#123;
    <span class="hljs-comment">//è·å–è¯¾ç¨‹ä¿¡æ¯</span>
    CourseBase courseBaseById = <span class="hljs-keyword">this</span>.findCourseBaseById(courseId);

    <span class="hljs-comment">//æ‹¼è£…é¡µé¢åŸºæœ¬ä¿¡æ¯</span>
    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();
    cmsPage.setDataUrl(publish_dataUrlPre + courseId);
    cmsPage.setPagePhysicalPath(publish_page_physicalpath);
    cmsPage.setPageWebPath(publish_page_webpath);
    cmsPage.setSiteId(publish_siteId);
    cmsPage.setTemplateId(publish_templateId);

    <span class="hljs-comment">//é¡µé¢åˆ«å</span>
    cmsPage.setPageAliase(courseBaseById.getName());

    <span class="hljs-comment">//è¿œç¨‹è°ƒç”¨ï¼Œä¿å­˜é¡µé¢ä¿¡æ¯</span>
    CmsPageResult cmsPageResult = cmsPageClient.saveCmsPage(cmsPage);
    <span class="hljs-keyword">if</span>(!cmsPageResult.isSuccess())&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CoursePublishResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);
    &#125;

    <span class="hljs-comment">//é¡µé¢id</span>
    String cmsPageId = cmsPageResult.getCmsPage().getPageId();
    <span class="hljs-comment">//è¿”å›é¢„è§ˆurl</span>
    String url = previewUrl + cmsPageId;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CoursePublishResult(CommonCode.SUCCESS,url);
&#125;</code></pre></div>

<h3 id="4ã€Controller-1"><a href="#4ã€Controller-1" class="headerlink" title="4ã€Controller"></a>4ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">     * å‘å¸ƒé¡µé¢</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageId</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">*/</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/postPage/&#123;pageId&#125;"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">post</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"pageId"</span>)</span> String pageId) </span>&#123;
    <span class="hljs-keyword">return</span> pageService.postPage(pageId);
&#125;</code></pre></div>

<h3 id="5ã€æµ‹è¯•-1"><a href="#5ã€æµ‹è¯•-1" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><p>å…ˆåœ¨ course æœåŠ¡ä¸­çš„ swagger è¿›è¡Œæµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image23" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image23.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å¾—åˆ°é¢„è§ˆurlï¼Œè®¿é—®æµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image24" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image24.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>è¿™é‡Œå®é™…ä¸ŠåªåŠ¨æ€æ¸²æŸ“äº†è¯¾ç¨‹éƒ¨åˆ†çš„æ•°æ®ï¼Œä¾‹å¦‚è¯¾ç¨‹åç§°ï¼Œè¯¾ç¨‹ä»‹ç»ç­‰ï¼Œæ•™å¸ˆä¿¡æ¯å’Œå…¬å¸ä»‹ç»ç­‰éƒ½æ˜¯é™æ€æ•°æ®ï¼Œéœ€è¦åæœŸè¿›è¡Œå®Œå–„ã€‚</p>
<h2 id="5-å‰ç«¯å¼€å‘"><a href="#5-å‰ç«¯å¼€å‘" class="headerlink" title="5. å‰ç«¯å¼€å‘"></a>5. å‰ç«¯å¼€å‘</h2><p>1ã€API æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/*é¢„è§ˆè¯¾ç¨‹*/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> preview = <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> &#123;
  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/course/preview/'</span>+id);
&#125;</code></pre></div>

<p>2ã€é¡µé¢</p>
<p>åˆ›å»º <code>course_pub.vue</code></p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span> 
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">elâ€card</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"boxâ€card"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"header"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"clearfix"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>è¯¾ç¨‹é¢„è§ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text item"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>  @<span class="hljs-attr">click.native</span>=<span class="hljs-string">"preview"</span> &gt;</span>è¯¾ç¨‹é¢„è§ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">if</span>=<span class="hljs-string">"previewurl &amp;&amp; previewurl!=''"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">"previewurl"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>ç‚¹æˆ‘æŸ¥çœ‹è¯¾
ç¨‹é¢„è§ˆé¡µé¢ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€card</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre></div>

<p>æ•°æ®å¯¹è±¡ï¼š</p>
<div class="hljs"><pre><code class="hljs js">data() &#123; 
  <span class="hljs-keyword">return</span> &#123;
    dotype:<span class="hljs-string">''</span>,
    courseid:<span class="hljs-string">''</span>,
    course: &#123;<span class="hljs-string">"id"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"status"</span>:<span class="hljs-string">""</span>&#125;,
    previewurl:<span class="hljs-string">''</span>
  &#125;</code></pre></div>

<p>æ–¹æ³• ï¼š</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// é¢„è§ˆ</span>
preview()&#123;
  courseApi.preview(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span>(res.success)&#123;
      <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'é¢„è§ˆé¡µé¢ç”ŸæˆæˆåŠŸï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹é¢„è§ˆé“¾æ¥'</span>);
           <span class="hljs-keyword">if</span>(res.url)&#123; 
        <span class="hljs-comment">//é¢„è§ˆurl</span>
        <span class="hljs-keyword">this</span>.previewurl = res.url
      &#125;
    &#125;<span class="hljs-keyword">else</span>&#123;
      <span class="hljs-keyword">this</span>.$message.error(res.message);
    &#125;
  &#125;);
&#125;</code></pre></div>

<p>3ã€æµ‹è¯•</p>
<p>ç‚¹å‡»é¢„è§ˆåæˆåŠŸé“¾æ¥</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image25" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image25.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>è®¿é—®é¢„è§ˆé“¾æ¥</p>
<p><a href="https://qnoss.codeyee.com/20200704_9/image26" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image26.png" srcset="/img/loading.gif" alt="img"></a></p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">å­¦æˆåœ¨çº¿</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Eureka/">Eureka</a>
                    
                      <a class="hover-with-bg" href="/tags/Feign/">Feign</a>
                    
                      <a class="hover-with-bg" href="/tags/Ribbon/">Ribbon</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day10ï¼šè¯¾ç¨‹å‘å¸ƒã€ElasticSearch</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/">
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day08ï¼šFastDFSå®ç°è¯¾ç¨‹å›¾ç‰‡ç®¡ç†</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

ä»£ç å—js ç”¨ä¸åˆ°ï¼Œfulidè‡ªå¸¦æœ‰ï¼Œæ·»åŠ cssæ ·å¼å³å¯å®ç°
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®å­—</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å‹‰å¼ºè¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">äº¬ICPè¯20000725å·</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=20000725"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>äº¬å…¬ç½‘å®‰å¤‡20000725å·</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "å­¦æˆåœ¨çº¿day09ï¼šEurekaã€Feignã€è¯¾ç¨‹é¢„è§ˆå®ç°&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
