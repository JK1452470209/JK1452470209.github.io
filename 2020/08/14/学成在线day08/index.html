<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>å­¦æˆåœ¨çº¿day08ï¼šFastDFSå®ç°è¯¾ç¨‹å›¾ç‰‡ç®¡ç† - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ç§äººåšå®¢</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äºæˆ‘
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-14 11:34">
      2020-08-14
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.2k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      98
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p>
</blockquote>
<p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day08</code> çš„å†…å®¹</p>
<ul>
<li><code>FastDFS</code> çš„ å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨æµç¨‹ã€‚</li>
<li>åŸºäº <code>Java Api</code> æ¥æ“ä½œ <code>FastDFS</code></li>
<li>ç»“åˆ <code>FastDFS</code> å®ç°å¯¹è¯¾ç¨‹å›¾ç‰‡çš„ <code>CRUD</code></li>
<li>å›¾ç‰‡åˆ é™¤çš„åœºæ™¯ä½¿ç”¨ <code>Promise</code> è§£å†³ä¸€äº›é—®é¢˜</li>
</ul>
<h1 id="ä¸€ã€FastDFS-æ¢ç©¶"><a href="#ä¸€ã€FastDFS-æ¢ç©¶" class="headerlink" title="ä¸€ã€FastDFS æ¢ç©¶"></a>ä¸€ã€FastDFS æ¢ç©¶</h1><h2 id="1-ä»€ä¹ˆæ˜¯fastDFS"><a href="#1-ä»€ä¹ˆæ˜¯fastDFS" class="headerlink" title="1. ä»€ä¹ˆæ˜¯fastDFS ?"></a>1. ä»€ä¹ˆæ˜¯fastDFS ?</h2><h3 id="1ã€ä»‹ç»"><a href="#1ã€ä»‹ç»" class="headerlink" title="1ã€ä»‹ç»"></a>1ã€ä»‹ç»</h3><p>FastDFSæ˜¯ç”¨cè¯­è¨€ç¼–å†™çš„ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯ç”±æ·˜å®èµ„æ·±æ¶æ„å¸ˆä½™åº†ç¼–å†™å¹¶å¼€æºã€‚FastDFSä¸“ä¸ºäº’è”ç½‘é‡èº«å®šåˆ¶ï¼Œå……åˆ†è€ƒè™‘äº†å†—ä½™å¤‡ä»½ã€è´Ÿè½½å‡è¡¡ã€çº¿æ€§æ‰©å®¹ç­‰æœºåˆ¶ï¼Œå¹¶æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ ‡ï¼Œä½¿ç”¨FastDFSå¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰æœåŠ¡ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ <code>fastDFS</code> å‘¢ï¼Ÿ</p>
<p>ä¸Šè¾¹ä»‹ç»çš„ <code>NFS</code>ã€<code>GFS</code> éƒ½æ˜¯é€šç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œé€šç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜ç‚¹çš„æ˜¯å¼€å‘ä½“éªŒå¥½ï¼Œä½†æ˜¯ç³»ç»Ÿå¤æ‚æ€§é«˜ã€æ€§èƒ½ä¸€èˆ¬ï¼Œè€Œä¸“ç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè™½ç„¶å¼€å‘ä½“éªŒæ€§å·®ï¼Œä½†æ˜¯ç³»ç»Ÿå¤æ‚æ€§ä½å¹¶ä¸”æ€§èƒ½é«˜ã€‚<code>fastDFS</code> éå¸¸é€‚åˆå­˜å‚¨å›¾ç‰‡ç­‰é‚£äº›å°æ–‡ä»¶ï¼Œ<code>fastDFS</code> ä¸å¯¹æ–‡ä»¶è¿›è¡Œåˆ†å—ï¼Œæ‰€ä»¥å®ƒå°±æ²¡æœ‰åˆ†å—åˆå¹¶çš„å¼€é”€ï¼Œ<code>fastDFS</code> ç½‘ç»œé€šä¿¡é‡‡ç”¨ <code>socket</code>ï¼Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«ã€‚</p>
<h3 id="2ã€å·¥ä½œåŸç†"><a href="#2ã€å·¥ä½œåŸç†" class="headerlink" title="2ã€å·¥ä½œåŸç†"></a>2ã€å·¥ä½œåŸç†</h3><p><code>FastDFS</code> æ¶æ„åŒ…æ‹¬ <code>Tracker server</code> å’Œ <code>Storageserver</code>ã€‚å®¢æˆ·ç«¯è¯·æ±‚ <code>Tracker server</code> è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ï¼Œé€šè¿‡ <code>Tracker server</code> è°ƒåº¦æœ€ç»ˆç”± <code>Storage server</code> å®Œæˆæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image1" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image1.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>1ï¼‰Tracker</strong></p>
<p>Tracker Serverä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡å’Œè°ƒåº¦ï¼Œé€šè¿‡Tracker serveråœ¨æ–‡ä»¶ä¸Šä¼ æ—¶å¯ä»¥æ ¹æ®ä¸€äº›ç­–ç•¥æ‰¾åˆ°Storage serveræä¾›æ–‡ä»¶ä¸Šä¼ æœåŠ¡ã€‚å¯ä»¥å°† <code>tracker</code> ç§°ä¸ºè¿½è¸ªæœåŠ¡å™¨æˆ–è°ƒåº¦æœåŠ¡å™¨ã€‚</p>
<p><code>FastDFS</code> é›†ç¾¤ä¸­çš„ <code>Tracker server</code> å¯ä»¥æœ‰å¤šå°ï¼Œ<code>Tracker server</code> ä¹‹é—´æ˜¯ç›¸äº’å¹³ç­‰å…³ç³»åŒæ—¶æä¾›æœåŠ¡ï¼Œ<code>Tracker server</code> ä¸å­˜åœ¨å•ç‚¹æ•…éšœã€‚å®¢æˆ·ç«¯è¯·æ±‚ <code>Tracker server</code> é‡‡ç”¨è½®è¯¢æ–¹å¼ï¼Œå¦‚æœè¯·æ±‚çš„ <code>tracker</code> æ— æ³•æä¾›æœåŠ¡åˆ™æ¢å¦ä¸€ä¸ª <code>tracker</code>ã€‚</p>
<p><strong>2ï¼‰Storage</strong></p>
<p><code>Storage Server</code> ä½œç”¨æ˜¯æ–‡ä»¶å­˜å‚¨ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶æœ€ç»ˆå­˜å‚¨åœ¨ <code>Storage</code> æœåŠ¡å™¨ä¸Šï¼Œ<code>Storage server</code> æ²¡æœ‰å®ç°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿè€Œæ˜¯ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ¥ç®¡ç†æ–‡ä»¶ã€‚å¯ä»¥å°† <code>storage</code> ç§°ä¸ºå­˜å‚¨æœåŠ¡å™¨ã€‚</p>
<p><code>Storage</code> é›†ç¾¤é‡‡ç”¨äº†åˆ†ç»„å­˜å‚¨æ–¹å¼ã€‚<code>storage</code> é›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç»„æ„æˆï¼Œé›†ç¾¤å­˜å‚¨æ€»å®¹é‡ä¸ºé›†ç¾¤ä¸­æ‰€æœ‰ç»„çš„å­˜å‚¨å®¹é‡ä¹‹å’Œã€‚ä¸€ä¸ªç»„ç”±ä¸€å°æˆ–å¤šå°å­˜å‚¨æœåŠ¡å™¨ç»„æˆï¼Œç»„å†…çš„ <code>Storage server</code> ä¹‹é—´æ˜¯å¹³ç­‰å…³ç³»ï¼Œä¸åŒç»„çš„ <code>Storage server</code> ä¹‹é—´ä¸ä¼šç›¸äº’é€šä¿¡ï¼ŒåŒç»„å†…çš„ <code>Storage server</code> ä¹‹é—´ä¼šç›¸äº’è¿æ¥è¿›è¡Œæ–‡ä»¶åŒæ­¥ï¼Œä»è€Œä¿è¯åŒç»„å†…æ¯ä¸ªstorageä¸Šçš„æ–‡ä»¶å®Œå…¨ä¸€è‡´çš„ã€‚ä¸€ä¸ªç»„çš„å­˜å‚¨å®¹é‡ä¸ºè¯¥ç»„å†…çš„å­˜å‚¨æœåŠ¡å™¨å®¹é‡æœ€å°çš„é‚£ä¸ªï¼Œç”±æ­¤å¯è§ç»„å†…å­˜å‚¨æœåŠ¡å™¨çš„è½¯ç¡¬ä»¶é…ç½®æœ€å¥½æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>é‡‡ç”¨åˆ†ç»„å­˜å‚¨æ–¹å¼çš„å¥½å¤„æ˜¯çµæ´»ã€å¯æ§æ€§è¾ƒå¼ºã€‚æ¯”å¦‚ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ç”±å®¢æˆ·ç«¯ç›´æ¥æŒ‡å®šä¸Šä¼ åˆ°çš„ç»„ä¹Ÿå¯ä»¥ç”± <code>tracker</code> è¿›è¡Œè°ƒåº¦é€‰æ‹©ã€‚ä¸€ä¸ªåˆ†ç»„çš„å­˜å‚¨æœåŠ¡å™¨è®¿é—®å‹åŠ›è¾ƒå¤§æ—¶ï¼Œå¯ä»¥åœ¨è¯¥ç»„å¢åŠ å­˜å‚¨æœåŠ¡å™¨æ¥æ‰©å……æœåŠ¡èƒ½åŠ›ï¼ˆçºµå‘æ‰©å®¹ï¼‰ã€‚å½“ç³»ç»Ÿå®¹é‡ä¸è¶³æ—¶ï¼Œå¯ä»¥å¢åŠ ç»„æ¥æ‰©å……å­˜å‚¨å®¹é‡ï¼ˆæ¨ªå‘æ‰©å®¹ï¼‰ã€‚</p>
<p><strong>3ï¼‰StorageçŠ¶æ€æ”¶é›†</strong></p>
<p><code>Storage server</code> ä¼šè¿æ¥é›†ç¾¤ä¸­æ‰€æœ‰çš„ <code>Tracker server</code>ï¼Œå®šæ—¶å‘ä»–ä»¬æŠ¥å‘Šè‡ªå·±çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ç£ç›˜å‰©ä½™ç©ºé—´ã€æ–‡ä»¶åŒæ­¥çŠ¶å†µã€æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ¬¡æ•°ç­‰ç»Ÿè®¡ä¿¡æ¯ã€‚</p>
<h3 id="3ã€æ–‡ä»¶ä¸Šä¼ æµç¨‹"><a href="#3ã€æ–‡ä»¶ä¸Šä¼ æµç¨‹" class="headerlink" title="3ã€æ–‡ä»¶ä¸Šä¼ æµç¨‹"></a>3ã€æ–‡ä»¶ä¸Šä¼ æµç¨‹</h3><p><a href="https://qnoss.codeyee.com/20200704_8/image2" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image2.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶åå­˜å‚¨æœåŠ¡å™¨å°† <code>æ–‡ä»¶ID</code> è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤ <code>æ–‡ä»¶ID</code> ç”¨äºä»¥åè®¿é—®è¯¥æ–‡ä»¶çš„ç´¢å¼•ä¿¡æ¯ã€‚æ–‡ä»¶ç´¢å¼•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šç»„åï¼Œè™šæ‹Ÿç£ç›˜è·¯å¾„ï¼Œæ•°æ®ä¸¤çº§ç›®å½•ï¼Œæ–‡ä»¶åã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image3" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image3.png" srcset="/img/loading.gif" alt="img"></a></p>
<ul>
<li>ç»„åï¼šæ–‡ä»¶ä¸Šä¼ åæ‰€åœ¨çš„ storageç»„åç§°ï¼Œåœ¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸåæœ‰ storageæœåŠ¡å™¨è¿”å›ï¼Œéœ€è¦å®¢æˆ·ç«¯è‡ªè¡Œä¿å­˜ã€‚</li>
<li>è™šæ‹Ÿç£ç›˜è·¯å¾„ï¼š storageé…ç½®çš„è™šæ‹Ÿè·¯å¾„ï¼Œä¸ç£ç›˜é€‰é¡¹ store_path* å¯¹åº”ã€‚å¦‚æœé…ç½®äº†store_path0åˆ™æ˜¯M00ï¼Œå¦‚æœé…ç½®äº†store_path1åˆ™æ˜¯M01ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
<li>æ•°æ®ä¸¤çº§ç›®å½•ï¼š storageæœåŠ¡å™¨åœ¨æ¯ä¸ªè™šæ‹Ÿç£ç›˜è·¯å¾„ä¸‹åˆ›å»ºçš„ä¸¤çº§ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ•°æ®æ–‡ä»¶ã€‚</li>
<li>æ–‡ä»¶åï¼šä¸æ–‡ä»¶ä¸Šä¼ æ—¶ä¸åŒã€‚æ˜¯ç”±å­˜å‚¨æœåŠ¡å™¨æ ¹æ®ç‰¹å®šä¿¡æ¯ç”Ÿæˆï¼Œæ–‡ä»¶ååŒ…å«ï¼šæºå­˜å‚¨æœåŠ¡å™¨ IPåœ°å€ã€æ–‡ä»¶åˆ›å»ºæ—¶é—´æˆ³ã€æ–‡ä»¶å¤§å°ã€éšæœºæ•°å’Œæ–‡ä»¶æ‹“å±•åç­‰ä¿¡æ¯ã€‚</li>
</ul>
<h3 id="4ã€æ–‡ä»¶ä¸‹è½½æµç¨‹"><a href="#4ã€æ–‡ä»¶ä¸‹è½½æµç¨‹" class="headerlink" title="4ã€æ–‡ä»¶ä¸‹è½½æµç¨‹"></a>4ã€æ–‡ä»¶ä¸‹è½½æµç¨‹</h3><p><a href="https://qnoss.codeyee.com/20200704_8/image4" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image4.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><code>tracker</code> æ ¹æ®è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„å³æ–‡ä»¶ID æ¥å¿«é€Ÿå®šä¹‰æ–‡ä»¶ã€‚</p>
<p>æ¯”å¦‚è¯·æ±‚ä¸‹è¾¹çš„æ–‡ä»¶ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image5" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image5.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1.é€šè¿‡ç»„åtrackerèƒ½å¤Ÿå¾ˆå¿«çš„å®šä½åˆ°å®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„å­˜å‚¨æœåŠ¡å™¨ç»„æ˜¯group1ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„å­˜å‚¨æœåŠ¡å™¨æä¾›å®¢æˆ·ç«¯è®¿é—®ã€‚</p>
<p>2.å­˜å‚¨æœåŠ¡å™¨æ ¹æ®â€œæ–‡ä»¶å­˜å‚¨è™šæ‹Ÿç£ç›˜è·¯å¾„â€å’Œâ€œæ•°æ®æ–‡ä»¶ä¸¤çº§ç›®å½•â€å¯ä»¥å¾ˆå¿«å®šä½åˆ°æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå¹¶æ ¹æ®æ–‡ä»¶åæ‰¾åˆ°å®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„æ–‡ä»¶ã€‚</p>
<h2 id="2-FastDFSå…¥é—¨"><a href="#2-FastDFSå…¥é—¨" class="headerlink" title="2. FastDFSå…¥é—¨"></a>2. FastDFSå…¥é—¨</h2><h3 id="1ã€ç¯å¢ƒæ­å»º"><a href="#1ã€ç¯å¢ƒæ­å»º" class="headerlink" title="1ã€ç¯å¢ƒæ­å»º"></a>1ã€ç¯å¢ƒæ­å»º</h3><p>å®‰è£… FastDFS æµç¨‹ å‚è€ƒï¼š <a href="https://www.cnblogs.com/yufeng218/p/8111961.html" target="_blank" rel="noopener">https://www.cnblogs.com/yufeng218/p/8111961.html</a></p>
<p>æ­å»ºå¥½çš„Centos7æˆå“:</p>
<p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1GgUzfd8CnxzemQzvHXSzmA" target="_blank" rel="noopener">https://pan.baidu.com/s/1GgUzfd8CnxzemQzvHXSzmA</a><br>æå–ç ï¼šjk00<br>å¤åˆ¶è¿™æ®µå†…å®¹åæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦</p>
<p><strong>å…·ä½“æ­å»ºè¿‡ç¨‹å®Œå…¨æŒ‰ç…§è¿™ç¯‡åšå®¢å®Œæˆçš„</strong>ï¼š</p>
<p><a href="https://www.cnblogs.com/yufeng218/p/8111961.html" target="_blank" rel="noopener">https://www.cnblogs.com/yufeng218/p/8111961.html</a></p>
<p>æ„Ÿå…´è¶£çš„å¯ä»¥è¯•ç€åšåšã€‚ï¼ˆè‰¯å¿ƒæ–‡ç« ï¼‰</p>
<p>å¦å¤–ï¼Œä½¿ç”¨æˆ‘æ­å»ºå¥½çš„Centos7æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦<strong>æ³¨æ„ä¸€ä¸‹</strong>ã€‚</p>
<h4 id="é…ç½®å’Œå¯åŠ¨storage"><a href="#é…ç½®å’Œå¯åŠ¨storage" class="headerlink" title="é…ç½®å’Œå¯åŠ¨storage"></a>é…ç½®å’Œå¯åŠ¨storage</h4><ol>
<li>cdåˆ‡æ¢ç›®å½•åˆ°ï¼š /etc/fdfs/ ç›®å½•ä¸‹</li>
<li>ä¿®æ”¹storage.conf ;   <strong>vi  storage.conf</strong></li>
</ol>
<div class="hljs"><pre><code class="hljs angelscript">#é…ç½®trackeræœåŠ¡å™¨:IP
tracker_server=<span class="hljs-number">192.168</span><span class="hljs-number">.172</span><span class="hljs-number">.20</span>:<span class="hljs-number">22122</span>
#å¦‚æœæœ‰å¤šä¸ªåˆ™é…ç½®å¤šä¸ªtracker
#tracker_server=<span class="hljs-number">192.168</span><span class="hljs-number">.101</span><span class="hljs-number">.4</span>:<span class="hljs-number">22122</span>
è¿™é‡Œçš„storage.confé…ç½®æ–‡ä»¶è¦æˆè‡ªå·±è™šæ‹Ÿæœºçš„ipåœ°å€</code></pre></div>

<ol start="3">
<li><strong>vi /etc/fdfs/mod_fastdfs.confï¼Œæ”¹æˆè™šæ‹Ÿæœºipåœ°å€ï¼ˆåŒä¸Šï¼‰</strong></li>
</ol>
<div class="hljs"><pre><code class="hljs ini"><span class="hljs-attr">base_path</span>=/home/fastdfs
<span class="hljs-attr">tracker_server</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">172.20</span>:<span class="hljs-number">22122</span> 
<span class="hljs-comment">#tracker_server=192.168.172.20:22122 #(å¤šä¸ªtrackeré…ç½®å¤šè¡Œ)</span>
<span class="hljs-attr">url_have_group_name</span>=<span class="hljs-literal">true</span>        <span class="hljs-comment">#urlä¸­åŒ…å«groupåç§°</span>
<span class="hljs-attr">store_path0</span>=/home/fdfs_storage  <span class="hljs-comment">#æŒ‡å®šæ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼ˆä¸Šé¢é…ç½®çš„storeè·¯å¾„ï¼‰</span></code></pre></div>

<p>ã€€ã€€ã€€ã€€4.ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ï¼Œæ”¹iPåœ°å€ï¼ˆåŒä¸Šï¼‰</p>
<div class="hljs"><pre><code class="hljs stata"><span class="hljs-keyword">cd</span> /usr/<span class="hljs-keyword">local</span>/nginx/<span class="hljs-keyword">conf</span>/
vi nginx.<span class="hljs-keyword">conf</span></code></pre></div>

<p><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/20.png" srcset="/img/loading.gif" alt="img"></p>
<p>æˆ‘çš„Centos7é»˜è®¤é…ç½®<strong>trackerï¼Œ**</strong>storageå’Œnginxé»˜è®¤å¼€æœºè‡ªåŠ¨å¯åŠ¨äº†**</p>
<p>å¯ä»¥å¯åŠ¨å®Œæˆåè¿›å…¥ /home/fdfs_storage/data ç›®å½•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å¯åŠ¨äº†ã€‚</p>
<p><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/21.png" srcset="/img/loading.gif" alt="img"></p>
<p> nginxå¯ä»¥é€šè¿‡ps -ef | grep nginxæŸ¥çœ‹è¿›ç¨‹ï¼Œ</p>
<p><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/22.png" srcset="/img/loading.gif" alt="img"></p>
<h4 id="ä¸Šä¼ å›¾ç‰‡æµ‹è¯•"><a href="#ä¸Šä¼ å›¾ç‰‡æµ‹è¯•" class="headerlink" title="ä¸Šä¼ å›¾ç‰‡æµ‹è¯•"></a>ä¸Šä¼ å›¾ç‰‡æµ‹è¯•</h4><p>æ‹·è´ä¸€å¼ å›¾ç‰‡1.jpg åˆ°CentosæœåŠ¡å™¨ä¸Šçš„ rootç›®å½•ä¸‹,è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤</p>
<div class="hljs"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/fdfs_test /</span>etc<span class="hljs-regexp">/fdfs/</span>client.conf upload <span class="hljs-regexp">/root/</span><span class="hljs-number">1</span>.jpg</code></pre></div>

<p><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/23.png" srcset="/img/loading.gif" alt="img"></p>
<p> çº¢è‰²æ—¢æ˜¯urlåœ°å€ï¼Œåœ¨æµè§ˆå™¨ä¸Šè¾“å…¥ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šä¼ å›¾ç‰‡æˆåŠŸï¼ï¼</p>
<p><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/24.png" srcset="/img/loading.gif" alt="img"></p>
<h3 id="2ã€ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥è¯¢-æµ‹è¯•"><a href="#2ã€ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥è¯¢-æµ‹è¯•" class="headerlink" title="2ã€ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥è¯¢ æµ‹è¯•"></a>2ã€ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥è¯¢ æµ‹è¯•</h3><p>åœ¨å·¥ç¨‹ä¸‹åˆ›å»º <code>test-fastdfs</code> æ¨¡å—</p>
<h4 id="1ï¼‰ä¸Šä¼ æµ‹è¯•"><a href="#1ï¼‰ä¸Šä¼ æµ‹è¯•" class="headerlink" title="1ï¼‰ä¸Šä¼ æµ‹è¯•"></a>1ï¼‰ä¸Šä¼ æµ‹è¯•</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestFastDFS</span> </span>&#123;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æµ‹è¯•æ–‡ä»¶ä¸Šä¼ </span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFileUpload</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-comment">//åŠ è½½é…ç½®æ–‡ä»¶</span>
            ClientGlobal.initByProperties(<span class="hljs-string">"config/fastdfs-client.properties"</span>);
            <span class="hljs-comment">//è¿æ¥ Tracker</span>
            TrackerClient trackerClient = <span class="hljs-keyword">new</span> TrackerClient();
            TrackerServer trackerServer = trackerClient.getConnection();
            <span class="hljs-comment">//è·å– Storage</span>
            StorageServer storeStorage = trackerClient.getStoreStorage(trackerServer);
            <span class="hljs-comment">//åˆ›å»º Storage Client</span>
            StorageClient1 storageClient1 = <span class="hljs-keyword">new</span> StorageClient1(trackerServer, storeStorage);
            <span class="hljs-comment">//å‘ Storage æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶,æ‹¿åˆ°æ–‡ä»¶id</span>
            String filePath = <span class="hljs-string">"d:/test1.html"</span>;
            String fileId = storageClient1.upload_file1(filePath, <span class="hljs-string">"html"</span>, <span class="hljs-keyword">null</span>);
            System.out.println(<span class="hljs-string">"ä¸Šä¼ æˆåŠŸï¼š"</span> + fileId);

        &#125; <span class="hljs-keyword">catch</span> (Exception ex)&#123;
            ex.printStackTrace();
        &#125;
    &#125;
&#125;</code></pre></div>

<p>åœ¨ä¸Šè¿°çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è®¿é—® <code>Tracker</code> å°† <code>d:/test1.html</code> æ–‡ä»¶ä¸Šä¼ åˆ°äº† Storage æœåŠ¡å™¨ä¸­ï¼Œä¸Šä¼ å®Œæˆåå¾—åˆ°äº†æ–‡ä»¶çš„å®Œæ•´çš„å‚¨å­˜è·¯å¾„ï¼Œå¦‚ä¸‹ï¼š</p>
<p><code>group1/M00/00/00/CgEBmF6QKa-Abjv7AAAGqbcDljA60.html</code></p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image6" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image6.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>Storage</code> ä¸­çš„ç‰©ç† <code>fdfs_storage/data</code> è·¯å¾„æ‰¾åˆ°è¯¥æ–‡ä»¶</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image7" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image7.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="2ï¼‰æ–‡ä»¶æŸ¥è¯¢"><a href="#2ï¼‰æ–‡ä»¶æŸ¥è¯¢" class="headerlink" title="2ï¼‰æ–‡ä»¶æŸ¥è¯¢"></a>2ï¼‰æ–‡ä»¶æŸ¥è¯¢</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ–‡ä»¶ä¿¡æ¯æŸ¥è¯¢</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TestFileInfoQuery</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">try</span> &#123;
        <span class="hljs-comment">//åŠ è½½é…ç½®æ–‡ä»¶</span>
        ClientGlobal.initByProperties(<span class="hljs-string">"config/fastdfs-client.properties"</span>);
        <span class="hljs-comment">//è¿æ¥ Tracker</span>
        TrackerClient trackerClient = <span class="hljs-keyword">new</span> TrackerClient();
        TrackerServer trackerServer = trackerClient.getConnection();
        <span class="hljs-comment">//è·å– Storage</span>
        StorageServer storeStorage = trackerClient.getStoreStorage(trackerServer);
        <span class="hljs-comment">//åˆ›å»º Storage Client</span>
        StorageClient1 storageClient1 = <span class="hljs-keyword">new</span> StorageClient1(trackerServer, storeStorage);

        String fileId = <span class="hljs-string">"group1/M00/00/00/CgEBmF6QKa-Abjv7AAAGqbcDljA60.html"</span>;
        FileInfo fileInfo = storageClient1.query_file_info1(fileId);
        System.out.println(<span class="hljs-string">"æ–‡ä»¶ä¿¡æ¯: "</span>+ fileInfo);
    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
        e.printStackTrace();
    &#125;
&#125;</code></pre></div>

<p>è¿è¡Œç»“æœ</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image8" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image8.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="3ï¼‰æ–‡ä»¶ä¸‹è½½"><a href="#3ï¼‰æ–‡ä»¶ä¸‹è½½" class="headerlink" title="3ï¼‰æ–‡ä»¶ä¸‹è½½"></a>3ï¼‰æ–‡ä»¶ä¸‹è½½</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ–‡ä»¶ä¸‹è½½</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TestFileDownload</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">try</span> &#123;
        <span class="hljs-comment">//åŠ è½½é…ç½®æ–‡ä»¶</span>
        ClientGlobal.initByProperties(<span class="hljs-string">"config/fastdfs-client.properties"</span>);
        <span class="hljs-comment">//è¿æ¥ Tracker</span>
        TrackerClient trackerClient = <span class="hljs-keyword">new</span> TrackerClient();
        TrackerServer trackerServer = trackerClient.getConnection();
        <span class="hljs-comment">//è·å– Storage</span>
        StorageServer storeStorage = trackerClient.getStoreStorage(trackerServer);
        <span class="hljs-comment">//åˆ›å»º Storage Client</span>
        StorageClient1 storageClient1 = <span class="hljs-keyword">new</span> StorageClient1(trackerServer, storeStorage);

        String fileId = <span class="hljs-string">"group1/M00/00/00/CgEBmF6QKa-Abjv7AAAGqbcDljA60.html"</span>;
        String saveToPath = <span class="hljs-string">"d:/test.html"</span>;
        <span class="hljs-comment">//ä¸‹è½½æ–‡ä»¶</span>
        <span class="hljs-keyword">byte</span>[] bytes = storageClient1.download_file1(fileId);
        FileOutputStream fileOutputStream = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-keyword">new</span> File(saveToPath));
        fileOutputStream.write(bytes);
        System.out.println(<span class="hljs-string">"ä¸‹è½½æˆåŠŸ! "</span> + saveToPath);
    &#125; <span class="hljs-keyword">catch</span> (Exception ex)&#123;
        ex.printStackTrace();
    &#125;
&#125;</code></pre></div>

<p>è¿è¡Œç»“æœ</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image9" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image9.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="3ã€æ­å»ºå›¾ç‰‡è™šæ‹Ÿä¸»æœº"><a href="#3ã€æ­å»ºå›¾ç‰‡è™šæ‹Ÿä¸»æœº" class="headerlink" title="3ã€æ­å»ºå›¾ç‰‡è™šæ‹Ÿä¸»æœº"></a>3ã€æ­å»ºå›¾ç‰‡è™šæ‹Ÿä¸»æœº</h3><h4 id="1ï¼‰-åœ¨storageä¸Šå®‰è£…Nginx"><a href="#1ï¼‰-åœ¨storageä¸Šå®‰è£…Nginx" class="headerlink" title="1ï¼‰ åœ¨storageä¸Šå®‰è£…Nginx"></a>1ï¼‰ åœ¨storageä¸Šå®‰è£…Nginx</h4><p>åœ¨ <code>storage server</code> ä¸Šå®‰è£… <code>nginx</code> çš„ç›®çš„æ˜¯å¯¹å¤–é€šè¿‡ <code>http</code> è®¿é—® <code>storage server</code> ä¸Šçš„æ–‡ ä»¶ã€‚ä½¿ç”¨ <code>nginx</code> çš„æ¨¡å— <code>FastDFS-nginx-module</code> çš„ä½œç”¨æ˜¯é€šè¿‡ <code>http</code> æ–¹å¼è®¿é—® <code>storage</code> ä¸­ çš„æ–‡ä»¶ï¼Œå½“ <code>storage</code> æœ¬æœºæ²¡æœ‰è¦æ‰¾çš„æ–‡ä»¶æ—¶å‘æº<code>storage</code> ä¸»æœºä»£ç†è¯·æ±‚æ–‡ä»¶ã€‚</p>
<p>åœ¨storageä¸Šå®‰è£…nginxï¼ˆå®‰è£… <code>FastDFS-nginx-module</code> æ¨¡å—ï¼‰</p>
<p>å‚è€ƒï¼š<code>FastDFSå®‰è£…æ•™ç¨‹.pdf</code> è¿›è¡Œå®‰è£…</p>
<p>å®‰è£…å®Œæˆå¯åŠ¨ <code>storage</code>ä¸Šçš„ <code>nginx</code>ï¼š</p>
<div class="hljs"><pre><code class="hljs shell">/usr/local/nginx/sbin/nginx â€c /usr/local/nginx/conf/nginxâ€fdfs.conf</code></pre></div>

<h4 id="2ï¼‰é…ç½®-Nginx-çš„å›¾ç‰‡æœåŠ¡çš„è™šæ‹Ÿä¸»æœº"><a href="#2ï¼‰é…ç½®-Nginx-çš„å›¾ç‰‡æœåŠ¡çš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="2ï¼‰é…ç½® Nginx çš„å›¾ç‰‡æœåŠ¡çš„è™šæ‹Ÿä¸»æœº"></a>2ï¼‰é…ç½® Nginx çš„å›¾ç‰‡æœåŠ¡çš„è™šæ‹Ÿä¸»æœº</h4><p>å›¾ç‰‡æœåŠ¡è™šæ‹Ÿä¸»æœºçš„ä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡ï¼Œå°†å›¾ç‰‡è¯·æ±‚è½¬å‘åˆ° <code>storage server</code> ä¸Šã€‚</p>
<p>1ã€ é€šè¿‡å›¾ç‰‡æœåŠ¡è™šæ‹Ÿä¸»æœºè¯·æ±‚å›¾ç‰‡æµç¨‹å›¾</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image10" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image10.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>2ã€åœ¨ <code>nginx</code> å›¾ç‰‡ä»£ç†æœåŠ¡ä¸Šé…ç½®å›¾ç‰‡æœåŠ¡å™¨è™šæ‹Ÿä¸»æœº</p>
<p>ä¿®æ”¹æœ¬åœ°çš„ <code>hosts</code> æ–‡ä»¶ï¼Œå°† img.xuecheng.com æ˜ å°„åˆ°æœ¬åœ°IP <code>127.0.0.1</code></p>
<p>windows çš„ hosts æ–‡ä»¶è·¯å¾„ä¸ºï¼š<code>C:\Windows\System32\drivers\etc</code></p>
<div class="hljs"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> img.xuecheng.com</code></pre></div>

<p>å¢åŠ  <code>nginx</code> è™šæ‹Ÿæœºä¸»æœº</p>
<div class="hljs"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">å›¾ç‰‡æœåŠ¡</span>
upstream img_server_pool&#123;
<span class="hljs-meta">	#</span><span class="bash">server 192.168.101.64:80 weight=10;</span>
	server 10.1.1.152:80 weight=10;
&#125; 
<span class="hljs-meta">#</span><span class="bash">å­¦æˆç½‘å›¾ç‰‡æœåŠ¡</span>
server &#123;
	listen       80;    
	server_name img.xuecheng.com;    

<span class="hljs-meta">	#</span><span class="bash">ä¸ªäººä¸­å¿ƒ    </span>
	location /group1 &#123;      
		proxy_pass http://img_server_pool;          
	&#125;     
	location /group2 &#123;      
		proxy_pass http://img_server_pool;          
	&#125;     
&#125;</code></pre></div>

<p>3ã€æµ‹è¯•è®¿é—®</p>
<p><a href="http://img.xuecheng.com/group1/M00/00/00/CgEBmF6QKa-Abjv7AAAGqbcDljA60.html" target="_blank" rel="noopener">http://img.xuecheng.com/group1/M00/00/00/CgEBmF6QKa-Abjv7AAAGqbcDljA60.html</a></p>
<p>æˆåŠŸæ˜ å°„åˆ° storage æœåŠ¡ä¸Š</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image11" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image11.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="4ã€æ€»ç»“"><a href="#4ã€æ€»ç»“" class="headerlink" title="4ã€æ€»ç»“"></a>4ã€æ€»ç»“</h3><p>é€šè¿‡æœ¬æ¬¡è¯¾ç¨‹çš„å­¦ä¹ æ‚¨è¦è¾¾åˆ°ä»¥ä¸‹ç›®æ ‡ï¼š</p>
<p><strong>1ï¼‰äº†è§£åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„æ¦‚å¿µåŠåº”ç”¨åœºæ™¯</strong></p>
<p>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæ˜¯é€šè¿‡ç½‘ç»œå°†å•æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿç»„æˆä¸€ä¸ªç½‘ç»œæ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸»è¦åº”ç”¨åœ¨å¤§å‹äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œå®ç°å›¾ç‰‡å­˜å‚¨ã€éŸ³è§†é¢‘å­˜å‚¨ç­‰æœåŠ¡ã€‚</p>
<p>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜ç‚¹ï¼šå¯ä»¥å¿«é€Ÿæ‰©å®¹å­˜å‚¨ï¼Œæé«˜æ–‡ä»¶è®¿é—®é€Ÿåº¦ã€‚</p>
<p><strong>2ï¼‰ç†è§£fastDFSçš„å·¥ä½œåŸç†</strong></p>
<p>fastDFS ç”± <code>tracker</code> å’Œ <code>storage</code> ç»„æˆï¼Œå®ƒä»¬éƒ½å¯ä»¥éƒ¨ç½²é›†ç¾¤ã€‚</p>
<p><code>tracker</code> è´Ÿè´£è°ƒåº¦ï¼Œ<code>storage</code> è´Ÿè´£å­˜å‚¨ã€‚</p>
<p><strong>3ï¼‰æŒæ¡ fastDFS å­˜å–æ–‡ä»¶æ–¹æ³•</strong></p>
<p>å®¢æˆ·ç«¯ä¸ <code>fastDFS</code> é‡‡ç”¨ <code>socket</code> åè®®é€šä¿¡ï¼Œå¯ä»¥é‡‡ç”¨å®˜æ–¹æä¾›çš„ <code>java</code>ç‰ˆæœ¬çš„ <code>fastDSF-client</code>å¿«é€Ÿå¼€å‘ã€‚</p>
<p><strong>4ï¼‰èƒ½å¤ŸåŠ¨æ‰‹æ­å»ºä¸€ä¸ª fastDSF æ–‡ä»¶æœåŠ¡å™¨</strong></p>
<h1 id="äºŒã€ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡"><a href="#äºŒã€ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡" class="headerlink" title="äºŒã€ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡"></a>äºŒã€ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åœ¨å¾ˆå¤šç³»ç»Ÿéƒ½æœ‰ä¸Šä¼ å›¾ç‰‡/ä¸Šä¼ æ–‡ä»¶çš„éœ€æ±‚ï¼Œæ¯”å¦‚ï¼šä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡ã€ä¸Šä¼ è¯¾ç¨‹èµ„æ–™ã€ä¸Šä¼ ç”¨æˆ·å¤´åƒç­‰ï¼Œä¸ºäº†æä¾›ç³»ç»Ÿçš„å¯é‡ç”¨æ€§ä¸“é—¨è®¾ç«‹æ–‡ä»¶ç³»ç»ŸæœåŠ¡æ‰¿æ‹…å›¾ç‰‡/æ–‡ä»¶çš„ç®¡ç†ï¼Œæ–‡ä»¶ç³»ç»ŸæœåŠ¡å®ç°å¯¹æ–‡ä»¶çš„ä¸Šä¼ ã€åˆ é™¤ã€æŸ¥è¯¢ç­‰åŠŸèƒ½è¿›è¡Œç®¡ç†ã€‚</p>
<p>å„ä¸ªå­ç³»ç»Ÿä¸å†å¼€å‘ä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚ï¼Œå„ä¸ªå­ç³»ç»Ÿé€šè¿‡æ–‡ä»¶ç³»ç»ŸæœåŠ¡è¿›è¡Œæ–‡ä»¶çš„ä¸Šä¼ ã€åˆ é™¤ç­‰æ“ä½œã€‚æ–‡ä»¶ç³»ç»ŸæœåŠ¡æœ€ç»ˆä¼šå°†æ–‡ä»¶å­˜å‚¨åˆ° <code>fastDSF</code> æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p>
<p>ä¸‹å›¾æ˜¯å„å„å­ç³»ç»Ÿä¸æ–‡ä»¶ç³»ç»ŸæœåŠ¡ä¹‹é—´çš„å…³ç³»ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image12" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image12.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¸‹å›¾æ˜¯è¯¾ç¨‹ç®¡ç†ä¸­ä¸Šä¼ å›¾ç‰‡å¤„ç†æµç¨‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image13" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image13.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p>1ã€ç®¡ç†å‘˜è¿›å…¥æ•™å­¦ç®¡ç†å‰ç«¯ï¼Œç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</p>
<p>2ã€å›¾ç‰‡ä¸Šä¼ è‡³æ–‡ä»¶ç³»ç»ŸæœåŠ¡ï¼Œæ–‡ä»¶ç³»ç»Ÿè¯·æ±‚ <code>fastDFS</code> ä¸Šä¼ æ–‡ä»¶</p>
<p>3ã€æ–‡ä»¶ç³»ç»Ÿå°†æ–‡ä»¶å…¥åº“ï¼Œå­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»ŸæœåŠ¡æ•°æ®åº“ä¸­ã€‚</p>
<p>4ã€æ–‡ä»¶ç³»ç»ŸæœåŠ¡å‘å‰ç«¯è¿”å›æ–‡ä»¶ä¸Šä¼ ç»“æœï¼Œå¦‚æœæˆåŠŸåˆ™åŒ…æ‹¬æ–‡ä»¶çš„ <code>Url</code> è·¯å¾„ã€‚</p>
<p>5ã€è¯¾ç¨‹ç®¡ç†å‰ç«¯è¯·æ±‚ è¯¾ç¨‹ç®¡ç† è¿›è¡Œä¿å­˜è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯åˆ°è¯¾ç¨‹ æ•°æ®åº“ã€‚</p>
<p>6ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡å°†è¯¾ç¨‹å›¾ç‰‡ä¿å­˜åœ¨ è¯¾ç¨‹æ•°æ®åº“ã€‚</p>
<h2 id="2-åˆ›å»ºå·¥ç¨‹"><a href="#2-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="2. åˆ›å»ºå·¥ç¨‹"></a>2. åˆ›å»ºå·¥ç¨‹</h2><p>å¯¼å…¥<code>xc-service-base-filesystem.zip</code>å·¥ç¨‹ã€‚</p>
<p>1ï¼‰å·¥ç¨‹ç›®å½•ç»“æ„å¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image14" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image14.png" srcset="/img/loading.gif" alt="image-20200410193248194"></a></p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image14" target="_blank" rel="noopener">image-20200410193248194</a></p>
<p>1ï¼‰pom.xml æ–‡ä»¶</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span>
<span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span>
<span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../xc-framework-parent/pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-base-filesystem<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-model<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.oschina.zcx7878<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastdfs-client-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div>

<p>2ï¼‰é…ç½®æ–‡ä»¶</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">22100</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">xc-service-base-filesystem</span>
<span class="hljs-comment">#mongoé…ç½®</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">mongodb:</span>
      <span class="hljs-attr">database:</span> <span class="hljs-string">xc_fs</span>
      <span class="hljs-attr">uri:</span> <span class="hljs-string">mongodb://root:123123@127.0.0.1:27017</span>
<span class="hljs-comment">#SpringMVCä¸Šä¼ æ–‡ä»¶é…ç½®</span>
  <span class="hljs-attr">servlet:</span>
    <span class="hljs-attr">multipart:</span>
      <span class="hljs-comment">#é»˜è®¤æ”¯æŒæ–‡ä»¶ä¸Šä¼ .</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
      <span class="hljs-comment">#æ”¯æŒæ–‡ä»¶å†™å…¥ç£ç›˜.</span>
      <span class="hljs-attr">file-size-threshold:</span> <span class="hljs-number">0</span>
      <span class="hljs-comment"># ä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶ç›®å½•</span>
      <span class="hljs-attr">location:</span>
      <span class="hljs-comment"># æœ€å¤§æ”¯æŒæ–‡ä»¶å¤§å°</span>
      <span class="hljs-attr">max-file-size:</span> <span class="hljs-string">1MB</span>
      <span class="hljs-comment"># æœ€å¤§æ”¯æŒè¯·æ±‚å¤§å°</span>
      <span class="hljs-attr">max-request-size:</span> <span class="hljs-string">30MB</span>
<span class="hljs-attr">xuecheng:</span>
  <span class="hljs-attr">fastdfs:</span>
    <span class="hljs-attr">connect_timeout_in_seconds:</span> <span class="hljs-number">5</span>
    <span class="hljs-attr">network_timeout_in_seconds:</span> <span class="hljs-number">30</span>
    <span class="hljs-attr">charset:</span> <span class="hljs-string">UTF-8</span>
    <span class="hljs-attr">tracker_servers:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.101</span><span class="hljs-number">.65</span><span class="hljs-string">:22122</span> <span class="hljs-comment">#å¤šä¸ª trackerServerä¸­é—´ä»¥é€—å·åˆ†éš”</span></code></pre></div>

<h2 id="3-æ„å»ºæ¥å£"><a href="#3-æ„å»ºæ¥å£" class="headerlink" title="3. æ„å»ºæ¥å£"></a>3. æ„å»ºæ¥å£</h2><p>ç³»ç»Ÿçš„æ–‡ä»¶ä¿¡æ¯ï¼ˆå›¾ç‰‡ã€æ–‡æ¡£ç­‰å°æ–‡ä»¶çš„ä¿¡æ¯ï¼‰åœ¨mongodbä¸­å­˜å‚¨ï¼Œä¸‹è¾¹æ˜¯æ–‡ä»¶ä¿¡æ¯çš„æ¨¡å‹ç±»ã€‚</p>
<h3 id="1ã€æ¨¡å‹ç±»"><a href="#1ã€æ¨¡å‹ç±»" class="headerlink" title="1ã€æ¨¡å‹ç±»"></a>1ã€æ¨¡å‹ç±»</h3><p><strong>1ï¼‰æ¨¡å‹ç±»å¦‚ä¸‹</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-meta">@Document</span>(collection = <span class="hljs-string">"filesystem"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileSystem</span> </span>&#123;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> String fileId;
    <span class="hljs-comment">//æ–‡ä»¶è¯·æ±‚è·¯å¾„</span>
    <span class="hljs-keyword">private</span> String filePath;
    <span class="hljs-comment">//æ–‡ä»¶å¤§å°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> fileSize;
    <span class="hljs-comment">//æ–‡ä»¶åç§°</span>
    <span class="hljs-keyword">private</span> String fileName;
    <span class="hljs-comment">//æ–‡ä»¶ç±»å‹</span>
    <span class="hljs-keyword">private</span> String fileType;
    <span class="hljs-comment">//å›¾ç‰‡å®½åº¦</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> fileWidth;
    <span class="hljs-comment">//å›¾ç‰‡é«˜åº¦</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> fileHeight;
    <span class="hljs-comment">//ç”¨æˆ·idï¼Œç”¨äºæˆæƒæš‚æ—¶ä¸ç”¨</span>
    <span class="hljs-keyword">private</span> String userId;
    <span class="hljs-comment">//ä¸šåŠ¡key</span>
    <span class="hljs-keyword">private</span> String businesskey;
    <span class="hljs-comment">//ä¸šåŠ¡æ ‡ç­¾</span>
    <span class="hljs-keyword">private</span> String filetag;
    <span class="hljs-comment">//æ–‡ä»¶å…ƒä¿¡æ¯</span>
    <span class="hljs-keyword">private</span> Map metadata;
&#125;</code></pre></div>

<p>è¯´æ˜ï¼š</p>
<ul>
<li>fileIdï¼š<code>fastDFS</code> è¿”å›çš„æ–‡ä»¶ IDã€‚</li>
<li>filePathï¼šè¯·æ±‚<code>fastDFS</code>æµè§ˆæ–‡ä»¶ URLã€‚</li>
<li>filetagï¼šæ–‡ä»¶æ ‡ç­¾ï¼Œç”±äºæ–‡ä»¶ç³»ç»ŸæœåŠ¡æ˜¯å…¬å…±æœåŠ¡ï¼Œæ–‡ä»¶ç³»ç»ŸæœåŠ¡ä¼šä¸ºä½¿ç”¨æ–‡ä»¶ç³»ç»ŸæœåŠ¡çš„å­ç³»ç»Ÿåˆ†é…æ–‡ä»¶æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†æ­¤æ–‡ä»¶æ¥è‡ªå“ªä¸ªç³»ç»Ÿã€‚</li>
<li>businesskeyï¼šæ–‡ä»¶ç³»ç»ŸæœåŠ¡ä¸ºå…¶å®ƒå­ç³»ç»Ÿæä¾›çš„ä¸€ä¸ªä¸šåŠ¡æ ‡è¯†å­—æ®µï¼Œå„å­ç³»ç»Ÿæ ¹æ®è‡ªå·±çš„éœ€æ±‚å»ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šè¯¾ç¨‹ç®¡ç†ä¼šåœ¨æ­¤å­—æ®µä¸­å­˜å‚¨è¯¾ç¨‹ <code>id</code> ç”¨äºæ ‡è¯†è¯¥å›¾ç‰‡å±äºå“ªä¸ªè¯¾ç¨‹ã€‚</li>
<li>metadataï¼šæ–‡ä»¶ç›¸å…³çš„å…ƒä¿¡æ¯ã€‚</li>
</ul>
<p><strong>2ï¼‰æ•°æ®åº“ collection é›†åˆ</strong></p>
<p>åœ¨ <code>mongodb</code> åˆ›å»ºæ•°æ®åº“xc_fsï¼ˆæ–‡ä»¶ç³»ç»Ÿæ•°æ®åº“ï¼‰ï¼Œå¹¶åˆ›å»ºé›†åˆ <code>filesystem</code>ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image15" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image15.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="2ã€API-æ¥å£"><a href="#2ã€API-æ¥å£" class="headerlink" title="2ã€API æ¥å£"></a>2ã€API æ¥å£</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Api</span>(value = <span class="hljs-string">"æ–‡ä»¶ç®¡ç†æ¥å£"</span>, description = <span class="hljs-string">"æ–‡ä»¶ç®¡ç†æ¥å£ï¼Œæä¾›å¯¹æ–‡ä»¶çš„CRUD"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FileSystemControllerApi</span> </span>&#123;

    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"ä¸Šä¼ æ–‡ä»¶æ¥å£"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> UploadFileResult <span class="hljs-title">uploadFile</span><span class="hljs-params">(MultipartFile multipartFile,</span></span>
<span class="hljs-function"><span class="hljs-params">                                       String fileTage,</span></span>
<span class="hljs-function"><span class="hljs-params">                                       String businessKey,</span></span>
<span class="hljs-function"><span class="hljs-params">                                       String metaData)</span></span>;

&#125;</code></pre></div>

<h3 id="3ã€Dao-å±‚"><a href="#3ã€Dao-å±‚" class="headerlink" title="3ã€Dao å±‚"></a>3ã€Dao å±‚</h3><p>dao å±‚ç»§æ‰¿ <code>Spring Data Mongodb</code> çš„ API</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.filesystem.dao;

<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.filesystem.FileSystem;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FileSystemRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">FileSystem</span>,<span class="hljs-title">String</span>&gt; </span>&#123;

&#125;</code></pre></div>

<h3 id="4ã€Service-å±‚"><a href="#4ã€Service-å±‚" class="headerlink" title="4ã€Service å±‚"></a>4ã€Service å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.filesystem.service;

<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.xuecheng.filesystem.dao.FileSystemRepository;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.filesystem.FileSystem;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.filesystem.response.FileSystemCode;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.filesystem.response.UploadFileResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;
<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;
<span class="hljs-keyword">import</span> org.csource.common.MyException;
<span class="hljs-keyword">import</span> org.csource.fastdfs.*;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileSystemService</span> </span>&#123;
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.fastdfs.tracker_servers&#125;"</span>)
    String tracker_servers;
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.fastdfs.connect_timeout_in_seconds&#125;"</span>)
    <span class="hljs-keyword">int</span> connect_timeout_in_seconds;
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.fastdfs.network_timeout_in_seconds&#125;"</span>)
    <span class="hljs-keyword">int</span> network_timeout_in_seconds;
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.fastdfs.charset&#125;"</span>)
    String charset;

    <span class="hljs-meta">@Autowired</span>
    FileSystemRepository fileSystemRepository;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * ä¸Šä¼ æ–‡ä»¶åˆ°FastDFS</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> multipartFile æ–‡ä»¶æ•°æ®</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> fileTag æ–‡ä»¶æ ‡ç­¾</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> businessKey ä¸šåŠ¡key</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> metaData æ–‡ä»¶å…ƒæ•°æ®</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> UploadFileResult <span class="hljs-title">uploadFile</span><span class="hljs-params">(MultipartFile multipartFile,</span></span>
<span class="hljs-function"><span class="hljs-params">                                       String fileTag,</span></span>
<span class="hljs-function"><span class="hljs-params">                                       String businessKey,</span></span>
<span class="hljs-function"><span class="hljs-params">                                       String metaData)</span></span>&#123;
        <span class="hljs-comment">//éªŒè¯æäº¤çš„æ–‡ä»¶æ˜¯å¦ä¸ºç©º</span>
        <span class="hljs-keyword">if</span>(multipartFile == <span class="hljs-keyword">null</span>)&#123;
            ExceptionCast.cast(FileSystemCode.FS_UPLOADFILE_FILEISNULL);
        &#125;

        <span class="hljs-comment">//ç¬¬ä¸€æ­¥ï¼šå°†æ–‡ä»¶ä¸Šä¼ åˆ° FastDFSä¸­</span>
        String fileId = <span class="hljs-keyword">this</span>.fdfsUpload(multipartFile);
        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(fileId))&#123;    <span class="hljs-comment">//ä¸Šä¼ æ–‡ä»¶ä¸ºç©ºæ—¶æŠ›å‡ºå¼‚å¸¸</span>
            ExceptionCast.cast(FileSystemCode.FS_UPLOADFILE_SERVERFAIL);
        &#125;

        <span class="hljs-comment">//ç¬¬äºŒæ­¥ï¼šå°†æ–‡ä»¶å‚¨å­˜åˆ°mongoDBå†…</span>

        <span class="hljs-comment">//è®¾ç½®ç›¸å…³çš„æ–‡ä»¶ä¿¡æ¯</span>
        FileSystem fileSystem = <span class="hljs-keyword">new</span> FileSystem();
        fileSystem.setFileId(fileId);
        fileSystem.setFileName(multipartFile.getOriginalFilename());
        fileSystem.setBusinesskey(businessKey);
        fileSystem.setFilePath(fileId); <span class="hljs-comment">//FastDFSçš„fileIdå°±æ˜¯å®é™…çš„ç‰©ç†è·¯å¾„</span>
        fileSystem.setFileSize(multipartFile.getSize());
        fileSystem.setFiletag(fileTag);
        fileSystem.setFileType(multipartFile.getContentType());
        <span class="hljs-comment">//æ–‡ä»¶å…ƒæ•°æ®éœ€è¦è½¬æ¢æˆMapå¯¹è±¡</span>
        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(metaData))&#123;
            Map metaDataMap = JSON.parseObject(metaData, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
            fileSystem.setMetadata(metaDataMap);
        &#125;
        FileSystem save = fileSystemRepository.save(fileSystem);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UploadFileResult(CommonCode.SUCCESS,save);
    &#125;

    <span class="hljs-comment">//ä¸Šä¼ æ–‡ä»¶åˆ°FastDFS</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">fdfsUpload</span><span class="hljs-params">(MultipartFile multipartFile)</span></span>&#123;
        <span class="hljs-comment">//åˆå§‹åŒ–FastDFSçš„ç¯å¢ƒ</span>
        <span class="hljs-keyword">try</span> &#123;
            initFdfsConfig();
            TrackerClient trackerClient = <span class="hljs-keyword">new</span> TrackerClient();
            TrackerServer trackerServer = trackerClient.getConnection();
            <span class="hljs-comment">//å¾—åˆ° Storage è¿æ¥ä¿¡æ¯</span>
            StorageServer storeStorage = trackerClient.getStoreStorage(trackerServer);
            <span class="hljs-comment">//è·å– Storage å®¢æˆ·ç«¯</span>
            StorageClient1 storageClient1 = <span class="hljs-keyword">new</span> StorageClient1(trackerServer, storeStorage);

            <span class="hljs-comment">//ä¸Šä¼ æ–‡ä»¶</span>
            <span class="hljs-keyword">byte</span>[] fileBytes = multipartFile.getBytes();   <span class="hljs-comment">// è·å–æ–‡ä»¶ä¿¡æ¯</span>
            String originalFilename = multipartFile.getOriginalFilename();
            <span class="hljs-comment">// è·å–æ–‡ä»¶æ‹“å±•å</span>
            String extStr = originalFilename.substring(originalFilename.lastIndexOf(<span class="hljs-string">"."</span>) + <span class="hljs-number">1</span>);
            <span class="hljs-comment">//ä¸Šä¼ æ–‡ä»¶</span>
            String fileId = storageClient1.upload_file1(fileBytes, extStr, <span class="hljs-keyword">null</span>);
            <span class="hljs-keyword">return</span> fileId;
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            e.printStackTrace();
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;

    <span class="hljs-comment">//åˆå§‹åŒ–FastDFSç¯å¢ƒ</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initFdfsConfig</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">try</span> &#123;
              ClientGlobal.initByTrackers(tracker_servers);
              ClientGlobal.setG_connect_timeout(connect_timeout_in_seconds);
              ClientGlobal.setG_network_timeout(network_timeout_in_seconds);
              ClientGlobal.setG_charset(charset);
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            e.printStackTrace();
            <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸</span>
            ExceptionCast.cast(FileSystemCode.FS_INITFDFS_ERROR);
        &#125;
    &#125;
&#125;</code></pre></div>

<h3 id="5ã€Controller-å±‚"><a href="#5ã€Controller-å±‚" class="headerlink" title="5ã€Controller å±‚"></a>5ã€Controller å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.filesystem.controller;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/filesystem"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileSystemController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FileSystemControllerApi</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    FileSystemService fileSystemService;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/upload"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> UploadFileResult <span class="hljs-title">uploadFile</span><span class="hljs-params">(MultipartFile multipartFile, String fileTag, String businessKey, String metaData)</span> </span>&#123;
        <span class="hljs-keyword">return</span> fileSystemService.uploadFile(multipartFile,fileTag,businessKey,metaData);
    &#125;
&#125;</code></pre></div>

<h3 id="6ã€æµ‹è¯•"><a href="#6ã€æµ‹è¯•" class="headerlink" title="6ã€æµ‹è¯•"></a>6ã€æµ‹è¯•</h3><p>åœ¨ Swagger UI ç”Ÿæˆçš„æ¥å£æ–‡æ¡£å†…è¿›è¡Œæµ‹è¯• <a href="http://localhost:22100/swagger-ui.html" target="_blank" rel="noopener">http://localhost:22100/swagger-ui.html</a></p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image16" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image16.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="4-å‰ç«¯é…ç½®"><a href="#4-å‰ç«¯é…ç½®" class="headerlink" title="4. å‰ç«¯é…ç½®"></a>4. å‰ç«¯é…ç½®</h2><h3 id="1ã€éœ€æ±‚"><a href="#1ã€éœ€æ±‚" class="headerlink" title="1ã€éœ€æ±‚"></a>1ã€éœ€æ±‚</h3><p>ä¸Šä¼ å›¾ç‰‡ç•Œé¢å¦‚ä¸‹å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image17" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image17.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç‚¹å‡»â€œåŠ å·â€ä¸Šä¼ å›¾ç‰‡ï¼Œå›¾ç‰‡ä¸Šä¼ æˆåŠŸè‡ªåŠ¨æ˜¾ç¤ºï¼›ç‚¹å‡»â€œåˆ é™¤â€å°†åˆ é™¤å›¾ç‰‡ã€‚</p>
<h3 id="2ã€é¡µé¢"><a href="#2ã€é¡µé¢" class="headerlink" title="2ã€é¡µé¢"></a>2ã€é¡µé¢</h3><p>ä½¿ç”¨ <code>Element-UI</code> çš„<code>Upload</code>ä¸Šä¼ ç»„ä»¶å®ç°ä¸Šè¾¹çš„æ•ˆæœã€‚</p>
<p><strong>1) template</strong></p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€upload</span></span>
<span class="hljs-tag">  <span class="hljs-attr">action</span>=<span class="hljs-string">"/filesystem/upload"</span></span>
<span class="hljs-tag">  <span class="hljs-attr">list</span>â€<span class="hljs-attr">type</span>=<span class="hljs-string">"pictureâ€card"</span></span>
<span class="hljs-tag">  <span class="hljs-attr">name</span>=<span class="hljs-string">"multipartFile"</span> </span>
<span class="hljs-tag">  <span class="hljs-attr">:before</span>â€<span class="hljs-attr">upload</span>=<span class="hljs-string">"setbusinesskey"</span></span>
<span class="hljs-tag">  <span class="hljs-attr">:on</span>â€<span class="hljs-attr">success</span>=<span class="hljs-string">"handleSuccess"</span></span>
<span class="hljs-tag">  <span class="hljs-attr">:file</span>â€<span class="hljs-attr">list</span>=<span class="hljs-string">"fileList"</span></span>
<span class="hljs-tag">  <span class="hljs-attr">:limit</span>=<span class="hljs-string">"picmax"</span></span>
<span class="hljs-tag">  <span class="hljs-attr">:on</span>â€<span class="hljs-attr">exceed</span>=<span class="hljs-string">"rejectupload"</span></span>
<span class="hljs-tag">  <span class="hljs-attr">:data</span>=<span class="hljs-string">"uploadval"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"elâ€iconâ€plus"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€upload</span>&gt;</span></code></pre></div>

<p>el-uploadå‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li>actionï¼šå¿…é€‰å‚æ•°ï¼Œä¸Šä¼ çš„åœ°å€</li>
<li>list-typeï¼šæ–‡ä»¶åˆ—è¡¨çš„ç±»å‹ï¼ˆtext/picture/picture-cardï¼‰</li>
<li>name: æäº¤çš„æ–‡ä»¶å‚æ•°åç§°ï¼Œè¿™é‡Œè¦è·Ÿåç«¯æ¥æ”¶çš„å¯¹åº”ä¸Š</li>
<li>before-uploadï¼šä¸Šä¼ å‰æ‰§è¡Œé’©å­æ–¹æ³• ï¼Œfunction(file)</li>
<li>on-successï¼šä¸Šä¼ æˆåŠŸ æ‰§è¡Œçš„é’©å­æ–¹æ³• ï¼Œfunction(response, file, fileList)</li>
<li>on-errorï¼šä¸Šä¼ å¤±è´¥çš„é’©å­æ–¹æ³•ï¼Œfunction(err, file, fileList)</li>
<li>on-removeï¼šæ–‡ä»¶åˆ é™¤çš„é’©å­æ–¹æ³•ï¼Œfunction(file, fileList)</li>
<li>file-listï¼šæ–‡ä»¶åˆ—è¡¨ï¼Œæ­¤åˆ—è¡¨ä¸ºä¸Šä¼ æˆåŠŸ çš„æ–‡ä»¶</li>
<li>limitï¼šæœ€å¤§å…è®¸ä¸Šä¼ ä¸ªæ•°</li>
<li>on-exceedï¼šæ–‡ä»¶è¶…å‡ºä¸ªæ•°é™åˆ¶æ—¶çš„é’©å­ï¼Œæ–¹æ³•ä¸ºï¼šfunction(files, fileList)</li>
<li>dataï¼šæäº¤ä¸Šä¼ çš„é¢å¤–å‚æ•°ï¼Œéœ€è¦å°è£…ä¸ºjsonå¯¹è±¡ï¼Œæœ€ç»ˆæäº¤ç»™æœåŠ¡ç«¯ä¸ºkey/valueä¸²</li>
</ul>
<p><strong>2) æ•°æ®æ¨¡å‹</strong></p>
<div class="hljs"><pre><code class="hljs js">&lt;script&gt;
  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> sysConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'@/../config/sysConfig'</span>;
  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> courseApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../api/course'</span>;
  <span class="hljs-keyword">import</span> utilApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../../common/utils'</span>;
  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> systemApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../../base/api/system'</span>;
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;
    data() &#123;
      <span class="hljs-keyword">return</span> &#123;
        picmax:<span class="hljs-number">1</span>,
        courseid:<span class="hljs-string">''</span>,
        dialogImageUrl: <span class="hljs-string">''</span>,
        dialogVisible: <span class="hljs-literal">false</span>,
        fileList:[],
        uploadval:&#123;<span class="hljs-attr">filetag</span>:<span class="hljs-string">"course"</span>&#125;,
        imgUrl:sysConfig.imgUrl
      &#125;
    &#125;,
    methods: &#123;
      <span class="hljs-comment">//è¶…å‡ºæ–‡ä»¶ä¸Šä¼ ä¸ªæ•°æç¤ºä¿¡æ¯</span>
      rejectupload()&#123;
        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"æœ€å¤šä¸Šä¼ "</span>+<span class="hljs-keyword">this</span>.picmax+<span class="hljs-string">"ä¸ªå›¾ç‰‡"</span>);
      &#125;,
      <span class="hljs-comment">//åœ¨ä¸Šä¼ å‰è®¾ç½®ä¸Šä¼ è¯·æ±‚çš„æ•°æ®</span>
      setuploaddata()&#123;
      &#125;,
      <span class="hljs-comment">//åˆ é™¤å›¾ç‰‡</span>
      handleRemove(file, fileList) &#123;
        <span class="hljs-built_in">console</span>.log(file)
        alert(<span class="hljs-string">'åˆ é™¤'</span>)
      &#125;,
      <span class="hljs-comment">//ä¸Šä¼ æˆåŠŸçš„é’©å­æ–¹æ³•</span>
      handleSuccess(response, file, fileList)&#123;
        <span class="hljs-built_in">console</span>.log(response)
        alert(<span class="hljs-string">'ä¸Šä¼ æˆåŠŸ'</span>)
      &#125;,
      <span class="hljs-comment">//ä¸Šä¼ å¤±è´¥æ‰§è¡Œçš„é’©å­æ–¹æ³•</span>
      handleError(err, file, fileList)&#123;
        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'ä¸Šä¼ å¤±è´¥'</span>);
        <span class="hljs-comment">//æ¸…ç©ºæ–‡ä»¶é˜Ÿåˆ—</span>
        <span class="hljs-keyword">this</span>.fileList = []
      &#125;
    &#125;,
    mounted()&#123;
      <span class="hljs-comment">//è¯¾ç¨‹id</span>
      <span class="hljs-keyword">this</span>.courseid = <span class="hljs-keyword">this</span>.$route.params.courseid;
    &#125;
  &#125;
&lt;<span class="hljs-regexp">/script&gt;</span></code></pre></div>

<h3 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h3><p>1ã€ç‚¹å‡»â€œåŠ å·â€æµ‹è¯•ä¸Šä¼ å›¾ç‰‡</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image18" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image18.png" srcset="/img/loading.gif" alt="img"></a></p>
<h1 id="ä¸‰ã€ä¿å­˜è¯¾ç¨‹å›¾ç‰‡"><a href="#ä¸‰ã€ä¿å­˜è¯¾ç¨‹å›¾ç‰‡" class="headerlink" title="ä¸‰ã€ä¿å­˜è¯¾ç¨‹å›¾ç‰‡"></a>ä¸‰ã€ä¿å­˜è¯¾ç¨‹å›¾ç‰‡</h1><h2 id="1-éœ€æ±‚åˆ†æ-1"><a href="#1-éœ€æ±‚åˆ†æ-1" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>å›¾ç‰‡ä¸Šä¼ åˆ°æ–‡ä»¶ç³»ç»Ÿåï¼Œå…¶å®ƒå­ç³»ç»Ÿå¦‚æœæƒ³ä½¿ç”¨å›¾ç‰‡å¯ä»¥å¼•ç”¨å›¾ç‰‡çš„åœ°å€ï¼Œè¯¾ç¨‹ç®¡ç†æ¨¡å—ä½¿ç”¨å›¾ç‰‡çš„æ–¹å¼æ˜¯å°†å›¾ç‰‡åœ°å€ä¿å­˜åˆ°è¯¾ç¨‹æ•°æ®åº“ä¸­ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image19" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image19.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p>
<p>1ã€ä¸Šä¼ å›¾ç‰‡åˆ°æ–‡ä»¶ç³»ç»ŸæœåŠ¡</p>
<p>2ã€ä¿å­˜å›¾ç‰‡åœ°å€åˆ°è¯¾ç¨‹ç®¡ç†æœåŠ¡åœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡åˆ›å»ºä¿å­˜è¯¾ç¨‹ä¸å›¾ç‰‡å¯¹åº”å…³ç³»çš„è¡¨ <code>course_pic</code>ã€‚</p>
<p>3ã€åœ¨ <code>course_pic</code> ä¿å­˜å›¾ç‰‡æˆåŠŸåæ–¹å¯æŸ¥è¯¢è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯ã€‚</p>
<p>é€šè¿‡æŸ¥è¯¢ <code>course_pic</code> è¡¨æ•°æ®åˆ™æŸ¥è¯¢åˆ°æŸè¯¾ç¨‹çš„å›¾ç‰‡ä¿¡æ¯ã€‚</p>
<h2 id="2-æ„å»ºæ¥å£"><a href="#2-æ„å»ºæ¥å£" class="headerlink" title="2. æ„å»ºæ¥å£"></a>2. æ„å»ºæ¥å£</h2><h3 id="1ã€API-æ¥å£"><a href="#1ã€API-æ¥å£" class="headerlink" title="1ã€API æ¥å£"></a>1ã€API æ¥å£</h3><p>åœ¨ <code>com.xuecheng.api.course</code> åŒ…ä¸‹åˆ›å»ºè¯¥æ¥å£</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"ä¿å­˜è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">saveCoursePic</span><span class="hljs-params">(String courseId, String pic)</span></span>;</code></pre></div>

<h3 id="2ã€Dao-å±‚"><a href="#2ã€Dao-å±‚" class="headerlink" title="2ã€Dao å±‚"></a>2ã€Dao å±‚</h3><p>ç”±äºæ˜¯å¯¹ <code>mysql</code> çš„å•è¡¨æ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡ç»§æ‰¿ spring data jpa æä¾›çš„æ¥å£æ¥å®ç° dao</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_course.dao;

<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseBase;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CoursePic;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Created by Administrator.</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CoursePicRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">CoursePic</span>,<span class="hljs-title">String</span>&gt; </span>&#123;

&#125;</code></pre></div>

<h3 id="3ã€Service-å±‚"><a href="#3ã€Service-å±‚" class="headerlink" title="3ã€Service å±‚"></a>3ã€Service å±‚</h3><p>åœ¨ <code>CourseService</code> ä¸‹æ–°å¢ <code>saveCoursePic</code> æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ä¿å­˜è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯åˆ°æ•°æ®åº“</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId è¯¾ç¨‹id</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pic å›¾ç‰‡id</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>

<span class="hljs-meta">@Transactional</span>  <span class="hljs-comment">//Mysqlæ“ä½œéœ€è¦æ·»åŠ åˆ°Springäº‹åŠ¡</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">saveCoursePic</span><span class="hljs-params">(String courseId, String pic)</span> </span>&#123;
    CoursePic coursePic = <span class="hljs-keyword">null</span>;
    <span class="hljs-comment">//åˆ¤æ–­è¯¥è¯¾ç¨‹idæ˜¯å¦å·²ç»å­˜åœ¨å›¾ç‰‡</span>
    Optional&lt;CoursePic&gt; byId = coursePicRepository.findById(courseId);
    <span class="hljs-keyword">if</span>(byId.isPresent())&#123;
        coursePic = byId.get();
    &#125;
    <span class="hljs-comment">//ä¸å­˜åœ¨åˆ™é‡æ–°åˆ›å»ºä¸€ä¸ªè¯¾ç¨‹å›¾ç‰‡å¯¹è±¡å¹¶ä¿å­˜ä¿¡æ¯</span>
    <span class="hljs-keyword">if</span>(coursePic == <span class="hljs-keyword">null</span>)&#123;
        coursePic = <span class="hljs-keyword">new</span> CoursePic();
    &#125;

    coursePic.setCourseid(courseId);
    coursePic.setPic(pic);
    CoursePic save = coursePicRepository.save(coursePic);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);
&#125;</code></pre></div>

<h3 id="4ã€Controller-å±‚"><a href="#4ã€Controller-å±‚" class="headerlink" title="4ã€Controller å±‚"></a>4ã€Controller å±‚</h3><p>åœ¨ <code>CourseContorller</code> ä¸‹æ–°å¢ <code>saveCoursePic</code> æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ä¿å­˜è¯¾ç¨‹ä¿¡æ¯ä¸å›¾ç‰‡çš„å¯¹åº”å…³ç³»</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId è¯¾ç¨‹id</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pic å›¾ç‰‡æ–‡ä»¶id</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/coursepic/add"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">saveCoursePic</span><span class="hljs-params">(@RequestParam(<span class="hljs-string">"courseId"</span>)</span> String courseId, @<span class="hljs-title">RequestParam</span><span class="hljs-params">(<span class="hljs-string">"pic"</span>)</span> String pic) </span>&#123;
    <span class="hljs-keyword">return</span> courseService.saveCoursePic(courseId,pic);
&#125;</code></pre></div>

<h2 id="3-å‰ç«¯é…ç½®"><a href="#3-å‰ç«¯é…ç½®" class="headerlink" title="3. å‰ç«¯é…ç½®"></a>3. å‰ç«¯é…ç½®</h2><h3 id="1ã€éœ€æ±‚-1"><a href="#1ã€éœ€æ±‚-1" class="headerlink" title="1ã€éœ€æ±‚"></a>1ã€éœ€æ±‚</h3><p>å‰ç«¯éœ€è¦åœ¨ä¸Šä¼ å›¾ç‰‡æˆåŠŸåä¿å­˜è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯ã€‚</p>
<h3 id="2ã€é¡µé¢-1"><a href="#2ã€é¡µé¢-1" class="headerlink" title="2ã€é¡µé¢"></a>2ã€é¡µé¢</h3><p>åœ¨ course.js ä¸‹åˆ›å»º <code>ajax</code> è¯·æ±‚çš„ api</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä¿å­˜è¯¾ç¨‹å›¾ç‰‡åœ°å€åˆ°è¯¾ç¨‹æ•°æ® åº“</span>
export <span class="hljs-keyword">const</span> addCoursePic= (courseId,pic) =&gt; &#123;
  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/course/coursepic/add?courseId='</span>+courseId+<span class="hljs-string">"&amp;pic="</span>+pic)
&#125;</code></pre></div>

<p>el-upload ç»„ä»¶åœ¨ä¸Šä¼ æˆåŠŸåï¼Œä¼šè°ƒç”¨ä¸Šä¼ æˆåŠŸçš„é’©å­æ–¹æ³•ï¼Œé…ç½®å¦‚ <code>:on-success=&quot;handleSuccess&quot;</code></p>
<p>é’©å­æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä¸Šä¼ æˆåŠŸçš„é’©å­æ–¹æ³•</span>
handleSuccess(response, file, fileList)&#123;
    console.log(response)
    <span class="hljs-comment">//è°ƒç”¨è¯¾ç¨‹ç®¡ç†çš„ä¿å­˜å›¾ç‰‡æ¥å£ï¼Œå°†å›¾ç‰‡ä¿¡æ¯ä¿å­˜åˆ°è¯¾ç¨‹ç®¡ç†æ•°æ®åº“course_picä¸­</span>
    <span class="hljs-comment">//ä»responseå¾—åˆ°æ–°çš„å›¾ç‰‡æ–‡ä»¶çš„åœ°å€</span>
    <span class="hljs-keyword">if</span>(response.success)&#123;
        let fileId = response.fileSystem.fileId;
        courseApi.addCoursePic(<span class="hljs-keyword">this</span>.courseid,fileId).then(res=&gt;&#123;
            <span class="hljs-keyword">if</span>(res.success)&#123;
                <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">"å›¾ç‰‡ä¸Šä¼ æˆåŠŸ"</span>)
            &#125;<span class="hljs-keyword">else</span>&#123;
                <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"å›¾ç‰‡ä¿å­˜å¤±è´¥!"</span>)
            &#125;
        &#125;)
    &#125;
&#125;,</code></pre></div>

<h3 id="3ã€æµ‹è¯•-1"><a href="#3ã€æµ‹è¯•-1" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h3><p>ä¸Šä¼ æˆåŠŸ</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image20" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_8/image20" srcset="/img/loading.gif" alt="img"></a></p>
<h1 id="å››ã€å›¾ç‰‡ä¿¡æ¯æŸ¥è¯¢"><a href="#å››ã€å›¾ç‰‡ä¿¡æ¯æŸ¥è¯¢" class="headerlink" title="å››ã€å›¾ç‰‡ä¿¡æ¯æŸ¥è¯¢"></a>å››ã€å›¾ç‰‡ä¿¡æ¯æŸ¥è¯¢</h1><h2 id="1-éœ€æ±‚åˆ†æ-2"><a href="#1-éœ€æ±‚åˆ†æ-2" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åœ¨è¿›å…¥åˆ° è¯¾ç¨‹å›¾ç‰‡ é¡µé¢ä¹‹å‰ï¼Œæ ¹æ®å½“å‰è¯¾ç¨‹çš„idï¼Œæ‰¾åˆ°è¯¥è¯¾ç¨‹å¯¹åº”çš„è¯¾ç¨‹å›¾ç‰‡ã€‚</p>
<h2 id="2-æ„å»ºæ¥å£-1"><a href="#2-æ„å»ºæ¥å£-1" class="headerlink" title="2. æ„å»ºæ¥å£"></a>2. æ„å»ºæ¥å£</h2><h3 id="1ã€API-æ¥å£-1"><a href="#1ã€API-æ¥å£-1" class="headerlink" title="1ã€API æ¥å£"></a>1ã€API æ¥å£</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è·å¾—è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePic <span class="hljs-title">getCoursePic</span><span class="hljs-params">(String courseId)</span></span>;</code></pre></div>

<h3 id="2ã€Dao-å±‚-1"><a href="#2ã€Dao-å±‚-1" class="headerlink" title="2ã€Dao å±‚"></a>2ã€Dao å±‚</h3><p><code>CoursePicRepository</code> ï¼Œåœ¨ç¼–å†™ä¿å­˜åŠŸèƒ½æ—¶å·²æ„å»ºã€‚</p>
<h3 id="3ã€Service-å±‚-1"><a href="#3ã€Service-å±‚-1" class="headerlink" title="3ã€Service å±‚"></a>3ã€Service å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ ¹æ®è¯¾ç¨‹idè·å¾—è¯¾ç¨‹çš„å›¾ç‰‡ä¿¡æ¯</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Transactional</span> <span class="hljs-comment">//Mysqlæ“ä½œéœ€è¦æ·»åŠ åˆ°Springäº‹åŠ¡</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePic <span class="hljs-title">getCoursePic</span><span class="hljs-params">(String courseId)</span> </span>&#123;
    Optional&lt;CoursePic&gt; byId = coursePicRepository.findById(courseId);
    <span class="hljs-keyword">if</span>(byId.isPresent())&#123;
        CoursePic coursePic = byId.get();
        <span class="hljs-keyword">return</span> coursePic;
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
&#125;</code></pre></div>

<h3 id="4ã€Controller-å±‚-1"><a href="#4ã€Controller-å±‚-1" class="headerlink" title="4ã€Controller å±‚"></a>4ã€Controller å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ ¹æ®è¯¾ç¨‹idè·å–è¯¥è¯¾ç¨‹çš„è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span> ç”±äºè¿™é‡Œæ¯ä¸ªè¯¾ç¨‹åªæœ‰ä¸€ä¸ªå›¾ç‰‡ï¼Œæ‰€ä»¥åªè¿”å›ä¸€ä¸ª CoursePic å¯¹è±¡</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/coursepic/get/&#123;courseId&#125;"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePic <span class="hljs-title">getCoursePic</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"courseId"</span>)</span> String courseId) </span>&#123;
    <span class="hljs-keyword">return</span> courseService.getCoursePic(courseId);
&#125;</code></pre></div>

<h3 id="5ã€æµ‹è¯•"><a href="#5ã€æµ‹è¯•" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><p><a href="https://qnoss.codeyee.com/20200704_8/image21" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_8/image21" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-å‰ç«¯é…ç½®-1"><a href="#3-å‰ç«¯é…ç½®-1" class="headerlink" title="3. å‰ç«¯é…ç½®"></a>3. å‰ç«¯é…ç½®</h2><h3 id="1ã€éœ€æ±‚-2"><a href="#1ã€éœ€æ±‚-2" class="headerlink" title="1ã€éœ€æ±‚"></a>1ã€éœ€æ±‚</h3><p>åœ¨è¯¾ç¨‹å›¾ç‰‡é¡µé¢çš„ <code>mounted</code> é’©å­æ–¹æ³• ä¸­æŸ¥è¯¢è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯ï¼Œå¹¶å°†å›¾ç‰‡åœ°å€èµ‹å€¼ç»™æ•°æ®å¯¹è±¡</p>
<h3 id="2ã€é¡µé¢-2"><a href="#2ã€é¡µé¢-2" class="headerlink" title="2ã€é¡µé¢"></a>2ã€é¡µé¢</h3><p>API æ¥å£</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹å›¾ç‰‡</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> findCoursePicList = <span class="hljs-function"><span class="hljs-params">courseId</span> =&gt;</span> &#123;
  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl+<span class="hljs-string">'/course/coursepic/get/'</span>+courseId)
&#125;</code></pre></div>

<p>é’©å­å‡½æ•°</p>
<div class="hljs"><pre><code class="hljs js">mounted()&#123;
  <span class="hljs-comment">//è¯¾ç¨‹id</span>
  <span class="hljs-keyword">this</span>.courseid = <span class="hljs-keyword">this</span>.$route.params.courseid;
  <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹</span>
  courseApi.findCoursePicList(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;
      <span class="hljs-keyword">if</span>(res &amp;&amp; res.pic)&#123;
          <span class="hljs-keyword">let</span> imgUrl = <span class="hljs-keyword">this</span>.imgUrl+res.pic;
          <span class="hljs-comment">//å°†å›¾ç‰‡åœ°å€è®¾ç½®åˆ°</span>
        <span class="hljs-keyword">this</span>.fileList.push(&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">'pic'</span>,<span class="hljs-attr">url</span>:imgUrl,<span class="hljs-attr">fileId</span>:res.pic&#125;)
      &#125;
  &#125;)
&#125;</code></pre></div>

<h3 id="3ã€æµ‹è¯•-2"><a href="#3ã€æµ‹è¯•-2" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h3><p>åˆ«å¿˜äº†å¯åŠ¨ nginx ï¼Œè¿™é‡Œæ˜¯é€šè¿‡ img.xuecheng.com è®¿é—®å›¾ç‰‡ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_8/image22" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_8/image22" srcset="/img/loading.gif" alt="img"></a></p>
<h1 id="äº”ã€è¯¾ç¨‹å›¾ç‰‡åˆ é™¤"><a href="#äº”ã€è¯¾ç¨‹å›¾ç‰‡åˆ é™¤" class="headerlink" title="äº”ã€è¯¾ç¨‹å›¾ç‰‡åˆ é™¤"></a>äº”ã€è¯¾ç¨‹å›¾ç‰‡åˆ é™¤</h1><h2 id="1-éœ€æ±‚åˆ†æ-3"><a href="#1-éœ€æ±‚åˆ†æ-3" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><h2 id="2-æ„å»ºæ¥å£-2"><a href="#2-æ„å»ºæ¥å£-2" class="headerlink" title="2. æ„å»ºæ¥å£"></a>2. æ„å»ºæ¥å£</h2><h3 id="1ã€API-æ¥å£-2"><a href="#1ã€API-æ¥å£-2" class="headerlink" title="1ã€API æ¥å£"></a>1ã€API æ¥å£</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"åˆ é™¤è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">deleteCoursePic</span><span class="hljs-params">(String courseId)</span></span>;</code></pre></div>

<h3 id="2ã€Dao-å±‚-2"><a href="#2ã€Dao-å±‚-2" class="headerlink" title="2ã€Dao å±‚"></a>2ã€Dao å±‚</h3><p><code>JPA</code> è‡ªå¸¦çš„ <code>deleteById</code> æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦åœ¨ Dao é‡Œé¢å†å®šä¹‰ä¸€ä¸ª deleteByCourseid æ–¹æ³•ï¼Œåˆ é™¤åè¿”å›å½±å“çš„è¡Œæ•°ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_course.dao;

<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseBase;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CoursePic;
<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Created by Administrator.</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CoursePicRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">CoursePic</span>,<span class="hljs-title">String</span>&gt; </span>&#123;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æ ¹æ®è¯¾ç¨‹idåˆ é™¤å›¾ç‰‡ä¿¡æ¯</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseId</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›åˆ é™¤å½±å“çš„è¡Œ,å°äº1åˆ™è¡¨ç¤ºåˆ é™¤å¤±è´¥</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">deleteByCourseid</span><span class="hljs-params">(String courseId)</span></span>;
&#125;</code></pre></div>

<h3 id="3ã€Service-å±‚-2"><a href="#3ã€Service-å±‚-2" class="headerlink" title="3ã€Service å±‚"></a>3ã€Service å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * åˆ é™¤è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Transactional</span> <span class="hljs-comment">//Mysqlæ“ä½œéœ€è¦æ·»åŠ åˆ°Springäº‹åŠ¡</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">deleteCoursePic</span><span class="hljs-params">(String courseId)</span> </span>&#123;
    <span class="hljs-keyword">long</span> byCourseid = coursePicRepository.deleteByCourseid(courseId);
    <span class="hljs-keyword">if</span>(byCourseid &gt; <span class="hljs-number">0</span>)&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.FAIL);
&#125;</code></pre></div>

<h3 id="4ã€Controller-å±‚-2"><a href="#4ã€Controller-å±‚-2" class="headerlink" title="4ã€Controller å±‚"></a>4ã€Controller å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * åˆ é™¤è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@DeleteMapping</span>(<span class="hljs-string">"/coursepic/delete"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">deleteCoursePic</span><span class="hljs-params">(@RequestParam(<span class="hljs-string">"courseId"</span>)</span> String courseId) </span>&#123;
    <span class="hljs-keyword">return</span> courseService.deleteCoursePic(courseId);
&#125;</code></pre></div>

<h3 id="5ã€æµ‹è¯•-1"><a href="#5ã€æµ‹è¯•-1" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><p><a href="https://qnoss.codeyee.com/20200704_8/image23" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_8/image23" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-å‰ç«¯é…ç½®-2"><a href="#3-å‰ç«¯é…ç½®-2" class="headerlink" title="3. å‰ç«¯é…ç½®"></a>3. å‰ç«¯é…ç½®</h2><h3 id="1ã€éœ€æ±‚-3"><a href="#1ã€éœ€æ±‚-3" class="headerlink" title="1ã€éœ€æ±‚"></a>1ã€éœ€æ±‚</h3><h3 id="2ã€é¡µé¢-3"><a href="#2ã€é¡µé¢-3" class="headerlink" title="2ã€é¡µé¢"></a>2ã€é¡µé¢</h3><p>api æ¥å£</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//åˆ é™¤è¯¾ç¨‹å›¾ç‰‡</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> deleteCoursePic= <span class="hljs-function"><span class="hljs-params">courseId</span> =&gt;</span> &#123;
  <span class="hljs-keyword">return</span> http.requestDelete(apiUrl+<span class="hljs-string">'/course/coursepic/delete?courseId='</span>+courseId)
&#125;</code></pre></div>

<p>before-removeé’©å­æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€upload</span></span>
<span class="hljs-tag">  <span class="hljs-attr">action</span>=<span class="hljs-string">"/filesystem/upload"</span></span>
<span class="hljs-tag">  <span class="hljs-attr">list</span>â€<span class="hljs-attr">type</span>=<span class="hljs-string">"pictureâ€card"</span></span>
<span class="hljs-tag">  <span class="hljs-attr">:before</span>â€<span class="hljs-attr">remove</span>=<span class="hljs-string">"handleRemove"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"elâ€iconâ€plus"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€upload</span>&gt;</span></code></pre></div>

<p>åœ¨uploadç»„ä»¶çš„ <code>before-remove</code>é’©å­æ–¹æ³• ä¸­å®ç°åˆ é™¤åŠ¨ä½œã€‚</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//åˆ é™¤å›¾ç‰‡</span>
handleRemove(file, fileList) &#123;
  <span class="hljs-built_in">console</span>.log(file)
  <span class="hljs-comment">//è°ƒç”¨æœåŠ¡ç«¯å»åˆ é™¤è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯ï¼Œå¦‚æœè¿”å›falseï¼Œå‰ç«¯åœæ­¢åˆ é™¤</span>
  <span class="hljs-comment">//å¼‚æ­¥è°ƒç”¨</span>
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,rejct</span>)=&gt;</span>&#123;
    courseApi.deleteCoursePic(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;
      <span class="hljs-keyword">if</span>(res.success)&#123;
          <span class="hljs-comment">//æˆåŠŸ</span>
        resolve()
      &#125;<span class="hljs-keyword">else</span>&#123;
        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"åˆ é™¤å¤±è´¥"</span>);
          <span class="hljs-comment">//å¤±è´¥</span>
        rejct()
      &#125;
    &#125;)
  &#125;)
&#125;,</code></pre></div>

<p><code>before-remove</code> è¯´æ˜ï¼šåˆ é™¤æ–‡ä»¶ä¹‹å‰çš„é’©å­ï¼Œå‚æ•°ä¸ºä¸Šä¼ çš„æ–‡ä»¶å’Œæ–‡ä»¶åˆ—è¡¨ï¼Œè‹¥è¿”å› <code>false</code> æˆ–è€…è¿”å› <code>Promise</code> ä¸”è¢« <code>reject</code>ï¼Œåˆ™åœæ­¢åˆ é™¤ã€‚</p>
<h3 id="3ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-promiseï¼Ÿ"><a href="#3ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-promiseï¼Ÿ" class="headerlink" title="3ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ promiseï¼Ÿ"></a>3ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ promiseï¼Ÿ</h3><p>åœ¨ <code>handleRemove</code> æ–¹æ³•è°ƒç”¨åˆ é™¤å›¾ç‰‡çš„ <code>api</code> æ–¹æ³•ï¼Œåˆ é™¤æˆåŠŸæ—¶ return trueï¼Œåˆ é™¤å¤±è´¥æ—¶return false;</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// åˆ é™¤å›¾ç‰‡</span>
handleRemove(file, fileList) &#123;
    <span class="hljs-built_in">console</span>.log(file)
    <span class="hljs-comment">//        alert('åˆ é™¤')</span>
    <span class="hljs-comment">//        return true;</span>
    <span class="hljs-comment">//åˆ é™¤å›¾ç‰‡</span>
    courseApi.deleteCoursePic(<span class="hljs-string">'1'</span>).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span>(res.success)&#123;
            <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">'åˆ é™¤æˆåŠŸ'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        &#125;<span class="hljs-keyword">else</span>&#123;
            <span class="hljs-keyword">this</span>.$message.error(res.message);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        &#125;
    &#125;);
&#125;,</code></pre></div>

<p>åœ¨ä¸Šè¾¹ä»£ç ä¸­å°†æäº¤çš„è¯¾ç¨‹ id æ•…æ„å†™é”™ï¼ŒæŒ‰ç…§æˆ‘ä»¬é¢„æœŸåº”è¯¥æ˜¯åˆ é™¤å¤±è´¥ï¼Œè€Œæµ‹è¯•ç»“æœå´æ˜¯å›¾ç‰‡åœ¨é¡µé¢ä¸Šåˆ é™¤æˆåŠŸã€‚</p>
<p><strong>é—®é¢˜åŸå› ï¼š</strong></p>
<p>é€šè¿‡æŸ¥è¯¢ <code>deleteCoursePic</code> æ–¹æ³•çš„åº•å±‚ä»£ç ï¼Œ<code>deleteCoursePic</code> æœ€ç»ˆè¿”å›ä¸€ä¸ª <code>promise</code> å¯¹è±¡ã€‚</p>
<p>Promise æ˜¯ES6æä¾›çš„ç”¨äºå¼‚æ­¥å¤„ç†çš„å¯¹è±¡ï¼Œå› ä¸ºaxiosæäº¤æ˜¯å¼‚æ­¥æäº¤ï¼Œè¿™é‡Œä½¿ç”¨promiseä½œä¸ºè¿”å›å€¼</p>
<p><strong>Promiseçš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</strong></p>
<p>Promiseå¯¹è±¡åœ¨å¤„ç†è¿‡ç¨‹ä¸­æœ‰ä¸‰ç§çŠ¶æ€ï¼š</p>
<ul>
<li>pendingï¼šè¿›è¡Œä¸­</li>
<li>resolvedï¼šæ“ä½œæˆåŠŸ</li>
<li>rejected: æ“ä½œå¤±è´¥</li>
</ul>
<p>Promiseçš„æ„å»ºæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>)</span>&#123;
     <span class="hljs-comment">//...TODO...</span>
    <span class="hljs-keyword">if</span>(æ“ä½œæˆåŠŸ)&#123;
        resolve(value);
    &#125;<span class="hljs-keyword">else</span>&#123;
        reject(error);
    &#125;
&#125;)</code></pre></div>

<p>ä¸Šè¾¹çš„æ„é€ æ–¹æ³•function(resolve,reject)æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p>1ï¼‰æ–¹æ³•æ‰§è¡Œä¸€äº›ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>2ï¼‰å¦‚æœæ“ä½œæˆåŠŸå°† <code>Promise</code> çš„çŠ¶æ€ç”± <code>pending</code> å˜ä¸º <code>resolved</code>ï¼Œå¹¶å°†æ“ä½œç»“æœä¼ å‡ºå»</p>
<p>3ï¼‰å¦‚æœæ“ä½œå¤±è´¥ä¼šå°† <code>promise</code> çš„çŠ¶æ€ç”± <code>pending</code> å˜ä¸º <code>rejected</code>ï¼Œå¹¶å°†å¤±è´¥ç»“æœä¼ å‡ºå»ã€‚<br>ä¸Šè¾¹è¯´çš„æ“ä½œæˆåŠŸå°†æ“ä½œç»“æœä¼ ç»™è°äº†å‘¢ï¼Ÿæ“ä½œå¤±è´¥å°†å¤±è´¥ç»“æœä¼ ç»™è°äº†å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ promise çš„ <code>then</code>ã€<code>catch</code> æ¥æŒ‡å®šï¼š</p>
<div class="hljs"><pre><code class="hljs js">promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) </span>&#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æ“ä½œæˆåŠŸï¼š'</span> + result);
&#125;);
promise.catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>&#123;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æ“ä½œå¤±è´¥ï¼š'</span> + reason);
&#125;);</code></pre></div>

<p>ä¾‹å­å¦‚ä¸‹ï¼š</p>
<p>1ã€å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¿”å› <code>promise</code> å¯¹è±¡</p>
<div class="hljs"><pre><code class="hljs js">testpromise(i)&#123;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>&#123;
    <span class="hljs-keyword">if</span>(i % <span class="hljs-number">2</span>==<span class="hljs-number">0</span>)&#123;
      resolve(<span class="hljs-string">'æˆåŠŸäº†'</span>)
    &#125;<span class="hljs-keyword">else</span>&#123;
      reject(<span class="hljs-string">'æ‹’ç»äº†'</span>)
    &#125;
  &#125;)
&#125;</code></pre></div>

<p>2ã€è°ƒç”¨æ­¤æ–¹æ³•</p>
<p>å‘æ–¹æ³•ä¼ å…¥å¶æ•°ã€å¥‡æ•°è¿›è¡Œæµ‹è¯•ã€‚</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">this</span>.testpromise(<span class="hljs-number">3</span>).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<span class="hljs-comment">// åœ¨thenä¸­å¯¹æˆåŠŸç»“æœè¿›è¡Œå¤„ç†</span>
    alert(res)
&#125;).catch(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<span class="hljs-comment">//åœ¨catchä¸­å¯¹æ“ä½œå¤±è´¥ç»“æœè¿›è¡Œå¤„ç†</span>
    alert(res)
&#125;)</code></pre></div>

<p>3ã€æœ€ç»ˆå°† <code>handleRemove</code> æ–¹æ³•ä¿®æ”¹å¦‚ä¸‹</p>
<p><code>handleRemove</code> æ–¹æ³•è¿”å› <code>promise</code> å¯¹è±¡ï¼Œå½“åˆ é™¤æˆåŠŸåˆ™ <code>resolve</code>ï¼Œåˆ é™¤å¤±è´¥åˆ™ <code>reject</code>ã€‚</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// åˆ é™¤å›¾ç‰‡</span>
handleRemove(file, fileList) &#123;
    <span class="hljs-built_in">console</span>.log(file)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>&#123;
        <span class="hljs-comment">//åˆ é™¤å›¾ç‰‡</span>
 courseApi.deleteCoursePic(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
            <span class="hljs-keyword">if</span>(res.success)&#123;
                <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">'åˆ é™¤æˆåŠŸ'</span>);
                resolve()<span class="hljs-comment">//é€šè¿‡</span>
            &#125;<span class="hljs-keyword">else</span>&#123;
                <span class="hljs-keyword">this</span>.$message.error(res.message);
                reject()<span class="hljs-comment">//æ‹’ç»</span>
            &#125;
        &#125;);
    &#125;)
&#125;</code></pre></div>
            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">å­¦æˆåœ¨çº¿</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/FastDFS/">FastDFS</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day09ï¼šEurekaã€Feignã€è¯¾ç¨‹é¢„è§ˆå®ç°</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/">
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day07ï¼šè¯¾ç¨‹ç®¡ç†å®æˆ˜</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

ä»£ç å—js ç”¨ä¸åˆ°ï¼Œfulidè‡ªå¸¦æœ‰ï¼Œæ·»åŠ cssæ ·å¼å³å¯å®ç°
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®å­—</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å‹‰å¼ºè¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">äº¬ICPè¯123456å·</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>äº¬å…¬ç½‘å®‰å¤‡12345678å·</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "å­¦æˆåœ¨çº¿day08ï¼šFastDFSå®ç°è¯¾ç¨‹å›¾ç‰‡ç®¡ç†&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
