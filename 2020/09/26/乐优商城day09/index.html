<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>乐优商城day09：商品规格管理 - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>私人博客</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于我
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-09-26 10:43">
      2020-09-26
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      15.9k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      174
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="0-学习目标"><a href="#0-学习目标" class="headerlink" title="0.学习目标"></a>0.学习目标</h1><ul>
<li>了解商品规格数据结构设计思路</li>
<li>实现商品规格查询</li>
<li>了解SPU和SKU数据结构设计思路</li>
<li>实现商品查询</li>
<li>了解商品新增的页面实现</li>
<li>独立编写商品新增后台功能</li>
</ul>
<h1 id="1-商品规格数据结构"><a href="#1-商品规格数据结构" class="headerlink" title="1.商品规格数据结构"></a>1.商品规格数据结构</h1><p>乐优商城是一个全品类的电商网站，因此商品的种类繁多，每一件商品，其属性又有差别。为了更准确描述商品及细分差别，抽象出两个概念：SPU和SKU，了解一下：</p>
<h2 id="1-1-SPU和SKU"><a href="#1-1-SPU和SKU" class="headerlink" title="1.1.SPU和SKU"></a>1.1.SPU和SKU</h2><p>SPU：Standard Product Unit （标准产品单位） ，一组具有共同属性的商品集</p>
<p>SKU：Stock Keeping Unit（库存量单位），SPU商品集因具体特性不同而细分的每个商品</p>
<p>以图为例来看：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526085541996.png" srcset="/img/loading.gif" alt="1526085541996"></p>
<ul>
<li>本页的 华为Mate10 就是一个商品集（SPU）</li>
<li>因为颜色、内存等不同，而细分出不同的Mate10，如亮黑色128G版。（SKU）</li>
</ul>
<p>可以看出：</p>
<ul>
<li>SPU是一个抽象的商品集概念，为了方便后台的管理。</li>
<li>SKU才是具体要销售的商品，每一个SKU的价格、库存可能会不一样，用户购买的是SKU而不是SPU</li>
</ul>
<h2 id="1-2-数据库设计分析"><a href="#1-2-数据库设计分析" class="headerlink" title="1.2.数据库设计分析"></a>1.2.数据库设计分析</h2><h3 id="1-2-1-思考并发现问题"><a href="#1-2-1-思考并发现问题" class="headerlink" title="1.2.1.思考并发现问题"></a>1.2.1.思考并发现问题</h3><p>弄清楚了SPU和SKU的概念区分，接下来我们一起思考一下该如何设计数据库表。</p>
<p>首先来看SPU，大家一起思考下SPU应该有哪些字段来描述？</p>
<div class="hljs"><pre><code class="hljs qml"><span class="hljs-attribute">id:</span><span class="hljs-string">主键</span>
<span class="hljs-string">title</span>：标题
description：描述
specification：规格
packaging_list：包装
after_service：售后服务
comment：评价
category_id：商品分类
brand_id：品牌</code></pre></div>

<p>似乎并不复杂，但是大家仔细思考一下，商品的规格字段你如何填写？</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526086539789.png" srcset="/img/loading.gif" alt="1526086539789"></p>
<p>不同商品的规格不一定相同，数据库中要如何保存？</p>
<p>再看下SKU，大家觉得应该有什么字段？</p>
<div class="hljs"><pre><code class="hljs applescript"><span class="hljs-built_in">id</span>：主键
spu_id：关联的spu
price：价格
images：图片
stock：库存
颜色？
内存？
硬盘？</code></pre></div>

<p>碰到难题了，不同的商品分类，可能属性是不一样的，比如手机有内存，衣服有尺码，我们是全品类的电商网站，这些不同的商品的不同属性，如何设计到一张表中？</p>
<h3 id="1-2-2-分析规格参数"><a href="#1-2-2-分析规格参数" class="headerlink" title="1.2.2.分析规格参数"></a>1.2.2.分析规格参数</h3><p>仔细查看每一种商品的规格你会发现：</p>
<p>虽然商品规格千变万化，但是同一类商品（如手机）的规格是统一的，有图为证：</p>
<blockquote>
<p>华为的规格：</p>
</blockquote>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526087063700.png" srcset="/img/loading.gif" alt="1526087063700"></p>
<blockquote>
<p>三星的规格：</p>
</blockquote>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526087142454.png" srcset="/img/loading.gif" alt="1526087142454"></p>
<p>也就是说，商品的规格参数应该是与分类绑定的。<strong>每一个分类都有统一的规格参数模板，但不同商品其参数值可能不同</strong>。</p>
<p>如下图所示：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526088168565.png" srcset="/img/loading.gif" alt="1526088168565"></p>
<h3 id="1-2-3-SKU的特有属性"><a href="#1-2-3-SKU的特有属性" class="headerlink" title="1.2.3.SKU的特有属性"></a>1.2.3.SKU的特有属性</h3><p>SPU中会有一些特殊属性，用来区分不同的SKU，我们称为SKU特有属性。如华为META10的颜色、内存属性。</p>
<p>不同种类的商品，一个手机，一个衣服，其SKU属性不相同。</p>
<p>同一种类的商品，比如都是衣服，SKU属性基本是一样的，都是颜色、尺码等。</p>
<p>这样说起来，似乎SKU的特有属性也是与分类相关的？事实上，仔细观察你会发现，<strong>SKU的特有属性是商品规格参数的一部分</strong>：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526088981953.png" srcset="/img/loading.gif" alt="1526088981953"></p>
<p>也就是说，我们没必要单独对SKU的特有属性进行设计，它可以看做是规格参数中的一部分。这样规格参数中的属性可以标记成两部分：</p>
<ul>
<li>所有sku共享的规格属性（称为全局属性）</li>
<li>每个sku不同的规格属性（称为特有属性）</li>
</ul>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526089506566.png" srcset="/img/loading.gif" alt="1526089506566"></p>
<h3 id="1-2-4-搜索属性"><a href="#1-2-4-搜索属性" class="headerlink" title="1.2.4.搜索属性"></a>1.2.4.搜索属性</h3><p>打开一个搜索页，我们来看看过滤的条件：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526090072535.png" srcset="/img/loading.gif" alt="1526090072535"></p>
<p>你会发现，过滤条件中的屏幕尺寸、运行内存、网路、机身内存、电池容量、CPU核数等，在规格参数中都能找到：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526090228171.png" srcset="/img/loading.gif" alt="1526090228171"></p>
<p>也就是说，规格参数中的数据，将来会有一部分作为搜索条件来使用。我们可以在设计时，将这部分属性标记出来，将来做搜索的时候，作为过滤条件。要注意的是，无论是SPU的全局属性，还是SKU的特有属性，都有可能作为搜索过滤条件的，并不冲突，而是有一个交集：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526091216124.png" srcset="/img/loading.gif" alt="1526091216124"></p>
<h2 id="1-3-规格参数表"><a href="#1-3-规格参数表" class="headerlink" title="1.3.规格参数表"></a>1.3.规格参数表</h2><h3 id="1-3-1-表结构"><a href="#1-3-1-表结构" class="headerlink" title="1.3.1.表结构"></a>1.3.1.表结构</h3><p>先看下规格参数表：</p>
<div class="hljs"><pre><code class="hljs mysql">CREATE TABLE &#96;tb_specification&#96; (
  &#96;category_id&#96; bigint(20) NOT NULL COMMENT &#39;规格模板所属商品分类id&#39;,
  &#96;specifications&#96; varchar(3000) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;规格参数模板，json格式&#39;,
  PRIMARY KEY (&#96;category_id&#96;)
) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COMMENT&#x3D;&#39;商品规格参数模板，json格式。&#39;;</code></pre></div>

<p>很奇怪是吧，只有两个字段。特别需要注意的是第二个字段：</p>
<ul>
<li>specificatons：规格参数模板，json格式</li>
</ul>
<p>为什么是一个json？我们看下规格参数的格式：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526092179381.png" srcset="/img/loading.gif" alt="1526092179381"></p>
<p>如果按照传统数据库设计，这里至少需要3张表：</p>
<ul>
<li>group：代表组，与商品分类关联</li>
<li>param_key：属性名，与组关联，一对多</li>
<li>param_value：属性备选值，与属性名关联，一对多</li>
</ul>
<p>这样程序的复杂度大大增加，但是提高了数据的复用性。</p>
<p>我们的解决方案是，采用json来保存整个规格参数模板，不需要额外的表，一个字符串就够了。</p>
<h3 id="1-3-2-json结构分析"><a href="#1-3-2-json结构分析" class="headerlink" title="1.3.2.json结构分析"></a>1.3.2.json结构分析</h3><blockquote>
<p>先整体看一下：</p>
</blockquote>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526092693138.png" srcset="/img/loading.gif" alt="1526092693138"></p>
<ul>
<li>因为规格参数分为很多组，所以json最外层是一个数组。</li>
<li>数组中是对象类型，每个对象代表一个组的数据，对象的属性包括：<ul>
<li>group：组的名称</li>
<li>params：该组的所有属性</li>
</ul>
</li>
</ul>
<blockquote>
<p>接下来是params：</p>
</blockquote>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526093111370.png" srcset="/img/loading.gif" alt="1526093111370"></p>
<p>以<code>主芯片</code>这一组为例：</p>
<ul>
<li><p>group：注明，这里是主芯片</p>
</li>
<li><p>params：该组的所有规格属性，因为不止一个，所以是一个数组。这里包含四个规格属性：CPU品牌，CPU型号，CPU频率，CPU核数。每个规格属性都是一个对象，包含以下信息：</p>
<ul>
<li>k：属性名称</li>
<li>searchable：是否作为搜索字段，将来在搜索页面使用，boolean类型</li>
<li>global：是否是SPU全局属性，boolean类型。true为全局属性，false为SKU的特有属性</li>
<li>options：属性值的可选项，数组结构。起约束作用，不允许填写可选项以外的值，比如CPU核数，有人添10000核岂不是很扯淡</li>
<li>numerical：是否为数值，boolean类型，true则为数值，false则不是。为空也代表非数值</li>
<li>unit：单位，如：克，毫米。如果是数值类型，那么就需要有单位，否则可以不填。</li>
</ul>
</li>
</ul>
<p>上面的截图中所有属性都是全局属性，我们来看看内存，应该是特有属性：</p>
<p>  <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526262641446.png" srcset="/img/loading.gif" alt="1526262641446"></p>
<p>总结下：</p>
<ul>
<li>规格参数分组，每组有多个参数</li>
<li>参数的 <code>k</code>代表属性名称，没有值，具体的SPU才能确定值</li>
<li>参数会有不同的属性：是否可搜索，是否是全局、是否是数值，这些都用boolean值进行标记：<ul>
<li>SPU下的多个SKU共享的参数称为全局属性，用<code>global</code>标记</li>
<li>SPU下的多个SKU特有的参数称为特有属性</li>
<li>如果参数是数值类型，用<code>numerical</code>标记，并且指定单位<code>unit</code></li>
<li>如果参数可搜索，用<code>searchable</code>标记</li>
</ul>
</li>
</ul>
<h1 id="2-商品规格参数管理"><a href="#2-商品规格参数管理" class="headerlink" title="2.商品规格参数管理"></a>2.商品规格参数管理</h1><h2 id="2-1-页面实现"><a href="#2-1-页面实现" class="headerlink" title="2.1.页面实现"></a>2.1.页面实现</h2><p>页面比较复杂，这里就不带着大家去实现完整页面效果了，我们一起分析一下即可。</p>
<h3 id="2-1-1-整体布局"><a href="#2-1-1-整体布局" class="headerlink" title="2.1.1.整体布局"></a>2.1.1.整体布局</h3><p>打开规格参数页面，看到如下内容：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526095296462.png" srcset="/img/loading.gif" alt="1526095296462"></p>
<p>因为规格是跟商品分类绑定的，因此首先会展现商品分类树，并且提示你要选择商品分类，才能看到规格参数的模板。一起了解下页面的实现：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526095548672.png" srcset="/img/loading.gif" alt="1526095548672"></p>
<p>可以看出页面分成3个部分：</p>
<ul>
<li><p><code>v-card-title</code>：标题部分，这里是提示信息，告诉用户要先选择分类，才能看到模板</p>
</li>
<li><p><code>v-tree</code>：这里用到的是我们之前讲过的树组件，展示商品分类树，不过现在是假数据，我们只要把<code>treeData</code>属性删除，它就会走<code>url</code>属性指定的路径去查询真实的商品分类树了。</p>
<div class="hljs"><pre><code class="hljs js">&lt;v-tree url=<span class="hljs-string">"/item/category/list"</span> :isEdit=<span class="hljs-string">"false"</span>  @handleClick=<span class="hljs-string">"handleClick"</span> /&gt;</code></pre></div>
</li>
<li><p><code>v-dialog</code>：Vuetify提供的对话框组件，v-model绑定的dialog属性是boolean类型：</p>
<ul>
<li>true则显示弹窗</li>
<li>false则隐藏弹窗</li>
</ul>
</li>
</ul>
<h3 id="2-1-2-data中定义的属性"><a href="#2-1-2-data中定义的属性" class="headerlink" title="2.1.2.data中定义的属性"></a>2.1.2.data中定义的属性</h3><p>接下来，看看Vue实例中data定义了哪些属性，对页面会产生怎样的影响：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526287774316.png" srcset="/img/loading.gif" alt="1526287774316"></p>
<ul>
<li>specifications：选中一个商品分类后，需要查询后台获取规格参数信息，保存在这个对象中，Vue会完成页面渲染。</li>
<li>oldSpec：当前页兼具了规格的增、改、查等功能，这个对象记录被修改前的规格参数，以防用户撤销修改，用来恢复数据。</li>
<li>dialog：是否显示对话框的标记。true则显示，false则不显示</li>
<li>currentNode：记录当前选中的商品分类节点</li>
<li>isInsert：判断接下来是新增还是修改</li>
</ul>
<h2 id="2-2-规格参数的查询"><a href="#2-2-规格参数的查询" class="headerlink" title="2.2.规格参数的查询"></a>2.2.规格参数的查询</h2><p>点击树节点后要显示规格参数，因此查询功能应该编写在点击事件中。</p>
<p>了解一下：</p>
<h3 id="2-2-1-树节点的点击事件"><a href="#2-2-1-树节点的点击事件" class="headerlink" title="2.2.1.树节点的点击事件"></a>2.2.1.树节点的点击事件</h3><p>当我们点击树节点时，要将<code>v-dialog</code>打开，因此必须绑定一个点击事件：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526095959539.png" srcset="/img/loading.gif" alt="1526095959539"></p>
<p>我们来看下<code>handleClick</code>方法：</p>
<div class="hljs"><pre><code class="hljs js">handleClick(node) &#123;
    <span class="hljs-comment">// 判断点击的节点是否是父节点（只有点击到叶子节点才会弹窗）</span>
    <span class="hljs-keyword">if</span> (!node.isParent) &#123;
        <span class="hljs-comment">// 如果是叶子节点，那么就发起ajax请求，去后台查询商品规格数据。</span>
        <span class="hljs-keyword">this</span>.$http.get(<span class="hljs-string">"/item/spec/"</span> + node.id)
            .then(<span class="hljs-function"><span class="hljs-params">resp</span> =&gt;</span> &#123;
            <span class="hljs-comment">// 查询成功后，把响应结果赋值给specifications属性，Vue会进行自动渲染。</span>
            <span class="hljs-keyword">this</span>.specifications = resp.data;
            <span class="hljs-comment">// 记录下此时的规格数据，当页面撤销修改时，用来恢复原始数据</span>
            <span class="hljs-keyword">this</span>.oldSpec = resp.data;
            <span class="hljs-comment">// 打开弹窗</span>
            <span class="hljs-keyword">this</span>.dialog = <span class="hljs-literal">true</span>;
            <span class="hljs-comment">// 标记此时要进行修改操作</span>
            <span class="hljs-keyword">this</span>.isInsert = <span class="hljs-literal">false</span>;
        &#125;)
            .catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
            <span class="hljs-comment">// 如果没有查询成功，那么询问是否添加规格</span>
            <span class="hljs-keyword">this</span>.$message.confirm(<span class="hljs-string">'该分类还没有规格参数，是否添加?'</span>)
                .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
                <span class="hljs-comment">// 如果要添加，则将specifications初始化为空</span>
                <span class="hljs-keyword">this</span>.specifications = [&#123;
                    group: <span class="hljs-string">''</span>,
                    params: []
                &#125;];
                <span class="hljs-comment">// 打开弹窗</span>
                <span class="hljs-keyword">this</span>.dialog = <span class="hljs-literal">true</span>;
                <span class="hljs-comment">// 标记为新增</span>
                <span class="hljs-keyword">this</span>.isInsert = <span class="hljs-literal">true</span>;
            &#125;)
        &#125;)
    &#125;
&#125;</code></pre></div>



<p>因此，我们接下来要做的事情，就是编写接口，实现规格参数的查询了。</p>
<h3 id="2-2-2-后端代码"><a href="#2-2-2-后端代码" class="headerlink" title="2.2.2.后端代码"></a>2.2.2.后端代码</h3><blockquote>
<p>实体类</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"tb_specification"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Specification</span> </span>&#123;

    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long categoryId;
    <span class="hljs-keyword">private</span> String specifications;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Long <span class="hljs-title">getCategoryId</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> categoryId;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCategoryId</span><span class="hljs-params">(Long categoryId)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.categoryId = categoryId;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getSpecifications</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> specifications;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSpecifications</span><span class="hljs-params">(String specifications)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.specifications = specifications;
    &#125;
&#125;</code></pre></div>

<blockquote>
<p>mapper</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SpecificationMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Mapper</span>&lt;<span class="hljs-title">Specification</span>&gt; </span>&#123;
&#125;</code></pre></div>

<blockquote>
<p>controller</p>
</blockquote>
<p>先分析下需要的东西，在页面的ajax请求中可以看出：</p>
<ul>
<li><p>请求方式：查询，肯定是get</p>
</li>
<li><p>请求路径：/spec/{cid} ，这里通过路径占位符传递商品分类的id</p>
</li>
<li><p>请求参数：商品分类id</p>
</li>
<li><p>返回结果：页面是直接把<code>resp.data</code>赋值给了specifications：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526104087329.png" srcset="/img/loading.gif" alt="1526104087329"></p>
<p>那么我们返回的应该是规格参数的字符串</p>
</li>
</ul>
<p>代码：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"spec"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpecificationController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SpecificationService specificationService;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"&#123;id&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;String&gt; <span class="hljs-title">querySpecificationByCategoryId</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> Long id)</span>&#123;
        Specification spec = <span class="hljs-keyword">this</span>.specificationService.queryById(id);
        <span class="hljs-keyword">if</span> (spec == <span class="hljs-keyword">null</span>) &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);
        &#125;
        <span class="hljs-keyword">return</span> ResponseEntity.ok(spec.getSpecifications());
    &#125;
&#125;</code></pre></div>



<blockquote>
<p>service:</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpecificationService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SpecificationMapper specificationMapper;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Specification <span class="hljs-title">queryById</span><span class="hljs-params">(Long id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.specificationMapper.selectByPrimaryKey(id);
    &#125;
&#125;</code></pre></div>



<blockquote>
<p>页面访问测试：</p>
</blockquote>
<p>目前，我们数据库只提供了3条规格参数信息：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526104551227.png" srcset="/img/loading.gif" alt="1526104551227"></p>
<p>我们访问：<a href="http://api.leyou.com/api/item/spec/76" target="_blank" rel="noopener">http://api.leyou.com/api/item/spec/76</a></p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526104475036.png" srcset="/img/loading.gif" alt="1526104475036"></p>
<p>然后在后台系统中测试：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526104599452.png" srcset="/img/loading.gif" alt="1526104599452"></p>
<p>当我们点击一个还不存在的规格参数的商品分类：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526104769276.png" srcset="/img/loading.gif" alt="1526104769276"></p>
<h2 id="2-3-增、删、改（作业）"><a href="#2-3-增、删、改（作业）" class="headerlink" title="2.3.增、删、改（作业）"></a>2.3.增、删、改（作业）</h2><p>增删改的作业就留给大家去完成了。页面中接口都已定义，你要做的就是实现后台接口。</p>
<h1 id="3-SPU和SKU数据结构"><a href="#3-SPU和SKU数据结构" class="headerlink" title="3.SPU和SKU数据结构"></a>3.SPU和SKU数据结构</h1><p>规格确定以后，就可以添加商品了,先看下数据库表</p>
<h2 id="3-1-SPU表"><a href="#3-1-SPU表" class="headerlink" title="3.1.SPU表"></a>3.1.SPU表</h2><h3 id="3-1-1-表结构"><a href="#3-1-1-表结构" class="headerlink" title="3.1.1.表结构"></a>3.1.1.表结构</h3><p>SPU表：</p>
<div class="hljs"><pre><code class="hljs mysql">CREATE TABLE &#96;tb_spu&#96; (
  &#96;id&#96; bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;spu id&#39;,
  &#96;title&#96; varchar(255) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;标题&#39;,
  &#96;sub_title&#96; varchar(255) DEFAULT &#39;&#39; COMMENT &#39;子标题&#39;,
  &#96;cid1&#96; bigint(20) NOT NULL COMMENT &#39;1级类目id&#39;,
  &#96;cid2&#96; bigint(20) NOT NULL COMMENT &#39;2级类目id&#39;,
  &#96;cid3&#96; bigint(20) NOT NULL COMMENT &#39;3级类目id&#39;,
  &#96;brand_id&#96; bigint(20) NOT NULL COMMENT &#39;商品所属品牌id&#39;,
  &#96;saleable&#96; tinyint(1) NOT NULL DEFAULT &#39;1&#39; COMMENT &#39;是否上架，0下架，1上架&#39;,
  &#96;valid&#96; tinyint(1) NOT NULL DEFAULT &#39;1&#39; COMMENT &#39;是否有效，0已删除，1有效&#39;,
  &#96;create_time&#96; datetime DEFAULT NULL COMMENT &#39;添加时间&#39;,
  &#96;last_update_time&#96; datetime DEFAULT NULL COMMENT &#39;最后修改时间&#39;,
  PRIMARY KEY (&#96;id&#96;)
) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;208 DEFAULT CHARSET&#x3D;utf8 COMMENT&#x3D;&#39;spu表，该表描述的是一个抽象的商品，比如 iphone8&#39;;</code></pre></div>

<p>与我们前面分析的基本类似，但是似乎少了一些字段，比如商品描述。</p>
<p>我们做了表的垂直拆分，将SPU的详情放到了另一张表：tb_spu_detail</p>
<div class="hljs"><pre><code class="hljs mysql">CREATE TABLE &#96;tb_spu_detail&#96; (
  &#96;spu_id&#96; bigint(20) NOT NULL,
  &#96;description&#96; text COMMENT &#39;商品描述信息&#39;,
  &#96;specifications&#96; varchar(3000) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;全部规格参数数据&#39;,
  &#96;spec_template&#96; varchar(1000) NOT NULL COMMENT &#39;特有规格参数及可选值信息，json格式&#39;,
  &#96;packing_list&#96; varchar(1000) DEFAULT &#39;&#39; COMMENT &#39;包装清单&#39;,
  &#96;after_service&#96; varchar(1000) DEFAULT &#39;&#39; COMMENT &#39;售后服务&#39;,
  PRIMARY KEY (&#96;spu_id&#96;)
) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8;</code></pre></div>

<p>这张表中的数据都比较大，为了不影响主表的查询效率我们拆分出这张表。</p>
<p>需要注意的是这两个字段：specifications和spec_template。</p>
<h3 id="3-1-2-spu中的规格参数"><a href="#3-1-2-spu中的规格参数" class="headerlink" title="3.1.2.spu中的规格参数"></a>3.1.2.spu中的规格参数</h3><p>前面讲过规格参数与商品分类绑定，一个分类下的所有SPU具有类似的规格参数。SPU下的SKU可能会有不同的规格参数，因此我们计划是这样：</p>
<ul>
<li>SPU中保存全局的规格参数信息。</li>
<li>SKU中保存特有规格参数。</li>
</ul>
<p>以手机为例，品牌、操作系统等肯定是全局属性，内存、颜色等肯定是特有属性。</p>
<p>当你确定了一个SPU，比如小米的：红米4X</p>
<p>全局属性举例：</p>
<div class="hljs"><pre><code class="hljs angelscript">品牌：小米
型号：红米<span class="hljs-number">4</span>X</code></pre></div>

<p>特有属性举例：</p>
<div class="hljs"><pre><code class="hljs angelscript">颜色：[香槟金, 樱花粉, 磨砂黑]
内存：[<span class="hljs-number">2</span>G, <span class="hljs-number">3</span>G]
机身存储：[<span class="hljs-number">16</span>GB, <span class="hljs-number">32</span>GB]</code></pre></div>

<p>来看下我们的 表如何存储这些信息：</p>
<h4 id="3-1-2-1-specifications字段"><a href="#3-1-2-1-specifications字段" class="headerlink" title="3.1.2.1.specifications字段"></a>3.1.2.1.specifications字段</h4><p>首先是specifications，其中保存全部规格参数信息，因此也是一个json格式：</p>
<blockquote>
<p>整体来看：</p>
</blockquote>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526262279963.png" srcset="/img/loading.gif" alt="1526262279963"></p>
<p>整体看上去与规格参数表中的数据一样，也是一个数组，并且分组，每组下有多个参数</p>
<blockquote>
<p>展开一组来看</p>
</blockquote>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526262389233.png" srcset="/img/loading.gif" alt="1526262389233"></p>
<p>可以看到，与规格参数表中的模板相比，最大的区别就是，这里指定了具体的值，因为商品确定了，其参数值肯定也确定了。</p>
<blockquote>
<p>特有属性</p>
</blockquote>
<p>刚才看到的是全局属性，那么特有属性在这个字段中如何存储呢？</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526263214087.png" srcset="/img/loading.gif" alt="1526263214087"></p>
<p>我们发现特有属性也是有的，但是，注意看这里是不确定具体值的，因为特有属性只有在SKU中才能确定。这里只是保存了options，所有SKU属性的可选项。</p>
<p>在哪里会用到这个字段的值呢，商品详情页的规格参数信息中：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526267700765.png" srcset="/img/loading.gif" alt="1526267700765"></p>
<h4 id="3-1-2-2-spec-template字段"><a href="#3-1-2-2-spec-template字段" class="headerlink" title="3.1.2.2.spec_template字段"></a>3.1.2.2.spec_template字段</h4><p>既然specifications已经包含了所有的规格参数，那么为什么又多出了一个spec_template呢？</p>
<p>里面又有哪些内容呢？</p>
<p>来看数据格式：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526267952827.png" srcset="/img/loading.gif" alt="1526267952827"></p>
<p>可以看出，里面只保存了规格参数中的特有属性，而且格式进行了大大的简化，只有属性的key，和待选项。</p>
<p>为什么要冗余保存一份？</p>
<p>因为很多场景下我们只需要查询特有规格属性，如果放在一起，每次查询再去分离比较麻烦。</p>
<p>比如，商品详情页展示可选的规格参数时：</p>
<p>   <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526267828817.png" srcset="/img/loading.gif" alt="1526267828817"></p>
<h2 id="3-2-SKU表"><a href="#3-2-SKU表" class="headerlink" title="3.2.SKU表"></a>3.2.SKU表</h2><h3 id="3-2-1-表结构"><a href="#3-2-1-表结构" class="headerlink" title="3.2.1.表结构"></a>3.2.1.表结构</h3><div class="hljs"><pre><code class="hljs mysql">CREATE TABLE &#96;tb_sku&#96; (
  &#96;id&#96; bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;sku id&#39;,
  &#96;spu_id&#96; bigint(20) NOT NULL COMMENT &#39;spu id&#39;,
  &#96;title&#96; varchar(255) NOT NULL COMMENT &#39;商品标题&#39;,
  &#96;images&#96; varchar(1000) DEFAULT &#39;&#39; COMMENT &#39;商品的图片，多个图片以‘,’分割&#39;,
  &#96;price&#96; bigint(15) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;销售价格，单位为分&#39;,
  &#96;indexes&#96; varchar(100) COMMENT &#39;特有规格属性在spu属性模板中的对应下标组合&#39;,
  &#96;own_spec&#96; varchar(1000) COMMENT &#39;sku的特有规格参数，json格式，反序列化时应使用linkedHashMap，保证有序&#39;,
  &#96;enable&#96; tinyint(1) NOT NULL DEFAULT &#39;1&#39; COMMENT &#39;是否有效，0无效，1有效&#39;,
  &#96;create_time&#96; datetime NOT NULL COMMENT &#39;添加时间&#39;,
  &#96;last_update_time&#96; datetime NOT NULL COMMENT &#39;最后修改时间&#39;,
  PRIMARY KEY (&#96;id&#96;),
  KEY &#96;key_spu_id&#96; (&#96;spu_id&#96;) USING BTREE
) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COMMENT&#x3D;&#39;sku表,该表表示具体的商品实体,如黑色的64GB的iphone 8&#39;;</code></pre></div>

<p>还有一张表，代表库存：</p>
<div class="hljs"><pre><code class="hljs mysql">CREATE TABLE &#96;tb_stock&#96; (
  &#96;sku_id&#96; bigint(20) NOT NULL COMMENT &#39;库存对应的商品sku id&#39;,
  &#96;seckill_stock&#96; int(9) DEFAULT &#39;0&#39; COMMENT &#39;可秒杀库存&#39;,
  &#96;seckill_total&#96; int(9) DEFAULT &#39;0&#39; COMMENT &#39;秒杀总数量&#39;,
  &#96;stock&#96; int(9) NOT NULL COMMENT &#39;库存数量&#39;,
  PRIMARY KEY (&#96;sku_id&#96;)
) ENGINE&#x3D;InnoDB DEFAULT CHARSET&#x3D;utf8 COMMENT&#x3D;&#39;库存表，代表库存，秒杀库存等信息&#39;;</code></pre></div>

<p>问题：为什么要将库存独立一张表？</p>
<p>因为库存字段写频率较高，而SKU的其它字段以读为主，因此我们将两张表分离，读写不会干扰。</p>
<p>特别需要注意的是sku表中的<code>indexes</code>字段和<code>own_spec</code>字段。sku中应该保存特有规格参数的值，就在这两个字段中。</p>
<h3 id="3-2-2-sku中的特有规格参数"><a href="#3-2-2-sku中的特有规格参数" class="headerlink" title="3.2.2.sku中的特有规格参数"></a>3.2.2.sku中的特有规格参数</h3><h4 id="3-2-2-1-indexes字段"><a href="#3-2-2-1-indexes字段" class="headerlink" title="3.2.2.1.indexes字段"></a>3.2.2.1.indexes字段</h4><p>在SPU表中，已经对特有规格参数及可选项进行了保存，结构如下：</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"机身颜色"</span>: [
        <span class="hljs-string">"香槟金"</span>,
        <span class="hljs-string">"樱花粉"</span>,
        <span class="hljs-string">"磨砂黑"</span>
    ],
    <span class="hljs-attr">"内存"</span>: [
        <span class="hljs-string">"2GB"</span>,
        <span class="hljs-string">"3GB"</span>
    ],
    <span class="hljs-attr">"机身存储"</span>: [
        <span class="hljs-string">"16GB"</span>,
        <span class="hljs-string">"32GB"</span>
    ]
&#125;</code></pre></div>

<p>这些特有属性如果排列组合，会产生12个不同的SKU，而不同的SKU，其属性就是上面备选项中的一个。</p>
<p>比如：</p>
<ul>
<li>红米4X，香槟金，2GB内存，16GB存储</li>
<li>红米4X，磨砂黑，2GB内存，32GB存储</li>
</ul>
<p>你会发现，每一个属性值，对应于SPUoptions数组的一个选项，如果我们记录下角标，就是这样：</p>
<ul>
<li>红米4X，0,0,0</li>
<li>红米4X，2,0,1</li>
</ul>
<p>既然如此，我们是不是可以将不同角标串联起来，作为SPU下不同SKU的标示。这就是我们的indexes字段。</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526266901335.png" srcset="/img/loading.gif" alt="1526266901335"></p>
<p>这个设计在商品详情页会特别有用：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526267180997.png" srcset="/img/loading.gif" alt="1526267180997"></p>
<p>当用户点击选中一个特有属性，你就能根据 角标快速定位到sku。</p>
<h4 id="3-2-2-2-own-spec字段"><a href="#3-2-2-2-own-spec字段" class="headerlink" title="3.2.2.2.own_spec字段"></a>3.2.2.2.own_spec字段</h4><p>看结构：</p>
<div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"机身颜色"</span>:<span class="hljs-string">"香槟金"</span>,<span class="hljs-attr">"内存"</span>:<span class="hljs-string">"2GB"</span>,<span class="hljs-attr">"机身存储"</span>:<span class="hljs-string">"16GB"</span>&#125;</code></pre></div>

<p>保存的是特有属性的键值对。</p>
<p>SPU中保存的是可选项，但不确定具体的值，而SKU中的保存的就是具体的键值对了。</p>
<p>这样，在页面展示规格参数信息时，就可以根据key来获取值，用于显示。</p>
<h2 id="3-3-导入图片信息"><a href="#3-3-导入图片信息" class="headerlink" title="3.3.导入图片信息"></a>3.3.导入图片信息</h2><p>现在商品表中虽然有数据，但是所有的图片信息都是无法访问的，我们需要把图片导入到虚拟机：</p>
<p>首先，把课前资料提供的数据上传到虚拟机下：<code>/leyou/static</code>目录：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1527823423289.png" srcset="/img/loading.gif" alt="1527823423289"></p>
<p>然后，使用命令解压缩：</p>
<div class="hljs"><pre><code class="hljs sh">unzip images.zip</code></pre></div>



<p>修改Nginx配置，使nginx反向代理这些图片地址：</p>
<div class="hljs"><pre><code class="hljs sh">vim /opt/nginx/config/nginx.conf</code></pre></div>

<p>修改成如下配置：</p>
<div class="hljs"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;
    <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;
    <span class="hljs-attribute">server_name</span>  image.leyou.com;

    <span class="hljs-comment"># 监听域名中带有group的，交给FastDFS模块处理</span>
    <span class="hljs-attribute">location</span> ~/group([<span class="hljs-number">0</span>-<span class="hljs-number">9</span>])/ &#123;
        ngx_fastdfs_module;
    &#125;
    <span class="hljs-comment"># 将其它图片代理指向本地的/leyou/static目录</span>
    <span class="hljs-attribute">location</span> / &#123;
        <span class="hljs-attribute">root</span>   /leyou/static/;
    &#125;

    <span class="hljs-attribute">error_page</span>   <span class="hljs-number">500</span> <span class="hljs-number">502</span> <span class="hljs-number">503</span> <span class="hljs-number">504</span>  /50x.html;
    <span class="hljs-attribute">location</span> = /50x.html &#123;
        <span class="hljs-attribute">root</span>   html;
    &#125;

&#125;</code></pre></div>



<h1 id="4-商品查询"><a href="#4-商品查询" class="headerlink" title="4.商品查询"></a>4.商品查询</h1><h2 id="4-1-效果预览"><a href="#4-1-效果预览" class="headerlink" title="4.1.效果预览"></a>4.1.效果预览</h2><p>接下来，我们实现商品管理的页面，先看下我们要实现的效果：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526268595873.png" srcset="/img/loading.gif" alt="1526268595873"></p>
<p>可以看出整体是一个table，然后有新增按钮。是不是跟昨天写品牌管理很像？</p>
<p>模板代码在分别在Goods.vue</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526269215532.png" srcset="/img/loading.gif" alt="1526269215532"></p>
<h2 id="4-2-从0开始"><a href="#4-2-从0开始" class="headerlink" title="4.2.从0开始"></a>4.2.从0开始</h2><p>接下来，我们自己来实现一下，新建两个组件：MyGoods.vue和MyGoodsForm.vue</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526269362233.png" srcset="/img/loading.gif" alt="1526269362233"></p>
<p>内容先随意：</p>
<div class="hljs"><pre><code class="hljs vue">&lt;template&gt;
  &lt;v-card&gt;
      MyGoods
  &lt;&#x2F;v-card&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;

  export default &#123;
    name: &quot;my-goods&quot;,
    data() &#123;
      return &#123;
      &#125;
    &#125;
  &#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;

&lt;&#x2F;style&gt;</code></pre></div>

<p>然后修改menu.js,新建一个菜单：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526269555118.png" srcset="/img/loading.gif" alt="1526269555118"></p>
<p>修改router/index.js，添加一个路由：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526269615639.png" srcset="/img/loading.gif" alt="1526269615639"></p>
<p>预览一下：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526269739468.png" srcset="/img/loading.gif" alt="1526269739468"></p>
<h2 id="4-3-页面实现"><a href="#4-3-页面实现" class="headerlink" title="4.3.页面实现"></a>4.3.页面实现</h2><h3 id="4-3-1-页面基本表格"><a href="#4-3-1-页面基本表格" class="headerlink" title="4.3.1.页面基本表格"></a>4.3.1.页面基本表格</h3><p>商品列表页与品牌列表页几乎一样，我们可以直接去复制一份过来，然后进行一些修改。</p>
<p>首先，字段不一样，商品列表也展示的SPU信息，包含以下字段：</p>
<div class="hljs"><pre><code class="hljs applescript"><span class="hljs-built_in">id</span>：
title：标题
cname：商品分类名称
bname：品牌名称</code></pre></div>

<p>完整代码：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">v-card</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-card-title</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addGoods"</span>&gt;</span>新增商品<span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
      <span class="hljs-comment">&lt;!--搜索框，与search属性关联--&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-spacer</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-text-field</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"输入关键字搜索"</span> <span class="hljs-attr">v-model.lazy</span>=<span class="hljs-string">"search"</span> <span class="hljs-attr">append-icon</span>=<span class="hljs-string">"search"</span> <span class="hljs-attr">hide-details</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-card-title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-divider</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-data-table</span></span>
<span class="hljs-tag">      <span class="hljs-attr">:headers</span>=<span class="hljs-string">"headers"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">:items</span>=<span class="hljs-string">"goodsList"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">:search</span>=<span class="hljs-string">"search"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">:pagination.sync</span>=<span class="hljs-string">"pagination"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">:total-items</span>=<span class="hljs-string">"totalGoods"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">:loading</span>=<span class="hljs-string">"loading"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">class</span>=<span class="hljs-string">"elevation-1"</span></span>
<span class="hljs-tag">    &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"items"</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">"props"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>&#123;&#123; props.item.id &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xs-center"</span>&gt;</span>&#123;&#123; props.item.title &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xs-center"</span>&gt;</span>&#123;&#123;props.item.cname&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xs-center"</span>&gt;</span>&#123;&#123; props.item.bname &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"justify-center layout"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"info"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"editGoods(props.item)"</span>&gt;</span>编辑<span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"warning"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> &gt;</span>下架<span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-data-table</span>&gt;</span>
    <span class="hljs-comment">&lt;!--弹出的对话框--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-dialog</span> <span class="hljs-attr">max-width</span>=<span class="hljs-string">"500"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"show"</span> <span class="hljs-attr">persistent</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-card</span>&gt;</span>
        <span class="hljs-comment">&lt;!--对话框的标题--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">v-toolbar</span> <span class="hljs-attr">dense</span> <span class="hljs-attr">dark</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">v-toolbar-title</span>&gt;</span>&#123;&#123;isEdit ? '修改' : '新增'&#125;&#125;商品<span class="hljs-tag">&lt;/<span class="hljs-name">v-toolbar-title</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">v-spacer</span>/&gt;</span>
          <span class="hljs-comment">&lt;!--关闭窗口的按钮--&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">icon</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"closeWindow"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">v-icon</span>&gt;</span>close<span class="hljs-tag">&lt;/<span class="hljs-name">v-icon</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">v-toolbar</span>&gt;</span>
        <span class="hljs-comment">&lt;!--对话框的内容，表单--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">v-card-text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"px-5"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">my-goods-form</span> <span class="hljs-attr">:oldGoods</span>=<span class="hljs-string">"oldGoods"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">v-card-text</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">v-card</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-dialog</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">v-card</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>
<span class="actionscript">  <span class="hljs-comment">// 导入自定义的表单组件</span></span>
<span class="javascript">  <span class="hljs-keyword">import</span> MyGoodsForm <span class="hljs-keyword">from</span> <span class="hljs-string">'./MyGoodsForm'</span></span>

<span class="javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span>
<span class="actionscript">    name: <span class="hljs-string">"my-goods"</span>,</span>
    data() &#123;
<span class="actionscript">      <span class="hljs-keyword">return</span> &#123;</span>
<span class="actionscript">        search: <span class="hljs-string">''</span>, <span class="hljs-comment">// 搜索过滤字段</span></span>
<span class="actionscript">        totalGoods: <span class="hljs-number">0</span>, <span class="hljs-comment">// 总条数</span></span>
<span class="actionscript">        goodsList: [], <span class="hljs-comment">// 当前页品牌数据</span></span>
<span class="actionscript">        loading: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 是否在加载中</span></span>
<span class="actionscript">        pagination: &#123;&#125;, <span class="hljs-comment">// 分页信息</span></span>
        headers: [
<span class="actionscript">          &#123;text: <span class="hljs-string">'id'</span>, align: <span class="hljs-string">'center'</span>, value: <span class="hljs-string">'id'</span>&#125;,</span>
<span class="actionscript">          &#123;text: <span class="hljs-string">'标题'</span>, align: <span class="hljs-string">'center'</span>, sortable: <span class="hljs-literal">false</span>, value: <span class="hljs-string">'title'</span>&#125;,</span>
<span class="actionscript">          &#123;text: <span class="hljs-string">'商品分类'</span>, align: <span class="hljs-string">'center'</span>, sortable: <span class="hljs-literal">false</span>, value: <span class="hljs-string">'cname'</span>&#125;,</span>
<span class="actionscript">          &#123;text: <span class="hljs-string">'品牌'</span>, align: <span class="hljs-string">'center'</span>, value: <span class="hljs-string">'bname'</span>, sortable: <span class="hljs-literal">false</span>,&#125;,</span>
<span class="actionscript">          &#123;text: <span class="hljs-string">'操作'</span>, align: <span class="hljs-string">'center'</span>, sortable: <span class="hljs-literal">false</span>&#125;</span>
        ],
<span class="actionscript">        show: <span class="hljs-literal">false</span>,<span class="hljs-comment">// 控制对话框的显示</span></span>
<span class="actionscript">        oldGoods: &#123;&#125;, <span class="hljs-comment">// 即将被编辑的商品信息</span></span>
<span class="actionscript">        isEdit: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 是否是编辑</span></span>
      &#125;
    &#125;,
<span class="actionscript">    mounted() &#123; <span class="hljs-comment">// 渲染后执行</span></span>
<span class="actionscript">      <span class="hljs-comment">// 查询数据</span></span>
<span class="actionscript">      <span class="hljs-keyword">this</span>.getDataFromServer();</span>
    &#125;,
    watch: &#123;
<span class="actionscript">      pagination: &#123; <span class="hljs-comment">// 监视pagination属性的变化</span></span>
<span class="actionscript">        deep: <span class="hljs-literal">true</span>, <span class="hljs-comment">// deep为true，会监视pagination的属性及属性中的对象属性变化</span></span>
        handler() &#123;
<span class="actionscript">          <span class="hljs-comment">// 变化后的回调函数，这里我们再次调用getDataFromServer即可</span></span>
<span class="actionscript">          <span class="hljs-keyword">this</span>.getDataFromServer();</span>
        &#125;
      &#125;,
<span class="actionscript">      search: &#123; <span class="hljs-comment">// 监视搜索字段</span></span>
        handler() &#123;
<span class="actionscript">          <span class="hljs-keyword">this</span>.getDataFromServer();</span>
        &#125;
      &#125;
    &#125;,
    methods: &#123;
<span class="actionscript">      getDataFromServer() &#123; <span class="hljs-comment">// 从服务的加载数的方法。</span></span>
<span class="actionscript">        <span class="hljs-comment">// 发起请求</span></span>
<span class="actionscript">        <span class="hljs-keyword">this</span>.$http.get(<span class="hljs-string">"/item/spu/page"</span>, &#123;</span>
          params: &#123;
<span class="actionscript">            key: <span class="hljs-keyword">this</span>.search, <span class="hljs-comment">// 搜索条件</span></span>
<span class="actionscript">            page: <span class="hljs-keyword">this</span>.pagination.page,<span class="hljs-comment">// 当前页</span></span>
<span class="actionscript">            rows: <span class="hljs-keyword">this</span>.pagination.rowsPerPage,<span class="hljs-comment">// 每页大小</span></span>
<span class="actionscript">            sortBy: <span class="hljs-keyword">this</span>.pagination.sortBy,<span class="hljs-comment">// 排序字段</span></span>
<span class="actionscript">            desc: <span class="hljs-keyword">this</span>.pagination.descending<span class="hljs-comment">// 是否降序</span></span>
          &#125;
<span class="javascript">        &#125;).then(<span class="hljs-function"><span class="hljs-params">resp</span> =&gt;</span> &#123; <span class="hljs-comment">// 这里使用箭头函数</span></span>
<span class="actionscript">          <span class="hljs-keyword">this</span>.goodsList = resp.data.items;</span>
<span class="actionscript">          <span class="hljs-keyword">this</span>.totalGoods = resp.data.total;</span>
<span class="actionscript">          <span class="hljs-comment">// 完成赋值后，把加载状态赋值为false</span></span>
<span class="actionscript">          <span class="hljs-keyword">this</span>.loading = <span class="hljs-literal">false</span>;</span>
        &#125;)
      &#125;,
      addGoods() &#123;
<span class="actionscript">        <span class="hljs-comment">// 修改标记</span></span>
<span class="actionscript">        <span class="hljs-keyword">this</span>.isEdit = <span class="hljs-literal">false</span>;</span>
<span class="actionscript">        <span class="hljs-comment">// 控制弹窗可见：</span></span>
<span class="actionscript">        <span class="hljs-keyword">this</span>.show = <span class="hljs-literal">true</span>;</span>
<span class="actionscript">        <span class="hljs-comment">// 把oldBrand变为null</span></span>
<span class="actionscript">        <span class="hljs-keyword">this</span>.oldBrand = <span class="hljs-literal">null</span>;</span>
      &#125;,
      editGoods(oldGoods)&#123;
<span class="actionscript">        <span class="hljs-comment">// 修改标记</span></span>
<span class="actionscript">        <span class="hljs-keyword">this</span>.isEdit = <span class="hljs-literal">true</span>;</span>
<span class="actionscript">        <span class="hljs-comment">// 控制弹窗可见：</span></span>
<span class="actionscript">        <span class="hljs-keyword">this</span>.show = <span class="hljs-literal">true</span>;</span>
<span class="actionscript">        <span class="hljs-comment">// 获取要编辑的brand</span></span>
<span class="actionscript">        <span class="hljs-keyword">this</span>.oldGoods = oldGoods;</span>
      &#125;,
      closeWindow()&#123;
<span class="actionscript">        <span class="hljs-comment">// 重新加载数据</span></span>
<span class="actionscript">        <span class="hljs-keyword">this</span>.getDataFromServer();</span>
<span class="actionscript">        <span class="hljs-comment">// 关闭窗口</span></span>
<span class="actionscript">        <span class="hljs-keyword">this</span>.show = <span class="hljs-literal">false</span>;</span>
      &#125;
    &#125;,
    components:&#123;
      MyGoodsForm
    &#125;
  &#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div>

<p>主要的改动点：</p>
<ul>
<li><p>页面的<code>v-data-table</code>中的属性绑定修改。items指向goodsList，totalItems指向totalGoods</p>
</li>
<li><p>页面渲染的字段名修改：字段改成商品的SPU字段：id、title，cname(商品分类名称),bname（品牌名称）</p>
</li>
<li><p>data属性修改了以下属性：</p>
<ul>
<li>goodsList：当前页商品数据</li>
<li>totalGoods：商品总数</li>
<li>headers：头信息，需要修改头显示名称</li>
<li>oldGoods：准备要修改的商品</li>
</ul>
</li>
<li><p>加载数据的函数：getDataFromServer，请求的路径进行了修改，另外去除了跟排序相关的查询。SPU查询不排序</p>
</li>
<li><p>新增商品的事件函数：清除了一些数据查询接口，只保留弹窗</p>
</li>
</ul>
<p>查看效果：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526272476614.png" srcset="/img/loading.gif" alt="1526272476614"></p>
<p>因为没有编写查询功能，表格一直处于loading状态。</p>
<p>接下来看弹窗：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526272537552.png" srcset="/img/loading.gif" alt="1526272537552"></p>
<h3 id="4-3-2-上下架状态按钮"><a href="#4-3-2-上下架状态按钮" class="headerlink" title="4.3.2.上下架状态按钮"></a>4.3.2.上下架状态按钮</h3><p>另外，似乎页面少了对上下架商品的过滤，在原始效果图中是有的：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526277614649.png" srcset="/img/loading.gif" alt="1526277614649"></p>
<p>这在Vuetify中是一组按钮，我们查看帮助文档：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526277713391.png" srcset="/img/loading.gif" alt="1526277713391"></p>
<p>查看实例得到以下信息：</p>
<p><code>v-btn</code>：一个按钮</p>
<p><code>v-btn-toggle</code>：按钮组，内部可以有多个按钮，点击切换，有以下属性：</p>
<ul>
<li>multiple：是否支持多选，默认是false</li>
<li>value：选中的按钮的值，如果是多选，结果是一个数组；单选，结果是点击的v-btn中的value值，因此按钮组的每个btn都需要指定value属性</li>
</ul>
<p>改造页面：</p>
<p>首先在data中定义一个属性，记录按钮的值。</p>
<div class="hljs"><pre><code class="hljs js">filter:&#123;
    saleable: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 上架还是下架</span>
    search: <span class="hljs-string">''</span>, <span class="hljs-comment">// 搜索过滤字段</span>
&#125;</code></pre></div>

<p>这里我们的做法是定义一个filter属性，内部在定义search来关联过滤字段，saleable来关联上下架情况。</p>
<p>这样watch就必须监听filter，而不是只监听search了：</p>
<div class="hljs"><pre><code class="hljs js">filter: &#123;<span class="hljs-comment">// 监视搜索字段</span>
  handler() &#123;
    <span class="hljs-keyword">this</span>.getDataFromServer();
  &#125;,
  deep:<span class="hljs-literal">true</span>
&#125;</code></pre></div>

<p>另外，页面中与search有关的所有字段都需要修改成filter.search:</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--搜索框，与search属性关联--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-text-field</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"输入关键字搜索"</span> <span class="hljs-attr">v-model.lazy</span>=<span class="hljs-string">"filter.search"</span> <span class="hljs-attr">append-icon</span>=<span class="hljs-string">"search"</span> <span class="hljs-attr">hide-details</span>/&gt;</span></code></pre></div>



<p>然后，在页面中添加按钮组：</p>
<div class="hljs"><pre><code class="hljs html"> <span class="hljs-tag">&lt;<span class="hljs-name">v-flex</span> <span class="hljs-attr">xs3</span>&gt;</span>
     状态：
     <span class="hljs-tag">&lt;<span class="hljs-name">v-btn-toggle</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"filter.saleable"</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">flat</span>&gt;</span>
             全部
         <span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">flat</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"true"</span>&gt;</span>
             上架
         <span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
         <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">flat</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"false"</span>&gt;</span>
             下架
         <span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">v-btn-toggle</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-flex</span>&gt;</span></code></pre></div>

<p>最后，不要忘了在查询时，将saleable携带上：</p>
<div class="hljs"><pre><code class="hljs js">getDataFromServer() &#123; <span class="hljs-comment">// 从服务的加载数的方法。</span>
    <span class="hljs-comment">// 发起请求</span>
    <span class="hljs-keyword">this</span>.$http.get(<span class="hljs-string">"/item/spu/page"</span>, &#123;
        params: &#123;
            key: <span class="hljs-keyword">this</span>.filter.search, <span class="hljs-comment">// 搜索条件</span>
            saleable: <span class="hljs-keyword">this</span>.filter.saleable, <span class="hljs-comment">// 上下架</span>
            page: <span class="hljs-keyword">this</span>.pagination.page,<span class="hljs-comment">// 当前页</span>
            rows: <span class="hljs-keyword">this</span>.pagination.rowsPerPage,<span class="hljs-comment">// 每页大小</span>
        &#125;
    &#125;).then(<span class="hljs-function"><span class="hljs-params">resp</span> =&gt;</span> &#123; <span class="hljs-comment">// 这里使用箭头函数</span>
        <span class="hljs-keyword">this</span>.goodsList = resp.data.items;
        <span class="hljs-keyword">this</span>.totalGoods = resp.data.total;
        <span class="hljs-comment">// 完成赋值后，把加载状态赋值为false</span>
        <span class="hljs-keyword">this</span>.loading = <span class="hljs-literal">false</span>;
    &#125;)
&#125;</code></pre></div>





<h2 id="4-4-后台提供接口"><a href="#4-4-后台提供接口" class="headerlink" title="4.4.后台提供接口"></a>4.4.后台提供接口</h2><p>页面已经准备好，接下来在后台提供分页查询SPU的功能：</p>
<h3 id="4-4-1-实体类"><a href="#4-4-1-实体类" class="headerlink" title="4.4.1.实体类"></a>4.4.1.实体类</h3><blockquote>
<p>SPU</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"tb_spu"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Spu</span> </span>&#123;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> Long brandId;
    <span class="hljs-keyword">private</span> Long cid1;<span class="hljs-comment">// 1级类目</span>
    <span class="hljs-keyword">private</span> Long cid2;<span class="hljs-comment">// 2级类目</span>
    <span class="hljs-keyword">private</span> Long cid3;<span class="hljs-comment">// 3级类目</span>
    <span class="hljs-keyword">private</span> String title;<span class="hljs-comment">// 标题</span>
    <span class="hljs-keyword">private</span> String subTitle;<span class="hljs-comment">// 子标题</span>
    <span class="hljs-keyword">private</span> Boolean saleable;<span class="hljs-comment">// 是否上架</span>
    <span class="hljs-keyword">private</span> Boolean valid;<span class="hljs-comment">// 是否有效，逻辑删除用</span>
    <span class="hljs-keyword">private</span> Date createTime;<span class="hljs-comment">// 创建时间</span>
    <span class="hljs-keyword">private</span> Date lastUpdateTime;<span class="hljs-comment">// 最后修改时间</span>
	<span class="hljs-comment">// 省略getter和setter</span>
&#125;</code></pre></div>



<blockquote>
<p>SPU详情</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"tb_spu_detail"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpuDetail</span> </span>&#123;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long spuId;<span class="hljs-comment">// 对应的SPU的id</span>
    <span class="hljs-keyword">private</span> String description;<span class="hljs-comment">// 商品描述</span>
    <span class="hljs-keyword">private</span> String specTemplate;<span class="hljs-comment">// 商品特殊规格的名称及可选值模板</span>
    <span class="hljs-keyword">private</span> String specifications;<span class="hljs-comment">// 商品的全局规格属性</span>
    <span class="hljs-keyword">private</span> String packingList;<span class="hljs-comment">// 包装清单</span>
    <span class="hljs-keyword">private</span> String afterService;<span class="hljs-comment">// 售后服务</span>
    <span class="hljs-comment">// 省略getter和setter</span>
&#125;</code></pre></div>

<h3 id="4-4-2-controller"><a href="#4-4-2-controller" class="headerlink" title="4.4.2.controller"></a>4.4.2.controller</h3><p>先分析：</p>
<ul>
<li><p>请求方式：GET</p>
</li>
<li><p>请求路径：/spu/page</p>
</li>
<li><p>请求参数：</p>
<ul>
<li>page：当前页</li>
<li>rows：每页大小</li>
<li>key：过滤条件</li>
<li>saleable：上架或下架</li>
</ul>
</li>
<li><p>返回结果：商品SPU的分页信息。</p>
<ul>
<li><p>要注意，页面展示的是商品分类和品牌名称，而数据库中保存的是id，怎么办？</p>
<p>我们可以新建一个类，继承SPU，并且拓展cname和bname属性，写到<code>ly-item-interface</code></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpuBo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Spu</span> </span>&#123;

    String cname;<span class="hljs-comment">// 商品分类名称</span>
    
    String bname;<span class="hljs-comment">// 品牌名称</span>
    
    <span class="hljs-comment">// 略 。。</span>
&#125;</code></pre></div>

</li>
</ul>
</li>
</ul>
<p>编写controller代码：</p>
<p>我们把与商品相关的一切业务接口都放到一起，起名为GoodsController，业务层也是这样</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GoodsController</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> GoodsService goodsService;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 分页查询SPU</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> rows</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> key</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/spu/page"</span>)
    <span class="hljs-keyword">public</span> ResponseEntity&lt;PageResult&lt;SpuBo&gt;&gt; querySpuByPage(
            <span class="hljs-meta">@RequestParam</span>(value = <span class="hljs-string">"page"</span>, defaultValue = <span class="hljs-string">"1"</span>) Integer page,
            <span class="hljs-meta">@RequestParam</span>(value = <span class="hljs-string">"rows"</span>, defaultValue = <span class="hljs-string">"5"</span>) Integer rows,
            <span class="hljs-meta">@RequestParam</span>(value = <span class="hljs-string">"key"</span>, required = <span class="hljs-keyword">false</span>) String key) &#123;
        <span class="hljs-comment">// 分页查询spu信息</span>
        PageResult&lt;SpuBo&gt; result = <span class="hljs-keyword">this</span>.goodsService.querySpuByPageAndSort(page, rows, key);
        <span class="hljs-keyword">if</span> (result == <span class="hljs-keyword">null</span> || result.getItems().size() == <span class="hljs-number">0</span>) &#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);
        &#125;
        <span class="hljs-keyword">return</span> ResponseEntity.ok(result);
    &#125;
&#125;</code></pre></div>



<h3 id="4-4-3-service"><a href="#4-4-3-service" class="headerlink" title="4.4.3.service"></a>4.4.3.service</h3><p>所有商品相关的业务（包括SPU和SKU）放到一个业务下：GoodsService。</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GoodsService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> SpuMapper spuMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CategoryService categoryService;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> BrandMapper brandMapper;

    <span class="hljs-function"><span class="hljs-keyword">public</span> PageResult&lt;SpuBo&gt; <span class="hljs-title">querySpuByPageAndSort</span><span class="hljs-params">(Integer page, Integer rows, Boolean saleable, String key)</span> </span>&#123;
        <span class="hljs-comment">// 1、查询SPU</span>
        <span class="hljs-comment">// 分页,最多允许查100条</span>
        PageHelper.startPage(page, Math.min(rows, <span class="hljs-number">100</span>));
        <span class="hljs-comment">// 创建查询条件</span>
        Example example = <span class="hljs-keyword">new</span> Example(Spu<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
        Example.Criteria criteria = example.createCriteria();
        <span class="hljs-comment">// 是否过滤上下架</span>
        <span class="hljs-keyword">if</span> (saleable != <span class="hljs-keyword">null</span>) &#123;
            criteria.orEqualTo(<span class="hljs-string">"saleable"</span>, saleable);
        &#125;
        <span class="hljs-comment">// 是否模糊查询</span>
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(key)) &#123;
            criteria.andLike(<span class="hljs-string">"title"</span>, <span class="hljs-string">"%"</span> + key + <span class="hljs-string">"%"</span>);
        &#125;
        Page&lt;Spu&gt; pageInfo = (Page&lt;Spu&gt;) <span class="hljs-keyword">this</span>.spuMapper.selectByExample(example);

        List&lt;SpuBo&gt; list = pageInfo.getResult().stream().map(spu -&gt; &#123;
            <span class="hljs-comment">// 2、把spu变为 spuBo</span>
            SpuBo spuBo = <span class="hljs-keyword">new</span> SpuBo();
            <span class="hljs-comment">// 属性拷贝</span>
            BeanUtils.copyProperties(spu, spuBo);

            <span class="hljs-comment">// 3、查询spu的商品分类名称,要查三级分类</span>
            List&lt;String&gt; names = <span class="hljs-keyword">this</span>.categoryService.queryNameByIds(
                    Arrays.asList(spu.getCid1(), spu.getCid2(), spu.getCid3()));
            <span class="hljs-comment">// 将分类名称拼接后存入</span>
            spuBo.setCname(StringUtils.join(names, <span class="hljs-string">"/"</span>));

            <span class="hljs-comment">// 4、查询spu的品牌名称</span>
            Brand brand = <span class="hljs-keyword">this</span>.brandMapper.selectByPrimaryKey(spu.getBrandId());
            spuBo.setBname(brand.getName());
            <span class="hljs-keyword">return</span> spuBo;
        &#125;).collect(Collectors.toList());

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PageResult&lt;&gt;(pageInfo.getTotal(), list);
    &#125;
&#125;</code></pre></div>



<h3 id="4-4-4-mapper"><a href="#4-4-4-mapper" class="headerlink" title="4.4.4.mapper"></a>4.4.4.mapper</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SpuMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Mapper</span>&lt;<span class="hljs-title">Spu</span>&gt; </span>&#123;
&#125;</code></pre></div>



<h3 id="4-4-5-Category中拓展查询名称的功能"><a href="#4-4-5-Category中拓展查询名称的功能" class="headerlink" title="4.4.5.Category中拓展查询名称的功能"></a>4.4.5.Category中拓展查询名称的功能</h3><p>页面需要商品的分类名称需要在这里查询，因此要额外提供查询分类名称的功能，</p>
<p>在CategoryService中添加功能：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title">queryNameByIds</span><span class="hljs-params">(List&lt;Long&gt; ids)</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.categoryMapper.selectByIdList(ids).stream().map(Category::getName).collect(Collectors.toList());
&#125;</code></pre></div>

<p>mapper的selectByIDList方法是来自于通用mapper。不过需要我们在mapper上继承一个通用mapper接口：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CategoryMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Mapper</span>&lt;<span class="hljs-title">Category</span>&gt;, <span class="hljs-title">SelectByIdListMapper</span>&lt;<span class="hljs-title">Category</span>, <span class="hljs-title">Long</span>&gt; </span>&#123; 
    <span class="hljs-comment">// ...coding</span>
&#125;</code></pre></div>

<h2 id="4-5-测试"><a href="#4-5-测试" class="headerlink" title="4.5.测试"></a>4.5.测试</h2><p>刷新页面，查看效果：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526280777975.png" srcset="/img/loading.gif" alt="1526280777975"></p>
<p>基本与预览的效果一致，OK！</p>
<h1 id="5-商品新增"><a href="#5-商品新增" class="headerlink" title="5.商品新增"></a>5.商品新增</h1><h2 id="5-1-效果预览"><a href="#5-1-效果预览" class="headerlink" title="5.1.效果预览"></a>5.1.效果预览</h2><p>新增商品窗口：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/../../%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/%E7%AC%94%E8%AE%B0/day08/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526268739827.png" srcset="/img/loading.gif" alt="1526268739827"></p>
<p>这个表单比较复杂，因为商品的信息比较多，分成了4个部分来填写：</p>
<ul>
<li>基本信息</li>
<li>商品描述信息</li>
<li>规格参数信息</li>
<li>SKU信息</li>
</ul>
<h2 id="5-2-从0开始"><a href="#5-2-从0开始" class="headerlink" title="5.2.从0开始"></a>5.2.从0开始</h2><p>我们刚刚在查询时，已经实现创建了MyGoodsForm.vue，并且已经在MyGoods中引入。</p>
<p>不过目前没有写代码：</p>
<div class="hljs"><pre><code class="hljs vue">&lt;template&gt;
  &lt;v-card&gt;
    my goods form
  &lt;&#x2F;v-card&gt;
&lt;&#x2F;template&gt;

&lt;script&gt;
  export default &#123;
    name: &quot;my-goods-form&quot;,
    props: &#123;
      oldGoods: &#123;
        type: Object
      &#125;,
      isEdit: &#123;
        type: Boolean,
        default: false
      &#125;
    &#125;,
    data() &#123;
      return &#123;

      &#125;
    &#125;,
    methods: &#123;
    &#125;
  &#125;
&lt;&#x2F;script&gt;

&lt;style scoped&gt;

&lt;&#x2F;style&gt;</code></pre></div>

<p>然后在MyBrand中，已经引入了MyGoodsForm组件，并且页面中也形成了对话框：</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// 导入自定义的表单组件</span>
<span class="hljs-keyword">import</span> MyGoodsForm <span class="hljs-keyword">from</span> <span class="hljs-string">'./MyGoodsForm'</span></code></pre></div>

<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">v-dialog</span> <span class="hljs-attr">max-width</span>=<span class="hljs-string">"500"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"show"</span> <span class="hljs-attr">persistent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-card</span>&gt;</span>
        <span class="hljs-comment">&lt;!--对话框的标题--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">v-toolbar</span> <span class="hljs-attr">dense</span> <span class="hljs-attr">dark</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">v-toolbar-title</span>&gt;</span>&#123;&#123;isEdit ? '修改' : '新增'&#125;&#125;商品<span class="hljs-tag">&lt;/<span class="hljs-name">v-toolbar-title</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">v-spacer</span>/&gt;</span>
            <span class="hljs-comment">&lt;!--关闭窗口的按钮--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">icon</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"closeWindow"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">v-icon</span>&gt;</span>close<span class="hljs-tag">&lt;/<span class="hljs-name">v-icon</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">v-toolbar</span>&gt;</span>
        <span class="hljs-comment">&lt;!--对话框的内容，表单--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">v-card-text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"px-5"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">my-goods-form</span> <span class="hljs-attr">:oldGoods</span>=<span class="hljs-string">"oldGoods"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">v-card-text</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-card</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-dialog</span>&gt;</span></code></pre></div>



<p>并且也已经给新增按钮绑定了点击事件：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"addGoods"</span>&gt;</span>新增商品<span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span></code></pre></div>

<p>addGoods方法中，设置对话框的show属性为true：</p>
<div class="hljs"><pre><code class="hljs js">addGoods() &#123;
    <span class="hljs-comment">// 修改标记</span>
    <span class="hljs-keyword">this</span>.isEdit = <span class="hljs-literal">false</span>;
    <span class="hljs-comment">// 控制弹窗可见：</span>
    <span class="hljs-keyword">this</span>.show = <span class="hljs-literal">true</span>;
    <span class="hljs-comment">// 把oldBrand变为null</span>
    <span class="hljs-keyword">this</span>.oldBrand = <span class="hljs-literal">null</span>;
&#125;</code></pre></div>



<p>不过弹窗中没有任何数据：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526281134046.png" srcset="/img/loading.gif" alt="1526281134046"></p>
<h2 id="5-3-新增商品页的基本框架"><a href="#5-3-新增商品页的基本框架" class="headerlink" title="5.3.新增商品页的基本框架"></a>5.3.新增商品页的基本框架</h2><h3 id="5-3-1-Steppers，步骤线"><a href="#5-3-1-Steppers，步骤线" class="headerlink" title="5.3.1.Steppers，步骤线"></a>5.3.1.Steppers，步骤线</h3><p>预览效果图中，分四个步骤显示商品表单的组件，叫做stepper，看下文档：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526281659782.png" srcset="/img/loading.gif" alt="1526281659782"></p>
<p>其基本结构如图：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526282309386.png" srcset="/img/loading.gif" alt="1526282309386"></p>
<p>一个步骤线（v-stepper）总的分为两部分：</p>
<ul>
<li>v-stepper-header：代表步骤的头部进度条，只能有一个<ul>
<li>v-stepper-step：代表进度条的每一个步骤，可以有多个</li>
</ul>
</li>
<li>v-stepper-items：代表当前步骤下的内容组，只能有一个，内部有stepper-content<ul>
<li>v-stepper-content：代表每一步骤的页面内容，可以有多个</li>
</ul>
</li>
</ul>
<blockquote>
<p>v-stepper</p>
</blockquote>
<ul>
<li>value：其值是当前所在的步骤索引，可以用来控制步骤切换</li>
<li>dark：是否使用黑暗色调，默认false</li>
<li>non-linear：是否启用非线性步骤，用户不用按顺序切换，而是可以调到任意步骤，默认false</li>
<li>vertical：是否垂直显示步骤线，默认是false，即水平显示</li>
</ul>
<blockquote>
<p>v-stepper-header的属性：</p>
</blockquote>
<ul>
<li>无</li>
</ul>
<blockquote>
<p>v-stepper-step的属性</p>
</blockquote>
<ul>
<li>color：颜色</li>
<li>complete：当前步骤是否已经完成，布尔值</li>
<li>editable：是否可编辑任意步骤（非线性步骤）</li>
<li>step：步骤索引</li>
</ul>
<blockquote>
<p>v-stepper-items</p>
</blockquote>
<ul>
<li>无</li>
</ul>
<blockquote>
<p>v-stepper-content</p>
</blockquote>
<ul>
<li>step：步骤索引，需要与v-stepper-step中的对应</li>
</ul>
<h3 id="5-3-2-编写页面"><a href="#5-3-2-编写页面" class="headerlink" title="5.3.2.编写页面"></a>5.3.2.编写页面</h3><p>首先我们在data中定义一个变量，记录当前的步骤数：</p>
<div class="hljs"><pre><code class="hljs js">data() &#123;
    <span class="hljs-keyword">return</span> &#123;
        step: <span class="hljs-number">1</span>, <span class="hljs-comment">// 当前的步骤数，默认为1</span>
    &#125;
&#125;,</code></pre></div>

<p>然后在模板页面中引入步骤线：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">v-stepper</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"step"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-header</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-step</span> <span class="hljs-attr">:complete</span>=<span class="hljs-string">"step &gt; 1"</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"1"</span>&gt;</span>基本信息<span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-step</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-divider</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-step</span> <span class="hljs-attr">:complete</span>=<span class="hljs-string">"step &gt; 2"</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"2"</span>&gt;</span>商品描述<span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-step</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-divider</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-step</span> <span class="hljs-attr">:complete</span>=<span class="hljs-string">"step &gt; 3"</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"3"</span>&gt;</span>规格参数<span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-step</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-divider</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-step</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"4"</span>&gt;</span>SKU属性<span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-step</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-header</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-items</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-content</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"1"</span>&gt;</span>
        基本信息
      <span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-content</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-content</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"2"</span>&gt;</span>
        商品描述
      <span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-content</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-content</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"3"</span>&gt;</span>
        规格参数
      <span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-content</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-content</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"4"</span>&gt;</span>
        SKU属性
      <span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-content</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-items</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper</span>&gt;</span></code></pre></div>

<p>效果：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526283729193.png" srcset="/img/loading.gif" alt="1526283729193"></p>
<p>步骤线出现了！</p>
<p>那么问题来了：该如何让这几个步骤切换呢？</p>
<h3 id="5-3-3-步骤切换按钮"><a href="#5-3-3-步骤切换按钮" class="headerlink" title="5.3.3.步骤切换按钮"></a>5.3.3.步骤切换按钮</h3><h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>如果改变step的值与指定的步骤索引一致，就可以实现步骤切换了：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526283971416.png" srcset="/img/loading.gif" alt="1526283971416"></p>
<p>因此，我们需要定义两个按钮，点击后修改step的值，让步骤前进或后退。</p>
<p>那么这两个按钮放哪里？</p>
<p>如果放在MyGoodsForm内，当表单内容过多时，按钮会被挤压到屏幕最下方，不够友好。最好是能够悬停状态。</p>
<p>所以，按钮必须放到MyGoods组件中，也就是父组件。</p>
<p>父组件的对话框是一个card，card组件提供了一个滚动效果，scrollable，如果为true，card的内容滚动时，其头部和底部是可以静止的。</p>
<p>现在card的头部是弹框的标题，card的中间就是表单内容。如果我们把按钮放到底部，就可以实现悬停效果。</p>
<h4 id="页面添加按钮"><a href="#页面添加按钮" class="headerlink" title="页面添加按钮"></a>页面添加按钮</h4><p>改造MyGoods的对话框组件：</p>
<p>  <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526285123845.png" srcset="/img/loading.gif" alt="1526285123845"></p>
<p>查看页面：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526285086042.png" srcset="/img/loading.gif" alt="1526285086042"></p>
<h4 id="添加点击事件"><a href="#添加点击事件" class="headerlink" title="添加点击事件"></a>添加点击事件</h4><p>现在这两个按钮点击后没有任何反应。我们需要给他们绑定点击事件，来修改MyGoodsForm中的step的值。</p>
<p>也就是说，父组件要修改子组件的属性状态。想到什么了？</p>
<p>props属性。</p>
<p>我们先在父组件定义一个step属性：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526285364638.png" srcset="/img/loading.gif" alt="1526285364638"></p>
<p>然后在点击事件中修改它：</p>
<div class="hljs"><pre><code class="hljs js">previous()&#123;
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.step &gt; <span class="hljs-number">1</span>)&#123;
        <span class="hljs-keyword">this</span>.step--
    &#125;
&#125;,
next()&#123;
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.step &lt; <span class="hljs-number">4</span>)&#123;
        <span class="hljs-keyword">this</span>.step++
    &#125;
&#125;</code></pre></div>

<p>页面绑定事件：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--底部按钮，用来操作步骤线--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-card-actions</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"elevation-10"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-flex</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"xs3 mx-auto"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"previous"</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"step === 1"</span>&gt;</span>上一步<span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"next"</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"step === 4"</span>&gt;</span>下一步<span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-flex</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-card-actions</span>&gt;</span></code></pre></div>

<p>然后把step属性传递给子组件：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--对话框的内容，表单--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-card-text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"px-3"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: 600px"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">my-goods-form</span> <span class="hljs-attr">:oldGoods</span>=<span class="hljs-string">"oldGoods"</span> <span class="hljs-attr">:step</span>=<span class="hljs-string">"step"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-card-text</span>&gt;</span></code></pre></div>

<p>子组件中接收属性：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526285994382.png" srcset="/img/loading.gif" alt="1526285994382"></p>
<p>测试效果：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/10.gif" srcset="/img/loading.gif" alt></p>
<h2 id="5-4-商品基本信息"><a href="#5-4-商品基本信息" class="headerlink" title="5.4.商品基本信息"></a>5.4.商品基本信息</h2><p>商品基本信息，主要是一些纯文本比较简单的SPU属性，例如：</p>
<p>商品分类、商品品牌、商品标题、商品卖点（子标题），包装清单，售后服务</p>
<p>接下来，我们一一添加这些表单项。</p>
<p>注：这里为了简化，我们就不进行form表单校验了。之前已经讲过。</p>
<h3 id="5-4-1-在data中定义Goods属性"><a href="#5-4-1-在data中定义Goods属性" class="headerlink" title="5.4.1.在data中定义Goods属性"></a>5.4.1.在data中定义Goods属性</h3><p>首先，我们需要定义一个goods对象，包括商品的上述属性。</p>
<div class="hljs"><pre><code class="hljs js">data() &#123;
    <span class="hljs-keyword">return</span> &#123;
        goods:&#123;
            categories:&#123;&#125;, <span class="hljs-comment">// 商品3级分类数组信息</span>
            brandId: <span class="hljs-number">0</span>,<span class="hljs-comment">// 品牌id信息</span>
            title: <span class="hljs-string">''</span>,<span class="hljs-comment">// 标题</span>
            subTitle: <span class="hljs-string">''</span>,<span class="hljs-comment">// 子标题</span>
            spuDetail: &#123;
                packingList: <span class="hljs-string">''</span>,<span class="hljs-comment">// 包装列表</span>
                afterService: <span class="hljs-string">''</span>,<span class="hljs-comment">// 售后服务</span>
            &#125;,
        &#125;
    &#125;</code></pre></div>

<p>注意，这里我们在goods中定义了spuDetail属性，然后把包装列表和售后服务作为它的属性，这样符合数据库的结构。</p>
<h3 id="5-4-2-商品分类选框"><a href="#5-4-2-商品分类选框" class="headerlink" title="5.4.2.商品分类选框"></a>5.4.2.商品分类选框</h3><p>商品分类选框之前我们已经做过了。是级联选框。直接拿来用：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">v-cascader</span></span>
<span class="hljs-tag">        <span class="hljs-attr">url</span>=<span class="hljs-string">"/item/category/list"</span></span>
<span class="hljs-tag">        <span class="hljs-attr">required</span></span>
<span class="hljs-tag">        <span class="hljs-attr">showAllLevels</span></span>
<span class="hljs-tag">        <span class="hljs-attr">v-model</span>=<span class="hljs-string">"goods.categories"</span></span>
<span class="hljs-tag">        <span class="hljs-attr">label</span>=<span class="hljs-string">"请选择商品分类"</span>/&gt;</span></code></pre></div>

<p>跟以前使用有一些区别：</p>
<ul>
<li>一个商品只能有一个分类，所以这里去掉了multiple属性</li>
<li>商品SPU中要保存3级商品分类，因此我们这里需要选择showAllLevels属性，显示所有3级分类</li>
</ul>
<p>效果：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526290196168.png" srcset="/img/loading.gif" alt="1526290196168"></p>
<p>查看goods的属性，三级类目都在：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526290263252.png" srcset="/img/loading.gif" alt="1526290263252"></p>
<h3 id="5-4-3-品牌选择"><a href="#5-4-3-品牌选择" class="headerlink" title="5.4.3.品牌选择"></a>5.4.3.品牌选择</h3><h4 id="select组件"><a href="#select组件" class="headerlink" title="select组件"></a>select组件</h4><p>品牌不分级别，使用普通下拉选框即可。我们查看官方文档的下拉选框说明：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526287929674.png" srcset="/img/loading.gif" alt="1526287929674"></p>
<p>组件名：v-select</p>
<p>比较重要的一些属性：</p>
<ul>
<li>item-text：选项中用来展示的字段名，默认是text</li>
<li>item-value：选项中用来作为value值的字段名，默认是value</li>
<li>items：待选项的对象数组</li>
<li>label：提示文本</li>
<li>multiple：是否支持多选，默认是false</li>
</ul>
<p>其它次要属性：</p>
<ul>
<li>autocomplete：是否根据用户输入的文本进行搜索过滤（自动），默认false</li>
<li>chips：是否以小纸片方式显示用户选中的项，默认false</li>
<li>clearable：是否添加清空选项图标，默认是false</li>
<li>color：颜色</li>
<li>dense：是否压缩选择框高度，默认false</li>
<li>editable：是否可编辑，默认false</li>
<li>hide-details：是否隐藏错误提示，默认false</li>
<li>hide-selected：是否在菜单中隐藏已选择的项</li>
<li>hint：提示文本</li>
<li>其它基本与<code>v-text-filed</code>组件类似，不再一一列举</li>
</ul>
<h4 id="页面实现"><a href="#页面实现" class="headerlink" title="页面实现"></a>页面实现</h4><p>备选项items需要我们去后台查询，而且必须是在用户选择商品分类后去查询。</p>
<p>我们定义一个属性，保存品牌的待选项信息：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526289926110.png" srcset="/img/loading.gif" alt="1526289926110"></p>
<p>然后编写一个watch，监控goods.categories的变化：</p>
<div class="hljs"><pre><code class="hljs js">watch: &#123;
    <span class="hljs-string">'goods.categories'</span>: &#123;
        deep: <span class="hljs-literal">true</span>,
            handler(val) &#123;
            <span class="hljs-comment">// 判断商品分类是否存在，存在才查询</span>
            <span class="hljs-keyword">if</span> (val &amp;&amp; val.length &gt; <span class="hljs-number">0</span>) &#123;
                <span class="hljs-comment">// 根据分类查询品牌</span>
                <span class="hljs-keyword">this</span>.$http.get(<span class="hljs-string">"/item/brand/cid/"</span> + <span class="hljs-keyword">this</span>.goods.categories[<span class="hljs-number">2</span>].id)
                    .then(<span class="hljs-function">(<span class="hljs-params">&#123;data&#125;</span>) =&gt;</span> &#123;
                    <span class="hljs-keyword">this</span>.brandOptions = data;
                &#125;)
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div>



<p>我们的品牌对象包含以下字段：id、name、letter、image。显然item-text应该对应name，item-value应该对应id</p>
<p>因此我们添加一个选框，指定item-text和item-value</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--品牌--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-select</span></span>
<span class="hljs-tag">      <span class="hljs-attr">:items</span>=<span class="hljs-string">"brandOptions"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">item-text</span>=<span class="hljs-string">"name"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">item-value</span>=<span class="hljs-string">"id"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">label</span>=<span class="hljs-string">"所属品牌"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">v-model</span>=<span class="hljs-string">"goods.brandId"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">required</span></span>
<span class="hljs-tag">      <span class="hljs-attr">autocomplete</span></span>
<span class="hljs-tag">      <span class="hljs-attr">clearable</span></span>
<span class="hljs-tag">      <span class="hljs-attr">dense</span> <span class="hljs-attr">chips</span></span>
<span class="hljs-tag">      /&gt;</span></code></pre></div>





<h4 id="后台提供接口"><a href="#后台提供接口" class="headerlink" title="后台提供接口"></a>后台提供接口</h4><p>页面需要去后台查询品牌信息，我们自然需要提供：</p>
<blockquote>
<p>controller</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">  * 根据分类查询品牌</span>
<span class="hljs-comment">  * <span class="hljs-doctag">@param</span> cid</span>
<span class="hljs-comment">  * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">  */</span>
<span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"cid/&#123;cid&#125;"</span>)
<span class="hljs-keyword">public</span> ResponseEntity&lt;List&lt;Brand&gt;&gt; queryBrandByCategory(<span class="hljs-meta">@PathVariable</span>(<span class="hljs-string">"cid"</span>) Long cid) &#123;
    List&lt;Brand&gt; list = <span class="hljs-keyword">this</span>.brandService.queryBrandByCategory(cid);
    <span class="hljs-keyword">if</span>(list == <span class="hljs-keyword">null</span>)&#123;
        <span class="hljs-keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.NOT_FOUND);
    &#125;
    <span class="hljs-keyword">return</span> ResponseEntity.ok(list);
&#125;</code></pre></div>

<blockquote>
<p>service</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Brand&gt; <span class="hljs-title">queryBrandByCategory</span><span class="hljs-params">(Long cid)</span> </span>&#123;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.brandMapper.queryByCategoryId(cid);
&#125;</code></pre></div>



<blockquote>
<p>mapper</p>
</blockquote>
<p>根据分类查询品牌有中间表，需要自己编写Sql：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Select</span>(<span class="hljs-string">"SELECT b.* FROM tb_brand b LEFT JOIN tb_category_brand cb ON b.id = cb.brand_id WHERE cb.category_id = #&#123;cid&#125;"</span>)
<span class="hljs-function">List&lt;Brand&gt; <span class="hljs-title">queryByCategoryId</span><span class="hljs-params">(Long cid)</span></span>;</code></pre></div>



<h4 id="测试效果"><a href="#测试效果" class="headerlink" title="测试效果"></a>测试效果</h4><p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526290461916.png" srcset="/img/loading.gif" alt="1526290461916"></p>
<h3 id="5-4-4-标题等其它字段"><a href="#5-4-4-标题等其它字段" class="headerlink" title="5.4.4.标题等其它字段"></a>5.4.4.标题等其它字段</h3><p>标题等字段都是普通文本，直接使用<code>v-text-field</code>即可：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">v-text-field</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"商品标题"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"goods.title"</span> <span class="hljs-attr">:counter</span>=<span class="hljs-string">"200"</span> <span class="hljs-attr">required</span> /&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-text-field</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"商品卖点"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"goods.subTitle"</span> <span class="hljs-attr">:counter</span>=<span class="hljs-string">"200"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-text-field</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"包装清单"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"goods.spuDetail.packingList"</span> <span class="hljs-attr">:counter</span>=<span class="hljs-string">"1000"</span> <span class="hljs-attr">multi-line</span> <span class="hljs-attr">:rows</span>=<span class="hljs-string">"3"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-text-field</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"售后服务"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"goods.spuDetail.afterService"</span> <span class="hljs-attr">:counter</span>=<span class="hljs-string">"1000"</span> <span class="hljs-attr">multi-line</span> <span class="hljs-attr">:rows</span>=<span class="hljs-string">"3"</span>/&gt;</span></code></pre></div>

<p>一些新的属性：</p>
<ul>
<li>counter：计数器，记录当前用户输入的文本字数</li>
<li>rows：文本域的行数</li>
<li>multi-line：把单行文本变成文本域</li>
</ul>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526290761721.png" srcset="/img/loading.gif" alt="1526290761721"></p>
<h2 id="5-5-商品描述信息"><a href="#5-5-商品描述信息" class="headerlink" title="5.5.商品描述信息"></a>5.5.商品描述信息</h2><p>商品描述信息比较复杂，而且图文并茂，甚至包括视频。</p>
<p>这样的内容，一般都会使用富文本编辑器。</p>
<h3 id="5-5-1-什么是富文本编辑器"><a href="#5-5-1-什么是富文本编辑器" class="headerlink" title="5.5.1.什么是富文本编辑器"></a>5.5.1.什么是富文本编辑器</h3><p>百度百科：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526290914491.png" srcset="/img/loading.gif" alt="1526290914491"></p>
<p>通俗来说：富文本，就是比较丰富的文本编辑器。普通的框只能输入文字，而富文本还能给文字加颜色样式等。</p>
<p>富文本编辑器有很多，例如：KindEditor、Ueditor。但并不原生支持vue</p>
<p>但是我们今天要说的，是一款支持Vue的富文本编辑器：<code>vue-quill-editor</code></p>
<h3 id="5-5-2-Vue-Quill-Editor"><a href="#5-5-2-Vue-Quill-Editor" class="headerlink" title="5.5.2.Vue-Quill-Editor"></a>5.5.2.Vue-Quill-Editor</h3><p>GitHub的主页：<a href="https://github.com/surmon-china/vue-quill-editor" target="_blank" rel="noopener">https://github.com/surmon-china/vue-quill-editor</a></p>
<p>Vue-Quill-Editor是一个基于Quill的富文本编辑器：<a href="https://quilljs.com/" target="_blank" rel="noopener">Quill的官网</a></p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526291232678.png" srcset="/img/loading.gif" alt="1526291232678"></p>
<h3 id="5-5-3-使用指南"><a href="#5-5-3-使用指南" class="headerlink" title="5.5.3.使用指南"></a>5.5.3.使用指南</h3><p>使用非常简单：</p>
<p>第一步：安装，使用npm命令：</p>
<div class="hljs"><pre><code class="hljs sql">npm <span class="hljs-keyword">install</span> vue-quill-editor <span class="hljs-comment">--save</span></code></pre></div>

<p>第二步：加载，在js中引入：</p>
<p>全局使用：</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Vue <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> VueQuillEditor <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-quill-editor'</span>

<span class="hljs-keyword">const</span> options = &#123;&#125;; <span class="hljs-comment">/* &#123; default global options &#125; */</span>

Vue.use(VueQuillEditor, options); <span class="hljs-comment">// options可选</span></code></pre></div>



<p>局部使用：</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-string">'quill/dist/quill.core.css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'quill/dist/quill.snow.css'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'quill/dist/quill.bubble.css'</span>

<span class="hljs-keyword">import</span> &#123;quillEditor&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-quill-editor'</span>

<span class="hljs-keyword">var</span> vm = <span class="hljs-keyword">new</span> Vue(&#123;
    components:&#123;
        quillEditor
    &#125;
&#125;)</code></pre></div>



<p>第三步：页面引用：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">quill-editor</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"goods.spuDetail.description"</span> <span class="hljs-attr">:options</span>=<span class="hljs-string">"editorOption"</span>/&gt;</span></code></pre></div>



<h3 id="5-5-4-自定义的富文本编辑器"><a href="#5-5-4-自定义的富文本编辑器" class="headerlink" title="5.5.4.自定义的富文本编辑器"></a>5.5.4.自定义的富文本编辑器</h3><p>不过这个组件有个小问题，就是图片上传的无法直接上传到后台，因此我们对其进行了封装，支持了图片的上传。</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526296083605.png" srcset="/img/loading.gif" alt="1526296083605.png"></p>
<p>使用也非常简单：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-content</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"2"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-editor</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"goods.spuDetail.description"</span> <span class="hljs-attr">upload-url</span>=<span class="hljs-string">"/upload/image"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-content</span>&gt;</span></code></pre></div>

<ul>
<li>upload-url：是图片上传的路径</li>
<li>v-model：双向绑定，将富文本编辑器的内容绑定到goods.spuDetail.description</li>
</ul>
<h3 id="5-5-5-效果："><a href="#5-5-5-效果：" class="headerlink" title="5.5.5.效果："></a>5.5.5.效果：</h3><p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526297276667.png" srcset="/img/loading.gif" alt="1526297276667"></p>
<h2 id="5-6-规格参数"><a href="#5-6-规格参数" class="headerlink" title="5.6.规格参数"></a>5.6.规格参数</h2><p>商品规格参数与商品分类绑定，因此我们需要在用户选择商品分类后，去后台查询对应的规格参数模板。</p>
<h3 id="5-6-1-查询商品规格"><a href="#5-6-1-查询商品规格" class="headerlink" title="5.6.1.查询商品规格"></a>5.6.1.查询商品规格</h3><p>首先，我们在data中定义变量，记录查询到的规格参数模板：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526297766476.png" srcset="/img/loading.gif" alt="1526297766476"></p>
<p>然后，我们通过watch监控goods.categories的变化，然后去查询规格：</p>
<p>  <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526375545366.png" srcset="/img/loading.gif" alt="1526375545366"></p>
<p>查看是否查询到：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526297980403.png" srcset="/img/loading.gif" alt="1526297980403"></p>
<h3 id="5-6-2-页面展示规格属性"><a href="#5-6-2-页面展示规格属性" class="headerlink" title="5.6.2.页面展示规格属性"></a>5.6.2.页面展示规格属性</h3><p>获取到了规格参数，还需要把它展示到页面中。</p>
<p>现在查询到的规格参数只有key，并没有值。值需要用户来根据SPU信息填写，因此规格参数最终需要处理为表单。</p>
<blockquote>
<p>整体结构</p>
</blockquote>
<p>整体来看，规格参数是数组，每个元素是一组规格的集合。我们需要分组来展示。比如每组放到一个card中。</p>
<blockquote>
<p>注意事项：</p>
</blockquote>
<p>规格参数中的属性有一些需要我们特殊处理：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526298277201.png" srcset="/img/loading.gif" alt="1526298277201"></p>
<ul>
<li>global：是否是全局属性，规格参数中一部分是SPU共享，属于全局属性，另一部是SKU特有，需要根据SKU来填写。因此，在当前版面中，只展示global为true的，即全局属性。sku特有属性放到最后一个面板</li>
<li>numerical：是否是数值类型，如果是，把单位补充在页面表单，不允许用户填写，并且要验证用户输入的数据格式</li>
<li>options：是否有可选项，如果有，则使用下拉选框来渲染。</li>
</ul>
<p>页面代码：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--3、规格参数--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-content</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"3"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-flex</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"xs10 mx-auto px-3"</span>&gt;</span>
        <span class="hljs-comment">&lt;!--遍历整个规格参数，获取每一组--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">v-card</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"spec in specifications"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"spec.group"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"my-2"</span>&gt;</span>
            <span class="hljs-comment">&lt;!--组名称--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">v-card-title</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"subheading"</span>&gt;</span>&#123;&#123;spec.group&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">v-card-title</span>&gt;</span>
            <span class="hljs-comment">&lt;!--遍历组中的每个属性，并判断是否是全局属性，不是则不显示--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">v-card-text</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"param in spec.params"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"param.k"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"param.global"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"px-5"</span>&gt;</span>
                <span class="hljs-comment">&lt;!--判断是否有可选项，如果没有，则显示文本框。还要判断是否是数值类型，如果是把unit显示到后缀--&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">v-text-field</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"param.options.length &lt;= 0"</span> </span>
<span class="hljs-tag">                              <span class="hljs-attr">:label</span>=<span class="hljs-string">"param.k"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"param.v"</span> <span class="hljs-attr">:suffix</span>=<span class="hljs-string">"param.unit || ''"</span>/&gt;</span>
                <span class="hljs-comment">&lt;!--否则，显示下拉选项--&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">v-select</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"param.k"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"param.v"</span> <span class="hljs-attr">:items</span>=<span class="hljs-string">"param.options"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">v-card-text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">v-card</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-flex</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-content</span>&gt;</span></code></pre></div>



<p>效果：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526302470344.png" srcset="/img/loading.gif" alt="1526302470344"></p>
<h2 id="5-7-SKU特有属性"><a href="#5-7-SKU特有属性" class="headerlink" title="5.7.SKU特有属性"></a>5.7.SKU特有属性</h2><p>sku特有属性也存在与specifications中，但是我们现在只想展示特有属性，而不是从头遍历一次。因此，我们应该从specifications中把特有规格属性拆分出来独立保存。</p>
<h3 id="5-7-1-筛选特有规格参数"><a href="#5-7-1-筛选特有规格参数" class="headerlink" title="5.7.1.筛选特有规格参数"></a>5.7.1.筛选特有规格参数</h3><p>首先：我们在data中新建一个属性，保存特有的规格参数：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526306568822.png" srcset="/img/loading.gif" alt="1526306568822"></p>
<p>然后，在查询完成规格模板后，立刻对规格参数进行处理，筛选出特有规格参数，保存到specialSpecs中：</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// 根据分类查询规格参数</span>
<span class="hljs-keyword">this</span>.$http.get(<span class="hljs-string">"/item/spec/"</span> + <span class="hljs-keyword">this</span>.goods.categories[<span class="hljs-number">2</span>].id)
    .then(<span class="hljs-function">(<span class="hljs-params">&#123;data&#125;</span>) =&gt;</span> &#123;
        <span class="hljs-comment">// 保存全部规格</span>
        <span class="hljs-keyword">this</span>.specifications = data;
        <span class="hljs-comment">// 对特有规格进行筛选</span>
        <span class="hljs-keyword">const</span> temp = [];
        data.forEach(<span class="hljs-function">(<span class="hljs-params">&#123;params&#125;</span>) =&gt;</span> &#123;
            params.forEach(<span class="hljs-function">(<span class="hljs-params">&#123;k, options, global&#125;</span>) =&gt;</span> &#123;
                <span class="hljs-keyword">if</span> (!global) &#123;
                    temp.push(&#123;
                        k, options,<span class="hljs-attr">selected</span>:[]
                    &#125;)
                &#125;
            &#125;)
        &#125;)
        <span class="hljs-keyword">this</span>.specialSpecs = temp;
	&#125;)</code></pre></div>

<p>要注意：我们添加了一个selected属性，用于保存用户填写的信息</p>
<p>查看数据：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526306826026.png" srcset="/img/loading.gif" alt="1526306826026"></p>
<h3 id="5-7-2-页面渲染SKU属性"><a href="#5-7-2-页面渲染SKU属性" class="headerlink" title="5.7.2.页面渲染SKU属性"></a>5.7.2.页面渲染SKU属性</h3><p>接下来，我们把筛选出的特有规格参数，渲染到SKU页面：</p>
<p>我们的目标效果是这样的：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526307835157.png" srcset="/img/loading.gif" alt="1526307835157"></p>
<p>可以看到，</p>
<ul>
<li>每一个特有属性自成一组，都包含标题和选项。我们可以使用card达到这个效果。</li>
<li>无options选项的特有属性，展示一个文本框，有options选项的，展示多个checkbox，让用户选择</li>
</ul>
<p>页面代码实现：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--4、SKU属性--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-stepper-content</span> <span class="hljs-attr">step</span>=<span class="hljs-string">"4"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-flex</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mx-auto"</span>&gt;</span>
        <span class="hljs-comment">&lt;!--遍历特有规格参数--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">v-card</span> <span class="hljs-attr">flat</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"spec in specialSpecs"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"spec.k"</span>&gt;</span>
            <span class="hljs-comment">&lt;!--特有参数的标题--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">v-card-title</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"subheading"</span>&gt;</span>&#123;&#123;spec.k&#125;&#125;:<span class="hljs-tag">&lt;/<span class="hljs-name">v-card-title</span>&gt;</span>
            <span class="hljs-comment">&lt;!--特有参数的待选项，需要判断是否有options，如果没有，展示文本框，让用户自己输入--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">v-card-text</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"spec.options.length &lt;= 0"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"px-5"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">v-text-field</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"'输入新的' + spec.k"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"spec.selected"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">v-card-text</span>&gt;</span>
            <span class="hljs-comment">&lt;!--如果有options，需要展示成多个checkbox--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">v-card-text</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container fluid grid-list-xs"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">v-layout</span> <span class="hljs-attr">row</span> <span class="hljs-attr">wrap</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"px-5"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-name">v-checkbox</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"o in spec.options"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"o"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex xs3"</span></span>
<span class="hljs-tag">                                <span class="hljs-attr">:label</span>=<span class="hljs-string">"o"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"spec.selected"</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"o"</span>/&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-name">v-layout</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">v-card-text</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">v-card</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-flex</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-stepper-content</span>&gt;</span></code></pre></div>

<p>我们的实现效果：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526308151513.png" srcset="/img/loading.gif" alt="1526308151513"></p>
<p>测试下，勾选checkbox或填写文本会发生什么：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526308483766.png" srcset="/img/loading.gif" alt="1526308483766"></p>
<p>看下规格模板的值：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526308513342.png" srcset="/img/loading.gif" alt="1526308513342"></p>
<h3 id="5-7-3-自由添加或删除文本框"><a href="#5-7-3-自由添加或删除文本框" class="headerlink" title="5.7.3.自由添加或删除文本框"></a>5.7.3.自由添加或删除文本框</h3><p>刚才的实现中，普通文本项只有一个，如果用户想添加更多值就不行。我们需要让用户能够自由添加新的文本框，而且还能删除。</p>
<p>这里有个取巧的方法：</p>
<p>还记得我们初始化 特有规格参数时，新增了一个selected属性吗，用来保存用户填写的值，是一个数组。每当用户新加一个值，该数组的长度就会加1，而初始长度为0</p>
<p>另外，v-for指令有个特殊之处，就在于它可以遍历数字。比如 v-for=”i in 10”，你会得到1~10</p>
<p>因此，我们可以遍历selected的长度，每当我们输入1个文本，selected长度会加1，自然会多出一个文本框。</p>
<p>代码如下：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526309463115.png" srcset="/img/loading.gif" alt="1526309463115"></p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">v-card</span> <span class="hljs-attr">flat</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"spec in specialSpecs"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"spec.k"</span>&gt;</span>
    <span class="hljs-comment">&lt;!--特有参数的标题--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-card-title</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"subheading"</span>&gt;</span>&#123;&#123;spec.k&#125;&#125;:<span class="hljs-tag">&lt;/<span class="hljs-name">v-card-title</span>&gt;</span>
    <span class="hljs-comment">&lt;!--特有参数的待选项，需要判断是否有options，如果没有，展示文本框，让用户自己输入--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-card-text</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"spec.options.length &lt;= 0"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"px-5"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"i in spec.selected.length+1"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"i"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">v-text-field</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"'输入新的' + spec.k"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"spec.selected[i-1]"</span> <span class="hljs-attr">v-bind:value</span>=<span class="hljs-string">"i"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-card-text</span>&gt;</span>
    <span class="hljs-comment">&lt;!--如果有options，需要展示成多个checkbox--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-card-text</span> <span class="hljs-attr">v-else</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container fluid grid-list-xs"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">v-layout</span> <span class="hljs-attr">row</span> <span class="hljs-attr">wrap</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"px-5"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">v-checkbox</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"o in spec.options"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"o"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"flex xs3"</span></span>
<span class="hljs-tag">                        <span class="hljs-attr">:label</span>=<span class="hljs-string">"o"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"spec.selected"</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"o"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">v-layout</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-card-text</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-card</span>&gt;</span></code></pre></div>

<p>效果：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/11.gif" srcset="/img/loading.gif" alt></p>
<p>而删除文本框相对就比较简单了，只要在文本框末尾添加一个按钮，添加点击事件即可，代码：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526310720065.png" srcset="/img/loading.gif" alt="1526310720065"></p>
<p>添加了一些布局样式，以及一个按钮，在点击事件中删除一个值。</p>
<h2 id="5-8-展示SKU列表"><a href="#5-8-展示SKU列表" class="headerlink" title="5.8.展示SKU列表"></a>5.8.展示SKU列表</h2><h3 id="5-8-1-效果预览"><a href="#5-8-1-效果预览" class="headerlink" title="5.8.1.效果预览"></a>5.8.1.效果预览</h3><p>当我们选定SKU的特有属性时，就会对应出不同排列组合的SKU。</p>
<p>举例：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526311110498.png" srcset="/img/loading.gif" alt="1526311110498"></p>
<p>当你选择了上图中的这些选项时：</p>
<ul>
<li>颜色共2种：土豪金，绚丽红</li>
<li>内存共2种：2GB，4GB</li>
<li>机身存储1种：64GB</li>
</ul>
<p>此时会产生多少种SKU呢？ 应该是 2 * 2 * 1 = 4种。</p>
<p>因此，接下来应该由用户来对这4种sku的信息进行详细填写，比如库存和价格等。而多种sku的最佳展示方式，是表格（淘宝、京东都是这么做的），如图：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526311330409.png" srcset="/img/loading.gif" alt="1526311330409"></p>
<p>而且这个表格应该随着用户选择的不同而动态变化。如何实现？</p>
<h3 id="5-8-2-算法：求数组笛卡尔积"><a href="#5-8-2-算法：求数组笛卡尔积" class="headerlink" title="5.8.2.算法：求数组笛卡尔积"></a>5.8.2.算法：求数组笛卡尔积</h3><p>大家看这个结果就能发现，这其实是在求多个数组的笛卡尔积。作为一个程序员，这应该是基本功了吧。</p>
<blockquote>
<p>两个数组笛卡尔积</p>
</blockquote>
<p>假如有两个数组，求笛卡尔积，其基本思路是这样的：</p>
<ul>
<li>在遍历一个数组的同时，遍历另一个数组，然后把元素拼接，放到新数组。</li>
</ul>
<p>示例1：</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">const</span> arr1 = [<span class="hljs-string">'1'</span>,<span class="hljs-string">'2'</span>,<span class="hljs-string">'3'</span>];
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-string">'a'</span>,<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>];

<span class="hljs-keyword">const</span> result = [];

arr1.forEach(<span class="hljs-function"><span class="hljs-params">e1</span> =&gt;</span> &#123;
    arr2.forEach(<span class="hljs-function"><span class="hljs-params">e2</span> =&gt;</span> &#123;
        result.push(e1 + <span class="hljs-string">"_"</span> + e2)
    &#125;)
&#125;)

<span class="hljs-built_in">console</span>.log(result);</code></pre></div>

<p>结果：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526354069684.png" srcset="/img/loading.gif" alt="1526354069684"></p>
<p>完美实现。</p>
<blockquote>
<p>N个数组的笛卡尔积</p>
</blockquote>
<p>如果是N个数组怎么办？</p>
<p>不确定数组数量，代码没有办法写死。该如何处理？</p>
<p>思路：</p>
<ul>
<li>先拿其中两个数组求笛卡尔积</li>
<li>然后把前面运算的结果作为新数组，与第三个数组求笛卡尔积</li>
</ul>
<p>把前两次运算的结果作为第三次运算的参数。大家想到什么了？</p>
<p>没错，之前讲过的一个数组功能：Reduce</p>
<p>reduce函数的声明：</p>
<div class="hljs"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">reduce</span><span class="hljs-params">(callback,initvalue)</span></span></code></pre></div>

<p>callback：是一个回调函数。这个callback可以接收2个参数：arg1,arg2</p>
<ul>
<li>arg1代表的上次运算得到的结果</li>
<li>arg2是数组中正要处理的元素</li>
</ul>
<p>initvalue，初始化值。第一次调用callback时把initvalue作为第一个参数，把数组的第一个元素作为第二个参数运算。如果未指定，则第一次运算会把数组的前两个元素作为参数。</p>
<p>reduce会把数组中的元素逐个用这个函数处理，然后把结果作为下一次回调函数的第一个参数，数组下个元素作为第二个参数，以此类推。</p>
<p>因此，我们可以把想要求笛卡尔积的多个数组先放到一个大数组中。形成二维数组。然后再来运算：</p>
<p>示例2：</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">const</span> arr1 = [<span class="hljs-string">'1'</span>, <span class="hljs-string">'2'</span>, <span class="hljs-string">'3'</span>];
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>];
<span class="hljs-comment">// 用来作为运算的二维数组</span>
<span class="hljs-keyword">const</span> arr3 = [arr1, arr2, [<span class="hljs-string">'x'</span>, <span class="hljs-string">'y'</span>]]

<span class="hljs-keyword">const</span> result = arr3.reduce(<span class="hljs-function">(<span class="hljs-params">last, el</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">const</span> arr = [];
    <span class="hljs-comment">// last：上次运算结果</span>
    <span class="hljs-comment">// el：数组中的当前元素</span>
    last.forEach(<span class="hljs-function"><span class="hljs-params">e1</span> =&gt;</span> &#123;
        el.forEach(<span class="hljs-function"><span class="hljs-params">e2</span> =&gt;</span> &#123;
            arr.push(e1 + <span class="hljs-string">"_"</span> + e2)
        &#125;)
    &#125;)
    <span class="hljs-keyword">return</span> arr
&#125;);

<span class="hljs-built_in">console</span>.log(result);</code></pre></div>

<p>结果：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526355132141.png" srcset="/img/loading.gif" alt="1526355132141"></p>
<h3 id="5-8-3-算法结合业务"><a href="#5-8-3-算法结合业务" class="headerlink" title="5.8.3.算法结合业务"></a>5.8.3.算法结合业务</h3><p>来看我们的业务逻辑：</p>
<p>首先，我们已经有了一个特有参数的规格模板：</p>
<div class="hljs"><pre><code class="hljs js">[
  &#123;
    <span class="hljs-string">"k"</span>: <span class="hljs-string">"机身颜色"</span>,
    <span class="hljs-string">"selected"</span>: [<span class="hljs-string">"红色"</span>,<span class="hljs-string">"黑色"</span>]
  &#125;,
  &#123;
    <span class="hljs-string">"k"</span>: <span class="hljs-string">"内存"</span>,
    <span class="hljs-string">"selected"</span>: [<span class="hljs-string">"8GB"</span>,<span class="hljs-string">"6GB"</span>]
  &#125;,
  &#123;
    <span class="hljs-string">"k"</span>: <span class="hljs-string">"机身存储"</span>,
    <span class="hljs-string">"selected"</span>: [<span class="hljs-string">"64GB"</span>,<span class="hljs-string">"256GB"</span>]
  &#125;
]</code></pre></div>

<p>可以看做是一个二维数组。</p>
<p>一维是参数对象。</p>
<p>二维是参数中的selected选项。</p>
<p>我们想要的结果：</p>
<div class="hljs"><pre><code class="hljs js">[
    &#123;<span class="hljs-string">"机身颜色"</span>:<span class="hljs-string">"红色"</span>,<span class="hljs-string">"内存"</span>:<span class="hljs-string">"6GB"</span>,<span class="hljs-string">"机身存储"</span>:<span class="hljs-string">"64GB"</span>&#125;,
    &#123;<span class="hljs-string">"机身颜色"</span>:<span class="hljs-string">"红色"</span>,<span class="hljs-string">"内存"</span>:<span class="hljs-string">"6GB"</span>,<span class="hljs-string">"机身存储"</span>:<span class="hljs-string">"256GB"</span>&#125;,
    &#123;<span class="hljs-string">"机身颜色"</span>:<span class="hljs-string">"红色"</span>,<span class="hljs-string">"内存"</span>:<span class="hljs-string">"8GB"</span>,<span class="hljs-string">"机身存储"</span>:<span class="hljs-string">"64GB"</span>&#125;,
    &#123;<span class="hljs-string">"机身颜色"</span>:<span class="hljs-string">"红色"</span>,<span class="hljs-string">"内存"</span>:<span class="hljs-string">"8GB"</span>,<span class="hljs-string">"机身存储"</span>:<span class="hljs-string">"256GB"</span>&#125;,
    &#123;<span class="hljs-string">"机身颜色"</span>:<span class="hljs-string">"黑色"</span>,<span class="hljs-string">"内存"</span>:<span class="hljs-string">"6GB"</span>,<span class="hljs-string">"机身存储"</span>:<span class="hljs-string">"64GB"</span>&#125;,
    &#123;<span class="hljs-string">"机身颜色"</span>:<span class="hljs-string">"黑色"</span>,<span class="hljs-string">"内存"</span>:<span class="hljs-string">"6GB"</span>,<span class="hljs-string">"机身存储"</span>:<span class="hljs-string">"256GB"</span>&#125;,
    &#123;<span class="hljs-string">"机身颜色"</span>:<span class="hljs-string">"黑色"</span>,<span class="hljs-string">"内存"</span>:<span class="hljs-string">"8GB"</span>,<span class="hljs-string">"机身存储"</span>:<span class="hljs-string">"64GB"</span>&#125;,
    &#123;<span class="hljs-string">"机身颜色"</span>:<span class="hljs-string">"黑色"</span>,<span class="hljs-string">"内存"</span>:<span class="hljs-string">"8GB"</span>,<span class="hljs-string">"机身存储"</span>:<span class="hljs-string">"256GB"</span>&#125;,
]</code></pre></div>

<p>思路是这样：</p>
<ul>
<li>我们的启点是一个空的对象数组：<code>[{}]</code>，</li>
<li>然后先与第一个规格求笛卡尔积</li>
<li>然后再把结果与下一个规格求笛卡尔积，依次类推</li>
</ul>
<p>如果：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/skus.png" srcset="/img/loading.gif" alt="skus."></p>
<p>代码：</p>
<p>我们在Vue中新增一个计算属性，按照上面所讲的逻辑，计算所有规格参数的笛卡尔积</p>
<div class="hljs"><pre><code class="hljs js">computed: &#123;
    skus() &#123;
        <span class="hljs-comment">// 过滤掉用户没有填写数据的规格参数</span>
        <span class="hljs-keyword">const</span> arr = <span class="hljs-keyword">this</span>.specialSpecs.filter(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.selected.length &gt; <span class="hljs-number">0</span>);
        <span class="hljs-comment">// 通过reduce进行累加笛卡尔积</span>
        <span class="hljs-keyword">return</span> arr.reduce(<span class="hljs-function">(<span class="hljs-params">last, spec</span>) =&gt;</span> &#123;
            <span class="hljs-keyword">const</span> result = [];
            last.forEach(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> &#123;
                spec.selected.forEach(<span class="hljs-function"><span class="hljs-params">option</span> =&gt;</span> &#123;
                    <span class="hljs-keyword">const</span> obj = &#123;&#125;;
                    <span class="hljs-built_in">Object</span>.assign(obj, o);
                    obj[spec.k] = option;
                    result.push(obj);
                &#125;)
            &#125;)
            <span class="hljs-keyword">return</span> result
        &#125;, [&#123;&#125;])
    &#125;
&#125;</code></pre></div>



<p>结果：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526356312119.png" srcset="/img/loading.gif" alt="1526356312119"></p>
<p>优化：这里生成的是SKU的数组。因此只包含SKU的规格参数是不够的。结合数据库知道，还需要有下面的字段：</p>
<ul>
<li>price：价格</li>
<li>stock：库存</li>
<li>enable：是否启用。虽然笛卡尔积对应了9个SKU，但用户不一定会需要所有的组合，用这个字段进行标记。</li>
<li>images：商品的图片</li>
<li>indexes：特有属性的索引拼接得到的字符串</li>
</ul>
<p>我们需要给生成的每个sku对象添加上述字段，代码修改如下：</p>
<div class="hljs"><pre><code class="hljs js">computed:&#123;
    skus()&#123;
        <span class="hljs-comment">// 过滤掉用户没有填写数据的规格参数</span>
        <span class="hljs-keyword">const</span> arr = <span class="hljs-keyword">this</span>.specialSpecs.filter(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.selected.length &gt; <span class="hljs-number">0</span>);
        <span class="hljs-comment">// 通过reduce进行累加笛卡尔积</span>
        <span class="hljs-keyword">return</span>  arr.reduce(<span class="hljs-function">(<span class="hljs-params">last, spec, index</span>) =&gt;</span> &#123;
            <span class="hljs-keyword">const</span> result = [];
            last.forEach(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> &#123;
                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; spec.selected.length; i++)&#123;
                    <span class="hljs-keyword">const</span> option = spec.selected[i];
                    <span class="hljs-keyword">const</span> obj = &#123;&#125;;
                    <span class="hljs-built_in">Object</span>.assign(obj, o);
                    obj[spec.k] = option;
                    <span class="hljs-comment">// 拼接当前这个特有属性的索引</span>
                    obj.indexes = (o.indexes||<span class="hljs-string">''</span>) + <span class="hljs-string">'_'</span>+ i
                    <span class="hljs-keyword">if</span>(index === arr.length - <span class="hljs-number">1</span>)&#123;
                        <span class="hljs-comment">// 如果发现是最后一组，则添加价格、库存等字段</span>
                        <span class="hljs-built_in">Object</span>.assign(obj, &#123; <span class="hljs-attr">price</span>:<span class="hljs-number">0</span>, <span class="hljs-attr">stock</span>:<span class="hljs-number">0</span>,<span class="hljs-attr">enable</span>:<span class="hljs-literal">false</span>, <span class="hljs-attr">images</span>:[]&#125;)
                        <span class="hljs-comment">// 去掉索引字符串开头的下划线</span>
                        obj.indexes = obj.indexes.substring(<span class="hljs-number">1</span>);
                    &#125;
                    result.push(obj);
                &#125;
            &#125;)
            <span class="hljs-keyword">return</span> result
        &#125;,[&#123;&#125;])
    &#125;
&#125;</code></pre></div>



<p>查看生成的数据：</p>
<p> <img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526363824808.png" srcset="/img/loading.gif" alt="1526363824808"></p>
<h3 id="5-8-4-页面展现"><a href="#5-8-4-页面展现" class="headerlink" title="5.8.4.页面展现"></a>5.8.4.页面展现</h3><p>页面展现是一个表格。我们之前已经用过。表格需要以下信息：</p>
<ul>
<li>items：表格内的数据</li>
<li>headers：表头信息</li>
</ul>
<p>刚才我们的计算属性skus得到的就是表格数据了。我们还差头：headers</p>
<p>头部信息也是动态的，用户选择了一个属性，就会多出一个表头。与skus是关联的。</p>
<p>既然如此，我们再次编写一个计算属性，来计算得出header数组：</p>
<div class="hljs"><pre><code class="hljs js">headers()&#123;
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.skus.length &lt;= <span class="hljs-number">0</span>)&#123;
        <span class="hljs-keyword">return</span> []
    &#125;
    <span class="hljs-keyword">const</span> headers = [];
    <span class="hljs-comment">// 获取skus中的任意一个，获取key，然后遍历其属性</span>
    <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.skus[<span class="hljs-number">0</span>]).forEach(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> &#123;
        <span class="hljs-keyword">let</span> value = k;
        <span class="hljs-keyword">if</span>(k === <span class="hljs-string">'price'</span>)&#123;
            <span class="hljs-comment">// enable，表头要翻译成“价格”</span>
            k = <span class="hljs-string">'价格'</span>
        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(k === <span class="hljs-string">'stock'</span>)&#123;
            <span class="hljs-comment">// enable，表头要翻译成“库存”</span>
            k = <span class="hljs-string">'库存'</span>;
        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(k === <span class="hljs-string">'enable'</span>)&#123;
            <span class="hljs-comment">// enable，表头要翻译成“是否启用”</span>
            k = <span class="hljs-string">'是否启用'</span>
        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(k === <span class="hljs-string">'indexes'</span> || k === <span class="hljs-string">'images'</span>)&#123;
            <span class="hljs-comment">// 图片和索引不在表格中展示</span>
            <span class="hljs-keyword">return</span>;
        &#125;
        headers.push(&#123;
            text: k,
            align: <span class="hljs-string">'center'</span>,
            sortable: <span class="hljs-literal">false</span>,
            value
        &#125;)
    &#125;)
    <span class="hljs-keyword">return</span> headers;
&#125;</code></pre></div>



<p>接下来编写页面，实现table。</p>
<p>需要注意的是，price、stock字段需要用户填写数值，不能直接展示。enable要展示为checkbox，让用户选择，如图：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526364758744.png" srcset="/img/loading.gif" alt="1526364758744"></p>
<p>代码：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">v-card</span>&gt;</span>
    <span class="hljs-comment">&lt;!--标题--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-card-title</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"subheading"</span>&gt;</span>SKU列表<span class="hljs-tag">&lt;/<span class="hljs-name">v-card-title</span>&gt;</span>
    <span class="hljs-comment">&lt;!--SKU表格，hide-actions因此分页等工具条--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-data-table</span> <span class="hljs-attr">:items</span>=<span class="hljs-string">"skus"</span> <span class="hljs-attr">:headers</span>=<span class="hljs-string">"headers"</span> <span class="hljs-attr">hide-actions</span> <span class="hljs-attr">item-key</span>=<span class="hljs-string">"indexes"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"items"</span> <span class="hljs-attr">slot-scope</span>=<span class="hljs-string">"props"</span>&gt;</span>
            <span class="hljs-comment">&lt;!--价格和库存展示为文本框--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(v,k) in props.item"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"k"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"['price', 'stock'].includes(k)"</span></span>
<span class="hljs-tag">                <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xs-center"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">v-text-field</span> <span class="hljs-attr">single-line</span> <span class="hljs-attr">v-model.number</span>=<span class="hljs-string">"props.item[k]"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-comment">&lt;!--enable展示为checkbox--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xs-center"</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"k === 'enable'"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">v-checkbox</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"props.item[k]"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-comment">&lt;!--indexes和images不展示，其它展示为普通文本--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xs-center"</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"!['indexes','images'].includes(k)"</span>&gt;</span>&#123;&#123;v&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">v-data-table</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-card</span>&gt;</span></code></pre></div>







<p>效果：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526365039421.png" srcset="/img/loading.gif" alt="1526365039421"></p>
<h3 id="5-8-5-图片上传列表"><a href="#5-8-5-图片上传列表" class="headerlink" title="5.8.5.图片上传列表"></a>5.8.5.图片上传列表</h3><p>这个表格中只展示了基本信息，当用户需要上传图片时，该怎么做呢？</p>
<p>Vuetify的table有一个展开功能，可以提供额外的展示空间：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526366340741.png" srcset="/img/loading.gif" alt="1526366340741"></p>
<p>用法也非常简单，添加一个template，把其slot属性指定为expand即可：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526366667064.png" srcset="/img/loading.gif" alt="1526366667064"></p>
<p>效果：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526366997943.png" srcset="/img/loading.gif" alt="1526366997943"></p>
<p>接下来就是我们的图片上传组件：v-upload</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526367719809.png" srcset="/img/loading.gif" alt="1526367719809"></p>
<h2 id="5-9-表单提交"><a href="#5-9-表单提交" class="headerlink" title="5.9.表单提交"></a>5.9.表单提交</h2><h3 id="5-9-1-添加提交按钮"><a href="#5-9-1-添加提交按钮" class="headerlink" title="5.9.1.添加提交按钮"></a>5.9.1.添加提交按钮</h3><p>我们在step=4，也就是SKU属性列表页面， 添加一个提交按钮。</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--提交按钮--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-flex</span> <span class="hljs-attr">xs3</span> <span class="hljs-attr">offset-xs9</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"info"</span>&gt;</span>保存商品信息<span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-flex</span>&gt;</span></code></pre></div>

<p>效果：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526366187195.png" srcset="/img/loading.gif" alt="1526366187195"></p>
<h3 id="5-9-2点击事件"><a href="#5-9-2点击事件" class="headerlink" title="5.9.2点击事件"></a>5.9.2点击事件</h3><p>当用户点击保存，我们就需要对页面的数据进行整理，然后提交到后台服务。</p>
<p>现在我们页面包含了哪些信息呢？我们与数据库对比，看看少什么</p>
<ul>
<li>goods：里面包含了SPU的几乎所有信息<ul>
<li>title：标题</li>
<li>subtitle：子标题，卖点</li>
<li>categories：分类对象数组，需要进行整理 **</li>
<li>brandId：品牌id</li>
<li>spuDetail：商品详情<ul>
<li>packingList：包装清单</li>
<li>afterService：售后服务</li>
<li>description：商品描述</li>
<li>缺少全局规格属性specifications **</li>
<li>缺少特有规格属性模板spec_template **</li>
</ul>
</li>
</ul>
</li>
<li>skus：包含了sku列表的几乎所有信息<ul>
<li>price：价格，需要处理为以分为单位</li>
<li>stock：库存</li>
<li>enable：是否启用</li>
<li>indexes：索引</li>
<li>images：图片，数组，需要处理为字符串**</li>
<li>缺少其它特有规格，ows_spec **</li>
<li>缺少标题：需要根据spu的标题结合特有属性生成 ** </li>
</ul>
</li>
<li>specifications：全局规格参数的键值对信息</li>
<li>specialSpec：特有规格参数信息</li>
</ul>
<p>在页面绑定点击事件：</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--提交按钮--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">v-flex</span> <span class="hljs-attr">xs3</span> <span class="hljs-attr">offset-xs9</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">v-btn</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"info"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"submit"</span>&gt;</span>保存商品信息<span class="hljs-tag">&lt;/<span class="hljs-name">v-btn</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">v-flex</span>&gt;</span></code></pre></div>





<p>编写代码，整理数据：</p>
<div class="hljs"><pre><code class="hljs js">submit()&#123;
    <span class="hljs-comment">// 表单校验。 略</span>
    <span class="hljs-comment">// 先处理goods，用结构表达式接收,除了categories外，都接收到goodsParams中</span>
    <span class="hljs-keyword">const</span> &#123;<span class="hljs-attr">categories</span>: [&#123;<span class="hljs-attr">id</span>:cid1&#125;,&#123;<span class="hljs-attr">id</span>:cid2&#125;,&#123;<span class="hljs-attr">id</span>:cid3&#125;], ...goodsParams&#125; = <span class="hljs-keyword">this</span>.goods;
    <span class="hljs-comment">// 处理规格参数</span>
    <span class="hljs-keyword">const</span> specs = <span class="hljs-keyword">this</span>.specifications.map(<span class="hljs-function">(<span class="hljs-params">&#123;group,params&#125;</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">const</span> newParams = params.map(<span class="hljs-function">(<span class="hljs-params">&#123;options,...rest&#125;</span>) =&gt;</span> &#123;
            <span class="hljs-keyword">return</span> rest;
        &#125;)
        <span class="hljs-keyword">return</span> &#123;group,<span class="hljs-attr">params</span>:newParams&#125;;
    &#125;);
    <span class="hljs-comment">// 处理特有规格参数模板</span>
    <span class="hljs-keyword">const</span> specTemplate = &#123;&#125;;
    <span class="hljs-keyword">this</span>.specialSpecs.forEach(<span class="hljs-function">(<span class="hljs-params">&#123;k, selected&#125;</span>) =&gt;</span> &#123;
        specTemplate[k] = selected;
    &#125;);
    <span class="hljs-comment">// 处理sku</span>
    <span class="hljs-keyword">const</span> skus = <span class="hljs-keyword">this</span>.skus.filter(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.enable).map(<span class="hljs-function">(<span class="hljs-params">&#123;price,stock,enable,images,indexes, ...rest&#125;</span>) =&gt;</span> &#123;
        <span class="hljs-comment">// 标题，在spu的title基础上，拼接特有规格属性值</span>
        <span class="hljs-keyword">const</span> title = goodsParams.title + <span class="hljs-string">" "</span> + <span class="hljs-built_in">Object</span>.values(rest).join(<span class="hljs-string">" "</span>);
        <span class="hljs-keyword">return</span> &#123;
            price: <span class="hljs-keyword">this</span>.$format(price+<span class="hljs-string">""</span>),stock,enable,indexes,title,<span class="hljs-comment">// 基本属性</span>
            images: !images ? <span class="hljs-string">''</span> : images.join(<span class="hljs-string">","</span>), <span class="hljs-comment">// 图片</span>
            ownSpec: <span class="hljs-built_in">JSON</span>.stringify(rest), <span class="hljs-comment">// 特有规格参数</span>
        &#125;
    &#125;);
    <span class="hljs-built_in">Object</span>.assign(goodsParams, &#123;
        cid1,cid2,cid3, <span class="hljs-comment">// 商品分类</span>
        skus, <span class="hljs-comment">// sku列表</span>
    &#125;)
    goodsParams.spuDetail.specifications= <span class="hljs-built_in">JSON</span>.stringify(specs);
    goodsParams.spuDetail.specTemplate = <span class="hljs-built_in">JSON</span>.stringify(specTemplate);

    <span class="hljs-built_in">console</span>.log(goodsParams)
&#125;</code></pre></div>



<p>点击测试，看效果：</p>
<p><img src="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday09/1526391630336.png" srcset="/img/loading.gif" alt="1526391630336"></p>
<p>向后台发起请求，因为请求体复杂，我们直接发起Json请求：</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">this</span>.$http.post(<span class="hljs-string">"/item/goods"</span>,goodsParams)
    .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    <span class="hljs-comment">// 成功，关闭窗口</span>
    <span class="hljs-keyword">this</span>.$emit(<span class="hljs-string">'close'</span>);
    <span class="hljs-comment">// 提示成功</span>
    <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">"新增成功了"</span>)
    &#125;)
    .catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"保存失败！"</span>);
    &#125;);
&#125;)</code></pre></div>



<h3 id="5-9-3-后台编写接口"><a href="#5-9-3-后台编写接口" class="headerlink" title="5.9.3.后台编写接口"></a>5.9.3.后台编写接口</h3><h4 id="实体类"><a href="#实体类" class="headerlink" title="实体类"></a>实体类</h4><blockquote>
<p>Spu</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"tb_spu"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Spu</span> </span>&#123;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> Long brandId;
    <span class="hljs-keyword">private</span> Long cid1;<span class="hljs-comment">// 1级类目</span>
    <span class="hljs-keyword">private</span> Long cid2;<span class="hljs-comment">// 2级类目</span>
    <span class="hljs-keyword">private</span> Long cid3;<span class="hljs-comment">// 3级类目</span>
    <span class="hljs-keyword">private</span> String title;<span class="hljs-comment">// 标题</span>
    <span class="hljs-keyword">private</span> String subTitle;<span class="hljs-comment">// 子标题</span>
    <span class="hljs-keyword">private</span> Boolean saleable;<span class="hljs-comment">// 是否上架</span>
    <span class="hljs-keyword">private</span> Boolean valid;<span class="hljs-comment">// 是否有效，逻辑删除用</span>
    <span class="hljs-keyword">private</span> Date createTime;<span class="hljs-comment">// 创建时间</span>
    <span class="hljs-keyword">private</span> Date lastUpdateTime;<span class="hljs-comment">// 最后修改时间</span>
&#125;</code></pre></div>

<blockquote>
<p>SpuDetail</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"tb_spu_detail"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpuDetail</span> </span>&#123;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long spuId;<span class="hljs-comment">// 对应的SPU的id</span>
    <span class="hljs-keyword">private</span> String description;<span class="hljs-comment">// 商品描述</span>
    <span class="hljs-keyword">private</span> String specTemplate;<span class="hljs-comment">// 商品特殊规格的名称及可选值模板</span>
    <span class="hljs-keyword">private</span> String specifications;<span class="hljs-comment">// 商品的全局规格属性</span>
    <span class="hljs-keyword">private</span> String packingList;<span class="hljs-comment">// 包装清单</span>
    <span class="hljs-keyword">private</span> String afterService;<span class="hljs-comment">// 售后服务</span>
&#125;</code></pre></div>

<blockquote>
<p>Sku</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"tb_sku"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sku</span> </span>&#123;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> Long spuId;
    <span class="hljs-keyword">private</span> String title;
    <span class="hljs-keyword">private</span> String images;
    <span class="hljs-keyword">private</span> Long price;
    <span class="hljs-keyword">private</span> String ownSpec;<span class="hljs-comment">// 商品特殊规格的键值对</span>
    <span class="hljs-keyword">private</span> String indexes;<span class="hljs-comment">// 商品特殊规格的下标</span>
    <span class="hljs-keyword">private</span> Boolean enable;<span class="hljs-comment">// 是否有效，逻辑删除用</span>
    <span class="hljs-keyword">private</span> Date createTime;<span class="hljs-comment">// 创建时间</span>
    <span class="hljs-keyword">private</span> Date lastUpdateTime;<span class="hljs-comment">// 最后修改时间</span>
    <span class="hljs-meta">@Transient</span>
    <span class="hljs-keyword">private</span> Long stock;<span class="hljs-comment">// 库存</span>
&#125;</code></pre></div>

<p>注意：这里保存了一个库存字段，在数据库中是另外一张表保存的，方便查询。</p>
<blockquote>
<p>Stock</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"tb_stock"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Stock</span> </span>&#123;

    <span class="hljs-meta">@Id</span>
    <span class="hljs-keyword">private</span> Long skuId;
    <span class="hljs-keyword">private</span> Integer seckillStock;<span class="hljs-comment">// 秒杀可用库存</span>
    <span class="hljs-keyword">private</span> Integer seckillTotal;<span class="hljs-comment">// 已秒杀数量</span>
    <span class="hljs-keyword">private</span> Integer stock;<span class="hljs-comment">// 正常库存</span>
&#125;</code></pre></div>



<h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><p>四个问题：</p>
<ul>
<li><p>请求方式：POST</p>
</li>
<li><p>请求路径：/goods</p>
</li>
<li><p>请求参数：Spu的json格式的对象，spu中包含spuDetail和Sku集合。这里我们该怎么接收？我们之前定义了一个SpuBo对象，作为业务对象。这里也可以用它，不过需要再扩展spuDetail和skus字段：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpuBo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Spu</span> </span>&#123;

    <span class="hljs-meta">@Transient</span>
    String cname;<span class="hljs-comment">// 商品分类名称</span>
    <span class="hljs-meta">@Transient</span>
    String bname;<span class="hljs-comment">// 品牌名称</span>
    <span class="hljs-meta">@Transient</span>
    SpuDetail spuDetail;<span class="hljs-comment">// 商品详情</span>
    <span class="hljs-meta">@Transient</span>
    List&lt;Sku&gt; skus;<span class="hljs-comment">// sku列表</span>
&#125;</code></pre></div>
</li>
<li><p>返回类型：无</p>
</li>
</ul>
<p>代码：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 新增商品</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> spu</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@PostMapping</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseEntity&lt;Void&gt; <span class="hljs-title">saveGoods</span><span class="hljs-params">(@RequestBody Spu spu)</span> </span>&#123;
    <span class="hljs-keyword">try</span> &#123;
        <span class="hljs-keyword">this</span>.goodsService.save(spu);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.CREATED);
    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
        e.printStackTrace();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseEntity&lt;&gt;(HttpStatus.INTERNAL_SERVER_ERROR);
    &#125;
&#125;</code></pre></div>

<p>注意：通过@RequestBody注解来接收Json请求</p>
<blockquote>
<p>Service</p>
</blockquote>
<p>这里的逻辑比较复杂，我们除了要对SPU新增以外，还要对SpuDetail、Sku、Stock进行保存</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Transactional</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">(SpuBo spu)</span> </span>&#123;
    <span class="hljs-comment">// 保存spu</span>
    spu.setSaleable(<span class="hljs-keyword">true</span>);
    spu.setValid(<span class="hljs-keyword">true</span>);
    spu.setCreateTime(<span class="hljs-keyword">new</span> Date());
    spu.setLastUpdateTime(spu.getCreateTime());
    <span class="hljs-keyword">this</span>.spuMapper.insert(spu);
    <span class="hljs-comment">// 保存spu详情</span>
    spu.getSpuDetail().setSpuId(spu.getId());
    <span class="hljs-keyword">this</span>.spuDetailMapper.insert(spu.getSpuDetail());

    <span class="hljs-comment">// 保存sku和库存信息</span>
    saveSkuAndStock(spu.getSkus(), spu.getId());
&#125;

<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveSkuAndStock</span><span class="hljs-params">(List&lt;Sku&gt; skus, Long spuId)</span> </span>&#123;
    <span class="hljs-keyword">for</span> (Sku sku : skus) &#123;
        <span class="hljs-keyword">if</span> (!sku.getEnable()) &#123;
            <span class="hljs-keyword">continue</span>;
        &#125;
        <span class="hljs-comment">// 保存sku</span>
        sku.setSpuId(spuId);
        <span class="hljs-comment">// 默认不参与任何促销</span>
        sku.setCreateTime(<span class="hljs-keyword">new</span> Date());
        sku.setLastUpdateTime(sku.getCreateTime());
        <span class="hljs-keyword">this</span>.skuMapper.insert(sku);

        <span class="hljs-comment">// 保存库存信息</span>
        Stock stock = <span class="hljs-keyword">new</span> Stock();
        stock.setSkuId(sku.getId());
        stock.setStock(sku.getStock());
        <span class="hljs-keyword">this</span>.stockMapper.insert(stock);
    &#125;
&#125;</code></pre></div>



<h4 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h4><p>都是通用Mapper，略</p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8E/">乐优商城</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/SPU/">SPU</a>
                    
                      <a class="hover-with-bg" href="/tags/SKU/">SKU</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday10/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">乐优商城day10：商品管理</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/09/26/%E4%B9%90%E4%BC%98%E5%95%86%E5%9F%8Eday08/">
                        <span class="hidden-mobile">乐优商城day08：品牌管理</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

代码块js 用不到，fulid自带有，添加css样式即可实现
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键字</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">载入天数...</span>
  <span id="times">载入时分秒...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//此处修改你的建站时间或者网站上线时间
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "本站勉强运行&nbsp"+dnum+"&nbsp天";
      document.getElementById("times").innerHTML = hnum + "&nbsp小时&nbsp" + mnum + "&nbsp分&nbsp" + snum + "&nbsp秒";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


    
  <!-- 备案信息 -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">京ICP证20000725号</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=20000725"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>京公网安备20000725号</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "乐优商城day09：商品规格管理&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
