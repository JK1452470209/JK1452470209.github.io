<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day12ï¼šåŸºäº Nuxt.js æ„å»ºæœç´¢å‰ç«¯å·¥ç¨‹</title>
    <link href="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/"/>
    <url>/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day12</code> çš„å†…å®¹</p><ul><li>Nuxt.js çš„åŸºæœ¬ä½¿ç”¨</li><li>åŸºäº Nuxt.js å¼€å‘æœç´¢é—¨æˆ·å‰ç«¯</li></ul><h1 id="ä¸€ã€æœç´¢å‰ç«¯æŠ€æœ¯éœ€æ±‚"><a href="#ä¸€ã€æœç´¢å‰ç«¯æŠ€æœ¯éœ€æ±‚" class="headerlink" title="ä¸€ã€æœç´¢å‰ç«¯æŠ€æœ¯éœ€æ±‚"></a>ä¸€ã€æœç´¢å‰ç«¯æŠ€æœ¯éœ€æ±‚</h1><p>é‡‡ç”¨ <code>vue.js</code> å¼€å‘æœç´¢ç•Œé¢åˆ™ <code>SEO</code> ä¸å‹å¥½ï¼Œéœ€è¦è§£å†³ <code>SEO</code> çš„é—®é¢˜ã€‚</p><h2 id="1-ä»€ä¹ˆæ˜¯SEO"><a href="#1-ä»€ä¹ˆæ˜¯SEO" class="headerlink" title="1. ä»€ä¹ˆæ˜¯SEO?"></a>1. ä»€ä¹ˆæ˜¯SEO?</h2><p>æˆ‘ä»¬å…ˆå¼€ä¸€ä¸‹ç™¾åº¦ç™¾ç§‘æ˜¯å¦‚ä½•æè¿°çš„</p><p><a href="https://qnoss.codeyee.com/20200704_12/image1" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image1.png" srcset="/img/loading.gif" alt="img"></a></p><p>æ€»ç»“ï¼š<code>seo</code> æ˜¯ç½‘ç«™ä¸ºäº†æé«˜è‡ªå·²çš„ç½‘ç«™æ’åï¼Œè·å¾—æ›´å¤šçš„æµé‡ï¼Œå¯¹ç½‘ç«™çš„ç»“æ„åŠå†…å®¹è¿›è¡Œè°ƒæ•´ä¼˜åŒ–ï¼Œä»¥ä¾¿æœç´¢å¼•æ“ï¼ˆç™¾åº¦ï¼Œgoogleç­‰ï¼‰æ›´å¥½æŠ“å–åˆ°æ›´ä¼˜è´¨çš„ç½‘ç«™çš„å†…å®¹ã€‚</p><p>ä¸‹å›¾æ˜¯æœç´¢å¼•æ“çˆ¬å–ç½‘ç«™é¡µé¢çš„å¤§æ¦‚æµç¨‹å›¾ï¼š</p><blockquote><p>æœç´¢å¼•æ“çš„å·¥ä½œæµç¨‹å¾ˆå¤æ‚ï¼Œä¸‹å›¾åªæ˜¯ç®€å•æ¦‚æ‹¬</p></blockquote><p><a href="https://qnoss.codeyee.com/20200704_12/image2" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image2.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ° <code>SEO</code> æ˜¯ç½‘ç«™è‡ªå·±ä¸ºäº†æ–¹ä¾¿ <code>spider</code> (çˆ¬è™«) æŠ“å–ç½‘é¡µè€Œä½œå‡ºçš„ç½‘é¡µå†…å®¹ä¼˜åŒ–ï¼Œå¸¸è§çš„ <code>SEO</code> æ–¹æ³•æ¯”å¦‚ï¼š</p><ul><li>å¯¹ <code>url</code> é“¾æ¥çš„è§„èŒƒåŒ–ï¼Œå¤šç”¨ <code>restful</code> é£æ ¼çš„ <code>url</code>ï¼Œå¤šç”¨é™æ€èµ„æº <code>url</code>ï¼›</li><li>æ³¨æ„ <code>title</code>ã€<code>keywords</code> çš„è®¾ç½®ã€‚</li><li>ç”±äº <code>spider</code> å¯¹ <code>javascript</code> æ”¯æŒä¸å¥½ï¼Œå¯¹äºç½‘é¡µè·³è½¬ç”¨ <code>href</code> æ ‡ç­¾ã€‚</li></ul><h2 id="2-æœåŠ¡ç«¯æ¸²æŸ“å’Œå®¢æˆ·ç«¯æ¸²æŸ“"><a href="#2-æœåŠ¡ç«¯æ¸²æŸ“å’Œå®¢æˆ·ç«¯æ¸²æŸ“" class="headerlink" title="2. æœåŠ¡ç«¯æ¸²æŸ“å’Œå®¢æˆ·ç«¯æ¸²æŸ“"></a>2. æœåŠ¡ç«¯æ¸²æŸ“å’Œå®¢æˆ·ç«¯æ¸²æŸ“</h2><p>é‡‡ç”¨ä»€ä¹ˆæŠ€æœ¯æœ‰åˆ©äº <code>SEO</code>ï¼Ÿè¦è§£ç­”è¿™ä¸ªé—®é¢˜éœ€è¦ç†è§£æœåŠ¡ç«¯æ¸²æŸ“å’Œå®¢æˆ·ç«¯æ¸²æŸ“ã€‚</p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯æœåŠ¡ç«¯æ¸²æŸ“?</p><p>æˆ‘ä»¬ç”¨ä¼ ç»Ÿçš„ <code>servlet</code> å¼€å‘æ¥ä¸¾ä¾‹ï¼šæµè§ˆå™¨è¯·æ±‚ <code>servlet</code>ï¼Œ<code>servlet</code> åœ¨æœåŠ¡ç«¯ç”Ÿæˆ <code>html</code> å“åº”ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨å±•ç¤º<code>html</code> çš„å†…å®¹ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æœåŠ¡ç«¯æ¸²æŸ“ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_12/image3" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image3.png" srcset="/img/loading.gif" alt="img"></a></p><p>æœåŠ¡ç«¯æ¸²æŸ“çš„ç‰¹ç‚¹ï¼š</p><p>1ï¼‰åœ¨æœåŠ¡ç«¯ç”Ÿæˆ <code>html</code> ç½‘é¡µçš„ <code>dom</code> å…ƒç´ ã€‚</p><p>2ï¼‰å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰åªè´Ÿè´£æ˜¾ç¤º <code>dom</code> å…ƒç´ å†…å®¹ã€‚</p><p>å½“åˆéšç€ <code>web2.0</code> çš„åˆ°æ¥ï¼Œ<code>AJAX</code> æŠ€æœ¯å…´èµ·ï¼Œå‡ºç°äº†å®¢æˆ·ç«¯æ¸²æŸ“ï¼šå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ ä½¿ç”¨ <code>AJAX</code> å‘æœåŠ¡ç«¯å‘èµ·<code>http</code> è¯·æ±‚ï¼Œè·å–åˆ°äº†æƒ³è¦çš„æ•°æ®ï¼Œå®¢æˆ·ç«¯æ‹¿ç€æ•°æ®å¼€å§‹æ¸²æŸ“ <code>html</code> ç½‘é¡µï¼Œç”Ÿæˆ <code>Dom</code> å…ƒç´ ï¼Œå¹¶æœ€ç»ˆå°†ç½‘é¡µå†…å®¹å±•ç¤ºç»™ç”¨æˆ·</p><p>å®¢æˆ·ç«¯æ¸²æŸ“å¦‚ä¸‹å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_12/image4" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image4.png" srcset="/img/loading.gif" alt="img"></a></p><p>å®¢æˆ·ç«¯æ¸²æŸ“çš„ç‰¹ç‚¹ï¼š</p><p>1ï¼‰åœ¨æœåŠ¡ç«¯åªæ˜¯ç»™å®¢æˆ·ç«¯å“åº”çš„äº†æ•°æ®ï¼Œè€Œä¸æ˜¯ <code>html</code> ç½‘é¡µ</p><p>2ï¼‰å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰è´Ÿè´£è·å–æœåŠ¡ç«¯çš„æ•°æ®ç”Ÿæˆ <code>Dom</code> å…ƒç´ ã€‚</p><p>ä¸¤ç§æ–¹å¼å„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</p><p><strong>å®¢æˆ·ç«¯æ¸²æŸ“ï¼š</strong></p><ol><li>ç¼ºç‚¹</li></ol><p>ä¸åˆ©äºç½‘ç«™è¿›è¡Œ <code>SEO</code>ï¼Œå› ä¸ºç½‘ç«™å¤§é‡ä½¿ç”¨ <code>javascript</code> æŠ€æœ¯ï¼Œä¸åˆ©äº <code>spider</code> æŠ“å–ç½‘é¡µã€‚</p><ol><li>ä¼˜ç‚¹</li></ol><p>å®¢æˆ·ç«¯è´Ÿè´£æ¸²æŸ“ï¼Œç”¨æˆ·ä½“éªŒæ€§å¥½ï¼ŒæœåŠ¡ç«¯åªæä¾›æ•°æ®ä¸ç”¨å…³å¿ƒç”¨æˆ·ç•Œé¢çš„å†…å®¹ï¼Œæœ‰åˆ©äºæé«˜æœåŠ¡ç«¯çš„å¼€å‘æ•ˆç‡ã€‚</p><p>3ï¼‰é€‚ç”¨åœºæ™¯</p><p>å¯¹SEOæ²¡æœ‰è¦æ±‚çš„ç³»ç»Ÿï¼Œæ¯”å¦‚åå°ç®¡ç†ç±»çš„ç³»ç»Ÿï¼Œå¦‚ç”µå•†åå°ç®¡ç†ï¼Œç”¨æˆ·ç®¡ç†ç­‰ã€‚</p><p><strong>æœåŠ¡ç«¯æ¸²æŸ“ï¼š</strong></p><ol><li>ä¼˜ç‚¹</li></ol><p>æœ‰åˆ©äºSEOï¼Œç½‘ç«™é€šè¿‡ <code>href</code> çš„ <code>url</code> å°† <code>spider</code>ç›´æ¥å¼•åˆ°æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æä¾›ä¼˜è´¨çš„ç½‘é¡µå†…å®¹ç»™ <code>spider</code>ã€‚</p><ol><li>ç¼ºç‚¹</li></ol><p>æœåŠ¡ç«¯å®Œæˆä¸€éƒ¨åˆ†å®¢æˆ·ç«¯çš„å·¥ä½œï¼Œé€šå¸¸å®Œæˆä¸€ä¸ªéœ€æ±‚éœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ä»£ç ï¼Œå¼€å‘æ•ˆç‡ä½ï¼Œä¸åˆ©äºç³»ç»Ÿçš„<br>ç¨³å®šæ€§ã€‚</p><p>3ï¼‰é€‚ç”¨åœºæ™¯</p><p>å¯¹ <code>SEO</code> æœ‰è¦æ±‚çš„ç³»ç»Ÿï¼Œæ¯”å¦‚ï¼šé—¨æˆ·é¦–é¡µã€å•†å“è¯¦æƒ…é¡µé¢ç­‰ã€‚</p><h1 id="äºŒã€Nuxt-js-ä»‹ç»"><a href="#äºŒã€Nuxt-js-ä»‹ç»" class="headerlink" title="äºŒã€Nuxt.js ä»‹ç»"></a>äºŒã€Nuxt.js ä»‹ç»</h1><h2 id="0x01-ç®€å•çš„äº†è§£ä¸€ä¸‹"><a href="#0x01-ç®€å•çš„äº†è§£ä¸€ä¸‹" class="headerlink" title="0x01 ç®€å•çš„äº†è§£ä¸€ä¸‹"></a>0x01 ç®€å•çš„äº†è§£ä¸€ä¸‹</h2><p>ç§»åŠ¨äº’è”ç½‘çš„å…´èµ·ä¿ƒè¿›äº† <code>web</code> å‰åç«¯åˆ†ç¦»å¼€å‘æ¨¡å¼çš„å‘å±•ï¼ŒæœåŠ¡ç«¯åªä¸“æ³¨ä¸šåŠ¡ï¼Œå‰ç«¯åªä¸“æ³¨ç”¨æˆ·ä½“éªŒï¼Œå‰ç«¯å¤§é‡è¿ç”¨çš„å‰ç«¯æ¸²æŸ“æŠ€æœ¯ï¼Œæ¯”å¦‚æµè¡Œçš„ <code>vue.js</code>ã€<code>react</code> æ¡†æ¶éƒ½å®ç°äº†åŠŸèƒ½å¼ºå¤§çš„å‰ç«¯æ¸²æŸ“ã€‚</p><p>ä½†æ˜¯ï¼Œå¯¹äºæœ‰ <code>SEO</code> éœ€æ±‚çš„ç½‘é¡µå¦‚æœä½¿ç”¨å‰ç«¯æ¸²æŸ“æŠ€æœ¯å»å¼€å‘å°±ä¸åˆ©äº <code>SEO</code> äº†ï¼Œæœ‰æ²¡æœ‰ä¸€ç§å³ä½¿ç”¨ <code>vue.js</code>ã€<code>react</code> çš„å‰ç«¯æŠ€æœ¯ä¹Ÿå®ç°æœåŠ¡ç«¯æ¸²æŸ“çš„æŠ€æœ¯å‘¢ï¼Ÿå…¶å®ï¼Œå¯¹äºæœåŠ¡ç«¯æ¸²æŸ“çš„éœ€æ±‚ï¼Œ<code>vue.js</code>ã€<code>react</code> è¿™æ ·æµè¡Œçš„å‰ç«¯æ¡†æ¶æä¾›äº†æœåŠ¡ç«¯æ¸²æŸ“çš„è§£å†³æ–¹æ¡ˆã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_12/image5" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image5.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼š</p><p><code>react</code> æ¡†æ¶æä¾› <code>next.js</code> å®ç°æœåŠ¡ç«¯æ¸²æŸ“ã€‚</p><p><code>vue.js</code> æ¡†æ¶æä¾› <code>Nuxt.js</code> å®ç°æœåŠ¡ç«¯æ¸²æŸ“ã€‚</p><p>åŸºæœ¬åŸç†</p><h2 id="0x02-å·¥ä½œåŸç†"><a href="#0x02-å·¥ä½œåŸç†" class="headerlink" title="0x02 å·¥ä½œåŸç†"></a>0x02 å·¥ä½œåŸç†</h2><p>ä¸‹å›¾å±•ç¤ºäº†ä»å®¢æˆ·ç«¯è¯·æ±‚åˆ° <code>Nuxt.js</code> è¿›è¡ŒæœåŠ¡ç«¯æ¸²æŸ“çš„æ•´ä½“çš„å·¥ä½œæµç¨‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_12/image6" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image6.png" srcset="/img/loading.gif" alt="img"></a></p><p>1ã€ç”¨æˆ·æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ç½‘å€è¯·æ±‚åˆ° <code>Node.js</code></p><p>2ã€éƒ¨ç½²åœ¨ <code>Node.js</code> çš„åº”ç”¨ <code>Nuxt.js</code> æ¥æ”¶æµè§ˆå™¨è¯·æ±‚ï¼Œå¹¶è¯·æ±‚æœåŠ¡ç«¯è·å–æ•°æ®</p><p>3ã€<strong>Nuxt.js</strong> è·å–åˆ°æ•°æ®åè¿›è¡ŒæœåŠ¡ç«¯æ¸²æŸ“</p><p>4ã€<strong>Nuxt.js</strong> å°† <code>html</code> ç½‘é¡µå“åº”ç»™æµè§ˆå™¨</p><p><strong>Nuxt.js</strong> ä½¿ç”¨äº†å“ªäº›æŠ€æœ¯ï¼Ÿ</p><p><strong>Nuxt.js</strong> ä½¿ç”¨ <code>Vue.js</code> + <code>webpack</code> + <code>Babel</code> ä¸‰å¤§æŠ€æœ¯æ¡†æ¶/ç»„ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_12/image7" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image7.png" srcset="/img/loading.gif" alt="img"></a></p><p><code>Babel</code> æ˜¯ä¸€ä¸ª <code>js</code> çš„è½¬ç å™¨ï¼Œè´Ÿè´£å°† <code>ES6</code> çš„ä»£ç è½¬æˆæµè§ˆå™¨è¯†åˆ«çš„ <code>ES5</code> ä»£ç ã€‚</p><p><code>Webpack</code> æ˜¯ä¸€ä¸ªå‰ç«¯å·¥ç¨‹æ‰“åŒ…å·¥å…·ã€‚</p><p><code>Vue.js</code> æ˜¯ä¸€ä¸ªä¼˜ç§€çš„å‰ç«¯æ¡†æ¶ã€‚</p><p>é‚£ä¹ˆ <strong>Nuxt.js</strong> çš„ç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ</p><ul><li>åŸºäº <code>Vue.js</code></li><li>è‡ªåŠ¨ä»£ç åˆ†å±‚</li><li>æœåŠ¡ç«¯æ¸²æŸ“</li><li>å¼ºå¤§çš„è·¯ç”±åŠŸèƒ½ï¼Œæ”¯æŒå¼‚æ­¥æ•°æ®</li><li>é™æ€æ–‡ä»¶æœåŠ¡</li><li>ES6/ES7 è¯­æ³•æ”¯æŒ</li><li>æ‰“åŒ…å’Œå‹ç¼© <code>JS</code> å’Œ <code>CSS</code></li><li><code>HTML</code> å¤´éƒ¨æ ‡ç­¾ç®¡ç†</li><li>æœ¬åœ°å¼€å‘æ”¯æŒçƒ­åŠ è½½</li><li>é›†æˆ <code>ESLint</code></li><li>æ”¯æŒå„ç§æ ·å¼é¢„å¤„ç†å™¨ï¼š <code>SASS</code>ã€<code>LESS</code>ã€ <code>Stylus</code> ç­‰ç­‰</li></ul><h1 id="ä¸‰ã€Nuxt-js-åŸºæœ¬ä½¿ç”¨"><a href="#ä¸‰ã€Nuxt-js-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="ä¸‰ã€Nuxt.js åŸºæœ¬ä½¿ç”¨"></a>ä¸‰ã€Nuxt.js åŸºæœ¬ä½¿ç”¨</h1><h2 id="1-åˆ›å»º-Nuxt-å·¥ç¨‹"><a href="#1-åˆ›å»º-Nuxt-å·¥ç¨‹" class="headerlink" title="1. åˆ›å»º Nuxt å·¥ç¨‹"></a>1. åˆ›å»º Nuxt å·¥ç¨‹</h2><p><code>nuxt.js</code> æœ‰æ ‡å‡†çš„ç›®å½•ç»“æ„ï¼Œå®˜æ–¹æä¾›äº†æ¨¡æ¿å·¥ç¨‹ï¼Œå¯ä»¥æ¨¡æ¿å·¥ç¨‹å¿«é€Ÿåˆ›å»º <code>nuxt</code> é¡¹ç›®ã€‚</p><p>æ¨¡æ¿å·¥ç¨‹åœ°å€ï¼š<a href="https://github.com/nuxt-community/starter-template/archive/master.zip" target="_blank" rel="noopener">https://github.com/nuxt-community/starter-template/archive/master.zip</a></p><p>æœ¬é¡¹ç›®æä¾›åŸºäº <code>Nuxt.js</code> çš„å°è£…å·¥ç¨‹ï¼ŒåŸºäºæ­¤å°è£…å·¥ç¨‹å¼€å‘æœç´¢å‰ç«¯ï¼Œè§ <code>èµ„æ–™/xc-ui-pc-portal.zip</code>ï¼Œè§£å‹ <code>xc-ui-pc-portal.zip</code> åˆ°æœ¬é¡¹ç›®å‰ç«¯å·¥ç¨‹ç›®å½•ä¸‹ã€‚</p><p>æœ¬å‰ç«¯å·¥ç¨‹å±äºé—¨æˆ·çš„ä¸€éƒ¨åˆ†ï¼Œå°†æ‰¿è½½ä¸€éƒ¨åˆ†è€ƒè™‘ <code>SEO</code> çš„éé™æ€åŒ–é¡µé¢ã€‚</p><p>æœ¬å·¥ç¨‹åŸºäº <code>Nuxt.js</code> æ¨¡æ¿å·¥ç¨‹æ„å»ºï¼Œ<code>Nuxt.js</code> ä½¿ç”¨ <code>1.3</code> ç‰ˆæœ¬ï¼Œå¹¶åŠ å…¥äº†ä»Šåå¼€å‘ä¸­æ‰€ä½¿ç”¨çš„ä¾èµ–åŒ…ï¼Œç›´æ¥è§£å‹æœ¬å·¥ç¨‹å³å¯ä½¿ç”¨ã€‚</p><h2 id="2-ç›®å½•ç»“æ„"><a href="#2-ç›®å½•ç»“æ„" class="headerlink" title="2. ç›®å½•ç»“æ„"></a>2. ç›®å½•ç»“æ„</h2><p>ç›®å½•ç»“æ„å¦‚ä¸‹</p><p><a href="https://qnoss.codeyee.com/20200704_12/image8" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image8.png" srcset="/img/loading.gif" alt="img"></a></p><table><thead><tr><th>åç§°</th><th>æè¿°ä¿¡æ¯</th></tr></thead><tbody><tr><td>assets</td><td>èµ„æºç›®å½• <code>assets</code> ç”¨äºç»„ç»‡æœªç¼–è¯‘çš„é™æ€èµ„æºå¦‚ <code>LESS</code>ã€<code>SASS</code> æˆ– <code>JavaScript</code></td></tr><tr><td>components</td><td>ç»„ä»¶ç›®å½• <code>components</code> ç”¨äºç»„ç»‡åº”ç”¨çš„ <code>Vue.js</code> ç»„ä»¶ã€‚<code>Nuxt.js</code> ä¸ä¼šæ‰©å±•å¢å¼ºè¯¥ç›®å½•ä¸‹ <code>Vue.js</code> ç»„ä»¶ï¼Œå³è¿™äº›ç»„ä»¶ä¸ä¼šåƒé¡µé¢ç»„ä»¶é‚£æ ·æœ‰ <code>asyncData</code> æ–¹æ³•çš„ç‰¹æ€§ã€‚</td></tr><tr><td>layouts</td><td>å¸ƒå±€ç›®å½• <code>layouts</code> ç”¨äºç»„ç»‡åº”ç”¨çš„å¸ƒå±€ç»„ä»¶ã€‚è¯¥ç›®å½•åä¸º <code>Nuxt.js</code> ä¿ç•™çš„ï¼Œä¸å¯æ›´æ”¹ã€‚</td></tr><tr><td>middleware</td><td><code>middleware</code> ç›®å½•ç”¨äºå­˜æ”¾åº”ç”¨çš„ä¸­é—´ä»¶</td></tr><tr><td>pages</td><td>é¡µé¢ç›®å½• <code>pages</code> ç”¨äºç»„ç»‡åº”ç”¨çš„è·¯ç”±åŠè§†å›¾ã€‚<code>Nuxt.js</code> æ¡†æ¶è¯»å–è¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„ <code>.vue</code> æ–‡ä»¶å¹¶è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„è·¯ç”±é…ç½®ã€‚è¯¥ç›®å½•åä¸º <code>Nuxt.js</code> ä¿ç•™çš„ï¼Œä¸å¯æ›´æ”¹ã€‚</td></tr><tr><td>plugins</td><td>æ’ä»¶ç›®å½• <code>plugins</code> ç”¨äºç»„ç»‡é‚£äº›éœ€è¦åœ¨ æ ¹<code>vue.js</code>åº”ç”¨ å®ä¾‹åŒ–ä¹‹å‰éœ€è¦è¿è¡Œçš„ <code>Javascript</code> æ’ä»¶</td></tr><tr><td>static</td><td>é™æ€æ–‡ä»¶ç›®å½• <code>static</code> ç”¨äºå­˜æ”¾åº”ç”¨çš„é™æ€æ–‡ä»¶ï¼Œæ­¤ç±»æ–‡ä»¶ä¸ä¼šè¢« <code>Nuxt.js</code> è°ƒç”¨ <code>Webpack</code> è¿›è¡Œæ„å»ºç¼–è¯‘å¤„ç†ã€‚ æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šæ˜ å°„è‡³åº”ç”¨çš„æ ¹è·¯å¾„ / ä¸‹ã€‚ä¾‹å¦‚: <code>/static/logo.png</code> æ˜ å°„è‡³ <code>/logo.png</code> ï¼Œè¯¥ç›®å½•åä¸º<code>Nuxt.js</code>ä¿ç•™çš„ï¼Œä¸å¯æ›´æ”¹ã€‚</td></tr><tr><td>Store</td><td><code>store</code> ç›®å½•ç”¨äºç»„ç»‡åº”ç”¨çš„ <code>Vuex</code> çŠ¶æ€æ ‘ æ–‡ä»¶ã€‚ <code>Nuxt.js</code> æ¡†æ¶é›†æˆäº† <code>Vuex</code> çŠ¶æ€æ ‘ çš„ç›¸å…³åŠŸèƒ½é…ç½®ï¼Œåœ¨ <code>store</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>index.js</code> æ–‡ä»¶å¯æ¿€æ´»è¿™äº›é…ç½®ã€‚</td></tr><tr><td>nuxt.config.js</td><td>nuxt.config.js æ–‡ä»¶ç”¨äºç»„ç»‡ <code>Nuxt.js</code> åº”ç”¨çš„ä¸ªæ€§åŒ–é…ç½®ï¼Œä»¥ä¾¿è¦†ç›–é»˜è®¤é…ç½®ã€‚è¯¥æ–‡ä»¶åä¸º<code>Nuxt.js</code> ä¿ç•™çš„ï¼Œä¸å¯æ›´æ”¹ã€‚</td></tr><tr><td>package.json</td><td>æ–‡ä»¶ç”¨äºæè¿°åº”ç”¨çš„ä¾èµ–å…³ç³»å’Œå¯¹å¤–æš´éœ²çš„è„šæœ¬æ¥å£ã€‚è¯¥æ–‡ä»¶åä¸º <code>Nuxt.js</code> ä¿ç•™çš„ï¼Œä¸å¯æ›´æ”¹ã€‚</td></tr></tbody></table><p>nuxt.js æä¾›äº†ç›®å½•çš„åˆ«åï¼Œæ–¹ä¾¿åœ¨ç¨‹åºä¸­å¼•ç”¨ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_12/image9" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image9.png" srcset="/img/loading.gif" alt="img"></a></p><p>å®˜æ–¹æ–‡æ¡£ï¼š <a href="https://zh.nuxtjs.org/guide/installation" target="_blank" rel="noopener">https://zh.nuxtjs.org/guide/installation</a></p><h2 id="3-é¡µé¢å¸ƒå±€"><a href="#3-é¡µé¢å¸ƒå±€" class="headerlink" title="3. é¡µé¢å¸ƒå±€"></a>3. é¡µé¢å¸ƒå±€</h2><p>é¡µé¢å¸ƒå±€å°±æ˜¯é¡µé¢å†…å®¹çš„æ•´ä½“ç»“æ„ï¼Œé€šè¿‡åœ¨ <code>layouts</code> ç›®å½•ä¸‹æ·»åŠ å¸ƒå±€æ–‡ä»¶æ¥å®ç°ã€‚åœ¨ <code>layouts</code> æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½å±äºä¸ªæ€§åŒ–å¸ƒå±€æ–‡ä»¶ï¼Œå¯ä»¥åœ¨é¡µé¢ç»„ä»¶ä¸­åˆ©ç”¨ <code>layout</code> å±æ€§æ¥å¼•ç”¨ã€‚</p><p>ä¸€ä¸ªä¾‹å­ï¼š</p><p>1ã€å®šä¹‰ï¼š<code>layouts/test.vue</code> å¸ƒå±€æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><p>æ³¨æ„ï¼šå¸ƒå±€æ–‡ä»¶ä¸­ä¸€å®šè¦åŠ  <code>&lt;nuxt/&gt;</code> ç»„ä»¶ç”¨äºæ˜¾ç¤ºé¡µé¢å†…å®¹ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è¿™é‡Œæ˜¯å¤´<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">nuxt</span>/&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>è¿™é‡Œæ˜¯å°¾<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span>&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><p>2ã€åœ¨ <code>pages</code> ç›®å½•åˆ›å»º <code>user</code> ç›®å½•ï¼Œå¹¶åˆ›å»º <code>index.vue</code> é¡µé¢</p><p>åœ¨ <code>pages/user/index.vue</code> é¡µé¢é‡Œï¼Œ å¯ä»¥æŒ‡å®šé¡µé¢ç»„ä»¶ä½¿ç”¨ <code>test</code> å¸ƒå±€ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    æµ‹è¯•é¡µé¢    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span>&#123;</span><span class="actionscript">layout:<span class="hljs-string">'test'</span></span>&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><p>3ã€æµ‹è¯•</p><p>è¯·æ±‚ï¼š<a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:10000/userï¼Œæ•ˆæœå¦‚ä¸‹:</p><p><a href="https://qnoss.codeyee.com/20200704_12/image10" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image10.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="4-è·¯ç”±"><a href="#4-è·¯ç”±" class="headerlink" title="4. è·¯ç”±"></a>4. è·¯ç”±</h2><h3 id="1ã€åŸºç¡€è·¯ç”±"><a href="#1ã€åŸºç¡€è·¯ç”±" class="headerlink" title="1ã€åŸºç¡€è·¯ç”±"></a>1ã€åŸºç¡€è·¯ç”±</h3><p><strong>Nuxt.js</strong> ä¾æ® <code>pages</code> ç›®å½•ç»“æ„è‡ªåŠ¨ç”Ÿæˆ <code>vue-router</code> æ¨¡å—çš„è·¯ç”±é…ç½®ã€‚</p><p><strong>Nuxt.js</strong> æ ¹æ® <code>pages</code> çš„ç›®å½•ç»“æ„åŠé¡µé¢åç§°å®šä¹‰è§„èŒƒæ¥ç”Ÿæˆè·¯ç”±ï¼Œä¸‹è¾¹æ˜¯ä¸€ä¸ªåŸºç¡€è·¯ç”±çš„ä¾‹å­</p><p>å‡è®¾ <code>pages</code> çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs haml">pages/-<span class="ruby">-<span class="hljs-params">| user/</span></span><span class="ruby">-----<span class="hljs-params">| index.vue</span></span><span class="ruby">-----<span class="hljs-params">| one.vue</span></span></code></pre></div><p>é‚£ä¹ˆï¼Œ<code>Nuxt.js</code> è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±é…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js">router: &#123;routes: [        &#123;            name: <span class="hljs-string">'user'</span>,            path: <span class="hljs-string">'/user'</span>,            component: <span class="hljs-string">'pages/user/index.vue'</span>        &#125;,        &#123;            name: <span class="hljs-string">'user-one'</span>,            path: <span class="hljs-string">'/user/one'</span>,            component: <span class="hljs-string">'pages/user/one.vue'</span>        &#125;    ]&#125;</code></pre></div><p><strong>index.vue</strong> ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    ç”¨æˆ·ç®¡ç†é¦–é¡µ    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span>&#123;</span><span class="actionscript">layout:<span class="hljs-string">"test"</span></span>&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><p><strong>one.vue</strong> ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>        oneé¡µé¢    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span>&#123;</span><span class="actionscript">        layout:<span class="hljs-string">"test"</span></span>    &#125; <span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><p>åˆ†åˆ«è®¿é—®å¦‚ä¸‹é“¾æ¥è¿›è¡Œæµ‹è¯•ï¼š</p><p><a href="http://localhost:10000/user" target="_blank" rel="noopener">http://localhost:10000/user</a></p><p><a href="http://localhost:10000/user/one" target="_blank" rel="noopener">http://localhost:10000/user/one</a></p><h3 id="2ã€åµŒå¥—è·¯ç”±"><a href="#2ã€åµŒå¥—è·¯ç”±" class="headerlink" title="2ã€åµŒå¥—è·¯ç”±"></a>2ã€åµŒå¥—è·¯ç”±</h3><p>ä½ å¯ä»¥é€šè¿‡ <code>vue-router</code> çš„å­è·¯ç”±åˆ›å»º <code>Nuxt.js</code> åº”ç”¨çš„åµŒå¥—è·¯ç”±ã€‚</p><p>åˆ›å»ºå†…åµŒå­è·¯ç”±ï¼Œä½ éœ€è¦æ·»åŠ ä¸€ä¸ª <code>Vue</code> æ–‡ä»¶ï¼ŒåŒæ—¶æ·»åŠ ä¸€ä¸ª<strong>ä¸è¯¥æ–‡ä»¶åŒå</strong>çš„ç›®å½•ç”¨æ¥å­˜æ”¾å­è§†å›¾ç»„ä»¶ã€‚</p><p>åˆ«å¿˜äº†åœ¨çˆ¶çº§ <code>Vue</code> æ–‡ä»¶å†…å¢åŠ  <code>&lt;nuxt-child/&gt;</code> ç”¨äºæ˜¾ç¤ºå­è§†å›¾å†…å®¹ã€‚</p><p>å‡è®¾æ–‡ä»¶ç»“æ„å¦‚ï¼š</p><div class="hljs"><pre><code class="hljs html">pages/--| user/-----| _id.vue-----| index.vue--| user.vue</code></pre></div><p>Nuxt.js è‡ªåŠ¨ç”Ÿæˆçš„è·¯ç”±é…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js">router: &#123;    routes: [        &#123;            path: <span class="hljs-string">'/user'</span>,            component: <span class="hljs-string">'pages/user.vue'</span>,            children: [                &#123;                    path: <span class="hljs-string">''</span>,                    component: <span class="hljs-string">'pages/user/index.vue'</span>,                    name: <span class="hljs-string">'user'</span>                &#125;,                &#123;                    path: <span class="hljs-string">':id'</span>,                    component: <span class="hljs-string">'pages/user/_id.vue'</span>,                    name: <span class="hljs-string">'user-id'</span>                &#125;            ]        &#125;    ]&#125;</code></pre></div><p>å°† <code>user.vue</code> æ–‡ä»¶åˆ›å»ºåˆ°ä¸ <code>user</code> ç›®å½•çš„çˆ¶ç›®å½•ä¸‹ï¼Œå³å’Œ <code>user</code> ç›®å½•ä¿æŒå¹³çº§ ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>        ç”¨æˆ·ç®¡ç†å¯¼èˆª        <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/user/101'"</span>&gt;</span>ç‚¹å‡»ä¿®æ”¹ID<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-child</span>/&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span>&#123;</span><span class="actionscript">    layout:<span class="hljs-string">"test"</span></span>&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><p><code>_id.vue</code> é¡µé¢å®ç°äº†å‘é¡µé¢ä¼ å…¥ <code>id</code> å‚æ•°ï¼Œé¡µé¢å†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>        ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯&#123;&#123;id&#125;&#125;    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span><span class="actionscript">    layout:<span class="hljs-string">"test"</span>,</span>    data()&#123;<span class="actionscript">        <span class="hljs-keyword">return</span>&#123;</span><span class="actionscript">            id:<span class="hljs-string">""</span></span>        &#125;    &#125;,    mounted()&#123;<span class="actionscript">        <span class="hljs-keyword">this</span>.id = <span class="hljs-keyword">this</span>.$route.params.id;</span><span class="javascript">        <span class="hljs-built_in">console</span>.log(<span class="hljs-keyword">this</span>.id)</span>    &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><p>æµ‹è¯•ï¼š<a href="http://localhost:10000/user" target="_blank" rel="noopener">http://localhost:10000/user</a></p><p><a href="https://qnoss.codeyee.com/20200704_12/image11" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image11.png" srcset="/img/loading.gif" alt="img"></a></p><p>ç‚¹å‡»ä¿®æ”¹</p><p><a href="https://qnoss.codeyee.com/20200704_12/image12" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image12.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="5-è·å–æ•°æ®"><a href="#5-è·å–æ•°æ®" class="headerlink" title="5. è·å–æ•°æ®"></a>5. è·å–æ•°æ®</h2><h3 id="1ã€asyncData"><a href="#1ã€asyncData" class="headerlink" title="1ã€asyncData"></a>1ã€asyncData</h3><p>Nuxt.js æ‰©å±•äº† <code>Vue.js</code>ï¼Œå¢åŠ äº†ä¸€ä¸ªå« <code>asyncData</code> çš„æ–¹æ³•ï¼Œ <code>asyncData</code> æ–¹æ³•ä¼šåœ¨ç»„ä»¶ï¼ˆ<strong>é™äºé¡µé¢ç»„ä»¶</strong>ï¼‰æ¯æ¬¡åŠ è½½ä¹‹å‰è¢«è°ƒç”¨ã€‚</p><p>å®ƒå¯ä»¥åœ¨æœåŠ¡ç«¯æˆ–è·¯ç”±æ›´æ–°ä¹‹å‰è¢«è°ƒç”¨ã€‚ åœ¨è¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¢«è®¾å®šä¸ºå½“å‰é¡µé¢çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä½ å¯ä»¥åˆ©ç”¨ <code>asyncData</code> æ–¹æ³•æ¥è·å–æ•°æ®ï¼Œ<code>Nuxt.js</code> ä¼šå°† <code>asyncData</code> è¿”å›çš„æ•°æ®èåˆç»„ä»¶ <code>data</code> æ–¹æ³•è¿”å›çš„æ•°æ®ä¸€å¹¶è¿”å›ç»™å½“å‰ç»„ä»¶ï¼Œä»è€Œå®ç°æœåŠ¡ç«¯æ¸²æŸ“é¡µé¢çš„æ•ˆæœã€‚</p><p>æ³¨æ„ï¼šç”±äº <code>asyncData</code> æ–¹æ³•æ˜¯åœ¨ç»„ä»¶ <strong>åˆå§‹åŒ–</strong> å‰è¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥åœ¨æ–¹æ³•å†…æ˜¯æ²¡æœ‰åŠæ³•é€šè¿‡ <code>this</code> æ¥å¼•ç”¨ç»„ä»¶çš„å®ä¾‹å¯¹è±¡ã€‚</p><p>ä¾‹å­ï¼šåœ¨ä¸Šè¾¹ä¾‹å­ä¸­çš„ <code>user/_id.vue</code> ä¸­æ·»åŠ ï¼Œé¡µé¢ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯&#123;&#123;id&#125;&#125;,åç§°ï¼š&#123;&#123;name&#125;&#125;,è¯¾ç¨‹åç§°ï¼š&#123;&#123;course&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span>&#123;</span><span class="actionscript">    layout:<span class="hljs-string">'test'</span>,</span><span class="actionscript">    <span class="hljs-comment">//æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</span></span>    asyncData()&#123;<span class="javascript">        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"asyncæ–¹æ³•"</span>)</span><span class="actionscript">        <span class="hljs-keyword">return</span> &#123;</span><span class="actionscript">            name:<span class="hljs-string">'é»‘é©¬ç¨‹åºå‘˜'</span></span>        &#125;    &#125;,    data()&#123;<span class="actionscript">        <span class="hljs-keyword">return</span> &#123;</span><span class="actionscript">            id:<span class="hljs-string">''</span>,</span><span class="actionscript">            course: <span class="hljs-string">""</span></span>        &#125;    &#125;,   methods:&#123;<span class="actionscript">      getCourse:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>&#123;</span><span class="actionscript">          <span class="hljs-keyword">this</span>.course = <span class="hljs-string">"springå®æˆ˜666"</span></span>      &#125;      &#125;,    mounted()&#123;<span class="actionscript">        <span class="hljs-keyword">this</span>.id = <span class="hljs-keyword">this</span>.$route.params.id;</span><span class="actionscript">        <span class="hljs-keyword">this</span>.getCourse();</span>    &#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><p>æ­¤æ–¹æ³•åœ¨æœåŠ¡ç«¯è¢«æ‰§è¡Œï¼Œè§‚å¯ŸæœåŠ¡ç«¯æ§åˆ¶å°æ‰“å°è¾“å‡º <strong>â€œasyncæ–¹æ³•â€</strong>ã€‚</p><p>æ­¤æ–¹æ³•è¿”å› <code>data</code> æ¨¡å‹æ•°æ®ï¼Œåœ¨æœåŠ¡ç«¯è¢«æ¸²æŸ“ï¼Œæœ€åå“åº”ç»™å‰ç«¯ï¼Œåˆ·æ–°æ­¤é¡µé¢æŸ¥çœ‹é¡µé¢æºä»£ç å¯ä»¥çœ‹åˆ° <code>name</code>æ¨¡å‹æ•°æ®å·²åœ¨é¡µé¢æºä»£ç ä¸­æ˜¾ç¤ºï¼Œè€Œ <code>course</code> å˜é‡æ˜¯åœ¨ <code>mounted</code> é’©å­å‡½æ•°ä¸­è°ƒç”¨äº† <code>getCourse</code> æ–¹æ³•å¯¹ <code>course</code> è¿›è¡Œèµ‹å€¼ï¼Œå±äºå®¢æˆ·ç«¯ä½¿ç”¨ <code>JS</code>è¿›è¡Œæ¸²æŸ“ï¼Œæ‰€ä»¥åœ¨é¡µé¢æºä»£ç ä¸­æ²¡æœ‰çœ‹åˆ° <code>course</code> å˜é‡çš„å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><a href="https://qnoss.codeyee.com/20200704_12/image13" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image13.png" srcset="/img/loading.gif" alt="img"></a></p><h3 id="2ã€async-await-æ–¹æ³•"><a href="#2ã€async-await-æ–¹æ³•" class="headerlink" title="2ã€async/await æ–¹æ³•"></a>2ã€async/await æ–¹æ³•</h3><p>ä½¿ç”¨ <code>async</code> å’Œ <code>await</code> é…åˆ <code>promise</code> ä¹Ÿå¯ä»¥å®ç°åŒæ­¥è°ƒç”¨ï¼Œ<code>nuxt.js</code> ä¸­ä½¿ç”¨ <code>async/await</code> å®ç°åŒæ­¥è°ƒç”¨æ•ˆæœã€‚</p><p>1ã€å…ˆæµ‹è¯•å¼‚æ­¥è°ƒç”¨ï¼Œå¢åŠ aã€bä¸¤ä¸ªæ–¹æ³•ï¼Œå¹¶åœ¨ <code>mounted</code> ä¸­è°ƒç”¨</p><div class="hljs"><pre><code class="hljs js">methods:&#123;    a()&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>)</span>&#123;            setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;                resolve(<span class="hljs-number">1</span>)            &#125;,<span class="hljs-number">2000</span>)        &#125;)    &#125;,        b()&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>)</span>&#123;                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;                    resolve(<span class="hljs-number">2</span>)                &#125;,<span class="hljs-number">1000</span>)            &#125;)        &#125;&#125;,    mounted()&#123;        <span class="hljs-keyword">this</span>.a().then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;            alert(res)            <span class="hljs-built_in">console</span>.log(res)        &#125;)        <span class="hljs-keyword">this</span>.b().then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;            alert(res)            <span class="hljs-built_in">console</span>.log(res)        &#125;)    &#125;</code></pre></div><p>ä»ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>a</code> æ–¹æ³•ä½¿ç”¨ <code>setTimeout</code> å»¶è¿Ÿäº†2ç§’æ‰§è¡Œï¼Œ<code>b</code> æ–¹æ³•å»¶è¿Ÿäº†1ç§’ï¼Œå¦‚æœæŒ‰åŒæ­¥é¡ºåºè¿›è¡Œæ‰§è¡Œï¼Œåº”è¯¥è¿˜æ˜¯å…ˆè¾“å‡º <code>a</code> æ–¹æ³•çš„å†…å®¹å†è¾“å‡º <code>b</code> æ–¹æ³•ã€‚</p><p>è§‚å¯Ÿå®¢æˆ·ç«¯ï¼Œå¹¶æ²¡æœ‰æŒ‰ç…§æ–¹æ³•æ‰§è¡Œçš„é¡ºåºè¾“å‡ºï¼Œä½¿ç”¨ <code>Promise</code> å®ç°äº†å¼‚æ­¥è°ƒç”¨ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹å›¾</p><p><a href="https://qnoss.codeyee.com/20200704_12/image14" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image14.png" srcset="/img/loading.gif" alt="img"></a></p><p>2ã€ä½¿ç”¨ <code>async/await</code> å®ŒæˆåŒæ­¥è°ƒç”¨</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">async</span> asyncData(&#123; store, route &#125;) &#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"asyncæ–¹æ³•"</span>)    <span class="hljs-keyword">var</span> a = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>&#123;        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"1"</span>)            resolve(<span class="hljs-number">1</span>)        &#125;,<span class="hljs-number">2000</span>)    &#125;);    <span class="hljs-keyword">var</span> a = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) </span>&#123;        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"2"</span>)            resolve(<span class="hljs-number">2</span>)        &#125;,<span class="hljs-number">1000</span>)    &#125;);    <span class="hljs-keyword">return</span> &#123;        name:<span class="hljs-string">'é»‘é©¬ç¨‹åºå‘˜'</span>    &#125;&#125;,</code></pre></div><p>è¿™é‡Œæˆ‘ä»¬åœ¨ <code>asyncData</code> æ–¹æ³•å‰é¢å¢åŠ äº† <code>async</code> å…³é”®å­—ï¼Œåœ¨è°ƒç”¨ <code>Promise</code> å‰ä¹Ÿå¢åŠ äº† <code>await</code> , è§‚å¯ŸæœåŠ¡ç«¯æ§åˆ¶å°å‘ç°æ˜¯æŒ‰ç…§ <code>aã€b</code> æ–¹æ³•çš„è°ƒç”¨é¡ºåºè¾“å‡º 1ã€2ï¼Œå®ç°äº†ä½¿ç”¨ <code>async/await</code> å®ŒæˆåŒæ­¥è°ƒç”¨ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_12/image15" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image15.png" srcset="/img/loading.gif" alt="img"></a></p><h1 id="å››ã€æœç´¢æœåŠ¡å‰ç«¯å¼€å‘"><a href="#å››ã€æœç´¢æœåŠ¡å‰ç«¯å¼€å‘" class="headerlink" title="å››ã€æœç´¢æœåŠ¡å‰ç«¯å¼€å‘"></a>å››ã€æœç´¢æœåŠ¡å‰ç«¯å¼€å‘</h1><h2 id="1-æœç´¢é¡µé¢"><a href="#1-æœç´¢é¡µé¢" class="headerlink" title="1. æœç´¢é¡µé¢"></a>1. æœç´¢é¡µé¢</h2><h3 id="1ã€éœ€æ±‚åˆ†æ"><a href="#1ã€éœ€æ±‚åˆ†æ" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h3><p><a href="https://qnoss.codeyee.com/20200704_12/image16" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image16.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä¸Šå›¾æ˜¯è¯¾ç¨‹æœç´¢å‰ç«¯çš„ç•Œé¢ï¼Œç”¨æˆ·é€šè¿‡å‰ç«¯å‘æœåŠ¡ç«¯å‘èµ·æœç´¢è¯·æ±‚ï¼Œæœç´¢åŠŸèƒ½åŒ…æ‹¬ï¼š</p><p>1ã€ç•Œé¢é»˜è®¤æŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹ï¼Œå¹¶åˆ†é¡µæ˜¾ç¤º</p><p>2ã€é€šè¿‡ä¸€çº§åˆ†ç±»å’ŒäºŒåˆ†ç±»æœç´¢è¯¾ç¨‹ï¼Œé€‰æ‹©ä¸€çº§åˆ†ç±»åå°†æ˜¾ç¤ºä¸‹å±çš„äºŒçº§åˆ†ç±»</p><p>3ã€é€šè¿‡å…³é”®å­—æœç´¢è¯¾ç¨‹</p><p>4ã€é€šè¿‡è¯¾ç¨‹ç­‰çº§æœç´¢è¯¾ç¨‹</p><h3 id="2ã€é¡µé¢å¸ƒå±€"><a href="#2ã€é¡µé¢å¸ƒå±€" class="headerlink" title="2ã€é¡µé¢å¸ƒå±€"></a>2ã€é¡µé¢å¸ƒå±€</h3><p><code>nuxt.js</code> å°† <code>/layout/default.vue</code> ä½œä¸ºæ‰€æœ‰é¡µé¢çš„é»˜è®¤å¸ƒå±€ï¼Œé€šå¸¸å¸ƒå±€åŒ…æ‹¬ï¼šé¡µå¤´ã€å†…å®¹åŒºã€é¡µå°¾</p><p><code>default.vue</code> å†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">nuxt</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">Footer</span> /&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">    <span class="hljs-keyword">import</span> Footer <span class="hljs-keyword">from</span> <span class="hljs-string">'../components/Footer.vue'</span></span><span class="javascript">    <span class="hljs-keyword">import</span> Header <span class="hljs-keyword">from</span> <span class="hljs-string">'../components/Header.vue'</span></span><span class="javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span>        components: &#123;            Header,            Footer        &#125;    &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><h3 id="3ã€Nginxä»£ç†é…ç½®"><a href="#3ã€Nginxä»£ç†é…ç½®" class="headerlink" title="3ã€Nginxä»£ç†é…ç½®"></a>3ã€Nginxä»£ç†é…ç½®</h3><p>æœç´¢é¡µé¢ä¸­ä»¥ <code>/static</code> å¼€å¤´çš„é™æ€èµ„æºé€šè¿‡ <code>nginx</code> è§£æï¼Œå¦‚ä¸‹ï¼š</p><p><code>/static/plugins</code>ï¼šæŒ‡å‘é—¨æˆ·ç›®å½•ä¸‹çš„ <code>plugins</code> ç›®å½•ã€‚</p><p><code>/static/css</code>ï¼šæŒ‡å‘é—¨æˆ·ç›®å½•ä¸‹çš„çš„ <code>css</code> ç›®å½•</p><p>ä¿®æ”¹ <code>Nginx</code> ä¸­ <a href="http://www.xuecheng.com/" target="_blank" rel="noopener">www.xuecheng.com</a> è™šæ‹Ÿä¸»æœºçš„é…ç½®ï¼š</p><blockquote><p>åœ¨ä¹‹å‰çš„ç« èŠ‚å½“ä¸­å¦‚æœå·²ç»é…ç½®äº†é™æ€èµ„æºè™šæ‹Ÿä¸»æœºï¼Œå¯ä»¥å¿½ç•¥è¿™ä¸ªæ­¥éª¤</p></blockquote><div class="hljs"><pre><code class="hljs c">#é™æ€èµ„æºï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ‰€éœ€è¦çš„å›¾ç‰‡ï¼Œjsã€cssç­‰é™æ€èµ„æºlocation /<span class="hljs-keyword">static</span>/img/ &#123;    alias F:/develop/xc_portal_static/img/;    #é™æ€èµ„æºï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ‰€éœ€è¦çš„å›¾ç‰‡ï¼Œjsã€cssç­‰é™æ€èµ„æº    location /<span class="hljs-keyword">static</span>/img/ &#123;    alias F:/develop/xc_portal_static/img/;&#125; location /<span class="hljs-keyword">static</span>/css/ &#123;    alias F:/develop/xc_portal_static/css/;&#125; location /<span class="hljs-keyword">static</span>/js/ &#123;    alias F:/develop/xc_portal_static/js/;&#125; location /<span class="hljs-keyword">static</span>/plugins/ &#123;    alias F:/develop/xc_portal_static/plugins/;    add_header Access-Control-Allow-Origin http:<span class="hljs-comment">//ucenter.xuecheng.com;</span>    add_header Access-Control-Allow-Credentials <span class="hljs-literal">true</span>;    add_header Access-Control-Allow-Methods GET;&#125;</code></pre></div><p>é…ç½®æœç´¢ <code>Url</code>ï¼Œä¸‹å›¾æ˜¯ <code>Nginx</code> æœç´¢è½¬å‘æµç¨‹å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_12/image17" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_12/image17" srcset="/img/loading.gif" alt="img"></a></p><p>ç”¨æˆ·è¯·æ±‚ <code>/course/search</code>æ—¶ <code>Nginx</code> å°†è¯·æ±‚è½¬å‘åˆ° <code>nuxt.js</code> æœåŠ¡ï¼Œ<code>nginx</code> åœ¨è½¬å‘æ—¶æ ¹æ®æ¯å° <code>nuxt</code> æœåŠ¡çš„è´Ÿè½½æƒ…å†µè¿›è¡Œè½¬å‘ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚</p><p>æœ¬æ•™ç¨‹å¼€å‘ç¯å¢ƒ <code>Nuxt.js</code> æœåŠ¡å’Œ <a href="http://www.xuecheng.com/" target="_blank" rel="noopener">www.xuecheng.com</a> è™šæ‹Ÿæœºä¸»åœ¨åŒä¸€å°è®¡ç®—æœºï¼Œä½¿ç”¨åŒä¸€ä¸ª <code>nginx</code>ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs json">#å‰ç«¯é—¨æˆ·è¯¾ç¨‹æœç´¢location ^~ /course/search &#123;    proxy_pass http://dynamic_portal_server_pool;&#125; #åç«¯æœç´¢æœåŠ¡location /openapi/search/ &#123;    proxy_pass http://search_server_pool/search/;&#125;</code></pre></div><p><code>dynamic_portal_server_pool</code> é…ç½®å¦‚ä¸‹ ï¼š</p><div class="hljs"><pre><code class="hljs json">#å‰ç«¯åŠ¨æ€é—¨æˆ·upstream dynamic_portal_server_pool&#123;    server 127.0.0.1:10000 weight=10;&#125;#åå°æœç´¢æœåŠ¡ï¼ˆå…¬å¼€apiï¼‰upstream search_server_pool&#123;    server 127.0.0.1:40100 weight=10;&#125;</code></pre></div><p>å…¶å®ƒé…ç½®ï¼š</p><blockquote><p>nuxt.js ä¼šè‡ªåŠ¨è¯·æ±‚è¿™äº›ä¸€äº›å†…ç½®çš„apiï¼Œå¦‚æœä¸é…ç½®çš„è¯å‰ç«¯ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¿˜æ˜¯ç»™å®ƒæ•´ä¸Šï¼Œæš‚æ—¶ä¸éœ€è¦å»è¿½ç©¶è¿™äº›æ¥å£æ˜¯ä½•ä½œç”¨</p></blockquote><div class="hljs"><pre><code class="hljs json">#å¼€å‘ç¯å¢ƒwebpackå®šæ—¶åŠ è½½æ­¤æ–‡ä»¶location ^~ /__webpack_hmr &#123;proxy_pass http://dynamic_portal_server_pool/__webpack_hmr;&#125;#å¼€å‘ç¯å¢ƒ nuxt è®¿é—® _nuxtlocation ^~ /_nuxt/ &#123;proxy_pass http://dynamic_portal_server_pool/_nuxt/;&#125;</code></pre></div><p>åœ¨é™æ€è™šæ‹Ÿä¸»æœºä¸­æ·»åŠ ï¼š</p><div class="hljs"><pre><code class="hljs json">#åˆ†ç±»ä¿¡æ¯location /static/category/ &#123;    alias E:/Project/XueChengOnline/xcEduUI01/xuecheng/static/category/;&#125;</code></pre></div><h3 id="4ã€æœç´¢é¡µé¢"><a href="#4ã€æœç´¢é¡µé¢" class="headerlink" title="4ã€æœç´¢é¡µé¢"></a>4ã€æœç´¢é¡µé¢</h3><p>åˆ›å»ºæœç´¢é¡µé¢å¦‚ä¸‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_12/image18" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image18.png" srcset="/img/loading.gif" alt="img"></a></p><p>é¡µé¢æ–‡ä»¶å‚è€ƒï¼š<code>èµ„æ–™/search/index_1.vue</code>ï¼Œé‡è¦ä»£ç å¦‚ä¸‹ï¼š<br><code>nuxt.js</code> æ”¯æŒå®šä¹‰ <code>header</code>ï¼Œæœ¬é¡µé¢æˆ‘ä»¬åœ¨ <code>header</code> ä¸­å¼•å…¥ <code>css</code> æ ·å¼å¹¶å®šä¹‰å¤´éƒ¨ä¿¡æ¯ã€‚</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//é…ç½®æ–‡ä»¶</span><span class="hljs-keyword">let</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'~/config/sysConfig'</span>)<span class="hljs-keyword">import</span> querystring <span class="hljs-keyword">from</span> <span class="hljs-string">'querystring'</span><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> courseApi <span class="hljs-keyword">from</span> <span class="hljs-string">'~/api/course'</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;    head() &#123;        <span class="hljs-keyword">return</span> &#123;            title: <span class="hljs-string">'ä¼ æ™ºæ’­å®¢-ä¸€æ ·çš„æ•™è‚²,ä¸ä¸€æ ·çš„å“è´¨'</span>,            meta: [                &#123;<span class="hljs-attr">charset</span>: <span class="hljs-string">'utf-8'</span>&#125;,                &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">'description'</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">'ä¼ æ™ºæ’­å®¢ä¸“æ³¨ITåŸ¹è®­,JavaåŸ¹è®­,AndroidåŸ¹è®­,å®‰å“åŸ¹è®­,PHPåŸ¹è®­,C++åŸ¹è®­,ç½‘é¡µè®¾è®¡åŸ¹è®­,å¹³é¢è®¾è®¡åŸ¹è®­,UIè®¾è®¡åŸ¹è®­,ç§»åŠ¨å¼€å‘åŸ¹è®­,ç½‘ç»œè¥é”€åŸ¹è®­,webå‰ç«¯åŸ¹è®­,äº‘è®¡ç®—å¤§æ•°æ®åŸ¹è®­,å…¨æ ˆå·¥ç¨‹å¸ˆåŸ¹è®­,äº§å“ç»ç†åŸ¹è®­ã€‚'</span>&#125;,                &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">'keywords'</span>, <span class="hljs-attr">content</span>: <span class="hljs-keyword">this</span>.keywords&#125;            ],            link: [                &#123;<span class="hljs-attr">rel</span>: <span class="hljs-string">'stylesheet'</span>, <span class="hljs-attr">href</span>: <span class="hljs-string">'/static/plugins/normalize-css/normalize.css'</span>&#125;,                &#123;<span class="hljs-attr">rel</span>: <span class="hljs-string">'stylesheet'</span>, <span class="hljs-attr">href</span>: <span class="hljs-string">'/static/plugins/bootstrap/dist/css/bootstrap.css'</span>&#125;,                &#123;<span class="hljs-attr">rel</span>: <span class="hljs-string">'stylesheet'</span>, <span class="hljs-attr">href</span>: <span class="hljs-string">'/static/css/page-learing-list.css'</span>&#125;            ]        &#125;    &#125;,</code></pre></div><p>å…¶å®ƒæ•°æ®æ¨¡å‹åŠæ–¹æ³•ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="actionscript">    <span class="hljs-comment">//é…ç½®æ–‡ä»¶</span></span><span class="javascript">    <span class="hljs-keyword">let</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'~/config/sysConfig'</span>)</span><span class="javascript">    <span class="hljs-keyword">import</span> querystring <span class="hljs-keyword">from</span> <span class="hljs-string">'querystring'</span></span><span class="javascript">    <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> courseApi <span class="hljs-keyword">from</span> <span class="hljs-string">'~/api/course'</span></span><span class="javascript">    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span>        head() &#123;<span class="actionscript">            <span class="hljs-keyword">return</span> &#123;</span><span class="actionscript">                title: <span class="hljs-string">'ä¼ æ™ºæ’­å®¢-ä¸€æ ·çš„æ•™è‚²,ä¸ä¸€æ ·çš„å“è´¨'</span>,</span>                meta: [<span class="actionscript">                    &#123;charset: <span class="hljs-string">'utf-8'</span>&#125;,</span><span class="actionscript">                    &#123;name: <span class="hljs-string">'description'</span>, content: <span class="hljs-string">'ä¼ æ™ºæ’­å®¢ä¸“æ³¨ITåŸ¹è®­,JavaåŸ¹è®­,AndroidåŸ¹è®­,å®‰å“åŸ¹è®­,PHPåŸ¹</span></span>                     è®­,C++åŸ¹è®­,ç½‘é¡µè®¾è®¡åŸ¹è®­,å¹³é¢è®¾è®¡åŸ¹è®­,UIè®¾è®¡åŸ¹è®­,ç§»åŠ¨å¼€å‘åŸ¹è®­,ç½‘ç»œè¥é”€åŸ¹è®­,webå‰ç«¯åŸ¹è®­,äº‘è®¡ç®—å¤§æ•°æ®åŸ¹è®­,                     å…¨æ ˆå·¥ç¨‹å¸ˆåŸ¹è®­,äº§å“ç»ç†åŸ¹è®­ã€‚'&#125;,<span class="actionscript">                     &#123;name: <span class="hljs-string">'keywords'</span>, content: <span class="hljs-keyword">this</span>.keywords&#125;</span>                ],                link: [<span class="actionscript">                    &#123;rel: <span class="hljs-string">'stylesheet'</span>, href: <span class="hljs-string">'/static/plugins/normalize-css/normalize.css'</span>&#125;,</span><span class="actionscript">                    &#123;rel: <span class="hljs-string">'stylesheet'</span>, href: <span class="hljs-string">'/static/plugins/bootstrap/dist/css/bootstrap.css'</span>&#125;,</span><span class="actionscript">                    &#123;rel: <span class="hljs-string">'stylesheet'</span>, href: <span class="hljs-string">'/static/css/page-learing-list.css'</span>&#125;</span>                ]            &#125;        &#125;,<span class="javascript">        <span class="hljs-keyword">async</span> asyncData(&#123; store, route &#125;) &#123;</span><span class="actionscript">            <span class="hljs-keyword">return</span> &#123;</span>                courselist: &#123;&#125;,                first_category:&#123;&#125;,                second_category:&#123;&#125;,<span class="actionscript">                mt:<span class="hljs-string">''</span>,</span><span class="actionscript">                st:<span class="hljs-string">''</span>,</span><span class="actionscript">                grade:<span class="hljs-string">''</span>,</span><span class="actionscript">                keyword:<span class="hljs-string">''</span>,</span>                total:0,                imgUrl:config.imgUrl            &#125;        &#125;,        data() &#123;<span class="actionscript">            <span class="hljs-keyword">return</span> &#123;</span>                courselist: &#123;&#125;,                first_category:&#123;&#125;,                second_category:&#123;&#125;,<span class="actionscript">                mt:<span class="hljs-string">''</span>,</span><span class="actionscript">                st:<span class="hljs-string">''</span>,</span><span class="actionscript">                grade:<span class="hljs-string">''</span>,</span><span class="actionscript">                keyword:<span class="hljs-string">''</span>,</span>                imgUrl:config.imgUrl,<span class="actionscript">                total:<span class="hljs-number">0</span>,<span class="hljs-comment">//æ€»è®°å½•æ•°</span></span><span class="actionscript">                page:<span class="hljs-number">1</span>,<span class="hljs-comment">//é¡µç </span></span><span class="actionscript">                page_size:<span class="hljs-number">12</span><span class="hljs-comment">//æ¯é¡µæ˜¾ç¤ºä¸ªæ•°</span></span>            &#125;        &#125;,<span class="actionscript">        watch:&#123;<span class="hljs-comment">//è·¯ç”±å‘ç”Ÿå˜åŒ–ç«‹å³æœç´¢searchè¡¨ç¤ºsearchæ–¹æ³•</span></span><span class="actionscript">            <span class="hljs-string">'$route'</span>:<span class="hljs-string">'search'</span></span>        &#125;,        methods: &#123;<span class="actionscript">            <span class="hljs-comment">//åˆ†é¡µè§¦å‘</span></span>            handleCurrentChange(page) &#123;            &#125;,<span class="actionscript">            <span class="hljs-comment">//æœç´¢æ–¹æ³•</span></span>            search()&#123;<span class="actionscript">                <span class="hljs-comment">//åˆ·æ–°å½“å‰é¡µé¢</span></span><span class="javascript">                <span class="hljs-built_in">window</span>.location.reload();</span>            &#125;        &#125;    &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div><h3 id="5ã€æµ‹è¯•"><a href="#5ã€æµ‹è¯•" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><p>é‡å¯Nginxï¼Œè¯·æ±‚ï¼š<a href="http://www.xuecheng.com/course/search%EF%BC%8C%E9%A1%B5%E9%9D%A2%E6%95%88%E6%9E%9C%E5%A6%82%E4%B8%8B%EF%BC%9A" target="_blank" rel="noopener">http://www.xuecheng.com/course/searchï¼Œé¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š</a></p><p><a href="https://qnoss.codeyee.com/20200704_12/image19" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image19.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="2-æŸ¥çœ‹å…¨éƒ¨"><a href="#2-æŸ¥çœ‹å…¨éƒ¨" class="headerlink" title="2. æŸ¥çœ‹å…¨éƒ¨"></a>2. æŸ¥çœ‹å…¨éƒ¨</h2><h3 id="1ã€éœ€æ±‚åˆ†æ-1"><a href="#1ã€éœ€æ±‚åˆ†æ-1" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h3><p>åˆæ¬¡è¿›å…¥é¡µé¢ï¼Œæ²¡æœ‰è¾“å…¥ä»»ä½•æŸ¥è¯¢æ¡ä»¶ï¼Œé»˜è®¤æŸ¥è¯¢å…¨éƒ¨è¯¾ç¨‹ï¼Œåˆ†é¡µæ˜¾ç¤º</p><h3 id="2ã€apiæ–¹æ³•"><a href="#2ã€apiæ–¹æ³•" class="headerlink" title="2ã€apiæ–¹æ³•"></a>2ã€apiæ–¹æ³•</h3><p>åœ¨apiç›®å½•åˆ›å»ºæœ¬å·¥ç¨‹æ‰€ç”¨çš„apiæ–¹æ³•ç±»ï¼Œapiæ–¹æ³•ç±»ä½¿ç”¨äº†public.jsç­‰ä¸€äº›æŠ½å–ç±»ï¼š</p><p>/api/public.jsâ€”â€”â€”â€”-æŠ½å–axios çš„åŸºç¡€æ–¹æ³•</p><p>/api/util.jsâ€”â€”â€”â€”â€”â€“å·¥å…·ç±»</p><p>/config/sysConfig.jsâ€”-ç³»ç»Ÿé…ç½®ç±»ï¼Œé…ç½®äº†ç³»ç»Ÿå‚æ•°å˜é‡</p><p>åˆ›å»º <code>course.js</code>ï¼Œä½œä¸ºè¯¾ç¨‹ç›¸å…³ä¸šåŠ¡æ¨¡å—çš„ <code>api</code> æ–¹æ³•ç±»ã€‚</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'./public'</span><span class="hljs-keyword">import</span> qs <span class="hljs-keyword">from</span> <span class="hljs-string">'qs'</span><span class="hljs-keyword">let</span> config = <span class="hljs-built_in">require</span>(<span class="hljs-string">'~/config/sysConfig'</span>)<span class="hljs-keyword">let</span> apiURL = config.apiURL<span class="hljs-keyword">let</span> staticURL = config.staticURL<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> === <span class="hljs-string">'undefined'</span>) &#123;    apiURL = config.backApiURL    staticURL = config.backStaticURL&#125; <span class="hljs-comment">/*æœç´¢*/</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> search_course = <span class="hljs-function">(<span class="hljs-params">page,size,params</span>) =&gt;</span> &#123;    <span class="hljs-keyword">let</span> querys = qs.stringify(params);    <span class="hljs-keyword">return</span> http.requestQuickGet(apiURL+<span class="hljs-string">"/search/course/list/"</span>+page+<span class="hljs-string">"/"</span>+size+<span class="hljs-string">"?"</span>+querys);&#125;</code></pre></div><h3 id="3ã€æœç´¢æ–¹æ³•"><a href="#3ã€æœç´¢æ–¹æ³•" class="headerlink" title="3ã€æœç´¢æ–¹æ³•"></a>3ã€æœç´¢æ–¹æ³•</h3><p>å®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><p>1ã€ç”¨æˆ·è¯·æ±‚æœ¬é¡µé¢åˆ°è¾¾ <code>node.js</code></p><p>2ã€åœ¨ <code>asyncData</code> æ–¹æ³•ä¸­å‘æœåŠ¡ç«¯è¯·æ±‚æŸ¥è¯¢è¯¾ç¨‹</p><p>3ã€<code>asyncData</code> æ–¹æ³•æ‰§è¡Œå®Œæˆå¼€å§‹æœåŠ¡ç«¯æ¸²æŸ“åœ¨ <code>asyncData</code> ä¸­æ‰§è¡Œæœç´¢ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">async</span> asyncData(&#123; store, route &#125;) &#123;<span class="hljs-comment">//æœåŠ¡ç«¯è°ƒç”¨æ–¹æ³•</span>    <span class="hljs-comment">//æœç´¢è¯¾ç¨‹</span>    <span class="hljs-keyword">let</span> page = route.query.page;    <span class="hljs-keyword">if</span>(!page)&#123;        page = <span class="hljs-number">1</span>;    &#125;<span class="hljs-keyword">else</span>&#123;        page = <span class="hljs-built_in">Number</span>.parseInt(page)    &#125;     <span class="hljs-built_in">console</span>.log(page);    <span class="hljs-comment">//è¯·æ±‚æœç´¢æœåŠ¡ï¼Œæœç´¢æœåŠ¡</span>    <span class="hljs-keyword">let</span> course_data = <span class="hljs-keyword">await</span> courseApi.search_course(page,<span class="hljs-number">2</span>,route.query);    <span class="hljs-built_in">console</span>.log(course_data)    <span class="hljs-comment">//æ‹¿åˆ°æ•°æ®</span>    <span class="hljs-keyword">if</span> (course_data &amp;&amp; course_data.queryResult ) &#123;        <span class="hljs-keyword">let</span> keywords = <span class="hljs-string">''</span>        <span class="hljs-keyword">let</span> mt=<span class="hljs-string">''</span>        <span class="hljs-keyword">let</span> st=<span class="hljs-string">''</span>        <span class="hljs-keyword">let</span> grade=<span class="hljs-string">''</span>        <span class="hljs-keyword">let</span> keyword=<span class="hljs-string">''</span>        <span class="hljs-keyword">let</span> total = course_data.queryResult.total        <span class="hljs-keyword">if</span>( route.query.mt)&#123;            mt = route.query.mt        &#125;         <span class="hljs-keyword">if</span>( route.query.st)&#123;            st = route.query.st        &#125;         <span class="hljs-keyword">if</span>( route.query.grade)&#123;            grade = route.query.grade        &#125;         <span class="hljs-keyword">if</span>( route.query.keyword)&#123;            keyword = route.query.keyword        &#125;         <span class="hljs-keyword">return</span> &#123;            courselist: course_data.queryResult.list,<span class="hljs-comment">//è¯¾ç¨‹åˆ—è¡¨</span>            keywords:keywords,            mt:mt,            st:st,            grade:grade,            keyword:keyword,            page:page,            total:total,            imgUrl:config.imgUrl        &#125;    &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-comment">//æœªæ‹¿åˆ°æ•°æ®ï¼Œè¿”å›ç©ºå€¼å¯¹è±¡åˆ°å‰ç«¯</span>        <span class="hljs-keyword">return</span> &#123;            courselist: &#123;&#125;,            first_category:&#123;&#125;,            second_category:&#123;&#125;,            mt:<span class="hljs-string">''</span>,            st:<span class="hljs-string">''</span>,            grade:<span class="hljs-string">''</span>,            keyword:<span class="hljs-string">''</span>,            page:page,            total:<span class="hljs-number">0</span>,            imgUrl:config.imgUrl        &#125;    &#125;&#125;</code></pre></div><h3 id="4ã€é¡µé¢"><a href="#4ã€é¡µé¢" class="headerlink" title="4ã€é¡µé¢"></a>4ã€é¡µé¢</h3><p>åœ¨é¡µé¢ä¸­å±•ç¤ºè¯¾ç¨‹åˆ—è¡¨ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- æ¸²æŸ“è¯¾ç¨‹ä¿¡æ¯ --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"recom-item"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(course, index) in courselist"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/detail/'+course.id+'.html'"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"course.pic"</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"imgUrl+'/'+course.pic"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100%"</span> <span class="hljs-attr">alt</span> /&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/img/widget-demo1.png"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"100%"</span> <span class="hljs-attr">alt</span> /&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"course_title"</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-html</span>=<span class="hljs-string">"course.name"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"float: left"</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"course.charge == '203001'"</span>&gt;</span>å…è´¹<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"course.charge == '203002'"</span>&gt;</span>ï¿¥&#123;&#123;course.price | money&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>                <span class="hljs-comment">&lt;!-- &lt;em&gt; Â· &lt;/em&gt;--&gt;</span>                <span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>                <span class="hljs-comment">&lt;!--&lt;em&gt;1125äººåœ¨å­¦ä¹ &lt;/em&gt;--&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>æ·»åŠ åœ¨ <code>index.vue</code> é¡µé¢çš„ <code>content-list</code> èŠ‚ç‚¹ä¸‹ï¼Œå…·ä½“ä»£ç å‚è€ƒ <code>èµ„æ–™/index_2.vue</code> æ–‡ä»¶</p><p>è®¿é—®æœç´¢é¡µé¢ï¼Œ<code>nuxt.js</code> ä¼šåœ¨é¡µé¢æ¸²æŸ“ä¹‹å‰è¯·æ±‚æŸ¥è¯¢æ¥å£æ‹¿åˆ°æ•°æ®ï¼Œå¹¶åœ¨ node.js ä¸Šå®Œæˆé¡µé¢çš„æ¸²æŸ“</p><p><a href="https://qnoss.codeyee.com/20200704_12/image20" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image20.png" srcset="/img/loading.gif" alt="img"></a></p><p>æ•ˆæœé¢„è§ˆ</p><p><a href="https://qnoss.codeyee.com/20200704_12/image21" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image21.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-åˆ†é¡µæŸ¥è¯¢"><a href="#3-åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="3. åˆ†é¡µæŸ¥è¯¢"></a>3. åˆ†é¡µæŸ¥è¯¢</h2><h3 id="1ã€æœåŠ¡ç«¯ä»£ç "><a href="#1ã€æœåŠ¡ç«¯ä»£ç " class="headerlink" title="1ã€æœåŠ¡ç«¯ä»£ç "></a>1ã€æœåŠ¡ç«¯ä»£ç </h3><p>æœåŠ¡ç«¯å®ç°ä»£ç å·²åœ¨ <code>day11</code> çš„å†…å®¹ä¸­å®Œæˆï¼Œæœç´¢æœåŠ¡æ ¸å¿ƒä»£ç å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs java">...<span class="hljs-comment">//åˆ†é¡µ</span><span class="hljs-comment">//å½“å‰é¡µç </span><span class="hljs-keyword">if</span>(page&lt;=<span class="hljs-number">0</span>)&#123;page = <span class="hljs-number">1</span>;&#125; //èµ·å§‹è®°å½•ä¸‹æ ‡<span class="hljs-keyword">int</span> from = (page -<span class="hljs-number">1</span>) * size;searchSourceBuilder.from(from);searchSourceBuilder.size(size);...</code></pre></div><h3 id="2ã€å‰ç«¯ä»£ç "><a href="#2ã€å‰ç«¯ä»£ç " class="headerlink" title="2ã€å‰ç«¯ä»£ç "></a>2ã€å‰ç«¯ä»£ç </h3><p>ä½¿ç”¨ <code>Element ui</code> çš„ <code>el-pagination</code> åˆ†é¡µæ’ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"text-align: center"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">el-pagination</span></span><span class="hljs-tag">                   <span class="hljs-attr">background</span></span><span class="hljs-tag">                   <span class="hljs-attr">layout</span>=<span class="hljs-string">"prev, pager, next"</span></span><span class="hljs-tag">                   @<span class="hljs-attr">current-change</span>=<span class="hljs-string">"handleCurrentChange"</span></span><span class="hljs-tag">                   <span class="hljs-attr">:total</span>=<span class="hljs-string">"total"</span></span><span class="hljs-tag">                   <span class="hljs-attr">:page-size</span>=<span class="hljs-string">"page_size"</span></span><span class="hljs-tag">                   <span class="hljs-attr">:current-page</span>=<span class="hljs-string">"page"</span></span><span class="hljs-tag">                   <span class="hljs-attr">prev-text</span>=<span class="hljs-string">"ä¸Šä¸€é¡µ"</span></span><span class="hljs-tag">                   <span class="hljs-attr">next-text</span>=<span class="hljs-string">"ä¸‹ä¸€é¡µ"</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">el-pagination</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><p>å®šä¹‰åˆ†é¡µè§¦å‘æ–¹æ³•ï¼š</p><div class="hljs"><pre><code class="hljs js">methods:&#123;    <span class="hljs-comment">//åˆ†é¡µè§¦å‘</span>    handleCurrentChange(page) &#123;        <span class="hljs-keyword">this</span>.page = page        <span class="hljs-keyword">this</span>.$route.query.page = page        <span class="hljs-keyword">let</span> querys = querystring.stringify(<span class="hljs-keyword">this</span>.$route.query)        <span class="hljs-built_in">window</span>.location = <span class="hljs-string">'/course/search?'</span>+querys;    &#125; .        ..</code></pre></div><h2 id="4-æŒ‰åˆ†ç±»æœç´¢"><a href="#4-æŒ‰åˆ†ç±»æœç´¢" class="headerlink" title="4. æŒ‰åˆ†ç±»æœç´¢"></a>4. æŒ‰åˆ†ç±»æœç´¢</h2><h3 id="1ã€éœ€æ±‚åˆ†æ-2"><a href="#1ã€éœ€æ±‚åˆ†æ-2" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h3><p>1ï¼‰é€šè¿‡ä¸€çº§åˆ†ç±»æœç´¢</p><p>2ï¼‰é€‰æ‹©ä¸€çº§åˆ†ç±»åå°†æ˜¾ç¤ºä¸‹å±çš„äºŒçº§åˆ†ç±»</p><p>3ï¼‰é€‰æ‹©äºŒåˆ†ç±»è¿›è¡Œæœç´¢</p><p>4ï¼‰é€‰æ‹©ä¸€çº§åˆ†ç±»çš„å…¨éƒ¨åˆ™è¡¨ç¤ºæ²¡æœ‰æŒ‰ç…§åˆ†ç±»æœç´¢</p><p>5ï¼‰é€‰æ‹©ä¸€çº§åˆ†ç±»çš„å…¨éƒ¨æ—¶äºŒçº§åˆ†ç±»ä¸æ˜¾ç¤º</p><h3 id="2ã€api-æ–¹æ³•"><a href="#2ã€api-æ–¹æ³•" class="headerlink" title="2ã€api æ–¹æ³•"></a>2ã€api æ–¹æ³•</h3><p>è¯¾ç¨‹åˆ†ç±»å°†é€šè¿‡é¡µé¢é™æ€åŒ–çš„æ–¹å¼å†™å…¥é™æ€èµ„æºä¸‹ï¼Œé€šè¿‡ <code>/category/category.json</code> å¯è®¿é—®ï¼Œ</p><p>é€šè¿‡ <a href="http://www.xuecheng.com/static/category/category.json" target="_blank" rel="noopener">www.xuecheng.com/static/category/category.json</a> å³å¯è®¿é—®ã€‚</p><p><code>category.json</code> çš„å†…å®¹å¦‚ä¸‹</p><p><a href="https://qnoss.codeyee.com/20200704_12/image22" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image22.png" srcset="/img/loading.gif" alt="img"></a></p><p>æˆ‘ä»¬éœ€è¦å®šä¹‰ <code>api</code> æ–¹æ³•è·å–æ‰€æœ‰çš„åˆ†ç±»</p><p>åœ¨ <code>/api/course.js</code> ä¸­æ·»åŠ ï¼š</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/*è·å–åˆ†ç±»*/</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> sysres_category = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;<span class="hljs-keyword">return</span> http.requestQuickGet(staticURL+<span class="hljs-string">"/static/category/category.json"</span>);&#125;</code></pre></div><h3 id="3ã€åœ¨-asncData-ä¸­æŸ¥è¯¢åˆ†ç±»"><a href="#3ã€åœ¨-asncData-ä¸­æŸ¥è¯¢åˆ†ç±»" class="headerlink" title="3ã€åœ¨ asncData ä¸­æŸ¥è¯¢åˆ†ç±»"></a>3ã€åœ¨ asncData ä¸­æŸ¥è¯¢åˆ†ç±»</h3><p>è¿›å…¥æœç´¢é¡µé¢å°†é»˜è®¤æ˜¾ç¤ºæ‰€æœ‰ä¸€çº§åˆ†ç±»ï¼Œå½“å‰å¦‚æœå·²é€‰æ‹©ä¸€çº§åˆ†ç±»åˆ™è¦æ˜¾ç¤ºæ‰€æœ‰ä¸€çº§åˆ†ç±»åŠè¯¥ä¸€çº§åˆ†ç±»ä¸‹å±çš„äºŒçº§<br>åˆ†ç±»ã€‚åœ¨ <code>asyncData</code> æ–¹æ³•ä¸­å®ç°ä¸Šè¾¹çš„éœ€æ±‚ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">async</span> asyncData(&#123; store, route &#125;) &#123;    <span class="hljs-comment">//æœåŠ¡ç«¯è°ƒç”¨æ–¹æ³•</span>    <span class="hljs-comment">//æœç´¢è¯¾ç¨‹</span>    <span class="hljs-keyword">let</span> page = route.query.page;    <span class="hljs-keyword">if</span> (!page) &#123;        page = <span class="hljs-number">1</span>;    &#125; <span class="hljs-keyword">else</span> &#123;        page = <span class="hljs-built_in">Number</span>.parseInt(page);    &#125;    <span class="hljs-built_in">console</span>.log(page);    <span class="hljs-comment">//è¯·æ±‚æœç´¢æœåŠ¡ï¼Œæœç´¢æœåŠ¡</span>    <span class="hljs-keyword">let</span> course_data = <span class="hljs-keyword">await</span> courseApi.search_course(page, <span class="hljs-number">2</span>, route.query);    <span class="hljs-built_in">console</span>.log(course_data);    <span class="hljs-keyword">let</span> category_data = <span class="hljs-keyword">await</span> courseApi.sysres_category();    <span class="hljs-built_in">console</span>.log(category_data)    <span class="hljs-keyword">if</span> (course_data &amp;&amp; course_data.queryResult) &#123;        <span class="hljs-keyword">let</span> keywords = <span class="hljs-string">""</span>;        <span class="hljs-keyword">let</span> mt = <span class="hljs-string">""</span>;        <span class="hljs-keyword">let</span> st = <span class="hljs-string">""</span>;        <span class="hljs-keyword">let</span> grade = <span class="hljs-string">""</span>;        <span class="hljs-keyword">let</span> keyword = <span class="hljs-string">""</span>;        <span class="hljs-keyword">let</span> total = course_data.queryResult.total;        <span class="hljs-keyword">if</span> (route.query.mt) &#123;            mt = route.query.mt;        &#125;        <span class="hljs-keyword">if</span> (route.query.st) &#123;            st = route.query.st;        &#125;        <span class="hljs-keyword">if</span> (route.query.grade) &#123;            grade = route.query.grade;        &#125;        <span class="hljs-keyword">if</span> (route.query.keyword) &#123;            keyword = route.query.keyword;        &#125;        <span class="hljs-comment">//å…¨éƒ¨åˆ†ç±»</span>        <span class="hljs-keyword">let</span> category = category_data.category; <span class="hljs-comment">//åˆ†éƒ¨åˆ†ç±»</span>        <span class="hljs-keyword">let</span> first_category = category[<span class="hljs-number">0</span>].children; <span class="hljs-comment">//ä¸€çº§åˆ†ç±»</span>        <span class="hljs-keyword">let</span> second_category = []; <span class="hljs-comment">//äºŒçº§åˆ†ç±»</span>        <span class="hljs-comment">//éå†ä¸€çº§åˆ†ç±»</span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> first_category) &#123;            keywords += first_category[i].name + <span class="hljs-string">" "</span>;            <span class="hljs-keyword">if</span> (mt != <span class="hljs-string">""</span> &amp;&amp; mt == first_category[i].id) &#123;                <span class="hljs-comment">//å–å‡ºäºŒçº§åˆ†ç±»</span>                second_category = first_category[i].children;                <span class="hljs-comment">// console.log(second_category)</span>                <span class="hljs-keyword">break</span>;            &#125;        &#125;        <span class="hljs-keyword">return</span> &#123;            courselist: course_data.queryResult.list, <span class="hljs-comment">//è¯¾ç¨‹åˆ—è¡¨</span>            keywords: keywords,            first_category: first_category,            second_category: second_category,            mt: mt,            st: st,            grade: grade,            keyword: keyword,            page: page,            total: total,            imgUrl: config.imgUrl        &#125;;    &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">return</span> &#123;            courselist: &#123;&#125;,            first_category: &#123;&#125;,            second_category: &#123;&#125;,            mt: <span class="hljs-string">""</span>,            st: <span class="hljs-string">""</span>,            grade: <span class="hljs-string">""</span>,            keyword: <span class="hljs-string">""</span>,            page: page,            total: <span class="hljs-number">0</span>,            imgUrl: config.imgUrl        &#125;;    &#125;&#125;,</code></pre></div><h3 id="4ã€é¡µé¢-1"><a href="#4ã€é¡µé¢-1" class="headerlink" title="4ã€é¡µé¢"></a>4ã€é¡µé¢</h3><p>åœ¨é¡µé¢æ˜¾ç¤ºä¸€çº§åˆ†ç±»åŠäºŒçº§åˆ†ç±»ï¼Œéœ€è¦æ ¹æ®å½“å‰æ˜¯å¦é€‰æ‹©ä¸€çº§åˆ†ç±»ã€æ˜¯å¦é€‰æ‹©äºŒåˆ†ç±»æ˜¾ç¤ºé¡µé¢å†…å®¹ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>ä¸€çº§åˆ†ç±»ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"mt!=''"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-link"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/search?</span></span><span class="hljs-tag"><span class="hljs-string">        keyword='+keyword+'&amp;grade='+grade"</span>&gt;</span>å…¨éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"all"</span> <span class="hljs-attr">v-else</span>&gt;</span>å…¨éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"category_v in first_category"</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-link all"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/search?keyword='+keyword+'&amp;mt=' +</span></span><span class="hljs-tag"><span class="hljs-string">                                                   category_v.id"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"category_v.id == mt"</span>&gt;</span>&#123;&#123;category_v.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-link"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/search?keyword='+keyword+'&amp;mt=' +</span></span><span class="hljs-tag"><span class="hljs-string">                                               category_v.id"</span> <span class="hljs-attr">v-else</span>&gt;</span>&#123;&#123;category_v.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>    <span class="hljs-comment">&lt;!--&lt;ol&gt;</span><span class="hljs-comment">    &lt;li&gt;æ•°æ®åˆ†æ&lt;/li&gt;</span><span class="hljs-comment">    &lt;li&gt;æœºå™¨å­¦ä¹ å·¥ç¨‹&lt;/li&gt;</span><span class="hljs-comment">    &lt;li&gt;å‰ç«¯å¼€å‘å·¥ç¨‹&lt;/li&gt;</span><span class="hljs-comment">    &lt;/ol&gt;--&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>äºŒçº§åˆ†ç±»ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"st!=''"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-link"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/search?</span></span><span class="hljs-tag"><span class="hljs-string">        keyword='+keyword+'&amp;mt='+mt+'&amp;grade='+grade"</span>&gt;</span>å…¨éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"all"</span> <span class="hljs-attr">v-else</span>&gt;</span>å…¨éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">ol</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"second_category.length&gt;0"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"category_v in second_category"</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-link all"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/search?keyword='+keyword+'&amp;mt='+mt+'&amp;st='</span></span><span class="hljs-tag"><span class="hljs-string">                                                   + category_v.id"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"category_v.id == st"</span>&gt;</span>&#123;&#123;category_v.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-link"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/search?keyword='+keyword+'&amp;mt='+mt+'&amp;st=' +</span></span><span class="hljs-tag"><span class="hljs-string">                                               category_v.id"</span> <span class="hljs-attr">v-else</span>&gt;</span>&#123;&#123;category_v.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>        <span class="hljs-comment">&lt;!-- &lt;li&gt;å¤§æ•°æ®&lt;/li&gt;</span><span class="hljs-comment">        &lt;li&gt;äº‘è®¡ç®—&lt;/li&gt;--&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span>    <span class="hljs-comment">&lt;!--&lt;a href="#" class="more"&gt;æ›´å¤š âˆ¨&lt;/a&gt;--&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></code></pre></div><h3 id="5ã€ç«‹å³æœç´¢"><a href="#5ã€ç«‹å³æœç´¢" class="headerlink" title="5ã€ç«‹å³æœç´¢"></a>5ã€ç«‹å³æœç´¢</h3><p>å½“ç”¨æˆ·ç‚¹å‡»åˆ†ç±»æ—¶ç«‹å³æ‰§è¡Œæœç´¢ï¼Œå®ç°æ€è·¯å¦‚ä¸‹ï¼š</p><ul><li>ç‚¹å‡»åˆ†ç±»ç«‹å³æ›´æ”¹è·¯ç”±ã€‚</li><li>é€šè¿‡ç›‘å¬è·¯ç”±ï¼Œè·¯ç”±æ›´æ”¹åˆ™åˆ·æ–°é¡µé¢ã€‚</li></ul><p>1ï¼‰åˆ›å»ºæœç´¢æ–¹æ³•</p><div class="hljs"><pre><code class="hljs js">search()&#123;<span class="hljs-comment">//åˆ·æ–°å½“å‰é¡µé¢</span><span class="hljs-built_in">window</span>.location.reload();&#125;</code></pre></div><p>2ï¼‰å®šä¹‰watch</p><p>é€šè¿‡ <code>vue.js</code> çš„ <code>watch</code> å¯ä»¥å®ç°ç›‘è§†æŸä¸ªå˜é‡ï¼Œå½“å˜é‡å€¼å‡ºç°å˜åŒ–æ—¶æ‰§è¡ŒæŸä¸ªæ–¹æ³•ã€‚</p><p>å®ç°æ€è·¯æ˜¯ï¼š</p><p>1ã€ç‚¹å‡»åˆ†ç±»é¡µé¢è·¯ç”±æ›´æ”¹</p><p>2ã€é€šè¿‡ <code>watch</code> ç›‘è§†è·¯ç”±ï¼Œè·¯ç”±æ›´æ”¹è§¦å‘ <code>search</code> æ–¹æ³•ä¸ <code>methods</code> å¹¶è¡Œå®šä¹‰ <code>watch</code>ï¼š</p><div class="hljs"><pre><code class="hljs js">watch: &#123;    <span class="hljs-comment">//è·¯ç”±å‘ç”Ÿå˜åŒ–ç«‹å³æœç´¢searchè¡¨ç¤ºsearchæ–¹æ³•</span>    $route: <span class="hljs-string">"search"</span>&#125;,</code></pre></div><h2 id="5-æŒ‰éš¾åº¦ç­‰çº§æœç´¢"><a href="#5-æŒ‰éš¾åº¦ç­‰çº§æœç´¢" class="headerlink" title="5. æŒ‰éš¾åº¦ç­‰çº§æœç´¢"></a>5. æŒ‰éš¾åº¦ç­‰çº§æœç´¢</h2><h3 id="1ã€éœ€æ±‚åˆ†æ-3"><a href="#1ã€éœ€æ±‚åˆ†æ-3" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h3><p>ç”¨æˆ·é€‰æ‹©ä¸åŒçš„è¯¾ç¨‹éš¾åº¦ç­‰çº§å»æœç´¢è¯¾ç¨‹ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_12/image23" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_12/image23" srcset="/img/loading.gif" alt="img"></a></p><h3 id="2ã€apiæ–¹æ³•-1"><a href="#2ã€apiæ–¹æ³•-1" class="headerlink" title="2ã€apiæ–¹æ³•"></a>2ã€apiæ–¹æ³•</h3><p>ä½¿ç”¨ <code>search_course</code> æ–¹æ³•å®Œæˆæœç´¢ã€‚</p><h3 id="3ã€é¡µé¢"><a href="#3ã€é¡µé¢" class="headerlink" title="3ã€é¡µé¢"></a>3ã€é¡µé¢</h3><p>æŒ‰éš¾åº¦ç­‰çº§æœç´¢æ€è·¯å¦‚ä¸‹ï¼š</p><p>1ï¼‰ç‚¹å‡»éš¾åº¦ç­‰çº§ç«‹å³æ›´æ”¹è·¯ç”±ã€‚</p><p>2ï¼‰é€šè¿‡ç›‘å¬è·¯ç”±ï¼Œè·¯ç”±æ›´æ”¹åˆ™ç«‹å³æ‰§è¡Œ <code>search</code> æœç´¢æ–¹æ³•</p><p>æŒ‰éš¾åº¦ç­‰çº§æœç´¢é¡µé¢ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>éš¾åº¦ç­‰çº§ï¼š<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"grade!=''"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-link"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/search?keyword='+keyword+'&amp;mt=' +</span></span><span class="hljs-tag"><span class="hljs-string">                                           mt+'&amp;st='+st+'&amp;grade='"</span>&gt;</span>å…¨éƒ¨            <span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"all"</span> <span class="hljs-attr">v-else</span>&gt;</span>å…¨éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">ol</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"grade=='200001'"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"all"</span>&gt;</span>åˆçº§<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-else</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-link"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/search?keyword='+keyword+'&amp;mt=' +</span></span><span class="hljs-tag"><span class="hljs-string">            mt+'&amp;st='+st+'&amp;grade=200001'"</span>&gt;</span>åˆçº§<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"grade=='200002'"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"all"</span>&gt;</span>ä¸­çº§<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-else</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-link"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/search?keyword='+keyword+'&amp;mt=' +</span></span><span class="hljs-tag"><span class="hljs-string">            mt+'&amp;st='+st+'&amp;grade=200002'"</span>&gt;</span>ä¸­çº§<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"grade=='200003'"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"all"</span>&gt;</span>é«˜çº§<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-else</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">nuxt-link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title-link"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"'/course/search?keyword='+keyword+'&amp;mt=' +</span></span><span class="hljs-tag"><span class="hljs-string">            mt+'&amp;st='+st+'&amp;grade=200003'"</span>&gt;</span>é«˜çº§<span class="hljs-tag">&lt;/<span class="hljs-name">nuxt-link</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">ol</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></code></pre></div><h2 id="6-é«˜äº®æ˜¾ç¤º"><a href="#6-é«˜äº®æ˜¾ç¤º" class="headerlink" title="6. é«˜äº®æ˜¾ç¤º"></a>6. é«˜äº®æ˜¾ç¤º</h2><h3 id="1ã€æœåŠ¡ç«¯ä»£ç -1"><a href="#1ã€æœåŠ¡ç«¯ä»£ç -1" class="headerlink" title="1ã€æœåŠ¡ç«¯ä»£ç "></a>1ã€æœåŠ¡ç«¯ä»£ç </h3><p>é«˜äº®çš„æ ¸å¿ƒä»£ç </p><div class="hljs"><pre><code class="hljs java">...   <span class="hljs-comment">//å®šä¹‰é«˜äº®</span>   HighlightBuilder highlightBuilder = <span class="hljs-keyword">new</span> HighlightBuilder();   highlightBuilder.preTags(<span class="hljs-string">"&lt;font class='eslight'&gt;"</span>);   highlightBuilder.postTags(<span class="hljs-string">"&lt;/font&gt;"</span>);   highlightBuilder.fields().add(<span class="hljs-keyword">new</span> HighlightBuilder.Field(<span class="hljs-string">"name"</span>));   searchSourceBuilder.highlighter(highlightBuilder);...   <span class="hljs-comment">//æ·»åŠ æ•°æ®</span>   <span class="hljs-keyword">for</span>(SearchHit hit:searchHits)&#123;       CoursePub coursePub = <span class="hljs-keyword">new</span> CoursePub();       <span class="hljs-comment">//æºæ–‡æ¡£</span>       Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();       <span class="hljs-comment">//è¯¾ç¨‹id</span>       String id = (String) sourceAsMap.get(<span class="hljs-string">"id"</span>);       coursePub.setId(id);       <span class="hljs-comment">//å–å‡ºname</span>       String name = (String) sourceAsMap.get(<span class="hljs-string">"name"</span>);       <span class="hljs-comment">//å–å‡ºé«˜äº®å­—æ®µ</span>       Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();       <span class="hljs-keyword">if</span>(highlightFields.get(<span class="hljs-string">"name"</span>)!=<span class="hljs-keyword">null</span>)&#123;           HighlightField highlightField = highlightFields.get(<span class="hljs-string">"name"</span>);           Text[] fragments = highlightField.fragments();           StringBuffer stringBuffer = <span class="hljs-keyword">new</span> StringBuffer();           <span class="hljs-keyword">for</span>(Text text:fragments)&#123;               stringBuffer.append(text);           &#125;            name = stringBuffer.toString();       &#125;        coursePub.setName(name);       ....   &#125;</code></pre></div><p>æ ¸å¿ƒçš„ä»£ç ä¸»è¦æ˜¯è®¾ç½® <code>HighlightBuilder</code> å¯¹è±¡çš„é«˜äº®å±æ€§ï¼Œç„¶ååœ¨éå†æ·»åŠ æ•°æ®çš„å¾ªç¯ä¸­ï¼Œåœ¨mapä¸­å–å‡º<code>name</code> å±æ€§åï¼Œå†å–å‡ºé«˜äº®å­—æ®µï¼Œå¹¶ä¸”è®¾ç½®åˆ° <code>name</code> å±æ€§ä¸­ã€‚</p><p>ä»¥ä¸‹æ˜¯æœç´¢æœåŠ¡çš„å…¨éƒ¨ä»£ç </p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.search.service;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CoursePub;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.search.CourseSearchParam;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResponseResult;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResult;<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<span class="hljs-keyword">import</span> org.elasticsearch.action.search.SearchRequest;<span class="hljs-keyword">import</span> org.elasticsearch.action.search.SearchResponse;<span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<span class="hljs-keyword">import</span> org.elasticsearch.common.text.Text;<span class="hljs-keyword">import</span> org.elasticsearch.index.query.BoolQueryBuilder;<span class="hljs-keyword">import</span> org.elasticsearch.index.query.MultiMatchQueryBuilder;<span class="hljs-keyword">import</span> org.elasticsearch.index.query.QueryBuilders;<span class="hljs-keyword">import</span> org.elasticsearch.search.SearchHit;<span class="hljs-keyword">import</span> org.elasticsearch.search.SearchHits;<span class="hljs-keyword">import</span> org.elasticsearch.search.builder.SearchSourceBuilder;<span class="hljs-keyword">import</span> org.elasticsearch.search.fetch.subphase.highlight.HighlightBuilder;<span class="hljs-keyword">import</span> org.elasticsearch.search.fetch.subphase.highlight.HighlightField;<span class="hljs-keyword">import</span> org.slf4j.Logger;<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-keyword">import</span> javax.naming.directory.SearchResult;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.ArrayList;<span class="hljs-keyword">import</span> java.util.Map;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EsCourseService</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(EsCourseService<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.elasticsearch.course.index&#125;"</span>)    <span class="hljs-keyword">private</span> String es_index;    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.elasticsearch.course.type&#125;"</span>)    <span class="hljs-keyword">private</span> String es_type;    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.elasticsearch.course.source_field&#125;"</span>)    <span class="hljs-keyword">private</span> String source_field;    <span class="hljs-meta">@Autowired</span>    RestHighLevelClient restHighLevelClient;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * è¯¾ç¨‹åˆ—è¡¨æœç´¢</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page é¡µç </span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> size æ¯é¡µæ•°é‡</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseSearchParam æœç´¢å‚æ•°</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult&lt;CoursePub&gt; <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, CourseSearchParam courseSearchParam)</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;        <span class="hljs-comment">//è®¾ç½®ç´¢å¼•</span>        SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(es_index);        <span class="hljs-comment">//è®¾ç½®ç±»å‹</span>        searchRequest.types(es_type);        <span class="hljs-comment">//åˆ›å»ºæœç´¢æºå¯¹è±¡</span>        SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();        <span class="hljs-comment">//åˆ›å»ºå¸ƒå°”æŸ¥è¯¢å¯¹è±¡</span>        BoolQueryBuilder boolQueryBuilder = <span class="hljs-keyword">new</span> BoolQueryBuilder();        <span class="hljs-comment">//æºå­—æ®µè¿‡æ»¤</span>        String[] fieldArr = source_field.split(<span class="hljs-string">","</span>);        searchSourceBuilder.fetchSource(fieldArr,<span class="hljs-keyword">new</span> String[]&#123;&#125;);        <span class="hljs-comment">//æ ¹æ®å…³é”®å­—è¿›è¡ŒæŸ¥è¯¢</span>        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getKeyword()))&#123;            <span class="hljs-comment">//åŒ¹é…å…³é”®è¯</span>            MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(courseSearchParam.getKeyword(), <span class="hljs-string">"name"</span>, <span class="hljs-string">"teachplan"</span>, <span class="hljs-string">"description"</span>);            <span class="hljs-comment">//è®¾ç½®åŒ¹é…å æ¯”</span>            multiMatchQueryBuilder.minimumShouldMatch(<span class="hljs-string">"70%"</span>);            <span class="hljs-comment">//æå‡å­—æ®µçš„æƒé‡å€¼</span>            multiMatchQueryBuilder.field(<span class="hljs-string">"name"</span>,<span class="hljs-number">10</span>);            boolQueryBuilder.must(multiMatchQueryBuilder);        &#125;        <span class="hljs-comment">//æ ¹æ®éš¾åº¦è¿›è¡Œè¿‡æ»¤</span>        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getMt()))&#123;            boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"mt"</span>,courseSearchParam.getMt()));        &#125;        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getSt()))&#123;            boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"st"</span>,courseSearchParam.getSt()));        &#125;        <span class="hljs-comment">//æ ¹æ®ç­‰çº§è¿›è¡Œè¿‡æ»¤</span>        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getGrade()))&#123;            boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"grade"</span>,courseSearchParam.getGrade()));        &#125;        <span class="hljs-comment">//è®¾ç½®åˆ†é¡µå‚æ•°</span>        <span class="hljs-keyword">if</span>(page&lt;=<span class="hljs-number">0</span>)&#123;            page = <span class="hljs-number">1</span>;        &#125;        <span class="hljs-keyword">if</span>(size&lt;=<span class="hljs-number">0</span>)&#123;            size = <span class="hljs-number">20</span>;        &#125;        <span class="hljs-comment">//è®¡ç®—æœç´¢èµ·å§‹ä½ç½®</span>        <span class="hljs-keyword">int</span> start = (page-<span class="hljs-number">1</span>) * size;        searchSourceBuilder.from(start);        searchSourceBuilder.size(size);        <span class="hljs-comment">//å°†å¸ƒå°”æŸ¥è¯¢å¯¹è±¡æ·»åŠ åˆ°æœç´¢æºå†…</span>        searchSourceBuilder.query(boolQueryBuilder);        <span class="hljs-comment">//é…ç½®é«˜äº®ä¿¡æ¯</span>        HighlightBuilder highlightBuilder = <span class="hljs-keyword">new</span> HighlightBuilder();        highlightBuilder.preTags(<span class="hljs-string">"&lt;font class='eslight'&gt;"</span>);        highlightBuilder.postTags(<span class="hljs-string">"&lt;/font&gt;"</span>);        <span class="hljs-comment">//è®¾ç½®é«˜äº®å­—æ®µ</span>        highlightBuilder.fields().add(<span class="hljs-keyword">new</span> HighlightBuilder.Field(<span class="hljs-string">"name"</span>));        searchSourceBuilder.highlighter(highlightBuilder);        <span class="hljs-comment">//è¯·æ±‚æœç´¢</span>        searchRequest.source(searchSourceBuilder);        SearchResponse searchResponse = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span>&#123;            searchResponse = restHighLevelClient.search(searchRequest);        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;            <span class="hljs-comment">//æœç´¢å¼‚å¸¸</span>            e.printStackTrace();            LOGGER.error(<span class="hljs-string">"search error ...&#123;&#125;"</span>,e.getMessage());            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult&lt;&gt;(CommonCode.FAIL,<span class="hljs-keyword">null</span>);        &#125;        <span class="hljs-comment">//ç»“æœæ”¶é›†å¤„ç†</span>        SearchHits hits = searchResponse.getHits();        <span class="hljs-comment">//è·å–åŒ¹é…åº¦é«˜çš„ç»“æœ</span>        SearchHit[] searchHits = hits.getHits();        <span class="hljs-comment">//æ€»è®°å½•æ•°</span>        <span class="hljs-keyword">long</span> totalHits = hits.getTotalHits();        <span class="hljs-comment">//æ•°æ®åˆ—è¡¨</span>        ArrayList&lt;CoursePub&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        <span class="hljs-comment">//æ·»åŠ æ•°æ®</span>        <span class="hljs-keyword">for</span> (SearchHit hit: searchHits)&#123;            CoursePub coursePub = <span class="hljs-keyword">new</span> CoursePub();            Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();            <span class="hljs-comment">//å–å‡ºid</span>            String id = (String) sourceAsMap.get(<span class="hljs-string">"id"</span>);            coursePub.setId(id);            <span class="hljs-comment">//å–å‡ºåç§°</span>            String name = (String) sourceAsMap.get(<span class="hljs-string">"name"</span>);            <span class="hljs-comment">//å–å‡ºé«˜äº®å­—æ®µ</span>            Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();            <span class="hljs-keyword">if</span>(highlightFields.get(<span class="hljs-string">"name"</span>)!=<span class="hljs-keyword">null</span>)&#123;                HighlightField highlightField = highlightFields.get(<span class="hljs-string">"name"</span>);                Text[] fragments = highlightField.fragments();                StringBuffer stringBuffer = <span class="hljs-keyword">new</span> StringBuffer();                <span class="hljs-keyword">for</span>(Text text:fragments)&#123;                    stringBuffer.append(text);                &#125;                name = stringBuffer.toString();            &#125;            coursePub.setName(name);            <span class="hljs-comment">//å›¾ç‰‡</span>            String pic = (String) sourceAsMap.get(<span class="hljs-string">"pic"</span>);            coursePub.setPic(pic);            <span class="hljs-comment">//ä¼˜æƒ åçš„ä»·æ ¼</span>            Float price = <span class="hljs-keyword">null</span>;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-keyword">if</span>(sourceAsMap.get(<span class="hljs-string">"price"</span>) !=<span class="hljs-keyword">null</span>)&#123;                    price = Float.parseFloat(String.format(<span class="hljs-string">"%.3f"</span>,sourceAsMap.get(<span class="hljs-string">"price"</span>)));                &#125;            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;                e.printStackTrace();            &#125;            coursePub.setPrice(price);            <span class="hljs-comment">//ä¼˜æƒ å‰çš„ä»·æ ¼</span>            Float priceOld = <span class="hljs-keyword">null</span>;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-keyword">if</span>(sourceAsMap.get(<span class="hljs-string">"price_old"</span>) !=<span class="hljs-keyword">null</span>)&#123;                    priceOld = Float.parseFloat(String.format(<span class="hljs-string">"%.3f"</span>,sourceAsMap.get(<span class="hljs-string">"price_old"</span>)));                &#125;            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;                e.printStackTrace();            &#125;            coursePub.setPrice_old(priceOld);            list.add(coursePub);        &#125;        <span class="hljs-comment">//è¿”å›å“åº”ç»“æœ</span>        QueryResult&lt;CoursePub&gt; queryResult = <span class="hljs-keyword">new</span> QueryResult&lt;&gt;();        queryResult.setList(list);        queryResult.setTotal(totalHits);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult&lt;&gt;(CommonCode.SUCCESS,queryResult);    &#125;&#125;</code></pre></div><h3 id="2ã€å‰ç«¯ä»£ç -1"><a href="#2ã€å‰ç«¯ä»£ç -1" class="headerlink" title="2ã€å‰ç«¯ä»£ç "></a>2ã€å‰ç«¯ä»£ç </h3><p>åœ¨åç«¯çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨æ·»åŠ é«˜äº®æ ‡ç­¾æ—¶å€™å¼•ç”¨äº† <code>eslight</code> çš„æ ·å¼ï¼Œä»£ç å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs html">highlightBuilder.preTags("<span class="hljs-tag">&lt;<span class="hljs-name">font</span> <span class="hljs-attr">class</span>=<span class="hljs-string">'eslight'</span>&gt;</span>");</code></pre></div><p>æ‰€ä»¥æˆ‘ä»¬åœ¨ <code>search/index.vue</code> ä¸­å®šä¹‰ <code>eslight</code> æ ·å¼ï¼Œå®ç°å¤šé«˜äº®å­—æ®µçš„æ ·å¼æ§åˆ¶ã€‚</p><div class="hljs"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">style</span>&gt;<span class="hljs-selector-class">.eslight</span>&#123;<span class="hljs-attribute">color</span>: red;&#125; ...</code></pre></div><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨æœç´¢é—¨æˆ·å‰ç«¯ä¸‹æœç´¢å…³é”®è¯ <code>spring cloud</code></p><p><a href="https://qnoss.codeyee.com/20200704_12/image24" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image24.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä»æµ‹è¯•çš„ç»“æœä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æœç´¢çš„å…³é”®è¯æˆåŠŸçš„è¢«é«˜äº®ã€‚</p><h1 id="äº”ã€é›†æˆæµ‹è¯•"><a href="#äº”ã€é›†æˆæµ‹è¯•" class="headerlink" title="äº”ã€é›†æˆæµ‹è¯•"></a>äº”ã€é›†æˆæµ‹è¯•</h1><h2 id="1ã€éœ€æ±‚åˆ†æ-4"><a href="#1ã€éœ€æ±‚åˆ†æ-4" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h2><p>æœ¬æ¬¡é›†æˆæµ‹è¯•çš„ç›®çš„å¦‚ä¸‹ï¼š</p><p>1ã€æµ‹è¯•è¯¾ç¨‹å‘å¸ƒä¸CMSæ¥å£æ˜¯å¦æ­£å¸¸ã€‚</p><p>2ã€æµ‹è¯•è¯¾ç¨‹å‘å¸ƒä¸ESæ¥å£æ˜¯å¦æ­£å¸¸ã€‚</p><p>3ã€æµ‹è¯•è¯¾ç¨‹ä»åˆ›å»ºåˆ°å‘å¸ƒçš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p><h2 id="2ã€å‡†å¤‡ç¯å¢ƒ"><a href="#2ã€å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="2ã€å‡†å¤‡ç¯å¢ƒ"></a>2ã€å‡†å¤‡ç¯å¢ƒ</h2><p>1ã€å¯åŠ¨ MySQLã€MongoDB</p><p>2ã€å¯åŠ¨ ElasticSearchã€RabbitMQ</p><p>3ã€å¯åŠ¨ Eureka Server</p><p>4ã€å¯åŠ¨ CMSã€è¯¾ç¨‹ç®¡ç†æœåŠ¡ã€æœç´¢æœåŠ¡ã€‚</p><p>5ã€å¯åŠ¨ Nginxã€ç³»ç»Ÿç®¡ç†å‰ç«¯ã€æ•™å­¦ç®¡ç†å‰ç«¯ã€Nuxt.jsã€‚</p><h2 id="3ã€å¼€å§‹æµ‹è¯•"><a href="#3ã€å¼€å§‹æµ‹è¯•" class="headerlink" title="3ã€å¼€å§‹æµ‹è¯•"></a>3ã€å¼€å§‹æµ‹è¯•</h2><p>è¿™é‡Œæˆ‘ä»¬å‘å¸ƒä¸€ä¸ªå¤§æ•°æ®çš„æµ‹è¯•è¯¾ç¨‹</p><blockquote><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå‘å¸ƒè¯¾ç¨‹å‰éœ€è¦æ·»åŠ è¯¾ç¨‹è¥é”€å’Œè¯¾ç¨‹è®¡åˆ’ï¼Œå¦åˆ™å°†å‘å¸ƒå¤±è´¥ã€‚</p></blockquote><p><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image25.png" srcset="/img/loading.gif" alt="img"></p><p>ç‚¹å‡»è¯¾ç¨‹å‘å¸ƒ</p><p><a href="https://qnoss.codeyee.com/20200704_12/image26" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image26.png" srcset="/img/loading.gif" alt="img"></a></p><p>å‘å¸ƒæˆåŠŸï¼Œæˆ‘ä»¬åˆ° <code>coursePub</code> è¡¨ä¸Šçœ‹ä¸€ä¸‹æˆ‘ä»¬å‘å¸ƒçš„è¯¾ç¨‹ä¿¡æ¯</p><p><a href="https://i.loli.net/2020/05/09/erXkFpA6giHxLPE.png" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/erXkFpA6giHxLPE.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å‘å¸ƒçš„ä¿¡æ¯å·²ç»æˆåŠŸæ·»åŠ åˆ°äº† coursePub è¡¨å†…ï¼Œè¿™ä¸ªæ—¶å€™ç­‰å¾… <code>LogStash</code> è‡ªåŠ¨é‡‡é›†æˆ‘ä»¬è¯¾ç¨‹å‘å¸ƒçš„ä¿¡æ¯ï¼Œå¹¶æ·»åŠ åˆ° <code>Elastic Search</code> çš„ç´¢å¼•å†…ã€‚</p><p>ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬ä» <code>LogStash</code> çš„æ§åˆ¶å°ä¿¡æ¯å†…å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»é‡‡é›†äº†æˆ‘ä»¬å‘å¸ƒçš„è¯¾ç¨‹ä¿¡æ¯ï¼Œå¹¶æˆåŠŸç´¢å¼•åˆ°äº† Elastic Search</p><p><a href="https://qnoss.codeyee.com/20200704_12/image27" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image27.png" srcset="/img/loading.gif" alt="LogStashæ§åˆ¶å°"></a></p><p><a href="https://qnoss.codeyee.com/20200704_12/image27" target="_blank" rel="noopener">LogStashæ§åˆ¶å°</a></p><p><a href="https://qnoss.codeyee.com/20200704_12/image28" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image28.png" srcset="/img/loading.gif" alt="ESç´¢å¼•æ•°æ®"></a></p><p><a href="https://qnoss.codeyee.com/20200704_12/image28" target="_blank" rel="noopener">ESç´¢å¼•æ•°æ®</a></p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆ°æœç´¢çš„å‰ç«¯é—¨æˆ·ä¸Šæœç´¢æˆ‘ä»¬æœ€æ–°å‘å¸ƒçš„è¯¾ç¨‹</p><p><a href="https://qnoss.codeyee.com/20200704_12/image29" target="_blank" rel="noopener"><img src="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/image29.png" srcset="/img/loading.gif" alt="img"></a></p><p>æˆåŠŸçš„æœç´¢åˆ°äº†åˆšæ‰å‘å¸ƒçš„å¤§æ•°æ®è¯¾ç¨‹ï¼Œå¹¶ä¸”å°† â€œå¤§æ•°æ®â€ è¿™ä¸ªå…³é”®è¯è¿›è¡Œé«˜äº®å¤„ç†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Nuxt.js</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day11ï¼šåŸºäº ElasticSearch æ„å»ºæœç´¢æœåŠ¡</title>
    <link href="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/"/>
    <url>/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day11</code> çš„å†…å®¹</p><ul><li>åŸºäº <code>Java</code> å®¢æˆ·ç«¯å®ç° DSL æœç´¢</li><li>æ­å»º <code>ElasticSearch</code> é›†ç¾¤ç¯å¢ƒ</li><li>ä½¿ç”¨ <code>Logstash</code> è‡ªåŠ¨åˆ›å»º <code>ElasticSearch</code> çš„ç´¢å¼•ã€æ•°æ®æ–‡æ¡£</li><li>åŸºäº <code>ElasticSearch</code> å¼€å‘æœç´¢æœåŠ¡æ¥å£</li></ul><h1 id="ä¸€ã€æœç´¢ç®¡ç†"><a href="#ä¸€ã€æœç´¢ç®¡ç†" class="headerlink" title="ä¸€ã€æœç´¢ç®¡ç†"></a>ä¸€ã€æœç´¢ç®¡ç†</h1><h2 id="1-å‡†å¤‡ç¯å¢ƒ"><a href="#1-å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="1. å‡†å¤‡ç¯å¢ƒ"></a>1. å‡†å¤‡ç¯å¢ƒ</h2><h3 id="1ã€åˆ›å»ºæ˜ å°„"><a href="#1ã€åˆ›å»ºæ˜ å°„" class="headerlink" title="1ã€åˆ›å»ºæ˜ å°„"></a>1ã€åˆ›å»ºæ˜ å°„</h3><p>åˆ›å»º <code>xc_course</code> ç´¢å¼•åº“ï¼Œæ–¹å¼å¦‚ä¸‹</p><p>postï¼š<a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"properties"</span>: &#123;        <span class="hljs-attr">"description"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>        &#125;,        <span class="hljs-attr">"name"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>        &#125;,        <span class="hljs-attr">"pic"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,            <span class="hljs-attr">"index"</span>: <span class="hljs-literal">false</span>        &#125;,        <span class="hljs-attr">"price"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"float"</span>        &#125;,        <span class="hljs-attr">"studymodel"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"timestamp"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"</span>        &#125;    &#125;&#125;</code></pre></div><h3 id="2ã€æ’å…¥åŸå§‹æ•°æ®"><a href="#2ã€æ’å…¥åŸå§‹æ•°æ®" class="headerlink" title="2ã€æ’å…¥åŸå§‹æ•°æ®"></a>2ã€æ’å…¥åŸå§‹æ•°æ®</h3><p>å‘ <code>xc_course/doc</code> ä¸­æ’å…¥ä»¥ä¸‹ä¸‰ä¸ªæ–‡æ¡£æ•°æ®ï¼š</p><p>PUTï¼š<a href="http://localhost:9200/xc_course/doc/1" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/1</a></p><div class="hljs"><pre><code class="hljs json">&#123;     <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bootstrapå¼€å‘"</span>,    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Bootstrapæ˜¯ç”±Twitteræ¨å‡ºçš„ä¸€ä¸ªå‰å°é¡µé¢å¼€å‘æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„å¼€å‘æ¡†æ¶ï¼Œæ­¤æ¡†æ¶é›†æˆäº†å¤šç§é¡µé¢æ•ˆæœã€‚æ­¤å¼€å‘æ¡†æ¶åŒ…å«äº†å¤§é‡çš„CSSã€JSç¨‹åºä»£ç ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯ä¸æ“…é•¿é¡µé¢å¼€å‘çš„ç¨‹åºäººå‘˜ï¼‰è½»æ¾çš„å®ç°ä¸€ä¸ªä¸å—æµè§ˆå™¨é™åˆ¶çš„ç²¾ç¾ç•Œé¢æ•ˆæœã€‚"</span>,    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201002"</span>,    <span class="hljs-attr">"price"</span>:<span class="hljs-number">38.6</span>,    <span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2018-04-25 19:11:35"</span>, <span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg"</span>&#125;</code></pre></div><p>PUTï¼š<a href="http://localhost:9200/xc_course/doc/2" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/2</a></p><div class="hljs"><pre><code class="hljs json">&#123; <span class="hljs-attr">"name"</span>: <span class="hljs-string">"javaç¼–ç¨‹åŸºç¡€"</span>,<span class="hljs-attr">"description"</span>: <span class="hljs-string">"javaè¯­è¨€æ˜¯ä¸–ç•Œç¬¬ä¸€ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è½¯ä»¶å¼€å‘é¢†åŸŸä½¿ç”¨äººæ•°æœ€å¤šã€‚"</span>,<span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,<span class="hljs-attr">"price"</span>:<span class="hljs-number">68.6</span>,<span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2018-03-25 19:11:35"</span>,<span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg"</span>&#125;</code></pre></div><p>PUTï¼š<a href="http://localhost:9200/xc_course/doc/3" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/3</a></p><div class="hljs"><pre><code class="hljs json">&#123;     <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>,    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"spring åœ¨javaé¢†åŸŸéå¸¸æµè¡Œï¼Œjavaç¨‹åºå‘˜éƒ½åœ¨ç”¨ã€‚"</span>,    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,    <span class="hljs-attr">"price"</span>:<span class="hljs-number">88.6</span>,    <span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2018-02-24 19:11:35"</span>,  <span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg"</span>&#125;</code></pre></div><h3 id="3ã€ç®€å•çš„æœç´¢ä¸€ä¸‹"><a href="#3ã€ç®€å•çš„æœç´¢ä¸€ä¸‹" class="headerlink" title="3ã€ç®€å•çš„æœç´¢ä¸€ä¸‹"></a>3ã€ç®€å•çš„æœç´¢ä¸€ä¸‹</h3><p>ç®€å•æœç´¢å°±æ˜¯é€šè¿‡ <code>url</code> è¿›è¡ŒæŸ¥è¯¢ï¼Œä»¥ <code>get</code> æ–¹å¼è¯·æ±‚ <code>ES</code>ã€‚</p><p>æ ¼å¼ï¼šGET ../_search?q=â€¦..</p><blockquote><p>qï¼šæœç´¢å­—ç¬¦ä¸²ã€‚</p></blockquote><p>ä¾‹å­ï¼š?q=name:spring</p><blockquote><p>æœç´¢nameä¸­åŒ…æ‹¬springçš„æ–‡æ¡£ã€‚</p></blockquote><h2 id="2-DSL-æœç´¢"><a href="#2-DSL-æœç´¢" class="headerlink" title="2. DSL æœç´¢"></a>2. DSL æœç´¢</h2><p>DSL(Domain Specific Language) æ˜¯ <code>ES</code> æå‡ºçš„åŸºäº <code>json</code> çš„æœç´¢æ–¹å¼ï¼Œåœ¨æœç´¢æ—¶ä¼ å…¥ç‰¹å®šçš„ <code>json</code> æ ¼å¼çš„æ•°æ®æ¥å®Œæˆä¸åŒçš„æœç´¢éœ€æ±‚ã€‚</p><p><code>DSL</code> æ¯” <code>URI</code> (åœ¨urlä¼ é€’æœç´¢å‚æ•°) æœç´¢æ–¹å¼åŠŸèƒ½å¼ºå¤§ï¼Œåœ¨é¡¹ç›®ä¸­å»ºè®®ä½¿ç”¨ <code>DSL</code> æ–¹å¼æ¥å®Œæˆæœç´¢ã€‚</p><h3 id="1ã€æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£"><a href="#1ã€æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£" class="headerlink" title="1ã€æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£"></a>1ã€æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</h3><p>æŸ¥è¯¢æ‰€æœ‰ç´¢å¼•åº“çš„æ–‡æ¡£ã€‚</p><p>å‘é€ï¼špost <a href="http://localhost:9200/_search" target="_blank" rel="noopener">http://localhost:9200/_search</a></p><p>æŸ¥è¯¢æŒ‡å®šç´¢å¼•åº“ <strong>æŒ‡å®šç±»å‹</strong> ä¸‹çš„æ–‡æ¡£ã€‚ï¼ˆé€šè¿‡ä½¿ç”¨æ­¤æ–¹æ³•ï¼‰</p><p>å‘é€ï¼špost <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"query"</span>: &#123;    <span class="hljs-attr">"match_all"</span>: &#123;&#125;    &#125;,    <span class="hljs-attr">"_source"</span> : [<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>]&#125;</code></pre></div><blockquote><p>_sourceï¼š<code>source</code> æºè¿‡è™‘è®¾ç½®ï¼ŒæŒ‡å®šç»“æœä¸­æ‰€åŒ…æ‹¬çš„å­—æ®µæœ‰å“ªäº›ã€‚</p></blockquote><p>æœç´¢ç»“æœï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"took"</span>: <span class="hljs-number">9</span>,    <span class="hljs-attr">"timed_out"</span>: <span class="hljs-literal">false</span>,    <span class="hljs-attr">"_shards"</span>: &#123;        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"successful"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"skipped"</span>: <span class="hljs-number">0</span>,        <span class="hljs-attr">"failed"</span>: <span class="hljs-number">0</span>    &#125;,    <span class="hljs-attr">"hits"</span>: &#123;        <span class="hljs-attr">"total"</span>: <span class="hljs-number">3</span>,        <span class="hljs-attr">"max_score"</span>: <span class="hljs-number">1.0</span>,        <span class="hljs-attr">"hits"</span>: [            &#123;                <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,                <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"1"</span>,                <span class="hljs-attr">"_score"</span>: <span class="hljs-number">1.0</span>,                <span class="hljs-attr">"_source"</span>: &#123;                    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201002"</span>,                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bootstrapå¼€å‘"</span>                &#125;            &#125;,            &#123;                <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,                <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"2"</span>,                <span class="hljs-attr">"_score"</span>: <span class="hljs-number">1.0</span>,                <span class="hljs-attr">"_source"</span>: &#123;                    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"javaç¼–ç¨‹åŸºç¡€"</span>                &#125;            &#125;,            &#123;                <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,                <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"3"</span>,                <span class="hljs-attr">"_score"</span>: <span class="hljs-number">1.0</span>,                <span class="hljs-attr">"_source"</span>: &#123;                    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>                &#125;            &#125;        ]    &#125;&#125;</code></pre></div><p>ç»“æœè¯´æ˜ï¼š</p><table><thead><tr><th>å­—æ®µåç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>took</td><td>æœ¬æ¬¡æ“ä½œèŠ±è´¹çš„æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚</td></tr><tr><td>timed_out</td><td>è¯·æ±‚æ˜¯å¦è¶…æ—¶</td></tr><tr><td>_shards</td><td>è¯´æ˜æœ¬æ¬¡æ“ä½œå…±æœç´¢äº†å“ªäº›åˆ†ç‰‡</td></tr><tr><td>hits</td><td>æœç´¢å‘½ä¸­çš„è®°å½•</td></tr><tr><td>hits.total</td><td>ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£æ€»æ•° hits.hits ï¼šåŒ¹é…åº¦è¾ƒé«˜çš„å‰Nä¸ªæ–‡æ¡£</td></tr><tr><td>hits.max_score</td><td>æ–‡æ¡£åŒ¹é…å¾—åˆ†ï¼Œè¿™é‡Œä¸ºæœ€é«˜åˆ†</td></tr><tr><td>_score</td><td>æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªåŒ¹é…åº¦å¾—åˆ†ï¼ŒæŒ‰ç…§é™åºæ’åˆ—ã€‚</td></tr><tr><td>_source</td><td>æ˜¾ç¤ºäº†æ–‡æ¡£çš„åŸå§‹å†…å®¹ã€‚</td></tr></tbody></table><p><strong>ä½¿ç”¨JAVA å®¢æˆ·ç«¯å®ç°ï¼š</strong></p><ul><li>åˆ›å»ºæœç´¢è¯·æ±‚å¯¹è±¡</li><li>æŒ‡å®šç±»å‹ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬ä¸éœ€è¦æŒ‡å®šç±»å‹ï¼Œè¿™é‡Œä»¥ <code>6.2.1</code> ä¸ºä¾‹ï¼‰</li><li>æ„å»ºæœç´¢æºå¯¹è±¡</li><li>é…ç½®æœç´¢æ–¹å¼ï¼Œè®¾ç½®éœ€è¦è¿‡æ»¤å­—æ®µ</li><li>å‘æœç´¢è¯·æ±‚ä¸­è®¾ç½®æœç´¢æº</li><li>æ‰§è¡Œæœç´¢ï¼Œå‘ESå‘èµ· <code>http</code> è¯·æ±‚</li><li>æœç´¢ç»“æœ <code>asd as</code></li><li>åŒ¹é…åˆ°çš„æ€»è®°å½•æ•°</li><li>å¾—åˆ°åŒ¹é…åº¦é«˜çš„æ–‡æ¡£</li><li>éå†ç»“æœï¼Œè·å– <code>SearchHit</code> å¯¹è±¡ä¸­çš„å±æ€§ï¼Œè¾“å‡ºæˆ–è€…å­˜æ¡£ã€‚</li></ul><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestSearch</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    RestHighLevelClient client;    <span class="hljs-comment">//æœç´¢typeä¸‹çš„å…¨éƒ¨è®°å½•</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSearchAll</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        <span class="hljs-comment">//è·å–æœç´¢è¯·æ±‚å¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®ç±»å‹</span>        SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);        searchRequest.types(<span class="hljs-string">"doc"</span>);        SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();        <span class="hljs-comment">//è®¾ç½®æœç´¢æ–¹å¼</span>        searchSourceBuilder.query(QueryBuilders.matchAllQuery());        <span class="hljs-comment">//é…ç½®sourceæºå­—æ®µè¿‡è™‘ï¼Œ1æ˜¾ç¤ºçš„ï¼Œ2æ’é™¤çš„</span>        searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>&#125;, <span class="hljs-keyword">new</span> String[]&#123;&#125;);        <span class="hljs-comment">//å°†æœç´¢æºé…ç½®åˆ°æœç´¢è¯·æ±‚ä¸­ï¼Œæ‰§è¡Œæœç´¢ï¼Œè·å–æœç´¢å“åº”ç»“æœ</span>        searchRequest.source(searchSourceBuilder);        SearchResponse searchResponse = client.search(searchRequest);        <span class="hljs-comment">//è·å–æ‰€æœ‰æœç´¢ç»“æœã€æ€»åŒ¹é…æ•°é‡</span>        SearchHits hits = searchResponse.getHits();        <span class="hljs-keyword">long</span> totalHits = hits.getTotalHits();        <span class="hljs-comment">//ç­›é€‰å‡ºåŒ¹é…åº¦é«˜çš„æ–‡æ¡£è®°å½•</span>        SearchHit[] searchHits = hits.getHits();        <span class="hljs-comment">//éå†ç»“æœ</span>        <span class="hljs-keyword">for</span> (SearchHit hit : searchHits) &#123;            String index = hit.getIndex();            String type = hit.getType();            String id = hit.getId();            <span class="hljs-keyword">float</span> score = hit.getScore();            String sourceAsString = hit.getSourceAsString();            Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();            String name = (String) sourceAsMap.get(<span class="hljs-string">"name"</span>);            String studymodel = (String) sourceAsMap.get(<span class="hljs-string">"studymodel"</span>);            String description = (String) sourceAsMap.get(<span class="hljs-string">"description"</span>);            System.out.println(name);            System.out.println(studymodel);            System.out.println(description);        &#125;    &#125;&#125;</code></pre></div><h3 id="2ã€åˆ†é¡µæŸ¥è¯¢"><a href="#2ã€åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="2ã€åˆ†é¡µæŸ¥è¯¢"></a>2ã€åˆ†é¡µæŸ¥è¯¢</h3><p><code>ES</code> æ”¯æŒåˆ†é¡µæŸ¥è¯¢ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š<code>from</code> å’Œ <code>size</code>ã€‚</p><ul><li>formï¼šè¡¨ç¤ºèµ·å§‹æ–‡æ¡£çš„ä¸‹æ ‡ï¼Œä»0å¼€å§‹ã€‚</li><li>sizeï¼šæŸ¥è¯¢çš„æ–‡æ¡£æ•°é‡ã€‚</li></ul><p>å‘é€ï¼špost <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"from"</span> : <span class="hljs-number">0</span>,     <span class="hljs-attr">"size"</span> : <span class="hljs-number">1</span>,    <span class="hljs-attr">"query"</span>: &#123;    <span class="hljs-attr">"match_all"</span>: &#123;&#125;    &#125;,    <span class="hljs-attr">"_source"</span> : [<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>]&#125;</code></pre></div><p><strong>ä½¿ç”¨JAVA å®¢æˆ·ç«¯å®ç°ï¼š</strong></p><div class="hljs"><pre><code class="hljs java"> <span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSearchPage</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    <span class="hljs-comment">//è·å–æœç´¢è¯·æ±‚å¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®ç±»å‹</span>    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);    searchRequest.types(<span class="hljs-string">"doc"</span>);    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();    <span class="hljs-comment">//è®¾ç½®æœç´¢æ–¹å¼</span>    searchSourceBuilder.query(QueryBuilders.matchAllQuery());    <span class="hljs-comment">//ESè¿™é‡Œæ˜¯æŒ‰èµ·å§‹åæ ‡æ¥å®ç°åˆ†é¡µæŸ¥è¯¢,æ‰€ä»¥æˆ‘ä»¬è¦æŒ‡å®šä¸€ä¸ªé¡µç </span>    <span class="hljs-keyword">int</span> pageNum = <span class="hljs-number">1</span>;    <span class="hljs-keyword">int</span> size = <span class="hljs-number">2</span>;    <span class="hljs-comment">//é€šè¿‡é¡µç å’ŒæŸ¥è¯¢æ•°é‡å¾—å‡ºèµ·å§‹ä½ç½®</span>    <span class="hljs-keyword">int</span> fromNum = (pageNum - <span class="hljs-number">1</span>) * size;    <span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢ï¼Œè®¾ç½®èµ·å§‹ä¸‹æ ‡ï¼Œä»0å¼€å§‹</span>    searchSourceBuilder.from(<span class="hljs-number">0</span>);    <span class="hljs-comment">//æ¯é¡µæ˜¾ç¤ºä¸ªæ•°</span>    searchSourceBuilder.size(size);    <span class="hljs-comment">//é…ç½®sourceæºå­—æ®µè¿‡è™‘ï¼Œ1æ˜¾ç¤ºçš„ï¼Œ2æ’é™¤çš„</span>    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>&#125;, <span class="hljs-keyword">new</span> String[]&#123;&#125;);    <span class="hljs-comment">//å°†æœç´¢æºé…ç½®åˆ°æœç´¢è¯·æ±‚ä¸­ï¼Œæ‰§è¡Œæœç´¢ï¼Œè·å–æœç´¢å“åº”ç»“æœ</span>    searchRequest.source(searchSourceBuilder);    SearchResponse searchResponse = restHighLevelClient.search(searchRequest);    <span class="hljs-comment">//è·å–æ‰€æœ‰æœç´¢ç»“æœã€æ€»åŒ¹é…æ•°é‡</span>    SearchHits hits = searchResponse.getHits();    <span class="hljs-keyword">long</span> totalHits = hits.getTotalHits();    <span class="hljs-comment">//ç­›é€‰å‡ºåŒ¹é…åº¦é«˜çš„æ–‡æ¡£è®°å½•</span>    SearchHit[] searchHits = hits.getHits();    <span class="hljs-comment">//éå†ç»“æœ</span>    <span class="hljs-keyword">for</span>(SearchHit hit : searchHits)&#123;        System.out.println(hit.toString());    &#125;&#125;</code></pre></div><h3 id="3ã€Term-Query"><a href="#3ã€Term-Query" class="headerlink" title="3ã€Term Query"></a>3ã€Term Query</h3><p><code>Term Query</code> ä¸ºç²¾ç¡®æŸ¥è¯¢ï¼Œåœ¨æœç´¢æ—¶ä¼šæ•´ä½“åŒ¹é…å…³é”®å­—ï¼Œä¸å†å°†å…³é”®å­—åˆ†è¯ã€‚</p><p>å‘é€ï¼špost <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"query"</span>: &#123;        <span class="hljs-attr">"term"</span> : &#123;            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"spring"</span>        &#125;    &#125;,    <span class="hljs-attr">"_source"</span> : [<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>]&#125;</code></pre></div><p>ä¸Šè¾¹çš„æœç´¢ä¼šæŸ¥è¯¢ <code>name</code> åŒ…æ‹¬ <code>spring</code> è¿™ä¸ªè¯çš„æ–‡æ¡£ã€‚</p><p><strong>JAVAå®¢æˆ·ç«¯å®ç°ï¼š</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">     * Term Query ç²¾ç¡®æŸ¥è¯¢</span><span class="hljs-comment">     */</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TestSearchTermQuery</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);    searchRequest.types(<span class="hljs-string">"doc"</span>);    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();    <span class="hljs-comment">//è®¾ç½®æŸ¥è¯¢ç±»å‹ä¸ºtermQuery,ç²¾ç¡®åŒ¹é…nameä¸­åŒ…å«springçš„æ–‡æ¡£</span>    searchSourceBuilder.query(QueryBuilders.termQuery(<span class="hljs-string">"name"</span>,<span class="hljs-string">"spring"</span>));<span class="hljs-comment">//sourceæºå­—æ®µè¿‡è™‘</span>    <span class="hljs-comment">//ä¸æŒ‡å®šè¿‡æ»¤æ¡ä»¶åˆ™é»˜è®¤æ˜¾ç¤ºæŸ¥è¯¢åˆ°çš„æ–‡æ¡£çš„æ‰€æœ‰å­—æ®µ</span>    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;&#125;, <span class="hljs-keyword">new</span> String[]&#123;&#125;);    <span class="hljs-comment">//è®¾ç½®æœç´¢æºå¹¶è·å–æœç´¢ç»“æœ</span>    searchRequest.source(searchSourceBuilder);    SearchResponse searchResponse = restHighLevelClient.search(searchRequest);    <span class="hljs-comment">//è·å–æœç´¢ç»“æœ</span>    <span class="hljs-comment">//  .getHits() å–æœ¬æ¬¡æ‰€æœ‰åŒ¹é…ç»“æœ</span>    <span class="hljs-comment">//  .getHits().getHits() ç­›é€‰å‡ºåŒ¹é…åº¦é«˜çš„æ–‡æ¡£è®°å½•</span>    SearchHits hits = searchResponse.getHits();    <span class="hljs-keyword">long</span> totalHits = hits.getTotalHits();    <span class="hljs-comment">//ç­›é€‰åŒ¹é…åº¦æœ€é«˜çš„ç»“æœ</span>    SearchHit[] searchHits = hits.getHits();    System.out.println(<span class="hljs-string">"ç»“æœæ•°é‡ä¸º: "</span> + totalHits);    <span class="hljs-comment">//è¾“å‡ºæœç´¢ç»“æœ</span>    <span class="hljs-keyword">for</span>(SearchHit hit : searchHits)&#123;        System.out.println(hit.getSourceAsMap());    &#125;&#125;</code></pre></div><h3 id="4ã€æ ¹æ®idç²¾ç¡®åŒ¹é…"><a href="#4ã€æ ¹æ®idç²¾ç¡®åŒ¹é…" class="headerlink" title="4ã€æ ¹æ®idç²¾ç¡®åŒ¹é…"></a>4ã€æ ¹æ®idç²¾ç¡®åŒ¹é…</h3><p>ESæä¾›æ ¹æ®å¤šä¸ªidå€¼åŒ¹é…çš„æ–¹æ³•ï¼š</p><p>postï¼š <a href="http://127.0.0.1:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/xc_course/doc/_search</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"query"</span>: &#123;        <span class="hljs-attr">"ids"</span> : &#123;            <span class="hljs-attr">"type"</span> : <span class="hljs-string">"doc"</span>,            <span class="hljs-attr">"values"</span> : [<span class="hljs-string">"3"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"100"</span>]        &#125;    &#125;&#125;</code></pre></div><p><strong>JAVAå®¢æˆ·ç«¯å®ç°ï¼š</strong></p><div class="hljs"><pre><code class="hljs java">String[] split = <span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"1"</span>,<span class="hljs-string">"2"</span>&#125;;List&lt;String&gt; idList = Arrays.asList(split);searchSourceBuilder.query(QueryBuilders.termsQuery(<span class="hljs-string">"_id"</span>, idList));</code></pre></div><h3 id="5ã€match-query-åŒ¹é…å•ä¸ªå­—æ®µ"><a href="#5ã€match-query-åŒ¹é…å•ä¸ªå­—æ®µ" class="headerlink" title="5ã€match query (åŒ¹é…å•ä¸ªå­—æ®µ)"></a>5ã€match query (åŒ¹é…å•ä¸ªå­—æ®µ)</h3><h4 id="1-åŸºæœ¬ä½¿ç”¨"><a href="#1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="(1) åŸºæœ¬ä½¿ç”¨"></a>(1) åŸºæœ¬ä½¿ç”¨</h4><p><code>match query</code> å³å…¨æ–‡æ£€ç´¢ï¼Œå®ƒçš„æœç´¢æ–¹å¼æ˜¯å…ˆå°†æœç´¢å­—ç¬¦ä¸²åˆ†è¯ï¼Œå†ä½¿ç”¨å„å„è¯æ¡ä»ç´¢å¼•ä¸­æœç´¢ã€‚</p><p><code>match query</code> ä¸ <code>Term query</code> åŒºåˆ«æ˜¯ <code>match query</code> åœ¨æœç´¢å‰å…ˆå°†æœç´¢å…³é”®å­—åˆ†è¯ï¼Œå†æ‹¿å„å„è¯è¯­å»ç´¢å¼•ä¸­æœç´¢ã€‚</p><p>éœ€æ±‚ï¼šæ£€ç´¢ <code>name</code> å­—æ®µä¸­åŒ…å« springå¼€å‘ çš„æ–‡æ¡£ï¼Œå¹¶ä¸”ç»“æœåªæ˜¾ç¤ºè¯¥æ–‡æ¡£çš„ name å­—æ®µ</p><p>å‘é€ï¼špost <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"query"</span>: &#123;        <span class="hljs-attr">"match"</span>: &#123;            <span class="hljs-attr">"name"</span>: &#123;                <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springå¼€å‘"</span>,                <span class="hljs-attr">"operator"</span>: <span class="hljs-string">"or"</span>            &#125;        &#125;    &#125;,<span class="hljs-attr">"_source"</span> : [<span class="hljs-string">"name"</span>]&#125;</code></pre></div><ul><li>queryï¼šæœç´¢çš„å…³é”®å­—ï¼Œå¯¹äºè‹±æ–‡å…³é”®å­—å¦‚æœæœ‰å¤šä¸ªå•è¯åˆ™ä¸­é—´è¦ç”¨åŠè§’é€—å·åˆ†éš”ï¼Œè€Œå¯¹äºä¸­æ–‡å…³é”®å­—ä¸­é—´å¯ä»¥ç”¨é€—å·åˆ†éš”ä¹Ÿå¯ä»¥ä¸ç”¨ã€‚</li><li>operatorï¼š<code>or</code> è¡¨ç¤º åªè¦æœ‰ä¸€ä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°åˆ™å°±ç¬¦åˆæ¡ä»¶, <code>and</code> è¡¨ç¤ºæ¯ä¸ªè¯éƒ½åœ¨æ–‡æ¡£ä¸­å‡ºç°åˆ™æ‰ç¬¦åˆæ¡ä»¶</li></ul><p><strong>operator</strong>ï¼š<code>or</code> è¡¨ç¤º åªè¦æœ‰ä¸€ä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°åˆ™å°±ç¬¦åˆæ¡ä»¶, <code>and</code> è¡¨ç¤ºæ¯ä¸ªè¯éƒ½åœ¨æ–‡æ¡£ä¸­å‡ºç°åˆ™æ‰ç¬¦åˆæ¡ä»¶</p><p>æœç´¢ç»“æœï¼š</p><div class="hljs"><pre><code class="hljs json">"hits": [    &#123;        <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,        <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"3"</span>,        <span class="hljs-attr">"_score"</span>: <span class="hljs-number">1.3802519</span>,        <span class="hljs-attr">"_source"</span>: &#123;            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>        &#125;    &#125;,    &#123;        <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,        <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"1"</span>,        <span class="hljs-attr">"_score"</span>: <span class="hljs-number">0.52354836</span>,        <span class="hljs-attr">"_source"</span>: &#123;            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bootstrapå¼€å‘"</span>        &#125;    &#125;]</code></pre></div><p>ä¸Šè¾¹çš„æœç´¢çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ï¼š</p><p>1ã€å°† <code>springå¼€å‘</code> åˆ†è¯ï¼Œåˆ†ä¸º <code>spring</code>ã€<code>å¼€å‘</code> ä¸¤ä¸ªè¯</p><p>2ã€å†ä½¿ç”¨ <code>spring</code> å’Œå¼€å‘ä¸¤ä¸ªè¯å»åŒ¹é…ç´¢å¼•ä¸­æœç´¢ã€‚</p><p>3ã€ç”±äºè®¾ç½®äº† <code>operator</code> ä¸º <code>or</code>ï¼Œåªè¦æœ‰ä¸€ä¸ªè¯åŒ¹é…æˆåŠŸåˆ™å°±è¿”å›è¯¥æ–‡æ¡£ã€‚</p><p>æˆ‘ä»¬å°† operator è®¾ç½®ä¸º <code>and</code> å†æ¬¡è¿›è¡Œæœç´¢</p><div class="hljs"><pre><code class="hljs json">"hits": [    &#123;        <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,        <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"3"</span>,        <span class="hljs-attr">"_score"</span>: <span class="hljs-number">1.3802519</span>,        <span class="hljs-attr">"_source"</span>: &#123;            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>        &#125;    &#125;]</code></pre></div><p>ä»ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ <code>and</code> è¿›è¡Œæœç´¢åï¼ŒESä¼šåŒ¹é…æŒ‡å®šçš„å­—æ®µåŒ…å« <code>spring</code>ã€<code>å¼€å‘</code> ä¸¤ä¸ªè¯çš„ç»“æœã€‚</p><p><strong>JAVAå®¢æˆ·ç«¯å®ç°ï¼š</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">     * æ ¹æ®å…³é”®å­—æœç´¢</span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">     */</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testMatchQuery</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);    searchRequest.types(<span class="hljs-string">"doc"</span>);    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();    <span class="hljs-comment">//sourceæºå­—æ®µè¿‡è™‘</span>    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>&#125;, <span class="hljs-keyword">new</span> String[]&#123;&#125;);    <span class="hljs-comment">//è®¾ç½®è¿‡æ»¤å™¨ï¼ŒåŒ¹é…å…³é”®å­—</span>    searchSourceBuilder.query(QueryBuilders.matchQuery(<span class="hljs-string">"description"</span>, <span class="hljs-string">"springå¼€å‘"</span>).operator(Operator.OR));    searchRequest.source(searchSourceBuilder);    <span class="hljs-comment">//æ‰§è¡Œæœç´¢è¯·æ±‚</span>    SearchResponse searchResponse = client.search(searchRequest);    SearchHits hits = searchResponse.getHits();    SearchHit[] searchHits = hits.getHits();    <span class="hljs-comment">//è¾“å‡ºæœç´¢ç»“æœ</span>    <span class="hljs-keyword">for</span>(SearchHit hit : searchHits)&#123;        System.out.println(hit.getSourceAsMap());    &#125;&#125;</code></pre></div><h4 id="2-minimum-should-match"><a href="#2-minimum-should-match" class="headerlink" title="(2) minimum_should_match"></a>(2) minimum_should_match</h4><p>ä¸Šè¾¹ä½¿ç”¨çš„ <code>operator = or</code> è¡¨ç¤ºåªè¦æœ‰ä¸€ä¸ªè¯åŒ¹é…ä¸Šå°±å¾—åˆ†ï¼Œå¦‚æœå®ç°ä¸‰ä¸ªè¯è‡³å°‘æœ‰ä¸¤ä¸ªè¯åŒ¹é…å¦‚ä½•å®ç°ï¼Ÿä½¿ç”¨ <code>minimum_should_match</code> å¯ä»¥æŒ‡å®šæ–‡æ¡£åŒ¹é…è¯çš„å æ¯”ï¼š</p><p>æ¯”å¦‚æœç´¢è¯­å¥å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"query"</span>: &#123;        <span class="hljs-attr">"match"</span>: &#123;            <span class="hljs-attr">"description"</span>: &#123;                <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springå¼€å‘æ¡†æ¶"</span>,                <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"80%"</span>            &#125;        &#125;    &#125;&#125;</code></pre></div><p><code>springå¼€å‘æ¡†æ¶</code> ä¼šè¢«åˆ†ä¸ºä¸‰ä¸ªè¯ï¼š<code>spring</code>ã€<code>å¼€å‘</code>ã€<code>æ¡†æ¶</code></p><p>è®¾ç½® <code>minimum_should_match:80%</code> è¡¨ç¤ºï¼Œä¸‰ä¸ªè¯åœ¨æ–‡æ¡£çš„åŒ¹é…å æ¯”ä¸º <strong>80%</strong>ï¼Œå³ 3<em>0.8=2.4ï¼Œå‘ä¸Šå–æ•´å¾—2ï¼Œè¡¨ç¤ºè‡³å°‘æœ‰ *</em>ä¸¤ä¸ªè¯** åœ¨æ–‡æ¡£ä¸­è¦åŒ¹é…æˆåŠŸã€‚</p><p>å¯¹åº”çš„ <code>RestClient</code> å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åŒ¹é…å…³é”®å­—</span>MatchQueryBuilder matchQueryBuilder = QueryBuilders.matchQuery(<span class="hljs-string">"description"</span>, <span class="hljs-string">"å‰å°é¡µé¢å¼€å‘æ¡†æ¶ æ¶æ„"</span>).minimumShouldMatch(<span class="hljs-string">"80%"</span>);<span class="hljs-comment">//è®¾ç½®åŒ¹é…å æ¯”</span>searchSourceBuilder.query(matchQueryBuilder);</code></pre></div><h3 id="6ã€multi-query-åŒ¹é…å¤šä¸ªå­—æ®µ"><a href="#6ã€multi-query-åŒ¹é…å¤šä¸ªå­—æ®µ" class="headerlink" title="6ã€multi query (åŒ¹é…å¤šä¸ªå­—æ®µ)"></a>6ã€multi query (åŒ¹é…å¤šä¸ªå­—æ®µ)</h3><p>ä¸Šè¾¹å­¦ä¹ çš„ <code>termQuery</code> å’Œ <code>matchQuery</code> ä¸€æ¬¡åªèƒ½åŒ¹é…ä¸€ä¸ª <code>Field</code>ï¼Œæœ¬èŠ‚å­¦ä¹  <code>multiQuery</code>ï¼Œä¸€æ¬¡å¯ä»¥åŒ¹é…å¤šä¸ªå­—æ®µã€‚</p><h4 id="1-åŸºæœ¬ä½¿ç”¨-1"><a href="#1-åŸºæœ¬ä½¿ç”¨-1" class="headerlink" title="(1) åŸºæœ¬ä½¿ç”¨"></a>(1) åŸºæœ¬ä½¿ç”¨</h4><p>å•é¡¹åŒ¹é…æ˜¯åœ¨ä¸€ä¸ª <code>field</code> ä¸­å»åŒ¹é…ï¼Œå¤šé¡¹åŒ¹é…æ˜¯æ‹¿å…³é”®å­—å»å¤šä¸ª <code>Field</code> ä¸­åŒ¹é…ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p><p>å‘é€ï¼špost <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p><p>æ‹¿å…³é”®å­— <code>spring css</code>å»åŒ¹é… <code>name</code> å’Œ <code>description</code> å­—æ®µã€‚</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"query"</span>: &#123;        <span class="hljs-attr">"multi_match"</span>: &#123;            <span class="hljs-attr">"query"</span>: <span class="hljs-string">"spring css"</span>,            <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"50%"</span>,            <span class="hljs-attr">"fields"</span>: [                <span class="hljs-string">"name"</span>,                <span class="hljs-string">"description"</span>            ]        &#125;    &#125;&#125;</code></pre></div><h4 id="2-æå‡-boost-æƒé‡"><a href="#2-æå‡-boost-æƒé‡" class="headerlink" title="(2) æå‡ boost (æƒé‡)"></a>(2) æå‡ boost (æƒé‡)</h4><p>åŒ¹é…å¤šä¸ªå­—æ®µæ—¶å¯ä»¥æå‡å­—æ®µçš„ <code>boost</code>ï¼ˆæƒé‡ï¼‰æ¥æé«˜å¾—åˆ†</p><p>ä¾‹å­ï¼šæå‡ <code>boost</code>ä¹‹å‰ï¼Œæ‰§è¡Œä¸‹è¾¹çš„æŸ¥è¯¢ï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"query"</span>: &#123;        <span class="hljs-attr">"multi_match"</span>: &#123;            <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springæ¡†æ¶"</span>,            <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"50%"</span>,            <span class="hljs-attr">"fields"</span>: [                <span class="hljs-string">"name"</span>,                <span class="hljs-string">"description"</span>            ]        &#125;    &#125;&#125;</code></pre></div><p>é€šè¿‡æŸ¥è¯¢å‘ç° <code>Bootstrap</code> æ’åœ¨å‰è¾¹ã€‚</p><p>æå‡ <code>boost</code>ï¼Œé€šå¸¸å…³é”®å­—åŒ¹é…ä¸Š <code>name</code> çš„æƒé‡è¦æ¯”åŒ¹é…ä¸Š <code>description</code> çš„æƒé‡é«˜ï¼Œè¿™é‡Œå¯ä»¥å¯¹<code>name</code> çš„æƒé‡æå‡ã€‚</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"query"</span>: &#123;        <span class="hljs-attr">"multi_match"</span>: &#123;            <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springæ¡†æ¶"</span>,            <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"50%"</span>,            <span class="hljs-attr">"fields"</span>: [                <span class="hljs-string">"name^10"</span>,                <span class="hljs-string">"description"</span>            ]        &#125;    &#125;&#125;</code></pre></div><p><code>name^10</code> è¡¨ç¤ºæƒé‡æå‡ <code>10</code> å€ï¼Œæ‰§è¡Œä¸Šè¾¹çš„æŸ¥è¯¢ï¼Œå‘ç° <code>name</code> ä¸­åŒ…æ‹¬ <code>spring</code> å…³é”®å­—çš„æ–‡æ¡£æ’åœ¨å‰è¾¹ã€‚</p><p><strong>JAVA å®¢æˆ·ç«¯ï¼š</strong></p><div class="hljs"><pre><code class="hljs java">MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(<span class="hljs-string">"springæ¡†æ¶"</span>,<span class="hljs-string">"name"</span>, <span class="hljs-string">"description"</span>).minimumShouldMatch(<span class="hljs-string">"50%"</span>);multiMatchQueryBuilder.field(<span class="hljs-string">"name"</span>,<span class="hljs-number">10</span>);<span class="hljs-comment">//æå‡boost</span></code></pre></div><h3 id="7ã€å¸ƒå°”æŸ¥è¯¢"><a href="#7ã€å¸ƒå°”æŸ¥è¯¢" class="headerlink" title="7ã€å¸ƒå°”æŸ¥è¯¢"></a>7ã€å¸ƒå°”æŸ¥è¯¢</h3><p>å¸ƒå°”æŸ¥è¯¢å¯¹åº”äº <code>Lucene</code> çš„ <code>BooleanQuery</code> æŸ¥è¯¢ï¼Œå®ç°å°†å¤šä¸ªæŸ¥è¯¢ç»„åˆèµ·æ¥ã€‚</p><p>ä¸‰ä¸ªå‚æ•°ï¼š</p><p><code>must</code>ï¼šæ–‡æ¡£å¿…é¡»åŒ¹é… <code>must</code> æ‰€åŒ…æ‹¬çš„æŸ¥è¯¢æ¡ä»¶ï¼Œç›¸å½“äº <code>AND</code></p><p><code>should</code>ï¼šæ–‡æ¡£åº”è¯¥åŒ¹é… <code>should</code> æ‰€åŒ…æ‹¬çš„æŸ¥è¯¢æ¡ä»¶å…¶ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œç›¸å½“äº <code>OR</code></p><p><code>must_not</code>ï¼šæ–‡æ¡£ä¸èƒ½åŒ¹é… <code>must_not</code> æ‰€åŒ…æ‹¬çš„è¯¥æŸ¥è¯¢æ¡ä»¶ï¼Œç›¸å½“äº <code>NOT</code></p><p>åˆ†åˆ«ä½¿ç”¨ <code>must</code>ã€<code>should</code>ã€<code>must_not</code> æµ‹è¯•ä¸‹è¾¹çš„æŸ¥è¯¢ï¼š</p><p>å‘é€ï¼šPOST <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"_source"</span>: [        <span class="hljs-string">"name"</span>,        <span class="hljs-string">"studymodel"</span>,        <span class="hljs-string">"description"</span>    ],    <span class="hljs-attr">"from"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"size"</span>: <span class="hljs-number">1</span>,    <span class="hljs-attr">"query"</span>: &#123;        <span class="hljs-attr">"bool"</span>: &#123;            <span class="hljs-attr">"must"</span>: [                &#123;                    <span class="hljs-attr">"multi_match"</span>: &#123;                        <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springæ¡†æ¶"</span>,                        <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"50%"</span>,                        <span class="hljs-attr">"fields"</span>: [                            <span class="hljs-string">"name^10"</span>,                            <span class="hljs-string">"description"</span>                        ]                    &#125;                &#125;,                &#123;                    <span class="hljs-attr">"term"</span>: &#123;                        <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>                    &#125;                &#125;            ]        &#125;    &#125;&#125;</code></pre></div><p><code>must</code>ï¼šè¡¨ç¤ºå¿…é¡»ï¼Œå¤šä¸ªæŸ¥è¯¢æ¡ä»¶å¿…é¡»éƒ½æ»¡è¶³ã€‚ï¼ˆé€šå¸¸ä½¿ç”¨<code>must</code>ï¼‰</p><p><code>should</code>ï¼šè¡¨ç¤ºæˆ–è€…ï¼Œå¤šä¸ªæŸ¥è¯¢æ¡ä»¶åªè¦æœ‰ä¸€ä¸ªæ»¡è¶³å³å¯ã€‚</p><p><code>must_not</code>ï¼šè¡¨ç¤ºéã€‚</p><p><strong>JAVAå®¢æˆ·ç«¯å®ç°ï¼š</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//BoolQueryï¼Œå°†æœç´¢å…³é”®å­—åˆ†è¯ï¼Œæ‹¿åˆ†è¯å»ç´¢å¼•åº“æœç´¢</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testBoolQuery</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    <span class="hljs-comment">//åˆ›å»ºæœç´¢è¯·æ±‚å¯¹è±¡</span>    SearchRequest searchRequest= <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);    searchRequest.types(<span class="hljs-string">"doc"</span>);    <span class="hljs-comment">//åˆ›å»ºæœç´¢æºé…ç½®å¯¹è±¡</span>    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"pic"</span>,<span class="hljs-string">"studymodel"</span>&#125;,<span class="hljs-keyword">new</span> String[]&#123;&#125;);    <span class="hljs-comment">//multiQuery</span>    String keyword = <span class="hljs-string">"springå¼€å‘æ¡†æ¶"</span>;    MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(<span class="hljs-string">"springæ¡†æ¶"</span>,    <span class="hljs-string">"name"</span>, <span class="hljs-string">"description"</span>)    .minimumShouldMatch(<span class="hljs-string">"50%"</span>);    multiMatchQueryBuilder.field(<span class="hljs-string">"name"</span>,<span class="hljs-number">10</span>);    <span class="hljs-comment">//TermQuery</span>    TermQueryBuilder termQueryBuilder = QueryBuilders.termQuery(<span class="hljs-string">"studymodel"</span>, <span class="hljs-string">"201001"</span>);    <span class="hljs-comment">//å¸ƒå°”æŸ¥è¯¢</span>    BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();    boolQueryBuilder.must(multiMatchQueryBuilder);    boolQueryBuilder.must(termQueryBuilder);    <span class="hljs-comment">//è®¾ç½®å¸ƒå°”æŸ¥è¯¢å¯¹è±¡</span>    searchSourceBuilder.query(boolQueryBuilder);    searchRequest.source(searchSourceBuilder);<span class="hljs-comment">//è®¾ç½®æœç´¢æºé…ç½®</span>    SearchResponse searchResponse = client.search(searchRequest);    SearchHits hits = searchResponse.getHits();    SearchHit[] searchHits = hits.getHits();    <span class="hljs-keyword">for</span>(SearchHit hit:searchHits)&#123;        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();        System.out.println(sourceAsMap);    &#125;&#125;</code></pre></div><h3 id="8ã€è¿‡æ»¤å™¨"><a href="#8ã€è¿‡æ»¤å™¨" class="headerlink" title="8ã€è¿‡æ»¤å™¨"></a>8ã€è¿‡æ»¤å™¨</h3><p>è¿‡è™‘æ˜¯é’ˆå¯¹ <strong>æœç´¢çš„ç»“æœ</strong> è¿›è¡Œè¿‡è™‘ï¼Œè¿‡è™‘å™¨ä¸»è¦åˆ¤æ–­çš„æ˜¯æ–‡æ¡£æ˜¯å¦åŒ¹é…ï¼Œä¸å» <strong>è®¡ç®—å’Œåˆ¤æ–­æ–‡æ¡£çš„åŒ¹é…åº¦å¾—åˆ†</strong>ï¼Œæ‰€ä»¥è¿‡è™‘å™¨çš„ <strong>æ€§èƒ½</strong> æ¯”æŸ¥è¯¢è¦é«˜ï¼Œä¸”æ–¹ä¾¿ç¼“å­˜ï¼Œæ¨èå°½é‡ä½¿ç”¨è¿‡è™‘å™¨å»å®ç°æŸ¥è¯¢æˆ–è€… <strong>è¿‡è™‘å™¨</strong> å’Œ <strong>æŸ¥è¯¢</strong> å…±åŒä½¿ç”¨ã€‚</p><p>è¿‡è™‘å™¨åœ¨å¸ƒå°”æŸ¥è¯¢ä¸­ä½¿ç”¨ï¼Œä¸‹è¾¹æ˜¯åœ¨æœç´¢ç»“æœçš„åŸºç¡€ä¸Šè¿›è¡Œè¿‡æ»¤</p><p>å‘é€ï¼šPOST <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"_source"</span>: [        <span class="hljs-string">"name"</span>,        <span class="hljs-string">"studymodel"</span>,        <span class="hljs-string">"description"</span>,        <span class="hljs-string">"price"</span>    ],    <span class="hljs-attr">"query"</span>: &#123;        <span class="hljs-attr">"bool"</span>: &#123;            <span class="hljs-attr">"must"</span>: [                &#123;                    <span class="hljs-attr">"multi_match"</span>: &#123;                        <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springæ¡†æ¶"</span>,                        <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"50%"</span>,                        <span class="hljs-attr">"fields"</span>: [                            <span class="hljs-string">"name^10"</span>,                            <span class="hljs-string">"description"</span>                        ]                    &#125;                &#125;            ],            <span class="hljs-attr">"filter"</span>: [                &#123;                    <span class="hljs-attr">"term"</span>: &#123;                        <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>                    &#125;                &#125;,                &#123;                    <span class="hljs-attr">"range"</span>: &#123;                        <span class="hljs-attr">"price"</span>: &#123;                            <span class="hljs-attr">"gte"</span>: <span class="hljs-number">60</span>,                            <span class="hljs-attr">"lte"</span>: <span class="hljs-number">100</span>                        &#125;                    &#125;                &#125;            ]        &#125;    &#125;&#125;</code></pre></div><p>rangeï¼šèŒƒå›´è¿‡è™‘ï¼Œä¿ç•™å¤§äºç­‰äº <code>60</code> å¹¶ä¸”å°äºç­‰äº <code>100</code> çš„è®°å½•ã€‚</p><p>termï¼šé¡¹åŒ¹é…è¿‡è™‘ï¼Œä¿ç•™ <code>studymodel</code> ç­‰äº <code>201001</code> çš„è®°å½•ã€‚</p><p>æ³¨æ„ï¼š<code>range</code> å’Œ <code>term</code> ä¸€æ¬¡åªèƒ½å¯¹ä¸€ä¸ª <code>Field</code> è®¾ç½®èŒƒå›´è¿‡è™‘ã€‚</p><p><strong>JAVA å®¢æˆ·ç«¯å®ç°ï¼š</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//å¸ƒå°”æŸ¥è¯¢ä½¿ç”¨è¿‡è™‘å™¨</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFilter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);    searchRequest.types(<span class="hljs-string">"doc"</span>);    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();    <span class="hljs-comment">//sourceæºå­—æ®µè¿‡è™‘</span>    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>,<span class="hljs-string">"price"</span>,<span class="hljs-string">"description"</span>&#125;,    <span class="hljs-keyword">new</span> String[]&#123;&#125;);    searchRequest.source(searchSourceBuilder);    <span class="hljs-comment">//åŒ¹é…å…³é”®å­—</span>    MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(<span class="hljs-string">"springæ¡†</span><span class="hljs-string">    æ¶"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"description"</span>);    <span class="hljs-comment">//è®¾ç½®åŒ¹é…å æ¯”</span>    multiMatchQueryBuilder.minimumShouldMatch(<span class="hljs-string">"50%"</span>);    <span class="hljs-comment">//æå‡å¦ä¸ªå­—æ®µçš„Boostå€¼</span>    multiMatchQueryBuilder.field(<span class="hljs-string">"name"</span>,<span class="hljs-number">10</span>);    searchSourceBuilder.query(multiMatchQueryBuilder);    <span class="hljs-comment">//å¸ƒå°”æŸ¥è¯¢</span>    BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();    boolQueryBuilder.must(searchSourceBuilder.query());    <span class="hljs-comment">//è¿‡è™‘æ¡ä»¶</span>    boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"studymodel"</span>, <span class="hljs-string">"201001"</span>));    boolQueryBuilder.filter(QueryBuilders.rangeQuery(<span class="hljs-string">"price"</span>).gte(<span class="hljs-number">60</span>).lte(<span class="hljs-number">100</span>));    <span class="hljs-comment">//æ‰§è¡Œæœç´¢</span>SearchResponse searchResponse = client.search(searchRequest);    SearchHits hits = searchResponse.getHits();    SearchHit[] searchHits = hits.getHits();    <span class="hljs-keyword">for</span>(SearchHit hit:searchHits)&#123;        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();        System.out.println(sourceAsMap);    &#125;&#125;</code></pre></div><h3 id="9ã€æ’åº"><a href="#9ã€æ’åº" class="headerlink" title="9ã€æ’åº"></a>9ã€æ’åº</h3><p>å¯ä»¥åœ¨å­—æ®µä¸Šæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæ’åºï¼Œæ”¯æŒåœ¨ <code>keyword</code>ã€<code>date</code>ã€<code>float</code> ç­‰ç±»å‹ä¸Šæ·»åŠ ï¼Œ<code>text</code> ç±»å‹çš„å­—æ®µä¸Šä¸å…è®¸æ·»åŠ æ’åºã€‚</p><p>éœ€æ±‚ï¼šè¿‡è™‘ <code>0--10</code> å…ƒä»·æ ¼èŒƒå›´çš„æ–‡æ¡£ï¼Œå¹¶ä¸”å¯¹ç»“æœè¿›è¡Œæ’åºï¼Œå…ˆæŒ‰ <code>studymodel</code> é™åºï¼Œå†æŒ‰ä»·æ ¼å‡åº</p><p>å‘é€ POST <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"_source"</span>: [        <span class="hljs-string">"name"</span>,        <span class="hljs-string">"studymodel"</span>,        <span class="hljs-string">"description"</span>,        <span class="hljs-string">"price"</span>    ],    <span class="hljs-attr">"query"</span>: &#123;        <span class="hljs-attr">"bool"</span>: &#123;            <span class="hljs-attr">"filter"</span>: [                &#123;                    <span class="hljs-attr">"range"</span>: &#123;                        <span class="hljs-attr">"price"</span>: &#123;                            <span class="hljs-attr">"gte"</span>: <span class="hljs-number">0</span>,                            <span class="hljs-attr">"lte"</span>: <span class="hljs-number">100</span>                        &#125;                    &#125;                &#125;            ]        &#125;    &#125;,    <span class="hljs-attr">"sort"</span>: [        &#123;            <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"desc"</span>        &#125;,        &#123;            <span class="hljs-attr">"price"</span>: <span class="hljs-string">"asc"</span>        &#125;    ]&#125;</code></pre></div><blockquote><p>dest è¡¨ç¤ºé™åºï¼Œä»å¤§åˆ°å°ï¼Œasc è¡¨ç¤ºå‡åºï¼Œä»å°åˆ°å¤§</p></blockquote><p><strong>JAVAå®¢æˆ·ç«¯å®ç°</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSort</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);    searchRequest.types(<span class="hljs-string">"doc"</span>);    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();    <span class="hljs-comment">//sourceæºå­—æ®µè¿‡è™‘</span>    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>,<span class="hljs-string">"price"</span>,<span class="hljs-string">"description"</span>&#125;,    <span class="hljs-keyword">new</span> String[]&#123;&#125;);    searchRequest.source(searchSourceBuilder);    <span class="hljs-comment">//å¸ƒå°”æŸ¥è¯¢</span>    BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();    <span class="hljs-comment">//è¿‡è™‘</span>  boolQueryBuilder.filter(QueryBuilders.rangeQuery(<span class="hljs-string">"price"</span>).gte(<span class="hljs-number">0</span>).lte(<span class="hljs-number">100</span>));    <span class="hljs-comment">//æ’åº</span>    searchSourceBuilder.sort(<span class="hljs-keyword">new</span> FieldSortBuilder(<span class="hljs-string">"studymodel"</span>).order(SortOrder.DESC));    searchSourceBuilder.sort(<span class="hljs-keyword">new</span> FieldSortBuilder(<span class="hljs-string">"price"</span>).order(SortOrder.ASC));    SearchResponse searchResponse = client.search(searchRequest);    SearchHits hits = searchResponse.getHits();    SearchHit[] searchHits = hits.getHits();    <span class="hljs-keyword">for</span>(SearchHit hit:searchHits)&#123;        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();        System.out.println(sourceAsMap);    &#125;&#125;</code></pre></div><h3 id="10ã€é«˜äº®æ˜¾ç¤º"><a href="#10ã€é«˜äº®æ˜¾ç¤º" class="headerlink" title="10ã€é«˜äº®æ˜¾ç¤º"></a>10ã€é«˜äº®æ˜¾ç¤º</h3><p><strong>JAVAå®¢æˆ·ç«¯å®ç°</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testHighlight</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);    searchRequest.types(<span class="hljs-string">"doc"</span>);    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();    <span class="hljs-comment">//sourceæºå­—æ®µè¿‡è™‘</span>    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>,<span class="hljs-string">"price"</span>,<span class="hljs-string">"description"</span>&#125;,    <span class="hljs-keyword">new</span> String[]&#123;&#125;);    searchRequest.source(searchSourceBuilder);    <span class="hljs-comment">//åŒ¹é…å…³é”®å­—</span>    MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(<span class="hljs-string">"å¼€å‘"</span>,    <span class="hljs-string">"name"</span>, <span class="hljs-string">"description"</span>);    searchSourceBuilder.query(multiMatchQueryBuilder);    <span class="hljs-comment">//å¸ƒå°”æŸ¥è¯¢</span>    BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();    boolQueryBuilder.must(searchSourceBuilder.query());    <span class="hljs-comment">//è¿‡è™‘</span>    boolQueryBuilder.filter(QueryBuilders.rangeQuery(<span class="hljs-string">"price"</span>).gte(<span class="hljs-number">0</span>).lte(<span class="hljs-number">100</span>));    <span class="hljs-comment">//æ’åº</span>    searchSourceBuilder.sort(<span class="hljs-keyword">new</span> FieldSortBuilder(<span class="hljs-string">"studymodel"</span>).order(SortOrder.DESC));    searchSourceBuilder.sort(<span class="hljs-keyword">new</span> FieldSortBuilder(<span class="hljs-string">"price"</span>).order(SortOrder.ASC));    <span class="hljs-comment">//é«˜äº®è®¾ç½®</span>    HighlightBuilder highlightBuilder = <span class="hljs-keyword">new</span> HighlightBuilder();    highlightBuilder.preTags(<span class="hljs-string">"&lt;tag&gt;"</span>);<span class="hljs-comment">//è®¾ç½®å‰ç¼€</span>    highlightBuilder.postTags(<span class="hljs-string">"&lt;/tag&gt;"</span>);<span class="hljs-comment">//è®¾ç½®åç¼€</span>    <span class="hljs-comment">// è®¾ç½®é«˜äº®å­—æ®µ</span>    highlightBuilder.fields().add(<span class="hljs-keyword">new</span> HighlightBuilder.Field(<span class="hljs-string">"name"</span>));    <span class="hljs-comment">// highlightBuilder.fields().add(new HighlightBuilder.Field("description"));</span>    searchSourceBuilder.highlighter(highlightBuilder);    SearchResponse searchResponse = client.search(searchRequest);    SearchHits hits = searchResponse.getHits();    SearchHit[] searchHits = hits.getHits();    <span class="hljs-keyword">for</span> (SearchHit hit : searchHits) &#123;        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();        <span class="hljs-comment">//åç§°</span>        String name = (String) sourceAsMap.get(<span class="hljs-string">"name"</span>);        <span class="hljs-comment">//å–å‡ºé«˜äº®å­—æ®µå†…å®¹</span>        Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();        <span class="hljs-keyword">if</span>(highlightFields!=<span class="hljs-keyword">null</span>)&#123;            HighlightField nameField = highlightFields.get(<span class="hljs-string">"name"</span>);            <span class="hljs-keyword">if</span>(nameField!=<span class="hljs-keyword">null</span>)&#123;                Text[] fragments = nameField.getFragments();                StringBuffer stringBuffer = <span class="hljs-keyword">new</span> StringBuffer();                <span class="hljs-keyword">for</span> (Text str : fragments) &#123;                    stringBuffer.append(str.string());                &#125;                 name = stringBuffer.toString();            &#125;        &#125;        <span class="hljs-comment">//å–å‡ºæ‰€æœ‰ç»“æœ</span>        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();        System.out.println(sourceAsMap);    &#125;&#125;</code></pre></div><h1 id="äºŒã€é›†ç¾¤ç®¡ç†"><a href="#äºŒã€é›†ç¾¤ç®¡ç†" class="headerlink" title="äºŒã€é›†ç¾¤ç®¡ç†"></a>äºŒã€é›†ç¾¤ç®¡ç†</h1><p><code>ES</code> é€šå¸¸ä»¥é›†ç¾¤æ–¹å¼å·¥ä½œï¼Œè¿™æ ·åšä¸ä»…èƒ½å¤Ÿæé«˜ <code>ES</code> çš„æœç´¢èƒ½åŠ›è¿˜å¯ä»¥å¤„ç†å¤§æ•°æ®æœç´¢çš„èƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›åŠé«˜å¯ç”¨ï¼Œ<code>ES</code> å¯ä»¥å®ç° <code>PB</code> çº§æ•°æ®çš„æœç´¢ã€‚</p><h2 id="1-é›†ç¾¤ç»“æ„"><a href="#1-é›†ç¾¤ç»“æ„" class="headerlink" title="1. é›†ç¾¤ç»“æ„"></a>1. é›†ç¾¤ç»“æ„</h2><p>ä¸‹å›¾æ˜¯ <code>ES</code> é›†ç¾¤ç»“æ„çš„ç¤ºæ„å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_11/image1" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image1.png" srcset="/img/loading.gif" alt="image-20200423073305474.png"></a></p><p><a href="https://qnoss.codeyee.com/20200704_11/image1" target="_blank" rel="noopener">image-20200423073305474.png</a></p><p>ä»ä¸Šå›¾æ€»ç»“ä»¥ä¸‹æ¦‚å¿µï¼š</p><p><strong>1ã€ç»“ç‚¹</strong></p><p><code>ES</code> é›†ç¾¤ç”±å¤šä¸ªæœåŠ¡å™¨ç»„æˆï¼Œæ¯ä¸ªæœåŠ¡å™¨å³ä¸ºä¸€ä¸ª <code>Node</code> ç»“ç‚¹(å¦‚æœè¯¥æœåŠ¡å™¨åªéƒ¨ç½²äº†ä¸€ä¸ª <code>ES</code> è¿›ç¨‹)ã€‚</p><p><strong>2ã€åˆ†ç‰‡</strong></p><p>å½“æˆ‘ä»¬çš„æ–‡æ¡£é‡å¾ˆå¤§æ—¶ï¼Œç”±äºå†…å­˜å’Œç¡¬ç›˜çš„é™åˆ¶ï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†æé«˜ <code>ES</code> çš„å¤„ç†èƒ½åŠ›ã€å®¹é”™èƒ½åŠ›åŠé«˜å¯ç”¨èƒ½åŠ›ï¼Œæˆ‘ä»¬å°†ç´¢å¼•åˆ†æˆè‹¥å¹²åˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡å¯ä»¥æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ï¼Œè¿™æ ·å°±å®ç°äº†å¤šä¸ªæœåŠ¡å™¨å…±åŒå¯¹å¤–æä¾›ç´¢å¼•åŠæœç´¢æœåŠ¡ã€‚<br>ä¸€ä¸ªæœç´¢è¯·æ±‚è¿‡æ¥ï¼Œä¼šåˆ†åˆ«ä»å„å„åˆ†ç‰‡å»æŸ¥è¯¢ï¼Œæœ€åå°†æŸ¥è¯¢åˆ°çš„æ•°æ®åˆå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚</p><p><strong>3ã€å‰¯æœ¬</strong></p><p>ä¸ºäº†æé«˜ <code>ES</code> çš„é«˜å¯ç”¨åŒæ—¶ä¹Ÿä¸ºäº†æé«˜æœç´¢çš„ååé‡ï¼Œæˆ‘ä»¬å°†åˆ†ç‰‡å¤åˆ¶ä¸€ä»½æˆ–å¤šä»½å­˜å‚¨åœ¨å…¶å®ƒçš„æœåŠ¡å™¨ï¼Œè¿™æ ·å³ä½¿å½“å‰çš„æœåŠ¡å™¨æŒ‚æ‰äº†ï¼Œæ‹¥æœ‰å‰¯æœ¬çš„æœåŠ¡å™¨ç…§å¸¸å¯ä»¥æä¾›æœåŠ¡ã€‚</p><p><strong>4ã€ä¸»ç»“ç‚¹</strong></p><p>ä¸€ä¸ªé›†ç¾¤ä¸­ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä¸»ç»“ç‚¹ï¼Œä¸»ç»“ç‚¹çš„ä½œç”¨æ˜¯é›†ç¾¤ç®¡ç†ï¼Œæ¯”å¦‚å¢åŠ èŠ‚ç‚¹ï¼Œç§»é™¤èŠ‚ç‚¹ç­‰ï¼Œä¸»ç»“ç‚¹æŒ‚æ‰åESä¼šé‡æ–°é€‰ä¸€ä¸ªä¸»ç»“ç‚¹ã€‚</p><p><strong>5ã€ç»“ç‚¹è½¬å‘</strong></p><p>æ¯ä¸ªç»“ç‚¹éƒ½çŸ¥é“å…¶å®ƒç»“ç‚¹çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä»»æ„ä¸€ä¸ªç»“ç‚¹å‘èµ·è¯·æ±‚ï¼Œæ¥æ”¶è¯·æ±‚çš„ç»“ç‚¹ä¼šè½¬å‘ç»™å…¶å®ƒç»“ç‚¹æŸ¥è¯¢æ•°æ®</p><h2 id="2-æ­å»ºé›†ç¾¤"><a href="#2-æ­å»ºé›†ç¾¤" class="headerlink" title="2. æ­å»ºé›†ç¾¤"></a>2. æ­å»ºé›†ç¾¤</h2><h3 id="1ã€èŠ‚ç‚¹çš„ä¸‰ä¸ªè§’è‰²"><a href="#1ã€èŠ‚ç‚¹çš„ä¸‰ä¸ªè§’è‰²" class="headerlink" title="1ã€èŠ‚ç‚¹çš„ä¸‰ä¸ªè§’è‰²"></a>1ã€èŠ‚ç‚¹çš„ä¸‰ä¸ªè§’è‰²</h3><p>ä¸‹è¾¹çš„ä¾‹å­å®ç°åˆ›å»ºä¸€ä¸ª 2ç»“ç‚¹çš„é›†ç¾¤ï¼Œå¹¶ä¸”ç´¢å¼•çš„åˆ†ç‰‡æˆ‘ä»¬è®¾ç½® 2ç‰‡ï¼Œæ¯ç‰‡ä¸€ä¸ªå‰¯æœ¬ã€‚</p><p>ä¸»ç»“ç‚¹ï¼š<code>master</code> èŠ‚ç‚¹ä¸»è¦ç”¨äºé›†ç¾¤çš„ç®¡ç†åŠç´¢å¼•ï¼Œæ¯”å¦‚æ–°å¢ç»“ç‚¹ã€åˆ†ç‰‡åˆ†é…ã€ç´¢å¼•çš„æ–°å¢å’Œåˆ é™¤ç­‰ã€‚</p><p>æ•°æ®ç»“ç‚¹ï¼š<code>data</code> èŠ‚ç‚¹ä¸Šä¿å­˜äº†æ•°æ®åˆ†ç‰‡ï¼Œå®ƒè´Ÿè´£ç´¢å¼•å’Œæœç´¢æ“ä½œã€‚ å®¢æˆ·ç«¯ç»“ç‚¹ï¼š<code>client</code> èŠ‚ç‚¹ä»…ä½œä¸ºè¯·æ±‚å®¢æˆ·ç«¯å­˜åœ¨ï¼Œ<code>client</code> çš„ä½œç”¨ä¹Ÿä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œ<code>client</code> èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼Œåªæ˜¯å°†è¯·æ±‚å‡è¡¡è½¬å‘åˆ°å…¶å®ƒç»“ç‚¹ã€‚</p><p>é€šè¿‡ä¸‹è¾¹ä¸¤é¡¹å‚æ•°æ¥é…ç½®ç»“ç‚¹çš„åŠŸèƒ½ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">node.master:</span> <span class="hljs-comment">#æ˜¯å¦å…è®¸ä¸ºä¸»ç»“ç‚¹</span><span class="hljs-attr">node.data:</span> <span class="hljs-comment">#å…è®¸å­˜å‚¨æ•°æ®ä½œä¸ºæ•°æ®ç»“ç‚¹</span><span class="hljs-attr">node.ingest:</span> <span class="hljs-comment">#æ˜¯å¦å…è®¸æˆä¸ºåè°ƒèŠ‚ç‚¹ï¼Œ</span></code></pre></div><p>å››ç§ç»„åˆæ–¹å¼ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-string">master=true,</span> <span class="hljs-string">data=trueï¼šå³æ˜¯ä¸»ç»“ç‚¹åˆæ˜¯æ•°æ®ç»“ç‚¹</span><span class="hljs-string">master=false,</span> <span class="hljs-string">data=trueï¼šä»…æ˜¯æ•°æ®ç»“ç‚¹</span><span class="hljs-string">master=true,</span> <span class="hljs-string">data=falseï¼šä»…æ˜¯ä¸»ç»“ç‚¹ï¼Œä¸å­˜å‚¨æ•°æ®</span><span class="hljs-string">master=false,</span> <span class="hljs-string">data=falseï¼šå³ä¸æ˜¯ä¸»ç»“ç‚¹ä¹Ÿä¸æ˜¯æ•°æ®ç»“ç‚¹ï¼Œæ­¤æ—¶å¯è®¾ç½®ingestä¸ºtrueè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯</span></code></pre></div><h3 id="2ã€åˆ›å»ºèŠ‚ç‚¹"><a href="#2ã€åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="2ã€åˆ›å»ºèŠ‚ç‚¹"></a>2ã€åˆ›å»ºèŠ‚ç‚¹</h3><h4 id="1-é…ç½®èŠ‚ç‚¹1"><a href="#1-é…ç½®èŠ‚ç‚¹1" class="headerlink" title="(1) é…ç½®èŠ‚ç‚¹1"></a>(1) é…ç½®èŠ‚ç‚¹1</h4><p>ç»“ç‚¹1 å¯¹å¤–æœåŠ¡çš„ <code>http</code> ç«¯å£æ˜¯ <code>9200</code>ï¼Œé›†ç¾¤ç®¡ç†ç«¯å£æ˜¯ <code>9300</code></p><p>é…ç½® elasticsearch.yml</p><p>ç»“ç‚¹åï¼š<code>xc_node_1</code></p><p><code>elasticsearch.yml</code> å†…å®¹å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">xuecheng</span><span class="hljs-attr">node.name:</span> <span class="hljs-string">xc_node_1</span><span class="hljs-comment"># ä¸»æœºç»‘å®šIPã€ç«¯å£ç­‰ä¿¡æ¯</span><span class="hljs-attr">network.host:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-attr">http.port:</span> <span class="hljs-number">9200</span><span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9300</span><span class="hljs-attr">node.master:</span> <span class="hljs-literal">true</span><span class="hljs-attr">node.data:</span> <span class="hljs-literal">true</span><span class="hljs-comment"># é…ç½®masterèŠ‚ç‚¹åˆ—è¡¨</span><span class="hljs-attr">discovery.zen.ping.unicast.hosts:</span> <span class="hljs-string">["0.0.0.0:9300",</span> <span class="hljs-string">"0.0.0.0:9301"</span><span class="hljs-string">]</span><span class="hljs-comment"># æœ€å°çš„ä¸»èŠ‚ç‚¹æ•°é‡</span><span class="hljs-attr">discovery.zen.minimum_master_nodes:</span> <span class="hljs-number">1</span><span class="hljs-attr">node.ingest:</span> <span class="hljs-literal">true</span><span class="hljs-attr">bootstrap.memory_lock:</span> <span class="hljs-literal">false</span><span class="hljs-attr">node.max_local_storage_nodes:</span> <span class="hljs-number">1</span><span class="hljs-comment"># æ•°æ®ä¸æ—¥å¿—ç›®å½•</span><span class="hljs-attr">path.data:</span> <span class="hljs-string">D:\soft\elasticsearch\elasticsearch-6.8.8_1\data</span><span class="hljs-attr">path.logs:</span> <span class="hljs-string">D:\soft\elasticsearch\elasticsearch-6.8.8_1\logs</span><span class="hljs-comment"># è·¨åŸŸé…ç½®</span><span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span><span class="hljs-attr">http.cors.allow-origin:</span> <span class="hljs-string">/.*/</span></code></pre></div><p>å¯åŠ¨èŠ‚ç‚¹1</p><h4 id="2-é…ç½®èŠ‚ç‚¹2"><a href="#2-é…ç½®èŠ‚ç‚¹2" class="headerlink" title="(2) é…ç½®èŠ‚ç‚¹2"></a>(2) é…ç½®èŠ‚ç‚¹2</h4><p>æˆ‘ä»¬æµ‹è¯•ç¯å¢ƒå°±åœ¨åŒä¸€å°æœºå™¨ä¸Šéƒ¨ç½²ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦å°† <code>ES</code> çš„å®‰è£…åŒ…å†è§£å‹ä¸€ä»½ï¼Œå¹¶å¤åˆ¶èŠ‚ç‚¹1çš„ikæ’ä»¶å’Œä¸€äº›æ—¥å¿—é…ç½®æ–‡ä»¶åˆ° <strong>èŠ‚ç‚¹2</strong> çš„ç›®å½•ä¸‹</p><p>ç»“ç‚¹ <code>2</code>å¯¹å¤–æœåŠ¡çš„ <code>http</code> ç«¯å£æ˜¯ <code>9201</code>ï¼Œé›†ç¾¤ç®¡ç†ç«¯å£æ˜¯<code>9302</code></p><p>ç»“ç‚¹åï¼š<code>xc_node_2</code></p><p><code>elasticsearch.yml</code> å†…å®¹å¦‚ä¸‹ ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">xuecheng</span><span class="hljs-attr">node.name:</span> <span class="hljs-string">xc_node_2</span><span class="hljs-comment"># ä¸»æœºç»‘å®šIPã€ç«¯å£ç­‰ä¿¡æ¯</span><span class="hljs-attr">network.host:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-attr">http.port:</span> <span class="hljs-number">9201</span><span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9301</span><span class="hljs-attr">node.master:</span> <span class="hljs-literal">true</span><span class="hljs-attr">node.data:</span> <span class="hljs-literal">true</span><span class="hljs-comment"># é…ç½®masterèŠ‚ç‚¹åˆ—è¡¨</span><span class="hljs-attr">discovery.zen.ping.unicast.hosts:</span> <span class="hljs-string">["0.0.0.0:9300",</span> <span class="hljs-string">"0.0.0.0:9301"</span><span class="hljs-string">]</span><span class="hljs-comment"># æœ€å°çš„ä¸»èŠ‚ç‚¹æ•°é‡</span><span class="hljs-attr">discovery.zen.minimum_master_nodes:</span> <span class="hljs-number">1</span><span class="hljs-attr">node.ingest:</span> <span class="hljs-literal">true</span><span class="hljs-attr">bootstrap.memory_lock:</span> <span class="hljs-literal">false</span><span class="hljs-attr">node.max_local_storage_nodes:</span> <span class="hljs-number">1</span><span class="hljs-comment"># æ•°æ®ä¸æ—¥å¿—ç›®å½•</span><span class="hljs-attr">path.data:</span> <span class="hljs-string">D:\soft\elasticsearch\elasticsearch-6.8.8_1\data</span><span class="hljs-attr">path.logs:</span> <span class="hljs-string">D:\soft\elasticsearch\elasticsearch-6.8.8_2\logs</span><span class="hljs-comment"># è·¨åŸŸé…ç½®</span><span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span><span class="hljs-attr">http.cors.allow-origin:</span> <span class="hljs-string">/.*/</span></code></pre></div><p>å¯åŠ¨ç»“ç‚¹2</p><h3 id="3ã€åˆ›å»ºç´¢å¼•åº“"><a href="#3ã€åˆ›å»ºç´¢å¼•åº“" class="headerlink" title="3ã€åˆ›å»ºç´¢å¼•åº“"></a>3ã€åˆ›å»ºç´¢å¼•åº“</h3><p>1ï¼‰ä½¿ç”¨headè¿ä¸Šå…¶ä¸­ä¸€ä¸ªç»“ç‚¹</p><p><a href="https://qnoss.codeyee.com/20200704_11/image2" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image2.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä¸Šå›¾è¡¨ç¤ºä¸¤ä¸ªç»“ç‚¹å·²ç»åˆ›å»ºæˆåŠŸã€‚</p><p>2ï¼‰ä¸‹è¾¹åˆ›å»ºç´¢å¼•åº“ï¼Œå…± <code>2</code> ä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡ä¸€ä¸ªå‰¯æœ¬ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_11/image3" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image3.png" srcset="/img/loading.gif" alt="img"></a></p><p>åˆ›å»ºæˆåŠŸï¼Œåˆ·æ–° head</p><p><a href="https://qnoss.codeyee.com/20200704_11/image4" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image4.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä¸Šå›¾å¯ä»¥çœ‹åˆ°å…±æœ‰4ä¸ªåˆ†ç‰‡ï¼Œå…¶ä¸­ä¸¤ä¸ªåˆ†ç‰‡æ˜¯å‰¯æœ¬ã€‚</p><h3 id="4ã€é›†ç¾¤çš„å¥åº·çŠ¶æ€"><a href="#4ã€é›†ç¾¤çš„å¥åº·çŠ¶æ€" class="headerlink" title="4ã€é›†ç¾¤çš„å¥åº·çŠ¶æ€"></a>4ã€é›†ç¾¤çš„å¥åº·çŠ¶æ€</h3><p>é€šè¿‡è®¿é—® GET <code>/_cluster/health</code> æ¥æŸ¥çœ‹ <code>Elasticsearch</code> çš„é›†ç¾¤å¥åº·æƒ…å†µã€‚</p><p>ç”¨ä¸‰ç§é¢œè‰²æ¥å±•ç¤ºå¥åº·çŠ¶æ€ï¼š <code>green</code> ã€ <code>yellow</code> æˆ–è€… <code>red</code> ã€‚</p><ul><li>greenï¼šæ‰€æœ‰çš„ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œã€‚</li><li>yellowï¼šæ‰€æœ‰çš„ä¸»åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œï¼Œä½†æœ‰äº›å‰¯æœ¬åˆ†ç‰‡è¿è¡Œä¸æ­£å¸¸ã€‚</li><li>edï¼šå­˜åœ¨ä¸»åˆ†ç‰‡è¿è¡Œä¸æ­£å¸¸ã€‚</li></ul><p>GET è¯·æ±‚ï¼š<a href="http://localhost:9200/_cluster/health" target="_blank" rel="noopener">http://localhost:9200/_cluster/health</a></p><p>å“åº”ç»“æœï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"cluster_name"</span>: <span class="hljs-string">"xuecheng"</span>,    <span class="hljs-attr">"status"</span>: <span class="hljs-string">"green"</span>,    <span class="hljs-attr">"timed_out"</span>: <span class="hljs-literal">false</span>,    <span class="hljs-attr">"number_of_nodes"</span>: <span class="hljs-number">2</span>,    <span class="hljs-attr">"number_of_data_nodes"</span>: <span class="hljs-number">2</span>,    <span class="hljs-attr">"active_primary_shards"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"active_shards"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"relocating_shards"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"initializing_shards"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"unassigned_shards"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"delayed_unassigned_shards"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"number_of_pending_tasks"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"number_of_in_flight_fetch"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"task_max_waiting_in_queue_millis"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"active_shards_percent_as_number"</span>: <span class="hljs-number">100.0</span>&#125;</code></pre></div><h2 id="3-æµ‹è¯•"><a href="#3-æµ‹è¯•" class="headerlink" title="3. æµ‹è¯•"></a>3. æµ‹è¯•</h2><p>1ï¼‰åˆ›å»ºæ˜ å°„å¹¶å†™å…¥æ–‡æ¡£</p><p>è¿æ¥ å…¶ä¸­ä»»æ„ä¸€å°ç»“ç‚¹ï¼Œåˆ›å»ºæ˜ å°„å†™å…¥æ–‡æ¡£ã€‚</p><p>POST <a href="http://localhost:9200/xc_course/doc/3" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/3</a></p><div class="hljs"><pre><code class="hljs json">&#123; <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>,    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"spring åœ¨javaé¢†åŸŸéå¸¸æµè¡Œï¼Œjavaè½¯ä»¶å¼€å‘äººå‘˜éƒ½åœ¨ç”¨ã€‚"</span>,    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,    <span class="hljs-attr">"price"</span>:<span class="hljs-number">66.6</span>&#125;</code></pre></div><p>å“åº”ç»“æœï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,    <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,    <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"3"</span>,    <span class="hljs-attr">"_version"</span>: <span class="hljs-number">1</span>,    <span class="hljs-attr">"result"</span>: <span class="hljs-string">"created"</span>,    <span class="hljs-attr">"_shards"</span>: &#123;        <span class="hljs-attr">"total"</span>: <span class="hljs-number">2</span>,        <span class="hljs-attr">"successful"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"failed"</span>: <span class="hljs-number">0</span>    &#125;,    <span class="hljs-attr">"_seq_no"</span>: <span class="hljs-number">0</span>,    <span class="hljs-attr">"_primary_term"</span>: <span class="hljs-number">1</span>&#125;</code></pre></div><p>ä»ä¸Šè¾¹çš„æç¤ºå¯çœ‹å‡ºï¼Œä¸¤ä¸ªåˆ†ç‰‡éƒ½ä¿å­˜æˆåŠŸã€‚</p><p>2ï¼‰æœç´¢</p><p>å‘å…¶å®ƒä¸€ä¸ªç»“ç‚¹å‘èµ·æœç´¢è¯·æ±‚ï¼ŒæŸ¥è¯¢å…¨éƒ¨æ•°æ®ã€‚</p><p>3ï¼‰å…³é—­ä¸€ä¸ªç»“ç‚¹</p><p>ESä¼šé‡æ–°é€‰ä¸­ä¸€ä¸ªä¸»ç»“ç‚¹ï¼ˆå‰æåœ¨é…ç½®ç»“ç‚¹æ—¶å…è®¸å®ƒå¯ä»¥ä¸ºä¸»ç»“ç‚¹ï¼‰</p><p><a href="https://qnoss.codeyee.com/20200704_11/image5" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image5.png" srcset="/img/loading.gif" alt="img"></a></p><p>æ­¤æ—¶å‘æ´»çš„ç»“ç‚¹å‘èµ·æœç´¢è¯·æ±‚ï¼Œä»ç„¶æ­£å¸¸ã€‚</p><p>4ï¼‰æ·»åŠ ä¸€ä¸ªç»“ç‚¹</p><p>æ·»åŠ ç»“ç‚¹ <code>3</code>ï¼Œç«¯å£è®¾ç½®ä¸ºï¼š</p><p><code>http</code> ç«¯å£æ˜¯ï¼š<code>9202</code></p><p>é›†ç¾¤ç®¡ç†ç«¯å£æ˜¯ <code>9302</code></p><p>ç»“ç‚¹åï¼š<code>xc_node_3</code></p><p>æ­¤ç»“ç‚¹çš„é…ç½®ï¼š</p><div class="hljs"><pre><code class="hljs json">node.master: falsenode.data: true</code></pre></div><p>å¯åŠ¨ç»“ç‚¹3ï¼Œåˆ·æ–° <code>head</code>ï¼Œä¸‹å›¾æ˜¾ç¤º <code>ES</code> å°†åˆ†ç‰‡åˆ†åœ¨äº† <code>3</code> ä¸ªç»“ç‚¹</p><p><a href="https://qnoss.codeyee.com/20200704_11/image6" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image6.png" srcset="/img/loading.gif" alt="img"></a></p><p>å‘ç»“ç‚¹3å‘èµ·æœç´¢è¯·æ±‚ï¼š</p><p>GETï¼š <a href="http://127.0.0.1:9202/xc_course/doc/_search" target="_blank" rel="noopener">http://127.0.0.1:9202/xc_course/doc/_search</a></p><p>å…¨éƒ¨æ•°æ®å¯è¢«æ­£å¸¸æœç´¢åˆ°ã€‚</p><h1 id="ä¸‰ã€æœç´¢æœåŠ¡å¼€å‘"><a href="#ä¸‰ã€æœç´¢æœåŠ¡å¼€å‘" class="headerlink" title="ä¸‰ã€æœç´¢æœåŠ¡å¼€å‘"></a>ä¸‰ã€æœç´¢æœåŠ¡å¼€å‘</h1><h2 id="1-è¯¾ç¨‹æœç´¢æœåŠ¡éœ€æ±‚åˆ†æ"><a href="#1-è¯¾ç¨‹æœç´¢æœåŠ¡éœ€æ±‚åˆ†æ" class="headerlink" title="1. è¯¾ç¨‹æœç´¢æœåŠ¡éœ€æ±‚åˆ†æ"></a>1. è¯¾ç¨‹æœç´¢æœåŠ¡éœ€æ±‚åˆ†æ</h2><h3 id="1ã€éœ€æ±‚åˆ†æ"><a href="#1ã€éœ€æ±‚åˆ†æ" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h3><p><a href="https://qnoss.codeyee.com/20200704_11/image7" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image7.png" srcset="/img/loading.gif" alt="img"></a></p><ol><li>æ ¹æ®åˆ†ç±»æœç´¢è¯¾ç¨‹ä¿¡æ¯ã€‚</li><li>æ ¹æ®å…³é”®å­—æœç´¢è¯¾ç¨‹ä¿¡æ¯ï¼Œæœç´¢æ–¹å¼ä¸ºå…¨æ–‡æ£€ç´¢ï¼Œå…³é”®å­—éœ€è¦åŒ¹é…è¯¾ç¨‹çš„åç§°ã€ è¯¾ç¨‹å†…å®¹ã€‚</li><li>æ ¹æ®éš¾åº¦ç­‰çº§æœç´¢è¯¾ç¨‹ã€‚</li><li>æœç´¢ç»“ç‚¹åˆ†é¡µæ˜¾ç¤ºã€‚</li></ol><h3 id="2ã€æœç´¢æµç¨‹"><a href="#2ã€æœç´¢æµç¨‹" class="headerlink" title="2ã€æœç´¢æµç¨‹"></a>2ã€æœç´¢æµç¨‹</h3><p><a href="https://qnoss.codeyee.com/20200704_11/image8" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image8.png" srcset="/img/loading.gif" alt="img"></a></p><p>1ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡å°†æ•°æ®å†™åˆ° <code>MySQL</code> æ•°æ®åº“</p><p>2ã€ä½¿ç”¨ <code>Logstash</code> å°† <code>MySQL</code> æ•°æ®åº“ä¸­çš„æ•°æ®å†™åˆ° <code>ES</code> çš„ç´¢å¼•åº“ã€‚</p><p>3ã€ç”¨æˆ·åœ¨å‰ç«¯æœç´¢è¯¾ç¨‹ä¿¡æ¯ï¼Œè¯·æ±‚åˆ°æœç´¢æœåŠ¡ã€‚</p><p>4ã€æœç´¢æœåŠ¡è¯·æ±‚ <code>ES</code> æœç´¢è¯¾ç¨‹ä¿¡æ¯ã€‚</p><h2 id="2-è¯¾ç¨‹ç´¢å¼•"><a href="#2-è¯¾ç¨‹ç´¢å¼•" class="headerlink" title="2. è¯¾ç¨‹ç´¢å¼•"></a>2. è¯¾ç¨‹ç´¢å¼•</h2><h3 id="1ã€æŠ€æœ¯æ–¹æ¡ˆ"><a href="#1ã€æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="1ã€æŠ€æœ¯æ–¹æ¡ˆ"></a>1ã€æŠ€æœ¯æ–¹æ¡ˆ</h3><p>å¦‚ä½•ç»´æŠ¤è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯ï¼Ÿ</p><p>1ã€å½“è¯¾ç¨‹å‘ <code>MySQL</code> æ·»åŠ ååŒæ—¶å°†è¯¾ç¨‹ä¿¡æ¯æ·»åŠ åˆ°ç´¢å¼•åº“ã€‚é‡‡ç”¨ <code>Logstach</code> å®ç°ï¼Œ<code>Logstach</code>ä¼šä» <code>MySQL</code> ä¸­ å°†æ•°æ®é‡‡é›†åˆ° <code>ES</code> ç´¢å¼•åº“ã€‚</p><p>2ã€å½“è¯¾ç¨‹åœ¨ <code>MySQL</code> æ›´æ–°ä¿¡æ¯ååŒæ—¶æ›´æ–°è¯¥è¯¾ç¨‹åœ¨ç´¢å¼•åº“çš„ä¿¡æ¯ã€‚</p><p>é‡‡ç”¨ <code>Logstach</code> å®ç°ã€‚</p><p>3ã€å½“è¯¾ç¨‹åœ¨ <code>MySQL</code> åˆ é™¤ååŒæ—¶å°†è¯¥è¯¾ç¨‹ä»ç´¢å¼•åº“åˆ é™¤ã€‚</p><p>æ‰‹å·¥å†™ç¨‹åºå®ç°ï¼Œåœ¨åˆ é™¤è¯¾ç¨‹åå°†ç´¢å¼•åº“ä¸­è¯¥è¯¾ç¨‹ä¿¡æ¯åˆ é™¤ã€‚</p><h3 id="2ã€å‡†å¤‡è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯"><a href="#2ã€å‡†å¤‡è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯" class="headerlink" title="2ã€å‡†å¤‡è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯"></a>2ã€å‡†å¤‡è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯</h3><p>è¯¾ç¨‹å‘å¸ƒæˆåŠŸåœ¨ <code>MySQL</code> æ•°æ®åº“å­˜å‚¨è¯¾ç¨‹å‘å¸ƒä¿¡æ¯ï¼Œæ­¤ä¿¡æ¯ä½œä¸ºè¯¾ç¨‹ç´¢å¼•ä¿¡æ¯ã€‚</p><h4 id="åˆ›å»ºè¯¾ç¨‹å‘å¸ƒè¡¨"><a href="#åˆ›å»ºè¯¾ç¨‹å‘å¸ƒè¡¨" class="headerlink" title="åˆ›å»ºè¯¾ç¨‹å‘å¸ƒè¡¨"></a>åˆ›å»ºè¯¾ç¨‹å‘å¸ƒè¡¨</h4><p>è¯¾ç¨‹ä¿¡æ¯åˆ†å¸ƒåœ¨ <code>course_base</code>ã€<code>course_pic</code> ç­‰ä¸åŒçš„è¡¨ä¸­ã€‚</p><p>è¯¾ç¨‹å‘å¸ƒæˆåŠŸä¸ºäº†æ–¹ä¾¿è¿›è¡Œç´¢å¼•å°†è¿™å‡ å¼ è¡¨çš„æ•°æ®åˆå¹¶åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œä½œä¸ºè¯¾ç¨‹å‘å¸ƒä¿¡æ¯ã€‚</p><p>åˆ›å»º <code>course_pub</code> è¡¨</p><p><a href="https://qnoss.codeyee.com/20200704_11/image9" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image9.png" srcset="/img/loading.gif" alt="img"></a></p><h4 id="åˆ›å»ºè¡¨æ¨¡å‹"><a href="#åˆ›å»ºè¡¨æ¨¡å‹" class="headerlink" title="åˆ›å»ºè¡¨æ¨¡å‹"></a>åˆ›å»ºè¡¨æ¨¡å‹</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-meta">@Entity</span><span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"course_pub"</span>)<span class="hljs-meta">@GenericGenerator</span>(name = <span class="hljs-string">"jpa-assigned"</span>, strategy = <span class="hljs-string">"assigned"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoursePub</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">916357110051689487L</span>;    <span class="hljs-meta">@Id</span>    <span class="hljs-meta">@GeneratedValue</span>(generator = <span class="hljs-string">"jpa-assigned"</span>)    <span class="hljs-meta">@Column</span>(length = <span class="hljs-number">32</span>)    <span class="hljs-keyword">private</span> String id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String users;    <span class="hljs-keyword">private</span> String mt;    <span class="hljs-keyword">private</span> String st;    <span class="hljs-keyword">private</span> String grade;    <span class="hljs-keyword">private</span> String studymodel;    <span class="hljs-keyword">private</span> String teachmode;    <span class="hljs-keyword">private</span> String description;    <span class="hljs-keyword">private</span> String pic;<span class="hljs-comment">//å›¾ç‰‡</span>    <span class="hljs-keyword">private</span> Date timestamp;<span class="hljs-comment">//æ—¶é—´æˆ³</span>    <span class="hljs-keyword">private</span> String charge;+    <span class="hljs-keyword">private</span> String valid;    <span class="hljs-keyword">private</span> String qq;    <span class="hljs-keyword">private</span> Float price;    <span class="hljs-keyword">private</span> Float price_old;    <span class="hljs-keyword">private</span> String expires;    <span class="hljs-keyword">private</span> String teachplan;<span class="hljs-comment">//è¯¾ç¨‹è®¡åˆ’</span>    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"pub_time"</span>)    <span class="hljs-keyword">private</span> String pubTime;<span class="hljs-comment">//è¯¾ç¨‹å‘å¸ƒæ—¶é—´</span>&#125;</code></pre></div><h4 id="æ·»åŠ è¯¾ç¨‹ç´¢å¼•"><a href="#æ·»åŠ è¯¾ç¨‹ç´¢å¼•" class="headerlink" title="æ·»åŠ è¯¾ç¨‹ç´¢å¼•"></a>æ·»åŠ è¯¾ç¨‹ç´¢å¼•</h4><p>æˆ‘ä»¬éœ€è¦åœ¨è¯¾ç¨‹å‘æˆåŠŸåæ‰§è¡Œæ·»åŠ è¯¾ç¨‹ç´¢å¼•çš„æ“ä½œ</p><p>1ï¼‰åˆ›å»º <code>course_pub</code> è¡¨çš„ <code>dao</code></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CoursePubRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">CoursePub</span>, <span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div><ol><li>ä¿®æ”¹è¯¾ç¨‹å‘å¸ƒ</li></ol><p>æˆ‘ä»¬å…ˆå°†æ·»åŠ ç´¢å¼•æ‹†åˆ†ä¸ºä¸¤ä¸ªæ–¹æ³•ï¼šcreateCoursePubã€saveCoursePub</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä¿å­˜CoursePub</span><span class="hljs-function"><span class="hljs-keyword">private</span> CoursePub <span class="hljs-title">saveCoursePub</span><span class="hljs-params">(String id, CoursePub coursePub)</span></span>&#123;    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(id))&#123;    ExceptionCast.cast(CourseCode.COURSE_PUBLISH_COURSEIDISNULL);    &#125;     CoursePub coursePubNew = <span class="hljs-keyword">null</span>;    Optional&lt;CoursePub&gt; coursePubOptional = coursePubRepository.findById(id);    <span class="hljs-keyword">if</span>(coursePubOptional.isPresent())&#123;    coursePubNew = coursePubOptional.get();    &#125;     <span class="hljs-keyword">if</span>(coursePubNew == <span class="hljs-keyword">null</span>)&#123;    coursePubNew = <span class="hljs-keyword">new</span> CoursePub();    &#125;     BeanUtils.copyProperties(coursePub,coursePubNew);    <span class="hljs-comment">//è®¾ç½®ä¸»é”®</span>    coursePubNew.setId(id);    <span class="hljs-comment">//æ›´æ–°æ—¶é—´æˆ³ä¸ºæœ€æ–°æ—¶é—´</span>    coursePub.setTimestamp(<span class="hljs-keyword">new</span> Date());    <span class="hljs-comment">//å‘å¸ƒæ—¶é—´</span>    SimpleDateFormat simpleDateFormat = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"YYYY-MM-dd HH:mm:ss"</span>);    String date = simpleDateFormat.format(<span class="hljs-keyword">new</span> Date());    coursePub.setPubTime(date);    coursePubRepository.save(coursePub);    <span class="hljs-keyword">return</span> coursePub;&#125;<span class="hljs-comment">//åˆ›å»ºcoursePubå¯¹è±¡</span><span class="hljs-function"><span class="hljs-keyword">private</span> CoursePub <span class="hljs-title">createCoursePub</span><span class="hljs-params">(String id)</span></span>&#123;    CoursePub coursePub = <span class="hljs-keyword">new</span> CoursePub();    coursePub.setId(id);    <span class="hljs-comment">//åŸºç¡€ä¿¡æ¯</span>    Optional&lt;CourseBase&gt; courseBaseOptional = courseBaseRepository.findById(id);    <span class="hljs-keyword">if</span>(courseBaseOptional == <span class="hljs-keyword">null</span>)&#123;        CourseBase courseBase = courseBaseOptional.get();        BeanUtils.copyProperties(courseBase, coursePub);    &#125;     <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹å›¾ç‰‡</span>    Optional&lt;CoursePic&gt; picOptional = coursePicRepository.findById(id);    <span class="hljs-keyword">if</span>(picOptional.isPresent())&#123;        CoursePic coursePic = picOptional.get();        BeanUtils.copyProperties(coursePic, coursePub);    &#125;     <span class="hljs-comment">//è¯¾ç¨‹è¥é”€ä¿¡æ¯</span>    Optional&lt;CourseMarket&gt; marketOptional = courseMarketRepository.findById(id);    <span class="hljs-keyword">if</span>(marketOptional.isPresent())&#123;        CourseMarket courseMarket = marketOptional.get();        BeanUtils.copyProperties(courseMarket, coursePub);    &#125;     <span class="hljs-comment">//è¯¾ç¨‹è®¡åˆ’</span>    TeachplanNode teachplanNode = teachplanMapper.selectList(id);    <span class="hljs-comment">//å°†è¯¾ç¨‹è®¡åˆ’è½¬æˆjson</span>    String teachplanString = JSON.toJSONString(teachplanNode);    coursePub.setTeachplan(teachplanString);    <span class="hljs-keyword">return</span> coursePub;&#125;</code></pre></div><p>3ï¼‰ä¿®æ”¹è¯¾ç¨‹æ–¹æ³•ï¼Œè°ƒç”¨ <code>createCoursePub</code> å’Œ <code>saveCoursePub</code> æ–¹æ³•</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//è¯¾ç¨‹å‘å¸ƒ</span><span class="hljs-meta">@Transactional</span><span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">publish</span><span class="hljs-params">(String courseId)</span></span>&#123;    ....    <span class="hljs-comment">//åˆ›å»ºè¯¾ç¨‹ç´¢å¼•</span>    <span class="hljs-comment">//åˆ›å»ºè¯¾ç¨‹ç´¢å¼•ä¿¡æ¯</span>    CoursePub coursePub = createCoursePub(courseId);    <span class="hljs-comment">//å‘æ•°æ®åº“ä¿å­˜è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯</span>    CoursePub newCoursePub = saveCoursePub(courseId, coursePub);    <span class="hljs-keyword">if</span>(newCoursePub==<span class="hljs-keyword">null</span>)&#123;    <span class="hljs-comment">//åˆ›å»ºè¯¾ç¨‹ç´¢å¼•ä¿¡æ¯å¤±è´¥</span>ExceptionCast.cast(CourseCode.COURSE_PUBLISH_CREATE_INDEX_ERROR);    &#125;    ....&#125;</code></pre></div><h3 id="3ã€æ­å»ºESç¯å¢ƒ"><a href="#3ã€æ­å»ºESç¯å¢ƒ" class="headerlink" title="3ã€æ­å»ºESç¯å¢ƒ"></a>3ã€æ­å»ºESç¯å¢ƒ</h3><p>åˆ›å»ºç´¢å¼•åº“ ï¼Œ åˆ›å»º <code>xc_course</code> ç´¢å¼•åº“ï¼Œ1åˆ†ç‰‡ï¼Œ0ä¸ªå‰¯æœ¬ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_11/image10" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image10.png" srcset="/img/loading.gif" alt="img"></a></p><p>åˆ›å»ºæ˜ å°„</p><p>POST: <a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"properties"</span>: &#123;        <span class="hljs-attr">"description"</span>: &#123;            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>        &#125;,        <span class="hljs-attr">"grade"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"id"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"mt"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"name"</span>: &#123;            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>        &#125;,        <span class="hljs-attr">"users"</span>: &#123;            <span class="hljs-attr">"index"</span>: <span class="hljs-literal">false</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>        &#125;,        <span class="hljs-attr">"charge"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"valid"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"pic"</span>: &#123;            <span class="hljs-attr">"index"</span>: <span class="hljs-literal">false</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"qq"</span>: &#123;            <span class="hljs-attr">"index"</span>: <span class="hljs-literal">false</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"price"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"float"</span>        &#125;,        <span class="hljs-attr">"price_old"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"float"</span>        &#125;,        <span class="hljs-attr">"st"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"status"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"studymodel"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"teachmode"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"teachplan"</span>: &#123;            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>        &#125;,        <span class="hljs-attr">"expires"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>        &#125;,        <span class="hljs-attr">"pub_time"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>        &#125;,        <span class="hljs-attr">"start_time"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>        &#125;,        <span class="hljs-attr">"end_time"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>        &#125;    &#125;&#125;</code></pre></div><h3 id="4ã€Logstashåˆ›å»ºç´¢å¼•"><a href="#4ã€Logstashåˆ›å»ºç´¢å¼•" class="headerlink" title="4ã€Logstashåˆ›å»ºç´¢å¼•"></a>4ã€Logstashåˆ›å»ºç´¢å¼•</h3><p>Logstashæ˜¯ESä¸‹çš„ä¸€æ¬¾å¼€æºè½¯ä»¶ï¼Œå®ƒèƒ½å¤ŸåŒæ—¶ ä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ã€è½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€ <code>Eleasticsearch</code> ä¸­åˆ›å»ºç´¢å¼•ã€‚</p><p>æœ¬é¡¹ç›®ä½¿ç”¨ <code>Logstash</code> å°† <code>MySQL</code> ä¸­çš„æ•°æ®é‡‡ç”¨åˆ°ESç´¢å¼•ä¸­ã€‚</p><h4 id="ä¸‹è½½-Logstash"><a href="#ä¸‹è½½-Logstash" class="headerlink" title="ä¸‹è½½ Logstash"></a>ä¸‹è½½ Logstash</h4><p>ä¸‹è½½çš„ <code>Logstash</code> è¦å’ŒESçš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œä¸‹è½½åœ°å€ <a href="https://www.elastic.co/cn/downloads/logstash" target="_blank" rel="noopener">https://www.elastic.co/cn/downloads/logstash</a></p><p>ä¸‹è½½å®Œæˆåè§£å‹å³å¯</p><h4 id="å®‰è£…-Logstash"><a href="#å®‰è£…-Logstash" class="headerlink" title="å®‰è£… Logstash"></a>å®‰è£… Logstash</h4><p><code>ogstash-input-jdbc</code> æ˜¯<code>ruby</code>å¼€å‘çš„ï¼Œå…ˆä¸‹è½½ <code>ruby</code> å¹¶å®‰è£…</p><p>ä¸‹è½½åœ°å€: <a href="https://rubyinstaller.org/downloads/" target="_blank" rel="noopener">https://rubyinstaller.org/downloads/</a></p><p>å®‰è£…å®ŒæˆæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ <code>ruby -v</code></p><p><code>6.x</code> ç‰ˆæœ¬æœ¬èº«ä¸å¸¦ <code>logstash-input-jdbc</code> æ’ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£… ï¼Œåœ¨binç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><div class="hljs"><pre><code class="hljs shell">.\logstash-plugin.bat install logstash-input-jdbc</code></pre></div><p><a href="https://qnoss.codeyee.com/20200704_11/image11" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image11.png" srcset="/img/loading.gif" alt="img"></a></p><p>å®‰è£…æˆåŠŸåæˆ‘ä»¬å¯ä»¥åœ¨ <code>logstash</code> æ ¹ç›®å½•ä¸‹çš„ <code>vendor\bundle\jruby\2.5.0\gems</code> ç›®å½•æŸ¥çœ‹å¯¹åº”çš„æ’ä»¶ç‰ˆæœ¬</p><h4 id="åˆ›å»ºæ¨¡æ¿æ–‡ä»¶"><a href="#åˆ›å»ºæ¨¡æ¿æ–‡ä»¶" class="headerlink" title="åˆ›å»ºæ¨¡æ¿æ–‡ä»¶"></a>åˆ›å»ºæ¨¡æ¿æ–‡ä»¶</h4><p><code>Logstash</code> çš„å·¥ä½œæ˜¯ä» <code>MySQL</code> ä¸­è¯»å–æ•°æ®ï¼Œå‘ESä¸­åˆ›å»ºç´¢å¼•ï¼Œè¿™é‡Œéœ€è¦æå‰åˆ›å»º <code>mapping</code> çš„æ¨¡æ¿æ–‡ä»¶ä»¥ä¾¿ <code>logstash</code> ä½¿ç”¨ã€‚</p><p>åœ¨ <code>logstach</code> çš„ <code>config</code> ç›®å½•åˆ›å»º <code>xc_course_template.json</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;   <span class="hljs-attr">"mappings"</span> : &#123;      <span class="hljs-attr">"doc"</span> : &#123;         <span class="hljs-attr">"properties"</span> : &#123;            <span class="hljs-attr">"charge"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;,            <span class="hljs-attr">"description"</span> : &#123;               <span class="hljs-attr">"analyzer"</span> : <span class="hljs-string">"ik_max_word"</span>,               <span class="hljs-attr">"search_analyzer"</span> : <span class="hljs-string">"ik_smart"</span>,               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>            &#125;,            <span class="hljs-attr">"end_time"</span> : &#123;               <span class="hljs-attr">"format"</span> : <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>,               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"date"</span>            &#125;,            <span class="hljs-attr">"expires"</span> : &#123;               <span class="hljs-attr">"format"</span> : <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>,               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"date"</span>            &#125;,            <span class="hljs-attr">"grade"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;,            <span class="hljs-attr">"id"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;,            <span class="hljs-attr">"mt"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;,            <span class="hljs-attr">"name"</span> : &#123;               <span class="hljs-attr">"analyzer"</span> : <span class="hljs-string">"ik_max_word"</span>,               <span class="hljs-attr">"search_analyzer"</span> : <span class="hljs-string">"ik_smart"</span>,               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>            &#125;,            <span class="hljs-attr">"pic"</span> : &#123;               <span class="hljs-attr">"index"</span> : <span class="hljs-literal">false</span>,               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;,            <span class="hljs-attr">"price"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"float"</span>            &#125;,            <span class="hljs-attr">"price_old"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"float"</span>            &#125;,            <span class="hljs-attr">"pub_time"</span> : &#123;               <span class="hljs-attr">"format"</span> : <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>,               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"date"</span>            &#125;,            <span class="hljs-attr">"qq"</span> : &#123;               <span class="hljs-attr">"index"</span> : <span class="hljs-literal">false</span>,               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;,            <span class="hljs-attr">"st"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;,            <span class="hljs-attr">"start_time"</span> : &#123;               <span class="hljs-attr">"format"</span> : <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>,               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"date"</span>            &#125;,            <span class="hljs-attr">"status"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;,            <span class="hljs-attr">"studymodel"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;,            <span class="hljs-attr">"teachmode"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;,            <span class="hljs-attr">"teachplan"</span> : &#123;               <span class="hljs-attr">"analyzer"</span> : <span class="hljs-string">"ik_max_word"</span>,               <span class="hljs-attr">"search_analyzer"</span> : <span class="hljs-string">"ik_smart"</span>,               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>            &#125;,            <span class="hljs-attr">"users"</span> : &#123;               <span class="hljs-attr">"index"</span> : <span class="hljs-literal">false</span>,               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>            &#125;,            <span class="hljs-attr">"valid"</span> : &#123;               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>            &#125;         &#125;      &#125;   &#125;,   <span class="hljs-attr">"template"</span> : <span class="hljs-string">"xc_course"</span>&#125;</code></pre></div><p>è¯¥æ–‡ä»¶å¯¹äºçš„æ˜¯ESåº“ä¸­çš„æ˜ å°„</p><h4 id="é…ç½®-mysql-conf"><a href="#é…ç½®-mysql-conf" class="headerlink" title="é…ç½® mysql.conf"></a>é…ç½® mysql.conf</h4><p>åœ¨ <code>logstash</code> çš„ <code>config</code> ç›®å½•ä¸‹é…ç½® <code>mysql.conf</code>æ–‡ä»¶ä¾› <code>logstash</code> ä½¿ç”¨ï¼Œ<code>logstash</code> ä¼šæ ¹æ®<code>mysql.conf</code> æ–‡ä»¶çš„é…ç½®çš„åœ°å€ä» <code>MySQL</code> ä¸­è¯»å–æ•°æ®å‘ <code>ES</code> ä¸­å†™å…¥ç´¢å¼•ã€‚</p><p>å‚è€ƒ <a href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-jdbc.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/current/plugins-inputs-jdbc.html</a></p><p>é…ç½®è¾“å…¥æ•°æ®æºå’Œè¾“å‡ºæ•°æ®æºã€‚</p><div class="hljs"><pre><code class="hljs conf">input &#123;    stdin &#123;    &#125;     jdbc &#123;        jdbc_connection_string &#x3D;&gt; &quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;xc_course?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;useSSL&#x3D;true&amp;serverTimezone&#x3D;UTC&quot;        # æ•°æ®åº“ä¿¡æ¯        jdbc_user &#x3D;&gt; &quot;root&quot;        jdbc_password &#x3D;&gt; 123123        # MYSQL é©±åŠ¨åœ°å€,ä¿®æ”¹ä¸ºmavenä»“åº“å¯¹åº”çš„ä½ç½®        jdbc_driver_library &#x3D;&gt; &quot;D:&#x2F;soft&#x2F;apache-maven-3.5.4&#x2F;repository&#x2F;mysql&#x2F;mysql-connector-java&#x2F;5.1.40&#x2F;mysql-        connector-java-5.1.40.jar&quot;        # the name of the driver class for mysql        jdbc_driver_class &#x3D;&gt; &quot;com.mysql.jdbc.Driver&quot;        jdbc_paging_enabled &#x3D;&gt; &quot;true&quot;        jdbc_page_size &#x3D;&gt; &quot;50000&quot;        #è¦æ‰§è¡Œçš„sqlæ–‡ä»¶        #statement_filepath &#x3D;&gt; &quot;&#x2F;conf&#x2F;course.sql&quot;# è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç›´æ¥sqlè¯­å¥çš„å½¢å¼, å› ä¸ºlogstashé»˜è®¤é‡‡ç”¨çš„æ˜¯UTCæ ‡å‡†æ—¶é—´,æˆ‘ä»¬è¿™é‡Œéœ€è¦åŠ ä¸Š8å°æ—¶        statement &#x3D;&gt; &quot;select * from course_pub where timestamp &gt; date_add(:sql_last_value,INTERVAL 8 HOUR)&quot;        #å®šæ—¶é…ç½®        schedule &#x3D;&gt; &quot;* * * * *&quot;        record_last_run &#x3D;&gt; true        last_run_metadata_path &#x3D;&gt; &quot;D:&#x2F;soft&#x2F;elasticsearch&#x2F;logstash-6.8.8&#x2F;config&#x2F;logstash_metadata&quot;        &#125;    &#125;     output &#123;        elasticsearch &#123;        #ESçš„ipåœ°å€å’Œç«¯å£        hosts &#x3D;&gt; &quot;localhost:9200&quot;        #hosts &#x3D;&gt; [&quot;localhost:9200&quot;,&quot;localhost:9202&quot;,&quot;localhost:9203&quot;]        #ESç´¢å¼•åº“åç§°        index &#x3D;&gt; &quot;xc_course&quot;        document_id &#x3D;&gt; &quot;%&#123;id        document_type &#x3D;&gt; &quot;doc&quot;        template &#x3D;&gt;&quot;D:&#x2F;soft&#x2F;elasticsearch&#x2F;logstash-6.8.8&#x2F;config&#x2F;xc_course_template.json&quot;        template_name &#x3D;&gt; &quot;xc_course&quot;        template_overwrite &#x3D;&gt;&quot;true&quot;    &#125; stdout &#123;    #æ—¥å¿—è¾“å‡º    codec &#x3D;&gt; json_lines    &#125;&#125;</code></pre></div><p>è¯´æ˜ï¼š</p><p>1ã€<code>ES</code> é‡‡ç”¨ <code>UTC</code> æ—¶åŒºé—®é¢˜</p><p><code>ES</code> é‡‡ç”¨ <code>UTC</code> æ—¶åŒºï¼Œæ¯”åŒ—äº¬æ—¶é—´æ—©8å°æ—¶ï¼Œæ‰€ä»¥ <code>ES</code> è¯»å–æ•°æ®æ—¶è®©æœ€åæ›´æ–°æ—¶é—´åŠ 8å°æ—¶<br><code>where timestamp &gt; date_add(:sql_last_value,INTERVAL 8 HOUR)</code></p><p>2ã€<code>logstash</code> æ¯ä¸ªæ‰§è¡Œå®Œæˆä¼šåœ¨ <code>config/logstash_metadata</code> è®°å½•æ‰§è¡Œæ—¶é—´ä¸‹æ¬¡ä»¥æ­¤æ—¶é—´ä¸ºåŸºå‡†è¿›è¡Œå¢é‡åŒæ­¥æ•°æ®åˆ°ç´¢å¼•åº“ã€‚</p><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>å¯åŠ¨ <code>logstash.bat</code></p><div class="hljs"><pre><code class="hljs c">.\logstash.bat -f ..\<span class="hljs-built_in">config</span>\mysql.conf</code></pre></div><p><a href="https://qnoss.codeyee.com/20200704_11/image12" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image12.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä¿®æ”¹ <code>course_pub</code> ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”ä¿®æ”¹ <code>timestamp</code> ä¸ºå½“å‰æ—¶é—´ï¼Œè§‚å¯Ÿ <code>Logstash</code> æ—¥å¿—æ˜¯å¦è¯»å–åˆ°è¦ç´¢å¼•çš„æ•°æ®ã€‚</p><p>æœ€åç”¨ <code>head</code> ç™»å½• <code>ES</code> æŸ¥çœ‹ç´¢å¼•æ–‡æ¡£å†…å®¹æ˜¯å¦ä¿®æ”¹ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_11/image13" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image13.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-è¯¾ç¨‹æœç´¢å®æˆ˜"><a href="#3-è¯¾ç¨‹æœç´¢å®æˆ˜" class="headerlink" title="3. è¯¾ç¨‹æœç´¢å®æˆ˜"></a>3. è¯¾ç¨‹æœç´¢å®æˆ˜</h2><h3 id="1ã€éœ€æ±‚åˆ†æ-1"><a href="#1ã€éœ€æ±‚åˆ†æ-1" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h3><p>1ã€æ ¹æ® <strong>åˆ†ç±»</strong> æœç´¢è¯¾ç¨‹ä¿¡æ¯ã€‚</p><p>2ã€æ ¹æ® <strong>å…³é”®å­—</strong> æœç´¢è¯¾ç¨‹ä¿¡æ¯ï¼Œæœç´¢æ–¹å¼ä¸ºå…¨æ–‡æ£€ç´¢ï¼Œå…³é”®å­—éœ€è¦åŒ¹é…è¯¾ç¨‹çš„åç§°ã€ è¯¾ç¨‹å†…å®¹ã€‚</p><p>3ã€æ ¹æ® <strong>éš¾åº¦ç­‰çº§</strong> æœç´¢è¯¾ç¨‹ã€‚</p><p>4ã€æœç´¢ç»“ç‚¹åˆ†é¡µæ˜¾ç¤ºã€‚</p><h4 id="æŠ€æœ¯åˆ†æ"><a href="#æŠ€æœ¯åˆ†æ" class="headerlink" title="æŠ€æœ¯åˆ†æ"></a>æŠ€æœ¯åˆ†æ</h4><p>1ã€æ ¹æ®å…³é”®å­—æœç´¢ï¼Œé‡‡ç”¨ <code>MultiMatchQuery</code>ï¼Œæœç´¢ <code>name</code>ã€<code>description</code>ã€<code>teachplan</code></p><p>2ã€æ ¹æ®åˆ†ç±»ã€è¯¾ç¨‹ç­‰çº§æœç´¢é‡‡ç”¨è¿‡è™‘å™¨å®ç°ã€‚</p><p>3ã€åˆ†é¡µæŸ¥è¯¢ã€‚</p><p>4ã€é«˜äº®æ˜¾ç¤ºã€‚</p><h3 id="2ã€åˆ›å»ºæœç´¢æœåŠ¡å·¥ç¨‹"><a href="#2ã€åˆ›å»ºæœç´¢æœåŠ¡å·¥ç¨‹" class="headerlink" title="2ã€åˆ›å»ºæœç´¢æœåŠ¡å·¥ç¨‹"></a>2ã€åˆ›å»ºæœç´¢æœåŠ¡å·¥ç¨‹</h3><p>è¯¥å·¥ç¨‹ç¯å¢ƒæˆ‘ä»¬åœ¨ <code>day10</code> å·²ç»æ­å»ºå®Œæˆï¼Œå¦‚æœä½ æœªå­¦ä¹ å‰é¢çš„ç« èŠ‚ï¼Œè¯·å‚è€ƒ <code>day10 å…­ã€ç´¢å¼•ç®¡ç†</code> çš„å†…å®¹ã€‚</p><h3 id="3ã€æ„å»ºAPI"><a href="#3ã€æ„å»ºAPI" class="headerlink" title="3ã€æ„å»ºAPI"></a>3ã€æ„å»ºAPI</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.api.search;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CoursePub;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.search.CourseSearchParam;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResponseResult;<span class="hljs-keyword">import</span> io.swagger.annotations.Api;<span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-meta">@Api</span>(value = <span class="hljs-string">"è¯¾ç¨‹æœç´¢"</span>, description = <span class="hljs-string">"åŸºäºESæ„å»ºçš„è¯¾ç¨‹æœç´¢API"</span>,tags = &#123;<span class="hljs-string">"è¯¾ç¨‹æœç´¢"</span>&#125;)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EsCourseConrollerApi</span> </span>&#123;    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è¯¾ç¨‹è¯¦ç»†æœç´¢"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult&lt;CoursePub&gt; <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, CourseSearchParam courseSearchParam)</span> <span class="hljs-keyword">throws</span> IOException</span>;&#125;</code></pre></div><h3 id="4ã€Service"><a href="#4ã€Service" class="headerlink" title="4ã€Service"></a>4ã€Service</h3><h4 id="æŒ‰å…³é”®è¯æœç´¢"><a href="#æŒ‰å…³é”®è¯æœç´¢" class="headerlink" title="æŒ‰å…³é”®è¯æœç´¢"></a>æŒ‰å…³é”®è¯æœç´¢</h4><p>åœ¨ <code>appliction.yml</code> ä¸­é…ç½® <code>source_field</code></p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">elasticsearch:</span>    <span class="hljs-attr">hostlist:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:9200</span> <span class="hljs-comment">#å¤šä¸ªç»“ç‚¹ä¸­é—´ç”¨é€—å·åˆ†éš”</span>    <span class="hljs-attr">course:</span>    <span class="hljs-attr">index:</span> <span class="hljs-string">xc_course</span>    <span class="hljs-attr">type:</span> <span class="hljs-string">doc</span>    <span class="hljs-attr">source_field:</span> <span class="hljs-string">id,name,grade,mt,st,charge,valid,pic,qq,price,price_old,status,studymodel,teachmode,expires,pub_time,start_time,end_time</span></code></pre></div><p><code>service</code> å®Œæ•´ä»£ç å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * è¯¾ç¨‹åˆ—è¡¨æœç´¢</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page é¡µç </span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> size æ¯é¡µæ•°é‡</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseSearchParam æœç´¢å‚æ•°</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult&lt;CoursePub&gt; <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, CourseSearchParam courseSearchParam)</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;    <span class="hljs-comment">//è®¾ç½®ç´¢å¼•</span>    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(es_index);    <span class="hljs-comment">//è®¾ç½®ç±»å‹</span>    searchRequest.types(es_type);    <span class="hljs-comment">//åˆ›å»ºæœç´¢æºå¯¹è±¡</span>    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();    <span class="hljs-comment">//åˆ›å»ºå¸ƒå°”æŸ¥è¯¢å¯¹è±¡</span>    BoolQueryBuilder boolQueryBuilder = <span class="hljs-keyword">new</span> BoolQueryBuilder();    <span class="hljs-comment">//æºå­—æ®µè¿‡æ»¤</span>    String[] fieldArr = source_field.split(<span class="hljs-string">","</span>);    searchSourceBuilder.fetchSource(fieldArr,<span class="hljs-keyword">new</span> String[]&#123;&#125;);    <span class="hljs-comment">//æ ¹æ®å…³é”®å­—è¿›è¡ŒæŸ¥è¯¢</span>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getKeyword()))&#123;        <span class="hljs-comment">//åŒ¹é…å…³é”®è¯</span>        MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(courseSearchParam.getKeyword(), <span class="hljs-string">"name"</span>, <span class="hljs-string">"teachplan"</span>, <span class="hljs-string">"description"</span>);        <span class="hljs-comment">//è®¾ç½®åŒ¹é…å æ¯”</span>        multiMatchQueryBuilder.minimumShouldMatch(<span class="hljs-string">"70%"</span>);        <span class="hljs-comment">//æå‡å­—æ®µçš„æƒé‡å€¼</span>        multiMatchQueryBuilder.field(<span class="hljs-string">"name"</span>,<span class="hljs-number">10</span>);        boolQueryBuilder.must(multiMatchQueryBuilder);    &#125;    <span class="hljs-comment">//æ ¹æ®éš¾åº¦è¿›è¡Œè¿‡æ»¤</span>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getMt()))&#123;        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"mt"</span>,courseSearchParam.getMt()));    &#125;    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getSt()))&#123;        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"st"</span>,courseSearchParam.getSt()));    &#125;    <span class="hljs-comment">//æ ¹æ®ç­‰çº§è¿›è¡Œè¿‡æ»¤</span>    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getGrade()))&#123;        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"grade"</span>,courseSearchParam.getGrade()));    &#125;    <span class="hljs-comment">//è®¾ç½®åˆ†é¡µå‚æ•°</span>    <span class="hljs-keyword">if</span>(page&lt;=<span class="hljs-number">0</span>)&#123;        page = <span class="hljs-number">1</span>;    &#125;    <span class="hljs-keyword">if</span>(size&lt;=<span class="hljs-number">0</span>)&#123;        size = <span class="hljs-number">20</span>;    &#125;    <span class="hljs-comment">//è®¡ç®—æœç´¢èµ·å§‹ä½ç½®</span>    <span class="hljs-keyword">int</span> start = (page-<span class="hljs-number">1</span>) * size;    searchSourceBuilder.from(start);    searchSourceBuilder.size(size);    <span class="hljs-comment">//å°†å¸ƒå°”æŸ¥è¯¢å¯¹è±¡æ·»åŠ åˆ°æœç´¢æºå†…</span>    searchSourceBuilder.query(boolQueryBuilder);    <span class="hljs-comment">//é…ç½®é«˜äº®ä¿¡æ¯</span>    HighlightBuilder highlightBuilder = <span class="hljs-keyword">new</span> HighlightBuilder();    highlightBuilder.preTags(<span class="hljs-string">"&lt;font class='eslight'&gt;"</span>);    highlightBuilder.postTags(<span class="hljs-string">"&lt;/font&gt;"</span>);    <span class="hljs-comment">//è®¾ç½®é«˜äº®å­—æ®µ</span>    highlightBuilder.fields().add(<span class="hljs-keyword">new</span> HighlightBuilder.Field(<span class="hljs-string">"name"</span>));    searchSourceBuilder.highlighter(highlightBuilder);    <span class="hljs-comment">//è¯·æ±‚æœç´¢</span>    searchRequest.source(searchSourceBuilder);    SearchResponse searchResponse = <span class="hljs-keyword">null</span>;    <span class="hljs-keyword">try</span>&#123;        searchResponse = restHighLevelClient.search(searchRequest);    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;        <span class="hljs-comment">//æœç´¢å¼‚å¸¸</span>        e.printStackTrace();        LOGGER.error(<span class="hljs-string">"search error ...&#123;&#125;"</span>,e.getMessage());        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult&lt;&gt;(CommonCode.FAIL,<span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-comment">//ç»“æœæ”¶é›†å¤„ç†</span>    SearchHits hits = searchResponse.getHits();    <span class="hljs-comment">//è·å–åŒ¹é…åº¦é«˜çš„ç»“æœ</span>    SearchHit[] searchHits = hits.getHits();    <span class="hljs-comment">//æ€»è®°å½•æ•°</span>    <span class="hljs-keyword">long</span> totalHits = hits.getTotalHits();    <span class="hljs-comment">//æ•°æ®åˆ—è¡¨</span>    ArrayList&lt;CoursePub&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    <span class="hljs-comment">//æ·»åŠ æ•°æ®</span>    <span class="hljs-keyword">for</span> (SearchHit hit: searchHits)&#123;        CoursePub coursePub = <span class="hljs-keyword">new</span> CoursePub();        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();        <span class="hljs-comment">//å–å‡ºåç§°</span>        String name = (String) sourceAsMap.get(<span class="hljs-string">"name"</span>);        coursePub.setName(name);        <span class="hljs-comment">//å›¾ç‰‡</span>        String pic = (String) sourceAsMap.get(<span class="hljs-string">"pic"</span>);        coursePub.setPic(pic);        <span class="hljs-comment">//ä¼˜æƒ åçš„ä»·æ ¼</span>        Float price = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-keyword">if</span>(sourceAsMap.get(<span class="hljs-string">"price"</span>) !=<span class="hljs-keyword">null</span>)&#123;                price = Float.parseFloat(String.format(<span class="hljs-string">"%.3f"</span>,sourceAsMap.get(<span class="hljs-string">"price"</span>)));            &#125;        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;            e.printStackTrace();        &#125;        coursePub.setPrice(price);        <span class="hljs-comment">//ä¼˜æƒ å‰çš„ä»·æ ¼</span>        Float priceOld = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-keyword">if</span>(sourceAsMap.get(<span class="hljs-string">"price_old"</span>) !=<span class="hljs-keyword">null</span>)&#123;                priceOld = Float.parseFloat(String.format(<span class="hljs-string">"%.3f"</span>,sourceAsMap.get(<span class="hljs-string">"price_old"</span>)));            &#125;        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;            e.printStackTrace();        &#125;        coursePub.setPrice_old(priceOld);        list.add(coursePub);    &#125;    <span class="hljs-comment">//è¿”å›å“åº”ç»“æœ</span>    QueryResult&lt;CoursePub&gt; queryResult = <span class="hljs-keyword">new</span> QueryResult&lt;&gt;();    queryResult.setList(list);    queryResult.setTotal(totalHits);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult&lt;&gt;(CommonCode.SUCCESS,queryResult);&#125;</code></pre></div><p>servcice çš„ä»£ç ä¸­çš„æ³¨é‡Šå·²ç»å†™å¾—å¾ˆè¯¦ç»†äº†ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†åšè¿‡å¤šçš„è§£é‡Šï¼Œè¯·è¯¦ç»†çš„é˜…è¯»ä¸Šè¿°çš„ä»£ç ã€‚</p><h3 id="5ã€Controller"><a href="#5ã€Controller" class="headerlink" title="5ã€Controller"></a>5ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * è¯¾ç¨‹ä¿¡æ¯æœç´¢</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page é¡µç </span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> size æ¯é¡µæ•°é‡</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseSearchParam æœç´¢å‚æ•°</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Override</span><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/list/&#123;page&#125;/&#123;size&#125;"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult&lt;CoursePub&gt; <span class="hljs-title">findList</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"page"</span>)</span> <span class="hljs-keyword">int</span> page,@<span class="hljs-title">PathVariable</span><span class="hljs-params">(<span class="hljs-string">"size"</span>)</span> <span class="hljs-keyword">int</span> size, CourseSearchParam courseSearchParam) <span class="hljs-keyword">throws</span> IOException </span>&#123;    <span class="hljs-keyword">return</span> esCourseService.findList(page,size,courseSearchParam);&#125;</code></pre></div><h3 id="6ã€æµ‹è¯•"><a href="#6ã€æµ‹è¯•" class="headerlink" title="6ã€æµ‹è¯•"></a>6ã€æµ‹è¯•</h3><h4 id="æ ¹æ®å…³é”®å­—æœç´¢"><a href="#æ ¹æ®å…³é”®å­—æœç´¢" class="headerlink" title="æ ¹æ®å…³é”®å­—æœç´¢"></a>æ ¹æ®å…³é”®å­—æœç´¢</h4><p>ä½¿ç”¨ <code>postman</code> æµ‹è¯•</p><p>GET: <a href="http://localhost:40100/search/course/list/1/20?keyword=java" target="_blank" rel="noopener">http://localhost:40100/search/course/list/1/20?keyword=java</a> å¼€å‘</p><p><a href="https://qnoss.codeyee.com/20200704_11/image14" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image14.gif" srcset="/img/loading.gif" alt="img"></a></p><h4 id="æ ¹æ®ä»·æ ¼ã€ç­‰çº§ã€éš¾åº¦è¿›è¡Œæœç´¢"><a href="#æ ¹æ®ä»·æ ¼ã€ç­‰çº§ã€éš¾åº¦è¿›è¡Œæœç´¢" class="headerlink" title="æ ¹æ®ä»·æ ¼ã€ç­‰çº§ã€éš¾åº¦è¿›è¡Œæœç´¢"></a>æ ¹æ®ä»·æ ¼ã€ç­‰çº§ã€éš¾åº¦è¿›è¡Œæœç´¢</h4><p>å¾…æµ‹è¯•</p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElasticSearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day10ï¼šè¯¾ç¨‹å‘å¸ƒã€ElasticSearch</title>
    <link href="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/"/>
    <url>/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day10</code> çš„å†…å®¹</p><ul><li>è¯¾ç¨‹å‘å¸ƒåŠŸèƒ½å¼€å‘</li><li><code>ElasticsSearch</code> å®‰è£…éƒ¨ç½²</li><li><code>ElasticsSearch</code> å¿«é€Ÿå…¥é—¨ã€<code>IK</code> åˆ†è¯å™¨ã€æ˜ å°„ã€ç´¢å¼•</li></ul><h1 id="ä¸€ã€è¯¾ç¨‹å‘å¸ƒ"><a href="#ä¸€ã€è¯¾ç¨‹å‘å¸ƒ" class="headerlink" title="ä¸€ã€è¯¾ç¨‹å‘å¸ƒ"></a>ä¸€ã€è¯¾ç¨‹å‘å¸ƒ</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>è¯¾ç¨‹å‘å¸ƒåå°†ç”Ÿæˆæ­£å¼çš„è¯¾ç¨‹è¯¦æƒ…é¡µé¢ï¼Œè¯¾ç¨‹å‘å¸ƒåç”¨æˆ·å³å¯æµè§ˆè¯¾ç¨‹è¯¦æƒ…é¡µé¢ï¼Œå¹¶å¼€å§‹è¯¾ç¨‹çš„å­¦ä¹ ã€‚è¯¾ç¨‹å‘å¸ƒç”Ÿæˆè¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„æµç¨‹ä¸è¯¾ç¨‹é¢„è§ˆä¸šåŠ¡æµç¨‹ç›¸åŒï¼Œå¦‚ä¸‹ï¼š</p><p>1ã€ç”¨æˆ·è¿›å…¥æ•™å­¦ç®¡ç†ä¸­å¿ƒï¼Œè¿›å…¥æŸä¸ªè¯¾ç¨‹çš„ç®¡ç†ç•Œé¢</p><p>2ã€ç‚¹å‡»è¯¾ç¨‹å‘å¸ƒï¼Œå‰ç«¯è¯·æ±‚åˆ°è¯¾ç¨‹ç®¡ç†æœåŠ¡</p><p>3ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨ <code>CMS</code> ç”Ÿæˆè¯¾ç¨‹å‘å¸ƒé¡µé¢ï¼Œ<code>CMS</code> å°†è¯¾ç¨‹è¯¦æƒ…é¡µé¢å‘å¸ƒåˆ°æœåŠ¡å™¨</p><p>4ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡ä¿®æ”¹è¯¾ç¨‹å‘å¸ƒçŠ¶æ€ä¸º â€œ<strong>å·²å‘å¸ƒ</strong>â€ï¼Œå¹¶å‘å‰ç«¯è¿”å›å‘å¸ƒæˆåŠŸ</p><p>5ã€ç”¨æˆ·åœ¨æ•™å­¦ç®¡ç†ä¸­å¿ƒç‚¹å‡» â€œè¯¾ç¨‹è¯¦æƒ…é¡µé¢â€ é“¾æ¥ï¼ŒæŸ¥çœ‹è¯¾ç¨‹è¯¦æƒ…é¡µé¢å†…å®¹</p><p>æµç¨‹å›¾å¦‚ä¸‹</p><p><a href="https://qnoss.codeyee.com/20200704_10/image1" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image1.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="2-CMSä¸€é”®å‘å¸ƒæ¥å£"><a href="#2-CMSä¸€é”®å‘å¸ƒæ¥å£" class="headerlink" title="2. CMSä¸€é”®å‘å¸ƒæ¥å£"></a>2. CMSä¸€é”®å‘å¸ƒæ¥å£</h2><h3 id="1ã€éœ€æ±‚åˆ†æ"><a href="#1ã€éœ€æ±‚åˆ†æ" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h3><p>æ ¹æ®éœ€æ±‚åˆ†æå†…å®¹ï¼Œéœ€è¦åœ¨ <code>cms</code> æœåŠ¡å¢åŠ é¡µé¢å‘å¸ƒæ¥å£ä¾›è¯¾ç¨‹ç®¡ç†æœåŠ¡è°ƒç”¨ï¼Œæ­¤æ¥å£çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p><p>1ã€æ¥æ”¶è¯¾ç¨‹ç®¡ç†æœåŠ¡å‘å¸ƒçš„é¡µé¢ä¿¡æ¯</p><p>2ã€å°†é¡µé¢ä¿¡æ¯æ·»åŠ åˆ° æ•°æ®åº“<strong>ï¼ˆmongodbï¼‰</strong></p><p>3ã€å¯¹é¡µé¢ä¿¡æ¯è¿›è¡Œé™æ€åŒ–</p><p>4ã€å°†é¡µé¢ä¿¡æ¯å‘å¸ƒåˆ°æœåŠ¡å™¨</p><h3 id="2ã€æ¥å£å®šä¹‰"><a href="#2ã€æ¥å£å®šä¹‰" class="headerlink" title="2ã€æ¥å£å®šä¹‰"></a>2ã€æ¥å£å®šä¹‰</h3><p>1ã€åˆ›å»ºå“åº”ç»“æœç±»å‹</p><p>é¡µé¢å‘å¸ƒæˆåŠŸcmsè¿”å›é¡µé¢çš„ <code>url</code></p><p>é¡µé¢ <code>Url</code> = <code>cmsSite.siteDomain</code> + <code>cmsSite.siteWebPath</code> + <code>cmsPage.pageWebPath</code> + <code>cmsPage.pageName</code></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@NoArgsConstructor</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPostPageResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;    String pageUrl;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CmsPostPageResult</span><span class="hljs-params">(ResultCode resultCode,String pageUrl)</span></span>&#123;        <span class="hljs-keyword">super</span>(resultCode);        <span class="hljs-keyword">this</span>.pageUrl = pageUrl;    &#125;&#125;</code></pre></div><p>2ã€åœ¨ <code>api</code> å·¥ç¨‹å®šä¹‰é¡µé¢å‘å¸ƒæ¥å£</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">   * ä¸€é”®å‘å¸ƒé¡µé¢</span><span class="hljs-comment">*/</span><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"ä¸€é”®å‘å¸ƒé¡µé¢"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPostPageResult <span class="hljs-title">postPageQuick</span><span class="hljs-params">(CmsPage cmsPage)</span></span>;</code></pre></div><h3 id="3ã€Dao"><a href="#3ã€Dao" class="headerlink" title="3ã€Dao"></a>3ã€Dao</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ç»§æ‰¿MongoDBè‡ªå¸¦çš„ä¸€äº›Repository</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsSiteRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsSite</span>,<span class="hljs-title">String</span></span>&#123;&#125;</code></pre></div><h3 id="4ã€Service"><a href="#4ã€Service" class="headerlink" title="4ã€Service"></a>4ã€Service</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ä¸€é”®å‘å¸ƒé¡µé¢</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> cmsPage</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> CmsPostPageResult <span class="hljs-title">postPageQuick</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;    <span class="hljs-comment">//æ·»åŠ é¡µé¢ï¼Œè¿™é‡Œç›´æ¥è°ƒç”¨æˆ‘ä»¬åœ¨åšé¢„è§ˆé¡µé¢æ—¶å€™å¼€å‘çš„ä¿å­˜é¡µé¢æ–¹æ³•</span>    CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.saveCmsPage(cmsPage);    <span class="hljs-keyword">if</span>(!cmsPageResult.isSuccess())&#123;        <span class="hljs-comment">//æ·»åŠ é¡µé¢å¤±è´¥</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPostPageResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);    &#125;    CmsPage saveCmsPage = cmsPageResult.getCmsPage();    String pageId = saveCmsPage.getPageId();    <span class="hljs-comment">//å‘å¸ƒé¡µé¢,é€šçŸ¥cms clientå‘å¸ƒé¡µé¢</span>    ResponseResult responseResult = <span class="hljs-keyword">this</span>.postPage(pageId);    <span class="hljs-keyword">if</span>(!responseResult.isSuccess())&#123;        <span class="hljs-comment">//å‘å¸ƒå¤±è´¥</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPostPageResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-comment">//å¾—åˆ°é¡µé¢çš„urlï¼Œé¡µé¢url=ç«™ç‚¹åŸŸå+ç«™ç‚¹webpath+é¡µé¢webpath+é¡µé¢åç§°</span>    <span class="hljs-comment">//æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦è·å–ç«™ç‚¹ä¿¡æ¯</span>    String siteId = saveCmsPage.getSiteId();    Optional&lt;CmsSite&gt; cmsSiteOptional = cmsSiteRepository.findById(siteId);    <span class="hljs-keyword">if</span>(!cmsSiteOptional.isPresent())&#123;        <span class="hljs-comment">//è·å–ç«™ç‚¹å¼‚å¸¸</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPostPageResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);    &#125;    CmsSite cmsSite = cmsSiteOptional.get();    <span class="hljs-comment">//ç«™ç‚¹å’Œé¡µé¢çš„ä¿¡æ¯</span>    String siteDomain = cmsSite.getSiteDomain();    String siteWebPath = cmsSite.getSiteWebPath();    String pageWebPath = saveCmsPage.getPageWebPath();    String pageName = saveCmsPage.getPageName();    <span class="hljs-comment">//å‘å¸ƒé¡µé¢çš„è®¿é—®åœ°å€</span>    String pageUrl = siteDomain + siteWebPath + pageWebPath + pageName;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPostPageResult(CommonCode.SUCCESS, pageUrl);&#125;</code></pre></div><p>2ã€é¡µé¢å‘å¸ƒæ–¹æ³•</p><h3 id="5ã€Controller"><a href="#5ã€Controller" class="headerlink" title="5ã€Controller"></a>5ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ä¸€é”®å‘å¸ƒé¡µé¢</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> cmsPage</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Override</span><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/postPageQuick"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPostPageResult <span class="hljs-title">postPageQuick</span><span class="hljs-params">(@RequestBody CmsPage cmsPage)</span> </span>&#123;    <span class="hljs-keyword">return</span> pageService.postPageQuick(cmsPage);&#125;</code></pre></div><h2 id="3-è¯¾ç¨‹å‘å¸ƒæ¥å£"><a href="#3-è¯¾ç¨‹å‘å¸ƒæ¥å£" class="headerlink" title="3. è¯¾ç¨‹å‘å¸ƒæ¥å£"></a>3. è¯¾ç¨‹å‘å¸ƒæ¥å£</h2><h3 id="1ã€APIæ¥å£"><a href="#1ã€APIæ¥å£" class="headerlink" title="1ã€APIæ¥å£"></a>1ã€APIæ¥å£</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è¯¾ç¨‹å‘å¸ƒ"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">CoursePublish</span><span class="hljs-params">(String courseId)</span></span>;</code></pre></div><h3 id="2ã€åˆ›å»ºFeign-Client"><a href="#2ã€åˆ›å»ºFeign-Client" class="headerlink" title="2ã€åˆ›å»ºFeign Client"></a>2ã€åˆ›å»ºFeign Client</h3><p>å®šä¹‰ä¸€ä¸ªè¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ï¼Œç”¨äºè¿œç¨‹è°ƒç”¨åˆšæ‰æˆ‘ä»¬åœ¨ CMS æœåŠ¡ä¸­å®šä¹‰çš„ä¸€é”®å‘å¸ƒæ¥å£ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient</span>(value = <span class="hljs-string">"XC-SERVICE-MANAGE-CMS"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageClient</span> </span>&#123;    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/cms/page/postPageQuick"</span>)    <span class="hljs-function">CmsPostPageResult <span class="hljs-title">postPageQuick</span><span class="hljs-params">(@RequestBody CmsPage cmsPage)</span></span>;&#125;</code></pre></div><h3 id="3ã€Service"><a href="#3ã€Service" class="headerlink" title="3ã€Service"></a>3ã€Service</h3><p><strong>1ã€é…ç½®è¯¾ç¨‹å‘å¸ƒé¡µé¢å‚æ•°</strong></p><p>æ–°å¢è¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„ç«™ç‚¹ä¿¡æ¯ï¼Œå¦‚æœå·²å¢åŠ è¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„ç«™ç‚¹åˆ™å¿½ç•¥æ­¤æ­¥éª¤ã€‚</p><p>å‘ <code>mongodb</code> çš„ <code>cms_site</code> ä¸­æ–°å¢å¦‚ä¸‹ä¿¡æ¯</p><div class="hljs"><pre><code class="hljs json">&#123;     <span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5b30b052f58b4411fc6cb1cf"</span>),     <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsSite"</span>,     <span class="hljs-attr">"siteName"</span> : <span class="hljs-string">"è¯¾ç¨‹è¯¦æƒ…ç«™ç‚¹"</span>,     <span class="hljs-attr">"siteDomain"</span> : <span class="hljs-string">"http://www.xuecheng.com"</span>,     <span class="hljs-attr">"sitePort"</span> : <span class="hljs-string">"80"</span>,     <span class="hljs-attr">"siteWebPath"</span> : <span class="hljs-string">"/"</span>,     <span class="hljs-attr">"siteCreateTime"</span> : ISODate(<span class="hljs-string">"2018-02-03T02:34:19.113+0000"</span>)&#125;</code></pre></div><p>åœ¨ <code>application.yml</code> ä¸­é…ç½®</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">course-publish:</span>  <span class="hljs-attr">siteId:</span> <span class="hljs-string">5b30b052f58b4411fc6cb1cf</span>  <span class="hljs-attr">templateId:</span> <span class="hljs-string">5e93d2e3d79e7d6ed1009b95</span>  <span class="hljs-attr">previewUrl:</span> <span class="hljs-string">http://www.xuecheng.com/cms/preview/</span>  <span class="hljs-attr">pageWebPath:</span> <span class="hljs-string">/course/detail/</span>  <span class="hljs-attr">pagePhysicalPath:</span> <span class="hljs-string">G:/job/code/Project/XueChengOnline/xcEduUI01/xuecheng/static/course/detail/</span>  <span class="hljs-attr">dataUrlPre:</span> <span class="hljs-string">http://localhost:31200/course/preview/model/</span></code></pre></div><ul><li><code>siteId</code>ï¼šç«™ç‚¹<code>id</code></li><li><code>templateId</code>ï¼šæ¨¡æ¿<code>id</code></li><li><code>dataurlPre</code>ï¼šæ•°æ®<code>url</code>çš„å‰ç¼€</li><li><code>pageWebPath</code>: é¡µé¢çš„ <code>web</code> è®¿é—®è·¯å¾„</li><li><code>pagePhysicalPath</code>ï¼š è¿™ä¸ªæŒ‡çš„æ˜¯é¡µé¢è¦å‘å¸ƒåˆ° <code>nginx</code> æœåŠ¡å™¨çš„ç‰©ç†è·¯å¾„ï¼Œæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¯ä»¥åŠ¨æ€è°ƒæ•´ï¼Œä¾¿äºæ‰©å±•ã€‚</li></ul><p><strong>2ã€service æ–¹æ³•å¦‚ä¸‹</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ‹¼è£…é¡µé¢ä¿¡æ¯</span><span class="hljs-function"><span class="hljs-keyword">private</span> CmsPage <span class="hljs-title">setPageInfo</span><span class="hljs-params">(String courseId)</span></span>&#123;    <span class="hljs-comment">//è·å–è¯¾ç¨‹ä¿¡æ¯</span>    CourseBase courseBaseById = <span class="hljs-keyword">this</span>.findCourseBaseById(courseId);    <span class="hljs-comment">//æ‹¼è£…é¡µé¢åŸºæœ¬ä¿¡æ¯</span>    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();    cmsPage.setDataUrl(publish_dataUrlPre + courseId);    cmsPage.setPagePhysicalPath(publish_page_physicalpath);    cmsPage.setPageWebPath(publish_page_webpath);    cmsPage.setSiteId(publish_siteId);    cmsPage.setTemplateId(publish_templateId);    cmsPage.setPageName(courseId + <span class="hljs-string">".html"</span>);    <span class="hljs-comment">//é¡µé¢åˆ«å</span>    cmsPage.setPageAliase(courseBaseById.getName());    <span class="hljs-keyword">return</span> cmsPage;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> * è¯¾ç¨‹è¯¦ç»†é¡µé¢å‘å¸ƒ</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Transactional</span><span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">coursePublish</span><span class="hljs-params">(String courseId)</span></span>&#123;    <span class="hljs-comment">//æ‹¼è£…é¡µé¢ä¿¡æ¯</span>    CmsPage cmsPage = setPageInfo(courseId);    <span class="hljs-comment">//å‘å¸ƒè¯¾ç¨‹è¯¦ç»†é¡µé¢</span>    CmsPostPageResult cmsPostPageResult = cmsPageClient.postPageQuick(cmsPage);    <span class="hljs-keyword">if</span>(!cmsPostPageResult.isSuccess())&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CoursePublishResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-comment">//æ›´æ–°è¯¾ç¨‹çŠ¶æ€</span>    CourseBase courseBaseById = <span class="hljs-keyword">this</span>.findCourseBaseById(courseId);    courseBaseById.setStatus(<span class="hljs-string">"202002"</span>);    courseBaseRepository.save(courseBaseById);    <span class="hljs-comment">//è¯¾ç¨‹ç´¢å¼•...</span>    <span class="hljs-comment">//è¯¾ç¨‹ç¼“å­˜...</span>    <span class="hljs-comment">//é¡µé¢url</span>    String pageUrl = cmsPostPageResult.getPageUrl();    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CoursePublishResult(CommonCode.SUCCESS,pageUrl);&#125;</code></pre></div><h3 id="4ã€Controller"><a href="#4ã€Controller" class="headerlink" title="4ã€Controller"></a>4ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * è¯¾ç¨‹å‘å¸ƒ</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Override</span><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/publish/&#123;id&#125;"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">CoursePublish</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String courseId) </span>&#123;    <span class="hljs-keyword">return</span> courseService.coursePublish(courseId);&#125;</code></pre></div><p>5ã€æ¥å£æµ‹è¯•</p><h2 id="4-æµ‹è¯•CMSä¸€é”®å‘å¸ƒæ¥å£"><a href="#4-æµ‹è¯•CMSä¸€é”®å‘å¸ƒæ¥å£" class="headerlink" title="4. æµ‹è¯•CMSä¸€é”®å‘å¸ƒæ¥å£"></a>4. æµ‹è¯•CMSä¸€é”®å‘å¸ƒæ¥å£</h2><p><strong>æµ‹è¯•å‰å‡†å¤‡å·¥ä½œ</strong></p><p>1ã€å¯åŠ¨<code>RabbitMQ</code>æœåŠ¡<br>2ã€å¯åŠ¨ <code>cms</code> ã€<code>course</code> æœåŠ¡<br>3ã€å¯åŠ¨ <code>cms_client</code>ï¼Œæ³¨æ„é…ç½® <code>routingKey</code> å’Œé˜Ÿåˆ—åç§°ï¼Œ<code>routingKey</code> ä¸ºæ‰€ä½¿ç”¨çš„ç«™ç‚¹id</p><p>4ã€è¿™é‡Œæˆ‘ä»¬åˆ†åˆ«åœ¨ <code>course</code> ã€<code>cms</code>ã€cms client ä¸‰ä¸ªæœåŠ¡å†…å¯¹åº”çš„åœ°æ–¹æ‰“ä¸Šæ–­ç‚¹ï¼Œè§‚å¯Ÿå‘å¸ƒçš„æµç¨‹</p><p><code>course</code> æœåŠ¡æ–­ç‚¹ï¼Œæˆ‘ä»¬è®¾ç½®åœ¨è¿œç¨‹è°ƒç”¨ cms ä¸€é”®å‘å¸ƒæ¥å£è¿”å›ç»“æœä¹‹å</p><p><a href="https://qnoss.codeyee.com/20200704_10/image2" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image2.png" srcset="/img/loading.gif" alt="img"></a></p><p>cms æœåŠ¡æ–­ç‚¹ï¼Œåœ¨ <strong>ä¸€é”®å‘å¸ƒæ¥å£</strong> å¼€å§‹æ‰§è¡Œçš„åœ°æ–¹æˆ‘ä»¬æ‰“ä¸Šæ–­ç‚¹</p><p><a href="https://qnoss.codeyee.com/20200704_10/image3" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image3.png" srcset="/img/loading.gif" alt="img"></a></p><p>å½“ cms å®¢æˆ·ç«¯æ¥æ”¶åˆ° cms é€šè¿‡ rabbitMQ å‘é€çš„æ¶ˆæ¯åï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•å°†é¡µé¢ä¿å­˜åˆ° nginx æœåŠ¡å™¨çš„ç‰©ç†è·¯å¾„å†…</p><p><a href="https://qnoss.codeyee.com/20200704_10/image4" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image4.png" srcset="/img/loading.gif" alt="img"></a></p><p>å‡†å¤‡å·¥ä½œåšå®Œäº†ï¼Œæˆ‘ä»¬åœ¨ course æœåŠ¡ç”Ÿæˆçš„ sawgger-ui è¿›è¡Œæµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_10/image5" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image5.png" srcset="/img/loading.gif" alt="img"></a></p><p>å‘é€è¯·æ±‚åï¼Œæˆ‘ä»¬åœ¨ idea ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ–­ç‚¹å·²ç»è·‘åˆ°äº† cms æœåŠ¡çš„ä¸€é”®å‘å¸ƒæ¥å£</p><p><a href="https://qnoss.codeyee.com/20200704_10/image6" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image6.png" srcset="/img/loading.gif" alt="img"></a></p><p>ç»§ç»­æ‰§è¡Œçš„è¯ï¼Œ<code>cms</code> æœåŠ¡ä¼šè°ƒç”¨ <code>this.postPage</code> æ–¹æ³•ï¼Œè·å–è¯¥é¡µé¢çš„ æ•°æ®æ¨¡å‹ã€ä»¥åŠæ¨¡æ¿æ•°æ®ï¼Œå°†æ•°æ®é™æ€åŒ–åå¾—åˆ°å®Œæ•´çš„é¡µé¢æ•°æ®ï¼Œå¹¶ä¸”å†™å…¥åˆ° <code>GridFS</code> ä¸­ï¼›</p><p>å†™å…¥ <code>GridFS</code>åé€šè¿‡ <code>rabbitMQ</code> å‘é€æ¶ˆæ¯åˆ° <code>cms client</code> ï¼Œæ¶ˆæ¯çš„å†…å®¹åŒ…å«ä¸€ä¸ªé¡µé¢<code>id</code>ï¼Œå…¥ä¸‹å›¾ï¼Œæ–­ç‚¹å·²ç»èµ°åˆ°äº† <code>cms client</code> æœåŠ¡çš„ <code>savePageToServerPath</code> æ–¹æ³•ä¸­</p><p><a href="https://qnoss.codeyee.com/20200704_10/image7" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image7.png" srcset="/img/loading.gif" alt="img"></a></p><p>``cms client<code>æ¥æ”¶åˆ°</code>pageId<code>åï¼Œè·å–è¯¥é¡µé¢æ•°æ®çš„ fileIdï¼Œé€šè¿‡è¯¥idåˆ°</code>GridFS` ä¸­æ‰¾åˆ°è¯¥é¡µé¢çš„æ•°æ®ï¼Œå¹¶å†™å…¥åˆ°é¡µé¢çš„ç‰©ç†è·¯å¾„å†…ï¼Œå†™å…¥å®Œæˆåï¼Œå›åˆ° cms æœåŠ¡å†…æ‹¼è£…å‘å¸ƒåçš„é¡µé¢åœ°å€ï¼Œå†è¿”å›åˆ° course æœåŠ¡</p><p><a href="https://qnoss.codeyee.com/20200704_10/image8" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image8.png" srcset="/img/loading.gif" alt="img"></a></p><p>course æœåŠ¡æ¥æ”¶åˆ° cms çš„å“åº”ï¼Œå–å‡º pageUrl è¿”å›åˆ°å‰ç«¯ï¼Œå¦‚ä¸‹å›¾</p><p><a href="https://qnoss.codeyee.com/20200704_10/image9" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image9.png" srcset="/img/loading.gif" alt="img"></a></p><p>å›åˆ° swagger uiï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»è¿”å›äº†ä¸€ä¸ªå‘å¸ƒæˆåŠŸçš„url</p><p><a href="https://qnoss.codeyee.com/20200704_10/image10" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image10.png" srcset="/img/loading.gif" alt="img"></a></p><p>è®¿é—®é¡µé¢çœ‹ä¸‹æ•ˆæœ</p><p><a href="https://qnoss.codeyee.com/20200704_10/image11" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image11.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="5-å‰ç«¯é¡µé¢å¼€å‘ä¸æµ‹è¯•"><a href="#5-å‰ç«¯é¡µé¢å¼€å‘ä¸æµ‹è¯•" class="headerlink" title="5. å‰ç«¯é¡µé¢å¼€å‘ä¸æµ‹è¯•"></a>5. å‰ç«¯é¡µé¢å¼€å‘ä¸æµ‹è¯•</h2><p><strong>1ã€é¡µé¢å¼€å‘</strong></p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-card</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box-card"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"header"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"clearfix"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>è¯¾ç¨‹å‘å¸ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text item"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"course.status == '202001'"</span>&gt;</span>      çŠ¶æ€ï¼šåˆ¶ä½œä¸­<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>  @<span class="hljs-attr">click.native</span>=<span class="hljs-string">"publish"</span> &gt;</span>æ–°è¯¾ç¨‹å‘å¸ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"course.status == '202003'"</span>&gt;</span>      çŠ¶æ€ï¼šå·²ä¸‹çº¿      <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">"'http://www.xuecheng.com/course/detail/'+this.courseid+'.html'"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>ç‚¹æˆ‘æŸ¥çœ‹è¯¾ç¨‹è¯¦æƒ…é¡µé¢ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"course.status == '202002'"</span>&gt;</span>      çŠ¶æ€ï¼šå·²å‘å¸ƒ<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>  @<span class="hljs-attr">click.native</span>=<span class="hljs-string">"publish"</span> &gt;</span>ä¿®æ”¹å‘å¸ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">"'http://www.xuecheng.com/course/detail/'+this.courseid+'.html'"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>ç‚¹æˆ‘æŸ¥çœ‹è¯¾ç¨‹è¯¦æƒ…é¡µé¢ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-card</span>&gt;</span></code></pre></div><p><strong>2ã€è·å–è¯¾ç¨‹çŠ¶æ€</strong></p><div class="hljs"><pre><code class="hljs js">getCourseView()&#123;  courseApi.findCourseView(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;    <span class="hljs-keyword">if</span>(res)&#123;        <span class="hljs-comment">//è·å–è¯¾ç¨‹çŠ¶æ€</span>        <span class="hljs-keyword">this</span>.course.status = res.status;    &#125;  &#125;)&#125;</code></pre></div><p>åœ¨é¡µé¢åˆå§‹åŒ–å®Œæˆå…¶å‰æ‰§è¡Œ</p><div class="hljs"><pre><code class="hljs js">mounted()&#123;  <span class="hljs-comment">//è¯¾ç¨‹id</span>  <span class="hljs-keyword">this</span>.courseid = <span class="hljs-keyword">this</span>.$route.params.courseid;  <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span>  <span class="hljs-keyword">this</span>.getCourseView();&#125;</code></pre></div><p><strong>3ã€é¡µé¢å‘å¸ƒæ¥å£</strong></p><p>apiæ¥å£å®šä¹‰</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/*å‘å¸ƒè¯¾ç¨‹*/</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> publish = <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/course/publish/'</span>+id);&#125;</code></pre></div><p>apiæ¥å£å®ç°</p><div class="hljs"><pre><code class="hljs js">publish()&#123;  <span class="hljs-comment">//è¯¾ç¨‹å‘å¸ƒ</span>  courseApi.publish(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;      <span class="hljs-keyword">if</span>(res.success)&#123;          <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">"å‘å¸ƒæˆåŠŸï¼Œè¯·ç‚¹å‡»ä¸‹è¾¹çš„é“¾æ¥æŸ¥è¯¢è¯¾ç¨‹è¯¦æƒ…é¡µé¢"</span>)          <span class="hljs-keyword">this</span>.getCourseView();      &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">this</span>.$message.error(res.message)      &#125;  &#125;)&#125;,</code></pre></div><p>æµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_10/image12" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image12.gif" srcset="/img/loading.gif" alt="img"></a></p><h1 id="äºŒã€åˆè¯†-Elastic-Search"><a href="#äºŒã€åˆè¯†-Elastic-Search" class="headerlink" title="äºŒã€åˆè¯† Elastic Search"></a>äºŒã€åˆè¯† Elastic Search</h1><h2 id="1-æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#1-æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>1. æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h2><h3 id="1ã€ç®€å†"><a href="#1ã€ç®€å†" class="headerlink" title="1ã€ç®€å†"></a>1ã€ç®€å†</h3><p>ç™¾åº¦ç™¾ç§‘</p><p><a href="https://qnoss.codeyee.com/20200704_10/image13" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image13.png" srcset="/img/loading.gif" alt="img"></a></p><p>å®˜æ–¹ç½‘å€ï¼š<a href="https://www.elastic.co/cn/products/elasticsearch" target="_blank" rel="noopener">https://www.elastic.co/cn/products/elasticsearch</a></p><p>Github ï¼š<a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener">https://github.com/elastic/elasticsearch</a></p><p><strong>æ€»ç»“ï¼š</strong></p><p>1ã€<code>elasticsearch</code>æ˜¯ä¸€ä¸ªåŸºäº<code>Lucene</code>çš„é«˜æ‰©å±•çš„åˆ†å¸ƒå¼æœç´¢æœåŠ¡å™¨ï¼Œæ”¯æŒå¼€ç®±å³ç”¨ã€‚<br>2ã€<code>elasticsearch</code> éšè—äº† <code>Lucene</code> çš„å¤æ‚æ€§ï¼Œå¯¹å¤–æä¾› <code>Restful</code> æ¥å£æ¥æ“ä½œç´¢å¼•ã€æœç´¢ã€‚</p><p><strong>çªå‡ºä¼˜ç‚¹ï¼š</strong></p><ol><li>æ‰©å±•æ€§å¥½ï¼Œå¯éƒ¨ç½²ä¸Šç™¾å°æœåŠ¡å™¨é›†ç¾¤ï¼Œå¤„ç†PBçº§æ•°æ®ã€‚</li><li>è¿‘å®æ—¶çš„å»ç´¢å¼•æ•°æ®ã€æœç´¢æ•°æ®ã€‚</li></ol><p>å¸‚é¢ä¸Šçš„åŒç±»å‹çš„äº§å“æœ‰ <code>solr</code> ï¼Œé‚£ä¹ˆ <code>es</code> å’Œ <code>solr</code> é€‰æ‹©å“ªä¸ªï¼Ÿ</p><p>å¦‚æœä½ å…¬å¸ç°åœ¨ç”¨çš„ <code>solr</code> å¯ä»¥æ»¡è¶³éœ€æ±‚å°±ä¸è¦æ¢äº†ã€‚</p><p>å¦‚æœä½ å…¬å¸å‡†å¤‡è¿›è¡Œå…¨æ–‡æ£€ç´¢é¡¹ç›®çš„å¼€å‘ï¼Œå»ºè®®ä¼˜å…ˆè€ƒè™‘ <code>elasticsearch</code>ï¼Œå› ä¸ºåƒ <code>Github</code>è¿™æ ·å¤§è§„æ¨¡çš„æœç´¢éƒ½åœ¨ç”¨å®ƒã€‚</p><h3 id="2ã€åŸç†äºåº”ç”¨"><a href="#2ã€åŸç†äºåº”ç”¨" class="headerlink" title="2ã€åŸç†äºåº”ç”¨"></a>2ã€åŸç†äºåº”ç”¨</h3><p>ç´¢å¼•ç»“æ„</p><p>ä¸‹å›¾æ˜¯ <code>ElasticSearch</code> çš„ç´¢å¼•ç»“æ„ï¼Œä¸‹è¾¹é»‘è‰²éƒ¨åˆ†æ˜¯ç‰©ç†ç»“æ„ï¼Œä¸Šè¾¹é»„è‰²éƒ¨åˆ†æ˜¯é€»è¾‘ç»“æ„ï¼Œé€»è¾‘ç»“æ„ä¹Ÿæ˜¯ä¸ºäº†æ›´å¥½çš„å»æè¿° <code>ElasticSearch</code> çš„å·¥ä½œåŸç†åŠå»ä½¿ç”¨ç‰©ç†ç»“æ„ä¸­çš„ç´¢å¼•æ–‡ä»¶ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_10/image14" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image14.png" srcset="/img/loading.gif" alt="img"></a></p><p>é€»è¾‘ç»“æ„éƒ¨åˆ†æ˜¯ä¸€ä¸ªå€’æ’ç´¢å¼•è¡¨ï¼š</p><p>1ã€å°†è¦æœç´¢çš„æ–‡æ¡£å†…å®¹åˆ†è¯ï¼Œæ‰€æœ‰ä¸é‡å¤çš„è¯ç»„æˆåˆ†è¯åˆ—è¡¨ã€‚</p><p>2ã€å°†æœç´¢çš„æ–‡æ¡£æœ€ç»ˆä»¥ <code>Document</code> æ–¹å¼å­˜å‚¨èµ·æ¥ã€‚</p><p>3ã€æ¯ä¸ªè¯å’Œ <code>docment</code> éƒ½æœ‰å…³è”ã€‚</p><p>å¦‚ä¸‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_10/image15" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image15.png" srcset="/img/loading.gif" alt="img"></a></p><p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æœç´¢ <code>quick brown</code> ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥æ‰¾åŒ…å«æ¯ä¸ªè¯æ¡çš„æ–‡æ¡£ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_10/image16" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image16.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä¸¤ä¸ªæ–‡æ¡£éƒ½åŒ¹é…ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªåŒ¹é…åº¦æ›´é«˜ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä»…è®¡ç®—åŒ¹é…è¯æ¡æ•°é‡çš„ç®€å• ç›¸ä¼¼æ€§ç®—æ³• ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥è¯´ï¼Œå¯¹äºæˆ‘ä»¬æŸ¥è¯¢çš„ç›¸å…³æ€§æ¥è®²ï¼Œç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªæ–‡æ¡£æ›´ä½³ã€‚</p><blockquote><p>æ­£æ’ç´¢å¼•ï¼šæ ¹æ®è¯ä¸æ–‡ç« å†…å®¹çš„å…³ç³»è¿›è¡Œç´¢å¼•ã€‚</p><p>å€’æ’ç´¢å¼•ï¼šæ ¹æ®è¯ä¸æ–‡ç« çš„å…³ç³»è¿›è¡Œç´¢å¼•ï¼Œéœ€è¦æå‰å¯¹è¯å’Œæ–‡ç« è¿›è¡Œå…³è”ã€‚</p></blockquote><h3 id="3ã€å¦‚ä½•ä½¿ç”¨esï¼Ÿ"><a href="#3ã€å¦‚ä½•ä½¿ç”¨esï¼Ÿ" class="headerlink" title="3ã€å¦‚ä½•ä½¿ç”¨esï¼Ÿ"></a>3ã€å¦‚ä½•ä½¿ç”¨esï¼Ÿ</h3><p><code>Elasticsearch</code> æä¾› <code>RESTful Api</code> æ¥å£è¿›è¡Œç´¢å¼•ã€æœç´¢ï¼Œå¹¶ä¸”æ”¯æŒå¤šç§å®¢æˆ·ç«¯ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_10/image17" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image17.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä¸‹å›¾æ˜¯esåœ¨é¡¹ç›®ä¸­çš„åº”ç”¨æ–¹å¼ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_10/image18" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image18.png" srcset="/img/loading.gif" alt="img"></a></p><p>1ï¼‰ç”¨æˆ·åœ¨å‰ç«¯æœç´¢å…³é”®å­—</p><p>2ï¼‰é¡¹ç›®å‰ç«¯é€šè¿‡ <code>http</code> æ–¹å¼è¯·æ±‚é¡¹ç›®æœåŠ¡ç«¯</p><p>3ï¼‰é¡¹ç›®æœåŠ¡ç«¯é€šè¿‡ <code>Http RESTful</code> æ–¹å¼è¯·æ±‚ <code>ES</code> é›†ç¾¤è¿›è¡Œæœç´¢</p><p>4ï¼‰<code>ES</code> é›†ç¾¤ä»ç´¢å¼•åº“æ£€ç´¢æ•°æ®ã€‚</p><h2 id="2-å®‰è£…-Elastic-Search"><a href="#2-å®‰è£…-Elastic-Search" class="headerlink" title="2. å®‰è£… Elastic Search"></a>2. å®‰è£… Elastic Search</h2><h3 id="1ã€å®‰è£…"><a href="#1ã€å®‰è£…" class="headerlink" title="1ã€å®‰è£…"></a>1ã€å®‰è£…</h3><p>å®‰è£…é…ç½®ï¼š</p><p>1ã€æ–°ç‰ˆæœ¬è¦æ±‚è‡³å°‘ <code>jdk1.8</code> ä»¥ä¸Šã€‚</p><p>2ã€æ”¯æŒ<code>tar</code>ã€<code>zip</code>ã€<code>rpm</code>ç­‰å¤šç§å®‰è£…æ–¹å¼ã€‚åœ¨ <code>windows</code> ä¸‹å¼€å‘å»ºè®®ä½¿ç”¨ZIPå®‰è£…æ–¹å¼ã€‚</p><p>3ã€æ”¯æŒ <code>docker</code> æ–¹å¼å®‰è£…</p><p>è¯¦ç»†å‚è§ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html</a></p><p>æ³¨æ„è§†é¢‘æ•™ç¨‹ä¸­ç”¨çš„æ˜¯6.2.1çš„ï¼Œä¸ºäº†é€‚åº”è¾ƒæ–°çš„ç‰ˆæœ¬è¿™é‡Œæˆ‘è¿™é‡Œä¸‹è½½ <code>6.8.8</code> çš„ç‰ˆæœ¬ä½œä¸ºæ¼”ç¤º</p><blockquote><p>æˆªè‡³ç°åœ¨å®˜æ–¹å·²ç»æ›´æ–° åˆ°äº† 7.7.*ï¼Œä»è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒæ¥çœ‹ï¼Œ6å’Œ7åº”è¯¥æœ‰æ¶æ„ä¸Šçš„é‡å¤§å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯é€‰æ‹©6ç³»çš„æœ€æ–°ä¸€ä¸ªç‰ˆæœ¬é¿å…è¸©å‘ï¼Œä»¥åæœ‰éœ€æ±‚å†å»å¯¹æ¯”7çš„å·®å¼‚ã€‚</p></blockquote><p><a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.8.zip" target="_blank" rel="noopener">https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.8.zip</a></p><p>å…¶ä»–ç‰ˆæœ¬ä¸‹è½½ï¼š<a href="https://www.elastic.co/cn/downloads/past-releases" target="_blank" rel="noopener">https://www.elastic.co/cn/downloads/past-releases</a></p><p>ä¸‹è½½å®Œæˆåæˆ‘ä»¬è§£å‹ <code>elasticsearch-*.*.*.zip</code></p><p><a href="https://qnoss.codeyee.com/20200704_10/image19" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image19.png" srcset="/img/loading.gif" alt="img"></a></p><p><code>bin</code>ï¼šè„šæœ¬ç›®å½•ï¼ŒåŒ…æ‹¬ï¼šå¯åŠ¨ã€åœæ­¢ç­‰å¯æ‰§è¡Œè„šæœ¬</p><p><code>config</code>ï¼šé…ç½®æ–‡ä»¶ç›®å½•</p><p><code>data</code>ï¼šç´¢å¼•ç›®å½•ï¼Œå­˜æ”¾ç´¢å¼•æ–‡ä»¶çš„åœ°æ–¹</p><p><code>logs</code>ï¼šæ—¥å¿—ç›®å½•</p><p><code>modules</code>ï¼šæ¨¡å—ç›®å½•ï¼ŒåŒ…æ‹¬äº†esçš„åŠŸèƒ½æ¨¡å—</p><p><code>plugins</code> :æ’ä»¶ç›®å½•ï¼Œesæ”¯æŒæ’ä»¶æœºåˆ¶</p><h3 id="2ã€é…ç½®æ–‡ä»¶"><a href="#2ã€é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€é…ç½®æ–‡ä»¶"></a>2ã€é…ç½®æ–‡ä»¶</h3><p>ESçš„é…ç½®æ–‡ä»¶çš„åœ°å€æ ¹æ®å®‰è£…å½¢å¼çš„ä¸åŒè€Œä¸åŒï¼š</p><p>1ã€ä½¿ç”¨ <code>zip</code>ã€<code>tar</code> å®‰è£…ï¼Œé…ç½®æ–‡ä»¶çš„åœ°å€åœ¨å®‰è£…ç›®å½•çš„ <code>config</code> ä¸‹ã€‚</p><p>2ã€ä½¿ç”¨ <code>RPM</code> å®‰è£…ï¼Œé…ç½®æ–‡ä»¶åœ¨ <code>/etc/elasticsearch</code> ä¸‹ã€‚</p><p>3ã€ä½¿ç”¨ <code>MSI</code> å®‰è£…ï¼Œé…ç½®æ–‡ä»¶çš„åœ°å€åœ¨å®‰è£…ç›®å½•çš„ <code>config</code> ä¸‹ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å°† <code>config</code> ç›®å½•åœ°å€å†™å…¥ç¯å¢ƒå˜é‡<br><code>ES_PATH_CONF</code>ã€‚</p><p>æœ¬æ•™ç¨‹ä½¿ç”¨çš„ <code>zip</code> åŒ…å®‰è£…ï¼Œé…ç½®æ–‡ä»¶åœ¨ESå®‰è£…ç›®å½•çš„<code>config</code>ä¸‹ã€‚</p><p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p><ul><li><code>elasticsearch.yml</code> ï¼š ç”¨äºé…ç½®Elasticsearchè¿è¡Œå‚æ•°</li><li><code>jvm.options</code> ï¼š ç”¨äºé…ç½®Elasticsearch JVMè®¾ç½®</li><li><code>log4j2.properties</code>ï¼š ç”¨äºé…ç½®Elasticsearchæ—¥å¿—</li></ul><h4 id="elasticsearch-yml"><a href="#elasticsearch-yml" class="headerlink" title="elasticsearch.yml"></a><strong>elasticsearch.yml</strong></h4><p>é…ç½®æ ¼å¼æ˜¯ <code>YAML</code>ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p><p><strong>æ–¹å¼1ï¼šå±‚æ¬¡æ–¹å¼</strong></p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">path:</span>   <span class="hljs-attr">data:</span> <span class="hljs-string">/var/lib/elasticsearch</span>  <span class="hljs-attr">logs:</span> <span class="hljs-string">/var/log/elasticsearch</span></code></pre></div><p><strong>æ–¹å¼2ï¼šå±æ€§æ–¹å¼</strong></p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">path.data:</span> <span class="hljs-string">/var/lib/elasticsearch</span><span class="hljs-attr">path.logs:</span> <span class="hljs-string">/var/log/elasticsearch</span></code></pre></div><p>æœ¬é¡¹ç›®é‡‡ç”¨æ–¹å¼2ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">xuecheng</span><span class="hljs-attr">node.name:</span> <span class="hljs-string">xc_node_1</span><span class="hljs-attr">network.host:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-attr">http.port:</span> <span class="hljs-number">9200</span><span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9300</span><span class="hljs-attr">node.master:</span> <span class="hljs-literal">true</span><span class="hljs-attr">node.data:</span> <span class="hljs-literal">true</span><span class="hljs-comment">#discovery.zen.ping.unicast.hosts: ["0.0.0.0:9300", "0.0.0.0:9301", "0.0.0.0:9302"]</span><span class="hljs-attr">discovery.zen.minimum_master_nodes:</span> <span class="hljs-number">1</span><span class="hljs-attr">bootstrap.memory_lock:</span> <span class="hljs-literal">false</span><span class="hljs-attr">node.max_local_storage_nodes:</span> <span class="hljs-number">1</span><span class="hljs-attr">path.data:</span> <span class="hljs-string">D:\ElasticSearch\elasticsearchâ€6.2.1\data</span><span class="hljs-attr">path.logs:</span> <span class="hljs-string">D:\ElasticSearch\elasticsearchâ€6.2.1\logs</span><span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span><span class="hljs-string">http.cors.allowâ€origin:</span> <span class="hljs-string">/.*/</span></code></pre></div><p>æ³¨æ„ <code>path.data</code> å’Œ <code>path.logs</code> è·¯å¾„é…ç½®æ­£ç¡®ã€‚</p><p>å¸¸ç”¨çš„é…ç½®é¡¹å¦‚ä¸‹ï¼š</p><table><thead><tr><th>é…ç½®å­—æ®µ</th><th>æè¿°</th></tr></thead><tbody><tr><td>cluster.name</td><td>é…ç½® <code>elasticsearch</code> çš„é›†ç¾¤åç§°ï¼Œé»˜è®¤æ˜¯ <code>elasticsearch</code>ã€‚å»ºè®®ä¿®æ”¹æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ã€‚</td></tr><tr><td>node.name</td><td>èŠ‚ç‚¹åï¼Œé€šå¸¸ä¸€å°ç‰©ç†æœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ<code>es</code> ä¼šé»˜è®¤éšæœºæŒ‡å®šä¸€ä¸ªåå­—ï¼Œå»ºè®®æŒ‡å®šä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ï¼Œæ–¹ä¾¿ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆä¸€ä¸ª <code>cluster</code> é›†ç¾¤ï¼Œé›†ç¾¤æ˜¯ä¸€ä¸ªé€»è¾‘çš„æ¦‚å¿µï¼ŒèŠ‚ç‚¹æ˜¯ç‰©ç†æ¦‚å¿µï¼Œåè¾¹ç« èŠ‚ä¼šè¯¦ç»†ä»‹ç»ã€‚</td></tr><tr><td>path.conf</td><td>è®¾ç½®é…ç½®æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œtaræˆ–zipåŒ…å®‰è£…é»˜è®¤åœ¨ <code>es</code> æ ¹ç›®å½•ä¸‹çš„ <code>config</code> æ–‡ä»¶å¤¹ï¼Œ<code>rpm</code> å®‰è£…é»˜è®¤åœ¨ <code>/etc/</code></td></tr><tr><td>path.logs</td><td>è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„ <code>logs</code> æ–‡ä»¶å¤¹</td></tr><tr><td>path.plugins</td><td>è®¾ç½®æ’ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œé»˜è®¤æ˜¯ <code>es</code> æ ¹ç›®å½•ä¸‹çš„ <code>plugins</code> æ–‡ä»¶å¤¹</td></tr><tr><td>bootstrap.memory_lock</td><td><code>true</code> è®¾ç½®ä¸º <code>true</code> å¯ä»¥é”ä½ <code>ES</code> ä½¿ç”¨çš„å†…å­˜ï¼Œé¿å…å†…å­˜ä¸ <code>swap</code> åˆ†åŒºäº¤æ¢æ•°æ®ã€‚</td></tr><tr><td>elasticsearch path.data</td><td>è®¾ç½®ç´¢å¼•æ•°æ®çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯ <code>es</code> æ ¹ç›®å½•ä¸‹çš„ <code>data</code> æ–‡ä»¶å¤¹ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªå­˜å‚¨è·¯å¾„ï¼Œç”¨é€—å·éš”å¼€ã€‚ <code>path.logs</code>: è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„ <code>logs</code> æ–‡ä»¶å¤¹</td></tr><tr><td>network.host</td><td>è®¾ç½®ç»‘å®šä¸»æœºçš„ <code>ip</code> åœ°å€ï¼Œè®¾ç½®ä¸º <code>0.0.0.0</code> è¡¨ç¤ºç»‘å®šä»»ä½• <code>ip</code>ï¼Œå…è®¸å¤–ç½‘è®¿é—®ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®ä¸ºå…·ä½“çš„ <code>ip</code>ã€‚</td></tr><tr><td>http.port</td><td><code>9200</code> è®¾ç½®å¯¹å¤–æœåŠ¡çš„ <code>http</code> ç«¯å£ï¼Œé»˜è®¤ä¸º <code>9200</code>ã€‚</td></tr><tr><td>transport.tcp.port</td><td><code>9300</code> é›†ç¾¤ç»“ç‚¹ä¹‹é—´é€šä¿¡ç«¯å£</td></tr><tr><td>node.master</td><td>æŒ‡å®šè¯¥èŠ‚ç‚¹æ˜¯å¦æœ‰èµ„æ ¼è¢«é€‰ä¸¾æˆä¸º <code>master</code> ç»“ç‚¹ï¼Œé»˜è®¤æ˜¯trueï¼Œå¦‚æœåŸæ¥çš„masterå®•æœºä¼šé‡æ–°é€‰ä¸¾æ–°çš„masterã€‚</td></tr><tr><td>node.data</td><td>æŒ‡å®šè¯¥èŠ‚ç‚¹æ˜¯å¦å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œé»˜è®¤ä¸º <code>true</code>ã€‚</td></tr><tr><td>discovery.zen.ping.unicast.hosts</td><td>[â€œhost1:portâ€, â€œhost2:portâ€, â€œâ€¦â€] è®¾ç½®é›†ç¾¤ä¸­ <code>master</code> èŠ‚ç‚¹çš„åˆå§‹åˆ—è¡¨ã€‚</td></tr><tr><td>discovery.zen.ping.timeout</td><td><code>3s</code> è®¾ç½® <code>ES</code> è‡ªåŠ¨å‘ç°èŠ‚ç‚¹è¿æ¥è¶…æ—¶çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º3ç§’ï¼Œå¦‚æœç½‘ç»œå»¶è¿Ÿé«˜å¯è®¾ç½®å¤§äº›ã€‚</td></tr><tr><td>discovery.zen.minimum_master_nodes</td><td>ä¸»ç»“ç‚¹æ•°é‡çš„æœ€å°‘å€¼ ,æ­¤å€¼çš„å…¬å¼ä¸ºï¼š(<code>master_eligible_nodes</code> / 2) + 1 ï¼Œæ¯”å¦‚ï¼šæœ‰3ä¸ªç¬¦åˆè¦æ±‚çš„ä¸»ç»“ç‚¹ï¼Œé‚£ä¹ˆè¿™é‡Œè¦è®¾ç½®ä¸º2ã€‚</td></tr><tr><td>node.max_local_storage_nodes</td><td>å•æœºå…è®¸çš„æœ€å¤§å­˜å‚¨ç»“ç‚¹æ•°ï¼Œé€šå¸¸å•æœºå¯åŠ¨ä¸€ä¸ªç»“ç‚¹å»ºè®®è®¾ç½®ä¸º1ï¼Œå¼€å‘ç¯å¢ƒå¦‚æœå•æœºå¯åŠ¨å¤šä¸ªèŠ‚ç‚¹å¯è®¾ç½®å¤§äº1.</td></tr></tbody></table><h4 id="jvm-options"><a href="#jvm-options" class="headerlink" title="jvm.options"></a>jvm.options</h4><p>è®¾ç½®æœ€å°åŠæœ€å¤§çš„JVMå †å†…å­˜å¤§å°ï¼š</p><p>åœ¨ <code>jvm.options</code> ä¸­è®¾ç½® <code>-Xms</code> å’Œ <code>-Xmx</code>ï¼š</p><p>1ï¼‰ ä¸¤ä¸ªå€¼è®¾ç½®ä¸ºç›¸ç­‰</p><p>2ï¼‰ å°† <code>Xmx</code> è®¾ç½®ä¸ºä¸è¶…è¿‡ç‰©ç†å†…å­˜çš„ä¸€åŠã€‚</p><h4 id="log4j2-properties"><a href="#log4j2-properties" class="headerlink" title="log4j2.properties"></a>log4j2.properties</h4><p>æ—¥å¿—æ–‡ä»¶è®¾ç½®ï¼ŒESä½¿ç”¨ <code>log4j</code>ï¼Œæ³¨æ„æ—¥å¿—çº§åˆ«çš„é…ç½®ã€‚</p><h4 id="ç³»ç»Ÿé…ç½®"><a href="#ç³»ç»Ÿé…ç½®" class="headerlink" title="ç³»ç»Ÿé…ç½®"></a>ç³»ç»Ÿé…ç½®</h4><p>åœ¨<code>linux</code>ä¸Šæ ¹æ®ç³»ç»Ÿèµ„æºæƒ…å†µï¼Œå¯å°†æ¯ä¸ªè¿›ç¨‹æœ€å¤šå…è®¸æ‰“å¼€çš„æ–‡ä»¶æ•°è®¾ç½®å¤§äº›ã€‚</p><p><code>su limit -n</code> æŸ¥è¯¢å½“å‰æ–‡ä»¶æ•°</p><p>ä½¿ç”¨å‘½ä»¤è®¾ç½® <code>limit</code>:<br>å…ˆåˆ‡æ¢åˆ° <code>root</code>ï¼Œè®¾ç½®å®Œæˆå†åˆ‡å› <code>elasticsearch</code> ç”¨æˆ·ã€‚</p><div class="hljs"><pre><code class="hljs c">sudo su ulimit â€n <span class="hljs-number">65536</span>su elasticsearch</code></pre></div><p>ä¹Ÿå¯é€šè¿‡ä¸‹è¾¹çš„æ–¹å¼ä¿®æ”¹æ–‡ä»¶è¿›è¡ŒæŒä¹…è®¾ç½®<br><code>/etc/security/limits.conf</code> å°†ä¸‹è¾¹çš„è¡ŒåŠ å…¥æ­¤æ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs angelscript">elasticsearch  â€  nofile  <span class="hljs-number">65536</span></code></pre></div><h3 id="3ã€å¯åŠ¨ES"><a href="#3ã€å¯åŠ¨ES" class="headerlink" title="3ã€å¯åŠ¨ES"></a>3ã€å¯åŠ¨ES</h3><p>è¿›å…¥ <code>bin</code> ç›®å½•ï¼Œåœ¨ <code>cmd</code> ä¸‹è¿è¡Œï¼š<code>elasticsearch.bat</code></p><p><a href="https://qnoss.codeyee.com/20200704_10/image20" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image20.png" srcset="/img/loading.gif" alt="img"></a></p><p>æµè§ˆå™¨è¾“å…¥ï¼š<a href="http://localhost:9200/" target="_blank" rel="noopener">http://localhost:9200</a></p><p>æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼ˆé…ç½®ä¸åŒå†…å®¹åˆ™ä¸åŒï¼‰è¯´æ˜ <code>ES</code> å¯åŠ¨æˆåŠŸï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;  <span class="hljs-attr">"name"</span> : <span class="hljs-string">"xc_node_1"</span>,  <span class="hljs-attr">"cluster_name"</span> : <span class="hljs-string">"xuecheng"</span>,  <span class="hljs-attr">"cluster_uuid"</span> : <span class="hljs-string">"J18wPybJREyx1kjOoH8Tâ€g"</span>,  <span class="hljs-attr">"version"</span> : &#123;    <span class="hljs-attr">"number"</span> : <span class="hljs-string">"6.2.1"</span>,    <span class="hljs-attr">"build_hash"</span> : <span class="hljs-string">"7299dc3"</span>,    <span class="hljs-attr">"build_date"</span> : <span class="hljs-string">"2018â€02â€07T19:34:26.990113Z"</span>,    <span class="hljs-attr">"build_snapshot"</span> : <span class="hljs-literal">false</span>,     <span class="hljs-attr">"lucene_version"</span> : <span class="hljs-string">"7.2.1"</span>,    <span class="hljs-attr">"minimum_wire_compatibility_version"</span> : <span class="hljs-string">"5.6.0"</span>,    <span class="hljs-attr">"minimum_index_compatibility_version"</span> : <span class="hljs-string">"5.0.0"</span>  &#125;,  <span class="hljs-attr">"tagline"</span> : <span class="hljs-string">"You Know, for Search"</span>&#125;</code></pre></div><h3 id="4ã€å®‰è£…-head-æ’ä»¶"><a href="#4ã€å®‰è£…-head-æ’ä»¶" class="headerlink" title="4ã€å®‰è£… head æ’ä»¶"></a>4ã€å®‰è£… head æ’ä»¶</h3><p><code>head</code> æ’ä»¶æ˜¯ <code>ES</code> çš„ä¸€ä¸ªå¯è§†åŒ–ç®¡ç†æ’ä»¶ï¼Œç”¨æ¥ç›‘è§†ESçš„çŠ¶æ€ï¼Œå¹¶é€šè¿‡ <code>head</code> å®¢æˆ·ç«¯å’Œ <code>ES</code> æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚åˆ›å»ºæ˜ å°„ã€åˆ›å»ºç´¢å¼•ç­‰ï¼Œ<code>head</code> çš„é¡¹ç›®åœ°å€åœ¨ <a href="https://github.com/mobz/elasticsearch-head" target="_blank" rel="noopener">https://github.com/mobz/elasticsearch-head</a></p><p>ä»ES6.0 å¼€å§‹ï¼Œ<code>head</code> æ’ä»¶æ”¯æŒä½¿å¾— <code>node.js</code> è¿è¡Œã€‚</p><p><strong>1ã€å®‰è£… node.js</strong></p><p><strong>2ã€ä¸‹è½½ head å¹¶è¿è¡Œ</strong></p><div class="hljs"><pre><code class="hljs shell">git clone git://github.com/mobz/elasticsearch-head.git cd elasticsearch-head npm install npm run start open</code></pre></div><p>è®¿é—® <code>http://æœ¬åœ°ä¸»æœº:9100/</code></p><p><strong>3ã€è¿è¡Œ</strong></p><p><a href="https://qnoss.codeyee.com/20200704_10/image21" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image21.png" srcset="/img/loading.gif" alt="img"></a></p><p>æ‰“å¼€æµè§ˆå™¨è°ƒè¯•å·¥å…·å‘ç°æŠ¥é”™ï¼š</p><p>Origin null is not allowed by Access-Control-Allow-Origin.</p><p>åŸå› æ˜¯ï¼šheadæ’ä»¶ä½œä¸ºå®¢æˆ·ç«¯è¦è¿æ¥ESæœåŠ¡ï¼ˆlocalhost:9200ï¼‰ï¼Œæ­¤æ—¶å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œelasticsearché»˜è®¤ä¸å…è®¸è·¨åŸŸè®¿é—®ã€‚</p><p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p><p>è®¾ç½® <code>elasticsearch</code> å…è®¸è·¨åŸŸè®¿é—®</p><div class="hljs"><pre><code class="hljs c"># è·¨åŸŸé…ç½®http.cors.enabled: <span class="hljs-literal">true</span>http.cors.allow-origin: /.*/</code></pre></div><p>è·¨åŸŸè®¿é—®å…è®¸çš„åŸŸååœ°å€ï¼Œ(å…è®¸æ‰€æœ‰åŸŸå) ä»¥ä¸Šä½¿ç”¨æ­£åˆ™ <code>http.cors.allow-origin: /.*/</code></p><p>æ³¨æ„ï¼šå°† <code>config/elasticsearch.yml</code> å¦å­˜ä¸ºutf-8ç¼–ç æ ¼å¼ã€‚</p><p>æˆåŠŸè¿æ¥ <code>ES</code> ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_10/image22" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image22.png" srcset="/img/loading.gif" alt="img"></a></p><h1 id="ä¸‰ã€ES-å¿«é€Ÿå…¥é—¨"><a href="#ä¸‰ã€ES-å¿«é€Ÿå…¥é—¨" class="headerlink" title="ä¸‰ã€ES å¿«é€Ÿå…¥é—¨"></a>ä¸‰ã€ES å¿«é€Ÿå…¥é—¨</h1><p><code>ES</code> ä½œä¸ºä¸€ä¸ªç´¢å¼•åŠæœç´¢æœåŠ¡ï¼Œå¯¹å¤–æä¾›ä¸°å¯Œçš„ <code>REST</code> æ¥å£ï¼Œå¿«é€Ÿå…¥é—¨éƒ¨åˆ†çš„å®ä¾‹ä½¿ç”¨ <code>head</code> æ’ä»¶æ¥æµ‹è¯•ï¼Œç›®çš„æ˜¯å¯¹ <code>ES</code> çš„ä½¿ç”¨æ–¹æ³•åŠæµç¨‹æœ‰ä¸ªåˆæ­¥çš„è®¤è¯†ã€‚</p><h2 id="1-åˆ›å»ºç´¢å¼•åº“"><a href="#1-åˆ›å»ºç´¢å¼•åº“" class="headerlink" title="1. åˆ›å»ºç´¢å¼•åº“"></a>1. åˆ›å»ºç´¢å¼•åº“</h2><p><code>ES</code> çš„ç´¢å¼•åº“æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œå®ƒåŒ…æ‹¬äº†åˆ†è¯åˆ—è¡¨åŠæ–‡æ¡£åˆ—è¡¨ï¼ŒåŒä¸€ä¸ªç´¢å¼•åº“ä¸­å­˜å‚¨äº†ç›¸åŒç±»å‹çš„æ–‡æ¡£ã€‚å®ƒå°±ç›¸å½“äº <code>MySQL</code> ä¸­çš„è¡¨ï¼Œæˆ–ç›¸å½“äº <code>Mongodb</code> ä¸­çš„é›†åˆã€‚</p><p>å…³äºç´¢å¼•è¿™ä¸ªè¯­ï¼š</p><p>ç´¢å¼•ï¼ˆåè¯ï¼‰ï¼š<code>ES</code> æ˜¯åŸºäº <code>Lucene</code> æ„å»ºçš„ä¸€ä¸ªæœç´¢æœåŠ¡ï¼Œå®ƒè¦ä»ç´¢å¼•åº“æœç´¢ç¬¦åˆæ¡ä»¶ç´¢å¼•æ•°æ®ã€‚</p><p>ç´¢å¼•ï¼ˆåŠ¨è¯ï¼‰ï¼šç´¢å¼•åº“åˆšåˆ›å»ºèµ·æ¥æ˜¯ç©ºçš„ï¼Œå°†æ•°æ®æ·»åŠ åˆ°ç´¢å¼•åº“çš„è¿‡ç¨‹ç§°ä¸ºç´¢å¼•ã€‚</p><p>ä¸‹è¾¹ä»‹ç»ä¸¤ç§åˆ›å»ºç´¢å¼•åº“çš„æ–¹æ³•ï¼Œå®ƒä»¬çš„å·¥ä½œåŸç†æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯å®¢æˆ·ç«¯å‘ <code>ES</code> æœåŠ¡å‘é€å‘½ä»¤ã€‚</p><p><strong>1ï¼‰ä½¿ç”¨ postman æˆ– curl è¿™æ ·çš„å·¥å…·åˆ›å»ºï¼š</strong></p><p><code>put http://localhost:9200/xc_course</code> ç´¢å¼•åº“åç§°</p><div class="hljs"><pre><code class="hljs json">&#123;  <span class="hljs-attr">"settings"</span>:&#123;  <span class="hljs-attr">"index"</span>:&#123;      <span class="hljs-attr">"number_of_shards"</span>:<span class="hljs-number">1</span>,      <span class="hljs-attr">"number_of_replicas"</span>:<span class="hljs-number">0</span>   &#125;      &#125;&#125;</code></pre></div><p><strong>number_of_shards</strong>ï¼šè®¾ç½®åˆ†ç‰‡çš„æ•°é‡ï¼Œåœ¨é›†ç¾¤ä¸­é€šå¸¸è®¾ç½®å¤šä¸ªåˆ†ç‰‡ï¼Œè¡¨ç¤ºä¸€ä¸ªç´¢å¼•åº“å°†æ‹†åˆ†æˆå¤šç‰‡åˆ†åˆ«å­˜å‚¨ä¸åŒçš„ç»“ç‚¹ï¼Œæé«˜äº† <code>ES</code> çš„å¤„ç†èƒ½åŠ›å’Œé«˜å¯ç”¨æ€§ï¼Œå…¥é—¨ç¨‹åºä½¿ç”¨å•æœºç¯å¢ƒï¼Œè¿™é‡Œè®¾ç½®ä¸º 1ã€‚</p><p><strong>number_of_replicas</strong>ï¼šè®¾ç½®å‰¯æœ¬çš„æ•°é‡ï¼Œè®¾ç½®å‰¯æœ¬æ˜¯ä¸ºäº†æé«˜ <code>ES</code> çš„é«˜å¯é æ€§ï¼Œå•æœºç¯å¢ƒè®¾ç½®ä¸º <code>0</code>.</p><p>å¦‚ä¸‹æ˜¯åˆ›å»ºçš„ä¾‹å­ï¼Œåˆ›å»º <code>xc_course</code> ç´¢å¼•åº“ï¼Œå…± <code>1</code> ä¸ªåˆ†ç‰‡ï¼Œ<code>0</code> ä¸ªå‰¯æœ¬ï¼š</p><p>ä½¿ç”¨ <code>postman</code> å‘é€ put è¯·æ±‚</p><p><a href="https://qnoss.codeyee.com/20200704_10/image23" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image23.png" srcset="/img/loading.gif" alt="img"></a></p><p><strong>2ï¼‰ä½¿ç”¨headæ’ä»¶åˆ›å»º</strong></p><p><a href="https://qnoss.codeyee.com/20200704_10/image24" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image24.png" srcset="/img/loading.gif" alt="img"></a></p><p>æ•ˆæœå¦‚ä¸‹</p><p><a href="https://qnoss.codeyee.com/20200704_10/image25" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image25.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="2-åˆ›å»ºæ˜ å°„"><a href="#2-åˆ›å»ºæ˜ å°„" class="headerlink" title="2. åˆ›å»ºæ˜ å°„"></a>2. åˆ›å»ºæ˜ å°„</h2><h3 id="1ã€æ¦‚å¿µè¯´æ˜"><a href="#1ã€æ¦‚å¿µè¯´æ˜" class="headerlink" title="1ã€æ¦‚å¿µè¯´æ˜"></a>1ã€æ¦‚å¿µè¯´æ˜</h3><p>åœ¨ç´¢å¼•ä¸­æ¯ä¸ªæ–‡æ¡£éƒ½åŒ…æ‹¬äº†ä¸€ä¸ªæˆ–å¤šä¸ª <code>field</code>ï¼Œåˆ›å»ºæ˜ å°„å°±æ˜¯å‘ç´¢å¼•åº“ä¸­åˆ›å»º <code>field</code> çš„è¿‡ç¨‹ï¼Œä¸‹è¾¹æ˜¯<code>document</code> å’Œ <code>field</code> ä¸å…³ç³»æ•°æ®åº“çš„æ¦‚å¿µçš„ç±»æ¯”ï¼š</p><p>æ–‡æ¡£ï¼ˆDocumentï¼‰â€”â€”â€”â€”â€”- <code>Row</code> è®°å½•</p><p>å­—æ®µï¼ˆFieldï¼‰â€”â€”â€”â€”â€”â€”- <code>Columns</code> åˆ—</p><p>æ³¨æ„ï¼š<code>6.0</code> ä¹‹å‰çš„ç‰ˆæœ¬æœ‰ <code>type</code>ï¼ˆç±»å‹ï¼‰æ¦‚å¿µï¼Œ<code>type</code> ç›¸å½“äºå…³ç³»æ•°æ®åº“çš„è¡¨ï¼Œ<code>ES</code> å®˜æ–¹å°†åœ¨ <code>ES9.0</code> ç‰ˆæœ¬ä¸­å½»åº•åˆ é™¤ <code>type</code>ã€‚</p><p>ä¸Šè¾¹è®²çš„åˆ›å»ºç´¢å¼•åº“ç›¸å½“äºå…³ç³»æ•°æ®åº“ä¸­çš„æ•°æ®åº“è¿˜æ˜¯è¡¨ï¼Ÿ</p><p>1ã€å¦‚æœç›¸å½“äºæ•°æ®åº“å°±è¡¨ç¤ºä¸€ä¸ªç´¢å¼•åº“å¯ä»¥åˆ›å»ºå¾ˆå¤šä¸åŒç±»å‹çš„æ–‡æ¡£ï¼Œè¿™åœ¨ <code>ES</code> ä¸­ä¹Ÿæ˜¯å…è®¸çš„ã€‚</p><p>2ã€å¦‚æœç›¸å½“äºè¡¨å°±è¡¨ç¤ºä¸€ä¸ªç´¢å¼•åº“åªèƒ½å­˜å‚¨ç›¸åŒç±»å‹çš„æ–‡æ¡£ï¼Œ<code>ES</code> å®˜æ–¹å»ºè®® åœ¨ä¸€ä¸ªç´¢å¼•åº“ä¸­åªå­˜å‚¨ç›¸åŒç±»å‹çš„æ–‡æ¡£ã€‚</p><h3 id="2ã€åˆ›å»ºæ˜ å°„"><a href="#2ã€åˆ›å»ºæ˜ å°„" class="headerlink" title="2ã€åˆ›å»ºæ˜ å°„"></a>2ã€åˆ›å»ºæ˜ å°„</h3><p>æˆ‘ä»¬è¦æŠŠè¯¾ç¨‹ä¿¡æ¯å­˜å‚¨åˆ° <code>ES</code> ä¸­ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºè¯¾ç¨‹ä¿¡æ¯çš„æ˜ å°„ï¼Œå…ˆæ¥ä¸€ä¸ªç®€å•çš„æ˜ å°„ï¼Œå¦‚ä¸‹ï¼š</p><p>å‘é€ï¼špost <code>http://localhost:9200/ç´¢å¼•åº“åç§°/ç±»å‹åç§°/_mapping</code></p><p>åˆ›å»ºç±»å‹ä¸º <code>xc_course</code> çš„æ˜ å°„ï¼Œå…±åŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼š<code>name</code>ã€<code>description</code>ã€<code>studymondel</code></p><p>ç”±äº <code>ES6.0</code> ç‰ˆæœ¬è¿˜æ²¡æœ‰å°† <code>type</code> å½»åº•åˆ é™¤ï¼Œæ‰€ä»¥æš‚æ—¶æŠŠ <code>type</code> èµ·ä¸€ä¸ªæ²¡æœ‰ç‰¹æ®Šæ„ä¹‰çš„åå­—ã€‚</p><p>å‘é€ post è¯·æ±‚ï¼š<a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p><blockquote><p>åœ¨ <code>xc_course</code> ç´¢å¼•åº“ä¸‹çš„ <code>doc</code> ç±»å‹ä¸‹åˆ›å»ºæ˜ å°„ã€‚<code>doc</code> æ˜¯ç±»å‹åï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œåœ¨ <code>ES6.0</code> ä¸­è¦å¼±åŒ–ç±»å‹çš„æ¦‚å¿µï¼Œç»™å®ƒèµ·ä¸€ä¸ªæ²¡æœ‰å…·ä½“ä¸šåŠ¡æ„ä¹‰çš„åç§°ã€‚</p></blockquote><p>body</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"properties"</span>: &#123;        <span class="hljs-attr">"name"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>        &#125;,        <span class="hljs-attr">"description"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>        &#125;,        <span class="hljs-attr">"studymodel"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;    &#125;&#125;</code></pre></div><p>æ˜ å°„åˆ›å»ºæˆåŠŸï¼ŒæŸ¥çœ‹ <code>head</code> ç•Œé¢ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_10/image26" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image26.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-åˆ›å»ºæ–‡æ¡£"><a href="#3-åˆ›å»ºæ–‡æ¡£" class="headerlink" title="3. åˆ›å»ºæ–‡æ¡£"></a>3. åˆ›å»ºæ–‡æ¡£</h2><p>ESä¸­çš„æ–‡æ¡£ç›¸å½“äºMySQLæ•°æ®åº“è¡¨ä¸­çš„è®°å½•ã€‚</p><p>å‘é€ï¼šput æˆ– Post åˆ°<code>http://localhost:9200/xc_course/doc/idå€¼</code>ï¼ˆå¦‚æœä¸æŒ‡å®šidå€¼ESä¼šè‡ªåŠ¨ç”ŸæˆIDï¼‰</p><p><a href="http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"name"</span>:<span class="hljs-string">"Bootstrapå¼€å‘æ¡†æ¶"</span>,    <span class="hljs-attr">"description"</span>:<span class="hljs-string">"Bootstrapæ˜¯ç”±Twitteræ¨å‡ºçš„ä¸€ä¸ªå‰å°é¡µé¢å¼€å‘æ¡†æ¶ï¼Œåœ¨è¡Œä¸šä¹‹ä¸­ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚æ­¤å¼€å‘æ¡†æ¶åŒ…å«äº†å¤§é‡çš„CSSã€JSç¨‹åºä»£ç ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯ä¸æ“…é•¿é¡µé¢å¼€å‘çš„ç¨‹åºäººå‘˜ï¼‰è½»æ¾çš„å®ç°ä¸€ä¸ªä¸å—æµè§ˆå™¨é™åˆ¶çš„ç²¾ç¾ç•Œé¢æ•ˆæœã€‚"</span>,    <span class="hljs-attr">"studymodel"</span>:<span class="hljs-string">"201001"</span>&#125;</code></pre></div><p>ä½¿ç”¨ <code>postman</code> æµ‹è¯•ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_10/image27" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image27.png" srcset="/img/loading.gif" alt="img"></a></p><p>é€šè¿‡ <code>head</code> æŸ¥è¯¢æ•°æ®ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_10/image28" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image28.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="4-æœç´¢æ–‡æ¡£"><a href="#4-æœç´¢æ–‡æ¡£" class="headerlink" title="4. æœç´¢æ–‡æ¡£"></a>4. æœç´¢æ–‡æ¡£</h2><p>1ã€æ ¹æ®è¯¾ç¨‹idæŸ¥è¯¢æ–‡æ¡£<br>å‘é€ï¼šget <a href="http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000</a></p><p>ä½¿ç”¨ <code>postman</code> æµ‹è¯•ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_10/image29" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image29.png" srcset="/img/loading.gif" alt="img"></a></p><p>2ã€æŸ¥è¯¢æ‰€æœ‰è®°å½•</p><p>å‘é€ get <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p><p>3ã€æŸ¥è¯¢åç§°ä¸­åŒ…æ‹¬ <code>bootstrap</code> å…³é”®å­—çš„çš„è®°å½•<br>å‘é€ï¼šget <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:9200/xc_course/doc/_search?q=name:bootstrap</p><p>4ã€æŸ¥è¯¢å­¦ä¹ æ¨¡å¼ä¸º <code>201001</code> çš„è®°å½•<br>å‘é€ get <a href="http://localhost:9200/xc_course/doc/_search?q=studymodel:201001" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search?q=studymodel:201001</a></p><h3 id="æŸ¥è¯¢ç»“æœåˆ†æ"><a href="#æŸ¥è¯¢ç»“æœåˆ†æ" class="headerlink" title="æŸ¥è¯¢ç»“æœåˆ†æ"></a>æŸ¥è¯¢ç»“æœåˆ†æ</h3><p>åˆ†æä¸Šè¾¹æŸ¥è¯¢ç»“æœï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"took"</span>: <span class="hljs-number">1</span>,    <span class="hljs-attr">"timed_out"</span>: <span class="hljs-literal">false</span>,    <span class="hljs-attr">"_shards"</span>: &#123;        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"successful"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"skipped"</span>: <span class="hljs-number">0</span>,        <span class="hljs-attr">"failed"</span>: <span class="hljs-number">0</span>    &#125;,    <span class="hljs-attr">"hits"</span>: &#123;        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"max_score"</span>: <span class="hljs-number">0.2876821</span>,        <span class="hljs-attr">"hits"</span>: [            &#123;                <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,                <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"4028e58161bcf7f40161bcf8b77c0000"</span>,                <span class="hljs-attr">"_score"</span>: <span class="hljs-number">0.2876821</span>,                <span class="hljs-attr">"_source"</span>: &#123;                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bootstrapå¼€å‘æ¡†æ¶"</span>,                    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Bootstrapæ˜¯ç”±Twitteræ¨å‡ºçš„ä¸€ä¸ªå‰å°é¡µé¢å¼€å‘æ¡†æ¶ï¼Œåœ¨è¡Œä¸šä¹‹ä¸­ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚æ­¤å¼€å‘æ¡†æ¶åŒ…å«äº†å¤§é‡çš„CSSã€JSç¨‹åºä»£ç ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯ä¸æ“…é•¿é¡µé¢å¼€å‘çš„ç¨‹åºäººå‘˜ï¼‰è½»æ¾çš„å®ç°ä¸€ä¸ªä¸å—æµè§ˆå™¨é™åˆ¶çš„ç²¾ç¾ç•Œé¢æ•ˆæœã€‚"</span>,                    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>                &#125;            &#125;        ]    &#125;&#125;</code></pre></div><table><thead><tr><th>å­—æ®µåç§°</th><th>æè¿°</th></tr></thead><tbody><tr><td>took</td><td>æœ¬æ¬¡æ“ä½œèŠ±è´¹çš„æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚</td></tr><tr><td>timed_out</td><td>è¯·æ±‚æ˜¯å¦è¶…æ—¶</td></tr><tr><td>_shards</td><td>è¯´æ˜æœ¬æ¬¡æ“ä½œå…±æœç´¢äº†å“ªäº›åˆ†ç‰‡</td></tr><tr><td>hits</td><td>æœç´¢å‘½ä¸­çš„è®°å½•</td></tr><tr><td>hits.total</td><td>ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£æ€»æ•° <code>hits.hits</code> ï¼šåŒ¹é…åº¦è¾ƒé«˜çš„å‰Nä¸ªæ–‡æ¡£</td></tr><tr><td>hits.max_score</td><td>æ–‡æ¡£åŒ¹é…å¾—åˆ†ï¼Œè¿™é‡Œä¸ºæœ€é«˜åˆ†</td></tr><tr><td>_score</td><td>æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªåŒ¹é…åº¦å¾—åˆ†ï¼ŒæŒ‰ç…§é™åºæ’åˆ—ã€‚</td></tr><tr><td>_source</td><td>æ˜¾ç¤ºäº†æ–‡æ¡£çš„åŸå§‹å†…å®¹ã€‚</td></tr></tbody></table><h1 id="å››ã€IKåˆ†è¯å™¨"><a href="#å››ã€IKåˆ†è¯å™¨" class="headerlink" title="å››ã€IKåˆ†è¯å™¨"></a>å››ã€IKåˆ†è¯å™¨</h1><h2 id="1-æµ‹è¯•ESé»˜è®¤çš„åˆ†è¯å™¨"><a href="#1-æµ‹è¯•ESé»˜è®¤çš„åˆ†è¯å™¨" class="headerlink" title="1. æµ‹è¯•ESé»˜è®¤çš„åˆ†è¯å™¨"></a>1. æµ‹è¯•ESé»˜è®¤çš„åˆ†è¯å™¨</h2><p>åœ¨æ·»åŠ æ–‡æ¡£æ—¶ä¼šè¿›è¡Œåˆ†è¯ï¼Œç´¢å¼•ä¸­å­˜æ”¾çš„å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„è¯ï¼ˆtermï¼‰ï¼Œå½“ä½ å»æœç´¢æ—¶å°±æ˜¯æ‹¿å…³é”®å­—å»åŒ¹é…è¯ï¼Œæœ€ç»ˆæ‰¾åˆ°è¯å…³è”çš„æ–‡æ¡£ã€‚</p><p>æµ‹è¯•å½“å‰ç´¢å¼•åº“ä½¿ç”¨çš„åˆ†è¯å™¨ï¼š</p><p>POST è¯·æ±‚ï¼š<a href="http://localhost:9200/_analyze" target="_blank" rel="noopener">http://localhost:9200/_analyze</a></p><div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"text"</span>:<span class="hljs-string">"åˆ†è¯å™¨"</span>&#125;</code></pre></div><p>ç»“æœå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"tokens"</span>: [        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"åˆ†"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">1</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"è¯"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">1</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">2</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"å™¨"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">2</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">3</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">2</span>        &#125;    ]&#125;</code></pre></div><p>ä»å“åº”çš„ç»“æœæ¥çœ‹ï¼Œ<code>ES</code> çš„é»˜è®¤åˆ†è¯å™¨ä¼šå°†æˆ‘ä»¬æäº¤çš„å†…å®¹ä¸­çš„æ¯ä¸€ä¸ªè¯è¿›è¡Œåˆ†å‰²ï¼Œè¿™æ ·æ˜¾ç„¶ä¸å¤Ÿæ™ºèƒ½ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>IK</code> åˆ†è¯å™¨ã€‚</p><h2 id="2-å®‰è£…IKåˆ†è¯å™¨"><a href="#2-å®‰è£…IKåˆ†è¯å™¨" class="headerlink" title="2. å®‰è£…IKåˆ†è¯å™¨"></a>2. å®‰è£…IKåˆ†è¯å™¨</h2><p>ä½¿ç”¨IKåˆ†è¯å™¨å¯ä»¥å®ç°å¯¹ä¸­æ–‡åˆ†è¯çš„æ•ˆæœã€‚<br>ä¸‹è½½IKåˆ†è¯å™¨ï¼šï¼ˆGithubåœ°å€ï¼š<a href="https://github.com/medcl/elasticsearch-analysis-ik%EF%BC%89" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-ikï¼‰</a></p><blockquote><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼ŒIKåˆ†è¯å™¨çš„ç‰ˆæœ¬çš„ESçš„ç‰ˆæœ¬çš„ç›¸å¯¹åº”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ ES çš„ç‰ˆæœ¬ç”¨çš„æ˜¯ v6.8.8 é‚£ä¹ˆIKåˆ†è¯å™¨çš„ç‰ˆæœ¬ä¹Ÿè¦å¯¹åº”ä½¿ç”¨ v6.8.8ã€‚</p></blockquote><p>è§£å‹ï¼Œå¹¶å°†è§£å‹çš„æ–‡ä»¶æ‹·è´åˆ° <code>ES</code> å®‰è£…ç›®å½•çš„ <code>plugins</code> ä¸‹çš„ikç›®å½•ä¸‹</p><p><a href="https://qnoss.codeyee.com/20200704_10/image30" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image30.png" srcset="/img/loading.gif" alt="img"></a></p><p>æµ‹è¯•åˆ†è¯æ•ˆæœï¼š</p><p>POSTè¯·æ±‚ï¼š <a href="http://localhost:9200/_analyze" target="_blank" rel="noopener">http://localhost:9200/_analyze</a></p><div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"text"</span>:<span class="hljs-string">"æµ‹è¯•åˆ†è¯å™¨ï¼Œåè¾¹æ˜¯æµ‹è¯•å†…å®¹ï¼šspringcloudå®æˆ˜"</span>,<span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span>&#125;</code></pre></div><p>è¯·æ±‚ç»“æœ</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"tokens"</span>: [        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æµ‹è¯•"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">2</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"åˆ†è¯å™¨"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">2</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">5</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"åˆ†è¯"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">2</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">4</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">2</span>        &#125;,<span class="hljs-comment">//...çœç•¥ä¸€éƒ¨åˆ†ç»“æœ</span>    ]&#125;</code></pre></div><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåœ¨æˆ‘ä»¬å¼•å…¥ IK æ’ä»¶ä¹‹åï¼Œåˆ†è¯å™¨èƒ½è¯†åˆ«å‡ºæˆ‘ä»¬æäº¤çš„å†…å®¹ä¸­çš„è¯è¯­ï¼Œç»†å¿ƒçš„è€é“ä¼šæ³¨æ„åˆ°æˆ‘ä»¬åœ¨ <code>analyzer</code> å­—æ®µä¸­å¼•å…¥äº† <code>ik_max_word</code> ï¼Œè¿™æ˜¯ <code>IK</code> æ’ä»¶ä¸­çš„ä¸€ä¸ªåˆ†è¯æ¨¡å¼ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»”ç»†ä»‹ç»ä¸€ä¸‹ <code>IK</code> æ’ä»¶ä¸­çš„å‡ ç§åˆ†è¯æ¨¡å¼ã€‚</p><h2 id="3-ä¸¤ç§åˆ†è¯æ¨¡å¼"><a href="#3-ä¸¤ç§åˆ†è¯æ¨¡å¼" class="headerlink" title="3. ä¸¤ç§åˆ†è¯æ¨¡å¼"></a>3. ä¸¤ç§åˆ†è¯æ¨¡å¼</h2><p>ikåˆ†è¯å™¨æœ‰ä¸¤ç§åˆ†è¯æ¨¡å¼ï¼š<code>ik_max_word</code> å’Œ <code>ik_smart</code> æ¨¡å¼ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•è¿™ä¸¤ç§æ¨¡å¼ã€‚</p><p><strong>1ã€ik_max_word</strong></p><p>ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°† â€œ<strong>ä¸­åäººæ°‘å…±å’Œå›½äººæ°‘å¤§ä¼šå ‚</strong> â€ æ‹†åˆ†ä¸ºâ€œ <strong>ä¸­åäººæ°‘å…±å’Œå›½</strong>ã€<strong>ä¸­åäººæ°‘</strong>ã€<strong>ä¸­å</strong>ã€<strong>åäºº</strong>ã€<strong>äººæ°‘å…±å’Œå›½</strong>ã€<strong>äººæ°‘</strong>ã€<strong>å…±å’Œå›½</strong>ã€<strong>å¤§ä¼šå ‚</strong>ã€<strong>å¤§ä¼š</strong>ã€<strong>ä¼šå ‚ç­‰è¯è¯­</strong>ã€‚</p><p>å‘é€ <code>post</code> è¯·æ±‚ï¼š <a href="http://localhost:9200/_analyze" target="_blank" rel="noopener">http://localhost:9200/_analyze</a></p><div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"text"</span>:<span class="hljs-string">"ä¸­åäººæ°‘å…±å’Œå›½äººæ°‘å¤§ä¼šå ‚"</span>,<span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span>&#125;</code></pre></div><p>è¯·æ±‚ç»“æœ</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"tokens"</span>: [        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"ä¸­åäººæ°‘å…±å’Œå›½"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">7</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"ä¸­åäººæ°‘"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">4</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"ä¸­å"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">2</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">2</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"åäºº"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">1</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">3</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">3</span>        &#125;,        <span class="hljs-comment">//çœç•¥éƒ¨åˆ†ç»“æœ...</span>    ]&#125;</code></pre></div><p><strong>2ã€ik_smart</strong></p><p>ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°† â€œ<strong>ä¸­åäººæ°‘å…±å’Œå›½äººæ°‘å¤§ä¼šå ‚</strong>â€ æ‹†åˆ†ä¸º <strong>ä¸­åäººæ°‘å…±å’Œå›½</strong>ã€<strong>äººæ°‘å¤§ä¼šå ‚</strong>ã€‚</p><div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"text"</span>:<span class="hljs-string">"ä¸­åäººæ°‘å…±å’Œå›½äººæ°‘å¤§ä¼šå ‚"</span>,<span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_smart"</span>&#125;</code></pre></div><p>è¯·æ±‚ç»“æœ</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"tokens"</span>: [        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"ä¸­åäººæ°‘å…±å’Œå›½"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">7</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"äººæ°‘å¤§ä¼šå ‚"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">7</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">12</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>        &#125;    ]&#125;</code></pre></div><h2 id="4-è‡ªå®šä¹‰è¯åº“"><a href="#4-è‡ªå®šä¹‰è¯åº“" class="headerlink" title="4. è‡ªå®šä¹‰è¯åº“"></a>4. è‡ªå®šä¹‰è¯åº“</h2><p>å¦‚æœè¦è®©åˆ†è¯å™¨æ”¯æŒä¸€äº›ä¸“æœ‰è¯è¯­ï¼Œå¯ä»¥è‡ªå®šä¹‰è¯åº“ã€‚<br><code>iK</code> åˆ†è¯å™¨è‡ªå¸¦ä¸€ä¸ª <code>main.dic</code> çš„æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶ä¸ºè¯åº“æ–‡ä»¶ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_10/image31" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image31.png" srcset="/img/loading.gif" alt="img"></a></p><p>æˆ‘ä»¬åœ¨ä¸Šè¾¹çš„ç›®å½•ä¸­æ–°å»ºä¸€ä¸ª <code>my.dic</code> æ–‡ä»¶ï¼ˆæ³¨æ„æ–‡ä»¶æ ¼å¼ä¸º <code>utf-8</code>ï¼Œä¸è¦é€‰æ‹©<code>utf-8 BOM</code>ï¼‰<br>å¯ä»¥åœ¨å…¶ä¸­è‡ªå®šä¹‰è¯æ±‡</p><p>å®šä¹‰ <code>my.dic</code> , ä»¥æ¯è¡Œä¸ºå•ä½</p><div class="hljs"><pre><code class="hljs plain">æ¡‚åŒ—æ±‡</code></pre></div><p>ç¼–è¾‘ <code>config</code> ä¸­çš„é…ç½®æ–‡ä»¶ <code>IKAnalyzer.cfg.xml</code> ä¸­é…ç½® <code>my.dic</code></p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">properties</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">"http://java.sun.com/dtd/properties.dtd"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>IK Analyzer æ‰©å±•é…ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span><span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ext_dict"</span>&gt;</span>my.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span> <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ext_stopwords"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•å­—å…¸ --&gt;</span><span class="hljs-comment">&lt;!-- &lt;entry key="remote_ext_dict"&gt;words_location&lt;/entry&gt; --&gt;</span><span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span><span class="hljs-comment">&lt;!-- &lt;entry key="remote_ext_stopwords"&gt;words_location&lt;/entry&gt; --&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span></code></pre></div><p>åœ¨é€‚è‡ªå®šä¹‰é…ç½®ç”Ÿæ•ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æœªè‡ªå®šä¹‰ä¹‹å‰çš„æ•ˆæœ</p><p>å‘é€ï¼špost <a href="http://localhost:9200/_analyze" target="_blank" rel="noopener">http://localhost:9200/_analyze</a></p><div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"text"</span>:<span class="hljs-string">"æ¡‚åŒ—æ±‡"</span>, <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span> &#125;</code></pre></div><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"tokens"</span>: [        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æ¡‚åŒ—"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">2</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æ±‡"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">2</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">3</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_CHAR"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>        &#125;    ]&#125;</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è‡ªå®šä¹‰çš„åˆ†è¯æœªç”Ÿæ•ˆä¹‹å‰ï¼ŒESè¿˜æ˜¯å°†æˆ‘ä»¬çš„æäº¤çš„ â€œæ¡‚åŒ—æ±‡â€ æ‹†åˆ†äº†ï¼Œå› ä¸ºå¸¸ç”¨çš„è¯è¯­ç»„åˆã€‚</p><p>æˆ‘ä»¬é‡å¯ <code>ES</code>ï¼Œä½¿åˆšæ‰ä¿®æ”¹çš„è‡ªå®šä¹‰é…ç½®ç”Ÿæ•ˆå†æ¬¡æµ‹è¯•åˆ†è¯æ•ˆæœï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"tokens"</span>: [        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æ¡‚åŒ—æ±‡"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">3</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æ¡‚åŒ—"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">2</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>        &#125;,        &#123;            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æ±‡"</span>,            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">2</span>,            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">3</span>,            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_CHAR"</span>,            <span class="hljs-attr">"position"</span>: <span class="hljs-number">2</span>        &#125;    ]&#125;</code></pre></div><p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬åœ¨ <code>my.dic</code> ä¸­æ·»åŠ çš„ â€œæ¡‚åŒ—æ±‡â€ åˆ†è¯è¢«è¯†åˆ«å‡ºæ¥äº†ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>ik_max_word</code> åˆ†è¯æ¨¡å¼ï¼Œæ‰€ä»¥ <code>ES</code> çš„ <code>IK</code> æ’ä»¶ä¼šè¿›è¡Œæ›´ <strong>ç»†ç²’åº¦</strong> çš„è¯†åˆ«ã€‚</p><h1 id="äº”ã€æ˜ å°„"><a href="#äº”ã€æ˜ å°„" class="headerlink" title="äº”ã€æ˜ å°„"></a>äº”ã€æ˜ å°„</h1><p>ä¸Šè¾¹ç« èŠ‚å®‰è£…äº† <code>ik</code> åˆ†è¯å™¨ï¼Œå¦‚æœåœ¨ç´¢å¼•å’Œæœç´¢æ—¶å»ä½¿ç”¨ <code>ik</code> åˆ†è¯å™¨å‘¢ï¼Ÿå¦‚ä½•æŒ‡å®šå…¶å®ƒç±»å‹çš„ <code>field</code>ï¼Œæ¯”å¦‚æ—¥æœŸç±»å‹ã€æ•°å€¼ç±»å‹ç­‰ã€‚æœ¬ç« èŠ‚å­¦ä¹ å„ç§æ˜ å°„ç±»å‹åŠæ˜ å°„ç»´æŠ¤æ–¹æ³•ã€‚</p><h2 id="1-æ˜ å°„ç»´æŠ¤æ–¹æ³•"><a href="#1-æ˜ å°„ç»´æŠ¤æ–¹æ³•" class="headerlink" title="1. æ˜ å°„ç»´æŠ¤æ–¹æ³•"></a>1. æ˜ å°„ç»´æŠ¤æ–¹æ³•</h2><p>1ã€æŸ¥è¯¢æ‰€æœ‰ç´¢å¼•çš„æ˜ å°„</p><p>GET è¯·æ±‚ï¼š <a href="http://localhost:9200/_mapping" target="_blank" rel="noopener">http://localhost:9200/_mapping</a></p><p>2ã€åˆ›å»ºæ˜ å°„</p><p>POST è¯·æ±‚ï¼š<a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"properties"</span>: &#123;        <span class="hljs-attr">"name"</span>: &#123;        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>        &#125;,        <span class="hljs-attr">"description"</span>: &#123;        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>        &#125;,        <span class="hljs-attr">"studymodel"</span>: &#123;        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;    &#125;&#125;</code></pre></div><p>è¿™é‡Œè¦æ³¨æ„å¾—æ˜¯ï¼Œæ˜ å°„åªèƒ½ <strong>åˆ›å»º</strong>ï¼Œä¸èƒ½åˆ é™¤ï¼Œä»¥åŠç±»å‹ä¹Ÿä¸èƒ½ä¿®æ”¹ï¼Œå› ä¸ºå¦‚æœè¿™ä¸ªæ˜ å°„ä¸€æ—¦åˆ›å»ºåï¼Œä½ å¯èƒ½ä¼šå…³è”äº†å¤§é‡çš„æ•°æ®ï¼Œæ‰€ä»¥ä¿®æ”¹æ˜¯ä¸å¯å–çš„ã€‚</p><h2 id="2-å¸¸ç”¨æ˜ å°„ç±»å‹"><a href="#2-å¸¸ç”¨æ˜ å°„ç±»å‹" class="headerlink" title="2. å¸¸ç”¨æ˜ å°„ç±»å‹"></a>2. å¸¸ç”¨æ˜ å°„ç±»å‹</h2><p>ä¸‹å›¾æ˜¯ES6.2æ ¸å¿ƒçš„å­—æ®µç±»å‹å¦‚ä¸‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_10/image32" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image32.png" srcset="/img/loading.gif" alt="img"></a></p><h3 id="1ã€text-æ–‡æœ¬å­—æ®µ"><a href="#1ã€text-æ–‡æœ¬å­—æ®µ" class="headerlink" title="1ã€text æ–‡æœ¬å­—æ®µ"></a>1ã€text æ–‡æœ¬å­—æ®µ</h3><p>å­—ç¬¦ä¸²åŒ…æ‹¬ <code>text</code> å’Œ <code>keyword</code> ä¸¤ç§ç±»å‹</p><p><strong>analyzer å±æ€§</strong></p><p>é€šè¿‡ <code>analyzer</code> å±æ€§æŒ‡å®šåˆ†è¯å™¨ã€‚</p><p>ä¸‹è¾¹æŒ‡å®š <code>name</code> çš„å­—æ®µç±»å‹ä¸º <code>text</code>ï¼Œä½¿ç”¨ <code>ik</code> åˆ†è¯å™¨çš„ <code>ik_max_word</code> åˆ†è¯æ¨¡å¼ã€‚</p><div class="hljs"><pre><code class="hljs json">"name": &#123;    "type": "text",    "analyzer":"ik_max_word"&#125;</code></pre></div><p>ä¸Šè¾¹æŒ‡å®šäº† <code>analyzer</code> æ˜¯æŒ‡åœ¨ç´¢å¼•å’Œæœç´¢éƒ½ä½¿ç”¨ <code>ik_max_word</code>ï¼Œå¦‚æœå•ç‹¬æƒ³å®šä¹‰æœç´¢æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨åˆ™å¯ä»¥é€šè¿‡<br><code>search_analyzer</code> å±æ€§ã€‚å¯¹äº <code>ik</code> åˆ†è¯å™¨å»ºè®®æ˜¯ç´¢å¼•æ—¶ä½¿ç”¨ <code>ik_max_word</code> å°†æœç´¢å†…å®¹è¿›è¡Œç»†ç²’åº¦åˆ†è¯ï¼Œæœç´¢æ—¶ä½¿ç”¨ <code>ik_smart</code> æé«˜æœç´¢ç²¾ç¡®æ€§ ã€‚</p><div class="hljs"><pre><code class="hljs json">"name": &#123;    "type": "text",    "analyzer":"ik_max_word",    "search_analyzer":"ik_smart"&#125;</code></pre></div><p><strong>index å±æ€§</strong></p><p>é€šè¿‡ <code>index</code> å±æ€§æŒ‡å®šæ˜¯å¦ç´¢å¼•ã€‚</p><p>é»˜è®¤ä¸º <code>index=true</code>ï¼Œå³è¦è¿›è¡Œç´¢å¼•ï¼Œåªæœ‰è¿›è¡Œç´¢å¼•æ‰å¯ä»¥ä»ç´¢å¼•åº“æœç´¢åˆ°ã€‚</p><p>ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›å†…å®¹ä¸éœ€è¦ç´¢å¼•ï¼Œæ¯”å¦‚ï¼šå•†å“å›¾ç‰‡åœ°å€åªè¢«ç”¨æ¥å±•ç¤ºå›¾ç‰‡ï¼Œä¸è¿›è¡Œæœç´¢å›¾ç‰‡ï¼Œæ­¤æ—¶å¯ä»¥å°† <code>index</code>è®¾ç½®ä¸º <code>false</code>ã€‚åˆ é™¤ç´¢å¼•ï¼Œé‡æ–°åˆ›å»ºæ˜ å°„ï¼Œå°† <code>pic</code> çš„ <code>index</code> è®¾ç½®ä¸º <code>false</code>ï¼Œå°è¯•æ ¹æ® <code>pic</code> å»æœç´¢ï¼Œç»“æœæœç´¢ä¸åˆ°æ•°æ®</p><div class="hljs"><pre><code class="hljs json">"pic": &#123;    "type": "text",    "index":false&#125;</code></pre></div><p><strong>store å±æ€§</strong></p><p>æ˜¯å¦åœ¨ <code>source</code> ä¹‹å¤–å­˜å‚¨ï¼Œæ¯ä¸ªæ–‡æ¡£ç´¢å¼•åä¼šåœ¨ <code>ES</code> ä¸­ä¿å­˜ä¸€ä»½åŸå§‹æ–‡æ¡£ï¼Œå­˜æ”¾åœ¨ <code>_source</code> ä¸­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦è®¾ç½® <code>store</code> ä¸º <code>true</code>ï¼Œå› ä¸ºåœ¨ <code>source</code> ä¸­å·²ç»æœ‰ä¸€ä»½åŸå§‹æ–‡æ¡£äº†ã€‚</p><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>åˆ é™¤ <code>xc_course/doc</code> ä¸‹çš„æ˜ å°„ ï¼Œå‘é€ DELETE è¯·æ±‚åˆ° <code>http://10.1.1.168:9200/xc_course</code></p><p>åˆ›å»ºï¼Œå‘é€PUTè¯·æ±‚ <code>http://localhost:9200/xc_course</code> ç´¢å¼•åº“åç§°</p><div class="hljs"><pre><code class="hljs json">&#123;  <span class="hljs-attr">"settings"</span>:&#123;  <span class="hljs-attr">"index"</span>:&#123;      <span class="hljs-attr">"number_of_shards"</span>:<span class="hljs-number">1</span>,      <span class="hljs-attr">"number_of_replicas"</span>:<span class="hljs-number">0</span>   &#125;      &#125;&#125;</code></pre></div><p>åˆ›å»ºæ–°æ˜ å°„ï¼šPOST <a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"properties"</span>: &#123;        <span class="hljs-attr">"name"</span>: &#123;        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,        <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span>,        <span class="hljs-attr">"search_analyzer"</span>:<span class="hljs-string">"ik_smart"</span>    &#125;,    <span class="hljs-attr">"description"</span>: &#123;        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,        <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span>,        <span class="hljs-attr">"search_analyzer"</span>:<span class="hljs-string">"ik_smart"</span>    &#125;,    <span class="hljs-attr">"pic"</span>:&#123;        <span class="hljs-attr">"type"</span>:<span class="hljs-string">"text"</span>,        <span class="hljs-attr">"index"</span>:<span class="hljs-literal">false</span>    &#125;,    <span class="hljs-attr">"studymodel"</span>:&#123;        <span class="hljs-attr">"type"</span>:<span class="hljs-string">"text"</span>        &#125;    &#125;&#125;</code></pre></div><p>æ’å…¥æ–‡æ¡£ï¼š</p><p>POST <a href="http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"name"</span>:<span class="hljs-string">"Bootstrapå¼€å‘æ¡†æ¶"</span>,    <span class="hljs-attr">"description"</span>:<span class="hljs-string">"Bootstrapæ˜¯ç”±Twitteræ¨å‡ºçš„ä¸€ä¸ªå‰å°é¡µé¢å¼€å‘æ¡†æ¶ï¼Œåœ¨è¡Œä¸šä¹‹ä¸­ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚æ­¤å¼€å‘æ¡†æ¶åŒ…å«äº†å¤§é‡çš„CSSã€JSç¨‹åºä»£ç ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯ä¸æ“…é•¿é¡µé¢å¼€å‘çš„ç¨‹åºäººå‘˜ï¼‰è½»æ¾çš„å®ç°ä¸€ä¸ªä¸å—æµè§ˆå™¨é™åˆ¶çš„ç²¾ç¾ç•Œé¢æ•ˆæœã€‚"</span>,    <span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/01/wKhlQFqO4MmAOP53AAAcwDwm6SU490.jpg"</span>,    <span class="hljs-attr">"studymodel"</span>:<span class="hljs-string">"201002"</span>&#125;</code></pre></div><p><strong>æŸ¥è¯¢æµ‹è¯•ï¼š</strong></p><p>GETè¯·æ±‚ï¼š <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:9200/xc_course/_search?q=name:å¼€å‘</p><p>æŸ¥è¯¢ç»“æœï¼šè·å–åˆ° <code>name</code> ä¸­åŒ…å« â€œå¼€å‘â€ çš„æ–‡æ¡£</p><p>GETè¯·æ±‚ï¼š <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:9200/xc_course/_search?q=description:å¼€å‘</p><p>æŸ¥è¯¢ç»“æœï¼šè·å–åˆ° <code>description</code> ä¸­åŒ…å« â€œå¼€å‘â€ çš„æ–‡æ¡£</p><p>GETè¯·æ±‚ï¼š <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:9200/xc_course/_search?q=pic:group1/M00/00/01/wKhlQFqO4MmAOP53AAAcwDwm6SU490.jpg</p><p>æŸ¥è¯¢ç»“æœï¼šç”±äºå‰é¢ <code>pic</code> å­—æ®µ è®¾ç½®äº† <code>index</code> å±æ€§ä¸º <code>false</code></p><p>GETè¯·æ±‚ï¼š <a href="http://localhost:9200/xc_course/_search?q=studymodel:201002" target="_blank" rel="noopener">http://localhost:9200/xc_course/_search?q=studymodel:201002</a></p><p>æŸ¥è¯¢ç»“æœ: ç”±äºæ²¡æœ‰ä¸º <code>studymodel</code> å­—æ®µä½¿ç”¨çš„æ˜¯é»˜è®¤çš„åˆ†è¯å™¨ï¼Œé»˜è®¤åˆ†è¯å™¨ä¼šå°†æˆ‘ä»¬å‰é¢æ’å…¥çš„ â€œ<code>201002</code>â€ ç´¢å¼•ä¸ºä¸€ä¸ªè¯ï¼Œæ‰€ä»¥éœ€è¦å…¨éƒ¨åŒ¹é…æ‰èƒ½æœç´¢åˆ°ã€‚</p><p>é€šè¿‡æµ‹è¯•å‘ç°ï¼š<code>name</code> å’Œ <code>description</code> éƒ½æ”¯æŒå…¨æ–‡æ£€ç´¢ï¼Œ<code>pic</code> ä¸å¯ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€‚</p><h3 id="2ã€keyword-å…³é”®è¯å­—æ®µ"><a href="#2ã€keyword-å…³é”®è¯å­—æ®µ" class="headerlink" title="2ã€keyword å…³é”®è¯å­—æ®µ"></a>2ã€keyword å…³é”®è¯å­—æ®µ</h3><p>ä¸Šè¾¹ä»‹ç»çš„ <code>text</code> æ–‡æœ¬å­—æ®µåœ¨æ˜ å°„æ—¶è¦è®¾ç½®åˆ†è¯å™¨ï¼Œ<code>keyword</code> å­—æ®µä¸ºå…³é”®å­—å­—æ®µï¼Œé€šå¸¸æœç´¢ <code>keyword</code> æ˜¯æŒ‰ç…§æ•´ä½“æœç´¢ï¼Œæ‰€ä»¥åˆ›å»º <code>keyword</code> å­—æ®µçš„ç´¢å¼•æ—¶æ˜¯ä¸è¿›è¡Œåˆ†è¯çš„ï¼Œæ¯”å¦‚ï¼šé‚®æ”¿ç¼–ç ã€æ‰‹æœºå·ç ã€èº«ä»½è¯ç­‰ã€‚<code>keyword</code> å­—æ®µé€šå¸¸ç”¨äºè¿‡è™‘ã€æ’åºã€èšåˆç­‰ã€‚</p><h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•åº“è¿›è¡Œæµ‹è¯•ï¼Œæˆ–è€…åˆ é™¤åŸæ¥çš„ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„</p><p>1ã€åˆ›å»ºç´¢å¼•åº“ <code>xc_course2</code></p><p>PUT <a href="http://10.1.1.168:9200/xc_course2" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course2</a></p><div class="hljs"><pre><code class="hljs json">&#123;  <span class="hljs-attr">"settings"</span>:&#123;  <span class="hljs-attr">"index"</span>:&#123;      <span class="hljs-attr">"number_of_shards"</span>:<span class="hljs-number">1</span>,      <span class="hljs-attr">"number_of_replicas"</span>:<span class="hljs-number">0</span>   &#125;      &#125;&#125;</code></pre></div><p>2ã€åˆ›å»ºæ˜ å°„</p><p>è¿™é‡Œæˆ‘ä»¬å°† <code>name</code> å’Œ <code>studymodel</code> è¿™ä¸¤ä¸ªå­—æ®µçš„ <code>type</code> è®¾ç½®ä¸º <code>keyword</code></p><p>POST <a href="http://10.1.1.168:9200/xc_course2/doc/_mapping" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course2/doc/_mapping</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"properties"</span>: &#123;        <span class="hljs-attr">"name"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"description"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>        &#125;,        <span class="hljs-attr">"studymodel"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;    &#125;&#125;</code></pre></div><p>3ã€åˆ›å»ºæ–‡æ¡£</p><p>åˆ›å»ºæ˜ å°„åï¼Œæˆ‘ä»¬åˆ›å»ºæ–‡æ¡£æ•°æ®ç”¨äºæµ‹è¯•</p><p>POST <a href="http://10.1.1.168:9200/xc_course2/doc/4028e58161bcf7f40161bcf8b77c0000" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course2/doc/4028e58161bcf7f40161bcf8b77c0000</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"javaç¼–ç¨‹åŸºç¡€"</span>,    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"javaè¯­è¨€æ˜¯ä¸–ç•Œç¬¬ä¸€ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è½¯ä»¶å¼€å‘é¢†åŸŸä½¿ç”¨äººæ•°æœ€å¤šã€‚"</span>,    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>&#125;</code></pre></div><p>4ã€æµ‹è¯•æŸ¥è¯¢</p><p>GET <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:9200/xc_course2/_search?q=name:java</p><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"took"</span>: <span class="hljs-number">2</span>,    <span class="hljs-attr">"timed_out"</span>: <span class="hljs-literal">false</span>,    <span class="hljs-attr">"_shards"</span>: &#123;        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"successful"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"skipped"</span>: <span class="hljs-number">0</span>,        <span class="hljs-attr">"failed"</span>: <span class="hljs-number">0</span>    &#125;,    <span class="hljs-attr">"hits"</span>: &#123;        <span class="hljs-attr">"total"</span>: <span class="hljs-number">0</span>,        <span class="hljs-attr">"max_score"</span>: <span class="hljs-literal">null</span>,        <span class="hljs-attr">"hits"</span>: []    &#125;&#125;</code></pre></div><p><code>name</code>æ˜¯ <code>keyword</code> ç±»å‹ï¼Œæ‰€ä»¥æŸ¥è¯¢æ–¹å¼æ˜¯ç²¾ç¡®æŸ¥è¯¢ï¼Œæ‰€ä»¥æŸ¥è¯¢ä¸åˆ°ä»»ä½•æ•°æ®ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å°è¯•ä¸€ä¸‹ç²¾ç¡®çš„æŸ¥è¯¢</p><p>GET <a href="http://10.1.1.168:9200/xc_course2/_search?q=name:java%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course2/_search?q=name:javaç¼–ç¨‹åŸºç¡€</a></p><p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"took"</span>: <span class="hljs-number">2</span>,    <span class="hljs-attr">"timed_out"</span>: <span class="hljs-literal">false</span>,    <span class="hljs-attr">"_shards"</span>: &#123;        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"successful"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"skipped"</span>: <span class="hljs-number">0</span>,        <span class="hljs-attr">"failed"</span>: <span class="hljs-number">0</span>    &#125;,    <span class="hljs-attr">"hits"</span>: &#123;        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,        <span class="hljs-attr">"max_score"</span>: <span class="hljs-number">0.2876821</span>,        <span class="hljs-attr">"hits"</span>: [            &#123;                <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course2"</span>,                <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"4028e58161bcf7f40161bcf8b77c0000"</span>,                <span class="hljs-attr">"_score"</span>: <span class="hljs-number">0.2876821</span>,                <span class="hljs-attr">"_source"</span>: &#123;                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"javaç¼–ç¨‹åŸºç¡€"</span>,                    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"javaè¯­è¨€æ˜¯ä¸–ç•Œç¬¬ä¸€ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è½¯ä»¶å¼€å‘é¢†åŸŸä½¿ç”¨äººæ•°æœ€å¤šã€‚"</span>,                    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>                &#125;            &#125;        ]    &#125;&#125;</code></pre></div><p>æŸ¥è¯¢æˆåŠŸã€‚</p><h3 id="3ã€date-æ—¥æœŸç±»å‹"><a href="#3ã€date-æ—¥æœŸç±»å‹" class="headerlink" title="3ã€date æ—¥æœŸç±»å‹"></a>3ã€date æ—¥æœŸç±»å‹</h3><p>æ—¥æœŸç±»å‹ä¸ç”¨è®¾ç½®åˆ†è¯å™¨ï¼Œé€šå¸¸æ—¥æœŸç±»å‹çš„å­—æ®µç”¨äºæ’åºã€‚</p><p><strong>format å±æ€§</strong></p><p>é€šè¿‡ <code>format</code> è®¾ç½®æ—¥æœŸæ ¼å¼</p><p>ä¾‹å­ï¼š</p><p>ä¸‹è¾¹çš„è®¾ç½®å…è®¸ <code>date</code>å­—æ®µå­˜å‚¨å¹´æœˆæ—¥æ—¶åˆ†ç§’ã€å¹´æœˆæ—¥åŠæ¯«ç§’ä¸‰ç§æ ¼å¼ã€‚</p><p>POST: <a href="http://10.1.1.168:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course/doc/_mapping</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"properties"</span>: &#123;        <span class="hljs-attr">"timestamp"</span>: &#123;        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,        <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyyâ€MMâ€dd HH:mm:ss||yyyyâ€MMâ€dd"</span>        &#125;    &#125;&#125;</code></pre></div><p>æ’å…¥æ–‡æ¡£ï¼š</p><p>POST: <a href="http://localhost:9200/xc_course/doc/00002" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/00002</a></p><div class="hljs"><pre><code class="hljs json">&#123;     <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>,    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"spring åœ¨javaé¢†åŸŸéå¸¸æµè¡Œï¼Œjavaç¨‹åºå‘˜éƒ½åœ¨ç”¨ã€‚"</span>,    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,    <span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/01/wKhlQFqO4MmAOP53AAAcwDwm6SU490.jpg"</span>,    <span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2018â€07â€04 18:28:58"</span>&#125;</code></pre></div><p>æŸ¥è¯¢æµ‹è¯•</p><p>GET <a href="http://10.1.1.168:9200/xc_course/_search?q=name:%E5%BC%80%E5%8F%91" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course/_search?q=name:å¼€å‘</a></p><h3 id="4ã€æ•°å€¼ç±»å‹"><a href="#4ã€æ•°å€¼ç±»å‹" class="headerlink" title="4ã€æ•°å€¼ç±»å‹"></a>4ã€æ•°å€¼ç±»å‹</h3><p>ä¸‹è¾¹æ˜¯ESæ”¯æŒçš„æ•°å€¼ç±»å‹</p><p><a href="https://qnoss.codeyee.com/20200704_10/image33" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image33.png" srcset="/img/loading.gif" alt="img"></a></p><p>1ã€å°½é‡é€‰æ‹©èŒƒå›´å°çš„ç±»å‹ï¼Œæé«˜æœç´¢æ•ˆç‡</p><p>2ã€å¯¹äºæµ®ç‚¹æ•°å°½é‡ç”¨ <strong>æ¯”ä¾‹å› å­</strong>ï¼Œæ¯”å¦‚ä¸€ä¸ªä»·æ ¼å­—æ®µï¼Œå•ä½ä¸ºå…ƒï¼Œæˆ‘ä»¬å°†æ¯”ä¾‹å› å­è®¾ç½®ä¸º <code>100</code>è¿™åœ¨ <code>ES</code> ä¸­ä¼šæŒ‰ åˆ† å­˜å‚¨ï¼Œæ˜ å°„å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs json">"price": &#123;    "type": "scaled_float",    "scaling_factor": 100&#125;,</code></pre></div><p>ç”±äºæ¯”ä¾‹å› å­ä¸º100ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥çš„ä»·æ ¼æ˜¯ <code>23.45</code> åˆ™ <code>ES</code> ä¸­ä¼šå°† <code>23.45</code> ä¹˜ä»¥ <code>100</code> å­˜å‚¨åœ¨ESä¸­ã€‚</p><p>å¦‚æœè¾“å…¥çš„ä»·æ ¼æ˜¯ <code>23.456</code>ï¼ŒES ä¼šå°† <code>23.456</code> ä¹˜ä»¥ <code>100</code> å†å–ä¸€ä¸ªæ¥è¿‘åŸå§‹å€¼çš„æ•°ï¼Œå¾—å‡º <code>2346</code>ã€‚</p><p>ä½¿ç”¨æ¯”ä¾‹å› å­çš„å¥½å¤„æ˜¯ <strong>æ•´å‹æ¯”æµ®ç‚¹å‹æ›´æ˜“å‹ç¼©</strong>ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´ã€‚</p><p>å¦‚æœæ¯”ä¾‹å› å­ä¸é€‚åˆï¼Œåˆ™ä»ä¸‹è¡¨é€‰æ‹©èŒƒå›´å°çš„å»ç”¨ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_10/image34" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image34.png" srcset="/img/loading.gif" alt="img"></a></p><p>æ›´æ–°å·²æœ‰æ˜ å°„ï¼Œå¹¶æ’å…¥æ–‡æ¡£ï¼š</p><p>POST: <a href="http://localhost:9200/xc_course/doc/3" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/3</a></p><div class="hljs"><pre><code class="hljs json">&#123; <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>,    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"spring åœ¨javaé¢†åŸŸéå¸¸æµè¡Œï¼Œjavaç¨‹åºå‘˜éƒ½åœ¨ç”¨ã€‚"</span>,    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,    <span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/01/wKhlQFqO4MmAOP53AAAcwDwm6SU490.jpg"</span>,    <span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2018â€07â€04 18:28:58"</span>,    <span class="hljs-attr">"price"</span>:<span class="hljs-number">38.6</span>&#125;</code></pre></div><h3 id="5ã€ç»¼åˆä¾‹å­"><a href="#5ã€ç»¼åˆä¾‹å­" class="headerlink" title="5ã€ç»¼åˆä¾‹å­"></a>5ã€ç»¼åˆä¾‹å­</h3><p>1ã€å‘é€ DELETE è¯·æ±‚åˆ° <code>http://10.1.1.168:9200/xc_course</code></p><p>2ã€åˆ›å»ºï¼Œå‘é€PUTè¯·æ±‚ <code>http://localhost:9200/xc_course</code> ç´¢å¼•åº“åç§°</p><div class="hljs"><pre><code class="hljs json">&#123;  <span class="hljs-attr">"settings"</span>:&#123;  <span class="hljs-attr">"index"</span>:&#123;      <span class="hljs-attr">"number_of_shards"</span>:<span class="hljs-number">1</span>,      <span class="hljs-attr">"number_of_replicas"</span>:<span class="hljs-number">0</span>   &#125;      &#125;&#125;</code></pre></div><p>3ã€åˆ›å»ºå¦‚ä¸‹æ˜ å°„</p><p>postï¼š<a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"properties"</span>: &#123;        <span class="hljs-attr">"name"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>        &#125;,        <span class="hljs-attr">"description"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>        &#125;,        <span class="hljs-attr">"pic"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,            <span class="hljs-attr">"index"</span>: <span class="hljs-literal">false</span>        &#125;,        <span class="hljs-attr">"studymodel"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>        &#125;    &#125;&#125;</code></pre></div><p>4ã€æ’å…¥æ–‡æ¡£</p><p>POST: <a href="http://localhost:9200/xc_course/doc/1" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/1</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bootstrapå¼€å‘"</span>,    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Bootstrapæ˜¯ç”±Twitteræ¨å‡ºçš„ä¸€ä¸ªå‰å°é¡µé¢å¼€å‘æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„å¼€å‘æ¡†æ¶ï¼Œæ­¤æ¡†æ¶é›†æˆäº†å¤šç§é¡µé¢æ•ˆæœã€‚æ­¤å¼€å‘æ¡†æ¶åŒ…å«äº†å¤§é‡çš„CSSã€JSç¨‹åºä»£ç ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯ä¸æ“…é•¿é¡µé¢å¼€å‘çš„ç¨‹åºäººå‘˜ï¼‰è½»æ¾çš„å®ç°ä¸€ä¸ªä¸å—æµè§ˆå™¨é™åˆ¶çš„ç²¾ç¾ç•Œé¢æ•ˆæœã€‚"</span>,    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201002"</span>,    <span class="hljs-attr">"price"</span>: <span class="hljs-number">38.6</span>,    <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"2018-04-25 19:11:35"</span>,    <span class="hljs-attr">"pic"</span>: <span class="hljs-string">"group1/M00/00/00/wKhlQFs6RCeAY0pHAA Jx5ZjNDEM428.jpg"</span>&#125;</code></pre></div><p>5ã€æœç´¢æµ‹è¯•</p><p>GET: <a href="http://10.1.1.168:9200/xc_course/doc/_search?q=name:%E5%BC%80%E5%8F%91" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course/doc/_search?q=name:å¼€å‘</a></p><h1 id="å…­ã€ç´¢å¼•ç®¡ç†ï¼ˆJava-APIï¼‰"><a href="#å…­ã€ç´¢å¼•ç®¡ç†ï¼ˆJava-APIï¼‰" class="headerlink" title="å…­ã€ç´¢å¼•ç®¡ç†ï¼ˆJava APIï¼‰"></a>å…­ã€ç´¢å¼•ç®¡ç†ï¼ˆJava APIï¼‰</h1><h2 id="1-æ­å»ºå·¥ç¨‹"><a href="#1-æ­å»ºå·¥ç¨‹" class="headerlink" title="1. æ­å»ºå·¥ç¨‹"></a>1. æ­å»ºå·¥ç¨‹</h2><h3 id="1ã€ESå®¢æˆ·ç«¯ç®€ä»‹"><a href="#1ã€ESå®¢æˆ·ç«¯ç®€ä»‹" class="headerlink" title="1ã€ESå®¢æˆ·ç«¯ç®€ä»‹"></a>1ã€ESå®¢æˆ·ç«¯ç®€ä»‹</h3><p>ESæä¾›å¤šç§ä¸åŒçš„å®¢æˆ·ç«¯ï¼š</p><p><strong>TransportClient</strong></p><p>ESæä¾›çš„ä¼ ç»Ÿå®¢æˆ·ç«¯ï¼Œå®˜æ–¹è®¡åˆ’8.0ç‰ˆæœ¬åˆ é™¤æ­¤å®¢æˆ·ç«¯ã€‚</p><p><strong>RestClient</strong></p><p><code>RestClient</code> æ˜¯å®˜æ–¹æ¨èä½¿ç”¨çš„ï¼Œå®ƒåŒ…æ‹¬ä¸¤ç§ï¼š<code>Java Low Level REST Client</code> å’Œ <code>Java High Level REST Client</code>ã€‚</p><p>ESåœ¨ <strong>6.0</strong> ä¹‹åæä¾› <code>Java High Level REST Client</code>ï¼Œ ä¸¤ç§å®¢æˆ·ç«¯å®˜æ–¹æ›´æ¨èä½¿ç”¨ J<code>ava High Level REST Client</code>ï¼Œä¸è¿‡å½“å‰å®ƒè¿˜å¤„äºå®Œå–„ä¸­ï¼Œæœ‰äº›åŠŸèƒ½è¿˜æ²¡æœ‰ã€‚</p><p>æ–‡ç« ä¸­å‡†å¤‡é‡‡ç”¨ <code>Java High Level REST Client</code>ï¼Œå¦‚æœå®ƒæœ‰ä¸æ”¯æŒçš„åŠŸèƒ½ï¼Œåˆ™ä½¿ç”¨ <code>Java Low Level REST Client</code>ã€‚</p><p>æ·»åŠ ä¾èµ–ï¼š</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearchâ€restâ€highâ€levelâ€client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h3 id="2ã€åˆ›å»ºæœç´¢å·¥ç¨‹"><a href="#2ã€åˆ›å»ºæœç´¢å·¥ç¨‹" class="headerlink" title="2ã€åˆ›å»ºæœç´¢å·¥ç¨‹"></a>2ã€åˆ›å»ºæœç´¢å·¥ç¨‹</h3><p>åˆ›å»ºæœç´¢å·¥ç¨‹ï¼ˆmavenå·¥ç¨‹ï¼‰ï¼š<code>xc-service-search</code>ï¼Œæ·»åŠ  <code>RestHighLevelClient</code> ä¾èµ–åŠ<code>junit</code> ä¾èµ–ã€‚</p><p><strong>1ï¼‰å®Œæ•´ä¾èµ–æ–‡ä»¶å¦‚ä¸‹</strong></p><p><code>pom.xml</code></p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../xc-framework-parent/pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-search<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-model<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><p><strong>2ï¼‰é…ç½®æ–‡ä»¶</strong></p><p><code>application.yml</code></p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-string">$&#123;port:40100&#125;</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">xc-search-service</span><span class="hljs-attr">xuecheng:</span>  <span class="hljs-attr">elasticsearch:</span>    <span class="hljs-attr">hostlist:</span> <span class="hljs-string">$&#123;eshostlist:127.0.0.1:9200&#125;</span> <span class="hljs-comment">#å¤šä¸ªç»“ç‚¹ä¸­é—´ç”¨é€—å·åˆ†éš”</span></code></pre></div><p><strong>3ï¼‰é…ç½®ç±»</strong></p><p>åˆ›å»º <code>com.xuecheng.search.config</code> åŒ…åœ¨å…¶ä¸‹åˆ›å»ºé…ç½®ç±»</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.search.config;<span class="hljs-keyword">import</span> org.apache.http.HttpHost;<span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><span class="hljs-comment"> **/</span><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ElasticsearchConfig</span> </span>&#123;    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.elasticsearch.hostlist&#125;"</span>)    <span class="hljs-keyword">private</span> String hostlist;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * restHighLevelClient</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title">restHighLevelClient</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-comment">//è§£æhostlisté…ç½®ä¿¡æ¯</span>        String[] split = hostlist.split(<span class="hljs-string">","</span>);        <span class="hljs-comment">//åˆ›å»ºHttpHostæ•°ç»„ï¼Œå…¶ä¸­å­˜æ”¾esä¸»æœºå’Œç«¯å£çš„é…ç½®ä¿¡æ¯</span>        HttpHost[] httpHostArray = <span class="hljs-keyword">new</span> HttpHost[split.length];        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;split.length;i++)&#123;            String item = split[i];            httpHostArray[i] = <span class="hljs-keyword">new</span> HttpHost(item.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">0</span>], Integer.parseInt(item.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">1</span>]), <span class="hljs-string">"http"</span>);        &#125;        <span class="hljs-comment">//åˆ›å»ºRestHighLevelClientå®¢æˆ·ç«¯</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestHighLevelClient(RestClient.builder(httpHostArray));    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * é¡¹ç›®ä¸»è¦ä½¿ç”¨RestHighLevelClientï¼Œå¯¹äºä½çº§çš„å®¢æˆ·ç«¯æš‚æ—¶ä¸ç”¨</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RestClient <span class="hljs-title">restClient</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-comment">//è§£æhostlisté…ç½®ä¿¡æ¯</span>        String[] split = hostlist.split(<span class="hljs-string">","</span>);        <span class="hljs-comment">//åˆ›å»ºHttpHostæ•°ç»„ï¼Œå…¶ä¸­å­˜æ”¾esä¸»æœºå’Œç«¯å£çš„é…ç½®ä¿¡æ¯</span>        HttpHost[] httpHostArray = <span class="hljs-keyword">new</span> HttpHost[split.length];        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;split.length;i++)&#123;            String item = split[i];            httpHostArray[i] = <span class="hljs-keyword">new</span> HttpHost(item.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">0</span>], Integer.parseInt(item.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">1</span>]), <span class="hljs-string">"http"</span>);        &#125;        <span class="hljs-keyword">return</span> RestClient.builder(httpHostArray).build();    &#125;&#125;</code></pre></div><p><strong>4ã€å¯åŠ¨ç±»</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.search;<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.domain.EntityScan;<span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;<span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span><span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span><span class="hljs-comment"> **/</span><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EntityScan</span>(<span class="hljs-string">"com.xuecheng.framework.domain.search"</span>)<span class="hljs-comment">//æ‰«æå®ä½“ç±»</span><span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.api"</span>&#125;)<span class="hljs-comment">//æ‰«ææ¥å£</span><span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.search"</span>&#125;)<span class="hljs-comment">//æ‰«ææœ¬é¡¹ç›®ä¸‹çš„æ‰€æœ‰ç±»</span><span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)<span class="hljs-comment">//æ‰«æcommonä¸‹çš„æ‰€æœ‰ç±»</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        SpringApplication.run(SearchApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;    &#125;&#125;</code></pre></div><h2 id="2-åˆ›å»ºç´¢å¼•åº“"><a href="#2-åˆ›å»ºç´¢å¼•åº“" class="headerlink" title="2. åˆ›å»ºç´¢å¼•åº“"></a>2. åˆ›å»ºç´¢å¼•åº“</h2><p><strong>1ã€API</strong></p><p>åˆ›å»ºç´¢å¼•ï¼š</p><p>PUTï¼š <a href="http://localhost:9200/%E7%B4%A2%E5%BC%95%E5%90%8D%E7%A7%B0" target="_blank" rel="noopener">http://localhost:9200/ç´¢å¼•åç§°</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"settings"</span>:&#123;        <span class="hljs-attr">"index"</span>:&#123;            "number_of_shards":1, #åˆ†ç‰‡çš„æ•°é‡            "number_of_replicas":0 #å‰¯æœ¬æ•°é‡        &#125;,    &#125;,&#125;</code></pre></div><p>åˆ›å»ºæ˜ å°„ï¼š</p><p><a href="http://localhost:9200/%E7%B4%A2%E5%BC%95%E5%BA%93%E5%90%8D%E7%A7%B0/%E7%B1%BB%E5%9E%8B%E5%90%8D%E7%A7%B0/" target="_blank" rel="noopener">http://localhost:9200/ç´¢å¼•åº“åç§°/ç±»å‹åç§°/</a><em>mapping</em></p><p>åˆ›å»ºç±»å‹ä¸º <code>xc_course</code> çš„æ˜ å°„ï¼Œå…±åŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼šnameã€descriptionã€studymodel</p><p>PUT: <a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"properties"</span>: &#123;        <span class="hljs-attr">"name"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>        &#125;,        <span class="hljs-attr">"description"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>        &#125;,        <span class="hljs-attr">"studymodel"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>        &#125;,        <span class="hljs-attr">"price"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"float"</span>        &#125;,        <span class="hljs-attr">"timestamp"</span>: &#123;            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyyâ€MMâ€dd HH:mm:ss||yyyyâ€MMâ€dd||epoch_millis"</span>        &#125;    &#125;&#125;</code></pre></div><p><strong>2ã€Java Client</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.search;<span class="hljs-keyword">import</span> org.elasticsearch.action.admin.indices.create.CreateIndexRequest;<span class="hljs-keyword">import</span> org.elasticsearch.action.admin.indices.create.CreateIndexResponse;<span class="hljs-keyword">import</span> org.elasticsearch.client.IndicesClient;<span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;<span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;<span class="hljs-keyword">import</span> org.elasticsearch.common.settings.Settings;<span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContent;<span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContentType;<span class="hljs-keyword">import</span> org.junit.Test;<span class="hljs-keyword">import</span> org.junit.runner.RunWith;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<span class="hljs-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-meta">@SpringBootTest</span><span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestIndex</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    RestHighLevelClient restHighLevelClient;    <span class="hljs-meta">@Autowired</span>    RestClient restClient;    <span class="hljs-comment">//åˆ›å»ºç´¢å¼•åº“</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testCreateIndex</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;        <span class="hljs-comment">//åˆ›å»ºç´¢å¼•è¯·æ±‚å¯¹è±¡</span>        CreateIndexRequest createIndexRequest = <span class="hljs-keyword">new</span> CreateIndexRequest(<span class="hljs-string">"xc_course"</span>);        <span class="hljs-comment">//è®¾ç½®ç´¢å¼•å‚æ•°</span>        createIndexRequest.settings(Settings.builder()                .put(<span class="hljs-string">"number_of_shards"</span>,<span class="hljs-number">1</span>)                .put(<span class="hljs-string">"number_of_replicas"</span>,<span class="hljs-number">0</span>)        );        <span class="hljs-comment">//è®¾ç½®ç´¢å¼•åº“çš„æ˜ å°„</span>        <span class="hljs-comment">//è¿™é‡Œçš„æ˜ å°„æ•°æ®ç›´æ¥å‰é¢æµ‹è¯•APIçš„JSONå­—ç¬¦ä¸²</span>        createIndexRequest.mapping(<span class="hljs-string">"doc"</span>,<span class="hljs-string">"&#123;\n"</span> +                <span class="hljs-string">"    \"properties\": &#123;\n"</span> +                <span class="hljs-string">"        \"name\": &#123;\n"</span> +                <span class="hljs-string">"            \"type\": \"text\",\n"</span> +                <span class="hljs-string">"            \"analyzer\": \"ik_max_word\",\n"</span> +                <span class="hljs-string">"            \"search_analyzer\": \"ik_smart\"\n"</span> +                <span class="hljs-string">"        &#125;,\n"</span> +                <span class="hljs-string">"        \"description\": &#123;\n"</span> +                <span class="hljs-string">"            \"type\": \"text\",\n"</span> +                <span class="hljs-string">"            \"analyzer\": \"ik_max_word\",\n"</span> +                <span class="hljs-string">"            \"search_analyzer\": \"ik_smart\"\n"</span> +                <span class="hljs-string">"        &#125;,\n"</span> +                <span class="hljs-string">"        \"studymodel\": &#123;\n"</span> +                <span class="hljs-string">"            \"type\": \"keyword\"\n"</span> +                <span class="hljs-string">"        &#125;,\n"</span> +                <span class="hljs-string">"        \"price\": &#123;\n"</span> +                <span class="hljs-string">"            \"type\": \"float\"\n"</span> +                <span class="hljs-string">"        &#125;,\n"</span> +                <span class="hljs-string">"        \"timestamp\": &#123;\n"</span> +                <span class="hljs-string">"            \"type\": \"date\",\n"</span> +                <span class="hljs-string">"            \"format\": \"yyyyâ€MMâ€dd HH:mm:ss||yyyyâ€MMâ€dd||epoch_millis\"\n"</span> +                <span class="hljs-string">"        &#125;\n"</span> +                <span class="hljs-string">"    &#125;\n"</span> +                <span class="hljs-string">"&#125;"</span>,XContentType.JSON);        <span class="hljs-comment">//æ“ä½œå®¢æˆ·ç«¯</span>        IndicesClient indices = restHighLevelClient.indices();        <span class="hljs-comment">//åˆ›å»ºå“åº”å¯¹è±¡</span>        CreateIndexResponse createIndexResponse = indices.create(createIndexRequest);        <span class="hljs-comment">//å¾—åˆ°å“åº”ç»“æœ</span>        <span class="hljs-keyword">boolean</span> shardsAcknowledged = createIndexResponse.isShardsAcknowledged();        System.out.println(shardsAcknowledged);    &#125;&#125;</code></pre></div><p>è¿è¡ŒåæˆåŠŸåˆ›å»ºæ˜ å°„</p><h2 id="3-æ·»åŠ æ–‡æ¡£"><a href="#3-æ·»åŠ æ–‡æ¡£" class="headerlink" title="3. æ·»åŠ æ–‡æ¡£"></a>3. æ·»åŠ æ–‡æ¡£</h2><p><strong>1ã€API</strong></p><p>æ ¼å¼å¦‚ä¸‹ï¼š PUT <code>/{index}/{type}/{id} { &quot;field&quot;: &quot;value&quot;, ... }</code></p><p>å¦‚æœä¸æŒ‡å®š <code>id</code>ï¼Œ<code>ES</code> ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚</p><p>ä¸€ä¸ªä¾‹å­ï¼š<br>put <a href="http://localhost:9200/xc_course/doc/3" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/3</a></p><div class="hljs"><pre><code class="hljs json">&#123;     <span class="hljs-attr">"name"</span>:<span class="hljs-string">"spring cloudå®æˆ˜"</span>,    <span class="hljs-attr">"description"</span>:<span class="hljs-string">"æœ¬è¯¾ç¨‹ä¸»è¦ä»å››ä¸ªç« èŠ‚è¿›è¡Œè®²è§£ï¼š 1.å¾®æœåŠ¡æ¶æ„å…¥é—¨ 2.spring cloud åŸºç¡€å…¥é—¨ 3.å®æˆ˜Spring</span><span class="hljs-string">    Boot 4.æ³¨å†Œä¸­å¿ƒeurekaã€‚"</span>,    <span class="hljs-attr">"studymodel"</span>:<span class="hljs-string">"201001"</span>    <span class="hljs-string">"price"</span>:<span class="hljs-number">5.6</span>&#125;</code></pre></div><p><strong>2ã€Java Client</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ·»åŠ æ–‡æ¡£</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAddDoc</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    <span class="hljs-comment">//å‡†å¤‡jsonæ•°æ®</span>    Map&lt;String, Object&gt; jsonMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    jsonMap.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"spring cloudå®æˆ˜"</span>);    jsonMap.put(<span class="hljs-string">"description"</span>, <span class="hljs-string">"æœ¬è¯¾ç¨‹ä¸»è¦ä»å››ä¸ªç« èŠ‚è¿›è¡Œè®²è§£ï¼š 1.å¾®æœåŠ¡æ¶æ„å…¥é—¨ 2.spring cloud åŸºç¡€å…¥é—¨ 3.å®æˆ˜Spring Boot 4.æ³¨å†Œä¸­å¿ƒeurekaã€‚"</span>);    jsonMap.put(<span class="hljs-string">"studymodel"</span>, <span class="hljs-string">"201001"</span>);    SimpleDateFormat dateFormat =<span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"yyyyâ€MMâ€dd HH:mm:ss"</span>);    jsonMap.put(<span class="hljs-string">"timestamp"</span>, dateFormat.format(<span class="hljs-keyword">new</span> Date()));    jsonMap.put(<span class="hljs-string">"price"</span>, <span class="hljs-number">5.6f</span>);    <span class="hljs-comment">//ç´¢å¼•è¯·æ±‚å¯¹è±¡</span>    IndexRequest indexRequest = <span class="hljs-keyword">new</span> IndexRequest(<span class="hljs-string">"xc_course"</span>,<span class="hljs-string">"doc"</span>);    <span class="hljs-comment">//æŒ‡å®šç´¢å¼•æ–‡æ¡£å†…å®¹</span>    indexRequest.source(jsonMap);    <span class="hljs-comment">//ç´¢å¼•å“åº”å¯¹è±¡</span>    IndexResponse indexResponse = restHighLevelClient.index(indexRequest);    <span class="hljs-comment">//è·å–å“åº”ç»“æœ</span>    DocWriteResponse.Result result = indexResponse.getResult();    System.out.println(result);&#125;</code></pre></div><h2 id="4-æŸ¥è¯¢æ–‡æ¡£"><a href="#4-æŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="4. æŸ¥è¯¢æ–‡æ¡£"></a>4. æŸ¥è¯¢æ–‡æ¡£</h2><p><strong>1ã€API</strong></p><p>æ ¼å¼å¦‚ä¸‹ï¼š GET <code>/{index}/{type}/{id}</code></p><p><strong>2ã€Java Client</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æŸ¥è¯¢æ–‡æ¡£</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getDoc</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    GetRequest getRequest = <span class="hljs-keyword">new</span> GetRequest(            <span class="hljs-string">"xc_course"</span>,            <span class="hljs-string">"doc"</span>,            <span class="hljs-string">"eWb_kXEB39nW0xAzs9Pd"</span>    );    GetResponse getResponse = restHighLevelClient.get(getRequest);    <span class="hljs-keyword">boolean</span> exists = getResponse.isExists();    <span class="hljs-keyword">if</span>(!exists)&#123;        System.out.println(<span class="hljs-string">"æ–‡æ¡£ä¸å­˜åœ¨"</span>);    &#125;<span class="hljs-keyword">else</span>&#123;        Map&lt;String, Object&gt; sourceAsMap = getResponse.getSourceAsMap();        System.out.println(sourceAsMap);    &#125;&#125;</code></pre></div><h2 id="5-æ›´æ–°æ–‡æ¡£"><a href="#5-æ›´æ–°æ–‡æ¡£" class="headerlink" title="5. æ›´æ–°æ–‡æ¡£"></a>5. æ›´æ–°æ–‡æ¡£</h2><p><strong>1ã€API</strong></p><p><code>ES</code> æ›´æ–°æ–‡æ¡£çš„é¡ºåºæ˜¯ï¼šå…ˆæ£€ç´¢åˆ°æ–‡æ¡£ã€å°†åŸæ¥çš„æ–‡æ¡£æ ‡è®°ä¸ºåˆ é™¤ã€åˆ›å»ºæ–°æ–‡æ¡£ã€åˆ é™¤æ—§æ–‡æ¡£ï¼Œåˆ›å»ºæ–°æ–‡æ¡£å°±ä¼šé‡å»ºç´¢å¼•ã€‚</p><p>é€šè¿‡è¯·æ±‚ <code>Url</code> æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><p>1ï¼‰å®Œå…¨æ›¿æ¢</p><p>POSTï¼š<a href="http://localhost:9200/xc_test/doc/3" target="_blank" rel="noopener">http://localhost:9200/xc_test/doc/3</a></p><div class="hljs"><pre><code class="hljs json">&#123; <span class="hljs-attr">"name"</span>:<span class="hljs-string">"spring cloudå®æˆ˜"</span>,    <span class="hljs-attr">"description"</span>:<span class="hljs-string">"æœ¬è¯¾ç¨‹ä¸»è¦ä»å››ä¸ªç« èŠ‚è¿›è¡Œè®²è§£ï¼š 1.å¾®æœåŠ¡æ¶æ„å…¥é—¨ 2.spring cloud åŸºç¡€å…¥é—¨ 3.å®æˆ˜SpringBoot 4.æ³¨å†Œä¸­å¿ƒeurekaã€‚"</span>,    <span class="hljs-attr">"studymodel"</span>:<span class="hljs-string">"201001"</span>,    <span class="hljs-attr">"price"</span>:<span class="hljs-number">5.6</span>&#125;</code></pre></div><p>2ï¼‰å±€éƒ¨æ›´æ–°</p><p>ä¸‹è¾¹çš„ä¾‹å­æ˜¯åªæ›´æ–° <code>price</code> å­—æ®µã€‚</p><p>post: <a href="http://localhost:9200/xc_test/doc/3/_update" target="_blank" rel="noopener">http://localhost:9200/xc_test/doc/3/_update</a></p><div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"doc"</span>:&#123;<span class="hljs-attr">"price"</span>:<span class="hljs-number">66.6</span>&#125;&#125;</code></pre></div><p><strong>2ã€Java Client</strong></p><p>ä½¿ç”¨ <code>Client Api</code> æ›´æ–°æ–‡æ¡£çš„æ–¹æ³•åŒä¸Šè¾¹ç¬¬äºŒç§å±€éƒ¨æ›´æ–°æ–¹æ³•ã€‚<br>å¯ä»¥æŒ‡å®šæ–‡æ¡£çš„éƒ¨åˆ†å­—æ®µä¹Ÿå¯ä»¥æŒ‡å®šå®Œæ•´çš„æ–‡æ¡£å†…å®¹ã€‚</p><div class="hljs"><pre><code class="hljs json"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ›´æ–°æ–‡æ¡£</span><span class="hljs-comment"> */</span>@Testpublic void updateDoc() throws IOException &#123;    UpdateRequest updateRequest = new UpdateRequest("xc_course", "doc","eWb_kXEB39nW0xAzs9Pd");    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();    map.put("name", "spring cloud alibaba");    updateRequest.doc(map);    UpdateResponse update = restHighLevelClient.update(updateRequest);    RestStatus status = update.status();    System.out.println(status);&#125;</code></pre></div><h2 id="6-åˆ é™¤æ–‡æ¡£"><a href="#6-åˆ é™¤æ–‡æ¡£" class="headerlink" title="6. åˆ é™¤æ–‡æ¡£"></a>6. åˆ é™¤æ–‡æ¡£</h2><p><strong>1ã€API</strong></p><p>æ ¹æ® <code>id</code> åˆ é™¤ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p>DELETEï¼š <code>/{index}/{type}/{id}</code></p><p>æœç´¢åŒ¹é…åˆ é™¤ï¼Œå°†æœç´¢å‡ºæ¥çš„è®°å½•åˆ é™¤ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p>POSTï¼š <code>/{index}/{type}/_delete_by_query</code></p><p>ä¸‹è¾¹æ˜¯æœç´¢æ¡ä»¶ä¾‹å­ï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"query"</span>:&#123;        <span class="hljs-attr">"term"</span>:&#123;        <span class="hljs-attr">"studymodel"</span>:<span class="hljs-string">"201001"</span>        &#125;    &#125;&#125;</code></pre></div><p>ä¸Šè¾¹ä¾‹å­çš„æœç´¢åŒ¹é…åˆ é™¤ä¼šå°† <code>studymodel</code> ä¸º <code>201001</code> çš„è®°å½•å…¨éƒ¨åˆ é™¤ã€‚</p><p><strong>2ã€Java Client</strong></p><div class="hljs"><pre><code class="hljs json"><span class="hljs-comment">//æ ¹æ®idåˆ é™¤æ–‡æ¡£</span>@Testpublic void testDelDoc() throws IOException &#123;    <span class="hljs-comment">//åˆ é™¤æ–‡æ¡£id</span>    String id = "eqP_amQBKsGOdwJ4fHiC";    <span class="hljs-comment">//åˆ é™¤ç´¢å¼•è¯·æ±‚å¯¹è±¡</span>    DeleteRequest deleteRequest = new DeleteRequest("xc_course","doc",id);    <span class="hljs-comment">//å“åº”å¯¹è±¡</span>    DeleteResponse deleteResponse = client.delete(deleteRequest);    <span class="hljs-comment">//è·å–å“åº”ç»“æœ</span>    DocWriteResponse.Result result = deleteResponse.getResult();    System.out.println(result);&#125;</code></pre></div><p>æœç´¢åŒ¹é…åˆ é™¤è¿˜æ²¡æœ‰å…·ä½“çš„ <code>api</code>ï¼Œå¯ä»¥é‡‡ç”¨å…ˆæœç´¢å‡ºæ–‡æ¡£ <code>id</code>ï¼Œæ ¹æ®æ–‡æ¡£ <code>id</code> åˆ é™¤ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ElasticSearch</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day09ï¼šEurekaã€Feignã€è¯¾ç¨‹é¢„è§ˆå®ç°</title>
    <link href="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/"/>
    <url>/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day09</code> çš„å†…å®¹</p><ul><li>æ„å»ºåŸºäº <code>Eureka</code> çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒ</li><li><code>Ribbon</code> çš„åŸºæœ¬ä½¿ç”¨ï¼Œä»¥åŠä½¿ç”¨ <code>Ribbon</code> æ¥è¿›è¡ŒæœåŠ¡é—´çš„è´Ÿè½½å‡è¡¡è°ƒç”¨</li><li>ä½¿ç”¨ <code>Feign</code> å®ç°æœåŠ¡ä¹‹é—´çš„è¿œç¨‹è°ƒç”¨</li><li>è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¼€å‘</li></ul><h1 id="ä¸€ã€Eureka-æ³¨å†Œä¸­å¿ƒ"><a href="#ä¸€ã€Eureka-æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="ä¸€ã€Eureka æ³¨å†Œä¸­å¿ƒ"></a>ä¸€ã€Eureka æ³¨å†Œä¸­å¿ƒ</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åœ¨å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼ŒæœåŠ¡å±‚è¢«æ‹†åˆ†æˆäº†å¾ˆå¤šçš„å¾®æœåŠ¡ï¼Œå¾®æœåŠ¡çš„ä¿¡æ¯å¦‚ä½•ç®¡ç†ï¼ŸSpring Cloudä¸­æä¾›æœåŠ¡æ³¨å†Œä¸­å¿ƒæ¥ç®¡ç†å¾®æœåŠ¡ä¿¡æ¯ã€‚</p><p><strong>ä¸ºä»€ä¹ˆ è¦ç”¨æ³¨å†Œä¸­å¿ƒï¼Ÿ</strong></p><p>1ã€å¾®æœåŠ¡æ•°é‡ä¼—å¤šï¼Œè¦è¿›è¡Œè¿œç¨‹è°ƒç”¨å°±éœ€è¦çŸ¥é“æœåŠ¡ç«¯çš„ <code>ip</code> åœ°å€å’Œç«¯å£ï¼Œæ³¨å†Œä¸­å¿ƒå¸®åŠ©æˆ‘ä»¬ç®¡ç†è¿™äº›æœåŠ¡çš„ <code>ip</code> å’Œç«¯å£ã€‚</p><p>2ã€å¾®æœåŠ¡ä¼šå®æ—¶ä¸ŠæŠ¥è‡ªå·±çš„çŠ¶æ€ï¼Œæ³¨å†Œä¸­å¿ƒç»Ÿä¸€ç®¡ç†è¿™äº›å¾®æœåŠ¡çš„çŠ¶æ€ï¼Œå°†å­˜åœ¨é—®é¢˜çš„æœåŠ¡è¸¢å‡ºæœåŠ¡åˆ—è¡¨ï¼Œå®¢æˆ·ç«¯è·å–åˆ°å¯ç”¨çš„æœåŠ¡è¿›è¡Œè°ƒç”¨ã€‚</p><h2 id="2-Eurekaä»‹ç»"><a href="#2-Eurekaä»‹ç»" class="headerlink" title="2. Eurekaä»‹ç»"></a>2. Eurekaä»‹ç»</h2><p><code>Spring Cloud Eureka</code> æ˜¯å¯¹ <code>Netflix</code> å…¬å¸çš„ <code>Eureka</code> çš„äºŒæ¬¡å°è£…ï¼Œå®ƒå®ç°äº†æœåŠ¡æ²»ç†çš„åŠŸèƒ½ï¼Œ<code>Spring Cloud Eureka</code> æä¾›æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯å³æ˜¯ <code>Eureka</code> æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå®¢æˆ·ç«¯å®Œæˆå¾®æœåŠ¡å‘ <code>Eureka</code> æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯å‡é‡‡ç”¨Javaè¯­è¨€ç¼–å†™ã€‚ä¸‹å›¾æ˜¾ç¤ºäº† <code>Eureka Server</code> ä¸ <code>Eureka Client</code> çš„å…³ç³»ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_9/image1" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image1.png" srcset="/img/loading.gif" alt="img"></a></p><p>1ã€<code>Eureka Server</code> æ˜¯æœåŠ¡ç«¯ï¼Œè´Ÿè´£ç®¡ç†å„å„å¾®æœåŠ¡ç»“ç‚¹çš„ä¿¡æ¯å’ŒçŠ¶æ€ã€‚</p><p>2 ã€åœ¨å¾®æœåŠ¡ä¸Šéƒ¨ç½² <code>Eureka Client</code> ç¨‹åºï¼Œè¿œç¨‹è®¿é—® <code>Eureka Server</code> å°†è‡ªå·±æ³¨å†Œåœ¨ <code>Eureka Server</code>ã€‚</p><p>3ã€å¾®æœåŠ¡éœ€è¦è°ƒç”¨å¦ä¸€ä¸ªå¾®æœåŠ¡æ—¶ä» <code>Eureka Server</code> ä¸­è·å–æœåŠ¡è°ƒç”¨åœ°å€ï¼Œè¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚</p><h2 id="3-Eureka-Serveræ­å»º"><a href="#3-Eureka-Serveræ­å»º" class="headerlink" title="3. Eureka Serveræ­å»º"></a>3. Eureka Serveræ­å»º</h2><h3 id="1ã€å•æœºç¯å¢ƒæ­å»º"><a href="#1ã€å•æœºç¯å¢ƒæ­å»º" class="headerlink" title="1ã€å•æœºç¯å¢ƒæ­å»º"></a>1ã€å•æœºç¯å¢ƒæ­å»º</h3><p><strong>1ï¼‰åˆ›å»º xc-govern-center å·¥ç¨‹ï¼š</strong></p><p>åŒ…ç»“æ„ï¼šcom.xuecheng.govern.center</p><p><a href="https://qnoss.codeyee.com/20200704_9/image2" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image2.png" srcset="/img/loading.gif" alt="img"></a></p><p><strong>2ï¼‰æ·»åŠ ä¾èµ–</strong></p><p>åœ¨çˆ¶å·¥ç¨‹æ·»åŠ ï¼šï¼ˆæœ‰äº†åˆ™ä¸ç”¨é‡å¤æ·»åŠ ï¼‰</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div><p><strong>3ï¼‰å¯åŠ¨ç±»</strong></p><div class="hljs"><pre><code class="hljs javascript">package com.xuecheng.govern.center;<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;@EnableEurekaServer  <span class="hljs-comment">//æ ‡è¯†è¿™æ˜¯ä¸€ä¸ªEurekaServer</span>@SpringBootApplicationpublic <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GorvernCenterApplication</span> </span>&#123;    public <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> main(<span class="hljs-built_in">String</span>[] args) &#123;        SpringApplication.run(GorvernCenterApplication.class,args);    &#125;&#125;</code></pre></div><blockquote><p>éœ€è¦åœ¨å¯åŠ¨ç±»ä¸Šç”¨ <code>@EnableEurekaServer</code> æ ‡è¯†æ­¤æœåŠ¡ä¸ºEurekaæœåŠ¡</p></blockquote><p><strong>4ï¼‰é…ç½®æ–‡ä»¶</strong></p><p>ä»å…¶å®ƒæœåŠ¡æ‹·è´ <code>application.yml</code> å’Œ <code>logback-spring.xml</code>ã€‚</p><p>application.yml çš„é…ç½®å†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span> <span class="hljs-attr">port:</span> <span class="hljs-number">50101</span> <span class="hljs-comment">#æœåŠ¡ç«¯å£</span><span class="hljs-attr">spring:</span> <span class="hljs-attr">application:</span>  <span class="hljs-attr">name:</span> <span class="hljs-string">xc-govern-center</span> <span class="hljs-comment">#æŒ‡å®šæœåŠ¡å</span><span class="hljs-attr">eureka:</span> <span class="hljs-attr">client:</span>  <span class="hljs-attr">registerWithEureka:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œï¼Œæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°EurekaæœåŠ¡ä¸­</span>  <span class="hljs-attr">fetchRegistry:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æœåŠ¡å‘ç°ï¼Œæ˜¯å¦ä»Eurekaä¸­è·å–æ³¨å†Œä¿¡æ¯</span>  <span class="hljs-attr">serviceUrl:</span> <span class="hljs-comment">#Eurekaå®¢æˆ·ç«¯ä¸EurekaæœåŠ¡ç«¯çš„äº¤äº’åœ°å€ï¼Œé«˜å¯ç”¨çŠ¶æ€é…ç½®å¯¹æ–¹çš„åœ°å€ï¼Œå•æœºçŠ¶æ€é…ç½®è‡ªå·±ï¼ˆå¦‚æœä¸é…ç½®åˆ™é»˜è®¤æœ¬æœº8761ç«¯å£ï¼‰</span>   <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:50101/eureka/</span> <span class="hljs-attr">server:</span>  <span class="hljs-attr">enable-self-preservation:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æ˜¯å¦å¼€å¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</span>  <span class="hljs-attr">eviction-interval-timer-in-ms:</span> <span class="hljs-number">60000</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œè¡¨æ¸…ç†é—´éš”ï¼ˆå•ä½æ¯«ç§’ï¼Œé»˜è®¤æ˜¯60*1000ï¼‰</span></code></pre></div><ul><li><code>registerWithEureka</code>ï¼šè¢«å…¶å®ƒæœåŠ¡è°ƒç”¨æ—¶éœ€å‘Eurekaæ³¨å†Œ</li><li><code>fetchRegistry</code>ï¼šéœ€è¦ä»Eurekaä¸­æŸ¥æ‰¾è¦è°ƒç”¨çš„ç›®æ ‡æœåŠ¡æ—¶éœ€è¦è®¾ç½®ä¸ºtrue</li><li><code>enable-self-preservation</code>ï¼šè‡ªä¿æŠ¤è®¾ç½®ï¼Œä¸‹è¾¹æœ‰ä»‹ç»ã€‚</li><li><code>eviction-interval-timer-in-ms</code>ï¼šæ¸…ç†å¤±æ•ˆç»“ç‚¹çš„é—´éš”ï¼Œåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…å¦‚æœæ²¡æœ‰æ”¶åˆ°è¯¥ç»“ç‚¹çš„ä¸ŠæŠ¥åˆ™å°†ç»“ç‚¹ä»æœåŠ¡åˆ—è¡¨ä¸­å‰”é™¤ã€‚</li></ul><p><strong>5ï¼‰å¯åŠ¨Eureka Server</strong></p><p>å¯åŠ¨Eureka Serverï¼Œæµè§ˆ50101ç«¯å£ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_9/image3" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image3.png" srcset="/img/loading.gif" alt="img"></a></p><p>è¯´æ˜ï¼š</p><p>ä¸Šå›¾çº¢è‰²æç¤ºä¿¡æ¯ï¼š<br><code>THE SELF PRESERVATION MODE IS TURNED OFF.THIS MAY NOT PROTECT INSTANCE EXPIRY IN CASE OFNETWORK/OTHER PROBLEMS.</code></p><p>è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼è¢«å…³é—­ã€‚åœ¨ç½‘ç»œæˆ–å…¶ä»–é—®é¢˜çš„æƒ…å†µä¸‹å¯èƒ½ä¸ä¼šä¿æŠ¤å®ä¾‹å¤±æ•ˆã€‚</p><p><code>Eureka Server</code> æœ‰ä¸€ç§è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå½“å¾®æœåŠ¡ä¸å†å‘ <code>Eureka Server</code> ä¸ŠæŠ¥çŠ¶æ€ï¼Œ<code>Eureka Server</code> ä¼šä»æœåŠ¡åˆ—è¡¨å°†æ­¤æœåŠ¡åˆ é™¤ï¼Œå¦‚æœå‡ºç°ç½‘ç»œå¼‚å¸¸æƒ…å†µï¼ˆå¾®æœåŠ¡æ­£å¸¸ï¼‰ï¼Œæ­¤æ—¶ <code>Eureka server</code> è¿›å…¥è‡ªä¿æŠ¤æ¨¡å¼ï¼Œä¸å†å°†å¾®æœåŠ¡ä»æœåŠ¡åˆ—è¡¨åˆ é™¤ã€‚</p><p>åœ¨å¼€å‘é˜¶æ®µå»ºè®®å…³é—­è‡ªä¿æŠ¤æ¨¡å¼ã€‚</p><p>è¯¦ç»†çš„å‚è€ƒèµ„æ–™ï¼š<a href="https://www.cnblogs.com/xishuai/p/spring-cloud-eureka-safe.html" target="_blank" rel="noopener">https://www.cnblogs.com/xishuai/p/spring-cloud-eureka-safe.html</a></p><h3 id="2ã€é«˜å¯ç”¨ç¯å¢ƒé…ç½®"><a href="#2ã€é«˜å¯ç”¨ç¯å¢ƒé…ç½®" class="headerlink" title="2ã€é«˜å¯ç”¨ç¯å¢ƒé…ç½®"></a>2ã€é«˜å¯ç”¨ç¯å¢ƒé…ç½®</h3><p><code>Eureka Server</code> é«˜å¯ç”¨ç¯å¢ƒéœ€è¦éƒ¨ç½²ä¸¤ä¸ª <code>Eureka server</code>ï¼Œå®ƒä»¬äº’ç›¸å‘å¯¹æ–¹æ³¨å†Œã€‚å¦‚æœåœ¨æœ¬æœºå¯åŠ¨ä¸¤ä¸ª <code>Eureka</code> éœ€è¦æ³¨æ„ä¸¤ä¸ª <code>Eureka Server</code> çš„ç«¯å£è¦è®¾ç½®ä¸ä¸€æ ·ï¼Œè¿™é‡Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ª <code>Eureka Server</code> å·¥ç¨‹ï¼Œå°†ç«¯å£å¯é…ç½®ï¼Œåˆ¶ä½œä¸¤ä¸ª <code>Eureka Server</code> å¯åŠ¨è„šæœ¬ï¼Œå¯åŠ¨ä¸åŒçš„ç«¯å£ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_9/image4" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image4.png" srcset="/img/loading.gif" alt="img"></a></p><p>1ã€åœ¨å®é™…ä½¿ç”¨æ—¶ <code>Eureka Server</code> è‡³å°‘éƒ¨ç½²ä¸¤å°æœåŠ¡å™¨ï¼Œå®ç°é«˜å¯ç”¨ã€‚</p><p>2ã€ä¸¤å° <code>Eureka Server</code> äº’ç›¸æ³¨å†Œã€‚</p><p>3ã€å¾®æœåŠ¡éœ€è¦è¿æ¥ä¸¤å° <code>Eureka Server</code> æ³¨å†Œï¼Œå½“å…¶ä¸­ä¸€å° <code>Eureka</code> æ­»æ‰ä¹Ÿä¸ä¼šå½±å“æœåŠ¡çš„æ³¨å†Œä¸å‘ç°ã€‚</p><p>4ã€å¾®æœåŠ¡ä¼šå®šæ—¶å‘ <code>Eureka server</code> å‘é€å¿ƒè·³ï¼ŒæŠ¥å‘Šè‡ªå·±çš„çŠ¶æ€ã€‚</p><p>5ã€å¾®æœåŠ¡ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åœ°å€ä»¥ <code>RESTful</code> æ–¹å¼å‘èµ·è¿œç¨‹è°ƒç”¨ã€‚</p><p>é…ç½®å¦‚ä¸‹:</p><p><strong>1ã€ç«¯å£é…ç½®åŠ å…¥å˜é‡</strong></p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>    <span class="hljs-attr">port:</span> <span class="hljs-string">$&#123;PORT:50101&#125;</span> <span class="hljs-comment">#æœåŠ¡ç«¯å£</span></code></pre></div><p><strong>2ã€åœ¨ Eureka æœåŠ¡ç«¯çš„åœ°å€åŠ å…¥å˜é‡</strong></p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span>  <span class="hljs-attr">client:</span>      <span class="hljs-attr">registerWithEureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œï¼Œæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°EurekaæœåŠ¡ä¸­</span>      <span class="hljs-attr">fetchRegistry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡å‘ç°ï¼Œæ˜¯å¦ä»Eurekaä¸­è·å–æ³¨å†Œä¿¡æ¯</span>      <span class="hljs-attr">serviceUrl:</span> <span class="hljs-comment">#Eurekaå®¢æˆ·ç«¯ä¸EurekaæœåŠ¡ç«¯çš„äº¤äº’åœ°å€ï¼Œé«˜å¯ç”¨çŠ¶æ€é…ç½®å¯¹æ–¹çš„åœ°å€ï¼Œå•æœºçŠ¶æ€é…ç½®è‡ªå·±ï¼ˆå¦‚æœä¸é…ç½®åˆ™é»˜è®¤æœ¬æœº8761ç«¯å£ï¼‰</span>        <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">$&#123;EUREKA_SERVER:http://eureka02:50102/eureka/&#125;</span></code></pre></div><p><strong>3ã€ é…ç½® hostname</strong></p><p><code>Eureka</code> ç»„æˆé«˜å¯ç”¨ï¼Œä¸¤ä¸ª<code>Eureka</code> äº’ç›¸å‘å¯¹æ–¹æ³¨å†Œï¼Œè¿™é‡Œéœ€è¦é€šè¿‡åŸŸåæˆ–ä¸»æœºåè®¿é—®ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸¤ä¸ª <code>Eureka</code> æœåŠ¡çš„ä¸»æœºååˆ†åˆ«ä¸º <code>eureka01</code>ã€<code>eureka02</code>ã€‚</p><p>å®Œæ•´é…ç½®å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span>  <span class="hljs-attr">client:</span>      <span class="hljs-attr">registerWithEureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œï¼Œæ˜¯å¦å°†è‡ªå·±æ³¨å†Œåˆ°EurekaæœåŠ¡ä¸­</span>      <span class="hljs-attr">fetchRegistry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡å‘ç°ï¼Œæ˜¯å¦ä»Eurekaä¸­è·å–æ³¨å†Œä¿¡æ¯</span>      <span class="hljs-attr">serviceUrl:</span> <span class="hljs-comment">#Eurekaå®¢æˆ·ç«¯ä¸EurekaæœåŠ¡ç«¯çš„äº¤äº’åœ°å€ï¼Œé«˜å¯ç”¨çŠ¶æ€é…ç½®å¯¹æ–¹çš„åœ°å€ï¼Œå•æœºçŠ¶æ€é…ç½®è‡ªå·±ï¼ˆå¦‚æœä¸é…ç½®åˆ™é»˜è®¤æœ¬æœº8761ç«¯å£ï¼‰</span>        <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">$&#123;EUREKA_SERVER:http://eureka02:50102/eureka/&#125;</span>  <span class="hljs-attr">server:</span>        <span class="hljs-attr">enable-self-preservation:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#æ˜¯å¦å¼€å¯è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼</span>        <span class="hljs-attr">eviction-interval-timer-in-ms:</span> <span class="hljs-number">60000</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œè¡¨æ¸…ç†é—´éš”ï¼ˆå•ä½æ¯«ç§’ï¼Œé»˜è®¤æ˜¯6ï¼‰0*1000</span>  <span class="hljs-attr">instance:</span>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">$&#123;EUREKA_DOMAIN:eureka01&#125;</span></code></pre></div><p>æ³¨æ„è¿™é‡Œçš„ <code>eureka01</code>ã€<code>eureka02</code> çš„åŸŸåï¼Œåœ¨å¼€æ”¾ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨hosts æ–‡ä»¶ä¸­å¢åŠ ç›¸åº”çš„æ˜ å°„ï¼š</p><div class="hljs"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> eureka01<span class="hljs-number">127.0.0.1</span> eureka02</code></pre></div><p><strong>4ã€åœ¨IDEAä¸­åˆ¶ä½œå¯åŠ¨è„šæœ¬</strong></p><p><a href="https://qnoss.codeyee.com/20200704_9/image5" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image5.png" srcset="/img/loading.gif" alt="img"></a></p><p>è¿è¡Œä¸¤ä¸ªå¯åŠ¨è„šæœ¬ï¼Œåˆ†åˆ«æµè§ˆï¼š</p><p><a href="http://localhost:50101/" target="_blank" rel="noopener">http://localhost:50101/</a><br><a href="http://localhost:50102/" target="_blank" rel="noopener">http://localhost:50102/</a></p><p>Eureka ä¸»ç”»é¢å¦‚ä¸‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_9/image6" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image6.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="0x04-æœåŠ¡æ³¨å†Œ"><a href="#0x04-æœåŠ¡æ³¨å†Œ" class="headerlink" title="0x04 æœåŠ¡æ³¨å†Œ"></a>0x04 æœåŠ¡æ³¨å†Œ</h2><p><strong>1ã€å°† cms æ³¨å†Œåˆ° Eureka Server</strong></p><p>1ï¼‰åœ¨ cms æœåŠ¡ä¸­æ·»åŠ ä¾èµ–</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- å¯¼å…¥Eurekaå®¢æˆ·ç«¯çš„ä¾èµ– --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>2ï¼‰åœ¨ <code>application.yml</code> ä¸­è¿›è¡Œé…ç½®</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span>  <span class="hljs-attr">client:</span>      <span class="hljs-attr">registerWithEureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œå¼€å…³</span>      <span class="hljs-attr">fetchRegistry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡å‘ç°å¼€å…³</span>      <span class="hljs-attr">serviceUrl:</span> <span class="hljs-comment">#Eurekaå®¢æˆ·ç«¯ä¸EurekaæœåŠ¡ç«¯è¿›è¡Œäº¤äº’çš„åœ°å€ï¼Œå¤šä¸ªä¸­é—´ç”¨é€—å·åˆ†éš”</span>        <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">$&#123;EUREKA_SERVER:http://eureka01:50101/eureka/,http://eureka02:50102/eureka/&#125;,</span>  <span class="hljs-attr">instance:</span>      <span class="hljs-attr">prefer-ip-address:</span>  <span class="hljs-literal">true</span>  <span class="hljs-comment">#å°†è‡ªå·±çš„ipåœ°å€æ³¨å†Œåˆ°EurekaæœåŠ¡ä¸­</span>      <span class="hljs-attr">ip-address:</span> <span class="hljs-string">$&#123;IP_ADDRESS:127.0.0.1&#125;</span>      <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.application.name&#125;:$&#123;server.port&#125;</span> <span class="hljs-comment">#æŒ‡å®šå®ä¾‹id</span></code></pre></div><p>3ï¼‰åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ <code>@EnableDiscoveryClient</code></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@EnableDiscoveryClient</span><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EntityScan</span>(<span class="hljs-string">"com.xuecheng.framework.domain.cms"</span>) <span class="hljs-comment">//æ‰«æå…¬å…±çš„å®ä½“ç±»</span><span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.api"</span>&#125;) <span class="hljs-comment">//æ‰«ææ¥å£</span><span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.manage_cms"</span>&#125;)  <span class="hljs-comment">// æ‰«ææœ¬é¡¹ç›®ä¸‹çš„æ‰€æœ‰ç±»</span><span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)  <span class="hljs-comment">// æ‰«æframework</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCmsApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(ManageCmsApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate(<span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory());    &#125;&#125;</code></pre></div><p>4ï¼‰åˆ·æ–° Eureka Server æŸ¥çœ‹æ³¨å†Œæƒ…å†µ</p><p><a href="https://qnoss.codeyee.com/20200704_9/image7" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image7.png" srcset="/img/loading.gif" alt="img"></a></p><p><strong>2ã€æ³¨å†Œ course æœåŠ¡</strong></p><p>æ–¹æ³•åŒä¸Šã€‚</p><p>1ã€åœ¨ <code>manage-course</code> å·¥ç¨‹ä¸­æ·»åŠ  <code>spring-cloud-starter-eureka</code> ä¾èµ–ï¼š</p><p>2ã€åœ¨ <code>application.yml</code> é…ç½® <code>eureka</code></p><p>3ã€åœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ æ³¨è§£ <code>@EnableDiscoveryClient</code></p><h1 id="äºŒã€Feign-è¿œç¨‹è°ƒç”¨"><a href="#äºŒã€Feign-è¿œç¨‹è°ƒç”¨" class="headerlink" title="äºŒã€Feign è¿œç¨‹è°ƒç”¨"></a>äºŒã€Feign è¿œç¨‹è°ƒç”¨</h1><p>åœ¨å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼ŒæœåŠ¡å±‚è¢«æ‹†åˆ†æˆäº†å¾ˆå¤šçš„å¾®æœåŠ¡ï¼ŒæœåŠ¡ä¸æœåŠ¡ä¹‹é—´éš¾å…å‘ç”Ÿäº¤äº’ï¼Œæ¯”å¦‚ï¼š</p><p>è¯¾ç¨‹å‘å¸ƒéœ€è¦è°ƒç”¨ <code>CMS</code> æœåŠ¡ç”Ÿæˆè¯¾ç¨‹é™æ€åŒ–é¡µé¢ï¼Œæœ¬èŠ‚ç ”ç©¶å¾®æœåŠ¡è¿œç¨‹è°ƒç”¨æ‰€ä½¿ç”¨çš„æŠ€æœ¯ã€‚</p><p>ä¸‹å›¾æ˜¯è¯¾ç¨‹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨ <code>CMS</code> æœåŠ¡çš„æµç¨‹å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_9/image8" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image8.png" srcset="/img/loading.gif" alt="img"></a></p><p>å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><p>1 ã€<code>cms</code> æœåŠ¡å°†è‡ªå·±æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒã€‚</p><p>2ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡ä»æ³¨å†Œä¸­å¿ƒè·å– <code>cms</code> æœåŠ¡çš„åœ°å€ã€‚</p><p>3ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨ <code>cms</code> æœåŠ¡ã€‚</p><p>Feignçš„å®ç°æ˜¯åŸºäº <code>Ribbon</code> çš„ï¼Œæ‰€ä»¥åœ¨ä»‹ç» Feign çš„ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ Ribbonï¼Œ ä»¥ä¾¿èƒ½æ›´æ·±åˆ»çš„ç†è§£ <code>Feign</code>ã€‚</p><h2 id="1-Ribbon-ç®€ä»‹"><a href="#1-Ribbon-ç®€ä»‹" class="headerlink" title="1. Ribbon ç®€ä»‹"></a>1. Ribbon ç®€ä»‹</h2><p><code>Ribbon</code> æ˜¯ <code>Netflix</code> å…¬å¸å¼€æºçš„ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„é¡¹ç›®ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº HTTPã€TCPçš„ <strong>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡å™¨</strong>ã€‚</p><p><code>Ribbon</code> çš„å¼€æºåœ°å€ï¼š<a href="https://github.com/Netflix/ribbon" target="_blank" rel="noopener">https://github.com/Netflix/ribbon</a></p><p><strong>1ã€ä»€ä¹ˆæ˜¯è´Ÿè½½å‡è¡¡ï¼Ÿ</strong></p><p>è´Ÿè½½å‡è¡¡æ˜¯ å¾®æœåŠ¡æ¶æ„ ä¸­å¿…é¡»ä½¿ç”¨çš„æŠ€æœ¯ï¼Œé€šè¿‡ è´Ÿè½½å‡è¡¡ æ¥å®ç°ç³»ç»Ÿçš„ é«˜å¯ç”¨ã€é›†ç¾¤æ‰©å®¹ ç­‰åŠŸèƒ½ã€‚è´Ÿè½½å‡è¡¡ å¯é€šè¿‡ ç¡¬ä»¶è®¾å¤‡ åŠ è½¯ä»¶ æ¥å®ç°ï¼Œç¡¬ä»¶æ¯”å¦‚ï¼š<code>F5</code>ã€<code>Array</code> ç­‰ï¼Œè½¯ä»¶æ¯”å¦‚ï¼šLVSã€<code>Nginx</code> ç­‰ã€‚</p><p>å¦‚ä¸‹å›¾æ˜¯è´Ÿè½½å‡è¡¡çš„æ¶æ„å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_9/image9" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image9.png" srcset="/img/loading.gif" alt="img"></a></p><p>ç”¨æˆ·è¯·æ±‚å…ˆåˆ°è¾¾è´Ÿè½½å‡è¡¡å™¨ï¼ˆä¹Ÿç›¸å½“äºä¸€ä¸ªæœåŠ¡ï¼‰ï¼Œè´Ÿè½½å‡è¡¡å™¨æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å°†è¯·æ±‚è½¬å‘åˆ°å¾®æœåŠ¡ã€‚è´Ÿè½½å‡è¡¡ç®—æ³•æœ‰ï¼š<code>è½®è®­</code>ã€<code>éšæœº</code>ã€<code>åŠ æƒè½®è®­</code>ã€<code>åŠ æƒéšæœº</code>ã€<code>åœ°å€å“ˆå¸Œ</code> ç­‰æ–¹æ³•ï¼Œè´Ÿè½½å‡è¡¡å™¨ç»´æŠ¤ä¸€ä»½æœåŠ¡åˆ—è¡¨ï¼Œæ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•å°†è¯·æ±‚è½¬å‘åˆ°ç›¸åº”çš„å¾®æœåŠ¡ä¸Šã€‚æ‰€ä»¥è´Ÿè½½å‡è¡¡å¯ä»¥ä¸ºå¾®æœåŠ¡é›†ç¾¤åˆ†æ‹…è¯·æ±‚ï¼Œé™ä½ç³»ç»Ÿçš„å‹åŠ›ã€‚</p><p><strong>2ã€ä»€ä¹ˆæ˜¯å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Ÿ</strong></p><p>ä¸Šå›¾æ˜¯ <code>æœåŠ¡ç«¯ è´Ÿè½½å‡è¡¡</code>ï¼Œ<code>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</code> ä¸ <code>æœåŠ¡ç«¯è´Ÿè½½å‡è¡¡</code> çš„åŒºåˆ«åœ¨äº <strong>å®¢æˆ·ç«¯</strong> è¦ç»´æŠ¤ä¸€ä»½æœåŠ¡åˆ—è¡¨ï¼Œ<code>Ribbon</code> ä» <code>Eureka Server</code> è·å–æœåŠ¡åˆ—è¡¨ï¼Œ<code>Ribbon</code> æ ¹æ®è´Ÿè½½å‡è¡¡ç®—æ³•ç›´æ¥è¯·æ±‚åˆ°å…·ä½“çš„å¾®æœåŠ¡ï¼Œä¸­é—´çœå»äº†è´Ÿè½½å‡è¡¡æœåŠ¡ã€‚å¦‚ä¸‹å›¾æ˜¯ <code>Ribbon</code> è´Ÿè½½å‡è¡¡çš„æµç¨‹å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_9/image10" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image10.png" srcset="/img/loading.gif" alt="img"></a></p><p>1ã€åœ¨æ¶ˆè´¹å¾®æœåŠ¡ä¸­ä½¿ç”¨ <code>Ribbon</code> å®ç°è´Ÿè½½å‡è¡¡ï¼Œ<code>Ribbon</code> å…ˆä» <code>EurekaServer</code> ä¸­è·å–æœåŠ¡åˆ—è¡¨ã€‚</p><p>2ã€<code>Ribbon</code> æ ¹æ®è´Ÿè½½å‡è¡¡çš„ç®—æ³•å»è°ƒç”¨å¾®æœåŠ¡ã€‚</p><h2 id="2-Ribbon-çš„åŸºæœ¬ä½¿ç”¨"><a href="#2-Ribbon-çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="2. Ribbon çš„åŸºæœ¬ä½¿ç”¨"></a>2. Ribbon çš„åŸºæœ¬ä½¿ç”¨</h2><p>Spring Cloud å¼•å…¥<code>Ribbon</code> é…åˆ <code>restTemplate</code> å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ã€‚Javaä¸­è¿œç¨‹è°ƒç”¨çš„æŠ€æœ¯æœ‰å¾ˆå¤šï¼Œå¦‚ï¼šwebserviceã€socketã€rmiã€Apache HttpClientã€OkHttp ç­‰ï¼Œäº’è”ç½‘é¡¹ç›®ä½¿ç”¨åŸºäº <code>http</code> çš„å®¢æˆ·ç«¯è¾ƒå¤šï¼Œæœ¬é¡¹ç›®ä½¿ç”¨ <code>OkHttp</code>ã€‚</p><p><strong>1ã€åœ¨å®¢æˆ·ç«¯æ·»åŠ Ribbonä¾èµ–ï¼š</strong></p><p>è¿™é‡Œåœ¨ è¯¾ç¨‹ç®¡ç†æœåŠ¡ é…ç½® <code>ribbon</code> ä¾èµ–</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--å¯¼å…¥ribbonä¾èµ–--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-ribbon<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>ç”±äºä¾èµ–äº† <code>spring-cloud-starter-eureka</code>ï¼Œä¼šè‡ªåŠ¨æ·»åŠ  <code>spring-cloud-starter-ribbon</code> ä¾èµ–</p><p><a href="https://qnoss.codeyee.com/20200704_9/image11" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image11.png" srcset="/img/loading.gif" alt="img"></a></p><p><strong>2ã€é…ç½® Ribbbon å‚æ•°</strong></p><p>è¿™é‡Œåœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡çš„ <code>application.yml</code> ä¸­é…ç½® <code>ribbon</code> å‚æ•°</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">ribbon:</span>  <span class="hljs-attr">MaxAutoRetries:</span> <span class="hljs-number">2</span> <span class="hljs-comment">#æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œå½“Eurekaä¸­å¯ä»¥æ‰¾åˆ°æœåŠ¡ï¼Œä½†æ˜¯æœåŠ¡è¿ä¸ä¸Šæ—¶å°†ä¼šé‡è¯•</span>  <span class="hljs-attr">MaxAutoRetriesNextServer:</span> <span class="hljs-number">3</span> <span class="hljs-comment">#åˆ‡æ¢å®ä¾‹çš„é‡è¯•æ¬¡æ•°</span>  <span class="hljs-attr">OkToRetryOnAllOperations:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment">#å¯¹æ‰€æœ‰æ“ä½œè¯·æ±‚éƒ½è¿›è¡Œé‡è¯•ï¼Œå¦‚æœæ˜¯getåˆ™å¯ä»¥ï¼Œå¦‚æœæ˜¯postï¼Œputç­‰æ“ä½œæ²¡æœ‰å®ç°å¹‚ç­‰çš„æƒ…å†µä¸‹æ˜¯å¾ˆå±é™©çš„,æ‰€ä»¥è®¾ç½®ä¸ºfalse</span>  <span class="hljs-attr">ConnectTimeout:</span> <span class="hljs-number">5000</span>  <span class="hljs-comment">#è¯·æ±‚è¿æ¥çš„è¶…æ—¶æ—¶é—´</span>  <span class="hljs-attr">ReadTimeout:</span> <span class="hljs-number">6000</span> <span class="hljs-comment">#è¯·æ±‚å¤„ç†çš„è¶…æ—¶æ—¶é—´</span></code></pre></div><p><strong>3ã€è´Ÿè½½å‡è¡¡æµ‹è¯•</strong></p><p>1ï¼‰å¯åŠ¨ä¸¤ä¸ª <code>cms</code> æœåŠ¡ï¼Œæ³¨æ„ç«¯å£è¦ä¸ä¸€è‡´</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-string">$&#123;PORT:31001&#125;</span></code></pre></div><p><a href="https://qnoss.codeyee.com/20200704_9/image12" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image12.png" srcset="/img/loading.gif" alt="img"></a></p><p>å¯åŠ¨å®Œæˆè§‚å¯Ÿ <code>Eureka Server</code> çš„æœåŠ¡åˆ—è¡¨</p><p><a href="https://qnoss.codeyee.com/20200704_9/image13" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image13.png" srcset="/img/loading.gif" alt="img"></a></p><p>2ï¼‰å®šä¹‰ <code>RestTemplate</code>ï¼Œä½¿ç”¨ <code>@LoadBalanced</code> æ³¨è§£</p><p>åœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡çš„å¯åŠ¨ç±»ä¸­å®šä¹‰ <code>RestTemplate</code></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@EnableDiscoveryClient</span><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EntityScan</span>(<span class="hljs-string">"com.xuecheng.framework.domain.course"</span>)<span class="hljs-comment">//æ‰«æå®ä½“ç±»</span><span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.api"</span>&#125;)<span class="hljs-comment">//æ‰«ææ¥å£</span><span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.manage_course"</span>&#125;)<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)<span class="hljs-comment">//æ‰«æcommonä¸‹çš„æ‰€æœ‰ç±»</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCourseApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        SpringApplication.run(ManageCourseApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@LoadBalanced</span> <span class="hljs-comment">//å¼€å¯ribbonè´Ÿè½½å‡è¡¡æ‹¦æˆªå™¨</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate(<span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory());    &#125;&#125;</code></pre></div><p>3 ï¼‰æµ‹è¯•ä»£ç </p><p>åœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹åˆ›å»ºå•å…ƒæµ‹è¯•ä»£ç ï¼Œè¿œç¨‹è°ƒç”¨cmsçš„æŸ¥è¯¢é¡µé¢æ¥å£ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestRibbon</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    RestTemplate restTemplate;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testRibbon</span><span class="hljs-params">()</span></span>&#123;        String serviceId = <span class="hljs-string">"xc-service-manage-cms"</span>;        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) &#123;            ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(<span class="hljs-string">"http://"</span> + serviceId + <span class="hljs-string">"/cms/page/get/5a795ac7dd573c04508f3a56"</span>, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;            Map body = forEntity.getBody();            System.out.println(body);        &#125;    &#125;&#125;</code></pre></div><p>4ï¼‰è´Ÿè½½å‡è¡¡æµ‹è¯•</p><p>æ·»åŠ  <code>@LoadBalanced</code> æ³¨è§£åï¼Œ<code>restTemplate</code> ä¼šèµ° <code>LoadBalancerInterceptor</code> æ‹¦æˆªå™¨ï¼Œæ­¤æ‹¦æˆªå™¨ä¸­ä¼šé€šè¿‡ <code>RibbonLoadBalancerClient</code> æŸ¥è¯¢æœåŠ¡åœ°å€ï¼Œå¯ä»¥åœ¨æ­¤ç±»æ‰“æ–­ç‚¹è§‚å¯Ÿæ¯æ¬¡è°ƒç”¨çš„æœåŠ¡åœ°å€å’Œç«¯å£ï¼Œä¸¤ä¸ª <code>cms</code> æœåŠ¡ä¼šè½®æµè¢«è°ƒç”¨ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_9/image14" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image14.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-Feign"><a href="#3-Feign" class="headerlink" title="3. Feign"></a>3. Feign</h2><h3 id="1ã€Fegin-ä»‹ç»"><a href="#1ã€Fegin-ä»‹ç»" class="headerlink" title="1ã€Fegin ä»‹ç»"></a>1ã€Fegin ä»‹ç»</h3><p><code>Feign</code>æ˜¯ <code>Netflix</code> å…¬å¸å¼€æºçš„è½»é‡çº§ <code>rest</code> <strong>å®¢æˆ·ç«¯</strong>ï¼Œä½¿ç”¨ <code>Feign</code> å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°<code>Http</code> å®¢æˆ·ç«¯ã€‚Spring Cloud å¼•å…¥ <code>Feign</code> å¹¶ä¸”é›†æˆäº† <code>Ribbon</code> å®ç°å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡è°ƒç”¨ã€‚</p><h3 id="2ã€Feign-æµ‹è¯•"><a href="#2ã€Feign-æµ‹è¯•" class="headerlink" title="2ã€Feign æµ‹è¯•"></a>2ã€Feign æµ‹è¯•</h3><p><strong>1 ã€åœ¨å®¢æˆ·ç«¯æ·»åŠ ä¾èµ–</strong></p><p>åœ¨ è¯¾ç¨‹ç®¡ç†æœåŠ¡ æ·»åŠ ä¸‹è¾¹çš„ä¾èµ–ï¼š</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--feignç›¸å…³ä¾èµ–--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.netflix.feign<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>feign-okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>2ã€å®šä¹‰ FeignClient æ¥å£</strong></p><p>å‚è€ƒ <code>Swagger</code> æ–‡æ¡£å®šä¹‰<code>FeignClient</code>ï¼Œæ³¨æ„æ¥å£çš„ <code>Url</code>ã€è¯·æ±‚å‚æ•°ç±»å‹ã€è¿”å›å€¼ç±»å‹ä¸<code>Swagger</code> æ¥å£ä¸€è‡´ã€‚åœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡ä¸­åˆ›å»º <code>client</code>åŒ…ï¼Œå®šä¹‰æŸ¥è¯¢ <code>cms</code> é¡µé¢çš„å®¢æˆ·ç«¯çš„æ¥å£</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_course.client;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.response.CmsPageResult;<span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<span class="hljs-meta">@FeignClient</span>(value = <span class="hljs-string">"XC-SERVICE-MANAGE-CMS"</span>)<span class="hljs-comment">//è¿™é‡Œå¯ä»¥å°†æ‰€æœ‰æœåŠ¡åšæˆä¸€ä¸ªæšä¸¾åˆ—è¡¨</span><span class="hljs-comment">//@FeignClient(value = XcServiceList.XC_SERVICE_MANAGE_CMS)</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageClient</span> </span>&#123;    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/cms/page/get/&#123;id&#125;"</span>)    <span class="hljs-comment">//è¿™é‡Œæˆ‘åœ¨CmsPageæ¥å£å®šä¹‰çš„è¿”å›ç±»å‹ä¸º CmsPageResult ç±»å‹,æ‰€ä»¥è¿œç¨‹è°ƒç”¨æ¥å£è¿™é‡Œä¹Ÿè¦æ¥æ”¶ CmsPageResult ç±»å‹</span>    <span class="hljs-function">CmsPageResult <span class="hljs-title">findById</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id)</span>;&#125;</code></pre></div><p><strong>3ã€å¯åŠ¨ç±»æ·»åŠ @EnableFeignClientsæ³¨è§£</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@EnableFeignClients</span>  <span class="hljs-comment">//å¼€å¯Feignè¿œç¨‹è°ƒç”¨åŠŸèƒ½</span><span class="hljs-meta">@EnableDiscoveryClient</span><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EntityScan</span>(<span class="hljs-string">"com.xuecheng.framework.domain.course"</span>)<span class="hljs-comment">//æ‰«æå®ä½“ç±»</span><span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.api"</span>&#125;)<span class="hljs-comment">//æ‰«ææ¥å£</span><span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.manage_course"</span>&#125;)<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)<span class="hljs-comment">//æ‰«æcommonä¸‹çš„æ‰€æœ‰ç±»</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCourseApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        SpringApplication.run(ManageCourseApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-meta">@LoadBalanced</span> <span class="hljs-comment">//å¼€å¯ribbonè´Ÿè½½å‡è¡¡æ‹¦æˆªå™¨</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate(<span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory());    &#125;&#125;</code></pre></div><p>4ã€<strong>æµ‹è¯•</strong></p><p>åˆ›å»ºä¸€ä¸ªå•å…ƒæµ‹è¯•</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestFeign</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CmsPageClient cmsPageClient;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFeign</span><span class="hljs-params">()</span></span>&#123;        CmsPageResult byId = cmsPageClient.findById(<span class="hljs-string">"5a795ac7dd573c04508f3a56"</span>);        System.out.println(byId.getCmsPage());    &#125;&#125;</code></pre></div><p>è¿è¡Œæµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_9/image15" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image15.png" srcset="/img/loading.gif" alt="img"></a></p><p><strong>Feign å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</strong></p><p>1ã€ å¯åŠ¨ç±»æ·»åŠ  <code>@EnableFeignClients</code> æ³¨è§£ï¼Œ<code>Spring</code>ä¼šæ‰«ææ ‡è®°äº†<code>@FeignClient</code> æ³¨è§£çš„æ¥å£ï¼Œå¹¶ç”Ÿæˆæ­¤æ¥å£çš„ä»£ç†å¯¹è±¡</p><p>2ã€ <code>@FeignClient(value = XcServiceList.XC_SERVICE_MANAGE_CMS)</code> å³æŒ‡å®šäº† <code>cms</code> çš„æœåŠ¡åç§°ï¼Œ<code>Feign</code> ä¼šä»æ³¨å†Œä¸­å¿ƒè·å– <code>cms</code> æœåŠ¡åˆ—è¡¨ï¼Œå¹¶é€šè¿‡è´Ÿè½½å‡è¡¡ç®—æ³•è¿›è¡ŒæœåŠ¡è°ƒç”¨ã€‚</p><p>3ã€åœ¨æ¥å£æ–¹æ³• ä¸­ä½¿ç”¨æ³¨è§£ <code>@GetMapping(&quot;/cms/page/get/{id}&quot;)</code>ï¼ŒæŒ‡å®šè°ƒç”¨çš„<code>url</code>ï¼Œ<code>Feign</code> å°†æ ¹æ® <code>url</code> è¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚</p><h3 id="3ã€ä½¿ç”¨-Feign-æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ"><a href="#3ã€ä½¿ç”¨-Feign-æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ" class="headerlink" title="3ã€ä½¿ç”¨ Feign æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ"></a>3ã€ä½¿ç”¨ Feign æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ</h3><p>SpringCloud å¯¹ <code>Feign</code> è¿›è¡Œäº†å¢å¼ºå…¼å®¹äº† <code>SpringMVC</code> çš„æ³¨è§£ ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ <code>SpringMVC</code> çš„æ³¨è§£æ—¶éœ€è¦æ³¨æ„ï¼š</p><p>1ã€FeignClient æ¥å£ æœ‰å‚æ•°åœ¨å‚æ•°å¿…é¡»åŠ  <code>@PathVariable(&quot;XXX&quot;)</code> å’Œ <code>@RequestParam(&quot;XXX&quot;)</code></p><p>2ã€FeignClient è¿”å›å€¼ä¸ºå¤æ‚å¯¹è±¡æ—¶å…¶ç±»å‹å¿…é¡»æœ‰æ— å‚æ„é€ å‡½æ•°ã€‚</p><h1 id="ä¸‰ã€è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯æ–¹æ¡ˆ"><a href="#ä¸‰ã€è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="ä¸‰ã€è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯æ–¹æ¡ˆ"></a>ä¸‰ã€è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯æ–¹æ¡ˆ</h1><h2 id="1-éœ€æ±‚åˆ†æ-1"><a href="#1-éœ€æ±‚åˆ†æ-1" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p><strong>è¯¾ç¨‹é¢„è§ˆ</strong> æ˜¯ä¸ºäº†ä¿è¯è¯¾ç¨‹å‘å¸ƒåçš„ <strong>æ­£ç¡®æ€§</strong>ï¼Œé€šè¿‡è¯¾ç¨‹é¢„è§ˆå¯ä»¥ç›´è§‚çš„é€šè¿‡ <strong>è¯¾ç¨‹è¯¦æƒ…é¡µé¢</strong> çœ‹åˆ°è¯¾ç¨‹çš„ä¿¡æ¯æ˜¯å¦æ­£ç¡®ï¼Œé€šè¿‡ è¯¾ç¨‹é¢„è§ˆ çœ‹åˆ°çš„é¡µé¢å†…å®¹ å’Œ è¯¾ç¨‹å‘å¸ƒåçš„é¡µé¢ å†…å®¹æ˜¯ä¸€è‡´çš„ã€‚</p><p>ä¸‹å›¾æ˜¯è¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„é¢„è§ˆå›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_9/image16" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image16.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="2-è¯¾ç¨‹è¯¦ç»†é¡µé¢-æŠ€æœ¯æ–¹æ¡ˆ"><a href="#2-è¯¾ç¨‹è¯¦ç»†é¡µé¢-æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="2. è¯¾ç¨‹è¯¦ç»†é¡µé¢ æŠ€æœ¯æ–¹æ¡ˆ"></a>2. è¯¾ç¨‹è¯¦ç»†é¡µé¢ æŠ€æœ¯æ–¹æ¡ˆ</h2><h3 id="1ã€æŠ€æœ¯éœ€æ±‚"><a href="#1ã€æŠ€æœ¯éœ€æ±‚" class="headerlink" title="1ã€æŠ€æœ¯éœ€æ±‚"></a>1ã€æŠ€æœ¯éœ€æ±‚</h3><p>è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ˜¯å‘ç”¨æˆ·å±•ç¤ºè¯¾ç¨‹ä¿¡æ¯çš„çª—å£ï¼Œè¯¾ç¨‹ç›¸å½“äºç½‘ç«™çš„ <strong>å•†å“</strong>ï¼Œæœ¬é¡µé¢çš„è®¿é—®é‡ä¼šéå¸¸å¤§ã€‚æ­¤é¡µé¢çš„å†…å®¹è®¾è®¡ä¸ä»…è¦å±•ç¤ºå‡ºè¯¾ç¨‹ <strong>æ ¸å¿ƒé‡è¦çš„å†…å®¹</strong> è€Œä¸”ç”¨æˆ·è®¿é—®é¡µé¢çš„ <strong>é€Ÿåº¦è¦æœ‰ä¿è¯</strong>ï¼Œæœ‰ç»Ÿè®¡æ˜¾ç¤ºæ‰“å¼€ä¸€ä¸ªé¡µé¢è¶…è¿‡4ç§’ç”¨æˆ·å°±èµ°æ‰äº†ï¼Œæ‰€ä»¥æœ¬é¡µé¢çš„æ€§èƒ½è¦æ±‚æ˜¯æœ¬é¡µé¢çš„é‡è¦éœ€æ±‚ã€‚</p><p>æœ¬é¡µé¢å¦ä¸€ä¸ªéœ€æ±‚å°±æ˜¯ <code>SEO</code>ï¼Œè¦éå¸¸æœ‰åˆ©äºçˆ¬è™«æŠ“å–é¡µé¢ä¸Šä¿¡æ¯ï¼Œå¹¶ä¸”ç”Ÿæˆé¡µé¢å¿«ç…§ï¼Œåˆ©äºç”¨æˆ·é€šè¿‡æœç´¢å¼•æ“æœç´¢è¯¾ç¨‹ä¿¡æ¯ã€‚</p><h3 id="2ã€è§£å†³æ–¹æ¡ˆ"><a href="#2ã€è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2ã€è§£å†³æ–¹æ¡ˆ"></a>2ã€è§£å†³æ–¹æ¡ˆ</h3><p>é‚£ä¹ˆå¦‚ä½•åœ¨ä¿è¯ <code>SEO</code> çš„å‰æä¸‹æé«˜é¡µé¢çš„è®¿é—®é€Ÿåº¦ï¼Ÿ</p><p><strong>æ–¹æ¡ˆ1ï¼š</strong></p><p>å¯¹äºä¿¡æ¯è·å–ç±»çš„éœ€æ±‚ï¼Œè¦æƒ³æé«˜é¡µé¢é€Ÿåº¦å°±è¦ä½¿ç”¨ <strong>ç¼“å­˜</strong> æ¥å‡å°‘æˆ–é¿å…å¯¹æ•°æ®åº“çš„è®¿é—®ï¼Œä»è€Œæé«˜é¡µé¢çš„è®¿é—®é€Ÿåº¦ã€‚ä¸‹å›¾æ˜¯ä½¿ç”¨ç¼“å­˜ä¸ä¸ä½¿ç”¨ç¼“å­˜çš„åŒºåˆ«</p><p><a href="https://qnoss.codeyee.com/20200704_9/image17" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_9/image17" srcset="/img/loading.gif" alt="img"></a></p><p>æ­¤é¡µé¢ä¸ºåŠ¨æ€é¡µé¢ï¼Œä¼šæ ¹æ®è¯¾ç¨‹çš„ä¸åŒè€Œä¸åŒï¼Œæ–¹æ¡ˆä¸€é‡‡ç”¨ä¼ ç»Ÿçš„ <code>JavaEE Servlet/jsp</code> çš„æ–¹å¼åœ¨ <code>Tomcat</code> å®Œæˆé¡µé¢æ¸²æŸ“ï¼Œç›¸æ¯”ä¸åŠ ç¼“å­˜é€Ÿåº¦ä¼šæœ‰æå‡ã€‚</p><p>ä¼˜ç‚¹ï¼šä½¿ç”¨ <code>redis</code> ä½œä¸ºç¼“å­˜ï¼Œé€Ÿåº¦æœ‰æå‡ã€‚</p><p>ç¼ºç‚¹ï¼šé‡‡ç”¨ <code>Servlet/jsp</code> åŠ¨æ€é¡µé¢æ¸²æŸ“æŠ€æœ¯ï¼ŒæœåŠ¡å™¨ä½¿ç”¨ <code>Tomcat</code>ï¼Œé¢å¯¹é«˜å¹¶å‘é‡çš„è®¿é—®å­˜åœ¨æ€§èƒ½ç“¶é¢ˆã€‚</p><p><strong>æ–¹æ¡ˆ2ï¼š</strong></p><p>å¯¹äºä¸ä¼šé¢‘ç¹æ”¹å˜çš„ä¿¡æ¯å¯ä»¥é‡‡ç”¨ <strong>é¡µé¢é™æ€åŒ–</strong> çš„æŠ€æœ¯ï¼Œæå‰è®©é¡µé¢ç”Ÿæˆ <code>html</code> é™æ€é¡µé¢å­˜å‚¨åœ¨<code>nginx</code> æœåŠ¡å™¨ï¼Œç”¨æˆ·ç›´æ¥è®¿é—® <code>nginx</code> å³å¯ï¼Œå¯¹äºä¸€äº›åŠ¨æ€ä¿¡æ¯å¯ä»¥è®¿é—®æœåŠ¡ç«¯è·å– <code>json</code>æ•°æ®åœ¨é¡µé¢æ¸²æŸ“ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_9/image18" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image18.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä¼˜ç‚¹ï¼šä½¿ç”¨ <code>Nginx</code> ä½œä¸º <code>web</code> æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç›´æ¥è®¿é—® <code>html</code> é¡µé¢ï¼Œæ€§èƒ½å‡ºè‰²ã€‚</p><p>ç¼ºç‚¹ï¼šéœ€è¦ç»´æŠ¤å¤§é‡çš„é™æ€é¡µé¢ï¼Œå¢åŠ äº†ç»´æŠ¤çš„éš¾åº¦ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹© <strong>æ–¹æ¡ˆ2</strong> ä½œä¸ºè¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆï¼Œå°†è¯¾ç¨‹è¯¦æƒ…é¡µé¢ç”Ÿæˆ <code>Html</code> é™æ€åŒ–é¡µé¢ï¼Œå¹¶å‘å¸ƒåˆ° <code>Nginx</code> ä¸Šã€‚</p><h2 id="3-è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯-è§£å†³æ–¹æ¡ˆ"><a href="#3-è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="3. è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯ è§£å†³æ–¹æ¡ˆ"></a>3. è¯¾ç¨‹é¢„è§ˆæŠ€æœ¯ è§£å†³æ–¹æ¡ˆ</h2><p>æ ¹æ®è¦æ±‚ï¼šè¯¾ç¨‹è¯¦æƒ…é¡µé¢é‡‡ç”¨é™æ€åŒ–æŠ€æœ¯ç”Ÿæˆ <code>Html</code> é¡µé¢ï¼Œè¯¾ç¨‹é¢„è§ˆçš„æ•ˆæœè¦ä¸æœ€ç»ˆé™æ€åŒ–çš„<code>Html</code> é¡µé¢å†…å®¹ä¸€è‡´ã€‚æ‰€ä»¥ï¼Œè¯¾ç¨‹é¢„è§ˆåŠŸèƒ½ä¹Ÿé‡‡ç”¨é™æ€åŒ–æŠ€æœ¯ç”Ÿæˆ <code>Html</code> é¡µé¢ï¼Œè¯¾ç¨‹é¢„è§ˆä½¿ç”¨çš„æ¨¡æ¿ä¸è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ¨¡æ¿ä¸€è‡´ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯è¯¾ç¨‹é¢„è§ˆçš„æ•ˆæœä¸æœ€ç»ˆè¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„æ•ˆæœä¸€è‡´ã€‚</p><p><strong>æ“ä½œæµç¨‹ï¼š</strong></p><p>1ã€åˆ¶ä½œè¯¾ç¨‹è¯¦æƒ…é¡µé¢æ¨¡æ¿</p><p>2ã€å¼€å‘è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ•°æ®æ¨¡å‹çš„æŸ¥è¯¢æ¥å£ï¼ˆä¸ºé™æ€åŒ–æä¾›æ•°æ®ï¼‰</p><p>3ã€è°ƒç”¨cmsè¯¾ç¨‹é¢„è§ˆæ¥å£é€šè¿‡æµè§ˆå™¨æµè§ˆé™æ€æ–‡ä»¶</p><p><a href="https://qnoss.codeyee.com/20200704_9/image19" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image19.png" srcset="/img/loading.gif" alt="img"></a></p><h1 id="å››ã€è¯¾ç¨‹è¯¦ç»†é¡µé¢é™æ€åŒ–"><a href="#å››ã€è¯¾ç¨‹è¯¦ç»†é¡µé¢é™æ€åŒ–" class="headerlink" title="å››ã€è¯¾ç¨‹è¯¦ç»†é¡µé¢é™æ€åŒ–"></a>å››ã€è¯¾ç¨‹è¯¦ç»†é¡µé¢é™æ€åŒ–</h1><h2 id="1-é™æ€é¡µé¢æµ‹è¯•"><a href="#1-é™æ€é¡µé¢æµ‹è¯•" class="headerlink" title="1. é™æ€é¡µé¢æµ‹è¯•"></a>1. é™æ€é¡µé¢æµ‹è¯•</h2><h3 id="1ã€é¡µé¢å†…å®¹ç»„æˆ"><a href="#1ã€é¡µé¢å†…å®¹ç»„æˆ" class="headerlink" title="1ã€é¡µé¢å†…å®¹ç»„æˆ"></a>1ã€é¡µé¢å†…å®¹ç»„æˆ</h3><p>æˆ‘ä»¬åœ¨ç¼–å†™ä¸€ä¸ªé¡µé¢æ—¶éœ€è¦çŸ¥é“å“ªäº›ä¿¡æ¯æ˜¯é™æ€ä¿¡æ¯ï¼Œå“ªäº›ä¿¡æ¯ä¸ºåŠ¨æ€ä¿¡æ¯ï¼Œä¸‹å›¾æ˜¯é¡µé¢çš„è®¾è®¡å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_9/image20" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image20.png" srcset="/img/loading.gif" alt="img"></a></p><ul><li>æ‰“å¼€é™æ€é¡µé¢ï¼Œè§‚å¯Ÿæ¯éƒ¨åˆ†çš„å†…å®¹ã€‚</li><li>çº¢è‰²è¡¨ç¤ºåŠ¨æ€ä¿¡æ¯ï¼Œçº¢è‰²ä»¥å¤–è¡¨ç¤ºé™æ€ä¿¡æ¯ã€‚</li><li>çº¢è‰²åŠ¨æ€ä¿¡æ¯ï¼šè¡¨ç¤ºä¸€ä¸ªæŒ‰é’®ï¼Œæ ¹æ®ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€è¯¾ç¨‹çš„è´­ä¹°çŠ¶æ€æ˜¾ç¤ºæŒ‰é’®çš„åç§°åŠæŒ‰é’®çš„äº‹ä»¶ã€‚</li></ul><p>åŒ…æ‹¬ä»¥ä¸‹ä¿¡æ¯å†…å®¹ï¼š</p><p><strong>1ã€è¯¾ç¨‹ä¿¡æ¯</strong><br>è¯¾ç¨‹æ ‡é¢˜ã€ä»·æ ¼ã€è¯¾ç¨‹ç­‰çº§ã€æˆè¯¾æ¨¡å¼ã€è¯¾ç¨‹å›¾ç‰‡ã€è¯¾ç¨‹ä»‹ç»ã€è¯¾ç¨‹ç›®å½•ã€‚</p><p><strong>2ã€è¯¾ç¨‹ç»Ÿè®¡ä¿¡æ¯</strong><br>è¯¾ç¨‹æ—¶é•¿ã€è¯„åˆ†ã€æ”¶è—äººæ•°</p><p><strong>3ã€æ•™è‚²æœºæ„ä¿¡æ¯</strong><br>å…¬å¸åç§°ã€å…¬å¸ç®€ä»‹</p><p><strong>4ã€æ•™è‚²æœºæ„ç»Ÿè®¡ä¿¡æ¯</strong><br>å¥½è¯„æ•°ã€è¯¾ç¨‹æ•°ã€å­¦ç”Ÿäººæ•°</p><p><strong>5ã€æ•™å¸ˆä¿¡æ¯</strong><br>è€å¸ˆåç§°ã€è€å¸ˆä»‹ç»</p><h3 id="2ã€é¡µé¢æ‹†åˆ†"><a href="#2ã€é¡µé¢æ‹†åˆ†" class="headerlink" title="2ã€é¡µé¢æ‹†åˆ†"></a>2ã€é¡µé¢æ‹†åˆ†</h3><ol><li><p>æœ¬é¡µå¤´æ–‡ä»¶å’Œé—¨æˆ·ä½¿ç”¨çš„é¡µå¤´ä¸ºåŒä¸€ä¸ªæ–‡ä»¶ã€‚<br>å‚è€ƒï¼š<code>ä»£ç \é¡µé¢ä¸æ¨¡æ¿\include\header.html</code></p></li><li><p>é¡µé¢å°¾<br>æœ¬é¡µå°¾æ–‡ä»¶å’Œé—¨æˆ·ä½¿ç”¨çš„é¡µå°¾ä¸ºåŒä¸€ä¸ªæ–‡ä»¶ã€‚<br>å‚è€ƒï¼š<code>ä»£ç \é¡µé¢ä¸æ¨¡æ¿\include\footer.html</code></p></li><li><p>è¯¾ç¨‹è¯¦æƒ…ä¸»é¡µé¢<br>æ¯ä¸ªè¯¾ç¨‹å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åè§„åˆ™ä¸ºï¼š<code>è¯¾ç¨‹id.html</code>ï¼ˆè¯¾ç¨‹idåŠ¨æ€å˜åŒ–ï¼‰<br>æ¨¡æ¿é¡µé¢å‚è€ƒï¼š<code>\ä»£ç \é¡µé¢ä¸æ¨¡æ¿\course\detail\course_main_template.html</code></p></li><li><p>æ•™è‚²æœºæ„é¡µé¢<br>æ¯ä¸ªæ•™è‚²æœºæ„å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å‘½åè§„åˆ™ä¸ºï¼š<code>company_info_å…¬å¸id.html</code>ï¼ˆå…¬å¸idåŠ¨æ€å˜åŒ–ï¼‰<br>å‚è€ƒï¼š<code>ä»£ç \é¡µé¢ä¸æ¨¡æ¿\company\company_info_template.html</code></p></li><li><p>è€å¸ˆä¿¡æ¯é¡µé¢<br>æ¯ä¸ªæ•™å¸ˆä¿¡æ¯å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å‘½åè§„åˆ™ä¸ºï¼š<code>teacher_info_æ•™å¸ˆid.html</code>ï¼ˆæ•™å¸ˆidåŠ¨æ€å˜åŒ–ï¼‰</p><p>å‚è€ƒï¼š<code>ä»£ç  \é¡µé¢ä¸æ¨¡æ¿\teacher\teacher_info_template01.html</code></p></li><li><p>è¯¾ç¨‹ç»Ÿè®¡é¡µé¢<br>æ¯ä¸ªè¯¾ç¨‹å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å‘½åè§„åˆ™ä¸ºï¼š<code>course_stat_è¯¾ç¨‹id.json</code>ï¼ˆè¯¾ç¨‹idåŠ¨æ€å˜åŒ–ï¼‰<br>å‚è€ƒï¼š<code>\ä»£ç \é¡µé¢ä¸æ¨¡æ¿\stat\course\course_stat_template.json</code></p></li><li><p>æ•™è‚²æœºæ„ç»Ÿè®¡é¡µé¢<br>æ¯ä¸ªæ•™è‚²æœºæ„å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶çš„å‘½åè§„åˆ™ä¸ºï¼š<code>company_stat_å…¬å¸id.json</code>ï¼ˆå…¬å¸idåŠ¨æ€å˜åŒ–ï¼‰<br>å‚è€ƒï¼š<code>\ä»£ç \é¡µé¢ä¸æ¨¡æ¿\stat\company\company_stat_template.json</code></p></li></ol><h3 id="3ã€é¡µé¢æµ‹è¯•"><a href="#3ã€é¡µé¢æµ‹è¯•" class="headerlink" title="3ã€é¡µé¢æµ‹è¯•"></a>3ã€é¡µé¢æµ‹è¯•</h3><h4 id="1ï¼‰é¡µé¢åŠ è½½æ€è·¯"><a href="#1ï¼‰é¡µé¢åŠ è½½æ€è·¯" class="headerlink" title="1ï¼‰é¡µé¢åŠ è½½æ€è·¯"></a>1ï¼‰é¡µé¢åŠ è½½æ€è·¯</h4><p>æ‰“å¼€è¯¾ç¨‹èµ„æ–™ä¸­çš„ â€œé™æ€é¡µé¢ç›®å½•â€ ä¸­çš„è¯¾ç¨‹è¯¦æƒ…æ¨¡æ¿é¡µé¢ï¼Œç ”ç©¶é¡µé¢åŠ è½½çš„æ€è·¯ã€‚</p><p>æ¨¡æ¿é¡µé¢è·¯å¾„å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html">é™æ€é¡µé¢ç›®å½•\static\course\detail\course_main_template.html</code></pre></div><ul><li><p>ä¸»é¡µé¢</p><p>æˆ‘ä»¬éœ€è¦åœ¨ä¸»é¡µé¢ä¸­é€šè¿‡SSIåŠ è½½ï¼šé¡µå¤´ã€é¡µå°¾ã€æ•™è‚²æœºæ„ã€æ•™å¸ˆä¿¡æ¯</p></li><li><p>å¼‚æ­¥åŠ è½½è¯¾ç¨‹ç»Ÿè®¡ä¸æ•™è‚²æœºæ„ç»Ÿè®¡ä¿¡æ¯</p><p>è¯¾ç¨‹ç»Ÿè®¡ä¿¡æ¯ï¼ˆjsonï¼‰ã€æ•™è‚²æœºæ„ç»Ÿè®¡ä¿¡æ¯ï¼ˆjsonï¼‰</p></li><li><p>é©¬ä¸Šå­¦ä¹ æŒ‰é’®äº‹ä»¶</p><p>ç”¨æˆ·ç‚¹å‡»â€œé©¬ä¸Šå­¦ä¹ â€ä¼šæ ¹æ®è¯¾ç¨‹æ”¶è´¹æƒ…å†µã€è¯¾ç¨‹è´­ä¹°æƒ…å†µæ‰§è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚</p></li></ul><h4 id="2ï¼‰é™æ€èµ„æºè™šæ‹Ÿä¸»æœº"><a href="#2ï¼‰é™æ€èµ„æºè™šæ‹Ÿä¸»æœº" class="headerlink" title="2ï¼‰é™æ€èµ„æºè™šæ‹Ÿä¸»æœº"></a>2ï¼‰é™æ€èµ„æºè™šæ‹Ÿä¸»æœº</h4><p>é™æ€èµ„æºè™šæ‹Ÿä¸»æœºè´Ÿè´£å¤„ç†è¯¾ç¨‹è¯¦æƒ…ã€å…¬å¸ä¿¡æ¯ã€è€å¸ˆä¿¡æ¯ã€ç»Ÿè®¡ä¿¡æ¯ç­‰é¡µé¢çš„è¯·æ±‚ï¼š</p><p>å°†è¯¾ç¨‹èµ„æ–™ä¸­çš„ â€œ<strong>é™æ€é¡µé¢ç›®å½•</strong>â€ ä¸­çš„ç›®å½•æ‹·è´åˆ° <code>F:/develop/xuecheng/static</code> ä¸‹</p><p>åœ¨nginxä¸­é…ç½®é™æ€è™šæ‹Ÿä¸»æœºå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs c">#å­¦æˆç½‘é™æ€èµ„æºserver &#123;<span class="hljs-built_in">listen</span>       <span class="hljs-number">91</span>;    server_name localhost;    #å…¬å¸ä¿¡æ¯    location /<span class="hljs-keyword">static</span>/company/ &#123;      alias  G:/job/code/Project/XueChengOnline/xcEduUI01/xuecheng/<span class="hljs-keyword">static</span>/company/; &#125;#è€å¸ˆä¿¡æ¯    location /<span class="hljs-keyword">static</span>/teacher/ &#123;      alias G:/job/code/Project/XueChengOnline/xcEduUI01/xuecheng/<span class="hljs-keyword">static</span>/teacher/;        &#125;     #ç»Ÿè®¡ä¿¡æ¯    location /<span class="hljs-keyword">static</span>/stat/ &#123;      alias G:/job/code/Project/XueChengOnline/xcEduUI01/xuecheng/<span class="hljs-keyword">static</span>/stat/;        &#125;     location /course/detail/ &#123;      alias G:/job/code/Project/XueChengOnline/xcEduUI01/xuecheng/<span class="hljs-keyword">static</span>/course/detail/;        &#125;     &#125;</code></pre></div><p><strong>é€šè¿‡ <a href="http://www.xuecheng.com" target="_blank" rel="noopener">www.xuecheng.com</a> è™šæ‹Ÿä¸»æœºè½¬å‘åˆ°é™æ€èµ„æº</strong></p><p>ç”±äºè¯¾ç¨‹é¡µé¢éœ€è¦é€šè¿‡SSIåŠ è½½é¡µå¤´å’Œé¡µå°¾æ‰€ä»¥éœ€è¦é€šè¿‡ <code>www.xuecheng.com</code> è™šæ‹Ÿä¸»æœºè½¬å‘åˆ°é™æ€èµ„æº<br>åœ¨ <code>www.xuecheng.com</code> è™šæ‹Ÿä¸»æœºåŠ å…¥å¦‚ä¸‹é…ç½®ï¼š</p><div class="hljs"><pre><code class="hljs c">#é™æ€é¡µé¢èµ„æºlocation /<span class="hljs-keyword">static</span>/company/ &#123;     proxy_pass http:<span class="hljs-comment">//static_server_pool;        </span>&#125;     location /<span class="hljs-keyword">static</span>/teacher/ &#123;          proxy_pass http:<span class="hljs-comment">//static_server_pool;        </span>&#125;     location /<span class="hljs-keyword">static</span>/stat/ &#123;          proxy_pass http:<span class="hljs-comment">//static_server_pool;        </span>&#125;     location /course/detail/ &#123;          proxy_pass http:<span class="hljs-comment">//static_server_pool;        </span>&#125;</code></pre></div><p>é…ç½® <code>upstream</code> å®ç°è¯·æ±‚è½¬å‘åˆ°èµ„æºæœåŠ¡è™šæ‹Ÿä¸»æœºï¼š</p><div class="hljs"><pre><code class="hljs c">#é™æ€èµ„æºæœåŠ¡upstream static_server_pool&#123;server <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">91</span> weight=<span class="hljs-number">10</span>;&#125;</code></pre></div><h4 id="3ï¼‰é—¨æˆ·é™æ€èµ„æºè·¯å¾„"><a href="#3ï¼‰é—¨æˆ·é™æ€èµ„æºè·¯å¾„" class="headerlink" title="3ï¼‰é—¨æˆ·é™æ€èµ„æºè·¯å¾„"></a>3ï¼‰é—¨æˆ·é™æ€èµ„æºè·¯å¾„</h4><p>é—¨æˆ·ä¸­çš„ä¸€äº›å›¾ç‰‡ã€æ ·å¼ç­‰é™æ€èµ„æºç»Ÿä¸€é€šè¿‡ <code>/static</code> è·¯å¾„å¯¹å¤–æä¾›æœåŠ¡ï¼Œåœ¨ <code>www.xuecheng.com</code> è™šæ‹Ÿä¸»æœºä¸­é…ç½®å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs c">#é™æ€èµ„æºï¼ŒåŒ…æ‹¬ç³»ç»Ÿæ‰€éœ€è¦çš„å›¾ç‰‡ï¼Œjsã€cssç­‰é™æ€èµ„æº    location /<span class="hljs-keyword">static</span>/img/ &#123;          alias   G:/job/code/Project/XueChengOnline/xcEduUI01/xc-ui-pc-<span class="hljs-keyword">static</span>-portal/img/;        &#125;location /<span class="hljs-keyword">static</span>/css/ &#123;          alias   G:/job/code/Project/XueChengOnline/xcEduUI01/xc-ui-pc-<span class="hljs-keyword">static</span>-portal/css/;        &#125;     location /<span class="hljs-keyword">static</span>/js/ &#123;          alias   G:/job/code/Project/XueChengOnline/xcEduUI01/xc-ui-pc-<span class="hljs-keyword">static</span>-portal/js/;        &#125;     location /<span class="hljs-keyword">static</span>/plugins/ &#123;          # è·¨åŸŸå‚æ•°    alias   G:/job/code/Project/XueChengOnline/xcEduUI01/xc-ui-pc-<span class="hljs-keyword">static</span>-portal/plugins/;            add_header Access-Control-Allow-Origin http:<span class="hljs-comment">//ucenter.xuecheng.com;          </span>    add_header Access-Control-Allow-Credentials <span class="hljs-literal">true</span>;              add_header Access-Control-Allow-Methods GET;        &#125;</code></pre></div><p>cors è·¨åŸŸå‚æ•°ï¼š</p><ul><li>Access-Control-Allow-Originï¼šå…è®¸è·¨åŸŸè®¿é—®çš„å¤–åŸŸåœ°å€å¦‚æœå…è®¸ä»»ä½•ç«™ç‚¹è·¨åŸŸè®¿é—®åˆ™è®¾ç½®ä¸º*ï¼Œé€šå¸¸è¿™æ˜¯ä¸å»ºè®®çš„ã€‚</li><li>Access-Control-Allow-Credentialsï¼š å…è®¸å®¢æˆ·ç«¯æºå¸¦è¯ä¹¦è®¿é—®</li><li>Access-Control-Allow-Methodsï¼šå…è®¸å®¢æˆ·ç«¯è·¨åŸŸè®¿é—®çš„æ–¹æ³•</li></ul><h4 id="4ï¼‰é¡µé¢æµ‹è¯•"><a href="#4ï¼‰é¡µé¢æµ‹è¯•" class="headerlink" title="4ï¼‰é¡µé¢æµ‹è¯•"></a>4ï¼‰é¡µé¢æµ‹è¯•</h4><p>è¯·æ±‚ï¼š<a href="http://www.xuecheng.com/course/detail/course_main_template.html" target="_blank" rel="noopener">http://www.xuecheng.com/course/detail/course_main_template.html</a> æµ‹è¯•è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ¨¡æ¿æ˜¯å¦å¯ä»¥æ­£å¸¸æµè§ˆã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_9/image21" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image21.png" srcset="/img/loading.gif" alt="img"></a></p><h4 id="5ï¼‰é¡µé¢åŠ¨æ€è„šæœ¬"><a href="#5ï¼‰é¡µé¢åŠ¨æ€è„šæœ¬" class="headerlink" title="5ï¼‰é¡µé¢åŠ¨æ€è„šæœ¬"></a>5ï¼‰é¡µé¢åŠ¨æ€è„šæœ¬</h4><p>ä¸ºäº†æ–¹ä¾¿æ—¥åçš„ç»´æŠ¤ï¼Œæˆ‘ä»¬å°† <code>javascript</code> å®ç°çš„åŠ¨æ€éƒ¨åˆ†å•ç‹¬ç¼–å†™ä¸€ä¸ª <code>html</code> æ–‡ä»¶,åœ¨é—¨æˆ·çš„ <code>include</code>ç›®å½•ä¸‹å®šä¹‰ <code>course_detail_dynamic.html</code> æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶é€šè¿‡ <code>ssi</code> åŒ…å«åœ¨è¯¾ç¨‹è¯¦æƒ…é¡µé¢ä¸­.</p><p>æ–‡ä»¶åœ°å€ï¼š<code>èµ„æ–™ \é™æ€é¡µé¢ç›®å½•\include\course_detail_dynamic.html</code></p><p>æ‰€æœ‰çš„è¯¾ç¨‹å…¬ç”¨ä¸€ä¸ª é¡µé¢åŠ¨æ€è„šæœ¬ã€‚</p><p>åœ¨è¯¾ç¨‹è¯¦æƒ…ä¸»é¡µé¢ä¸‹ç«¯æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œé€šè¿‡ <code>SSI</code> æŠ€æœ¯åŒ…å«è¯¾ç¨‹è¯¦æƒ…é¡µé¢åŠ¨æ€è„šæœ¬æ–‡ä»¶ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="actionscript"><span class="hljs-keyword">var</span> courseId = <span class="hljs-string">"template"</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-comment">&lt;!--#include virtual="/include/course_detail_dynamic.html"--&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><p>æœ¬é¡µé¢ä½¿ç”¨ <code>vue.js</code> åŠ¨æ€è·å–ä¿¡æ¯ï¼Œä½¿ç”¨ vue çš„ <code>created</code> é’©å­å‡½æ•°åœ¨é¡µé¢åˆå§‹åŒ–å‰è·å–åŠ¨æ€çš„æ•°æ®ï¼Œè¯¦ç»†è¯·é˜…è¯»è¯¥æ–‡ä»¶ã€‚</p><h2 id="2-è¯¾ç¨‹æ•°æ®æ¨¡å‹æ¥å£"><a href="#2-è¯¾ç¨‹æ•°æ®æ¨¡å‹æ¥å£" class="headerlink" title="2. è¯¾ç¨‹æ•°æ®æ¨¡å‹æ¥å£"></a>2. è¯¾ç¨‹æ•°æ®æ¨¡å‹æ¥å£</h2><h3 id="1ã€APIæ¥å£å®šä¹‰"><a href="#1ã€APIæ¥å£å®šä¹‰" class="headerlink" title="1ã€APIæ¥å£å®šä¹‰"></a>1ã€APIæ¥å£å®šä¹‰</h3><p>æ•°æ®æ¨¡å‹</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.course.ext;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseBase;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseMarket;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CoursePic;<span class="hljs-keyword">import</span> lombok.Data;<span class="hljs-keyword">import</span> lombok.ToString;<span class="hljs-keyword">import</span> java.io.Serializable;<span class="hljs-comment">//Serializable ?</span><span class="hljs-meta">@Data</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseView</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    CourseBase courseBase; <span class="hljs-comment">//è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span>    CourseMarket courseMarket; <span class="hljs-comment">//è¯¾ç¨‹è¥é”€ä¿¡æ¯</span>    CoursePic coursePic;  <span class="hljs-comment">//è¯¾ç¨‹å›¾ç‰‡</span>    TeachplanNode teachplanNode; <span class="hljs-comment">//è¯¾ç¨‹è¥é”€è®¡åˆ’</span>&#125;</code></pre></div><p>API æ¥å£ï¼Œå† <code>CourseControllerApi</code> ä¸‹å®šä¹‰</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è¯¾ç¨‹è§†å›¾æŸ¥è¯¢"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CourseView <span class="hljs-title">courseView</span><span class="hljs-params">(String courseId)</span></span>;</code></pre></div><h3 id="2ã€Dao"><a href="#2ã€Dao" class="headerlink" title="2ã€Dao"></a>2ã€Dao</h3><p>æ ¹æ®æ•°æ®æ¨¡å‹ï¼Œdao å±‚æˆ‘ä»¬å¯ä»¥æ²¿ç”¨ä¹‹å‰å¼€å‘ä¸­å®šä¹‰çš„</p><ul><li><code>CourseBaseRepository</code></li><li><code>CourseMarketRepository</code></li><li><code>CoursePicRepository</code></li><li><code>TeachplanMapper</code></li></ul><h3 id="3ã€Service"><a href="#3ã€Service" class="headerlink" title="3ã€Service"></a>3ã€Service</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * è·å–è¯¾ç¨‹è§†å›¾æ•°æ®æ¨¡å‹</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> CourseView <span class="hljs-title">getCourseView</span><span class="hljs-params">(String courseId)</span> </span>&#123;    CourseView courseView = <span class="hljs-keyword">new</span> CourseView();    <span class="hljs-comment">//è·å–è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span>    Optional&lt;CourseBase&gt; courseBaseOptional = courseBaseRepository.findById(courseId);    <span class="hljs-keyword">if</span>(courseBaseOptional.isPresent())&#123;        CourseBase courseBase = courseBaseOptional.get();        courseView.setCourseBase(courseBase);    &#125;    <span class="hljs-comment">//è·å–è¯¾ç¨‹è¥é”€ä¿¡æ¯</span>    CourseMarket courseMarketById = courseMarketService.findCourseMarketById(courseId);    courseView.setCourseMarket(courseMarketById);    <span class="hljs-comment">//è·å–è¯¾ç¨‹å›¾ç‰‡</span>    Optional&lt;CoursePic&gt; coursePicOptional = coursePicRepository.findById(courseId);    <span class="hljs-keyword">if</span>(coursePicOptional.isPresent())&#123;        CoursePic coursePic = coursePicOptional.get();        courseView.setCoursePic(coursePic);    &#125;    <span class="hljs-comment">//è·å–è¯¾ç¨‹è®¡åˆ’</span>    TeachplanNode teachplanNode = teachplanMapper.selectList(courseId);    courseView.setTeachplanNode(teachplanNode);    <span class="hljs-keyword">return</span> courseView;&#125;</code></pre></div><h3 id="4ã€Controller"><a href="#4ã€Controller" class="headerlink" title="4ã€Controller"></a>4ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">     * è¯¾ç¨‹é¢„è§ˆæ•°æ®æ¨¡å‹æŸ¥è¯¢</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span><span class="hljs-meta">@Override</span><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/Courseview/&#123;id&#125;"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CourseView <span class="hljs-title">courseView</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String courseId) </span>&#123;    <span class="hljs-keyword">return</span> courseService.getCourseView(courseId);&#125;</code></pre></div><h3 id="5ã€æµ‹è¯•"><a href="#5ã€æµ‹è¯•" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><p>åœ¨ Swagger ä¸­æµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_9/image22" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image22.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-è¯¾ç¨‹ä¿¡æ¯æ¨¡æ¿è®¾è®¡"><a href="#3-è¯¾ç¨‹ä¿¡æ¯æ¨¡æ¿è®¾è®¡" class="headerlink" title="3. è¯¾ç¨‹ä¿¡æ¯æ¨¡æ¿è®¾è®¡"></a>3. è¯¾ç¨‹ä¿¡æ¯æ¨¡æ¿è®¾è®¡</h2><p>åœ¨ç¡®å®šäº†é™æ€åŒ–æ‰€éœ€è¦çš„æ•°æ®æ¨¡å‹ä¹‹åï¼Œå°±å¯ä»¥ç¼–å†™é¡µé¢æ¨¡æ¿äº†ï¼Œè¯¾ç¨‹è¯¦æƒ…é¡µé¢ç”±å¤šä¸ªé™æ€åŒ–é¡µé¢ç»„æˆï¼Œæ‰€ä»¥æˆ‘ä»¬<br>éœ€è¦åˆ›å»ºå¤šä¸ªé¡µé¢æ¨¡æ¿ï¼Œæœ¬ç« èŠ‚åˆ›å»ºè¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„ä¸»æ¨¡æ¿ï¼Œå³è¯¾ç¨‹ä¿¡æ¯æ¨¡æ¿ã€‚</p><h3 id="1ã€æ¨¡æ¿å†…å®¹"><a href="#1ã€æ¨¡æ¿å†…å®¹" class="headerlink" title="1ã€æ¨¡æ¿å†…å®¹"></a>1ã€æ¨¡æ¿å†…å®¹</h3><p>å®Œæ•´çš„æ¨¡æ¿è¯·å‚è€ƒ <code>èµ„æ–™\è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ¨¡æ¿\course.ftl</code> æ–‡ä»¶ï¼Œä¸‹è¾¹åˆ—å‡ºæ¨¡æ¿ä¸­æ ¸å¿ƒçš„å†…å®¹ï¼š</p><ul><li><p>è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"banner-left"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tit"</span>&gt;</span>$&#123;courseBase.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pic"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"new-pic"</span>&gt;</span>ç‰¹æƒ ä»·æ ¼ï¿¥$&#123;courseMarket.price&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span></span><span class="hljs-tag">                                                                                 <span class="hljs-attr">class</span>=<span class="hljs-string">"old-pic"</span>&gt;</span>åŸä»·ï¿¥$&#123;courseMarket.price_old!&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"info"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://ucenter.xuecheng.com/#/learning/$&#123;courseBase.id&#125;/0"</span> </span><span class="hljs-tag">           <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"learnstatus == 1"</span> <span class="hljs-attr">v-cloak</span>&gt;</span>é©¬ä¸Šå­¦ä¹ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>  @<span class="hljs-attr">click</span>=<span class="hljs-string">"addopencourse"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"learnstatus == 2"</span> <span class="hljs-attr">v-cloak</span>&gt;</span>ç«‹å³æŠ¥å<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>  @<span class="hljs-attr">click</span>=<span class="hljs-string">"buy"</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"learnstatus == 3"</span> <span class="hljs-attr">v-cloak</span>&gt;</span>ç«‹å³è´­ä¹°<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>éš¾åº¦ç­‰çº§<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">courseBase.grade</span>==<span class="hljs-string">'200001'</span>&gt;</span>                        ä½çº§                        <span class="hljs-tag">&lt;<span class="hljs-name">#elseif</span> <span class="hljs-attr">courseBase.grade</span>==<span class="hljs-string">'200002'</span>&gt;</span>                    ä¸­çº§                            <span class="hljs-tag">&lt;<span class="hljs-name">#elseif</span> <span class="hljs-attr">courseBase.grade</span>==<span class="hljs-string">'200003'</span>&gt;</span>                                é«˜çº§                                <span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>                            <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>è¯¾ç¨‹æ—¶é•¿<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">stat</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">"course_stat.s601001"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">stat</span>&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>è¯„åˆ†<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">stat</span> <span class="hljs-attr">v-text</span>=<span class="hljs-string">"course_stat.s601002"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">stat</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">em</span>&gt;</span>æˆè¯¾æ¨¡å¼<span class="hljs-tag">&lt;/<span class="hljs-name">em</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">courseBase.studymodel</span>==<span class="hljs-string">'201001'</span>&gt;</span>                        è‡ªç”±å­¦ä¹                                 <span class="hljs-tag">&lt;<span class="hljs-name">#elseif</span> <span class="hljs-attr">courseBase.studymodel</span>==<span class="hljs-string">'201002'</span>&gt;</span>                            ä»»åŠ¡å¼å­¦ä¹                                     <span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>                         <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>                    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"banner-rit"</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">coursePic.pic</span>??&gt;</span>                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://img.xuecheng.com/$&#123;coursePic.pic&#125;"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"270"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"156"</span>&gt;</span>                    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">#else</span>&gt;</span>                            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/img/widget-video.png"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"270"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"156"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>                                <span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>                        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"vid-act"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"i-heart"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>æ”¶è— <span class="hljs-tag">&lt;<span class="hljs-name">stat</span> <span class="hljs-attr">v-</span></span><span class="hljs-tag">                                                                              <span class="hljs-attr">text</span>=<span class="hljs-string">"course_stat.s601003"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">stat</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>åˆ†äº« <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"i-weixin"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"i-qq"</span>&gt;</span>                        <span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>                    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div></li><li><p>è¯¾ç¨‹è®¡åˆ’</p></li></ul><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">teachplanNode.children</span>??&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">teachplanNode.children</span> <span class="hljs-attr">as</span> <span class="hljs-attr">firstNode</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title act"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"i-chevron-top"</span>&gt;</span>                    <span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>$&#123;firstNode.pname&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"about"</span>&gt;</span>$&#123;firstNode.description!&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"drop-down"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"height: $&#123;firstNode.children?</span></span><span class="hljs-tag"><span class="hljs-string">                                              size * 50&#125;px;"</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"list-box"</span>&gt;</span>                        <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">firstNode.children</span> <span class="hljs-attr">as</span> <span class="hljs-attr">secondNode</span>&gt;</span>                            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>$&#123;secondNode.pname&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>                            <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>                    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><ul><li>é¡µå¤´å¼•å…¥</li></ul><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">data-spy</span>=<span class="hljs-string">"scroll"</span> <span class="hljs-attr">data-target</span>=<span class="hljs-string">"#articleNavbar"</span> <span class="hljs-attr">data-offset</span>=<span class="hljs-string">"150"</span>&gt;</span> <span class="hljs-comment">&lt;!-- é¡µé¢å¤´éƒ¨ --&gt;</span><span class="hljs-comment">&lt;!--#include virtual="/include/header.html"--&gt;</span></code></pre></div><ul><li>é¡µå°¾å¼•å…¥</li></ul><div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--  é¡µé¢åº•éƒ¨ --&gt;</span><span class="hljs-comment">&lt;!--åº•éƒ¨ç‰ˆæƒ--&gt;</span><span class="hljs-comment">&lt;!--#include virtual="/include/footer.html"--&gt;</span></code></pre></div><ul><li>åŠ¨æ€è„šæœ¬æ–‡ä»¶å¼•å…¥</li></ul><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span> <span class="actionscript">    <span class="hljs-comment">//è¯¾ç¨‹id</span></span><span class="actionscript">    <span class="hljs-keyword">var</span> courseId = <span class="hljs-string">"template"</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-comment">&lt;!--#include virtual="/include/course_detail_dynamic.html"--&gt;</span></code></pre></div><ul><li><p>æ•™å¸ˆä¿¡æ¯</p><p>ä»è¯¾ç¨‹æ•°æ®ä¸­è·å–è¯¾ç¨‹æ‰€å±çš„æ•™å¸ˆIdï¼Œè¿™é‡Œç”±äºæ•™å¸ˆä¿¡æ¯ç®¡ç†åŠŸèƒ½æ²¡æœ‰å¼€å‘æˆ‘ä»¬ä½¿ç”¨å›ºå®šçš„æ•™å¸ˆä¿¡æ¯æ–‡ä»¶</p></li></ul><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content-com course"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>è¯¾ç¨‹åˆ¶ä½œ<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-comment">&lt;!--#include virtual="/teacher/teacher_info_template01.html"--&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div><ul><li><p>æ•™è‚²æœºæ„æ–‡ä»¶</p><p>åŒæ•™å¸ˆä¿¡æ¯ä¸€æ ·ï¼Œç”±äºæ•™è‚²æœºæ„åŠŸèƒ½æ¨¡å—æ²¡æœ‰å¼€å‘ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨å›ºå®šçš„æ•™è‚²æœºæ„æ–‡ä»¶</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"about-teach"</span>&gt;</span>     <span class="hljs-comment">&lt;!--æœºæ„ä¿¡æ¯--&gt;</span>    <span class="hljs-comment">&lt;!--#include virtual="/company/company_info_template.html"--&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div></li></ul><h3 id="2ã€æ¨¡æ¿æµ‹è¯•"><a href="#2ã€æ¨¡æ¿æµ‹è¯•" class="headerlink" title="2ã€æ¨¡æ¿æµ‹è¯•"></a>2ã€æ¨¡æ¿æµ‹è¯•</h3><p>ä½¿ç”¨test-freemarkerå·¥ç¨‹æµ‹è¯•æ¨¡æ¿</p><p>ç¼–å†™æ¨¡æ¿è¿‡ç¨‹é‡‡ç”¨test-freemarkerå·¥ç¨‹æµ‹è¯•æ¨¡æ¿ã€‚</p><p>å°† <code>course.ftl</code> æ‹·è´åˆ° <code>test-freemarker</code> å·¥ç¨‹çš„ <code>resources/templates</code> ä¸‹ï¼Œå¹¶åœ¨ <code>test-freemarker</code> å·¥ç¨‹çš„<code>controller</code> ä¸­åŠ æµ‹è¯•æ–¹æ³•ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//è¯¾ç¨‹è¯¦æƒ…é¡µé¢æµ‹è¯•</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/course"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">course</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span></span>&#123;    ResponseEntity&lt;Map&gt; forEntity =restTemplate.getForEntity(<span class="hljs-string">"http://localhost:31200/course/courseview/4028e581617f945f01617f9dabc40000"</span>, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;    Map body = forEntity.getBody();    map.put(<span class="hljs-string">"model"</span>,body);    <span class="hljs-keyword">return</span> <span class="hljs-string">"course"</span>;&#125;</code></pre></div><p>æ³¨æ„ï¼šä¸Šè¾¹çš„æµ‹è¯•é¡µé¢ä¸æ˜¾ç¤ºæ ·å¼ï¼ŒåŸå› æ˜¯é¡µé¢é€šè¿‡ <code>SSI</code> åŒ…å«äº†é¡µé¢å¤´ï¼Œè€Œä½¿ç”¨ <code>test-freemarker</code> å·¥ç¨‹æ— æ³•åŠ è½½é¡µå¤´ï¼Œæµ‹è¯•æ¨¡æ¿ä¸»è¦æŸ¥çœ‹ <code>html</code> é¡µé¢å†…å®¹æ˜¯å¦æ­£ç¡®ï¼Œå¾…è¯¾ç¨‹é¢„è§ˆæ—¶è§£å†³æ ·å¼ä¸æ˜¾ç¤ºé—®é¢˜ã€‚</p><h3 id="3ã€æ¨¡æ¿ä¿å­˜"><a href="#3ã€æ¨¡æ¿ä¿å­˜" class="headerlink" title="3ã€æ¨¡æ¿ä¿å­˜"></a>3ã€æ¨¡æ¿ä¿å­˜</h3><p>æ¨¡æ¿ç¼–å†™å¹¶æµ‹è¯•é€šè¿‡åè¦åœ¨æ•°æ®åº“ä¿å­˜ï¼š</p><p>1ã€æ¨¡æ¿ä¿¡æ¯ä¿å­˜åœ¨ <code>xc_cms</code> æ•°æ®åº“(mongodb)çš„ <code>cms_template</code>è¡¨<br>2ã€æ¨¡æ¿æ–‡ä»¶ä¿å­˜åœ¨ <code>mongodb</code> çš„ <code>GridFS</code> ä¸­ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åœ¨ <code>cms</code> æœåŠ¡çš„å•å…ƒæµ‹è¯•ä¸­è¿›è¡Œä¿å­˜ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//å­˜æ–‡ä»¶</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGridFs</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> FileNotFoundException </span>&#123;    <span class="hljs-comment">//è¦å‚¨å­˜çš„æ–‡ä»¶</span>    File file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"d:/resources/course.ftl"</span>);    <span class="hljs-comment">//å®šä¹‰è¾“å…¥æµ</span>    FileInputStream fileInputStream = <span class="hljs-keyword">new</span> FileInputStream(file);    <span class="hljs-comment">//å‘GridFSå­˜å‚¨æ–‡ä»¶</span>    ObjectId objectId = gridFsTemplate.store(fileInputStream, <span class="hljs-string">"index-banner"</span>);    <span class="hljs-comment">//å¾—åˆ°æ–‡ä»¶ID</span>    String fileId = objectId.toString();    System.out.println(fileId);&#125;</code></pre></div><p>ä¿å­˜æˆåŠŸéœ€è¦è®°å½•æ¨¡æ¿æ–‡ä»¶çš„idï¼Œå³ä¸Šè¾¹ä»£ç ä¸­çš„fileIdã€‚</p><p>ç¬¬äºŒæ­¥ï¼šå‘ <code>cms_template</code> è¡¨æ·»åŠ æ¨¡æ¿è®°å½•ï¼ˆè¯·ä¸è¦é‡å¤æ·»åŠ ï¼‰</p><p>ä½¿ç”¨ <code>Studio 3T</code> è¿æ¥<code>mongodb</code>ï¼Œå‘ <code>cms_template</code> æ·»åŠ è®°å½•ï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;  <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsTemplate"</span>,  <span class="hljs-attr">"siteId"</span> : <span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>,  <span class="hljs-attr">"templateName"</span> : <span class="hljs-string">"è¯¾ç¨‹è¯¦æƒ…é¡µé¢æ­£å¼æ¨¡æ¿"</span>,  <span class="hljs-attr">"templateFileId"</span> : <span class="hljs-string">"5e93d284cc53e43424beea42"</span>&#125;</code></pre></div><h3 id="4ã€å…¶ä»–æ¨¡æ¿"><a href="#4ã€å…¶ä»–æ¨¡æ¿" class="headerlink" title="4ã€å…¶ä»–æ¨¡æ¿"></a>4ã€å…¶ä»–æ¨¡æ¿</h3><p>é™¤äº†è¯¾ç¨‹è¯¦æƒ…ä¸»é¡µé¢éœ€è¦è®¾è®¡æ¨¡æ¿æ‰€æœ‰é™æ€åŒ–çš„é¡µé¢éƒ½è¦è®¾è®¡æ¨¡æ¿ï¼Œå¦‚ä¸‹ï¼š</p><p><code>æ•™è‚²æœºæ„é¡µé¢æ¨¡æ¿</code>ã€<code>æ•™å¸ˆä¿¡æ¯é¡µé¢æ¨¡æ¿</code>ã€<code>è¯¾ç¨‹ç»Ÿè®¡ä¿¡æ¯jsonæ¨¡æ¿</code>ã€<code>æ•™è‚²æœºæ„ç»Ÿè®¡ä¿¡æ¯jsonæ¨¡æ¿</code>ã€‚</p><p>æœ¬é¡¹ç›®æˆ‘ä»¬å®ç°è¯¾ç¨‹è¯¦æƒ…ä¸»é¡µé¢æ¨¡æ¿çš„åˆ¶ä½œå’Œæµ‹è¯•ï¼Œå…¶å®ƒé¡µé¢æ¨¡æ¿çš„å¼€å‘å‚è€ƒè¯¾ç¨‹è¯¦æƒ…é¡µé¢å»å®ç°ã€‚</p><h1 id="äº”ã€è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¼€å‘"><a href="#äº”ã€è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¼€å‘" class="headerlink" title="äº”ã€è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¼€å‘"></a>äº”ã€è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¼€å‘</h1><h2 id="1-éœ€æ±‚åˆ†æ-2"><a href="#1-éœ€æ±‚åˆ†æ-2" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å°†ä½¿ç”¨ <code>cms</code> ç³»ç»Ÿæä¾›çš„é¡µé¢é¢„è§ˆåŠŸèƒ½ï¼Œä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€ç”¨æˆ·è¿›å…¥è¯¾ç¨‹ç®¡ç†é¡µé¢ï¼Œç‚¹å‡»è¯¾ç¨‹é¢„è§ˆï¼Œè¯·æ±‚åˆ°è¯¾ç¨‹ç®¡ç†æœåŠ¡</p><p>2ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨ <code>cms</code> æ·»åŠ é¡µé¢æ¥å£å‘ <code>cms</code> æ·»åŠ è¯¾ç¨‹è¯¦æƒ…é¡µé¢</p><p>3ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡å¾—åˆ° <code>cms</code> è¿”å›è¯¾ç¨‹è¯¦æƒ…é¡µé¢ <code>id</code>ï¼Œå¹¶æ‹¼æ¥ç”Ÿæˆè¯¾ç¨‹é¢„è§ˆ <code>Url</code></p><p>4ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡å°†è¯¾ç¨‹é¢„è§ˆ <code>Url</code> ç»™å‰ç«¯è¿”å›</p><p>5ã€ç”¨æˆ·åœ¨å‰ç«¯é¡µé¢è¯·æ±‚è¯¾ç¨‹é¢„è§ˆ <code>Url</code> ï¼Œæ‰“å¼€æ–°çª—å£æ˜¾ç¤ºè¯¾ç¨‹è¯¦æƒ…å†…å®¹</p><h2 id="2-CMSé¡µé¢é¢„è§ˆæµ‹è¯•"><a href="#2-CMSé¡µé¢é¢„è§ˆæµ‹è¯•" class="headerlink" title="2. CMSé¡µé¢é¢„è§ˆæµ‹è¯•"></a>2. CMSé¡µé¢é¢„è§ˆæµ‹è¯•</h2><p><code>CMS</code> æœåŠ¡å·²ç»æä¾›äº†é¡µé¢é¢„è§ˆåŠŸèƒ½ï¼Œè¯¾ç¨‹é¢„è§ˆåŠŸèƒ½è¦ä½¿ç”¨ <code>CMS</code> é¡µé¢é¢„è§ˆæ¥å£å®ç°ï¼Œä¸‹è¾¹é€šè¿‡ <code>cms</code> é¡µé¢é¢„è§ˆæ¥å£æµ‹è¯•è¯¾ç¨‹é¢„è§ˆçš„æ•ˆæœã€‚</p><p><strong>1ã€å‘ cms_page è¡¨æ’å…¥ä¸€æ¡é¡µé¢è®°å½•æˆ–è€…ä» cms_page æ‰¾ä¸€ä¸ªé¡µé¢è¿›è¡Œæµ‹è¯•ã€‚</strong></p><p>æ³¨æ„ï¼šé¡µé¢é…ç½®ä¸€å®šè¦æ­£ç¡®ï¼Œéœ€è®¾ç½®æ­£ç¡®çš„æ¨¡æ¿ <code>id</code> å’Œ <code>dataUrl</code>ã€‚</p><p>å¦‚ä¸‹ï¼Œæ˜¯ä¸€æ¡é¡µé¢çš„è®°å½•ã€‚</p><div class="hljs"><pre><code class="hljs json">&#123;     <span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5b3469f794db44269cb2bff1"</span>),     <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsPage"</span>,     <span class="hljs-attr">"siteId"</span> : <span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>,     <span class="hljs-attr">"pageName"</span> : <span class="hljs-string">"4028e581617f945f01617f9dabc40000.html"</span>,     <span class="hljs-attr">"pageAliase"</span> : <span class="hljs-string">"bootstripè¯¾ç¨‹è¯¦æƒ…é¡µé¢"</span>,     <span class="hljs-attr">"pageWebPath"</span> : <span class="hljs-string">"/course/detail/"</span>,     <span class="hljs-attr">"pagePhysicalPath"</span> : <span class="hljs-string">"/course/detail/"</span>,     <span class="hljs-attr">"pageType"</span> : <span class="hljs-string">"1"</span>,     <span class="hljs-attr">"pageCreateTime"</span> : ISODate(<span class="hljs-string">"2018-02-03T05:37:53.256+0000"</span>),     <span class="hljs-attr">"templateId"</span> : <span class="hljs-string">"5e93d2e3d79e7d6ed1009b95"</span>,     <span class="hljs-attr">"dataUrl"</span> : <span class="hljs-string">"http://localhost:31200/course/courseview/4028e581617f945f01617f9dabc40000"</span>&#125;</code></pre></div><p><strong>2ã€è¯¾ç¨‹è¯¦ç»†é¡µé¢ ä½¿ç”¨ ssi æ³¨æ„</strong></p><p>ç”±äº <code>Nginx</code> å…ˆè¯·æ±‚ <code>cms</code> çš„è¯¾ç¨‹é¢„è§ˆåŠŸèƒ½å¾—åˆ° <code>html</code> é¡µé¢ï¼Œå†è§£æé¡µé¢ä¸­çš„ <code>ssi</code> æ ‡ç­¾ï¼Œè¿™é‡Œå¿…é¡»ä¿è¯ <code>cms</code> é¡µé¢é¢„è§ˆè¿”å›çš„é¡µé¢çš„ <code>Content-Type</code> ä¸º <code>text/html;charset=utf-8</code></p><p>åœ¨ <code>cms</code> é¡µé¢é¢„è§ˆçš„ <code>controller</code> æ–¹æ³•ä¸­æ·»åŠ ï¼š</p><div class="hljs"><pre><code class="hljs html">response.setHeader("Content-type","text/html;charset=utf-8");</code></pre></div><p><strong>3ã€æµ‹è¯•</strong></p><p>è¯·æ±‚ï¼š<a href="http://www.xuecheng.com/cms/preview/5b3469f794db44269cb2bff1%E4%BC%A0%E5%85%A5%E9%A1%B5%E9%9D%A2" target="_blank" rel="noopener">http://www.xuecheng.com/cms/preview/5b3469f794db44269cb2bff1ä¼ å…¥é¡µé¢</a> Idï¼Œæµ‹è¯•æ•ˆæœå¦‚ä¸‹:</p><h2 id="3-CMSæ·»åŠ é¡µé¢æ¥å£"><a href="#3-CMSæ·»åŠ é¡µé¢æ¥å£" class="headerlink" title="3. CMSæ·»åŠ é¡µé¢æ¥å£"></a>3. CMSæ·»åŠ é¡µé¢æ¥å£</h2><p>åœ¨ä¹‹å‰è¿›è¡Œ <code>cms</code> æœåŠ¡çš„å¼€å‘ä¸­ï¼Œå·²ç»å¼€å‘æœ‰é¡µé¢æ·»åŠ çš„æ¥å£ï¼Œä¸ºä»€ä¹ˆè¿˜è¦é‡æ–°å†™ä¸€ä¸ªï¼Ÿ</p><p>å› ä¸ºæ¯æ¬¡è¿›è¡Œè¯¾ç¨‹é¢„è§ˆéƒ½éœ€è¦è¿›è¡Œé¡µé¢æ·»åŠ çš„æ“ä½œï¼Œå¦‚æœé¡µé¢å·²ç»å­˜åœ¨åˆ™ä¸éœ€è¦é‡å¤æ·»åŠ ï¼Œåªéœ€è¦æ‰§è¡Œæ›´æ–°æ“ä½œå³å¯ã€‚</p><p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åœ¨ cmsæœåŠ¡ä¸­ å®ç°ä¸€ä¸ª <code>save</code> æ¥å£ï¼šå¦‚æœä¸å­˜åœ¨é¡µé¢åˆ™æ·»åŠ ï¼Œå¦åˆ™å°±æ›´æ–°é¡µé¢ä¿¡æ¯ã€‚</p><h3 id="1ã€API-æ¥å£"><a href="#1ã€API-æ¥å£" class="headerlink" title="1ã€API æ¥å£"></a>1ã€API æ¥å£</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ä¿å­˜é¡µé¢æ•°æ®</span><span class="hljs-comment"> */</span><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"ä¿å­˜é¡µé¢æ•°æ®"</span>)<span class="hljs-meta">@ApiImplicitParams</span>(&#123;        <span class="hljs-meta">@ApiImplicitParam</span>(name=<span class="hljs-string">"cmsPage"</span>,value = <span class="hljs-string">"è¯·æäº¤jsonå½¢å¼çš„é¡µé¢æ•°æ®"</span>,required=<span class="hljs-keyword">true</span>,paramType=<span class="hljs-string">"CmsPage"</span>,dataType=<span class="hljs-string">"CmsPage"</span>),&#125;)<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">saveCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span></span>;</code></pre></div><h3 id="2ã€Service"><a href="#2ã€Service" class="headerlink" title="2ã€Service"></a>2ã€Service</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ä¿å­˜é¡µé¢ï¼šå¦‚æœä¸å­˜åœ¨åˆ™æ·»åŠ ï¼Œå­˜åœ¨åˆ™æ›´æ–°ã€‚</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> cmsPage</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">saveCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;    <span class="hljs-comment">//æ•ˆéªŒcmsPageæ˜¯å¦ä¸ºç©º</span>    <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;        <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸ï¼Œéæ³•å‚æ•°</span>        ExceptionCast.cast(CommonCode.INVALID_PARAM);    &#125;    <span class="hljs-comment">//éªŒè¯æ•°æ®å”¯ä¸€æ€§ï¼šsizeIdã€pageNameã€pageWebPath</span>    CmsPage one = cmsPageRepository.findByPageNameAndSiteIdAndPageWebPath(cmsPage.getPageName(), cmsPage.getSiteId(), cmsPage.getPageWebPath());    <span class="hljs-comment">//å¦‚æœé¡µé¢å·²å­˜åœ¨åˆ™è¿›è¡Œæ›´æ–°æ“ä½œ</span>    <span class="hljs-keyword">if</span> (cmsPage1 != <span class="hljs-keyword">null</span>) &#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.updateCmsPage(one.getPageId(),one);    &#125;    <span class="hljs-comment">//ä¸å­˜åœ¨åˆ™ç›´æ¥æ·»åŠ </span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.addCmsPage(cmsPage);&#125;</code></pre></div><h3 id="3ã€Controller"><a href="#3ã€Controller" class="headerlink" title="3ã€Controller"></a>3ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ä¿å­˜é¡µé¢</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> cmsPage</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Override</span><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/save"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">saveCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;    <span class="hljs-keyword">return</span> pageService.saveCmsPage(cmsPage);&#125;</code></pre></div><h2 id="4-è¯¾ç¨‹é¢„è§ˆæœåŠ¡ç«¯"><a href="#4-è¯¾ç¨‹é¢„è§ˆæœåŠ¡ç«¯" class="headerlink" title="4. è¯¾ç¨‹é¢„è§ˆæœåŠ¡ç«¯"></a>4. è¯¾ç¨‹é¢„è§ˆæœåŠ¡ç«¯</h2><h3 id="1ã€API-å®šä¹‰"><a href="#1ã€API-å®šä¹‰" class="headerlink" title="1ã€API å®šä¹‰"></a>1ã€API å®šä¹‰</h3><p>æ­¤ <code>Api</code> æ˜¯è¯¾ç¨‹ç®¡ç†å‰ç«¯è¯·æ±‚æœåŠ¡ç«¯è¿›è¡Œè¯¾ç¨‹é¢„è§ˆçš„Api</p><p>è¯·æ±‚ï¼šè¯¾ç¨‹ <code>Id</code></p><p>å“åº”ï¼šçŠ¶æ€ç ï¼Œè¯¾ç¨‹é¢„è§ˆ <code>Url</code></p><p>1ã€å®šä¹‰å“åº”ç±»å‹</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@NoArgsConstructor</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoursePublishResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;    String previewUrl;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CoursePublishResult</span><span class="hljs-params">(ResultCode resultCode, String previewUrl)</span> </span>&#123;        <span class="hljs-keyword">super</span>(resultCode);        <span class="hljs-keyword">this</span>.previewUrl = previewUrl;    &#125;&#125;</code></pre></div><p>2ã€æ¥å£å®šä¹‰å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è¯¾ç¨‹å‘å¸ƒé¢„è§ˆ"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">CoursePublishPreview</span><span class="hljs-params">(String courseId)</span></span>;</code></pre></div><h3 id="2ã€åˆ›å»º-Feign-Client"><a href="#2ã€åˆ›å»º-Feign-Client" class="headerlink" title="2ã€åˆ›å»º Feign Client"></a>2ã€åˆ›å»º Feign Client</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/cms/page/save"</span>)<span class="hljs-function">CmsPageResult <span class="hljs-title">saveCmsPage</span><span class="hljs-params">(@RequestBody CmsPage cmsPage)</span></span>;</code></pre></div><h3 id="3ã€Service-1"><a href="#3ã€Service-1" class="headerlink" title="3ã€Service"></a>3ã€Service</h3><div class="hljs"><pre><code class="hljs java"> <span class="hljs-comment">//ä»é…ç½®æ–‡ä»¶è·å–è¯¾ç¨‹å‘å¸ƒçš„åŸºæœ¬é…ç½®</span><span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.dataUrlPre&#125;"</span>)<span class="hljs-keyword">private</span> String publish_dataUrlPre;<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.pagePhysicalPath&#125;"</span>)<span class="hljs-keyword">private</span> String publish_page_physicalpath;<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.pageWebPath&#125;"</span>)<span class="hljs-keyword">private</span> String publish_page_webpath;<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.siteId&#125;"</span>)<span class="hljs-keyword">private</span> String publish_siteId;<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.templateId&#125;"</span>)<span class="hljs-keyword">private</span> String publish_templateId;<span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;course-publish.previewUrl&#125;"</span>)<span class="hljs-keyword">private</span> String previewUrl;<span class="hljs-meta">@Autowired</span>CmsPageClient cmsPageClient;<span class="hljs-comment">//æ ¹æ®idæŸ¥è¯¢è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span><span class="hljs-function"><span class="hljs-keyword">public</span> CourseBase <span class="hljs-title">findCourseBaseById</span><span class="hljs-params">(String courseId)</span></span>&#123;    <span class="hljs-comment">//è·å–è¯¾ç¨‹ä¿¡æ¯</span>    Optional&lt;CourseBase&gt; optionalCourseBase = courseBaseRepository.findById(courseId);    <span class="hljs-keyword">if</span>(!optionalCourseBase.isPresent())&#123;        <span class="hljs-comment">//è¯¾ç¨‹ä¸å­˜åœ¨æŠ›å‡ºå¼‚å¸¸</span>        ExceptionCast.cast(CourseCode.COURSE_NOTEXIST);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-keyword">return</span> optionalCourseBase.get();&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> * è¯¾ç¨‹è¯¦ç»†é¡µé¢å‘å¸ƒå‰é¢„è§ˆ</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">coursePublishPreview</span><span class="hljs-params">(String courseId)</span> </span>&#123;    <span class="hljs-comment">//è·å–è¯¾ç¨‹ä¿¡æ¯</span>    CourseBase courseBaseById = <span class="hljs-keyword">this</span>.findCourseBaseById(courseId);    <span class="hljs-comment">//æ‹¼è£…é¡µé¢åŸºæœ¬ä¿¡æ¯</span>    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();    cmsPage.setDataUrl(publish_dataUrlPre + courseId);    cmsPage.setPagePhysicalPath(publish_page_physicalpath);    cmsPage.setPageWebPath(publish_page_webpath);    cmsPage.setSiteId(publish_siteId);    cmsPage.setTemplateId(publish_templateId);    <span class="hljs-comment">//é¡µé¢åˆ«å</span>    cmsPage.setPageAliase(courseBaseById.getName());    <span class="hljs-comment">//è¿œç¨‹è°ƒç”¨ï¼Œä¿å­˜é¡µé¢ä¿¡æ¯</span>    CmsPageResult cmsPageResult = cmsPageClient.saveCmsPage(cmsPage);    <span class="hljs-keyword">if</span>(!cmsPageResult.isSuccess())&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CoursePublishResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);    &#125;    <span class="hljs-comment">//é¡µé¢id</span>    String cmsPageId = cmsPageResult.getCmsPage().getPageId();    <span class="hljs-comment">//è¿”å›é¢„è§ˆurl</span>    String url = previewUrl + cmsPageId;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CoursePublishResult(CommonCode.SUCCESS,url);&#125;</code></pre></div><h3 id="4ã€Controller-1"><a href="#4ã€Controller-1" class="headerlink" title="4ã€Controller"></a>4ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">     * å‘å¸ƒé¡µé¢</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageId</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">*/</span><span class="hljs-meta">@Override</span><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/postPage/&#123;pageId&#125;"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">post</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"pageId"</span>)</span> String pageId) </span>&#123;    <span class="hljs-keyword">return</span> pageService.postPage(pageId);&#125;</code></pre></div><h3 id="5ã€æµ‹è¯•-1"><a href="#5ã€æµ‹è¯•-1" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><p>å…ˆåœ¨ course æœåŠ¡ä¸­çš„ swagger è¿›è¡Œæµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_9/image23" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image23.png" srcset="/img/loading.gif" alt="img"></a></p><p>å¾—åˆ°é¢„è§ˆurlï¼Œè®¿é—®æµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_9/image24" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image24.png" srcset="/img/loading.gif" alt="img"></a></p><p>è¿™é‡Œå®é™…ä¸ŠåªåŠ¨æ€æ¸²æŸ“äº†è¯¾ç¨‹éƒ¨åˆ†çš„æ•°æ®ï¼Œä¾‹å¦‚è¯¾ç¨‹åç§°ï¼Œè¯¾ç¨‹ä»‹ç»ç­‰ï¼Œæ•™å¸ˆä¿¡æ¯å’Œå…¬å¸ä»‹ç»ç­‰éƒ½æ˜¯é™æ€æ•°æ®ï¼Œéœ€è¦åæœŸè¿›è¡Œå®Œå–„ã€‚</p><h2 id="5-å‰ç«¯å¼€å‘"><a href="#5-å‰ç«¯å¼€å‘" class="headerlink" title="5. å‰ç«¯å¼€å‘"></a>5. å‰ç«¯å¼€å‘</h2><p>1ã€API æ–¹æ³•</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/*é¢„è§ˆè¯¾ç¨‹*/</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> preview = <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/course/preview/'</span>+id);&#125;</code></pre></div><p>2ã€é¡µé¢</p><p>åˆ›å»º <code>course_pub.vue</code></p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">elâ€card</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"boxâ€card"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"header"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"clearfix"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>è¯¾ç¨‹é¢„è§ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text item"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>  @<span class="hljs-attr">click.native</span>=<span class="hljs-string">"preview"</span> &gt;</span>è¯¾ç¨‹é¢„è§ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">if</span>=<span class="hljs-string">"previewurl &amp;&amp; previewurl!=''"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">"previewurl"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>ç‚¹æˆ‘æŸ¥çœ‹è¯¾ç¨‹é¢„è§ˆé¡µé¢ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€card</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></code></pre></div><p>æ•°æ®å¯¹è±¡ï¼š</p><div class="hljs"><pre><code class="hljs js">data() &#123;   <span class="hljs-keyword">return</span> &#123;    dotype:<span class="hljs-string">''</span>,    courseid:<span class="hljs-string">''</span>,    course: &#123;<span class="hljs-string">"id"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"name"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"status"</span>:<span class="hljs-string">""</span>&#125;,    previewurl:<span class="hljs-string">''</span>  &#125;</code></pre></div><p>æ–¹æ³• ï¼š</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// é¢„è§ˆ</span>preview()&#123;  courseApi.preview(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;    <span class="hljs-keyword">if</span>(res.success)&#123;      <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'é¢„è§ˆé¡µé¢ç”ŸæˆæˆåŠŸï¼Œè¯·ç‚¹å‡»ä¸‹æ–¹é¢„è§ˆé“¾æ¥'</span>);           <span class="hljs-keyword">if</span>(res.url)&#123;         <span class="hljs-comment">//é¢„è§ˆurl</span>        <span class="hljs-keyword">this</span>.previewurl = res.url      &#125;    &#125;<span class="hljs-keyword">else</span>&#123;      <span class="hljs-keyword">this</span>.$message.error(res.message);    &#125;  &#125;);&#125;</code></pre></div><p>3ã€æµ‹è¯•</p><p>ç‚¹å‡»é¢„è§ˆåæˆåŠŸé“¾æ¥</p><p><a href="https://qnoss.codeyee.com/20200704_9/image25" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image25.png" srcset="/img/loading.gif" alt="img"></a></p><p>è®¿é—®é¢„è§ˆé“¾æ¥</p><p><a href="https://qnoss.codeyee.com/20200704_9/image26" target="_blank" rel="noopener"><img src="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/image26.png" srcset="/img/loading.gif" alt="img"></a></p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Eureka</tag>
      
      <tag>Ribbon</tag>
      
      <tag>Feign</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day08ï¼šFastDFSå®ç°è¯¾ç¨‹å›¾ç‰‡ç®¡ç†</title>
    <link href="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/"/>
    <url>/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day08</code> çš„å†…å®¹</p><ul><li><code>FastDFS</code> çš„ å®‰è£…ä¸åŸºæœ¬ä½¿ç”¨æµç¨‹ã€‚</li><li>åŸºäº <code>Java Api</code> æ¥æ“ä½œ <code>FastDFS</code></li><li>ç»“åˆ <code>FastDFS</code> å®ç°å¯¹è¯¾ç¨‹å›¾ç‰‡çš„ <code>CRUD</code></li><li>å›¾ç‰‡åˆ é™¤çš„åœºæ™¯ä½¿ç”¨ <code>Promise</code> è§£å†³ä¸€äº›é—®é¢˜</li></ul><h1 id="ä¸€ã€FastDFS-æ¢ç©¶"><a href="#ä¸€ã€FastDFS-æ¢ç©¶" class="headerlink" title="ä¸€ã€FastDFS æ¢ç©¶"></a>ä¸€ã€FastDFS æ¢ç©¶</h1><h2 id="1-ä»€ä¹ˆæ˜¯fastDFS"><a href="#1-ä»€ä¹ˆæ˜¯fastDFS" class="headerlink" title="1. ä»€ä¹ˆæ˜¯fastDFS ?"></a>1. ä»€ä¹ˆæ˜¯fastDFS ?</h2><h3 id="1ã€ä»‹ç»"><a href="#1ã€ä»‹ç»" class="headerlink" title="1ã€ä»‹ç»"></a>1ã€ä»‹ç»</h3><p>FastDFSæ˜¯ç”¨cè¯­è¨€ç¼–å†™çš„ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯ç”±æ·˜å®èµ„æ·±æ¶æ„å¸ˆä½™åº†ç¼–å†™å¹¶å¼€æºã€‚FastDFSä¸“ä¸ºäº’è”ç½‘é‡èº«å®šåˆ¶ï¼Œå……åˆ†è€ƒè™‘äº†å†—ä½™å¤‡ä»½ã€è´Ÿè½½å‡è¡¡ã€çº¿æ€§æ‰©å®¹ç­‰æœºåˆ¶ï¼Œå¹¶æ³¨é‡é«˜å¯ç”¨ã€é«˜æ€§èƒ½ç­‰æŒ‡æ ‡ï¼Œä½¿ç”¨FastDFSå¾ˆå®¹æ˜“æ­å»ºä¸€å¥—é«˜æ€§èƒ½çš„æ–‡ä»¶æœåŠ¡å™¨é›†ç¾¤æä¾›æ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰æœåŠ¡ã€‚</p><p>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ <code>fastDFS</code> å‘¢ï¼Ÿ</p><p>ä¸Šè¾¹ä»‹ç»çš„ <code>NFS</code>ã€<code>GFS</code> éƒ½æ˜¯é€šç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼Œé€šç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜ç‚¹çš„æ˜¯å¼€å‘ä½“éªŒå¥½ï¼Œä½†æ˜¯ç³»ç»Ÿå¤æ‚æ€§é«˜ã€æ€§èƒ½ä¸€èˆ¬ï¼Œè€Œä¸“ç”¨çš„åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿè™½ç„¶å¼€å‘ä½“éªŒæ€§å·®ï¼Œä½†æ˜¯ç³»ç»Ÿå¤æ‚æ€§ä½å¹¶ä¸”æ€§èƒ½é«˜ã€‚<code>fastDFS</code> éå¸¸é€‚åˆå­˜å‚¨å›¾ç‰‡ç­‰é‚£äº›å°æ–‡ä»¶ï¼Œ<code>fastDFS</code> ä¸å¯¹æ–‡ä»¶è¿›è¡Œåˆ†å—ï¼Œæ‰€ä»¥å®ƒå°±æ²¡æœ‰åˆ†å—åˆå¹¶çš„å¼€é”€ï¼Œ<code>fastDFS</code> ç½‘ç»œé€šä¿¡é‡‡ç”¨ <code>socket</code>ï¼Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«ã€‚</p><h3 id="2ã€å·¥ä½œåŸç†"><a href="#2ã€å·¥ä½œåŸç†" class="headerlink" title="2ã€å·¥ä½œåŸç†"></a>2ã€å·¥ä½œåŸç†</h3><p><code>FastDFS</code> æ¶æ„åŒ…æ‹¬ <code>Tracker server</code> å’Œ <code>Storageserver</code>ã€‚å®¢æˆ·ç«¯è¯·æ±‚ <code>Tracker server</code> è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ï¼Œé€šè¿‡ <code>Tracker server</code> è°ƒåº¦æœ€ç»ˆç”± <code>Storage server</code> å®Œæˆæ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_8/image1" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image1.png" srcset="/img/loading.gif" alt="img"></a></p><p><strong>1ï¼‰Tracker</strong></p><p>Tracker Serverä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡å’Œè°ƒåº¦ï¼Œé€šè¿‡Tracker serveråœ¨æ–‡ä»¶ä¸Šä¼ æ—¶å¯ä»¥æ ¹æ®ä¸€äº›ç­–ç•¥æ‰¾åˆ°Storage serveræä¾›æ–‡ä»¶ä¸Šä¼ æœåŠ¡ã€‚å¯ä»¥å°† <code>tracker</code> ç§°ä¸ºè¿½è¸ªæœåŠ¡å™¨æˆ–è°ƒåº¦æœåŠ¡å™¨ã€‚</p><p><code>FastDFS</code> é›†ç¾¤ä¸­çš„ <code>Tracker server</code> å¯ä»¥æœ‰å¤šå°ï¼Œ<code>Tracker server</code> ä¹‹é—´æ˜¯ç›¸äº’å¹³ç­‰å…³ç³»åŒæ—¶æä¾›æœåŠ¡ï¼Œ<code>Tracker server</code> ä¸å­˜åœ¨å•ç‚¹æ•…éšœã€‚å®¢æˆ·ç«¯è¯·æ±‚ <code>Tracker server</code> é‡‡ç”¨è½®è¯¢æ–¹å¼ï¼Œå¦‚æœè¯·æ±‚çš„ <code>tracker</code> æ— æ³•æä¾›æœåŠ¡åˆ™æ¢å¦ä¸€ä¸ª <code>tracker</code>ã€‚</p><p><strong>2ï¼‰Storage</strong></p><p><code>Storage Server</code> ä½œç”¨æ˜¯æ–‡ä»¶å­˜å‚¨ï¼Œå®¢æˆ·ç«¯ä¸Šä¼ çš„æ–‡ä»¶æœ€ç»ˆå­˜å‚¨åœ¨ <code>Storage</code> æœåŠ¡å™¨ä¸Šï¼Œ<code>Storage server</code> æ²¡æœ‰å®ç°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿè€Œæ˜¯ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ¥ç®¡ç†æ–‡ä»¶ã€‚å¯ä»¥å°† <code>storage</code> ç§°ä¸ºå­˜å‚¨æœåŠ¡å™¨ã€‚</p><p><code>Storage</code> é›†ç¾¤é‡‡ç”¨äº†åˆ†ç»„å­˜å‚¨æ–¹å¼ã€‚<code>storage</code> é›†ç¾¤ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç»„æ„æˆï¼Œé›†ç¾¤å­˜å‚¨æ€»å®¹é‡ä¸ºé›†ç¾¤ä¸­æ‰€æœ‰ç»„çš„å­˜å‚¨å®¹é‡ä¹‹å’Œã€‚ä¸€ä¸ªç»„ç”±ä¸€å°æˆ–å¤šå°å­˜å‚¨æœåŠ¡å™¨ç»„æˆï¼Œç»„å†…çš„ <code>Storage server</code> ä¹‹é—´æ˜¯å¹³ç­‰å…³ç³»ï¼Œä¸åŒç»„çš„ <code>Storage server</code> ä¹‹é—´ä¸ä¼šç›¸äº’é€šä¿¡ï¼ŒåŒç»„å†…çš„ <code>Storage server</code> ä¹‹é—´ä¼šç›¸äº’è¿æ¥è¿›è¡Œæ–‡ä»¶åŒæ­¥ï¼Œä»è€Œä¿è¯åŒç»„å†…æ¯ä¸ªstorageä¸Šçš„æ–‡ä»¶å®Œå…¨ä¸€è‡´çš„ã€‚ä¸€ä¸ªç»„çš„å­˜å‚¨å®¹é‡ä¸ºè¯¥ç»„å†…çš„å­˜å‚¨æœåŠ¡å™¨å®¹é‡æœ€å°çš„é‚£ä¸ªï¼Œç”±æ­¤å¯è§ç»„å†…å­˜å‚¨æœåŠ¡å™¨çš„è½¯ç¡¬ä»¶é…ç½®æœ€å¥½æ˜¯ä¸€è‡´çš„ã€‚</p><p>é‡‡ç”¨åˆ†ç»„å­˜å‚¨æ–¹å¼çš„å¥½å¤„æ˜¯çµæ´»ã€å¯æ§æ€§è¾ƒå¼ºã€‚æ¯”å¦‚ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œå¯ä»¥ç”±å®¢æˆ·ç«¯ç›´æ¥æŒ‡å®šä¸Šä¼ åˆ°çš„ç»„ä¹Ÿå¯ä»¥ç”± <code>tracker</code> è¿›è¡Œè°ƒåº¦é€‰æ‹©ã€‚ä¸€ä¸ªåˆ†ç»„çš„å­˜å‚¨æœåŠ¡å™¨è®¿é—®å‹åŠ›è¾ƒå¤§æ—¶ï¼Œå¯ä»¥åœ¨è¯¥ç»„å¢åŠ å­˜å‚¨æœåŠ¡å™¨æ¥æ‰©å……æœåŠ¡èƒ½åŠ›ï¼ˆçºµå‘æ‰©å®¹ï¼‰ã€‚å½“ç³»ç»Ÿå®¹é‡ä¸è¶³æ—¶ï¼Œå¯ä»¥å¢åŠ ç»„æ¥æ‰©å……å­˜å‚¨å®¹é‡ï¼ˆæ¨ªå‘æ‰©å®¹ï¼‰ã€‚</p><p><strong>3ï¼‰StorageçŠ¶æ€æ”¶é›†</strong></p><p><code>Storage server</code> ä¼šè¿æ¥é›†ç¾¤ä¸­æ‰€æœ‰çš„ <code>Tracker server</code>ï¼Œå®šæ—¶å‘ä»–ä»¬æŠ¥å‘Šè‡ªå·±çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ç£ç›˜å‰©ä½™ç©ºé—´ã€æ–‡ä»¶åŒæ­¥çŠ¶å†µã€æ–‡ä»¶ä¸Šä¼ ä¸‹è½½æ¬¡æ•°ç­‰ç»Ÿè®¡ä¿¡æ¯ã€‚</p><h3 id="3ã€æ–‡ä»¶ä¸Šä¼ æµç¨‹"><a href="#3ã€æ–‡ä»¶ä¸Šä¼ æµç¨‹" class="headerlink" title="3ã€æ–‡ä»¶ä¸Šä¼ æµç¨‹"></a>3ã€æ–‡ä»¶ä¸Šä¼ æµç¨‹</h3><p><a href="https://qnoss.codeyee.com/20200704_8/image2" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image2.png" srcset="/img/loading.gif" alt="img"></a></p><p>å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶åå­˜å‚¨æœåŠ¡å™¨å°† <code>æ–‡ä»¶ID</code> è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ­¤ <code>æ–‡ä»¶ID</code> ç”¨äºä»¥åè®¿é—®è¯¥æ–‡ä»¶çš„ç´¢å¼•ä¿¡æ¯ã€‚æ–‡ä»¶ç´¢å¼•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šç»„åï¼Œè™šæ‹Ÿç£ç›˜è·¯å¾„ï¼Œæ•°æ®ä¸¤çº§ç›®å½•ï¼Œæ–‡ä»¶åã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_8/image3" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image3.png" srcset="/img/loading.gif" alt="img"></a></p><ul><li>ç»„åï¼šæ–‡ä»¶ä¸Šä¼ åæ‰€åœ¨çš„ storageç»„åç§°ï¼Œåœ¨æ–‡ä»¶ä¸Šä¼ æˆåŠŸåæœ‰ storageæœåŠ¡å™¨è¿”å›ï¼Œéœ€è¦å®¢æˆ·ç«¯è‡ªè¡Œä¿å­˜ã€‚</li><li>è™šæ‹Ÿç£ç›˜è·¯å¾„ï¼š storageé…ç½®çš„è™šæ‹Ÿè·¯å¾„ï¼Œä¸ç£ç›˜é€‰é¡¹ store_path* å¯¹åº”ã€‚å¦‚æœé…ç½®äº†store_path0åˆ™æ˜¯M00ï¼Œå¦‚æœé…ç½®äº†store_path1åˆ™æ˜¯M01ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li><li>æ•°æ®ä¸¤çº§ç›®å½•ï¼š storageæœåŠ¡å™¨åœ¨æ¯ä¸ªè™šæ‹Ÿç£ç›˜è·¯å¾„ä¸‹åˆ›å»ºçš„ä¸¤çº§ç›®å½•ï¼Œç”¨äºå­˜å‚¨æ•°æ®æ–‡ä»¶ã€‚</li><li>æ–‡ä»¶åï¼šä¸æ–‡ä»¶ä¸Šä¼ æ—¶ä¸åŒã€‚æ˜¯ç”±å­˜å‚¨æœåŠ¡å™¨æ ¹æ®ç‰¹å®šä¿¡æ¯ç”Ÿæˆï¼Œæ–‡ä»¶ååŒ…å«ï¼šæºå­˜å‚¨æœåŠ¡å™¨ IPåœ°å€ã€æ–‡ä»¶åˆ›å»ºæ—¶é—´æˆ³ã€æ–‡ä»¶å¤§å°ã€éšæœºæ•°å’Œæ–‡ä»¶æ‹“å±•åç­‰ä¿¡æ¯ã€‚</li></ul><h3 id="4ã€æ–‡ä»¶ä¸‹è½½æµç¨‹"><a href="#4ã€æ–‡ä»¶ä¸‹è½½æµç¨‹" class="headerlink" title="4ã€æ–‡ä»¶ä¸‹è½½æµç¨‹"></a>4ã€æ–‡ä»¶ä¸‹è½½æµç¨‹</h3><p><a href="https://qnoss.codeyee.com/20200704_8/image4" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image4.png" srcset="/img/loading.gif" alt="img"></a></p><p><code>tracker</code> æ ¹æ®è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„å³æ–‡ä»¶ID æ¥å¿«é€Ÿå®šä¹‰æ–‡ä»¶ã€‚</p><p>æ¯”å¦‚è¯·æ±‚ä¸‹è¾¹çš„æ–‡ä»¶ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_8/image5" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image5.png" srcset="/img/loading.gif" alt="img"></a></p><p>1.é€šè¿‡ç»„åtrackerèƒ½å¤Ÿå¾ˆå¿«çš„å®šä½åˆ°å®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„å­˜å‚¨æœåŠ¡å™¨ç»„æ˜¯group1ï¼Œå¹¶é€‰æ‹©åˆé€‚çš„å­˜å‚¨æœåŠ¡å™¨æä¾›å®¢æˆ·ç«¯è®¿é—®ã€‚</p><p>2.å­˜å‚¨æœåŠ¡å™¨æ ¹æ®â€œæ–‡ä»¶å­˜å‚¨è™šæ‹Ÿç£ç›˜è·¯å¾„â€å’Œâ€œæ•°æ®æ–‡ä»¶ä¸¤çº§ç›®å½•â€å¯ä»¥å¾ˆå¿«å®šä½åˆ°æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå¹¶æ ¹æ®æ–‡ä»¶åæ‰¾åˆ°å®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„æ–‡ä»¶ã€‚</p><h2 id="2-FastDFSå…¥é—¨"><a href="#2-FastDFSå…¥é—¨" class="headerlink" title="2. FastDFSå…¥é—¨"></a>2. FastDFSå…¥é—¨</h2><h3 id="1ã€ç¯å¢ƒæ­å»º"><a href="#1ã€ç¯å¢ƒæ­å»º" class="headerlink" title="1ã€ç¯å¢ƒæ­å»º"></a>1ã€ç¯å¢ƒæ­å»º</h3><p>å®‰è£… FastDFS æµç¨‹ å‚è€ƒï¼š <a href="https://www.cnblogs.com/yufeng218/p/8111961.html" target="_blank" rel="noopener">https://www.cnblogs.com/yufeng218/p/8111961.html</a></p><p>æ­å»ºå¥½çš„Centos7æˆå“:</p><p>é“¾æ¥ï¼š<a href="https://pan.baidu.com/s/1GgUzfd8CnxzemQzvHXSzmA" target="_blank" rel="noopener">https://pan.baidu.com/s/1GgUzfd8CnxzemQzvHXSzmA</a><br>æå–ç ï¼šjk00<br>å¤åˆ¶è¿™æ®µå†…å®¹åæ‰“å¼€ç™¾åº¦ç½‘ç›˜æ‰‹æœºAppï¼Œæ“ä½œæ›´æ–¹ä¾¿å“¦</p><p><strong>å…·ä½“æ­å»ºè¿‡ç¨‹å®Œå…¨æŒ‰ç…§è¿™ç¯‡åšå®¢å®Œæˆçš„</strong>ï¼š</p><p><a href="https://www.cnblogs.com/yufeng218/p/8111961.html" target="_blank" rel="noopener">https://www.cnblogs.com/yufeng218/p/8111961.html</a></p><p>æ„Ÿå…´è¶£çš„å¯ä»¥è¯•ç€åšåšã€‚ï¼ˆè‰¯å¿ƒæ–‡ç« ï¼‰</p><p>å¦å¤–ï¼Œä½¿ç”¨æˆ‘æ­å»ºå¥½çš„Centos7æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦<strong>æ³¨æ„ä¸€ä¸‹</strong>ã€‚</p><h4 id="é…ç½®å’Œå¯åŠ¨storage"><a href="#é…ç½®å’Œå¯åŠ¨storage" class="headerlink" title="é…ç½®å’Œå¯åŠ¨storage"></a>é…ç½®å’Œå¯åŠ¨storage</h4><ol><li>cdåˆ‡æ¢ç›®å½•åˆ°ï¼š /etc/fdfs/ ç›®å½•ä¸‹</li><li>ä¿®æ”¹storage.conf ;   <strong>vi  storage.conf</strong></li></ol><div class="hljs"><pre><code class="hljs angelscript">#é…ç½®trackeræœåŠ¡å™¨:IPtracker_server=<span class="hljs-number">192.168</span><span class="hljs-number">.172</span><span class="hljs-number">.20</span>:<span class="hljs-number">22122</span>#å¦‚æœæœ‰å¤šä¸ªåˆ™é…ç½®å¤šä¸ªtracker#tracker_server=<span class="hljs-number">192.168</span><span class="hljs-number">.101</span><span class="hljs-number">.4</span>:<span class="hljs-number">22122</span>è¿™é‡Œçš„storage.confé…ç½®æ–‡ä»¶è¦æˆè‡ªå·±è™šæ‹Ÿæœºçš„ipåœ°å€</code></pre></div><ol start="3"><li><strong>vi /etc/fdfs/mod_fastdfs.confï¼Œæ”¹æˆè™šæ‹Ÿæœºipåœ°å€ï¼ˆåŒä¸Šï¼‰</strong></li></ol><div class="hljs"><pre><code class="hljs ini"><span class="hljs-attr">base_path</span>=/home/fastdfs<span class="hljs-attr">tracker_server</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">172.20</span>:<span class="hljs-number">22122</span> <span class="hljs-comment">#tracker_server=192.168.172.20:22122 #(å¤šä¸ªtrackeré…ç½®å¤šè¡Œ)</span><span class="hljs-attr">url_have_group_name</span>=<span class="hljs-literal">true</span>        <span class="hljs-comment">#urlä¸­åŒ…å«groupåç§°</span><span class="hljs-attr">store_path0</span>=/home/fdfs_storage  <span class="hljs-comment">#æŒ‡å®šæ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼ˆä¸Šé¢é…ç½®çš„storeè·¯å¾„ï¼‰</span></code></pre></div><p>ã€€ã€€ã€€ã€€4.ä¿®æ”¹nginxé…ç½®æ–‡ä»¶ï¼Œæ”¹iPåœ°å€ï¼ˆåŒä¸Šï¼‰</p><div class="hljs"><pre><code class="hljs stata"><span class="hljs-keyword">cd</span> /usr/<span class="hljs-keyword">local</span>/nginx/<span class="hljs-keyword">conf</span>/vi nginx.<span class="hljs-keyword">conf</span></code></pre></div><p><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/20.png" srcset="/img/loading.gif" alt="img"></p><p>æˆ‘çš„Centos7é»˜è®¤é…ç½®<strong>trackerï¼Œ**</strong>storageå’Œnginxé»˜è®¤å¼€æœºè‡ªåŠ¨å¯åŠ¨äº†**</p><p>å¯ä»¥å¯åŠ¨å®Œæˆåè¿›å…¥ /home/fdfs_storage/data ç›®å½•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»å¯åŠ¨äº†ã€‚</p><p><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/21.png" srcset="/img/loading.gif" alt="img"></p><p> nginxå¯ä»¥é€šè¿‡ps -ef | grep nginxæŸ¥çœ‹è¿›ç¨‹ï¼Œ</p><p><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/22.png" srcset="/img/loading.gif" alt="img"></p><h4 id="ä¸Šä¼ å›¾ç‰‡æµ‹è¯•"><a href="#ä¸Šä¼ å›¾ç‰‡æµ‹è¯•" class="headerlink" title="ä¸Šä¼ å›¾ç‰‡æµ‹è¯•"></a>ä¸Šä¼ å›¾ç‰‡æµ‹è¯•</h4><p>æ‹·è´ä¸€å¼ å›¾ç‰‡1.jpg åˆ°CentosæœåŠ¡å™¨ä¸Šçš„ rootç›®å½•ä¸‹,è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤</p><div class="hljs"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/fdfs_test /</span>etc<span class="hljs-regexp">/fdfs/</span>client.conf upload <span class="hljs-regexp">/root/</span><span class="hljs-number">1</span>.jpg</code></pre></div><p><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/23.png" srcset="/img/loading.gif" alt="img"></p><p> çº¢è‰²æ—¢æ˜¯urlåœ°å€ï¼Œåœ¨æµè§ˆå™¨ä¸Šè¾“å…¥ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šä¼ å›¾ç‰‡æˆåŠŸï¼ï¼</p><p><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/24.png" srcset="/img/loading.gif" alt="img"></p><h3 id="2ã€ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥è¯¢-æµ‹è¯•"><a href="#2ã€ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥è¯¢-æµ‹è¯•" class="headerlink" title="2ã€ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥è¯¢ æµ‹è¯•"></a>2ã€ä¸Šä¼ ã€ä¸‹è½½ã€æŸ¥è¯¢ æµ‹è¯•</h3><p>åœ¨å·¥ç¨‹ä¸‹åˆ›å»º <code>test-fastdfs</code> æ¨¡å—</p><h4 id="1ï¼‰ä¸Šä¼ æµ‹è¯•"><a href="#1ï¼‰ä¸Šä¼ æµ‹è¯•" class="headerlink" title="1ï¼‰ä¸Šä¼ æµ‹è¯•"></a>1ï¼‰ä¸Šä¼ æµ‹è¯•</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestFastDFS</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æµ‹è¯•æ–‡ä»¶ä¸Šä¼ </span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFileUpload</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">//åŠ è½½é…ç½®æ–‡ä»¶</span>            ClientGlobal.initByProperties(<span class="hljs-string">"config/fastdfs-client.properties"</span>);            <span class="hljs-comment">//è¿æ¥ Tracker</span>            TrackerClient trackerClient = <span class="hljs-keyword">new</span> TrackerClient();            TrackerServer trackerServer = trackerClient.getConnection();            <span class="hljs-comment">//è·å– Storage</span>            StorageServer storeStorage = trackerClient.getStoreStorage(trackerServer);            <span class="hljs-comment">//åˆ›å»º Storage Client</span>            StorageClient1 storageClient1 = <span class="hljs-keyword">new</span> StorageClient1(trackerServer, storeStorage);            <span class="hljs-comment">//å‘ Storage æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶,æ‹¿åˆ°æ–‡ä»¶id</span>            String filePath = <span class="hljs-string">"d:/test1.html"</span>;            String fileId = storageClient1.upload_file1(filePath, <span class="hljs-string">"html"</span>, <span class="hljs-keyword">null</span>);            System.out.println(<span class="hljs-string">"ä¸Šä¼ æˆåŠŸï¼š"</span> + fileId);        &#125; <span class="hljs-keyword">catch</span> (Exception ex)&#123;            ex.printStackTrace();        &#125;    &#125;&#125;</code></pre></div><p>åœ¨ä¸Šè¿°çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è®¿é—® <code>Tracker</code> å°† <code>d:/test1.html</code> æ–‡ä»¶ä¸Šä¼ åˆ°äº† Storage æœåŠ¡å™¨ä¸­ï¼Œä¸Šä¼ å®Œæˆåå¾—åˆ°äº†æ–‡ä»¶çš„å®Œæ•´çš„å‚¨å­˜è·¯å¾„ï¼Œå¦‚ä¸‹ï¼š</p><p><code>group1/M00/00/00/CgEBmF6QKa-Abjv7AAAGqbcDljA60.html</code></p><p><a href="https://qnoss.codeyee.com/20200704_8/image6" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image6.png" srcset="/img/loading.gif" alt="img"></a></p><p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>Storage</code> ä¸­çš„ç‰©ç† <code>fdfs_storage/data</code> è·¯å¾„æ‰¾åˆ°è¯¥æ–‡ä»¶</p><p><a href="https://qnoss.codeyee.com/20200704_8/image7" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image7.png" srcset="/img/loading.gif" alt="img"></a></p><h4 id="2ï¼‰æ–‡ä»¶æŸ¥è¯¢"><a href="#2ï¼‰æ–‡ä»¶æŸ¥è¯¢" class="headerlink" title="2ï¼‰æ–‡ä»¶æŸ¥è¯¢"></a>2ï¼‰æ–‡ä»¶æŸ¥è¯¢</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ–‡ä»¶ä¿¡æ¯æŸ¥è¯¢</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TestFileInfoQuery</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">try</span> &#123;        <span class="hljs-comment">//åŠ è½½é…ç½®æ–‡ä»¶</span>        ClientGlobal.initByProperties(<span class="hljs-string">"config/fastdfs-client.properties"</span>);        <span class="hljs-comment">//è¿æ¥ Tracker</span>        TrackerClient trackerClient = <span class="hljs-keyword">new</span> TrackerClient();        TrackerServer trackerServer = trackerClient.getConnection();        <span class="hljs-comment">//è·å– Storage</span>        StorageServer storeStorage = trackerClient.getStoreStorage(trackerServer);        <span class="hljs-comment">//åˆ›å»º Storage Client</span>        StorageClient1 storageClient1 = <span class="hljs-keyword">new</span> StorageClient1(trackerServer, storeStorage);        String fileId = <span class="hljs-string">"group1/M00/00/00/CgEBmF6QKa-Abjv7AAAGqbcDljA60.html"</span>;        FileInfo fileInfo = storageClient1.query_file_info1(fileId);        System.out.println(<span class="hljs-string">"æ–‡ä»¶ä¿¡æ¯: "</span>+ fileInfo);    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;        e.printStackTrace();    &#125;&#125;</code></pre></div><p>è¿è¡Œç»“æœ</p><p><a href="https://qnoss.codeyee.com/20200704_8/image8" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image8.png" srcset="/img/loading.gif" alt="img"></a></p><h4 id="3ï¼‰æ–‡ä»¶ä¸‹è½½"><a href="#3ï¼‰æ–‡ä»¶ä¸‹è½½" class="headerlink" title="3ï¼‰æ–‡ä»¶ä¸‹è½½"></a>3ï¼‰æ–‡ä»¶ä¸‹è½½</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ–‡ä»¶ä¸‹è½½</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TestFileDownload</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">try</span> &#123;        <span class="hljs-comment">//åŠ è½½é…ç½®æ–‡ä»¶</span>        ClientGlobal.initByProperties(<span class="hljs-string">"config/fastdfs-client.properties"</span>);        <span class="hljs-comment">//è¿æ¥ Tracker</span>        TrackerClient trackerClient = <span class="hljs-keyword">new</span> TrackerClient();        TrackerServer trackerServer = trackerClient.getConnection();        <span class="hljs-comment">//è·å– Storage</span>        StorageServer storeStorage = trackerClient.getStoreStorage(trackerServer);        <span class="hljs-comment">//åˆ›å»º Storage Client</span>        StorageClient1 storageClient1 = <span class="hljs-keyword">new</span> StorageClient1(trackerServer, storeStorage);        String fileId = <span class="hljs-string">"group1/M00/00/00/CgEBmF6QKa-Abjv7AAAGqbcDljA60.html"</span>;        String saveToPath = <span class="hljs-string">"d:/test.html"</span>;        <span class="hljs-comment">//ä¸‹è½½æ–‡ä»¶</span>        <span class="hljs-keyword">byte</span>[] bytes = storageClient1.download_file1(fileId);        FileOutputStream fileOutputStream = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-keyword">new</span> File(saveToPath));        fileOutputStream.write(bytes);        System.out.println(<span class="hljs-string">"ä¸‹è½½æˆåŠŸ! "</span> + saveToPath);    &#125; <span class="hljs-keyword">catch</span> (Exception ex)&#123;        ex.printStackTrace();    &#125;&#125;</code></pre></div><p>è¿è¡Œç»“æœ</p><p><a href="https://qnoss.codeyee.com/20200704_8/image9" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image9.png" srcset="/img/loading.gif" alt="img"></a></p><h3 id="3ã€æ­å»ºå›¾ç‰‡è™šæ‹Ÿä¸»æœº"><a href="#3ã€æ­å»ºå›¾ç‰‡è™šæ‹Ÿä¸»æœº" class="headerlink" title="3ã€æ­å»ºå›¾ç‰‡è™šæ‹Ÿä¸»æœº"></a>3ã€æ­å»ºå›¾ç‰‡è™šæ‹Ÿä¸»æœº</h3><h4 id="1ï¼‰-åœ¨storageä¸Šå®‰è£…Nginx"><a href="#1ï¼‰-åœ¨storageä¸Šå®‰è£…Nginx" class="headerlink" title="1ï¼‰ åœ¨storageä¸Šå®‰è£…Nginx"></a>1ï¼‰ åœ¨storageä¸Šå®‰è£…Nginx</h4><p>åœ¨ <code>storage server</code> ä¸Šå®‰è£… <code>nginx</code> çš„ç›®çš„æ˜¯å¯¹å¤–é€šè¿‡ <code>http</code> è®¿é—® <code>storage server</code> ä¸Šçš„æ–‡ ä»¶ã€‚ä½¿ç”¨ <code>nginx</code> çš„æ¨¡å— <code>FastDFS-nginx-module</code> çš„ä½œç”¨æ˜¯é€šè¿‡ <code>http</code> æ–¹å¼è®¿é—® <code>storage</code> ä¸­ çš„æ–‡ä»¶ï¼Œå½“ <code>storage</code> æœ¬æœºæ²¡æœ‰è¦æ‰¾çš„æ–‡ä»¶æ—¶å‘æº<code>storage</code> ä¸»æœºä»£ç†è¯·æ±‚æ–‡ä»¶ã€‚</p><p>åœ¨storageä¸Šå®‰è£…nginxï¼ˆå®‰è£… <code>FastDFS-nginx-module</code> æ¨¡å—ï¼‰</p><p>å‚è€ƒï¼š<code>FastDFSå®‰è£…æ•™ç¨‹.pdf</code> è¿›è¡Œå®‰è£…</p><p>å®‰è£…å®Œæˆå¯åŠ¨ <code>storage</code>ä¸Šçš„ <code>nginx</code>ï¼š</p><div class="hljs"><pre><code class="hljs shell">/usr/local/nginx/sbin/nginx â€c /usr/local/nginx/conf/nginxâ€fdfs.conf</code></pre></div><h4 id="2ï¼‰é…ç½®-Nginx-çš„å›¾ç‰‡æœåŠ¡çš„è™šæ‹Ÿä¸»æœº"><a href="#2ï¼‰é…ç½®-Nginx-çš„å›¾ç‰‡æœåŠ¡çš„è™šæ‹Ÿä¸»æœº" class="headerlink" title="2ï¼‰é…ç½® Nginx çš„å›¾ç‰‡æœåŠ¡çš„è™šæ‹Ÿä¸»æœº"></a>2ï¼‰é…ç½® Nginx çš„å›¾ç‰‡æœåŠ¡çš„è™šæ‹Ÿä¸»æœº</h4><p>å›¾ç‰‡æœåŠ¡è™šæ‹Ÿä¸»æœºçš„ä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡ï¼Œå°†å›¾ç‰‡è¯·æ±‚è½¬å‘åˆ° <code>storage server</code> ä¸Šã€‚</p><p>1ã€ é€šè¿‡å›¾ç‰‡æœåŠ¡è™šæ‹Ÿä¸»æœºè¯·æ±‚å›¾ç‰‡æµç¨‹å›¾</p><p><a href="https://qnoss.codeyee.com/20200704_8/image10" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image10.png" srcset="/img/loading.gif" alt="img"></a></p><p>2ã€åœ¨ <code>nginx</code> å›¾ç‰‡ä»£ç†æœåŠ¡ä¸Šé…ç½®å›¾ç‰‡æœåŠ¡å™¨è™šæ‹Ÿä¸»æœº</p><p>ä¿®æ”¹æœ¬åœ°çš„ <code>hosts</code> æ–‡ä»¶ï¼Œå°† img.xuecheng.com æ˜ å°„åˆ°æœ¬åœ°IP <code>127.0.0.1</code></p><p>windows çš„ hosts æ–‡ä»¶è·¯å¾„ä¸ºï¼š<code>C:\Windows\System32\drivers\etc</code></p><div class="hljs"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1</span> img.xuecheng.com</code></pre></div><p>å¢åŠ  <code>nginx</code> è™šæ‹Ÿæœºä¸»æœº</p><div class="hljs"><pre><code class="hljs shell"><span class="hljs-meta">#</span><span class="bash">å›¾ç‰‡æœåŠ¡</span>upstream img_server_pool&#123;<span class="hljs-meta">#</span><span class="bash">server 192.168.101.64:80 weight=10;</span>server 10.1.1.152:80 weight=10;&#125; <span class="hljs-meta">#</span><span class="bash">å­¦æˆç½‘å›¾ç‰‡æœåŠ¡</span>server &#123;listen       80;    server_name img.xuecheng.com;    <span class="hljs-meta">#</span><span class="bash">ä¸ªäººä¸­å¿ƒ    </span>location /group1 &#123;      proxy_pass http://img_server_pool;          &#125;     location /group2 &#123;      proxy_pass http://img_server_pool;          &#125;     &#125;</code></pre></div><p>3ã€æµ‹è¯•è®¿é—®</p><p><a href="http://img.xuecheng.com/group1/M00/00/00/CgEBmF6QKa-Abjv7AAAGqbcDljA60.html" target="_blank" rel="noopener">http://img.xuecheng.com/group1/M00/00/00/CgEBmF6QKa-Abjv7AAAGqbcDljA60.html</a></p><p>æˆåŠŸæ˜ å°„åˆ° storage æœåŠ¡ä¸Š</p><p><a href="https://qnoss.codeyee.com/20200704_8/image11" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image11.png" srcset="/img/loading.gif" alt="img"></a></p><h3 id="4ã€æ€»ç»“"><a href="#4ã€æ€»ç»“" class="headerlink" title="4ã€æ€»ç»“"></a>4ã€æ€»ç»“</h3><p>é€šè¿‡æœ¬æ¬¡è¯¾ç¨‹çš„å­¦ä¹ æ‚¨è¦è¾¾åˆ°ä»¥ä¸‹ç›®æ ‡ï¼š</p><p><strong>1ï¼‰äº†è§£åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„æ¦‚å¿µåŠåº”ç”¨åœºæ™¯</strong></p><p>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿæ˜¯é€šè¿‡ç½‘ç»œå°†å•æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿç»„æˆä¸€ä¸ªç½‘ç»œæ–‡ä»¶ç³»ç»Ÿã€‚</p><p>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸»è¦åº”ç”¨åœ¨å¤§å‹äº’è”ç½‘é¡¹ç›®ä¸­ï¼Œå®ç°å›¾ç‰‡å­˜å‚¨ã€éŸ³è§†é¢‘å­˜å‚¨ç­‰æœåŠ¡ã€‚</p><p>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ä¼˜ç‚¹ï¼šå¯ä»¥å¿«é€Ÿæ‰©å®¹å­˜å‚¨ï¼Œæé«˜æ–‡ä»¶è®¿é—®é€Ÿåº¦ã€‚</p><p><strong>2ï¼‰ç†è§£fastDFSçš„å·¥ä½œåŸç†</strong></p><p>fastDFS ç”± <code>tracker</code> å’Œ <code>storage</code> ç»„æˆï¼Œå®ƒä»¬éƒ½å¯ä»¥éƒ¨ç½²é›†ç¾¤ã€‚</p><p><code>tracker</code> è´Ÿè´£è°ƒåº¦ï¼Œ<code>storage</code> è´Ÿè´£å­˜å‚¨ã€‚</p><p><strong>3ï¼‰æŒæ¡ fastDFS å­˜å–æ–‡ä»¶æ–¹æ³•</strong></p><p>å®¢æˆ·ç«¯ä¸ <code>fastDFS</code> é‡‡ç”¨ <code>socket</code> åè®®é€šä¿¡ï¼Œå¯ä»¥é‡‡ç”¨å®˜æ–¹æä¾›çš„ <code>java</code>ç‰ˆæœ¬çš„ <code>fastDSF-client</code>å¿«é€Ÿå¼€å‘ã€‚</p><p><strong>4ï¼‰èƒ½å¤ŸåŠ¨æ‰‹æ­å»ºä¸€ä¸ª fastDSF æ–‡ä»¶æœåŠ¡å™¨</strong></p><h1 id="äºŒã€ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡"><a href="#äºŒã€ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡" class="headerlink" title="äºŒã€ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡"></a>äºŒã€ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åœ¨å¾ˆå¤šç³»ç»Ÿéƒ½æœ‰ä¸Šä¼ å›¾ç‰‡/ä¸Šä¼ æ–‡ä»¶çš„éœ€æ±‚ï¼Œæ¯”å¦‚ï¼šä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡ã€ä¸Šä¼ è¯¾ç¨‹èµ„æ–™ã€ä¸Šä¼ ç”¨æˆ·å¤´åƒç­‰ï¼Œä¸ºäº†æä¾›ç³»ç»Ÿçš„å¯é‡ç”¨æ€§ä¸“é—¨è®¾ç«‹æ–‡ä»¶ç³»ç»ŸæœåŠ¡æ‰¿æ‹…å›¾ç‰‡/æ–‡ä»¶çš„ç®¡ç†ï¼Œæ–‡ä»¶ç³»ç»ŸæœåŠ¡å®ç°å¯¹æ–‡ä»¶çš„ä¸Šä¼ ã€åˆ é™¤ã€æŸ¥è¯¢ç­‰åŠŸèƒ½è¿›è¡Œç®¡ç†ã€‚</p><p>å„ä¸ªå­ç³»ç»Ÿä¸å†å¼€å‘ä¸Šä¼ æ–‡ä»¶çš„è¯·æ±‚ï¼Œå„ä¸ªå­ç³»ç»Ÿé€šè¿‡æ–‡ä»¶ç³»ç»ŸæœåŠ¡è¿›è¡Œæ–‡ä»¶çš„ä¸Šä¼ ã€åˆ é™¤ç­‰æ“ä½œã€‚æ–‡ä»¶ç³»ç»ŸæœåŠ¡æœ€ç»ˆä¼šå°†æ–‡ä»¶å­˜å‚¨åˆ° <code>fastDSF</code> æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p><p>ä¸‹å›¾æ˜¯å„å„å­ç³»ç»Ÿä¸æ–‡ä»¶ç³»ç»ŸæœåŠ¡ä¹‹é—´çš„å…³ç³»ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_8/image12" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image12.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä¸‹å›¾æ˜¯è¯¾ç¨‹ç®¡ç†ä¸­ä¸Šä¼ å›¾ç‰‡å¤„ç†æµç¨‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_8/image13" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image13.png" srcset="/img/loading.gif" alt="img"></a></p><p>æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€ç®¡ç†å‘˜è¿›å…¥æ•™å­¦ç®¡ç†å‰ç«¯ï¼Œç‚¹å‡»ä¸Šä¼ å›¾ç‰‡</p><p>2ã€å›¾ç‰‡ä¸Šä¼ è‡³æ–‡ä»¶ç³»ç»ŸæœåŠ¡ï¼Œæ–‡ä»¶ç³»ç»Ÿè¯·æ±‚ <code>fastDFS</code> ä¸Šä¼ æ–‡ä»¶</p><p>3ã€æ–‡ä»¶ç³»ç»Ÿå°†æ–‡ä»¶å…¥åº“ï¼Œå­˜å‚¨åˆ°æ–‡ä»¶ç³»ç»ŸæœåŠ¡æ•°æ®åº“ä¸­ã€‚</p><p>4ã€æ–‡ä»¶ç³»ç»ŸæœåŠ¡å‘å‰ç«¯è¿”å›æ–‡ä»¶ä¸Šä¼ ç»“æœï¼Œå¦‚æœæˆåŠŸåˆ™åŒ…æ‹¬æ–‡ä»¶çš„ <code>Url</code> è·¯å¾„ã€‚</p><p>5ã€è¯¾ç¨‹ç®¡ç†å‰ç«¯è¯·æ±‚ è¯¾ç¨‹ç®¡ç† è¿›è¡Œä¿å­˜è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯åˆ°è¯¾ç¨‹ æ•°æ®åº“ã€‚</p><p>6ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡å°†è¯¾ç¨‹å›¾ç‰‡ä¿å­˜åœ¨ è¯¾ç¨‹æ•°æ®åº“ã€‚</p><h2 id="2-åˆ›å»ºå·¥ç¨‹"><a href="#2-åˆ›å»ºå·¥ç¨‹" class="headerlink" title="2. åˆ›å»ºå·¥ç¨‹"></a>2. åˆ›å»ºå·¥ç¨‹</h2><p>å¯¼å…¥<code>xc-service-base-filesystem.zip</code>å·¥ç¨‹ã€‚</p><p>1ï¼‰å·¥ç¨‹ç›®å½•ç»“æ„å¦‚ä¸‹</p><p><a href="https://qnoss.codeyee.com/20200704_8/image14" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image14.png" srcset="/img/loading.gif" alt="image-20200410193248194"></a></p><p><a href="https://qnoss.codeyee.com/20200704_8/image14" target="_blank" rel="noopener">image-20200410193248194</a></p><p>1ï¼‰pom.xml æ–‡ä»¶</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../xc-framework-parent/pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-base-filesystem<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-model<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.oschina.zcx7878<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastdfs-client-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><p>2ï¼‰é…ç½®æ–‡ä»¶</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">22100</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">xc-service-base-filesystem</span><span class="hljs-comment">#mongoé…ç½®</span>  <span class="hljs-attr">data:</span>    <span class="hljs-attr">mongodb:</span>      <span class="hljs-attr">database:</span> <span class="hljs-string">xc_fs</span>      <span class="hljs-attr">uri:</span> <span class="hljs-string">mongodb://root:123123@127.0.0.1:27017</span><span class="hljs-comment">#SpringMVCä¸Šä¼ æ–‡ä»¶é…ç½®</span>  <span class="hljs-attr">servlet:</span>    <span class="hljs-attr">multipart:</span>      <span class="hljs-comment">#é»˜è®¤æ”¯æŒæ–‡ä»¶ä¸Šä¼ .</span>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>      <span class="hljs-comment">#æ”¯æŒæ–‡ä»¶å†™å…¥ç£ç›˜.</span>      <span class="hljs-attr">file-size-threshold:</span> <span class="hljs-number">0</span>      <span class="hljs-comment"># ä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶ç›®å½•</span>      <span class="hljs-attr">location:</span>      <span class="hljs-comment"># æœ€å¤§æ”¯æŒæ–‡ä»¶å¤§å°</span>      <span class="hljs-attr">max-file-size:</span> <span class="hljs-string">1MB</span>      <span class="hljs-comment"># æœ€å¤§æ”¯æŒè¯·æ±‚å¤§å°</span>      <span class="hljs-attr">max-request-size:</span> <span class="hljs-string">30MB</span><span class="hljs-attr">xuecheng:</span>  <span class="hljs-attr">fastdfs:</span>    <span class="hljs-attr">connect_timeout_in_seconds:</span> <span class="hljs-number">5</span>    <span class="hljs-attr">network_timeout_in_seconds:</span> <span class="hljs-number">30</span>    <span class="hljs-attr">charset:</span> <span class="hljs-string">UTF-8</span>    <span class="hljs-attr">tracker_servers:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.101</span><span class="hljs-number">.65</span><span class="hljs-string">:22122</span> <span class="hljs-comment">#å¤šä¸ª trackerServerä¸­é—´ä»¥é€—å·åˆ†éš”</span></code></pre></div><h2 id="3-æ„å»ºæ¥å£"><a href="#3-æ„å»ºæ¥å£" class="headerlink" title="3. æ„å»ºæ¥å£"></a>3. æ„å»ºæ¥å£</h2><p>ç³»ç»Ÿçš„æ–‡ä»¶ä¿¡æ¯ï¼ˆå›¾ç‰‡ã€æ–‡æ¡£ç­‰å°æ–‡ä»¶çš„ä¿¡æ¯ï¼‰åœ¨mongodbä¸­å­˜å‚¨ï¼Œä¸‹è¾¹æ˜¯æ–‡ä»¶ä¿¡æ¯çš„æ¨¡å‹ç±»ã€‚</p><h3 id="1ã€æ¨¡å‹ç±»"><a href="#1ã€æ¨¡å‹ç±»" class="headerlink" title="1ã€æ¨¡å‹ç±»"></a>1ã€æ¨¡å‹ç±»</h3><p><strong>1ï¼‰æ¨¡å‹ç±»å¦‚ä¸‹</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-meta">@Document</span>(collection = <span class="hljs-string">"filesystem"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileSystem</span> </span>&#123;    <span class="hljs-meta">@Id</span>    <span class="hljs-keyword">private</span> String fileId;    <span class="hljs-comment">//æ–‡ä»¶è¯·æ±‚è·¯å¾„</span>    <span class="hljs-keyword">private</span> String filePath;    <span class="hljs-comment">//æ–‡ä»¶å¤§å°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> fileSize;    <span class="hljs-comment">//æ–‡ä»¶åç§°</span>    <span class="hljs-keyword">private</span> String fileName;    <span class="hljs-comment">//æ–‡ä»¶ç±»å‹</span>    <span class="hljs-keyword">private</span> String fileType;    <span class="hljs-comment">//å›¾ç‰‡å®½åº¦</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> fileWidth;    <span class="hljs-comment">//å›¾ç‰‡é«˜åº¦</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> fileHeight;    <span class="hljs-comment">//ç”¨æˆ·idï¼Œç”¨äºæˆæƒæš‚æ—¶ä¸ç”¨</span>    <span class="hljs-keyword">private</span> String userId;    <span class="hljs-comment">//ä¸šåŠ¡key</span>    <span class="hljs-keyword">private</span> String businesskey;    <span class="hljs-comment">//ä¸šåŠ¡æ ‡ç­¾</span>    <span class="hljs-keyword">private</span> String filetag;    <span class="hljs-comment">//æ–‡ä»¶å…ƒä¿¡æ¯</span>    <span class="hljs-keyword">private</span> Map metadata;&#125;</code></pre></div><p>è¯´æ˜ï¼š</p><ul><li>fileIdï¼š<code>fastDFS</code> è¿”å›çš„æ–‡ä»¶ IDã€‚</li><li>filePathï¼šè¯·æ±‚<code>fastDFS</code>æµè§ˆæ–‡ä»¶ URLã€‚</li><li>filetagï¼šæ–‡ä»¶æ ‡ç­¾ï¼Œç”±äºæ–‡ä»¶ç³»ç»ŸæœåŠ¡æ˜¯å…¬å…±æœåŠ¡ï¼Œæ–‡ä»¶ç³»ç»ŸæœåŠ¡ä¼šä¸ºä½¿ç”¨æ–‡ä»¶ç³»ç»ŸæœåŠ¡çš„å­ç³»ç»Ÿåˆ†é…æ–‡ä»¶æ ‡ç­¾ï¼Œç”¨äºæ ‡è¯†æ­¤æ–‡ä»¶æ¥è‡ªå“ªä¸ªç³»ç»Ÿã€‚</li><li>businesskeyï¼šæ–‡ä»¶ç³»ç»ŸæœåŠ¡ä¸ºå…¶å®ƒå­ç³»ç»Ÿæä¾›çš„ä¸€ä¸ªä¸šåŠ¡æ ‡è¯†å­—æ®µï¼Œå„å­ç³»ç»Ÿæ ¹æ®è‡ªå·±çš„éœ€æ±‚å»ä½¿ç”¨ï¼Œæ¯”å¦‚ï¼šè¯¾ç¨‹ç®¡ç†ä¼šåœ¨æ­¤å­—æ®µä¸­å­˜å‚¨è¯¾ç¨‹ <code>id</code> ç”¨äºæ ‡è¯†è¯¥å›¾ç‰‡å±äºå“ªä¸ªè¯¾ç¨‹ã€‚</li><li>metadataï¼šæ–‡ä»¶ç›¸å…³çš„å…ƒä¿¡æ¯ã€‚</li></ul><p><strong>2ï¼‰æ•°æ®åº“ collection é›†åˆ</strong></p><p>åœ¨ <code>mongodb</code> åˆ›å»ºæ•°æ®åº“xc_fsï¼ˆæ–‡ä»¶ç³»ç»Ÿæ•°æ®åº“ï¼‰ï¼Œå¹¶åˆ›å»ºé›†åˆ <code>filesystem</code>ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_8/image15" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image15.png" srcset="/img/loading.gif" alt="img"></a></p><h3 id="2ã€API-æ¥å£"><a href="#2ã€API-æ¥å£" class="headerlink" title="2ã€API æ¥å£"></a>2ã€API æ¥å£</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Api</span>(value = <span class="hljs-string">"æ–‡ä»¶ç®¡ç†æ¥å£"</span>, description = <span class="hljs-string">"æ–‡ä»¶ç®¡ç†æ¥å£ï¼Œæä¾›å¯¹æ–‡ä»¶çš„CRUD"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FileSystemControllerApi</span> </span>&#123;    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"ä¸Šä¼ æ–‡ä»¶æ¥å£"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> UploadFileResult <span class="hljs-title">uploadFile</span><span class="hljs-params">(MultipartFile multipartFile,</span></span><span class="hljs-function"><span class="hljs-params">                                       String fileTage,</span></span><span class="hljs-function"><span class="hljs-params">                                       String businessKey,</span></span><span class="hljs-function"><span class="hljs-params">                                       String metaData)</span></span>;&#125;</code></pre></div><h3 id="3ã€Dao-å±‚"><a href="#3ã€Dao-å±‚" class="headerlink" title="3ã€Dao å±‚"></a>3ã€Dao å±‚</h3><p>dao å±‚ç»§æ‰¿ <code>Spring Data Mongodb</code> çš„ API</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.filesystem.dao;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.filesystem.FileSystem;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">FileSystemRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">FileSystem</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div><h3 id="4ã€Service-å±‚"><a href="#4ã€Service-å±‚" class="headerlink" title="4ã€Service å±‚"></a>4ã€Service å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.filesystem.service;<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<span class="hljs-keyword">import</span> com.xuecheng.filesystem.dao.FileSystemRepository;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.filesystem.FileSystem;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.filesystem.response.FileSystemCode;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.filesystem.response.UploadFileResult;<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<span class="hljs-keyword">import</span> org.csource.common.MyException;<span class="hljs-keyword">import</span> org.csource.fastdfs.*;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.Map;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileSystemService</span> </span>&#123;    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.fastdfs.tracker_servers&#125;"</span>)    String tracker_servers;    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.fastdfs.connect_timeout_in_seconds&#125;"</span>)    <span class="hljs-keyword">int</span> connect_timeout_in_seconds;    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.fastdfs.network_timeout_in_seconds&#125;"</span>)    <span class="hljs-keyword">int</span> network_timeout_in_seconds;    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.fastdfs.charset&#125;"</span>)    String charset;    <span class="hljs-meta">@Autowired</span>    FileSystemRepository fileSystemRepository;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ä¸Šä¼ æ–‡ä»¶åˆ°FastDFS</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> multipartFile æ–‡ä»¶æ•°æ®</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> fileTag æ–‡ä»¶æ ‡ç­¾</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> businessKey ä¸šåŠ¡key</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> metaData æ–‡ä»¶å…ƒæ•°æ®</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> UploadFileResult <span class="hljs-title">uploadFile</span><span class="hljs-params">(MultipartFile multipartFile,</span></span><span class="hljs-function"><span class="hljs-params">                                       String fileTag,</span></span><span class="hljs-function"><span class="hljs-params">                                       String businessKey,</span></span><span class="hljs-function"><span class="hljs-params">                                       String metaData)</span></span>&#123;        <span class="hljs-comment">//éªŒè¯æäº¤çš„æ–‡ä»¶æ˜¯å¦ä¸ºç©º</span>        <span class="hljs-keyword">if</span>(multipartFile == <span class="hljs-keyword">null</span>)&#123;            ExceptionCast.cast(FileSystemCode.FS_UPLOADFILE_FILEISNULL);        &#125;        <span class="hljs-comment">//ç¬¬ä¸€æ­¥ï¼šå°†æ–‡ä»¶ä¸Šä¼ åˆ° FastDFSä¸­</span>        String fileId = <span class="hljs-keyword">this</span>.fdfsUpload(multipartFile);        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(fileId))&#123;    <span class="hljs-comment">//ä¸Šä¼ æ–‡ä»¶ä¸ºç©ºæ—¶æŠ›å‡ºå¼‚å¸¸</span>            ExceptionCast.cast(FileSystemCode.FS_UPLOADFILE_SERVERFAIL);        &#125;        <span class="hljs-comment">//ç¬¬äºŒæ­¥ï¼šå°†æ–‡ä»¶å‚¨å­˜åˆ°mongoDBå†…</span>        <span class="hljs-comment">//è®¾ç½®ç›¸å…³çš„æ–‡ä»¶ä¿¡æ¯</span>        FileSystem fileSystem = <span class="hljs-keyword">new</span> FileSystem();        fileSystem.setFileId(fileId);        fileSystem.setFileName(multipartFile.getOriginalFilename());        fileSystem.setBusinesskey(businessKey);        fileSystem.setFilePath(fileId); <span class="hljs-comment">//FastDFSçš„fileIdå°±æ˜¯å®é™…çš„ç‰©ç†è·¯å¾„</span>        fileSystem.setFileSize(multipartFile.getSize());        fileSystem.setFiletag(fileTag);        fileSystem.setFileType(multipartFile.getContentType());        <span class="hljs-comment">//æ–‡ä»¶å…ƒæ•°æ®éœ€è¦è½¬æ¢æˆMapå¯¹è±¡</span>        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(metaData))&#123;            Map metaDataMap = JSON.parseObject(metaData, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;            fileSystem.setMetadata(metaDataMap);        &#125;        FileSystem save = fileSystemRepository.save(fileSystem);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UploadFileResult(CommonCode.SUCCESS,save);    &#125;    <span class="hljs-comment">//ä¸Šä¼ æ–‡ä»¶åˆ°FastDFS</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">fdfsUpload</span><span class="hljs-params">(MultipartFile multipartFile)</span></span>&#123;        <span class="hljs-comment">//åˆå§‹åŒ–FastDFSçš„ç¯å¢ƒ</span>        <span class="hljs-keyword">try</span> &#123;            initFdfsConfig();            TrackerClient trackerClient = <span class="hljs-keyword">new</span> TrackerClient();            TrackerServer trackerServer = trackerClient.getConnection();            <span class="hljs-comment">//å¾—åˆ° Storage è¿æ¥ä¿¡æ¯</span>            StorageServer storeStorage = trackerClient.getStoreStorage(trackerServer);            <span class="hljs-comment">//è·å– Storage å®¢æˆ·ç«¯</span>            StorageClient1 storageClient1 = <span class="hljs-keyword">new</span> StorageClient1(trackerServer, storeStorage);            <span class="hljs-comment">//ä¸Šä¼ æ–‡ä»¶</span>            <span class="hljs-keyword">byte</span>[] fileBytes = multipartFile.getBytes();   <span class="hljs-comment">// è·å–æ–‡ä»¶ä¿¡æ¯</span>            String originalFilename = multipartFile.getOriginalFilename();            <span class="hljs-comment">// è·å–æ–‡ä»¶æ‹“å±•å</span>            String extStr = originalFilename.substring(originalFilename.lastIndexOf(<span class="hljs-string">"."</span>) + <span class="hljs-number">1</span>);            <span class="hljs-comment">//ä¸Šä¼ æ–‡ä»¶</span>            String fileId = storageClient1.upload_file1(fileBytes, extStr, <span class="hljs-keyword">null</span>);            <span class="hljs-keyword">return</span> fileId;        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-comment">//åˆå§‹åŒ–FastDFSç¯å¢ƒ</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initFdfsConfig</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">try</span> &#123;              ClientGlobal.initByTrackers(tracker_servers);              ClientGlobal.setG_connect_timeout(connect_timeout_in_seconds);              ClientGlobal.setG_network_timeout(network_timeout_in_seconds);              ClientGlobal.setG_charset(charset);        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;            e.printStackTrace();            <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸</span>            ExceptionCast.cast(FileSystemCode.FS_INITFDFS_ERROR);        &#125;    &#125;&#125;</code></pre></div><h3 id="5ã€Controller-å±‚"><a href="#5ã€Controller-å±‚" class="headerlink" title="5ã€Controller å±‚"></a>5ã€Controller å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.filesystem.controller;<span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/filesystem"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FileSystemController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">FileSystemControllerApi</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    FileSystemService fileSystemService;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/upload"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> UploadFileResult <span class="hljs-title">uploadFile</span><span class="hljs-params">(MultipartFile multipartFile, String fileTag, String businessKey, String metaData)</span> </span>&#123;        <span class="hljs-keyword">return</span> fileSystemService.uploadFile(multipartFile,fileTag,businessKey,metaData);    &#125;&#125;</code></pre></div><h3 id="6ã€æµ‹è¯•"><a href="#6ã€æµ‹è¯•" class="headerlink" title="6ã€æµ‹è¯•"></a>6ã€æµ‹è¯•</h3><p>åœ¨ Swagger UI ç”Ÿæˆçš„æ¥å£æ–‡æ¡£å†…è¿›è¡Œæµ‹è¯• <a href="http://localhost:22100/swagger-ui.html" target="_blank" rel="noopener">http://localhost:22100/swagger-ui.html</a></p><p><a href="https://qnoss.codeyee.com/20200704_8/image16" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image16.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="4-å‰ç«¯é…ç½®"><a href="#4-å‰ç«¯é…ç½®" class="headerlink" title="4. å‰ç«¯é…ç½®"></a>4. å‰ç«¯é…ç½®</h2><h3 id="1ã€éœ€æ±‚"><a href="#1ã€éœ€æ±‚" class="headerlink" title="1ã€éœ€æ±‚"></a>1ã€éœ€æ±‚</h3><p>ä¸Šä¼ å›¾ç‰‡ç•Œé¢å¦‚ä¸‹å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_8/image17" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image17.png" srcset="/img/loading.gif" alt="img"></a></p><p>ç‚¹å‡»â€œåŠ å·â€ä¸Šä¼ å›¾ç‰‡ï¼Œå›¾ç‰‡ä¸Šä¼ æˆåŠŸè‡ªåŠ¨æ˜¾ç¤ºï¼›ç‚¹å‡»â€œåˆ é™¤â€å°†åˆ é™¤å›¾ç‰‡ã€‚</p><h3 id="2ã€é¡µé¢"><a href="#2ã€é¡µé¢" class="headerlink" title="2ã€é¡µé¢"></a>2ã€é¡µé¢</h3><p>ä½¿ç”¨ <code>Element-UI</code> çš„<code>Upload</code>ä¸Šä¼ ç»„ä»¶å®ç°ä¸Šè¾¹çš„æ•ˆæœã€‚</p><p><strong>1) template</strong></p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€upload</span></span><span class="hljs-tag">  <span class="hljs-attr">action</span>=<span class="hljs-string">"/filesystem/upload"</span></span><span class="hljs-tag">  <span class="hljs-attr">list</span>â€<span class="hljs-attr">type</span>=<span class="hljs-string">"pictureâ€card"</span></span><span class="hljs-tag">  <span class="hljs-attr">name</span>=<span class="hljs-string">"multipartFile"</span> </span><span class="hljs-tag">  <span class="hljs-attr">:before</span>â€<span class="hljs-attr">upload</span>=<span class="hljs-string">"setbusinesskey"</span></span><span class="hljs-tag">  <span class="hljs-attr">:on</span>â€<span class="hljs-attr">success</span>=<span class="hljs-string">"handleSuccess"</span></span><span class="hljs-tag">  <span class="hljs-attr">:file</span>â€<span class="hljs-attr">list</span>=<span class="hljs-string">"fileList"</span></span><span class="hljs-tag">  <span class="hljs-attr">:limit</span>=<span class="hljs-string">"picmax"</span></span><span class="hljs-tag">  <span class="hljs-attr">:on</span>â€<span class="hljs-attr">exceed</span>=<span class="hljs-string">"rejectupload"</span></span><span class="hljs-tag">  <span class="hljs-attr">:data</span>=<span class="hljs-string">"uploadval"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"elâ€iconâ€plus"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€upload</span>&gt;</span></code></pre></div><p>el-uploadå‚æ•°è¯´æ˜ï¼š</p><ul><li>actionï¼šå¿…é€‰å‚æ•°ï¼Œä¸Šä¼ çš„åœ°å€</li><li>list-typeï¼šæ–‡ä»¶åˆ—è¡¨çš„ç±»å‹ï¼ˆtext/picture/picture-cardï¼‰</li><li>name: æäº¤çš„æ–‡ä»¶å‚æ•°åç§°ï¼Œè¿™é‡Œè¦è·Ÿåç«¯æ¥æ”¶çš„å¯¹åº”ä¸Š</li><li>before-uploadï¼šä¸Šä¼ å‰æ‰§è¡Œé’©å­æ–¹æ³• ï¼Œfunction(file)</li><li>on-successï¼šä¸Šä¼ æˆåŠŸ æ‰§è¡Œçš„é’©å­æ–¹æ³• ï¼Œfunction(response, file, fileList)</li><li>on-errorï¼šä¸Šä¼ å¤±è´¥çš„é’©å­æ–¹æ³•ï¼Œfunction(err, file, fileList)</li><li>on-removeï¼šæ–‡ä»¶åˆ é™¤çš„é’©å­æ–¹æ³•ï¼Œfunction(file, fileList)</li><li>file-listï¼šæ–‡ä»¶åˆ—è¡¨ï¼Œæ­¤åˆ—è¡¨ä¸ºä¸Šä¼ æˆåŠŸ çš„æ–‡ä»¶</li><li>limitï¼šæœ€å¤§å…è®¸ä¸Šä¼ ä¸ªæ•°</li><li>on-exceedï¼šæ–‡ä»¶è¶…å‡ºä¸ªæ•°é™åˆ¶æ—¶çš„é’©å­ï¼Œæ–¹æ³•ä¸ºï¼šfunction(files, fileList)</li><li>dataï¼šæäº¤ä¸Šä¼ çš„é¢å¤–å‚æ•°ï¼Œéœ€è¦å°è£…ä¸ºjsonå¯¹è±¡ï¼Œæœ€ç»ˆæäº¤ç»™æœåŠ¡ç«¯ä¸ºkey/valueä¸²</li></ul><p><strong>2) æ•°æ®æ¨¡å‹</strong></p><div class="hljs"><pre><code class="hljs js">&lt;script&gt;  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> sysConfig <span class="hljs-keyword">from</span> <span class="hljs-string">'@/../config/sysConfig'</span>;  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> courseApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../api/course'</span>;  <span class="hljs-keyword">import</span> utilApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../../common/utils'</span>;  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> systemApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../../base/api/system'</span>;  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;    data() &#123;      <span class="hljs-keyword">return</span> &#123;        picmax:<span class="hljs-number">1</span>,        courseid:<span class="hljs-string">''</span>,        dialogImageUrl: <span class="hljs-string">''</span>,        dialogVisible: <span class="hljs-literal">false</span>,        fileList:[],        uploadval:&#123;<span class="hljs-attr">filetag</span>:<span class="hljs-string">"course"</span>&#125;,        imgUrl:sysConfig.imgUrl      &#125;    &#125;,    methods: &#123;      <span class="hljs-comment">//è¶…å‡ºæ–‡ä»¶ä¸Šä¼ ä¸ªæ•°æç¤ºä¿¡æ¯</span>      rejectupload()&#123;        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"æœ€å¤šä¸Šä¼ "</span>+<span class="hljs-keyword">this</span>.picmax+<span class="hljs-string">"ä¸ªå›¾ç‰‡"</span>);      &#125;,      <span class="hljs-comment">//åœ¨ä¸Šä¼ å‰è®¾ç½®ä¸Šä¼ è¯·æ±‚çš„æ•°æ®</span>      setuploaddata()&#123;      &#125;,      <span class="hljs-comment">//åˆ é™¤å›¾ç‰‡</span>      handleRemove(file, fileList) &#123;        <span class="hljs-built_in">console</span>.log(file)        alert(<span class="hljs-string">'åˆ é™¤'</span>)      &#125;,      <span class="hljs-comment">//ä¸Šä¼ æˆåŠŸçš„é’©å­æ–¹æ³•</span>      handleSuccess(response, file, fileList)&#123;        <span class="hljs-built_in">console</span>.log(response)        alert(<span class="hljs-string">'ä¸Šä¼ æˆåŠŸ'</span>)      &#125;,      <span class="hljs-comment">//ä¸Šä¼ å¤±è´¥æ‰§è¡Œçš„é’©å­æ–¹æ³•</span>      handleError(err, file, fileList)&#123;        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'ä¸Šä¼ å¤±è´¥'</span>);        <span class="hljs-comment">//æ¸…ç©ºæ–‡ä»¶é˜Ÿåˆ—</span>        <span class="hljs-keyword">this</span>.fileList = []      &#125;    &#125;,    mounted()&#123;      <span class="hljs-comment">//è¯¾ç¨‹id</span>      <span class="hljs-keyword">this</span>.courseid = <span class="hljs-keyword">this</span>.$route.params.courseid;    &#125;  &#125;&lt;<span class="hljs-regexp">/script&gt;</span></code></pre></div><h3 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h3><p>1ã€ç‚¹å‡»â€œåŠ å·â€æµ‹è¯•ä¸Šä¼ å›¾ç‰‡</p><p><a href="https://qnoss.codeyee.com/20200704_8/image18" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image18.png" srcset="/img/loading.gif" alt="img"></a></p><h1 id="ä¸‰ã€ä¿å­˜è¯¾ç¨‹å›¾ç‰‡"><a href="#ä¸‰ã€ä¿å­˜è¯¾ç¨‹å›¾ç‰‡" class="headerlink" title="ä¸‰ã€ä¿å­˜è¯¾ç¨‹å›¾ç‰‡"></a>ä¸‰ã€ä¿å­˜è¯¾ç¨‹å›¾ç‰‡</h1><h2 id="1-éœ€æ±‚åˆ†æ-1"><a href="#1-éœ€æ±‚åˆ†æ-1" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>å›¾ç‰‡ä¸Šä¼ åˆ°æ–‡ä»¶ç³»ç»Ÿåï¼Œå…¶å®ƒå­ç³»ç»Ÿå¦‚æœæƒ³ä½¿ç”¨å›¾ç‰‡å¯ä»¥å¼•ç”¨å›¾ç‰‡çš„åœ°å€ï¼Œè¯¾ç¨‹ç®¡ç†æ¨¡å—ä½¿ç”¨å›¾ç‰‡çš„æ–¹å¼æ˜¯å°†å›¾ç‰‡åœ°å€ä¿å­˜åˆ°è¯¾ç¨‹æ•°æ®åº“ä¸­ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_8/image19" target="_blank" rel="noopener"><img src="/2020/08/14/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday08/image19.png" srcset="/img/loading.gif" alt="img"></a></p><p>ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€ä¸Šä¼ å›¾ç‰‡åˆ°æ–‡ä»¶ç³»ç»ŸæœåŠ¡</p><p>2ã€ä¿å­˜å›¾ç‰‡åœ°å€åˆ°è¯¾ç¨‹ç®¡ç†æœåŠ¡åœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡åˆ›å»ºä¿å­˜è¯¾ç¨‹ä¸å›¾ç‰‡å¯¹åº”å…³ç³»çš„è¡¨ <code>course_pic</code>ã€‚</p><p>3ã€åœ¨ <code>course_pic</code> ä¿å­˜å›¾ç‰‡æˆåŠŸåæ–¹å¯æŸ¥è¯¢è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯ã€‚</p><p>é€šè¿‡æŸ¥è¯¢ <code>course_pic</code> è¡¨æ•°æ®åˆ™æŸ¥è¯¢åˆ°æŸè¯¾ç¨‹çš„å›¾ç‰‡ä¿¡æ¯ã€‚</p><h2 id="2-æ„å»ºæ¥å£"><a href="#2-æ„å»ºæ¥å£" class="headerlink" title="2. æ„å»ºæ¥å£"></a>2. æ„å»ºæ¥å£</h2><h3 id="1ã€API-æ¥å£"><a href="#1ã€API-æ¥å£" class="headerlink" title="1ã€API æ¥å£"></a>1ã€API æ¥å£</h3><p>åœ¨ <code>com.xuecheng.api.course</code> åŒ…ä¸‹åˆ›å»ºè¯¥æ¥å£</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"ä¿å­˜è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">saveCoursePic</span><span class="hljs-params">(String courseId, String pic)</span></span>;</code></pre></div><h3 id="2ã€Dao-å±‚"><a href="#2ã€Dao-å±‚" class="headerlink" title="2ã€Dao å±‚"></a>2ã€Dao å±‚</h3><p>ç”±äºæ˜¯å¯¹ <code>mysql</code> çš„å•è¡¨æ“ä½œï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡ç»§æ‰¿ spring data jpa æä¾›çš„æ¥å£æ¥å®ç° dao</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_course.dao;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseBase;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CoursePic;<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;<span class="hljs-comment">/**</span><span class="hljs-comment"> * Created by Administrator.</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CoursePicRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">CoursePic</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div><h3 id="3ã€Service-å±‚"><a href="#3ã€Service-å±‚" class="headerlink" title="3ã€Service å±‚"></a>3ã€Service å±‚</h3><p>åœ¨ <code>CourseService</code> ä¸‹æ–°å¢ <code>saveCoursePic</code> æ–¹æ³•</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ä¿å­˜è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯åˆ°æ•°æ®åº“</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId è¯¾ç¨‹id</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pic å›¾ç‰‡id</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Transactional</span>  <span class="hljs-comment">//Mysqlæ“ä½œéœ€è¦æ·»åŠ åˆ°Springäº‹åŠ¡</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">saveCoursePic</span><span class="hljs-params">(String courseId, String pic)</span> </span>&#123;    CoursePic coursePic = <span class="hljs-keyword">null</span>;    <span class="hljs-comment">//åˆ¤æ–­è¯¥è¯¾ç¨‹idæ˜¯å¦å·²ç»å­˜åœ¨å›¾ç‰‡</span>    Optional&lt;CoursePic&gt; byId = coursePicRepository.findById(courseId);    <span class="hljs-keyword">if</span>(byId.isPresent())&#123;        coursePic = byId.get();    &#125;    <span class="hljs-comment">//ä¸å­˜åœ¨åˆ™é‡æ–°åˆ›å»ºä¸€ä¸ªè¯¾ç¨‹å›¾ç‰‡å¯¹è±¡å¹¶ä¿å­˜ä¿¡æ¯</span>    <span class="hljs-keyword">if</span>(coursePic == <span class="hljs-keyword">null</span>)&#123;        coursePic = <span class="hljs-keyword">new</span> CoursePic();    &#125;    coursePic.setCourseid(courseId);    coursePic.setPic(pic);    CoursePic save = coursePicRepository.save(coursePic);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);&#125;</code></pre></div><h3 id="4ã€Controller-å±‚"><a href="#4ã€Controller-å±‚" class="headerlink" title="4ã€Controller å±‚"></a>4ã€Controller å±‚</h3><p>åœ¨ <code>CourseContorller</code> ä¸‹æ–°å¢ <code>saveCoursePic</code> æ–¹æ³•</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ä¿å­˜è¯¾ç¨‹ä¿¡æ¯ä¸å›¾ç‰‡çš„å¯¹åº”å…³ç³»</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId è¯¾ç¨‹id</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pic å›¾ç‰‡æ–‡ä»¶id</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Override</span><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/coursepic/add"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">saveCoursePic</span><span class="hljs-params">(@RequestParam(<span class="hljs-string">"courseId"</span>)</span> String courseId, @<span class="hljs-title">RequestParam</span><span class="hljs-params">(<span class="hljs-string">"pic"</span>)</span> String pic) </span>&#123;    <span class="hljs-keyword">return</span> courseService.saveCoursePic(courseId,pic);&#125;</code></pre></div><h2 id="3-å‰ç«¯é…ç½®"><a href="#3-å‰ç«¯é…ç½®" class="headerlink" title="3. å‰ç«¯é…ç½®"></a>3. å‰ç«¯é…ç½®</h2><h3 id="1ã€éœ€æ±‚-1"><a href="#1ã€éœ€æ±‚-1" class="headerlink" title="1ã€éœ€æ±‚"></a>1ã€éœ€æ±‚</h3><p>å‰ç«¯éœ€è¦åœ¨ä¸Šä¼ å›¾ç‰‡æˆåŠŸåä¿å­˜è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯ã€‚</p><h3 id="2ã€é¡µé¢-1"><a href="#2ã€é¡µé¢-1" class="headerlink" title="2ã€é¡µé¢"></a>2ã€é¡µé¢</h3><p>åœ¨ course.js ä¸‹åˆ›å»º <code>ajax</code> è¯·æ±‚çš„ api</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä¿å­˜è¯¾ç¨‹å›¾ç‰‡åœ°å€åˆ°è¯¾ç¨‹æ•°æ® åº“</span>export <span class="hljs-keyword">const</span> addCoursePic= (courseId,pic) =&gt; &#123;  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/course/coursepic/add?courseId='</span>+courseId+<span class="hljs-string">"&amp;pic="</span>+pic)&#125;</code></pre></div><p>el-upload ç»„ä»¶åœ¨ä¸Šä¼ æˆåŠŸåï¼Œä¼šè°ƒç”¨ä¸Šä¼ æˆåŠŸçš„é’©å­æ–¹æ³•ï¼Œé…ç½®å¦‚ <code>:on-success=&quot;handleSuccess&quot;</code></p><p>é’©å­æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä¸Šä¼ æˆåŠŸçš„é’©å­æ–¹æ³•</span>handleSuccess(response, file, fileList)&#123;    console.log(response)    <span class="hljs-comment">//è°ƒç”¨è¯¾ç¨‹ç®¡ç†çš„ä¿å­˜å›¾ç‰‡æ¥å£ï¼Œå°†å›¾ç‰‡ä¿¡æ¯ä¿å­˜åˆ°è¯¾ç¨‹ç®¡ç†æ•°æ®åº“course_picä¸­</span>    <span class="hljs-comment">//ä»responseå¾—åˆ°æ–°çš„å›¾ç‰‡æ–‡ä»¶çš„åœ°å€</span>    <span class="hljs-keyword">if</span>(response.success)&#123;        let fileId = response.fileSystem.fileId;        courseApi.addCoursePic(<span class="hljs-keyword">this</span>.courseid,fileId).then(res=&gt;&#123;            <span class="hljs-keyword">if</span>(res.success)&#123;                <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">"å›¾ç‰‡ä¸Šä¼ æˆåŠŸ"</span>)            &#125;<span class="hljs-keyword">else</span>&#123;                <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"å›¾ç‰‡ä¿å­˜å¤±è´¥!"</span>)            &#125;        &#125;)    &#125;&#125;,</code></pre></div><h3 id="3ã€æµ‹è¯•-1"><a href="#3ã€æµ‹è¯•-1" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h3><p>ä¸Šä¼ æˆåŠŸ</p><p><a href="https://qnoss.codeyee.com/20200704_8/image20" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_8/image20" srcset="/img/loading.gif" alt="img"></a></p><h1 id="å››ã€å›¾ç‰‡ä¿¡æ¯æŸ¥è¯¢"><a href="#å››ã€å›¾ç‰‡ä¿¡æ¯æŸ¥è¯¢" class="headerlink" title="å››ã€å›¾ç‰‡ä¿¡æ¯æŸ¥è¯¢"></a>å››ã€å›¾ç‰‡ä¿¡æ¯æŸ¥è¯¢</h1><h2 id="1-éœ€æ±‚åˆ†æ-2"><a href="#1-éœ€æ±‚åˆ†æ-2" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åœ¨è¿›å…¥åˆ° è¯¾ç¨‹å›¾ç‰‡ é¡µé¢ä¹‹å‰ï¼Œæ ¹æ®å½“å‰è¯¾ç¨‹çš„idï¼Œæ‰¾åˆ°è¯¥è¯¾ç¨‹å¯¹åº”çš„è¯¾ç¨‹å›¾ç‰‡ã€‚</p><h2 id="2-æ„å»ºæ¥å£-1"><a href="#2-æ„å»ºæ¥å£-1" class="headerlink" title="2. æ„å»ºæ¥å£"></a>2. æ„å»ºæ¥å£</h2><h3 id="1ã€API-æ¥å£-1"><a href="#1ã€API-æ¥å£-1" class="headerlink" title="1ã€API æ¥å£"></a>1ã€API æ¥å£</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è·å¾—è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePic <span class="hljs-title">getCoursePic</span><span class="hljs-params">(String courseId)</span></span>;</code></pre></div><h3 id="2ã€Dao-å±‚-1"><a href="#2ã€Dao-å±‚-1" class="headerlink" title="2ã€Dao å±‚"></a>2ã€Dao å±‚</h3><p><code>CoursePicRepository</code> ï¼Œåœ¨ç¼–å†™ä¿å­˜åŠŸèƒ½æ—¶å·²æ„å»ºã€‚</p><h3 id="3ã€Service-å±‚-1"><a href="#3ã€Service-å±‚-1" class="headerlink" title="3ã€Service å±‚"></a>3ã€Service å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ ¹æ®è¯¾ç¨‹idè·å¾—è¯¾ç¨‹çš„å›¾ç‰‡ä¿¡æ¯</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Transactional</span> <span class="hljs-comment">//Mysqlæ“ä½œéœ€è¦æ·»åŠ åˆ°Springäº‹åŠ¡</span><span class="hljs-function"><span class="hljs-keyword">public</span> CoursePic <span class="hljs-title">getCoursePic</span><span class="hljs-params">(String courseId)</span> </span>&#123;    Optional&lt;CoursePic&gt; byId = coursePicRepository.findById(courseId);    <span class="hljs-keyword">if</span>(byId.isPresent())&#123;        CoursePic coursePic = byId.get();        <span class="hljs-keyword">return</span> coursePic;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;&#125;</code></pre></div><h3 id="4ã€Controller-å±‚-1"><a href="#4ã€Controller-å±‚-1" class="headerlink" title="4ã€Controller å±‚"></a>4ã€Controller å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ ¹æ®è¯¾ç¨‹idè·å–è¯¥è¯¾ç¨‹çš„è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> ç”±äºè¿™é‡Œæ¯ä¸ªè¯¾ç¨‹åªæœ‰ä¸€ä¸ªå›¾ç‰‡ï¼Œæ‰€ä»¥åªè¿”å›ä¸€ä¸ª CoursePic å¯¹è±¡</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Override</span><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/coursepic/get/&#123;courseId&#125;"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePic <span class="hljs-title">getCoursePic</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"courseId"</span>)</span> String courseId) </span>&#123;    <span class="hljs-keyword">return</span> courseService.getCoursePic(courseId);&#125;</code></pre></div><h3 id="5ã€æµ‹è¯•"><a href="#5ã€æµ‹è¯•" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><p><a href="https://qnoss.codeyee.com/20200704_8/image21" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_8/image21" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-å‰ç«¯é…ç½®-1"><a href="#3-å‰ç«¯é…ç½®-1" class="headerlink" title="3. å‰ç«¯é…ç½®"></a>3. å‰ç«¯é…ç½®</h2><h3 id="1ã€éœ€æ±‚-2"><a href="#1ã€éœ€æ±‚-2" class="headerlink" title="1ã€éœ€æ±‚"></a>1ã€éœ€æ±‚</h3><p>åœ¨è¯¾ç¨‹å›¾ç‰‡é¡µé¢çš„ <code>mounted</code> é’©å­æ–¹æ³• ä¸­æŸ¥è¯¢è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯ï¼Œå¹¶å°†å›¾ç‰‡åœ°å€èµ‹å€¼ç»™æ•°æ®å¯¹è±¡</p><h3 id="2ã€é¡µé¢-2"><a href="#2ã€é¡µé¢-2" class="headerlink" title="2ã€é¡µé¢"></a>2ã€é¡µé¢</h3><p>API æ¥å£</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹å›¾ç‰‡</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> findCoursePicList = <span class="hljs-function"><span class="hljs-params">courseId</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl+<span class="hljs-string">'/course/coursepic/get/'</span>+courseId)&#125;</code></pre></div><p>é’©å­å‡½æ•°</p><div class="hljs"><pre><code class="hljs js">mounted()&#123;  <span class="hljs-comment">//è¯¾ç¨‹id</span>  <span class="hljs-keyword">this</span>.courseid = <span class="hljs-keyword">this</span>.$route.params.courseid;  <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹</span>  courseApi.findCoursePicList(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;      <span class="hljs-keyword">if</span>(res &amp;&amp; res.pic)&#123;          <span class="hljs-keyword">let</span> imgUrl = <span class="hljs-keyword">this</span>.imgUrl+res.pic;          <span class="hljs-comment">//å°†å›¾ç‰‡åœ°å€è®¾ç½®åˆ°</span>        <span class="hljs-keyword">this</span>.fileList.push(&#123;<span class="hljs-attr">name</span>:<span class="hljs-string">'pic'</span>,<span class="hljs-attr">url</span>:imgUrl,<span class="hljs-attr">fileId</span>:res.pic&#125;)      &#125;  &#125;)&#125;</code></pre></div><h3 id="3ã€æµ‹è¯•-2"><a href="#3ã€æµ‹è¯•-2" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h3><p>åˆ«å¿˜äº†å¯åŠ¨ nginx ï¼Œè¿™é‡Œæ˜¯é€šè¿‡ img.xuecheng.com è®¿é—®å›¾ç‰‡ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_8/image22" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_8/image22" srcset="/img/loading.gif" alt="img"></a></p><h1 id="äº”ã€è¯¾ç¨‹å›¾ç‰‡åˆ é™¤"><a href="#äº”ã€è¯¾ç¨‹å›¾ç‰‡åˆ é™¤" class="headerlink" title="äº”ã€è¯¾ç¨‹å›¾ç‰‡åˆ é™¤"></a>äº”ã€è¯¾ç¨‹å›¾ç‰‡åˆ é™¤</h1><h2 id="1-éœ€æ±‚åˆ†æ-3"><a href="#1-éœ€æ±‚åˆ†æ-3" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><h2 id="2-æ„å»ºæ¥å£-2"><a href="#2-æ„å»ºæ¥å£-2" class="headerlink" title="2. æ„å»ºæ¥å£"></a>2. æ„å»ºæ¥å£</h2><h3 id="1ã€API-æ¥å£-2"><a href="#1ã€API-æ¥å£-2" class="headerlink" title="1ã€API æ¥å£"></a>1ã€API æ¥å£</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"åˆ é™¤è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">deleteCoursePic</span><span class="hljs-params">(String courseId)</span></span>;</code></pre></div><h3 id="2ã€Dao-å±‚-2"><a href="#2ã€Dao-å±‚-2" class="headerlink" title="2ã€Dao å±‚"></a>2ã€Dao å±‚</h3><p><code>JPA</code> è‡ªå¸¦çš„ <code>deleteById</code> æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦åœ¨ Dao é‡Œé¢å†å®šä¹‰ä¸€ä¸ª deleteByCourseid æ–¹æ³•ï¼Œåˆ é™¤åè¿”å›å½±å“çš„è¡Œæ•°ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_course.dao;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseBase;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CoursePic;<span class="hljs-keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;<span class="hljs-comment">/**</span><span class="hljs-comment"> * Created by Administrator.</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CoursePicRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">CoursePic</span>,<span class="hljs-title">String</span>&gt; </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æ ¹æ®è¯¾ç¨‹idåˆ é™¤å›¾ç‰‡ä¿¡æ¯</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> è¿”å›åˆ é™¤å½±å“çš„è¡Œ,å°äº1åˆ™è¡¨ç¤ºåˆ é™¤å¤±è´¥</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">deleteByCourseid</span><span class="hljs-params">(String courseId)</span></span>;&#125;</code></pre></div><h3 id="3ã€Service-å±‚-2"><a href="#3ã€Service-å±‚-2" class="headerlink" title="3ã€Service å±‚"></a>3ã€Service å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ é™¤è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Transactional</span> <span class="hljs-comment">//Mysqlæ“ä½œéœ€è¦æ·»åŠ åˆ°Springäº‹åŠ¡</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">deleteCoursePic</span><span class="hljs-params">(String courseId)</span> </span>&#123;    <span class="hljs-keyword">long</span> byCourseid = coursePicRepository.deleteByCourseid(courseId);    <span class="hljs-keyword">if</span>(byCourseid &gt; <span class="hljs-number">0</span>)&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.FAIL);&#125;</code></pre></div><h3 id="4ã€Controller-å±‚-2"><a href="#4ã€Controller-å±‚-2" class="headerlink" title="4ã€Controller å±‚"></a>4ã€Controller å±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ é™¤è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@Override</span><span class="hljs-meta">@DeleteMapping</span>(<span class="hljs-string">"/coursepic/delete"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">deleteCoursePic</span><span class="hljs-params">(@RequestParam(<span class="hljs-string">"courseId"</span>)</span> String courseId) </span>&#123;    <span class="hljs-keyword">return</span> courseService.deleteCoursePic(courseId);&#125;</code></pre></div><h3 id="5ã€æµ‹è¯•-1"><a href="#5ã€æµ‹è¯•-1" class="headerlink" title="5ã€æµ‹è¯•"></a>5ã€æµ‹è¯•</h3><p><a href="https://qnoss.codeyee.com/20200704_8/image23" target="_blank" rel="noopener"><img src="https://qnoss.codeyee.com/20200704_8/image23" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-å‰ç«¯é…ç½®-2"><a href="#3-å‰ç«¯é…ç½®-2" class="headerlink" title="3. å‰ç«¯é…ç½®"></a>3. å‰ç«¯é…ç½®</h2><h3 id="1ã€éœ€æ±‚-3"><a href="#1ã€éœ€æ±‚-3" class="headerlink" title="1ã€éœ€æ±‚"></a>1ã€éœ€æ±‚</h3><h3 id="2ã€é¡µé¢-3"><a href="#2ã€é¡µé¢-3" class="headerlink" title="2ã€é¡µé¢"></a>2ã€é¡µé¢</h3><p>api æ¥å£</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//åˆ é™¤è¯¾ç¨‹å›¾ç‰‡</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> deleteCoursePic= <span class="hljs-function"><span class="hljs-params">courseId</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestDelete(apiUrl+<span class="hljs-string">'/course/coursepic/delete?courseId='</span>+courseId)&#125;</code></pre></div><p>before-removeé’©å­æ–¹æ³•</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€upload</span></span><span class="hljs-tag">  <span class="hljs-attr">action</span>=<span class="hljs-string">"/filesystem/upload"</span></span><span class="hljs-tag">  <span class="hljs-attr">list</span>â€<span class="hljs-attr">type</span>=<span class="hljs-string">"pictureâ€card"</span></span><span class="hljs-tag">  <span class="hljs-attr">:before</span>â€<span class="hljs-attr">remove</span>=<span class="hljs-string">"handleRemove"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"elâ€iconâ€plus"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€upload</span>&gt;</span></code></pre></div><p>åœ¨uploadç»„ä»¶çš„ <code>before-remove</code>é’©å­æ–¹æ³• ä¸­å®ç°åˆ é™¤åŠ¨ä½œã€‚</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//åˆ é™¤å›¾ç‰‡</span>handleRemove(file, fileList) &#123;  <span class="hljs-built_in">console</span>.log(file)  <span class="hljs-comment">//è°ƒç”¨æœåŠ¡ç«¯å»åˆ é™¤è¯¾ç¨‹å›¾ç‰‡ä¿¡æ¯ï¼Œå¦‚æœè¿”å›falseï¼Œå‰ç«¯åœæ­¢åˆ é™¤</span>  <span class="hljs-comment">//å¼‚æ­¥è°ƒç”¨</span>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,rejct</span>)=&gt;</span>&#123;    courseApi.deleteCoursePic(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;      <span class="hljs-keyword">if</span>(res.success)&#123;          <span class="hljs-comment">//æˆåŠŸ</span>        resolve()      &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"åˆ é™¤å¤±è´¥"</span>);          <span class="hljs-comment">//å¤±è´¥</span>        rejct()      &#125;    &#125;)  &#125;)&#125;,</code></pre></div><p><code>before-remove</code> è¯´æ˜ï¼šåˆ é™¤æ–‡ä»¶ä¹‹å‰çš„é’©å­ï¼Œå‚æ•°ä¸ºä¸Šä¼ çš„æ–‡ä»¶å’Œæ–‡ä»¶åˆ—è¡¨ï¼Œè‹¥è¿”å› <code>false</code> æˆ–è€…è¿”å› <code>Promise</code> ä¸”è¢« <code>reject</code>ï¼Œåˆ™åœæ­¢åˆ é™¤ã€‚</p><h3 id="3ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-promiseï¼Ÿ"><a href="#3ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-promiseï¼Ÿ" class="headerlink" title="3ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ promiseï¼Ÿ"></a>3ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ promiseï¼Ÿ</h3><p>åœ¨ <code>handleRemove</code> æ–¹æ³•è°ƒç”¨åˆ é™¤å›¾ç‰‡çš„ <code>api</code> æ–¹æ³•ï¼Œåˆ é™¤æˆåŠŸæ—¶ return trueï¼Œåˆ é™¤å¤±è´¥æ—¶return false;</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// åˆ é™¤å›¾ç‰‡</span>handleRemove(file, fileList) &#123;    <span class="hljs-built_in">console</span>.log(file)    <span class="hljs-comment">//        alert('åˆ é™¤')</span>    <span class="hljs-comment">//        return true;</span>    <span class="hljs-comment">//åˆ é™¤å›¾ç‰‡</span>    courseApi.deleteCoursePic(<span class="hljs-string">'1'</span>).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;        <span class="hljs-keyword">if</span>(res.success)&#123;            <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">'åˆ é™¤æˆåŠŸ'</span>);            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;        &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-keyword">this</span>.$message.error(res.message);            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        &#125;    &#125;);&#125;,</code></pre></div><p>åœ¨ä¸Šè¾¹ä»£ç ä¸­å°†æäº¤çš„è¯¾ç¨‹ id æ•…æ„å†™é”™ï¼ŒæŒ‰ç…§æˆ‘ä»¬é¢„æœŸåº”è¯¥æ˜¯åˆ é™¤å¤±è´¥ï¼Œè€Œæµ‹è¯•ç»“æœå´æ˜¯å›¾ç‰‡åœ¨é¡µé¢ä¸Šåˆ é™¤æˆåŠŸã€‚</p><p><strong>é—®é¢˜åŸå› ï¼š</strong></p><p>é€šè¿‡æŸ¥è¯¢ <code>deleteCoursePic</code> æ–¹æ³•çš„åº•å±‚ä»£ç ï¼Œ<code>deleteCoursePic</code> æœ€ç»ˆè¿”å›ä¸€ä¸ª <code>promise</code> å¯¹è±¡ã€‚</p><p>Promise æ˜¯ES6æä¾›çš„ç”¨äºå¼‚æ­¥å¤„ç†çš„å¯¹è±¡ï¼Œå› ä¸ºaxiosæäº¤æ˜¯å¼‚æ­¥æäº¤ï¼Œè¿™é‡Œä½¿ç”¨promiseä½œä¸ºè¿”å›å€¼</p><p><strong>Promiseçš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</strong></p><p>Promiseå¯¹è±¡åœ¨å¤„ç†è¿‡ç¨‹ä¸­æœ‰ä¸‰ç§çŠ¶æ€ï¼š</p><ul><li>pendingï¼šè¿›è¡Œä¸­</li><li>resolvedï¼šæ“ä½œæˆåŠŸ</li><li>rejected: æ“ä½œå¤±è´¥</li></ul><p>Promiseçš„æ„å»ºæ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">resolve,reject</span>)</span>&#123;     <span class="hljs-comment">//...TODO...</span>    <span class="hljs-keyword">if</span>(æ“ä½œæˆåŠŸ)&#123;        resolve(value);    &#125;<span class="hljs-keyword">else</span>&#123;        reject(error);    &#125;&#125;)</code></pre></div><p>ä¸Šè¾¹çš„æ„é€ æ–¹æ³•function(resolve,reject)æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>1ï¼‰æ–¹æ³•æ‰§è¡Œä¸€äº›ä¸šåŠ¡é€»è¾‘ã€‚</p><p>2ï¼‰å¦‚æœæ“ä½œæˆåŠŸå°† <code>Promise</code> çš„çŠ¶æ€ç”± <code>pending</code> å˜ä¸º <code>resolved</code>ï¼Œå¹¶å°†æ“ä½œç»“æœä¼ å‡ºå»</p><p>3ï¼‰å¦‚æœæ“ä½œå¤±è´¥ä¼šå°† <code>promise</code> çš„çŠ¶æ€ç”± <code>pending</code> å˜ä¸º <code>rejected</code>ï¼Œå¹¶å°†å¤±è´¥ç»“æœä¼ å‡ºå»ã€‚<br>ä¸Šè¾¹è¯´çš„æ“ä½œæˆåŠŸå°†æ“ä½œç»“æœä¼ ç»™è°äº†å‘¢ï¼Ÿæ“ä½œå¤±è´¥å°†å¤±è´¥ç»“æœä¼ ç»™è°äº†å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ promise çš„ <code>then</code>ã€<code>catch</code> æ¥æŒ‡å®šï¼š</p><div class="hljs"><pre><code class="hljs js">promise.then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æ“ä½œæˆåŠŸï¼š'</span> + result);&#125;);promise.catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>&#123;    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'æ“ä½œå¤±è´¥ï¼š'</span> + reason);&#125;);</code></pre></div><p>ä¾‹å­å¦‚ä¸‹ï¼š</p><p>1ã€å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¿”å› <code>promise</code> å¯¹è±¡</p><div class="hljs"><pre><code class="hljs js">testpromise(i)&#123;  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>&#123;    <span class="hljs-keyword">if</span>(i % <span class="hljs-number">2</span>==<span class="hljs-number">0</span>)&#123;      resolve(<span class="hljs-string">'æˆåŠŸäº†'</span>)    &#125;<span class="hljs-keyword">else</span>&#123;      reject(<span class="hljs-string">'æ‹’ç»äº†'</span>)    &#125;  &#125;)&#125;</code></pre></div><p>2ã€è°ƒç”¨æ­¤æ–¹æ³•</p><p>å‘æ–¹æ³•ä¼ å…¥å¶æ•°ã€å¥‡æ•°è¿›è¡Œæµ‹è¯•ã€‚</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">this</span>.testpromise(<span class="hljs-number">3</span>).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<span class="hljs-comment">// åœ¨thenä¸­å¯¹æˆåŠŸç»“æœè¿›è¡Œå¤„ç†</span>    alert(res)&#125;).catch(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;<span class="hljs-comment">//åœ¨catchä¸­å¯¹æ“ä½œå¤±è´¥ç»“æœè¿›è¡Œå¤„ç†</span>    alert(res)&#125;)</code></pre></div><p>3ã€æœ€ç»ˆå°† <code>handleRemove</code> æ–¹æ³•ä¿®æ”¹å¦‚ä¸‹</p><p><code>handleRemove</code> æ–¹æ³•è¿”å› <code>promise</code> å¯¹è±¡ï¼Œå½“åˆ é™¤æˆåŠŸåˆ™ <code>resolve</code>ï¼Œåˆ é™¤å¤±è´¥åˆ™ <code>reject</code>ã€‚</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// åˆ é™¤å›¾ç‰‡</span>handleRemove(file, fileList) &#123;    <span class="hljs-built_in">console</span>.log(file)    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve,reject</span>)=&gt;</span>&#123;        <span class="hljs-comment">//åˆ é™¤å›¾ç‰‡</span> courseApi.deleteCoursePic(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;            <span class="hljs-keyword">if</span>(res.success)&#123;                <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">'åˆ é™¤æˆåŠŸ'</span>);                resolve()<span class="hljs-comment">//é€šè¿‡</span>            &#125;<span class="hljs-keyword">else</span>&#123;                <span class="hljs-keyword">this</span>.$message.error(res.message);                reject()<span class="hljs-comment">//æ‹’ç»</span>            &#125;        &#125;);    &#125;)&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>FastDFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day07ï¼šè¯¾ç¨‹ç®¡ç†å®æˆ˜</title>
    <link href="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/"/>
    <url>/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day07</code> çš„å†…å®¹</p><ul><li>å¯¹è¯¾ç¨‹ç®¡ç†çš„CRUD</li><li>çº§è”èœå•</li><li>ä½¿ç”¨ <code>mongoDB</code> å‚¨å­˜æ•°æ®å­—å…¸</li></ul><h1 id="ä¸€ã€è¯¾ç¨‹æŸ¥è¯¢"><a href="#ä¸€ã€è¯¾ç¨‹æŸ¥è¯¢" class="headerlink" title="ä¸€ã€è¯¾ç¨‹æŸ¥è¯¢"></a>ä¸€ã€è¯¾ç¨‹æŸ¥è¯¢</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>è¯¾ç¨‹æ·»åŠ å®Œæˆåå¯é€šè¿‡æˆ‘çš„è¯¾ç¨‹è¿›å…¥è¯¾ç¨‹ä¿®æ”¹é¡µé¢ï¼Œæ­¤é¡µé¢æ˜¾ç¤ºæˆ‘çš„è¯¾ç¨‹åˆ—è¡¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯åˆ†é¡µæŸ¥è¯¢ã€‚</p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image1.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image1.png" srcset="/img/loading.gif" alt="image-20200403212250200"></a></p><p>ä¸Šè¾¹çš„æŸ¥è¯¢è¦å®ç°åˆ†é¡µã€ä¼šå­˜åœ¨å¤šè¡¨å…³è”æŸ¥è¯¢ï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨mybatiså®ç°æˆ‘çš„è¯¾ç¨‹æŸ¥è¯¢ã€‚</p><h2 id="2-å®šä¹‰APIæ¥å£"><a href="#2-å®šä¹‰APIæ¥å£" class="headerlink" title="2. å®šä¹‰APIæ¥å£"></a>2. å®šä¹‰APIæ¥å£</h2><p><strong>è¾“å…¥å‚æ•°</strong>ï¼šé¡µç ã€æ¯é¡µæ˜¾ç¤ºä¸ªæ•°ã€æŸ¥è¯¢æ¡ä»¶</p><p><strong>è¾“å‡ºç»“æœç±»å‹</strong>ï¼šQueryResponseResult&lt;è‡ªå®šä¹‰ç±»å‹&gt;ï¼Œåœ¨ <code>api</code> å·¥ç¨‹åˆ›å»º <code>course</code> åŒ…ï¼Œåˆ›å»º<code>CourseControllerApi</code> æ¥å£ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Api</span>(value=<span class="hljs-string">"è¯¾ç¨‹ç®¡ç†API"</span>,description = <span class="hljs-string">"ç”¨äºå¯¹è¯¾ç¨‹çš„å¢åˆ æŸ¥æ”¹"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseControllerApi</span> </span>&#123;<span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"åˆ†é¡µæŸ¥è¯¢è¯¾ç¨‹åˆ—è¡¨"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findCourseList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, CourseListRequest courseListRequest)</span></span>;&#125;</code></pre></div><h2 id="3-è¯¾ç¨‹ç®¡ç†æœåŠ¡"><a href="#3-è¯¾ç¨‹ç®¡ç†æœåŠ¡" class="headerlink" title="3. è¯¾ç¨‹ç®¡ç†æœåŠ¡"></a>3. è¯¾ç¨‹ç®¡ç†æœåŠ¡</h2><h3 id="PageHelper"><a href="#PageHelper" class="headerlink" title="PageHelper"></a>PageHelper</h3><p><code>PageHelper</code> æ˜¯ <code>mybatis</code> çš„é€šç”¨åˆ†é¡µæ’ä»¶ï¼Œé€šè¿‡ <code>mybatis</code> çš„æ‹¦æˆªå™¨å®ç°åˆ†é¡µåŠŸèƒ½ï¼Œæ‹¦æˆªsqlæŸ¥è¯¢è¯·æ±‚ï¼Œæ·»åŠ åˆ†é¡µè¯­å¥ï¼Œæœ€ç»ˆå®ç°åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½ã€‚</p><p>æˆ‘çš„è¯¾ç¨‹å…·æœ‰åˆ†é¡µåŠŸèƒ½ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨ <code>Pagehelper</code> å®ç° <code>Mybatis</code> åˆ†é¡µåŠŸèƒ½å¼€å‘ï¼Œç”±äºæœ¬é¡¹ç›®ä½¿ç”¨ <code>springboot</code> å¼€å‘ï¼Œåœ¨ <code>springboot</code> ä¸Šé›†æˆ <code>pagehelper</code>ï¼ˆ<a href="https://github.com/pagehelper/pagehelper-spring-boot%EF%BC%89" target="_blank" rel="noopener">https://github.com/pagehelper/pagehelper-spring-bootï¼‰</a><code>PageHelper</code> çš„ä½¿ç”¨æ–¹æ³•åŠåŸç†å¦‚ä¸‹ï¼š</p><ul><li>åœ¨è°ƒç”¨ <code>dao</code> çš„ <code>service</code> æ–¹æ³•ä¸­è®¾ç½®åˆ†é¡µå‚æ•°ï¼š<strong>PageHelper.startPage(page, size)</strong>ï¼Œåˆ†é¡µå‚æ•°ä¼šè®¾ç½®åœ¨ <code>ThreadLocal</code> ä¸­</li><li><code>PageHelper</code> åœ¨ <code>mybatis</code> æ‰§è¡Œ <code>sql</code> å‰è¿›è¡Œæ‹¦æˆªï¼Œä» <code>ThreadLocal</code> å–å‡ºåˆ†é¡µå‚æ•°ï¼Œä¿®æ”¹å½“å‰æ‰§è¡Œçš„ <code>sql</code> è¯­å¥ï¼Œæ·»åŠ åˆ†é¡µ <code>sql</code>ã€‚</li><li>æœ€åæ‰§è¡Œæ·»åŠ äº†åˆ†é¡µ<code>sql</code>çš„ <code>sql</code>è¯­å¥ï¼Œå®ç°åˆ†é¡µæŸ¥è¯¢ã€‚</li></ul><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image2.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image2.png" srcset="/img/loading.gif" alt="image-20200403213815138"></a></p><p>1ï¼‰æ·»åŠ ä¾èµ–</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.pagehelper<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>pagehelperâ€springâ€bootâ€starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>2ï¼‰é…ç½®pageHelper</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">pagehelper:</span>  <span class="hljs-string">helperâ€dialect:</span> <span class="hljs-string">mysql</span></code></pre></div><h3 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h3><p>1ï¼‰mapper æ¥å£</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.github.pagehelper.Page;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseBase;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.ext.CourseInfo;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.request.CourseListRequest;<span class="hljs-keyword">import</span> org.apache.ibatis.annotations.Mapper;<span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseMapper</span> </span>&#123;    <span class="hljs-function">CourseBase <span class="hljs-title">findCourseBaseById</span><span class="hljs-params">(String id)</span></span>;    <span class="hljs-function">Page&lt;CourseInfo&gt; <span class="hljs-title">findCourseListPage</span><span class="hljs-params">(CourseListRequest courseListRequest)</span></span>;&#125;</code></pre></div><p>2ï¼‰mapper.xmlæ˜ å°„æ–‡ä»¶</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findCourseListPage"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.ext.CourseInfo"</span></span><span class="hljs-tag">        <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.request.CourseListRequest"</span>&gt;</span>    SELECT    course_base.*,    (SELECT pic FROM course_pic WHERE courseid = course_base.id) pic    FROM    course_base<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span></code></pre></div><ol><li>æµ‹è¯•dao</li></ol><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æµ‹è¯•åˆ†é¡µ</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testPageHelper</span><span class="hljs-params">()</span></span>&#123;    PageHelper.startPage(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>);    CourseListRequest courseListRequest = <span class="hljs-keyword">new</span> CourseListRequest();    Page&lt;CourseInfo&gt; courseListPage = courseMapper.findCourseListPage(courseListRequest);    List&lt;CourseInfo&gt; result = courseListPage.getResult();    System.out.println(courseListPage);&#125;</code></pre></div><p>æµ‹è¯•å‰ä¿®æ”¹æ—¥å¿—çº§åˆ«ä¸ºdebugï¼Œå¹¶è·Ÿè¸ªè¿è¡Œæ—¥å¿—ï¼Œå‘ç°sqlè¯­å¥ä¸­å·²ç»åŒ…æ‹¬åˆ†é¡µè¯­å¥ã€‚</p><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>å®šä¹‰CourseService.javaç±»ï¼Œç”¨äºè¯¾ç¨‹ç®¡ç†çš„serviceå®šä¹‰ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">     * åˆ†é¡µæŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> page</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> size</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseListRequest</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Transactional</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findCourseList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, CourseListRequest courseListRequest)</span></span>&#123;        <span class="hljs-keyword">if</span> (page &lt;= <span class="hljs-number">0</span>)&#123;            page = <span class="hljs-number">1</span>;        &#125;        <span class="hljs-keyword">if</span> (size &lt;= <span class="hljs-number">0</span>)&#123;            size = <span class="hljs-number">4</span>;        &#125;        <span class="hljs-keyword">if</span>(courseListRequest == <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;        &#125;        <span class="hljs-keyword">if</span> (courseListRequest.getCompanyId() == <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-comment">//æ²¡è¾“å…¥å…¬å¸idé»˜è®¤ä¸º1</span>            courseListRequest.setCompanyId(<span class="hljs-string">"1"</span>);        &#125;        PageHelper.startPage(<span class="hljs-number">1</span>,<span class="hljs-number">7</span>);        Page&lt;CourseInfo&gt; courseInfos = courseMapper.findCoursePageList(courseListRequest);        <span class="hljs-keyword">long</span> total = courseInfos.getTotal();        List&lt;CourseInfo&gt; result = courseInfos.getResult();        QueryResult queryResult = <span class="hljs-keyword">new</span> QueryResult();        queryResult.setTotal(total);        queryResult.setList(result);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult(CommonCode.SUCCESS,queryResult);    &#125;</code></pre></div><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/course"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CourseControllerApi</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CourseService courseService;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/coursebase/list/&#123;page&#125;/&#123;size&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult&lt;CourseInfo&gt; <span class="hljs-title">findCourseList</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">            @PathVariable(<span class="hljs-string">"page"</span>)</span> <span class="hljs-keyword">int</span> page,</span><span class="hljs-function">            @<span class="hljs-title">PathVariable</span><span class="hljs-params">(<span class="hljs-string">"size"</span>)</span> <span class="hljs-keyword">int</span> size,</span><span class="hljs-function">            CourseListRequest courseListRequest) </span>&#123;        <span class="hljs-keyword">return</span> courseService.findCourseList(page,size,courseListRequest);    &#125;&#125;</code></pre></div><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ä½¿ç”¨ <code>postman</code> æˆ– <code>swagger-ui</code> æµ‹è¯•è¯¾ç¨‹åˆ—è¡¨æ¥å£ã€‚</p><h2 id="4-å‰ç«¯å¼€å‘"><a href="#4-å‰ç«¯å¼€å‘" class="headerlink" title="4. å‰ç«¯å¼€å‘"></a>4. å‰ç«¯å¼€å‘</h2><h3 id="é¡µé¢ç¼–å†™"><a href="#é¡µé¢ç¼–å†™" class="headerlink" title="é¡µé¢ç¼–å†™"></a>é¡µé¢ç¼–å†™</h3><p>åˆ›å»º ourse_list.vue</p><p>1ï¼‰ä½¿ç”¨element çš„cardç»„ä»¶</p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image3.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image3.png" srcset="/img/loading.gif" alt="image-20200403214719252"></a></p><p>é¡µé¢å¸ƒå±€ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">elâ€row</span> &gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">"8"</span>  <span class="hljs-attr">:offset</span>=<span class="hljs-string">2</span> &gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€card</span> <span class="hljs-attr">:body</span>â€<span class="hljs-attr">style</span>=<span class="hljs-string">"&#123; padding: '10px' &#125;"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/static/images/add.jpg"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"150px"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"padding: 10px;"</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>è¯¾ç¨‹åç§°<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bottom clearfix"</span>&gt;</span>              <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>              <span class="hljs-tag">&lt;<span class="hljs-name">routerâ€link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"muiâ€tabâ€item"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"&#123;path:'/course/add/base'&#125;"</span>&gt;</span>                  <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span> &gt;</span>æ–°å¢è¯¾ç¨‹<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>              <span class="hljs-tag">&lt;/<span class="hljs-name">routerâ€link</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€card</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€col</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">"8"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">for</span>=<span class="hljs-string">"(course, index) in courses"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"course.id"</span> <span class="hljs-attr">:offset</span>=<span class="hljs-string">"index &gt; 0 ?</span></span><span class="hljs-tag"><span class="hljs-string">2 : 2"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€card</span> <span class="hljs-attr">:body</span>â€<span class="hljs-attr">style</span>=<span class="hljs-string">"&#123; padding: '10px' &#125;"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"course.pic!=null?imgUrl+course.pic:'/static/images/nonepic.jpg'"</span></span><span class="hljs-tag"><span class="hljs-attr">class</span>=<span class="hljs-string">"image"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"150px"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"padding: 10px;"</span>&gt;</span>           <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>&#123;&#123;course.name&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bottom clearfix"</span>&gt;</span>              <span class="hljs-tag">&lt;<span class="hljs-name">time</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"time"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">time</span>&gt;</span>              <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleManage(course.id)"</span>&gt;</span>ç®¡ç†è¯¾ç¨‹<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€card</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€col</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">!â€â€åˆ†é¡µâ€â€</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€col</span> <span class="hljs-attr">:span</span>=<span class="hljs-string">"24"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"toolbar"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€pagination</span> <span class="hljs-attr">background</span> <span class="hljs-attr">layout</span>=<span class="hljs-string">"prev, pager, next"</span> @<span class="hljs-attr">current</span>â€</span><span class="hljs-tag"><span class="hljs-attr">change</span>=<span class="hljs-string">"handleCurrentChange"</span> <span class="hljs-attr">:page</span>â€<span class="hljs-attr">size</span>=<span class="hljs-string">"size"</span></span><span class="hljs-tag">                       <span class="hljs-attr">:total</span>=<span class="hljs-string">"total"</span> <span class="hljs-attr">:current</span>â€<span class="hljs-attr">page</span>=<span class="hljs-string">"page"</span></span><span class="hljs-tag">                       <span class="hljs-attr">style</span>=<span class="hljs-string">"float:right;"</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€pagination</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€col</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€row</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> courseApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../api/course'</span>;</span><span class="javascript">  <span class="hljs-keyword">import</span> utilApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../common/utils'</span>;</span><span class="javascript">  <span class="hljs-keyword">let</span> sysConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@/../config/sysConfig'</span>)</span><span class="javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span>    data() &#123;<span class="actionscript">      <span class="hljs-keyword">return</span> &#123;</span>        page:1,        size:7,        total: 0,        courses: [],<span class="actionscript">        sels: [],<span class="hljs-comment">//åˆ—è¡¨é€‰ä¸­åˆ—</span></span>        imgUrl:sysConfig.imgUrl      &#125;    &#125;,    methods: &#123;<span class="actionscript">        <span class="hljs-comment">//åˆ†é¡µæ–¹æ³•</span></span>      handleCurrentChange(val) &#123;<span class="actionscript">        <span class="hljs-keyword">this</span>.page = val;</span>      &#125;,<span class="actionscript">      <span class="hljs-comment">//è·å–è¯¾ç¨‹åˆ—è¡¨</span></span>      getCourse() &#123;            &#125;,<span class="actionscript">      handleManage: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(id)</span> </span>&#123;</span><span class="javascript">        <span class="hljs-built_in">console</span>.log(id)</span><span class="actionscript">        <span class="hljs-keyword">this</span>.$router.push(&#123; path: <span class="hljs-string">'/course/manager/'</span>+id&#125;)</span>      &#125;    &#125;,    created()&#123;     &#125;,    mounted() &#123;    &#125;  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">  <span class="hljs-selector-class">.el</span>â€<span class="hljs-selector-tag">col</span>â€8&#123;</span><span class="css">    <span class="hljs-selector-tag">width</span><span class="hljs-selector-pseudo">:20</span>%</span>  &#125;<span class="css">  <span class="hljs-selector-class">.el</span>â€<span class="hljs-selector-tag">col</span>â€<span class="hljs-selector-tag">offset</span>â€2&#123;</span><span class="css">    <span class="hljs-selector-tag">margin</span>â€<span class="hljs-selector-tag">left</span><span class="hljs-selector-pseudo">:2</span>%</span>  &#125;<span class="css">  <span class="hljs-selector-class">.time</span> &#123;</span>    fontâ€size: 13px;<span class="css">    <span class="hljs-selector-tag">color</span>: <span class="hljs-selector-id">#999</span>;</span>  &#125;<span class="css">  <span class="hljs-selector-class">.bottom</span> &#123;</span>    marginâ€top: 13px;    lineâ€height: 12px;  &#125;<span class="css">  <span class="hljs-selector-class">.button</span> &#123;</span>    padding: 0;    float: right;  &#125;<span class="css">  <span class="hljs-selector-class">.image</span> &#123;</span>    width: 100%;    display: block;  &#125;<span class="css">  <span class="hljs-selector-class">.clearfix</span><span class="hljs-selector-pseudo">:before</span>,</span><span class="css">  <span class="hljs-selector-class">.clearfix</span><span class="hljs-selector-pseudo">:after</span> &#123;</span>    display: table;    content: "";  &#125;<span class="css">  <span class="hljs-selector-class">.clearfix</span><span class="hljs-selector-pseudo">:after</span> &#123;</span>    clear: both  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><p>2ï¼‰è·¯ç”±</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> course_list <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/course/page/course_list.vue'</span>;<span class="hljs-keyword">import</span> Home <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/home/page/home.vue'</span>;<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [  &#123;     path: <span class="hljs-string">'/course'</span>,    component: Home,    name: <span class="hljs-string">'è¯¾ç¨‹ç®¡ç†'</span>,    hidden: <span class="hljs-literal">false</span>,    iconCls: <span class="hljs-string">'elâ€iconâ€document'</span>,    children: [      &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/list'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æˆ‘çš„è¯¾ç¨‹'</span>,<span class="hljs-attr">component</span>: course_list,<span class="hljs-attr">hidden</span>: <span class="hljs-literal">false</span> &#125;    ]  &#125;]</code></pre></div><h3 id="Apiè°ƒç”¨"><a href="#Apiè°ƒç”¨" class="headerlink" title="Apiè°ƒç”¨"></a>Apiè°ƒç”¨</h3><p>1ã€å®šä¹‰Apiæ–¹æ³•</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æˆ‘çš„è¯¾ç¨‹åˆ—è¡¨</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> findCourseList = <span class="hljs-function">(<span class="hljs-params">page,size,params</span>) =&gt;</span> &#123;     <span class="hljs-comment">//å¯¹äºæŸ¥è¯¢æ¡ä»¶ï¼Œå‘æœåŠ¡ç«¯ä¼ å…¥key/valueä¸²ã€‚</span>     <span class="hljs-comment">//ä½¿ç”¨å·¥å…·ç±»å°†jsonå¯¹è±¡è½¬æˆkey/value</span>     <span class="hljs-keyword">let</span> queries = querystring.stringify(params)    <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl+<span class="hljs-string">"/course/coursebase/list/"</span>+page+<span class="hljs-string">"/"</span>+size+<span class="hljs-string">"?"</span>+queries);&#125;</code></pre></div><p>2ã€åœ¨é¡µé¢è°ƒç”¨ <code>findCourseList</code> æ–¹æ³•</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//è·å–è¯¾ç¨‹åˆ—è¡¨</span>getCourse() &#123;  courseApi.findCourseList(<span class="hljs-keyword">this</span>.page,<span class="hljs-keyword">this</span>.size,&#123;&#125;).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;          <span class="hljs-built_in">console</span>.log(res);          <span class="hljs-keyword">if</span>(res.success)&#123;            <span class="hljs-keyword">this</span>.total = res.queryResult.total;            <span class="hljs-keyword">this</span>.courses = res.queryResult.list;          &#125;  &#125;);&#125;</code></pre></div><p>åœ¨ <code>mounted</code> é’©å­ä¸­è°ƒç”¨ <code>getCourse</code> æ–¹æ³•</p><div class="hljs"><pre><code class="hljs js">mounted() &#123;  <span class="hljs-comment">//æŸ¥è¯¢æˆ‘çš„è¯¾ç¨‹</span>  <span class="hljs-keyword">this</span>.getCourse();&#125;</code></pre></div><p>åœ¨åˆ†é¡µæ–¹æ³•ä¸­è°ƒç”¨ <code>getCourse</code> æ–¹æ³•</p><div class="hljs"><pre><code class="hljs js"> <span class="hljs-comment">//åˆ†é¡µæ–¹æ³•</span>handleCurrentChange(val) &#123;  <span class="hljs-keyword">this</span>.page = val;  <span class="hljs-keyword">this</span>.getCourse();&#125;,</code></pre></div><h3 id="1æµ‹è¯•"><a href="#1æµ‹è¯•" class="headerlink" title="1æµ‹è¯•"></a>1æµ‹è¯•</h3><p>é¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š</p><p>æ³¨æ„ï¼šç”±äºè¯¾ç¨‹å›¾ç‰‡æœåŠ¡å™¨æ²¡æœ‰æ­å»ºï¼Œè¿™é‡Œå›¾ç‰‡æš‚æ—¶æ— æ³•æ˜¾ç¤ºã€‚</p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image4.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image4.png" srcset="/img/loading.gif" alt="image-20200403215009200"></a></p><h1 id="äºŒã€æ–°å¢è¯¾ç¨‹"><a href="#äºŒã€æ–°å¢è¯¾ç¨‹" class="headerlink" title="äºŒã€æ–°å¢è¯¾ç¨‹"></a>äºŒã€æ–°å¢è¯¾ç¨‹</h1><h2 id="1-éœ€æ±‚åˆ†æ-1"><a href="#1-éœ€æ±‚åˆ†æ-1" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>ç”¨æˆ·æ“ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€ç”¨æˆ·è¿›å…¥â€œæˆ‘çš„è¯¾ç¨‹â€é¡µé¢ï¼Œç‚¹å‡»â€œæ–°å¢è¯¾ç¨‹â€ï¼Œè¿›å…¥æ–°å¢è¯¾ç¨‹é¡µé¢</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image4.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image5.png" srcset="/img/loading.gif" alt="image-20200403215030231"></a></p><p>2ã€å¡«å†™è¯¾ç¨‹ä¿¡æ¯ï¼Œé€‰æ‹©è¯¾ç¨‹åˆ†ç±»ã€è¯¾ç¨‹ç­‰çº§ã€å­¦ä¹ æ¨¡å¼ç­‰ã€‚</p><p>3ã€ä¿¡æ¯å¡«å†™å®Œæ¯•ï¼Œç‚¹å‡»â€œæäº¤â€ï¼Œè¯¾ç¨‹æ·»åŠ æˆåŠŸæˆ–è¯¾ç¨‹æ·»åŠ å¤±è´¥å¹¶æç¤ºå¤±è´¥åŸå› ã€‚</p><p>éœ€è¦è§£å†³çš„æ˜¯åœ¨æ–°å¢é¡µé¢ä¸Šè¾“å…¥çš„ä¿¡æ¯ï¼š</p><p>1ã€è¯¾ç¨‹åˆ†ç±» å¤šçº§åˆ†ç±»ï¼Œéœ€è¦æ–¹ä¾¿ç”¨æˆ·å»é€‰æ‹©ã€‚</p><p>2ã€è¯¾ç¨‹ç­‰çº§ã€å­¦ä¹ æ¨¡å¼ç­‰è¿™äº›é€‰é¡¹å»ºè®®æ˜¯å¯ä»¥é…ç½®çš„ã€‚</p><h2 id="2-è¯¾ç¨‹åˆ†ç±»æŸ¥è¯¢"><a href="#2-è¯¾ç¨‹åˆ†ç±»æŸ¥è¯¢" class="headerlink" title="2. è¯¾ç¨‹åˆ†ç±»æŸ¥è¯¢"></a>2. è¯¾ç¨‹åˆ†ç±»æŸ¥è¯¢</h2><h3 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>åœ¨æ–°å¢è¯¾ç¨‹ç•Œé¢éœ€è¦é€‰æ‹©è¯¾ç¨‹æ‰€å±åˆ†ç±»ï¼Œ åˆ†ç±»ä¿¡æ¯æ˜¯æ•´ä¸ªé¡¹ç›®éå¸¸é‡è¦çš„ä¿¡æ¯ï¼Œè¯¾ç¨‹å³å•†å“ï¼Œåˆ†ç±»ä¿¡æ¯è®¾ç½®çš„å¥½åç›´æ¥å½±å“ç”¨æˆ·è®¿é—®é‡ã€‚</p><p>åˆ†ç±»ä¿¡æ¯åœ¨å“ªé‡Œåº”ç”¨ï¼Ÿ</p><p>1ã€é¦–é¡µåˆ†ç±»å¯¼èˆª</p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image5.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/imagei5.png" srcset="/img/loading.gif" alt="image-20200403215130650"></a></p><p>2 ã€è¯¾ç¨‹çš„å½’å±åœ°</p><p>æ·»åŠ è¯¾ç¨‹æ—¶è¦é€‰æ‹©è¯¾ç¨‹çš„æ‰€å±åˆ†ç±»ã€‚</p><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p>åˆ†ç±»è¡¨ <code>category</code> çš„ç»“æ„å¦‚ä¸‹</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image11.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image11.png" srcset="/img/loading.gif" alt="image-20200403215159778"></a></p><h3 id="åˆ†ç±»æŸ¥è¯¢"><a href="#åˆ†ç±»æŸ¥è¯¢" class="headerlink" title="åˆ†ç±»æŸ¥è¯¢"></a>åˆ†ç±»æŸ¥è¯¢</h3><h4 id="1ï¼‰æ•°æ®æ ¼å¼"><a href="#1ï¼‰æ•°æ®æ ¼å¼" class="headerlink" title="1ï¼‰æ•°æ®æ ¼å¼"></a>1ï¼‰æ•°æ®æ ¼å¼</h4><p>åœ¨æ·»åŠ è¯¾ç¨‹æ—¶éœ€è¦é€‰æ‹©è¯¾ç¨‹æ‰€å±çš„åˆ†ç±»ï¼Œè¿™é‡Œéœ€è¦å®šä¹‰è¯¾ç¨‹åˆ†ç±»æŸ¥è¯¢æ¥å£ã€‚</p><p>æ¥å£æ ¼å¼è¦æ ¹æ®å‰ç«¯éœ€è¦çš„æ•°æ®æ ¼å¼æ¥å®šä¹‰ï¼Œå‰ç«¯å±•ç¤ºè¯¾ç¨‹åˆ†ç±»ä½¿ç”¨ <code>elemenet-ui</code> çš„<code>cascader</code>ï¼ˆçº§è”é€‰æ‹©å™¨ï¼‰ç»„ä»¶ã€‚</p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image6.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image6.png" srcset="/img/loading.gif" alt="image-20200403215240113"></a></p><p>æ•°æ®æ ¼å¼ä¾‹å­å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js">[  &#123;        value: <span class="hljs-string">'zhinan'</span>,        label: <span class="hljs-string">'æŒ‡å—'</span>,        children: [&#123;          value: <span class="hljs-string">'shejiyuanze'</span>,          label: <span class="hljs-string">'è®¾è®¡åŸåˆ™'</span>,          children: [&#123;            value: <span class="hljs-string">'yizhi'</span>,            label: <span class="hljs-string">'ä¸€è‡´'</span>          &#125;, &#123;            value: <span class="hljs-string">'fankui'</span>,            label: <span class="hljs-string">'åé¦ˆ'</span>          &#125;, &#123;            value: <span class="hljs-string">'xiaolv'</span>,            label: <span class="hljs-string">'æ•ˆç‡'</span>          &#125;, &#123;            value: <span class="hljs-string">'kekong'</span>,            label: <span class="hljs-string">'å¯æ§'</span>          &#125;]        &#125;]  &#125;]</code></pre></div><h4 id="2ï¼‰æ•°æ®æ¨¡å‹"><a href="#2ï¼‰æ•°æ®æ¨¡å‹" class="headerlink" title="2ï¼‰æ•°æ®æ¨¡å‹"></a>2ï¼‰æ•°æ®æ¨¡å‹</h4><p>1ï¼‰å®šä¹‰categoryçš„æ¨¡å‹</p><p>category æ¨¡å‹å¯¹æ•°æ®å­—æ®µå¯¹åº”ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-meta">@Entity</span><span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"category"</span>)<span class="hljs-meta">@GenericGenerator</span>(name = <span class="hljs-string">"jpaâ€assigned"</span>, strategy = <span class="hljs-string">"assigned"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Category</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = â€<span class="hljs-number">906357110051689484L</span>;    <span class="hljs-meta">@Id</span>    <span class="hljs-meta">@GeneratedValue</span>(generator = <span class="hljs-string">"jpaâ€assigned"</span>)    <span class="hljs-meta">@Column</span>(length = <span class="hljs-number">32</span>)    <span class="hljs-keyword">private</span> String id;    <span class="hljs-keyword">private</span> String name;    <span class="hljs-keyword">private</span> String label;    <span class="hljs-keyword">private</span> String parentid;    <span class="hljs-keyword">private</span> String isshow;    <span class="hljs-keyword">private</span> Integer orderby;    <span class="hljs-keyword">private</span> String isleaf;&#125;</code></pre></div><p>2ï¼‰å®šä¹‰æ•°æ®è¿”å›æ ¼å¼</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Category</span> </span>&#123;    List&lt;CategoryNode&gt; children;&#125;</code></pre></div><p>çº§è”èœå•å±äºä¸‰çº§èœå•ï¼Œæ‰€ä»¥æ¯ä¸ªèœå•ä¸‹é¢éƒ½ä¼šæœ‰ä¸€ä¸ª <code>chaidren</code> çš„å­—æ®µ</p><h4 id="3ï¼‰API-æ¥å£"><a href="#3ï¼‰API-æ¥å£" class="headerlink" title="3ï¼‰API æ¥å£"></a>3ï¼‰API æ¥å£</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.api.web.controller.api.course;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.ext.CategoryNode;<span class="hljs-keyword">import</span> io.swagger.annotations.Api;<span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<span class="hljs-meta">@Api</span>(value = <span class="hljs-string">"è¯¾ç¨‹åˆ†ç±»ç®¡ç†"</span>,description = <span class="hljs-string">"è¯¾ç¨‹åˆ†ç±»ç®¡ç†"</span>,tags = &#123;<span class="hljs-string">"è¯¾ç¨‹åˆ†ç±»ç®¡ç†"</span>&#125;)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CategoryControllerApi</span> </span>&#123;    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æŸ¥è¯¢åˆ†ç±»"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> CategoryNode <span class="hljs-title">findList</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><h4 id="4ï¼‰DAO"><a href="#4ï¼‰DAO" class="headerlink" title="4ï¼‰DAO"></a>4ï¼‰DAO</h4><p>1ï¼‰å®šä¹‰mapper</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CategoryMapper</span> </span>&#123;    <span class="hljs-comment">//æŸ¥è¯¢åˆ†ç±»</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> CategoryNode <span class="hljs-title">selectList</span><span class="hljs-params">()</span></span>;&#125;</code></pre></div><p>2ï¼‰å®šä¹‰mapperæ˜ å°„æ–‡ä»¶</p><p>é‡‡ç”¨è¡¨çš„è‡ªè¿æ¥æ–¹å¼è¾“å‡ºæ ‘å‹ç»“æœé›†ã€‚</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.xuecheng.manage_course.dao.CategoryMapper"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"CategoryMap"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.ext.CategoryNode"</span>&gt;</span>        <span class="hljs-comment">&lt;!--ä¸€çº§èŠ‚ç‚¹--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_id"</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_name"</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"label"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_label"</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"isshow"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_isshow"</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"orderby"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_orderby"</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"isleaf"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_isleaf"</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"parentid"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_parentid"</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"children"</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.ext.CategoryNode"</span>&gt;</span>            <span class="hljs-comment">&lt;!--äºŒçº§èŠ‚ç‚¹--&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_id"</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_name"</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"label"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_label"</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"isshow"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_isshow"</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"orderby"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_orderby"</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"isleaf"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_isleaf"</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"parentid"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_parentid"</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"children"</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.ext.CategoryNode"</span>&gt;</span>                <span class="hljs-comment">&lt;!--ä¸‰çº§èŠ‚ç‚¹--&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_id"</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_name"</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"label"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_label"</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"isshow"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_isshow"</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"orderby"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_orderby"</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"isleaf"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_isleaf"</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"parentid"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_parentid"</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>    <span class="hljs-comment">&lt;!--ä¸‰çº§èœå•æŸ¥è¯¢--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectList"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"CategoryMap"</span>&gt;</span>        select        a.id one_id,        a.name one_name,        a.label one_label,        a.isshow one_isshow,        a.isleaf one_isleaf,        a.orderby one_orderby,        a.parentid one_parentid,        b.id two_id,        b.name two_name,        b.label two_label,        b.isshow two_isshow,        b.isleaf two_isleaf,        b.orderby two_orderby,        b.parentid two_parentid,        c.id three_id,        c.name three_name,        c.label three_label,        c.isshow three_isshow,        c.isleaf three_isleaf,        c.orderby three_orderby,        c.parentid three_parentid        from        category a left join category b        on a.id = b.parentid        left join category c        on b.id = c.parentid        where a.parentid = '0'        order by a.orderby,        b.orderby,        c.orderby    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><h4 id="5ï¼‰Service"><a href="#5ï¼‰Service" class="headerlink" title="5ï¼‰Service"></a>5ï¼‰Service</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-13  14:14</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CategoryMapper categoryMapper;    <span class="hljs-meta">@Transactional</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> CategoryNode <span class="hljs-title">findCategoryList</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> categoryMapper.selectList();    &#125;&#125;</code></pre></div><h4 id="6ï¼‰Controller"><a href="#6ï¼‰Controller" class="headerlink" title="6ï¼‰Controller"></a>6ï¼‰Controller</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/category"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CategoryController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CategoryControllerApi</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CategoryService categoryService;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/list"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> CategoryNode <span class="hljs-title">findList</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> categoryService.findCategoryList();    &#125;&#125;</code></pre></div><h4 id="7ï¼‰æ¥å£æµ‹è¯•"><a href="#7ï¼‰æ¥å£æµ‹è¯•" class="headerlink" title="7ï¼‰æ¥å£æµ‹è¯•"></a>7ï¼‰æ¥å£æµ‹è¯•</h4><p>æ¥å£æè¿°å¦‚ä¸‹</p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image7.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image7.png" srcset="/img/loading.gif" alt="image-20200403215645362"></a></p><p>ä½¿ç”¨swagger-uiæˆ–postmanæµ‹è¯•æ¥å£ã€‚</p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image8.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image8.png" srcset="/img/loading.gif" alt="image-20200403215654115"></a></p><h2 id="3-æ•°æ®å­—å…¸"><a href="#3-æ•°æ®å­—å…¸" class="headerlink" title="3. æ•°æ®å­—å…¸"></a>3. æ•°æ®å­—å…¸</h2><h3 id="ä»‹ç»-1"><a href="#ä»‹ç»-1" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h3><p>åœ¨æ–°å¢è¯¾ç¨‹ç•Œé¢éœ€è¦é€‰æ‹©è¯¾ç¨‹ç­‰çº§ã€è¯¾ç¨‹çŠ¶æ€ç­‰ï¼Œè¿™äº›ä¿¡æ¯ç»Ÿä¸€é‡‡ç”¨æ•°æ®å­—å…¸ç®¡ç†çš„æ–¹å¼ã€‚<br>æœ¬é¡¹ç›®å¯¹ä¸€äº›ä¸šåŠ¡çš„åˆ†ç±»é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šè¯¾ç¨‹ç­‰çº§ã€è¯¾ç¨‹çŠ¶æ€ã€ç”¨æˆ·ç±»å‹ã€ç”¨æˆ·çŠ¶æ€ç­‰è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œé€šè¿‡åœ¨æ•°æ®åº“åˆ›å»ºæ•°æ®å­—å…¸è¡¨æ¥ç»´æŠ¤è¿™äº›åˆ†ç±»ä¿¡æ¯ã€‚</p><p>æ•°æ®å­—å…¸å¯¹ç³»ç»Ÿçš„ä¸šåŠ¡åˆ†ç±»è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥è§£å†³ç¡¬ç¼–ç é—®é¢˜ï¼Œæ¯”å¦‚æ·»åŠ è¯¾ç¨‹æ—¶é€‰æ‹©è¯¾ç¨‹ç­‰çº§ï¼Œä¸‹æ‹‰æ¡†ä¸­çš„è¯¾ç¨‹ç­‰çº§ä¿¡æ¯å¦‚æœåœ¨é¡µé¢ç¡¬ç¼–ç å°†é€ æˆä¸æ˜“ä¿®æ”¹ç»´æŠ¤çš„é—®é¢˜ï¼Œæ‰€ä»¥ä»æ•°æ®å­—å…¸è¡¨ä¸­è·å–ï¼Œå¦‚æœè¦ä¿®æ”¹åç§°åˆ™åœ¨æ•°æ®å­—å…¸ä¿®æ”¹å³å¯ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚</p><h3 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h3><p>åœ¨ <code>mongodb</code> ä¸­åˆ›å»ºæ•°æ®å­—å…¸è¡¨ <code>sys_dictionary</code></p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image9.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image9.png" srcset="/img/loading.gif" alt="image-20200403220146001"></a></p><p>ä¸€ä¸ªå­—å…¸ä¿¡æ¯å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs json"> &#123;<span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5a7e8d2dd019f15418fa2b71"</span>),<span class="hljs-attr">"d_name"</span> : <span class="hljs-string">"è¯¾ç¨‹ç­‰çº§"</span>,<span class="hljs-attr">"d_type"</span> : <span class="hljs-string">"200"</span>,<span class="hljs-attr">"d_value"</span> : [    &#123;        <span class="hljs-attr">"sd_name"</span> : <span class="hljs-string">"ä½çº§"</span>,        <span class="hljs-attr">"sd_id"</span> : <span class="hljs-string">"200001"</span>,        <span class="hljs-attr">"sd_status"</span> : <span class="hljs-string">"1"</span>    &#125;,    &#123;        <span class="hljs-attr">"sd_name"</span> : <span class="hljs-string">"ä¸­çº§"</span>,        <span class="hljs-attr">"sd_id"</span> : <span class="hljs-string">"200002"</span>,        <span class="hljs-attr">"sd_status"</span> : <span class="hljs-string">"1"</span>    &#125;,    &#123;        <span class="hljs-attr">"sd_name"</span> : <span class="hljs-string">"é«˜çº§"</span>,        <span class="hljs-attr">"sd_id"</span> : <span class="hljs-string">"200003"</span>,        <span class="hljs-attr">"sd_status"</span> : <span class="hljs-string">"1"</span>    &#125;]&#125;</code></pre></div><p>å­—æ®µè¯´æ˜å¦‚ä¸‹ï¼š</p><p><code>d_name</code>ï¼šå­—å…¸åç§°</p><p><code>d_type</code>ï¼šå­—å…¸åˆ†ç±»</p><p><code>d_value</code>ï¼šå­—å…¸æ•°æ®</p><p>sd_nameï¼šé¡¹ç›®åç§°</p><p><code>sd_id</code>ï¼šé¡¹ç›®id</p><p><code>sd_status</code>ï¼šé¡¹ç›®çŠ¶æ€ï¼ˆ1ï¼šå¯ç”¨ï¼Œ0ä¸å¯ç”¨ï¼‰</p><p><strong>æ•°æ®æ¨¡å‹ç±»</strong>ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-meta">@Document</span>(collection = <span class="hljs-string">"sys_dictionary"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SysDictionary</span> </span>&#123;    <span class="hljs-meta">@Id</span>    <span class="hljs-keyword">private</span> String id;    <span class="hljs-meta">@Field</span>(<span class="hljs-string">"d_name"</span>)    <span class="hljs-keyword">private</span> String dName;    <span class="hljs-meta">@Field</span>(<span class="hljs-string">"d_type"</span>)    <span class="hljs-keyword">private</span> String dType;    <span class="hljs-meta">@Field</span>(<span class="hljs-string">"d_value"</span>)    <span class="hljs-keyword">private</span> List&lt;SysDictionaryValue&gt; dValue;&#125;</code></pre></div><p><code>SysDictionaryValue</code> ç±»å‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SysDictionaryValue</span> </span>&#123;    <span class="hljs-meta">@Field</span>(<span class="hljs-string">"sd_id"</span>)    <span class="hljs-keyword">private</span> String sdId;    <span class="hljs-meta">@Field</span>(<span class="hljs-string">"sd_name"</span>)    <span class="hljs-keyword">private</span> String sdName;    <span class="hljs-meta">@Field</span>(<span class="hljs-string">"sd_status"</span>)    <span class="hljs-keyword">private</span> String sdStatus;&#125;</code></pre></div><h3 id="å­—å…¸æŸ¥è¯¢æ¥å£"><a href="#å­—å…¸æŸ¥è¯¢æ¥å£" class="headerlink" title="å­—å…¸æŸ¥è¯¢æ¥å£"></a>å­—å…¸æŸ¥è¯¢æ¥å£</h3><h4 id="APIæ¥å£"><a href="#APIæ¥å£" class="headerlink" title="APIæ¥å£"></a>APIæ¥å£</h4><p>ä¸ºäº†æ–¹ä¾¿å…¶å®ƒå­ç³»ç»Ÿä½¿ç”¨ï¼Œåœ¨cmsæ¨¡å—ä¸‹åˆ›å»ºå­—å…¸æŸ¥è¯¢æ¥å£ï¼Œæ ¹æ®å­—å…¸çš„typeæŸ¥è¯¢å­—å…¸ä¿¡æ¯ï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-13  14:24</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Api</span>(value = <span class="hljs-string">"æ•°æ®å­—å…¸æ¥å£"</span>,description = <span class="hljs-string">"æä¾›æ•°æ®å­—å…¸æ¥å£çš„ç®¡ç†ï¼ŒæŸ¥è¯¢åŠŸèƒ½"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SysDicthionaryControllerApi</span> </span>&#123;    <span class="hljs-comment">//æ•°æ®å­—å…¸</span>    <span class="hljs-meta">@ApiOperation</span>(value = <span class="hljs-string">"æ•°æ®å­—å…¸æŸ¥è¯¢æ¥å£"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> SysDictionary <span class="hljs-title">getByType</span><span class="hljs-params">(String type)</span></span>;&#125;</code></pre></div><h4 id="Dao-1"><a href="#Dao-1" class="headerlink" title="Dao"></a>Dao</h4><p>åœ¨cmsæ¨¡å—ä¸‹åˆ›å»ºæ•°æ®åº“çš„daoã€serviceç­‰ç±»ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-13  14:30</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Repository</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">SysDicthionaryRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">SysDictionary</span>,<span class="hljs-title">String</span>&gt; </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> SysDictionary <span class="hljs-title">findAllByDType</span><span class="hljs-params">(String type)</span></span>;&#125;</code></pre></div><h4 id="Service-1"><a href="#Service-1" class="headerlink" title="Service"></a>Service</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SysDicthinaryService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    SysDicthionaryRepository sysDicthionaryRepository;    <span class="hljs-function"><span class="hljs-keyword">public</span> SysDictionary <span class="hljs-title">getByType</span><span class="hljs-params">(String type)</span> </span>&#123;        <span class="hljs-keyword">if</span> (type == <span class="hljs-keyword">null</span>)&#123;            ExceptionCast.cast(CommonCode.INVALID_PARAM);        &#125;        <span class="hljs-keyword">return</span> sysDicthionaryRepository.findAllByDType(type);    &#125;&#125;</code></pre></div><h4 id="Controller-1"><a href="#Controller-1" class="headerlink" title="Controller"></a>Controller</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/sys"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SysDicthionaryController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SysDicthionaryControllerApi</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    SysDicthinaryService sysDicthinaryService;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/dictionary/get/&#123;dType&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> SysDictionary <span class="hljs-title">getByType</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"dType"</span>)</span> String type) </span>&#123;        <span class="hljs-keyword">return</span> sysDicthinaryService.getByType(type);    &#125;&#125;</code></pre></div><h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image10.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image10.png" srcset="/img/loading.gif" alt="image-20200403220513616"></a></p><h2 id="4-æ–°å¢è¯¾ç¨‹é¡µé¢å®Œå–„"><a href="#4-æ–°å¢è¯¾ç¨‹é¡µé¢å®Œå–„" class="headerlink" title="4. æ–°å¢è¯¾ç¨‹é¡µé¢å®Œå–„"></a>4. æ–°å¢è¯¾ç¨‹é¡µé¢å®Œå–„</h2><p>æœ¬èŠ‚å®Œæˆæ•°æ®å­—å…¸æ˜¾ç¤ºåŠè¯¾ç¨‹åˆ†ç±»æ˜¾ç¤ºã€‚</p><h3 id="æ–°å¢è¯¾ç¨‹é¡µé¢"><a href="#æ–°å¢è¯¾ç¨‹é¡µé¢" class="headerlink" title="æ–°å¢è¯¾ç¨‹é¡µé¢"></a>æ–°å¢è¯¾ç¨‹é¡µé¢</h3><h4 id="1ï¼‰é¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š"><a href="#1ï¼‰é¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š" class="headerlink" title="1ï¼‰é¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š"></a>1ï¼‰é¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š</h4><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image11.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/imagei11.png" srcset="/img/loading.gif" alt="image-20200403220536863"></a></p><h4 id="2ï¼‰åˆ›å»º-course-add-vue-é¡µé¢"><a href="#2ï¼‰åˆ›å»º-course-add-vue-é¡µé¢" class="headerlink" title="2ï¼‰åˆ›å»º course_add.vue é¡µé¢"></a>2ï¼‰åˆ›å»º course_add.vue é¡µé¢</h4><p>åœ¨<code>teach</code> å‰ç«¯å·¥ç¨‹çš„ <code>course</code> æ¨¡å—ä¸‹åˆ›å»º <code>course_add.vue</code> é¡µé¢ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">elâ€form</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"courseForm"</span> <span class="hljs-attr">label</span>â€<span class="hljs-attr">width</span>=<span class="hljs-string">"80px"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"courseRules"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"courseForm"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"è¯¾ç¨‹åç§°"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"name"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"courseForm.name"</span> <span class="hljs-attr">auto</span>â€<span class="hljs-attr">complete</span>=<span class="hljs-string">"off"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"é€‚ç”¨äººç¾¤"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"users"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textarea"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"courseForm.users"</span> <span class="hljs-attr">auto</span>â€<span class="hljs-attr">complete</span>=<span class="hljs-string">"off"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"è¯¾ç¨‹åˆ†ç±»"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"categoryActive"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€cascader</span></span><span class="hljs-tag">          <span class="hljs-attr">expand</span>â€<span class="hljs-attr">trigger</span>=<span class="hljs-string">"hover"</span></span><span class="hljs-tag">          <span class="hljs-attr">:options</span>=<span class="hljs-string">"categoryList"</span></span><span class="hljs-tag">          <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"categoryActive"</span></span><span class="hljs-tag">          <span class="hljs-attr">:props</span>=<span class="hljs-string">"props"</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€cascader</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"è¯¾ç¨‹ç­‰çº§"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"grade"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">b</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">for</span>=<span class="hljs-string">"grade in gradeList"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"courseForm.grade"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"grade.sdId"</span> &gt;</span>&#123;&#123;grade.sdName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€</span></span><span class="hljs-tag"><span class="hljs-attr">radio</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"å­¦ä¹ æ¨¡å¼"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"studymodel"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">b</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">for</span>=<span class="hljs-string">"studymodel_v in studymodelList"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"courseForm.studymodel"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"studymodel_v.sdId"</span> &gt;</span>&#123;&#123;studymodel_v.sdName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radio</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"è¯¾ç¨‹ä»‹ç»"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"description"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textarea"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"courseForm.description"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€form</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"footer"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialogâ€footer"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>  @<span class="hljs-attr">click.native</span>=<span class="hljs-string">"save"</span> &gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> courseApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../api/course'</span>;</span><span class="javascript">  <span class="hljs-keyword">import</span> utilApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../common/utils'</span>;</span><span class="javascript">  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> systemApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../base/api/system'</span>;</span><span class="javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span>    data() &#123;<span class="actionscript">      <span class="hljs-keyword">return</span> &#123;</span>             studymodelList:[],        gradeList:[],        props: &#123;<span class="actionscript">          value: <span class="hljs-string">'id'</span>,</span><span class="actionscript">          label:<span class="hljs-string">'label'</span>,</span><span class="actionscript">          children:<span class="hljs-string">'children'</span></span>        &#125;,        categoryList: [],        categoryActive:[],        courseForm: &#123;<span class="actionscript">          id:<span class="hljs-string">''</span>,</span><span class="actionscript">          name: <span class="hljs-string">''</span>,</span><span class="actionscript">          users: <span class="hljs-string">''</span>,</span><span class="actionscript">          grade:<span class="hljs-string">''</span>,</span><span class="actionscript">          studymodel:<span class="hljs-string">''</span>,</span><span class="actionscript">          mt:<span class="hljs-string">''</span>,</span><span class="actionscript">          st:<span class="hljs-string">''</span>,</span><span class="actionscript">          description: <span class="hljs-string">''</span></span>        &#125;,        courseRules: &#123;          name: [<span class="actionscript">            &#123;required: <span class="hljs-literal">true</span>, message: <span class="hljs-string">'è¯·è¾“å…¥è¯¾ç¨‹åç§°'</span>, trigger: <span class="hljs-string">'blur'</span>&#125;</span>          ],          category: [<span class="actionscript">            &#123;required: <span class="hljs-literal">true</span>, message: <span class="hljs-string">'è¯·é€‰æ‹©è¯¾ç¨‹åˆ†ç±»'</span>, trigger: <span class="hljs-string">'blur'</span>&#125;</span>          ],          grade: [<span class="actionscript">            &#123;required: <span class="hljs-literal">true</span>, message: <span class="hljs-string">'è¯·é€‰æ‹©è¯¾ç¨‹ç­‰çº§'</span>, trigger: <span class="hljs-string">'blur'</span>&#125;</span>          ],          studymodel: [<span class="actionscript">            &#123;required: <span class="hljs-literal">true</span>, message: <span class="hljs-string">'è¯·é€‰æ‹©å­¦ä¹ æ¨¡å¼'</span>, trigger: <span class="hljs-string">'blur'</span>&#125;</span>          ]        &#125;      &#125;    &#125;,    methods: &#123;      save () &#123;      &#125;    &#125;,    created()&#123;    &#125;,    mounted()&#123;    &#125;  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><h4 id="3ï¼‰é¡µé¢è·¯ç”±"><a href="#3ï¼‰é¡µé¢è·¯ç”±" class="headerlink" title="3ï¼‰é¡µé¢è·¯ç”±"></a>3ï¼‰é¡µé¢è·¯ç”±</h4><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> course_add <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/course/page/course_add.vue'</span>;     &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/add/base'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æ·»åŠ è¯¾ç¨‹'</span>,<span class="hljs-attr">component</span>: course_add,<span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span> &#125;,</code></pre></div><h4 id="4ï¼‰è¯¾ç¨‹æ·»åŠ é“¾æ¥"><a href="#4ï¼‰è¯¾ç¨‹æ·»åŠ é“¾æ¥" class="headerlink" title="4ï¼‰è¯¾ç¨‹æ·»åŠ é“¾æ¥"></a>4ï¼‰è¯¾ç¨‹æ·»åŠ é“¾æ¥</h4><p>åœ¨æˆ‘çš„è¯¾ç¨‹é¡µé¢æ·»åŠ â€œæ–°å¢è¯¾ç¨‹â€é“¾æ¥<br>åœ¨ <code>course_list.vue</code> ä¸­æ·»åŠ </p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">routerâ€link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"muiâ€tabâ€item"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"&#123;path:'/course/add/base'&#125;"</span>&gt;</span>     <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button"</span> &gt;</span>æ–°å¢è¯¾ç¨‹<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">routerâ€link</span>&gt;</span></code></pre></div><h3 id="æŸ¥è¯¢æ•°æ®å­—å…¸"><a href="#æŸ¥è¯¢æ•°æ®å­—å…¸" class="headerlink" title="æŸ¥è¯¢æ•°æ®å­—å…¸"></a>æŸ¥è¯¢æ•°æ®å­—å…¸</h3><p>è¯¾ç¨‹æ·»åŠ é¡µé¢ä¸­è¯¾ç¨‹ç­‰çº§ã€å­¦ä¹ æ¨¡å¼éœ€è¦ä»æ•°æ®å­—å…¸æŸ¥è¯¢å­—å…¸ä¿¡æ¯ã€‚</p><p>1ï¼‰<strong>å®šä¹‰æ–¹æ³•</strong></p><p>æ•°æ®å­—å…¸æŸ¥è¯¢ ä¸ºå…¬ç”¨æ–¹æ³•ï¼Œæ‰€ä»¥å®šä¹‰åœ¨ <code>/base/api/system.js</code> ä¸­</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">let</span> sysConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@/../config/sysConfig'</span>) <span class="hljs-keyword">let</span> apiUrl = sysConfig.xcApiUrlPre;<span class="hljs-comment">/*æ•°æ®å­—å…¸ */</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> sys_getDictionary= <span class="hljs-function"><span class="hljs-params">dType</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl+<span class="hljs-string">'/sys/dictionary/get/'</span>+dType)&#125;</code></pre></div><p>2ï¼‰<strong>åœ¨é¡µé¢è·å–æ•°æ®å­—å…¸</strong></p><p>åœ¨ <code>mounted</code> é’©å­ä¸­å®šä¹‰æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// æŸ¥è¯¢æ•°æ®å­—å…¸å­—å…¸</span>systemApi.sys_getDictionary(<span class="hljs-string">'201'</span>).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<span class="hljs-keyword">this</span>.studymodelList = res.dvalue;&#125;);systemApi.sys_getDictionary(<span class="hljs-string">'200'</span>).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<span class="hljs-keyword">this</span>.gradeList = res.dvalue;&#125;);</code></pre></div><p>3ï¼‰<strong>æ•ˆæœ</strong></p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image12.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/C:%5CUsers%5CMI%5CDesktop%5CHexo%5Csource_posts%5C%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07%5Cimage12.png" srcset="/img/loading.gif" alt="image-20200403221002719"></a></p><h3 id="è¯¾ç¨‹åˆ†ç±»"><a href="#è¯¾ç¨‹åˆ†ç±»" class="headerlink" title="è¯¾ç¨‹åˆ†ç±»"></a>è¯¾ç¨‹åˆ†ç±»</h3><p>è¯¾ç¨‹æ·»åŠ é¡µé¢ä¸­è¯¾ç¨‹åˆ†ç±»é‡‡ç”¨ <code>Cascader</code> ç»„ä»¶å®Œæˆã€‚</p><p><code>Cascader</code> çº§è”é€‰æ‹©å™¨</p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image13.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image13.png" srcset="/img/loading.gif" alt="image-20200403221022081"></a></p><p><strong>1ï¼‰é¡µé¢</strong></p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">" è¯¾ç¨‹åˆ†ç±»"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"categoryActive"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">elâ€cascader</span></span><span class="hljs-tag">    <span class="hljs-attr">expand</span>â€<span class="hljs-attr">trigger</span>=<span class="hljs-string">"hover"</span></span><span class="hljs-tag">    <span class="hljs-attr">:options</span>=<span class="hljs-string">"categoryList"</span></span><span class="hljs-tag">    <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"categoryActive"</span></span><span class="hljs-tag">    <span class="hljs-attr">:props</span>=<span class="hljs-string">"props"</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€cascader</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span></code></pre></div><p><strong>2ï¼‰å®šä¹‰æ–¹æ³•</strong><br>åœ¨æœ¬æ¨¡å—çš„<code>course.js</code>ä¸­å®šä¹‰</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/* æŸ¥è¯¢è¯¾ç¨‹åˆ†ç±» */</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> category_findlist= <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl+<span class="hljs-string">'/category/list'</span>)&#125;</code></pre></div><p><strong>3ï¼‰åœ¨é¡µé¢è·å–è¯¾ç¨‹åˆ†ç±»</strong></p><p>åœ¨ <code>mounted</code> é’©å­ä¸­å®šä¹‰</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// å–è¯¾ç¨‹åˆ†ç±»</span>courseApi.category_findlist(&#123;&#125;).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;  <span class="hljs-keyword">this</span>.categoryList = res.children;&#125;);</code></pre></div><p><strong>4ï¼‰æ•ˆæœ</strong></p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image14.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image14.png" srcset="/img/loading.gif" alt="image-20200403221132985"></a></p><p><strong>5) å¦‚ä½•è·å–é€‰æ‹©çš„åˆ†ç±»</strong></p><p>ç”¨æˆ·é€‰æ‹©è¯¾ç¨‹åˆ†ç±»åï¼Œæ‰€é€‰åˆ†ç±» <code>ID</code> ç»‘å®šåˆ° <code>categoryActive</code>ï¼ˆæ•°ç»„ï¼‰ä¸­ï¼Œé€‰æ‹©äº†ä¸€çº§ã€äºŒçº§åˆ†ç±»ï¼Œåˆ†åˆ«å­˜å‚¨åœ¨ <code>categoryActive</code> æ•°ç»„çš„ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªå…ƒç´ ä¸­ã€‚</p><h2 id="5-æ–°å¢è¯¾ç¨‹æœåŠ¡ç«¯"><a href="#5-æ–°å¢è¯¾ç¨‹æœåŠ¡ç«¯" class="headerlink" title="5. æ–°å¢è¯¾ç¨‹æœåŠ¡ç«¯"></a>5. æ–°å¢è¯¾ç¨‹æœåŠ¡ç«¯</h2><h3 id="APIæ¥å£-1"><a href="#APIæ¥å£-1" class="headerlink" title="APIæ¥å£"></a>APIæ¥å£</h3><p>åˆ›å»ºè¯¾ç¨‹æ·»åŠ æäº¤æ¥å£ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Api</span>(value = <span class="hljs-string">" è¯¾ç¨‹ç®¡ç†"</span>,description = <span class="hljs-string">"è¯¾ç¨‹ç®¡ç†"</span>,tags = &#123;<span class="hljs-string">"è¯¾ç¨‹ç®¡ç†"</span>&#125;)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseControllerApi</span> </span>&#123;      <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æ·»åŠ è¯¾ç¨‹åŸºç¡€ä¿¡æ¯"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> AddCourseResult <span class="hljs-title">addCourseBase</span><span class="hljs-params">(CourseBase courseBase)</span></span>;&#125;</code></pre></div><h3 id="Dao-2"><a href="#Dao-2" class="headerlink" title="Dao"></a>Dao</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseBaseRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">CourseBase</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div><h3 id="Service-2"><a href="#Service-2" class="headerlink" title="Service"></a>Service</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">     * æ·»åŠ è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseBase</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Transactional</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> AddCourseResult <span class="hljs-title">addCourseBase</span><span class="hljs-params">(CourseBase courseBase)</span> </span>&#123;        String courseBaseId = courseBase.getId();        courseBaseRepository.save(courseBase);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AddCourseResult(CommonCode.SUCCESS,courseBaseId);    &#125;</code></pre></div><h3 id="Controller-2"><a href="#Controller-2" class="headerlink" title="Controller"></a>Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>   <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"coursebase/add"</span>)   <span class="hljs-function"><span class="hljs-keyword">public</span> AddCourseResult <span class="hljs-title">addCourseBase</span><span class="hljs-params">(@RequestBody CourseBase courseBase)</span> </span>&#123;       <span class="hljs-keyword">return</span> courseService.addCourseBase(courseBase);   &#125;</code></pre></div><h2 id="6-æ–°å¢è¯¾ç¨‹å‰ç«¯"><a href="#6-æ–°å¢è¯¾ç¨‹å‰ç«¯" class="headerlink" title="6. æ–°å¢è¯¾ç¨‹å‰ç«¯"></a>6. æ–°å¢è¯¾ç¨‹å‰ç«¯</h2><h3 id="Apiæ–¹æ³•å®šä¹‰"><a href="#Apiæ–¹æ³•å®šä¹‰" class="headerlink" title="Apiæ–¹æ³•å®šä¹‰"></a>Apiæ–¹æ³•å®šä¹‰</h3><p>åœ¨å‰ç«¯å®šä¹‰è¯·æ±‚æœåŠ¡ç«¯æ·»åŠ è¯¾ç¨‹çš„apiçš„æ–¹æ³•ï¼Œåœ¨courseæ¨¡å—ä¸­å®šä¹‰æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/* æ·»åŠ è¯¾ç¨‹åŸºç¡€ä¿¡æ¯*/</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addCourseBase = <span class="hljs-function"><span class="hljs-params">params</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/course/coursebase/add'</span>,params)&#125;</code></pre></div><h3 id="Apiæ–¹æ³•è°ƒç”¨"><a href="#Apiæ–¹æ³•è°ƒç”¨" class="headerlink" title="Apiæ–¹æ³•è°ƒç”¨"></a>Apiæ–¹æ³•è°ƒç”¨</h3><p>åœ¨<code>course_add.vue</code> è°ƒç”¨<code>api</code>æäº¤è¯¾ç¨‹ä¿¡æ¯</p><div class="hljs"><pre><code class="hljs js">methods: &#123;       save () &#123;          <span class="hljs-keyword">this</span>.$refs.courseForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;            <span class="hljs-keyword">if</span> (valid) &#123;              <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤æäº¤å—ï¼Ÿ'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;                <span class="hljs-comment">//å½“å‰é€‰æ‹©çš„åˆ†ç±»</span>                <span class="hljs-keyword">let</span> mt = <span class="hljs-keyword">this</span>.categoryActive[<span class="hljs-number">0</span>];                <span class="hljs-keyword">let</span> st = <span class="hljs-keyword">this</span>.categoryActive[<span class="hljs-number">1</span>];                <span class="hljs-keyword">this</span>.courseForm.mt = mt;                <span class="hljs-keyword">this</span>.courseForm.st = st;                <span class="hljs-comment">//è¯·æ±‚æœåŠ¡æ¥å£</span>                courseApi.addCourseBase(<span class="hljs-keyword">this</span>.courseForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;                  <span class="hljs-keyword">if</span>(res.success)&#123;                    <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">'æäº¤æˆåŠŸ'</span>);                    <span class="hljs-comment">//è·³è½¬åˆ°è¯¾ç¨‹å›¾ç‰‡</span>                    <span class="hljs-comment">//this.$router.push(&#123; path: '/course/add/picture/1/'+this.courseid&#125;)</span>                  &#125;<span class="hljs-keyword">else</span>&#123;                    <span class="hljs-keyword">if</span>(res.message)&#123;                      <span class="hljs-keyword">this</span>.$message.error(res.message);                    &#125;<span class="hljs-keyword">else</span>&#123;                      <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);                    &#125;                   &#125;                &#125;);              &#125;);            &#125;          &#125;);      &#125;    &#125;,</code></pre></div><h3 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æ³¨æ„ï¼šå°† <code>course_base</code> è¡¨ä¸­çš„ <code>company_id</code> æ”¹ä¸ºéå¿…å¡«ï¼Œå¾…è®¤è¯åŠŸèƒ½å¼€å‘å®Œæˆå†ä¿®æ”¹ä¸ºå¿…å¡«</p><p>æµ‹è¯•æµç¨‹ï¼š</p><p>1ã€è¿›å…¥æˆ‘çš„è¯¾ç¨‹ï¼Œç‚¹å‡»â€œæ–°å¢è¯¾ç¨‹â€æ‰“å¼€æ–°å¢è¯¾ç¨‹é¡µé¢</p><p>2ã€è¾“å…¥è¯¾ç¨‹ä¿¡æ¯ï¼Œç‚¹å‡»æäº¤</p><h1 id="ä¸‰ã€è¯¾ç¨‹ä¿¡æ¯ä¿®æ”¹"><a href="#ä¸‰ã€è¯¾ç¨‹ä¿¡æ¯ä¿®æ”¹" class="headerlink" title="ä¸‰ã€è¯¾ç¨‹ä¿¡æ¯ä¿®æ”¹"></a>ä¸‰ã€è¯¾ç¨‹ä¿¡æ¯ä¿®æ”¹</h1><h2 id="1-éœ€æ±‚åˆ†æ-2"><a href="#1-éœ€æ±‚åˆ†æ-2" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>è¯¾ç¨‹æ·»åŠ æˆåŠŸè¿›å…¥è¯¾ç¨‹ç®¡ç†é¡µé¢ï¼Œé€šè¿‡è¯¾ç¨‹ç®¡ç†é¡µé¢ä¿®æ”¹è¯¾ç¨‹çš„åŸºæœ¬ä¿¡æ¯ã€ç¼–è¾‘è¯¾ç¨‹å›¾ç‰‡ã€ç¼–è¾‘è¯¾ç¨‹è¥é”€ä¿¡æ¯ç­‰ã€‚</p><p>æœ¬å°èŠ‚å®ç°ä¿®æ”¹è¯¾ç¨‹ã€‚</p><h2 id="2-è¯¾ç¨‹ç®¡ç†é¡µé¢è¯´æ˜"><a href="#2-è¯¾ç¨‹ç®¡ç†é¡µé¢è¯´æ˜" class="headerlink" title="2. è¯¾ç¨‹ç®¡ç†é¡µé¢è¯´æ˜"></a>2. è¯¾ç¨‹ç®¡ç†é¡µé¢è¯´æ˜</h2><h3 id="é¡µé¢ç»“æ„"><a href="#é¡µé¢ç»“æ„" class="headerlink" title="é¡µé¢ç»“æ„"></a>é¡µé¢ç»“æ„</h3><p>è¯¾ç¨‹ç®¡ç†é¡µé¢çš„ç»“æ„å¦‚ä¸‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200706_Nw==/image15.png" target="_blank" rel="noopener"><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/image15.png" srcset="/img/loading.gif" alt="image-20200403221706645"></a></p><h3 id="è¯¾ç¨‹ç®¡ç†å¯¼èˆªé¡µé¢"><a href="#è¯¾ç¨‹ç®¡ç†å¯¼èˆªé¡µé¢" class="headerlink" title="è¯¾ç¨‹ç®¡ç†å¯¼èˆªé¡µé¢"></a>è¯¾ç¨‹ç®¡ç†å¯¼èˆªé¡µé¢</h3><p>1ã€å®šä¹‰<code>course_manage.vue</code>ä¸ºè¯¾ç¨‹ç®¡ç†å¯¼èˆªé¡µé¢ã€‚</p><p>å¯¼èˆªæ•ˆæœä½¿ç”¨ <code>Element-UI</code> çš„ <code>NavMenu</code> ç»„ä»¶å®ç°ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">elâ€menu</span></span><span class="hljs-tag">      <span class="hljs-attr">:default</span>â€<span class="hljs-attr">active</span>=<span class="hljs-string">"activeIndex"</span></span><span class="hljs-tag">      <span class="hljs-attr">class</span>=<span class="hljs-string">"elâ€menuâ€demo"</span></span><span class="hljs-tag">      <span class="hljs-attr">mode</span>=<span class="hljs-string">"horizontal"</span></span><span class="hljs-tag">      <span class="hljs-attr">background</span>â€<span class="hljs-attr">color</span>=<span class="hljs-string">"#eee"</span></span><span class="hljs-tag">      <span class="hljs-attr">text</span>â€<span class="hljs-attr">color</span>=<span class="hljs-string">"#000"</span></span><span class="hljs-tag">      <span class="hljs-attr">active</span>â€<span class="hljs-attr">text</span>â€<span class="hljs-attr">color</span>=<span class="hljs-string">"#000"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">routerâ€link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"muiâ€tabâ€item"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"&#123;path:'/course/manage/summary/'+this.courseid&#125;"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€menuâ€item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"1"</span>&gt;</span>è¯¾ç¨‹é¦–é¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€menuâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">routerâ€link</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">routerâ€link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"muiâ€tabâ€item"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"&#123;path:'/course/manage/baseinfo/'+this.courseid&#125;"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€menuâ€item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"2"</span>&gt;</span>åŸºæœ¬ä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€menuâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">routerâ€link</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">routerâ€link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"muiâ€tabâ€item"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"&#123;path:'/course/manage/picture/'+this.courseid&#125;"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€menuâ€item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"3"</span>&gt;</span>è¯¾ç¨‹å›¾ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€menuâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">routerâ€link</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">routerâ€link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"muiâ€tabâ€item"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"&#123;path:'/course/manage/marketinfo/'+this.courseid&#125;"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€menuâ€item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"4"</span>&gt;</span>è¯¾ç¨‹è¥é”€<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€menuâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">routerâ€link</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">routerâ€link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"muiâ€tabâ€item"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"&#123;path:'/course/manage/plan/'+this.courseid&#125;"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€menuâ€item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"5"</span>&gt;</span>è¯¾ç¨‹è®¡åˆ’<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€menuâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">routerâ€link</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">routerâ€link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"muiâ€tabâ€item"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"&#123;path:'/course/manage/teacher/'+this.courseid&#125;"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€menuâ€item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"6"</span>&gt;</span>æ•™å¸ˆä¿¡æ¯<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€menuâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">routerâ€link</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">routerâ€link</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"muiâ€tabâ€item"</span> <span class="hljs-attr">:to</span>=<span class="hljs-string">"&#123;path:'/course/manage/pub/'+this.courseid&#125;"</span>&gt;</span>              <span class="hljs-tag">&lt;<span class="hljs-name">elâ€menuâ€item</span> <span class="hljs-attr">index</span>=<span class="hljs-string">"7"</span>&gt;</span> å‘å¸ƒè¯¾ç¨‹<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€menuâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">routerâ€link</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€menu</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">routerâ€view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"main"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">routerâ€view</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> courseApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../api/course'</span>;</span><span class="javascript">  <span class="hljs-keyword">import</span> utilApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../common/utils'</span>;</span><span class="javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span>    data() &#123;<span class="actionscript">      <span class="hljs-keyword">return</span> &#123;</span><span class="actionscript">        activeIndex:<span class="hljs-string">'2'</span>,</span><span class="actionscript">        courseid:<span class="hljs-string">''</span></span>      &#125;    &#125;,    methods: &#123;    &#125;,    mounted()&#123;<span class="actionscript">      <span class="hljs-comment">//è¯¾ç¨‹id</span></span><span class="actionscript">      <span class="hljs-keyword">this</span>.courseid = <span class="hljs-keyword">this</span>.$route.params.courseid</span><span class="javascript">      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"courseid="</span> + <span class="hljs-keyword">this</span>.courseid)</span><span class="actionscript">      <span class="hljs-comment">//è·³è½¬åˆ°é¡µé¢åˆ—è¡¨</span></span><span class="actionscript">      <span class="hljs-keyword">this</span>.$router.push(&#123; path: <span class="hljs-string">'/course/manage/baseinfo/'</span>+<span class="hljs-keyword">this</span>.courseid&#125;)</span>    &#125;  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><p>2ã€<strong>åˆ›å»ºå„å„ä¿¡æ¯ç®¡ç†é¡µé¢</strong></p><p>é€šè¿‡ç®¡ç†é¡µé¢çš„å¯¼èˆªå¯ä»¥è¿›å…¥å„å„ä¿¡æ¯ç®¡ç†é¡µé¢ï¼Œè¿™é‡Œå…ˆåˆ›å»ºå„å„ä¿¡æ¯ç®¡ç†é¡µé¢ï¼Œé¡µé¢å†…å®¹æš‚</p><p>æ—¶ä¸ºç©ºï¼Œå¾…å¼€å‘æ—¶å†å®Œå–„ï¼Œåœ¨æœ¬æ¨¡å—çš„ <code>page</code> ç›®å½•ä¸‹åˆ›å»º <code>course_manage</code> ç›®å½•ï¼Œæ­¤ç›®å½•å­˜æ”¾</p><p>å„ä¸ªä¿¡æ¯ç®¡ç†é¡µé¢ï¼Œé¡µé¢æ˜ç»†å¦‚ä¸‹ï¼š</p><p>è¯¾ç¨‹ç®¡ç†é¦–é¡µï¼š<strong>course_summary.vue</strong></p><p>åŸºæœ¬ä¿¡æ¯ä¿®æ”¹é¡µé¢ï¼š<strong>course_baseinfo.vue</strong></p><p>å›¾ç‰‡ç®¡ç†é¡µé¢ï¼š<strong>course_picture.vue</strong></p><p>è¥é”€ä¿¡æ¯é¡µé¢ï¼š<strong>course_marketinfo.vue</strong></p><p>è€å¸ˆä¿¡æ¯é¡µé¢ï¼š<strong>course_teacher.vue</strong></p><p>è¯¾ç¨‹è®¡åˆ’é¡µé¢ï¼š<strong>course_plan.vue</strong></p><p>è¯¾ç¨‹å‘å¸ƒé¡µé¢ï¼š<strong>course_pub.vue</strong></p><p>3 ã€<strong>åˆ›å»ºè·¯ç”±</strong></p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> course_manage <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/course/page/course_manage.vue'</span>; <span class="hljs-keyword">import</span> course_summary <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/course/page/course_manage/course_summary.vue'</span>;<span class="hljs-keyword">import</span> course_picture <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/course/page/course_manage/course_picture.vue'</span>;<span class="hljs-keyword">import</span> course_baseinfo <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/course/page/course_manage/course_baseinfo.vue'</span>;<span class="hljs-keyword">import</span> course_marketinfo <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/course/page/course_manage/course_marketinfo.vue'</span>;<span class="hljs-keyword">import</span> course_teacher <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/course/page/course_manage/course_teacher.vue'</span>;<span class="hljs-keyword">import</span> course_plan <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/course/page/course_manage/course_plan.vue'</span>;<span class="hljs-keyword">import</span> course_pub <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/course/page/course_manage/course_pub.vue'</span>;&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/manager/:courseid'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'ç®¡ç†è¯¾ç¨‹'</span>,<span class="hljs-attr">component</span>: course_manage,<span class="hljs-attr">hidden</span>: <span class="hljs-literal">true</span> ,        children: [          &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/manage/plan/:courseid'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'è¯¾ç¨‹è®¡åˆ’'</span>,<span class="hljs-attr">component</span>: course_plan,<span class="hljs-attr">hidden</span>:<span class="hljs-literal">false</span> &#125;,          &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/manage/baseinfo/:courseid'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'åŸºæœ¬ä¿¡æ¯'</span>,<span class="hljs-attr">component</span>:course_baseinfo,<span class="hljs-attr">hidden</span>: <span class="hljs-literal">false</span> &#125;,          &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/manage/picture/:courseid'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'è¯¾ç¨‹å›¾ç‰‡'</span>,<span class="hljs-attr">component</span>:course_picture,<span class="hljs-attr">hidden</span>: <span class="hljs-literal">false</span> &#125;,          &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/manage/marketinfo/:courseid'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'è¥é”€ä¿¡æ¯'</span>,<span class="hljs-attr">component</span>:course_marketinfo,<span class="hljs-attr">hidden</span>: <span class="hljs-literal">false</span> &#125;,          &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/manage/teacher/:courseid'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'æ•™å¸ˆä¿¡æ¯'</span>,<span class="hljs-attr">component</span>:course_teacher,<span class="hljs-attr">hidden</span>: <span class="hljs-literal">false</span>&#125;,          &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/manage/pub/:courseid'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'å‘å¸ƒè¯¾ç¨‹'</span>,<span class="hljs-attr">component</span>: course_pub,<span class="hljs-attr">hidden</span>:<span class="hljs-literal">false</span>&#125;,          &#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/manage/summary/:courseid'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'è¯¾ç¨‹é¦–é¡µ'</span>,<span class="hljs-attr">component</span>:course_summary,<span class="hljs-attr">hidden</span>: <span class="hljs-literal">false</span> &#125;        ]&#125;</code></pre></div><h2 id="3-Api-æ¥å£"><a href="#3-Api-æ¥å£" class="headerlink" title="3. Api æ¥å£"></a>3. Api æ¥å£</h2><p>ä¿®æ”¹è¯¾ç¨‹éœ€è¦å¦‚ä¸‹æ¥å£ï¼š</p><p>1ã€æ ¹æ®idæŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</p><p>2ã€ä¿®æ”¹è¯¾ç¨‹æäº¤</p><p>æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><ol><li>æ ¹æ®è¯¾ç¨‹IDæŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</li></ol><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">" è·å–è¯¾ç¨‹åŸºç¡€ä¿¡æ¯"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CourseBase <span class="hljs-title">getCourseBaseById</span><span class="hljs-params">(String courseId)</span> <span class="hljs-keyword">throws</span> RuntimeException</span>;</code></pre></div><p>2ï¼‰ä¿®æ”¹è¯¾ç¨‹ä¿¡æ¯</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æ›´æ–°è¯¾ç¨‹åŸºç¡€ä¿¡æ¯"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">updateCourseBase</span><span class="hljs-params">(String id,CourseBase courseBase)</span></span>;</code></pre></div><h2 id="4-æœåŠ¡ç«¯"><a href="#4-æœåŠ¡ç«¯" class="headerlink" title="4. æœåŠ¡ç«¯"></a>4. æœåŠ¡ç«¯</h2><h3 id="Dao-3"><a href="#Dao-3" class="headerlink" title="Dao"></a>Dao</h3><p>ç•¥</p><h3 id="Service-3"><a href="#Service-3" class="headerlink" title="Service"></a>Service</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">     * æ ¹æ®è¯¾ç¨‹idæŸ¥è¯¢è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Transactional</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> CourseBase <span class="hljs-title">getCourseBaseById</span><span class="hljs-params">(String courseId)</span> </span>&#123;        <span class="hljs-keyword">if</span> (courseId == <span class="hljs-keyword">null</span>)&#123;            ExceptionCast.cast(CommonCode.INVALID_PARAM);        &#125;        Optional&lt;CourseBase&gt; optional = courseBaseRepository.findById(courseId);        <span class="hljs-keyword">if</span> (optional.isPresent())&#123;            CourseBase courseBase = optional.get();            <span class="hljs-keyword">return</span> courseBase;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æ›´æ–°è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseBase</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">updateCourseBase</span><span class="hljs-params">(String id, CourseBase courseBase)</span> </span>&#123;        CourseBase courseBaseNew = <span class="hljs-keyword">this</span>.getCourseBaseById(id);        BeanUtils.copyProperties(courseBase,courseBaseNew);        courseBaseRepository.save(courseBaseNew);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);    &#125;</code></pre></div><h3 id="Controller-3"><a href="#Controller-3" class="headerlink" title="Controller"></a>Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"coursebase/get/&#123;id&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> CourseBase <span class="hljs-title">getCourseBaseById</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String courseId) <span class="hljs-keyword">throws</span> RuntimeException </span>&#123;        <span class="hljs-keyword">return</span> courseService.getCourseBaseById(courseId);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@PutMapping</span>(<span class="hljs-string">"coursebase/update/&#123;id&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">updateCourseBase</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id,@RequestBody CourseBase courseBase) </span>&#123;        <span class="hljs-keyword">return</span> courseService.updateCourseBase(id,courseBase);    &#125;</code></pre></div><h2 id="5-å‰ç«¯"><a href="#5-å‰ç«¯" class="headerlink" title="5. å‰ç«¯"></a>5. å‰ç«¯</h2><h3 id="ä¿®æ”¹é¡µé¢"><a href="#ä¿®æ”¹é¡µé¢" class="headerlink" title="ä¿®æ”¹é¡µé¢"></a>ä¿®æ”¹é¡µé¢</h3><p>åœ¨ <code>course</code> æ¨¡å—ä¸‹çš„ <code>course_manage</code> ç›®å½•ä¸‹åˆ›å»º <code>course_baseinfo.vue</code> é¡µé¢ï¼Œæœ¬é¡µé¢å®ç°è¯¾ç¨‹ä¿®æ”¹</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">elâ€form</span> <span class="hljs-attr">:model</span>=<span class="hljs-string">"courseForm"</span> <span class="hljs-attr">label</span>â€<span class="hljs-attr">width</span>=<span class="hljs-string">"80px"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"courseRules"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"courseForm"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"è¯¾ç¨‹åç§°"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"name"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"courseForm.name"</span> <span class="hljs-attr">auto</span>â€<span class="hljs-attr">complete</span>=<span class="hljs-string">"off"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"é€‚ç”¨äººç¾¤"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"users"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textarea"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"courseForm.users"</span> <span class="hljs-attr">auto</span>â€<span class="hljs-attr">complete</span>=<span class="hljs-string">"off"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"è¯¾ç¨‹åˆ†ç±»"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"categoryActive"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€cascader</span></span><span class="hljs-tag">          <span class="hljs-attr">expand</span>â€<span class="hljs-attr">trigger</span>=<span class="hljs-string">"hover"</span></span><span class="hljs-tag">          <span class="hljs-attr">:options</span>=<span class="hljs-string">"categoryList"</span></span><span class="hljs-tag">          <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"categoryActive"</span></span><span class="hljs-tag">          <span class="hljs-attr">:props</span>=<span class="hljs-string">"props"</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€cascader</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"è¯¾ç¨‹ç­‰çº§"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"grade"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">b</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">for</span>=<span class="hljs-string">"grade in gradeList"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"courseForm.grade"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"grade.sdId"</span> &gt;</span>&#123;&#123;grade.sdName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€</span></span><span class="hljs-tag"><span class="hljs-attr">radio</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"å­¦ä¹ æ¨¡å¼"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"studymodel"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">b</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">for</span>=<span class="hljs-string">"studymodel_v in studymodelList"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"courseForm.studymodel"</span> <span class="hljs-attr">:label</span>=<span class="hljs-string">"studymodel_v.sdId"</span> &gt;</span>&#123;&#123;studymodel_v.sdName&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radio</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">b</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>           <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"è¯¾ç¨‹ä»‹ç»"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"description"</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textarea"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"courseForm.description"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€form</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"footer"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"dialogâ€footer"</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>  @<span class="hljs-attr">click.native</span>=<span class="hljs-string">"save"</span> <span class="hljs-attr">:loading</span>=<span class="hljs-string">"editLoading"</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> courseApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../api/course'</span>;</span><span class="javascript">  <span class="hljs-keyword">import</span> utilApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../../common/utils'</span>;</span><span class="javascript">  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> systemApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../../base/api/system'</span>;</span><span class="javascript">  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;</span>    data() &#123;<span class="actionscript">      <span class="hljs-keyword">return</span> &#123;</span><span class="actionscript">        courseid:<span class="hljs-string">''</span>,</span>        studymodelList:[],        gradeList:[],<span class="actionscript">        editLoading: <span class="hljs-literal">false</span>,</span>        props: &#123;<span class="actionscript">          value: <span class="hljs-string">'id'</span>,</span><span class="actionscript">          label:<span class="hljs-string">'label'</span>,</span><span class="actionscript">          children:<span class="hljs-string">'children'</span></span>        &#125;,        categoryList: [],        categoryActive:[],        courseForm: &#123;<span class="actionscript">          id:<span class="hljs-string">''</span>,</span><span class="actionscript">          name: <span class="hljs-string">''</span>,</span><span class="actionscript">          users: <span class="hljs-string">''</span>,</span><span class="actionscript">          grade:<span class="hljs-string">''</span>,</span><span class="actionscript">          studymodel:<span class="hljs-string">''</span>,</span><span class="actionscript">          mt:<span class="hljs-string">''</span>,</span><span class="actionscript">          st:<span class="hljs-string">''</span>,</span><span class="actionscript">          description: <span class="hljs-string">''</span></span>        &#125;,        courseRules: &#123;          name: [<span class="actionscript">            &#123;required: <span class="hljs-literal">true</span>, message: <span class="hljs-string">'è¯·è¾“å…¥è¯¾ç¨‹åç§°'</span>, trigger: <span class="hljs-string">'blur'</span>&#125;</span>          ],          category: [<span class="actionscript">            &#123;required: <span class="hljs-literal">true</span>, message: <span class="hljs-string">'è¯·é€‰æ‹©è¯¾ç¨‹åˆ†ç±»'</span>, trigger: <span class="hljs-string">'blur'</span>&#125;</span>          ],          grade: [<span class="actionscript">            &#123;required: <span class="hljs-literal">true</span>, message: <span class="hljs-string">'è¯·é€‰æ‹©è¯¾ç¨‹ç­‰çº§'</span>, trigger: <span class="hljs-string">'blur'</span>&#125;</span>          ],          studymodel: [<span class="actionscript">            &#123;required: <span class="hljs-literal">true</span>, message: <span class="hljs-string">'è¯·é€‰æ‹©å­¦ä¹ æ¨¡å¼'</span>, trigger: <span class="hljs-string">'blur'</span>&#125;</span>          ]         &#125;      &#125;    &#125;,    methods: &#123;      save () &#123;               &#125;    &#125;,    created()&#123;    &#125;,    mounted()&#123;        &#125;  &#125;<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></code></pre></div><h3 id="APIæ–¹æ³•"><a href="#APIæ–¹æ³•" class="headerlink" title="APIæ–¹æ³•"></a>APIæ–¹æ³•</h3><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// è·å–è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getCoursebaseById = <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl+<span class="hljs-string">'/course/coursebase/get/'</span>+id)&#125;<span class="hljs-comment">//æ›´æ–°è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> updateCoursebase= <span class="hljs-function">(<span class="hljs-params">id,course</span>) =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestPut(apiUrl+<span class="hljs-string">'/course/coursebase/update/'</span>+id,course)&#125;</code></pre></div><h3 id="è¯¾ç¨‹ä¿¡æ¯æ˜¾ç¤º"><a href="#è¯¾ç¨‹ä¿¡æ¯æ˜¾ç¤º" class="headerlink" title="è¯¾ç¨‹ä¿¡æ¯æ˜¾ç¤º"></a>è¯¾ç¨‹ä¿¡æ¯æ˜¾ç¤º</h3><p>åœ¨ <code>mounted</code> é’©å­æ–¹æ³•ä¸­æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯åŠæ•°æ®å­—å…¸ï¼š</p><div class="hljs"><pre><code class="hljs js">mounted()&#123;       <span class="hljs-comment">//æŸ¥è¯¢æ•°æ®å­—å…¸å­—å…¸</span>      systemApi.sys_getDictionary(<span class="hljs-string">'201'</span>).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<span class="hljs-comment">//        console.log(res);</span>        <span class="hljs-keyword">this</span>.studymodelList = res.dvalue;      &#125;);      systemApi.sys_getDictionary(<span class="hljs-string">'200'</span>).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;        <span class="hljs-keyword">this</span>.gradeList = res.dvalue;      &#125;);      <span class="hljs-comment">//å–è¯¾ç¨‹åˆ†ç±»</span>      courseApi.category_findlist(&#123;&#125;).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;           <span class="hljs-keyword">this</span>.categoryList = res.children;       &#125;);      <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span>        <span class="hljs-comment">//è¯¾ç¨‹id</span>        <span class="hljs-keyword">this</span>.courseid = <span class="hljs-keyword">this</span>.$route.params.courseid;        courseApi.getCoursebaseById(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;          <span class="hljs-keyword">this</span>.courseForm = res;          <span class="hljs-comment">//è¯¾ç¨‹åˆ†ç±»æ˜¾ç¤ºï¼Œéœ€è¦ä¸¤çº§åˆ†ç±»</span>          <span class="hljs-keyword">this</span>.categoryActive.push(<span class="hljs-keyword">this</span>.courseForm.mt);          <span class="hljs-keyword">this</span>.categoryActive.push(<span class="hljs-keyword">this</span>.courseForm.st);        &#125;);    &#125;</code></pre></div><h3 id="è¯¾ç¨‹ä¿®æ”¹æäº¤"><a href="#è¯¾ç¨‹ä¿®æ”¹æäº¤" class="headerlink" title="è¯¾ç¨‹ä¿®æ”¹æäº¤"></a>è¯¾ç¨‹ä¿®æ”¹æäº¤</h3><p>ç¼–è¾‘è¯¾ç¨‹æäº¤æ–¹æ³•</p><div class="hljs"><pre><code class="hljs js">methods: &#123;   save () &#123;      <span class="hljs-comment">//ä¿®æ”¹è¯¾ç¨‹</span>      <span class="hljs-keyword">this</span>.$refs.courseForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;        <span class="hljs-keyword">if</span> (valid) &#123;          <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤æäº¤å—ï¼Ÿ'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;            <span class="hljs-keyword">let</span> mt = <span class="hljs-keyword">this</span>.categoryActive[<span class="hljs-number">0</span>];            <span class="hljs-keyword">let</span> st = <span class="hljs-keyword">this</span>.categoryActive[<span class="hljs-number">1</span>];            <span class="hljs-keyword">this</span>.courseForm.mt = mt;            <span class="hljs-keyword">this</span>.courseForm.st = st;            <span class="hljs-keyword">let</span> id = <span class="hljs-keyword">this</span>.courseForm.id            courseApi.updateCoursebase(id,<span class="hljs-keyword">this</span>.courseForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;              <span class="hljs-keyword">if</span>(res.success)&#123;                <span class="hljs-keyword">this</span>.$message(&#123;                  message: <span class="hljs-string">'æäº¤æˆåŠŸ'</span>,                  type: <span class="hljs-string">'success'</span>                &#125;);              &#125;<span class="hljs-keyword">else</span>&#123;                <span class="hljs-keyword">if</span>(res.message)&#123;                  <span class="hljs-keyword">this</span>.$message.error(res.message);                &#125;<span class="hljs-keyword">else</span>&#123;                  <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);                &#125;              &#125;            &#125;);          &#125;);        &#125;      &#125;);  &#125;&#125;,</code></pre></div><h1 id="å››ã€è¯¾ç¨‹è¥é”€"><a href="#å››ã€è¯¾ç¨‹è¥é”€" class="headerlink" title="å››ã€è¯¾ç¨‹è¥é”€"></a>å››ã€è¯¾ç¨‹è¥é”€</h1><h2 id="1-éœ€æ±‚åˆ†æ-3"><a href="#1-éœ€æ±‚åˆ†æ-3" class="headerlink" title="1.éœ€æ±‚åˆ†æ"></a>1.éœ€æ±‚åˆ†æ</h2><p>è¯¾ç¨‹æ·»åŠ æˆåŠŸè¿›å…¥è¯¾ç¨‹ç®¡ç†é¡µé¢ï¼Œé€šè¿‡è¯¾ç¨‹ç®¡ç†é¡µé¢ä¿®æ”¹è¯¾ç¨‹çš„åŸºæœ¬ä¿¡æ¯ã€ç¼–è¾‘è¯¾ç¨‹å›¾ç‰‡ã€ç¼–è¾‘è¯¾ç¨‹è¥é”€ä¿¡æ¯ç­‰ã€‚</p><p>æœ¬å°èŠ‚å®ç°è¥é”€ä¿¡æ¯çš„æŸ¥è¯¢å’Œä¿®æ”¹ã€‚</p><h2 id="2-è¯¾ç¨‹ç®¡ç†é¡µé¢è¯´æ˜-1"><a href="#2-è¯¾ç¨‹ç®¡ç†é¡µé¢è¯´æ˜-1" class="headerlink" title="2.è¯¾ç¨‹ç®¡ç†é¡µé¢è¯´æ˜"></a>2.è¯¾ç¨‹ç®¡ç†é¡µé¢è¯´æ˜</h2><p><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/16.png" srcset="/img/loading.gif" alt></p><h3 id="é¡µé¢æ–¹æ³•"><a href="#é¡µé¢æ–¹æ³•" class="headerlink" title="é¡µé¢æ–¹æ³•"></a>é¡µé¢æ–¹æ³•</h3><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//è·å–è¯¾ç¨‹è¥é”€ä¿¡æ¯</span>      courseApi.getCourseMarketById(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;         <span class="hljs-comment">//console.log(res);</span>        <span class="hljs-keyword">if</span>(res &amp;&amp; res.id)&#123;           <span class="hljs-keyword">this</span>.courseMarketForm = res;        &#125;      &#125;);methods: &#123;save: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">this</span>.$refs.courseMarketForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;          <span class="hljs-keyword">if</span> (valid) &#123;            <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤æäº¤å—ï¼Ÿ'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;              courseApi.updateCourseMarket(<span class="hljs-keyword">this</span>.courseid,<span class="hljs-keyword">this</span>.courseMarketForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;               <span class="hljs-keyword">this</span>.editLoading = <span class="hljs-literal">false</span>;               <span class="hljs-keyword">if</span>(res.success)&#123;                 <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">'æäº¤æˆåŠŸ'</span>);                 <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.dotype == <span class="hljs-string">'1'</span>)&#123;                   <span class="hljs-comment">//è·³è½¬åˆ°è¯¾ç¨‹å›¾ç‰‡</span>                   <span class="hljs-keyword">this</span>.$router.push(&#123; <span class="hljs-attr">path</span>: <span class="hljs-string">'/course/add/plan/3/1/'</span>+<span class="hljs-keyword">this</span>.courseid&#125;)                 &#125;               &#125;<span class="hljs-keyword">else</span>&#123;                 <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);               &#125;               &#125;);            &#125;);          &#125;        &#125;);      &#125;</code></pre></div><h2 id="3-Apiæ¥å£"><a href="#3-Apiæ¥å£" class="headerlink" title="3.Apiæ¥å£"></a>3.Apiæ¥å£</h2><p>è¯¾ç¨‹è¥é”€éœ€è¦å¦‚ä¸‹æ¥å£ï¼š</p><p>1ã€æ ¹æ®idæŸ¥è¯¢è¯¾ç¨‹è¥é”€ä¿¡æ¯</p><p>2ã€ä¿®æ”¹è¯¾ç¨‹è¥é”€ä¿¡æ¯æäº¤</p><p>æ¥å£å®šä¹‰å¦‚ä¸‹ï¼š</p><ol><li>æ ¹æ®è¯¾ç¨‹IDæŸ¥è¯¢è¯¾ç¨‹è¥é”€ä¿¡æ¯</li></ol><div class="hljs"><pre><code class="hljs arduino">@ApiOperation(<span class="hljs-string">"è·å–è¯¾ç¨‹è¥é”€ä¿¡æ¯"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CourseMarket <span class="hljs-title">getCourseMarketById</span><span class="hljs-params">(<span class="hljs-keyword">String</span> CourseMarketId)</span></span>;</code></pre></div><p>2ï¼‰ä¿®æ”¹è¯¾ç¨‹è¥é”€ä¿¡æ¯</p><div class="hljs"><pre><code class="hljs reasonml">@<span class="hljs-constructor">ApiOperation(<span class="hljs-string">"æ›´æ–°æˆ–æ·»åŠ è¯¾ç¨‹è¥é”€ä¿¡æ¯"</span>)</span>public ResponseResult update<span class="hljs-constructor">CourseMarket(String <span class="hljs-params">id</span>,CourseMarket <span class="hljs-params">courseMarket</span>)</span>;</code></pre></div><h2 id="4-æœåŠ¡ç«¯-1"><a href="#4-æœåŠ¡ç«¯-1" class="headerlink" title="4. æœåŠ¡ç«¯"></a>4. æœåŠ¡ç«¯</h2><h3 id="Dao-4"><a href="#Dao-4" class="headerlink" title="Dao"></a>Dao</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseMarketRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">CourseMarket</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div><h3 id="Service-4"><a href="#Service-4" class="headerlink" title="Service"></a>Service</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseMarketService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CourseMarketRepository courseMarketRepository;    <span class="hljs-meta">@Transactional</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> CourseMarket <span class="hljs-title">getCourseMarketById</span><span class="hljs-params">(String courseMarketId)</span> </span>&#123;        <span class="hljs-keyword">if</span> (StringUtils.isEmpty(courseMarketId))&#123;            ExceptionCast.cast(CommonCode.INVALID_PARAM);        &#125;        Optional&lt;CourseMarket&gt; optional = courseMarketRepository.findById(courseMarketId);        <span class="hljs-keyword">if</span> (optional.isPresent())&#123;            <span class="hljs-keyword">return</span> optional.get();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-meta">@Transactional</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">updateCourseMarket</span><span class="hljs-params">(String id, CourseMarket courseMarket)</span> </span>&#123;        <span class="hljs-keyword">if</span> (StringUtils.isEmpty(id))&#123;            ExceptionCast.cast(CommonCode.INVALID_PARAM);        &#125;        <span class="hljs-keyword">if</span> (courseMarket == <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;        &#125;        CourseMarket courseMarketOld = <span class="hljs-keyword">this</span>.getCourseMarketById(id);        <span class="hljs-keyword">if</span> (courseMarketOld == <span class="hljs-keyword">null</span>)&#123;            courseMarketRepository.save(courseMarket);        &#125;<span class="hljs-keyword">else</span> &#123;            BeanUtils.copyProperties(courseMarket,courseMarketOld);            courseMarketRepository.save(courseMarketOld);        &#125;        <span class="hljs-keyword">return</span> ResponseResult.SUCCESS();    &#125;&#125;</code></pre></div><h3 id="Controller-4"><a href="#Controller-4" class="headerlink" title="Controller"></a>Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/market/get/&#123;id&#125;"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CourseMarket <span class="hljs-title">getCourseMarketById</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String CourseMarketId) </span>&#123;    <span class="hljs-keyword">return</span> courseMarketService.getCourseMarketById(CourseMarketId);&#125;<span class="hljs-meta">@Override</span><span class="hljs-meta">@PutMapping</span>(<span class="hljs-string">"market/update/&#123;id&#125;"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">updateCourseMarket</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id,</span><span class="hljs-function">                                         @RequestBody CourseMarket courseMarket) </span>&#123;    <span class="hljs-keyword">return</span> courseMarketService.updateCourseMarket(id,courseMarket);&#125;</code></pre></div><h2 id="5-å‰ç«¯-1"><a href="#5-å‰ç«¯-1" class="headerlink" title="5.å‰ç«¯"></a>5.å‰ç«¯</h2><h3 id="APIæ–¹æ³•-1"><a href="#APIæ–¹æ³•-1" class="headerlink" title="APIæ–¹æ³•"></a>APIæ–¹æ³•</h3><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//è·å–è¯¾ç¨‹è¥é”€ä¿¡æ¯</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getCourseMarketById = <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl + <span class="hljs-string">'/course/market/get/'</span>+id)&#125;<span class="hljs-comment">//æ›´æ–°æˆ–æ·»åŠ è¯¾ç¨‹è¥é”€ä¿¡æ¯</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> updateCourseMarket= <span class="hljs-function">(<span class="hljs-params">id,courseMarket</span>) =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestPut(apiUrl+<span class="hljs-string">'/course/market/update/'</span>+id,courseMarket)&#125;</code></pre></div><h3 id="æµ‹è¯•-3"><a href="#æµ‹è¯•-3" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><img src="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/17.png" srcset="/img/loading.gif" alt></p><p>ä¿®æ”¹æ–¹æ³•ä¹Ÿé€šè¿‡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MyBatis</tag>
      
      <tag>Spring Data MongoDB</tag>
      
      <tag>Spring Data Jpa</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day06ï¼šé¡µé¢å‘å¸ƒã€è¯¾ç¨‹ç®¡ç†</title>
    <link href="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/"/>
    <url>/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day06</code> çš„å†…å®¹</p><ul><li><p>ä½¿ç”¨ <code>Spring boot</code> é›†æˆ <code>RabbitMQ</code> å’Œ <code>GridFS</code> å®ç°åŸºäºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹çš„é¡µé¢é™æ€åŒ–å‘å¸ƒçš„æµç¨‹ã€‚</p><p>åœ¨æœ¬ç« èŠ‚çš„çŸ¥è¯†ç‚¹ä¸­ï¼Œå†æ¬¡å¤ä¹ äº†åŸºäº <code>GridFS</code> å’Œ <code>RabbitMQ</code> çš„åˆ†å¸ƒå¼é™æ€é¡µé¢å‘å¸ƒçš„çŸ¥è¯†ç‚¹ï¼Œæ·±åŒ–äº†è®°å¿†ã€‚</p><p>â€‹</p></li><li><p>ä½¿ç”¨ä¸‰çº§èœå•å®ç°è¯¾ç¨‹è®¡åˆ’çš„æŸ¥è¯¢å’Œæ·»åŠ </p><p>è¿™é‡Œçš„æŠ€æœ¯ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œç”¨åˆ°äº† <code>Mysql</code> çš„è¡¨å†…è‡ªè¿æ¥æŸ¥è¯¢ï¼Œä»¥åŠåœ¨æ·»åŠ è¯¾ç¨‹çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€äº›æ„å¤–æƒ…å†µçš„å‘ç”Ÿï¼Œä¾‹å¦‚å†æ·»åŠ è¯¾ç¨‹æ—¶ï¼Œå¦‚æœè¯¥è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹ï¼ˆä¸€çº§èœå•ï¼‰ä¸å­˜åœ¨ï¼Œåˆ™éœ€è¦ä¸ºè¯¥è¯¾ç¨‹æ·»åŠ ä¸€ä¸ªæ ¹èŠ‚ç‚¹åå†è¿›è¡Œè¯¥äºŒçº§èŠ‚ç‚¹çš„æ·»åŠ ã€‚</p></li></ul><h1 id="ä¸€ã€é¡µé¢å‘å¸ƒ"><a href="#ä¸€ã€é¡µé¢å‘å¸ƒ" class="headerlink" title="ä¸€ã€é¡µé¢å‘å¸ƒ"></a>ä¸€ã€é¡µé¢å‘å¸ƒ</h1><h2 id="1-æŠ€æœ¯æ–¹æ¡ˆ"><a href="#1-æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="1. æŠ€æœ¯æ–¹æ¡ˆ"></a>1. æŠ€æœ¯æ–¹æ¡ˆ</h2><p>æœ¬é¡¹ç›®ä½¿ç”¨MQå®ç°é¡µé¢å‘å¸ƒçš„æŠ€æœ¯æ–¹æ¡ˆå¦‚ä¸‹:</p><p><img src="https://qnoss.codeyee.com/20200706_Ng==/image1.png" srcset="/img/loading.gif" alt="å­¦æˆåœ¨çº¿day06/image1.png)"></p><p>*<em>æŠ€æœ¯æ–¹æ¡ˆè¯´æ˜ *</em></p><p>1ã€å¹³å°åŒ…æ‹¬å¤šä¸ªç«™ç‚¹ï¼Œé¡µé¢å½’å±ä¸åŒçš„ç«™ç‚¹ã€‚</p><p>2ã€å‘å¸ƒä¸€ä¸ªé¡µé¢åº”å°†è¯¥é¡µé¢å‘å¸ƒåˆ°æ‰€å±ç«™ç‚¹çš„æœåŠ¡å™¨ä¸Šã€‚</p><p>3ã€æ¯ä¸ªç«™ç‚¹æœåŠ¡éƒ¨ç½² <code>cms client</code> ç¨‹åºï¼Œå¹¶ä¸äº¤æ¢æœºç»‘å®šï¼Œç»‘å®šæ—¶æŒ‡å®šç«™ç‚¹Idä¸ºroutingKeyã€‚</p><p>æŒ‡å®šç«™ç‚¹idä¸º <code>routingKey</code> å°±å¯ä»¥å®ç° <code>cms client</code> åªèƒ½æ¥æ”¶åˆ°æ‰€å±ç«™ç‚¹çš„é¡µé¢å‘å¸ƒæ¶ˆæ¯ã€‚</p><p>4ã€é¡µé¢å‘å¸ƒç¨‹åºå‘MQå‘å¸ƒæ¶ˆæ¯æ—¶æŒ‡å®šé¡µé¢æ‰€å±ç«™ç‚¹ <code>Id</code> ä¸º <code>routingKey</code>ï¼Œå°†è¯¥é¡µé¢å‘å¸ƒåˆ°å®ƒæ‰€åœ¨æœåŠ¡å™¨ä¸Šçš„<code>cms client</code>ã€‚</p><p><strong>è·¯ç”±æ¨¡å¼åˆ†æå¦‚ä¸‹</strong></p><p>å‘å¸ƒä¸€ä¸ªé¡µé¢ï¼Œéœ€å‘å¸ƒåˆ°è¯¥é¡µé¢æ‰€å±çš„æ¯ä¸ªç«™ç‚¹æœåŠ¡å™¨ï¼Œå…¶å®ƒç«™ç‚¹æœåŠ¡å™¨ä¸å‘å¸ƒã€‚</p><p>æ¯”å¦‚ å‘å¸ƒä¸€ä¸ªé—¨æˆ·çš„é¡µé¢ï¼Œéœ€è¦å‘å¸ƒåˆ°æ¯ä¸ªé—¨æˆ·æœåŠ¡å™¨ä¸Šï¼Œè€Œç”¨æˆ·ä¸­å¿ƒæœåŠ¡å™¨åˆ™ä¸éœ€è¦å‘å¸ƒã€‚</p><p>æ‰€ä»¥æœ¬é¡¹ç›®é‡‡ç”¨ <code>routing</code> æ¨¡å¼ï¼Œç”¨ç«™ç‚¹ <code>id</code> ä½œä¸º <code>routingKey</code>ï¼Œè¿™æ ·å°±å¯ä»¥åŒ¹é…é¡µé¢åªå‘å¸ƒåˆ°æ‰€å±çš„ç«™ç‚¹æœåŠ¡å™¨ä¸Šã€‚</p><p><strong>é¡µé¢å‘å¸ƒæµç¨‹å›¾å¦‚ä¸‹</strong></p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image2.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image2.png" srcset="/img/loading.gif" alt="image-20200401211714847"></a></p><p>1ã€å‰ç«¯è¯·æ±‚ <code>cms</code> æ‰§è¡Œé¡µé¢å‘å¸ƒã€‚</p><p>2ã€<code>cms</code> æ‰§è¡Œé™æ€åŒ–ç¨‹åºç”Ÿæˆ <code>html</code>æ–‡ä»¶ã€‚</p><p>3ã€<code>cms</code> å°† <code>html</code> æ–‡ä»¶å­˜å‚¨åˆ° <code>GridFS</code> ä¸­ã€‚</p><p>4ã€<code>cms</code> å‘ <code>MQ</code> å‘é€é¡µé¢å‘å¸ƒæ¶ˆæ¯</p><p>5ã€<code>MQ</code> å°†é¡µé¢å‘å¸ƒæ¶ˆæ¯é€šçŸ¥ç»™ <code>Cms Client</code></p><p>6ã€<code>Cms Client</code> ä» <code>GridFS</code> ä¸­ä¸‹è½½ <code>html</code> æ–‡ä»¶</p><p>7ã€<code>Cms Client</code> å°† <code>html</code> ä¿å­˜åˆ°æ‰€åœ¨æœåŠ¡å™¨æŒ‡å®šç›®å½•</p><h2 id="2-é¡µé¢å‘å¸ƒæ¶ˆè´¹æ–¹"><a href="#2-é¡µé¢å‘å¸ƒæ¶ˆè´¹æ–¹" class="headerlink" title="2. é¡µé¢å‘å¸ƒæ¶ˆè´¹æ–¹"></a>2. é¡µé¢å‘å¸ƒæ¶ˆè´¹æ–¹</h2><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>åŠŸèƒ½åˆ†æ</p><p>åˆ›å»º <code>Cms Client</code> å·¥ç¨‹ä½œä¸ºé¡µé¢å‘å¸ƒæ¶ˆè´¹æ–¹ï¼Œå°† <code>Cms Client</code> éƒ¨ç½²åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå®ƒè´Ÿè´£æ¥æ”¶åˆ°é¡µé¢å‘å¸ƒ çš„æ¶ˆæ¯åä» <code>GridFS</code> ä¸­ä¸‹è½½æ–‡ä»¶åœ¨æœ¬åœ°ä¿å­˜ã€‚</p><p>éœ€æ±‚å¦‚ä¸‹</p><p>1ã€å°† <code>cms Client</code> éƒ¨ç½²åœ¨æœåŠ¡å™¨ï¼Œé…ç½®é˜Ÿåˆ—åç§°å’Œç«™ç‚¹ <code>ID</code>ã€‚</p><p>2ã€<code>cms Client</code> è¿æ¥ <code>RabbitMQ</code> å¹¶ç›‘å¬å„è‡ªçš„â€œé¡µé¢å‘å¸ƒé˜Ÿåˆ—â€</p><p>3ã€<code>cms Client</code> æ¥æ”¶é¡µé¢å‘å¸ƒé˜Ÿåˆ—çš„æ¶ˆæ¯</p><p>4ã€æ ¹æ®æ¶ˆæ¯ä¸­çš„é¡µé¢ <code>id</code> ä» <code>mongodb</code> æ•°æ®åº“ä¸‹è½½é¡µé¢åˆ°æœ¬åœ°</p><h3 id="åˆ›å»ºCms-Clientå·¥ç¨‹"><a href="#åˆ›å»ºCms-Clientå·¥ç¨‹" class="headerlink" title="åˆ›å»ºCms Clientå·¥ç¨‹"></a>åˆ›å»ºCms Clientå·¥ç¨‹</h3><h4 id="1ã€POMé…ç½®"><a href="#1ã€POMé…ç½®" class="headerlink" title="1ã€POMé…ç½®"></a>1ã€POMé…ç½®</h4><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../xc-framework-parent/pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-manage-cms-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-comment">&lt;!--é¡¹ç›®ä¾èµ–--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-model<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><h4 id="2ã€é…ç½®æ–‡ä»¶"><a href="#2ã€é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€é…ç½®æ–‡ä»¶"></a>2ã€é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>resources</code>ä¸‹é…ç½® <code>application.yml</code>ã€‚</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">31000</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">xc-service-manage-cms-client</span>  <span class="hljs-attr">data:</span>    <span class="hljs-attr">mongodb:</span>      <span class="hljs-attr">uri:</span> <span class="hljs-string">mongodb://root:123123@localhost:27017</span>      <span class="hljs-attr">database:</span> <span class="hljs-string">xc_cms</span>  <span class="hljs-attr">rabbitmq:</span>    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span>  <span class="hljs-attr">freemarker:</span>    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#å…³é—­æ¨¡æ¿ç¼“å­˜ï¼Œæ–¹ä¾¿æµ‹è¯•</span>    <span class="hljs-attr">settings:</span>      <span class="hljs-attr">template_update_delay:</span> <span class="hljs-number">0</span><span class="hljs-attr">xuecheng:</span>  <span class="hljs-attr">mq:</span>  <span class="hljs-comment">#cmså®¢æˆ·ç«¯ç›‘æ§çš„é˜Ÿåˆ—åç§°ï¼ˆä¸åŒçš„å®¢æˆ·ç«¯ç›‘æ§çš„é˜Ÿåˆ—ä¸èƒ½é‡å¤ï¼‰</span>    <span class="hljs-attr">queue:</span> <span class="hljs-string">queue_cms_postpage_01</span>    <span class="hljs-attr">routingKey:</span> <span class="hljs-string">5a751fab6abb5044e0d19ea1</span> <span class="hljs-comment">#æ­¤routingKeyä¸ºé—¨æˆ·ç«™ç‚¹ID3</span></code></pre></div><p>è¯´æ˜ åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®é˜Ÿåˆ—çš„åç§°ï¼Œæ¯ä¸ª cms clientåœ¨éƒ¨ç½²æ—¶æ³¨æ„é˜Ÿåˆ—åç§°ä¸è¦é‡å¤</p><h4 id="3ã€å¯åŠ¨ç±»"><a href="#3ã€å¯åŠ¨ç±»" class="headerlink" title="3ã€å¯åŠ¨ç±»"></a>3ã€å¯åŠ¨ç±»</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms_client;<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;<span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)<span class="hljs-comment">//æ‰«æcommonä¸‹çš„æ‰€æœ‰ç±»</span><span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.manage_cms_client"</span>&#125;)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCmsClientApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(ManageCmsClientApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;    &#125;&#125;</code></pre></div><h3 id="RabbitmqConfig-é…ç½®ç±»"><a href="#RabbitmqConfig-é…ç½®ç±»" class="headerlink" title="RabbitmqConfig é…ç½®ç±»"></a>RabbitmqConfig é…ç½®ç±»</h3><p>æ¶ˆæ¯é˜Ÿåˆ—è®¾ç½®å¦‚ä¸‹</p><p>1ã€åˆ›å»º <code>ex_cms_postpage</code> äº¤æ¢æœº</p><p>2ã€æ¯ä¸ª <code>Cms Client</code> åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ä¸äº¤æ¢æœºç»‘å®š</p><p>3ã€æ¯ä¸ª <code>Cms Client</code> ç¨‹åºé…ç½®é˜Ÿåˆ—åç§°å’Œ <code>routingKey</code>ï¼Œå°†ç«™ç‚¹IDä½œä¸º<code>routingKey</code>ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms_client.config;<span class="hljs-keyword">import</span> org.springframework.amqp.core.*;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitmqConfig</span> </span>&#123;    <span class="hljs-comment">//é˜Ÿåˆ—beançš„åç§°</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_CMS_POSTPAGE = <span class="hljs-string">"queue_cms_postpage"</span>;    <span class="hljs-comment">//äº¤æ¢æœºçš„åç§°</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EX_ROUTING_CMS_POSTPAGE = <span class="hljs-string">"ex_routing_cms_postpage"</span>;    <span class="hljs-comment">//é˜Ÿåˆ—çš„åç§°</span>    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.mq.queue&#125;"</span>)    <span class="hljs-keyword">public</span> String queue_cms_postpage_name;    <span class="hljs-comment">//ç«™ç‚¹idä½œä¸ºrouting key</span>    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.mq.routingKey&#125;"</span>)    <span class="hljs-keyword">public</span> String routingKey;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * é…ç½®directäº¤æ¢æœº</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Bean</span>(EX_ROUTING_CMS_POSTPAGE)    <span class="hljs-function"><span class="hljs-keyword">public</span> Exchange <span class="hljs-title">EXCHANGE_DIRECT_INFORM</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(EX_ROUTING_CMS_POSTPAGE).durable(<span class="hljs-keyword">true</span>).build();    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å£°æ˜é˜Ÿåˆ—</span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Bean</span>(QUEUE_CMS_POSTPAGE)    <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">QUEUE_CMS_POSTPAGE</span><span class="hljs-params">()</span></span>&#123;        Queue queue = <span class="hljs-keyword">new</span> Queue(queue_cms_postpage_name);        <span class="hljs-keyword">return</span> queue;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> queue</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> exchange</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">BINDING_QUEUE_INFORM_SMS</span><span class="hljs-params">(@Qualifier(QUEUE_CMS_POSTPAGE)</span> Queue queue,</span><span class="hljs-function">                                            @<span class="hljs-title">Qualifier</span><span class="hljs-params">(EX_ROUTING_CMS_POSTPAGE)</span> Exchange exchange)</span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(routingKey).noargs();    &#125;&#125;</code></pre></div><p>é…ç½® MongoConfig</p><blockquote><p>åç»­çš„ä»£ç ä¸­éœ€è¦å°†GridFSBucketæ³¨å…¥æˆbean</p></blockquote><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms_client.config;<span class="hljs-keyword">import</span> com.mongodb.MongoClient;<span class="hljs-keyword">import</span> com.mongodb.client.MongoDatabase;<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSBucket;<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSBuckets;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MongoConfig</span> </span>&#123;    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;spring.data.mongodb.database&#125;"</span>)    String db;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> GridFSBucket <span class="hljs-title">getGridFSBucket</span><span class="hljs-params">(MongoClient mongoClient)</span></span>&#123;        MongoDatabase database = mongoClient.getDatabase(db);        GridFSBucket gridFSBucket = GridFSBuckets.create(database);        <span class="hljs-keyword">return</span> gridFSBucket;    &#125;&#125;</code></pre></div><h3 id="å®šä¹‰æ¶ˆæ¯æ ¼å¼"><a href="#å®šä¹‰æ¶ˆæ¯æ ¼å¼" class="headerlink" title="å®šä¹‰æ¶ˆæ¯æ ¼å¼"></a>å®šä¹‰æ¶ˆæ¯æ ¼å¼</h3><p>æ¶ˆæ¯å†…å®¹é‡‡ç”¨ <code>json</code> æ ¼å¼å­˜å‚¨æ•°æ®ï¼Œå¦‚ä¸‹</p><p>é¡µé¢id å‘å¸ƒé¡µé¢çš„id</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"pageId"</span>:<span class="hljs-string">""</span>&#125;</code></pre></div><h3 id="PageDao"><a href="#PageDao" class="headerlink" title="PageDao"></a>PageDao</h3><p>1ã€ä½¿ç”¨ <code>CmsPageRepository</code> æŸ¥è¯¢é¡µé¢ä¿¡æ¯</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsPage</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div><p>2ã€ä½¿ç”¨ <code>CmsSiteRepository</code> æŸ¥è¯¢ç«™ç‚¹ä¿¡æ¯ï¼Œä¸»è¦è·å–ç«™ç‚¹ç‰©ç†è·¯å¾„</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsSiteRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsSite</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div><h3 id="PageService"><a href="#PageService" class="headerlink" title="PageService"></a>PageService</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms_client.service;<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSBucket;<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSDownloadStream;<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.model.GridFSFile;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsSite;<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CmsCode;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms_client.dao.CmsPageRepository;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms_client.dao.CmsSiteRepository;<span class="hljs-keyword">import</span> org.apache.commons.io.IOUtils;<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.query.Criteria;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.query.Query;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsResource;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsTemplate;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-keyword">import</span> javax.annotation.Resource;<span class="hljs-keyword">import</span> java.io.File;<span class="hljs-keyword">import</span> java.io.FileOutputStream;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.io.InputStream;<span class="hljs-keyword">import</span> java.util.Optional;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CmsPageRepository cmsPageRepository;    <span class="hljs-meta">@Autowired</span>    CmsSiteRepository cmsSiteRepository;    <span class="hljs-meta">@Autowired</span>    GridFsTemplate gridFsTemplate;    <span class="hljs-meta">@Autowired</span>    GridFSBucket gridFSBucket;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å°†é¡µé¢htmlä¿å­˜åˆ°é¡µé¢ç‰©ç†è·¯å¾„</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageId</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">savePageToServerPath</span><span class="hljs-params">(String pageId)</span></span>&#123;        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(pageId);        <span class="hljs-comment">//é¡µé¢ä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸</span>        <span class="hljs-keyword">if</span>(!optional.isPresent())&#123;            ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);        &#125;        CmsPage cmsPage = optional.get();        CmsSite cmsSite = <span class="hljs-keyword">this</span>.getCmsSiteById(cmsPage.getSiteId());        <span class="hljs-keyword">if</span>(cmsSite == <span class="hljs-keyword">null</span>)&#123;            ExceptionCast.cast(CmsCode.CMS_SIZE_NOT_EXISTS);        &#125;        <span class="hljs-comment">//åŸè®²ä¹‰å’Œè§†é¢‘ä¸­ä½¿ç”¨çš„æ˜¯sizePathysicaiPath,ä½†æ˜¯SizePageä¸­æ²¡æœ‰è¿™ä¸ªå­—æ®µï¼Œä½¿ç”¨PageCmsä¸­çš„PathysicaiPathä»£æ›¿</span>        String pagePath = cmsPage.getPagePhysicalPath() + cmsPage.getPageWebPath() + cmsPage.getPageName();        <span class="hljs-comment">//è·å–é¡µé¢æ–‡ä»¶id</span>        String htmlFileId = cmsPage.getHtmlFileId();        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(htmlFileId))&#123;            ExceptionCast.cast(CmsCode.CMS_PAGE_FILEID_NOT_EXISTS);        &#125;        <span class="hljs-comment">//è·å–æ–‡ä»¶æµ</span>        InputStream inputStream = <span class="hljs-keyword">this</span>.getFileInputStreamFileById(htmlFileId);        <span class="hljs-keyword">if</span>(inputStream == <span class="hljs-keyword">null</span>)&#123;            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_HTML_IS_NULL);        &#125;        FileOutputStream fileOutputStream = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            fileOutputStream = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-keyword">new</span> File(pagePath));            <span class="hljs-comment">//å°†æ–‡ä»¶ä¿å­˜è‡³ç‰©ç†è·¯å¾„</span>            IOUtils.copy(inputStream,fileOutputStream);        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;            e.printStackTrace();        &#125;<span class="hljs-keyword">finally</span> &#123;            <span class="hljs-comment">//å…³é—­æµ</span>            <span class="hljs-keyword">try</span> &#123;                inputStream.close();            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;                e.printStackTrace();            &#125; <span class="hljs-keyword">try</span> &#123;                fileOutputStream.close();            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;                e.printStackTrace();            &#125;        &#125;    &#125;    <span class="hljs-comment">//æ ¹æ®æ–‡ä»¶idè·å–æ–‡ä»¶çš„gridFSè¾“å…¥æµ</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> InputStream <span class="hljs-title">getFileInputStreamFileById</span><span class="hljs-params">(String fileId)</span></span>&#123;        GridFSFile gridFSFile = gridFsTemplate.findOne(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(fileId)));        <span class="hljs-comment">//è·å–gridFsä¸‹è½½æµ</span>        GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(gridFSFile.getObjectId());        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">//è·å–æ–‡ä»¶è¾“å…¥æµ</span>            GridFsResource gridFsResource = <span class="hljs-keyword">new</span> GridFsResource(gridFSFile, gridFSDownloadStream);            <span class="hljs-keyword">return</span> gridFsResource.getInputStream();        &#125;<span class="hljs-keyword">catch</span> (IOException e)&#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-comment">//æ ¹æ®ç«™ç‚¹idå¾—åˆ°ç«™ç‚¹ä¿¡æ¯</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> CmsSite <span class="hljs-title">getCmsSiteById</span><span class="hljs-params">(String siteId)</span></span>&#123;        Optional&lt;CmsSite&gt; optional = cmsSiteRepository.findById(siteId);        <span class="hljs-keyword">if</span>(!optional.isPresent())&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;        &#125;        CmsSite cmsSite = optional.get();        <span class="hljs-keyword">return</span> cmsSite;    &#125;&#125;</code></pre></div><h3 id="ConsumerPostPage"><a href="#ConsumerPostPage" class="headerlink" title="ConsumerPostPage"></a>ConsumerPostPage</h3><p>åœ¨ <code>cms client</code> å·¥ç¨‹çš„ <code>mq</code> åŒ…ä¸‹åˆ›å»º <code>ConsumerPostPage</code> ç±»ï¼Œ<code>ConsumerPostPage</code> ä½œä¸ºå‘å¸ƒé¡µé¢çš„æ¶ˆè´¹å®¢æˆ·ç«¯ï¼Œç›‘å¬é¡µé¢å‘å¸ƒé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œæ”¶åˆ°æ¶ˆæ¯åä» <code>mongodb</code> ä¸‹è½½æ–‡ä»¶ï¼Œä¿å­˜åœ¨æœ¬åœ°ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms_client.mq;<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms_client.dao.CmsPageRepository;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms_client.service.PageService;<span class="hljs-keyword">import</span> org.slf4j.Logger;<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<span class="hljs-keyword">import</span> java.util.Map;<span class="hljs-keyword">import</span> java.util.Optional;<span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsumerPostPage</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ConsumerPostPage<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;    <span class="hljs-meta">@Autowired</span>    CmsPageRepository cmsPageRepository;    <span class="hljs-meta">@Autowired</span>    PageService pageService;    <span class="hljs-meta">@RabbitListener</span>(queues = &#123;<span class="hljs-string">"$&#123;xuecheng.mq.queue&#125;"</span>&#125;) <span class="hljs-comment">//ç›‘å¬é˜Ÿåˆ—</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postPage</span><span class="hljs-params">(String msg)</span></span>&#123;        <span class="hljs-comment">//è§£ææ¶ˆæ¯</span>        Map map = JSON.parseObject(msg, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;        LOGGER.info(<span class="hljs-string">"receive cms post page:&#123;&#125;"</span>, msg.toString());        <span class="hljs-comment">//å–å‡ºé¡µé¢id</span>        String pageId = (String) map.get(<span class="hljs-string">"pageId"</span>);        <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(pageId);        <span class="hljs-keyword">if</span>(!optional.isPresent())&#123;            LOGGER.error(<span class="hljs-string">"receive cms post page,cmsPage is null: &#123;&#125;"</span>,msg.toString());        &#125;        <span class="hljs-comment">//å°†é¡µé¢ä¿å­˜åˆ°æœåŠ¡å™¨ç‰©ç†è·¯å¾„</span>        pageService.savePageToServerPath(pageId);    &#125;&#125;</code></pre></div><h2 id="3-é¡µé¢å‘å¸ƒç”Ÿäº§æ–¹"><a href="#3-é¡µé¢å‘å¸ƒç”Ÿäº§æ–¹" class="headerlink" title="3. é¡µé¢å‘å¸ƒç”Ÿäº§æ–¹"></a>3. é¡µé¢å‘å¸ƒç”Ÿäº§æ–¹</h2><h3 id="éœ€æ±‚åˆ†æ-1"><a href="#éœ€æ±‚åˆ†æ-1" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>ç®¡ç†å‘˜é€šè¿‡ <code>cms</code> ç³»ç»Ÿå‘å¸ƒ â€œ<strong>é¡µé¢å‘å¸ƒ</strong>â€ çš„æ¶ˆè´¹ï¼Œ<code>cms</code> ç³»ç»Ÿä½œä¸ºé¡µé¢å‘å¸ƒçš„ç”Ÿäº§æ–¹ã€‚<br>éœ€æ±‚å¦‚ä¸‹</p><p>1ã€ç®¡ç†å‘˜è¿›å…¥ç®¡ç†ç•Œé¢ç‚¹å‡»â€œé¡µé¢å‘å¸ƒâ€ï¼Œå‰ç«¯è¯·æ±‚cmsé¡µé¢å‘å¸ƒæ¥å£ã€‚</p><p>2ã€cmsé¡µé¢å‘å¸ƒæ¥å£æ‰§è¡Œé¡µé¢é™æ€åŒ–ï¼Œå¹¶å°†é™æ€åŒ–é¡µé¢å­˜å‚¨è‡³GridFSä¸­ã€‚</p><p>3ã€é™æ€åŒ–æˆåŠŸåï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€é¡µé¢å‘å¸ƒçš„æ¶ˆæ¯ã€‚</p><p> 1ï¼‰ è·å–é¡µé¢çš„ä¿¡æ¯åŠé¡µé¢æ‰€å±ç«™ç‚¹IDã€‚</p><p> 2ï¼‰ è®¾ç½®æ¶ˆæ¯å†…å®¹ä¸ºé¡µé¢IDã€‚ï¼ˆé‡‡ç”¨jsonæ ¼å¼ï¼Œæ–¹ä¾¿æ—¥åæ‰©å±•ï¼‰</p><p> 3ï¼‰ å‘é€æ¶ˆæ¯ç»™ <code>ex_cms_postpage</code> äº¤æ¢æœºï¼Œå¹¶å°†ç«™ç‚¹IDä½œä¸º <code>routingKey</code>ã€‚</p><h3 id="RabbitMQé…ç½®"><a href="#RabbitMQé…ç½®" class="headerlink" title="RabbitMQé…ç½®"></a>RabbitMQé…ç½®</h3><p>1ã€é…ç½® <code>Rabbitmq</code> çš„è¿æ¥å‚æ•°</p><p>åœ¨ <code>application.yml</code> æ·»åŠ å¦‚ä¸‹é…ç½®</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span>  <span class="hljs-attr">rabbitmq:</span>    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>    <span class="hljs-attr">virtualHost:</span> <span class="hljs-string">/</span></code></pre></div><p>2ã€åœ¨ <code>pom.xml</code> æ·»åŠ ä¾èµ–</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springâ€bootâ€starterâ€amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>3ã€<code>RabbitMQConfig</code> é…ç½®</p><p>ç”±äº <code>cms</code> ä½œä¸ºé¡µé¢å‘å¸ƒæ–¹è¦é¢å¯¹å¾ˆå¤šä¸åŒç«™ç‚¹çš„æœåŠ¡å™¨ï¼Œé¢å¯¹å¾ˆå¤šé¡µé¢å‘å¸ƒé˜Ÿåˆ—ï¼Œæ‰€ä»¥è¿™é‡Œä¸å†é…ç½®é˜Ÿåˆ—ï¼Œåªéœ€è¦é…ç½®äº¤æ¢æœºåç§°å³å¯ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.config;<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;<span class="hljs-keyword">import</span> org.springframework.amqp.core.Exchange;<span class="hljs-keyword">import</span> org.springframework.amqp.core.ExchangeBuilder;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitmqConfig</span> </span>&#123;    <span class="hljs-comment">//äº¤æ¢æœºçš„åç§°</span>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EX_ROUTING_CMS_POSTPAGE=<span class="hljs-string">"ex_routing_cms_postpage"</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * äº¤æ¢é…ç½®ä½¿ç”¨directç±»å‹</span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Bean</span>(EX_ROUTING_CMS_POSTPAGE)    <span class="hljs-function"><span class="hljs-keyword">public</span> Exchange <span class="hljs-title">EXCHANGE_TOPICS_INFORM</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(EX_ROUTING_CMS_POSTPAGE).durable(<span class="hljs-keyword">true</span>).build();    &#125;&#125;</code></pre></div><h3 id="Api-æ¥å£"><a href="#Api-æ¥å£" class="headerlink" title="Api æ¥å£"></a>Api æ¥å£</h3><p>åœ¨apiå·¥ç¨‹å®šä¹‰é¡µé¢å‘å¸ƒæ¥å£</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"å‘å¸ƒé¡µé¢"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">post</span><span class="hljs-params">(String pageId)</span></span>;</code></pre></div><h3 id="PageService-1"><a href="#PageService-1" class="headerlink" title="PageService"></a>PageService</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.service;<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSBucket;<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSDownloadStream;<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.model.GridFSFile;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsTemplate;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.request.QueryPageRequest;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.response.CmsPageResult;<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.*;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.config.RabbitmqConfig;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.dao.CmsPageRepository;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.dao.CmsTemplateRepository;<span class="hljs-keyword">import</span> freemarker.cache.StringTemplateLoader;<span class="hljs-keyword">import</span> freemarker.template.Configuration;<span class="hljs-keyword">import</span> freemarker.template.Template;<span class="hljs-keyword">import</span> freemarker.template.TemplateException;<span class="hljs-keyword">import</span> io.netty.util.internal.StringUtil;<span class="hljs-keyword">import</span> org.apache.commons.io.IOUtils;<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<span class="hljs-keyword">import</span> org.bson.types.ObjectId;<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.data.domain.*;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.query.Criteria;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.query.Query;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsResource;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsTemplate;<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-keyword">import</span> org.springframework.ui.freemarker.FreeMarkerTemplateUtils;<span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.io.InputStream;<span class="hljs-keyword">import</span> java.util.HashMap;<span class="hljs-keyword">import</span> java.util.Map;<span class="hljs-keyword">import</span> java.util.Optional;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CmsPageRepository cmsPageRepository;    <span class="hljs-meta">@Autowired</span>    RestTemplate restTemplate;    <span class="hljs-meta">@Autowired</span>    CmsTemplateRepository templateRepository;    <span class="hljs-meta">@Autowired</span>    GridFsTemplate gridFsTemplate;    <span class="hljs-meta">@Autowired</span>    GridFSBucket gridFSBucket;    <span class="hljs-meta">@Autowired</span>    RabbitTemplate rabbitTemplate;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * é¡µé¢å‘å¸ƒ</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageId</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">postPage</span><span class="hljs-params">(String pageId)</span> </span>&#123;        <span class="hljs-comment">//æ‰§è¡Œé™æ€åŒ–</span>        String pageHtml = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            pageHtml = <span class="hljs-keyword">this</span>.getPageHtml(pageId);        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125; <span class="hljs-keyword">catch</span> (TemplateException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(pageHtml))&#123;            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_HTML_IS_NULL);        &#125;        <span class="hljs-comment">//ä¿å­˜é™æ€åŒ–æ–‡ä»¶</span>        CmsPage cmsPage = <span class="hljs-keyword">this</span>.saveHtml(pageId, pageHtml);        <span class="hljs-comment">//å‘é€æ¶ˆæ¯</span>        <span class="hljs-keyword">this</span>.sendPostPage(pageId);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);    &#125;    <span class="hljs-comment">//å‘é€é¡µé¢å‘å¸ƒæ¶ˆæ¯</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendPostPage</span><span class="hljs-params">(String pageId)</span></span>&#123;        CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.cmsPageQueryById(pageId);        CmsPage cmsPage = cmsPageResult.getCmsPage();        <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;            ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);        &#125;        Map&lt;String, String&gt; msgMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();        msgMap.put(<span class="hljs-string">"pageId"</span>,pageId);        <span class="hljs-comment">//æ¶ˆæ¯å†…å®¹</span>        String msg = JSON.toJSONString(msgMap);        <span class="hljs-comment">//è·å–ç«™ç‚¹idä½œä¸ºrouting key</span>        String siteId = cmsPage.getSiteId();        <span class="hljs-comment">//å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šäº¤æ¢æœºã€routingKeyã€ä»¥åŠè¦å‘é€çš„æ¶ˆæ¯</span>        rabbitTemplate.convertAndSend(RabbitmqConfig.EX_ROUTING_CMS_POSTPAGE,siteId,msg);    &#125;    <span class="hljs-comment">//ä¿å­˜é™æ€åŒ–é¡µé¢å†…å®¹</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> CmsPage <span class="hljs-title">saveHtml</span><span class="hljs-params">(String pageId,String content)</span></span>&#123;        <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢æ˜¯å¦å­˜åœ¨</span>        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(pageId);        <span class="hljs-keyword">if</span>(!optional.isPresent())&#123;            ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);        &#125;        CmsPage cmsPage = optional.get();        <span class="hljs-comment">//å‚¨å­˜ä¹‹å‰å…ˆåˆ é™¤</span>        String htmlFileId = cmsPage.getHtmlFileId();        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(htmlFileId))&#123;            gridFsTemplate.delete(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(htmlFileId)));        &#125;        <span class="hljs-comment">//ä¿å­˜htmlæ–‡ä»¶åˆ°GridFS</span>        <span class="hljs-keyword">try</span> &#123;            InputStream inputStream = IOUtils.toInputStream(content,<span class="hljs-string">"utf-8"</span>);            ObjectId objectId = gridFsTemplate.store(inputStream, cmsPage.getPageName());            <span class="hljs-comment">//æ–‡ä»¶id</span>            String fileId = objectId.toString();            <span class="hljs-comment">//å°†æ–‡ä»¶idå‚¨å­˜åˆ°cmspageä¸­</span>            cmsPage.setHtmlFileId(fileId);            cmsPageRepository.save(cmsPage);        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125;        <span class="hljs-keyword">return</span> cmsPage;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * é¡µé¢é™æ€åŒ–</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageId</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> TemplateException</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPageHtml</span><span class="hljs-params">(String pageId)</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;        <span class="hljs-comment">//è·å–é¡µé¢æ¨¡å‹æ•°æ®</span>        Map modelByPageId = <span class="hljs-keyword">this</span>.getModelByPageId(pageId);        <span class="hljs-keyword">if</span>(modelByPageId == <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-comment">//è·å–é¡µé¢æ¨¡å‹æ•°æ®ä¸ºç©º</span>            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_DATA_IS_NULL);        &#125;        <span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿</span>        String templateContent = getTemplateByPageId(pageId);        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(templateContent))&#123;            <span class="hljs-comment">//é¡µé¢æ¨¡æ¿ä¸ºç©º</span>            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_TEMPLATE_IS_NULL);        &#125;        <span class="hljs-comment">//æ„å»ºé¡µé¢é™æ€åŒ–æ•°æ®</span>        String html = generateHtml(templateContent, modelByPageId);        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(html))&#123;            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_HTML_IS_NULL);        &#125;        <span class="hljs-keyword">return</span> html;    &#125;    <span class="hljs-comment">//æ„å»ºé™æ€åŒ–é¡µé¢æ•°æ®</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">generateHtml</span><span class="hljs-params">(String template,Map model)</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;        <span class="hljs-comment">//ç”Ÿæˆé…ç½®ç±»</span>        Configuration configuration = <span class="hljs-keyword">new</span> Configuration(Configuration.getVersion());        <span class="hljs-comment">//æ¨¡æ¿åŠ è½½å™¨</span>        StringTemplateLoader stringTemplateLoader = <span class="hljs-keyword">new</span> StringTemplateLoader();        stringTemplateLoader.putTemplate(<span class="hljs-string">"template"</span>,template);        <span class="hljs-comment">//é…ç½®æ¨¡æ¿åŠ è½½å™¨</span>        configuration.setTemplateLoader(stringTemplateLoader);        <span class="hljs-comment">//è·å–æ¨¡æ¿</span>        Template template1 = configuration.getTemplate(<span class="hljs-string">"template"</span>);        String html = FreeMarkerTemplateUtils.processTemplateIntoString(template1, model);        <span class="hljs-keyword">return</span> html;    &#125;    <span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿æ–‡ä»¶æ•°æ®</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getTemplateByPageId</span><span class="hljs-params">(String pageId)</span></span>&#123;        <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>        CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.cmsPageQueryById(pageId);        CmsPage cmsPage = cmsPageResult.getCmsPage();        <span class="hljs-comment">//é¡µé¢ä¸å­˜åœ¨</span>        <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;            ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);        &#125;        <span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿æ•°æ®</span>        String templateId = cmsPage.getTemplateId();        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(templateId))&#123;            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_TEMPLATE_IS_NULL);        &#125;        Optional&lt;CmsTemplate&gt; optional = templateRepository.findById(templateId);        <span class="hljs-keyword">if</span>(optional.isPresent())&#123;            CmsTemplate cmsTemplate = optional.get();            <span class="hljs-comment">//è·å–æ¨¡æ¿æ–‡ä»¶id</span>            String templateFileId = cmsTemplate.getTemplateFileId();            <span class="hljs-comment">//å–å‡ºæ¨¡æ¿æ–‡ä»¶å†…å®¹</span>            GridFSFile gridFSFile = gridFsTemplate.findOne(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(templateFileId)));            <span class="hljs-comment">//æ‰“å¼€ä¸‹è½½æµå¯¹è±¡</span>            GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(gridFSFile.getObjectId());            <span class="hljs-comment">//åˆ›å»ºGridResource</span>            GridFsResource gridFsResource = <span class="hljs-keyword">new</span> GridFsResource(gridFSFile, gridFSDownloadStream);            <span class="hljs-keyword">try</span> &#123;                String content = IOUtils.toString(gridFsResource.getInputStream(), <span class="hljs-string">"utf-8"</span>);                <span class="hljs-keyword">return</span> content;            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;                e.printStackTrace();            &#125;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-comment">//ä»dataUrlä¸­è·å–é¡µé¢æ¨¡å‹æ•°æ®</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> Map <span class="hljs-title">getModelByPageId</span><span class="hljs-params">(String pageId)</span></span>&#123;        <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>        CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.cmsPageQueryById(pageId);        CmsPage cmsPage = cmsPageResult.getCmsPage();        <span class="hljs-comment">//é¡µé¢ä¸å­˜åœ¨</span>        <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;            ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);        &#125;        <span class="hljs-comment">//å–å‡ºdataUrl</span>        String dataUrl = cmsPage.getDataUrl();        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(dataUrl))&#123;            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_DATAURL_IS_NULL);        &#125;        <span class="hljs-comment">//å‘é€è¯·æ±‚è·å–æ¨¡å‹æ•°æ®</span>        ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(dataUrl,Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;        Map body = forEntity.getBody();        <span class="hljs-keyword">return</span> body;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * åˆ†é¡µæŸ¥è¯¢ã€é¡µé¢CURL éƒ¨åˆ†ä»£ç ç•¥è¿‡ï¼Œéœ€è¦è¯·å‚è€ƒå‰é¢çš„ç« èŠ‚</span><span class="hljs-comment">     */</span>    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æ ¹æ®idè·å–é¡µé¢æ•°æ®</span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">cmsPageQueryById</span><span class="hljs-params">(String id)</span> </span>&#123;        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(id);        <span class="hljs-keyword">if</span> (optional.isPresent()) &#123;            CmsPage cmsPage = optional.get();            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS, cmsPage);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL, <span class="hljs-keyword">null</span>);    &#125;&#125;</code></pre></div><h2 id="4-é¡µé¢å‘å¸ƒå‰ç«¯"><a href="#4-é¡µé¢å‘å¸ƒå‰ç«¯" class="headerlink" title="4. é¡µé¢å‘å¸ƒå‰ç«¯"></a>4. é¡µé¢å‘å¸ƒå‰ç«¯</h2><p>ç”¨æˆ·æ“ä½œæµç¨‹</p><p>1ã€ç”¨æˆ·è¿›å…¥ <code>cms</code> é¡µé¢åˆ—è¡¨ã€‚</p><p>2ã€ç‚¹å‡» â€œ<strong>å‘å¸ƒ</strong>â€ è¯·æ±‚æœåŠ¡ç«¯æ¥å£ï¼Œå‘å¸ƒé¡µé¢ã€‚</p><p>3ã€æç¤º â€œ<strong>å‘å¸ƒæˆåŠŸ</strong>â€ï¼Œæˆ–å‘å¸ƒå¤±è´¥ã€‚</p><h3 id="APIæ–¹æ³•"><a href="#APIæ–¹æ³•" class="headerlink" title="APIæ–¹æ³•"></a>APIæ–¹æ³•</h3><p>åœ¨ cmså‰ç«¯æ·»åŠ  apiæ–¹æ³•ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/*å‘å¸ƒé¡µé¢*/</span>export <span class="hljs-keyword">const</span> page_postPage= id =&gt; &#123;  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/cms/page/postPage/'</span>+id)&#125;</code></pre></div><h3 id="é¡µé¢å¼€å‘"><a href="#é¡µé¢å¼€å‘" class="headerlink" title="é¡µé¢å¼€å‘"></a>é¡µé¢å¼€å‘</h3><p>ä¿®æ”¹ page_list.vueï¼Œæ·»åŠ å‘å¸ƒæŒ‰é’®</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€tableâ€column</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"å‘å¸ƒ"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"80"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>â€<span class="hljs-attr">scope</span>=<span class="hljs-string">"scope"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span></span><span class="hljs-tag">      <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">plain</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"postPage(scope.row.pageId)"</span>&gt;</span>å‘å¸ƒ    <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€tableâ€column</span>&gt;</span></code></pre></div><p>æ·»åŠ é¡µé¢å‘å¸ƒäº‹ä»¶</p><div class="hljs"><pre><code class="hljs js">postPage (id) &#123;  <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤å‘å¸ƒè¯¥é¡µé¢å—?'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;  &#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;    cmsApi.page_postPage(id).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;      <span class="hljs-keyword">if</span>(res.success)&#123;        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'å‘å¸ƒé¡µé¢id='</span>+id);        <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">'å‘å¸ƒæˆåŠŸï¼Œè¯·ç¨åæŸ¥çœ‹ç»“æœ'</span>);      &#125;<span class="hljs-keyword">else</span>&#123;        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'å‘å¸ƒå¤±è´¥'</span>);      &#125;    &#125;);  &#125;).catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;  &#125;);&#125;,</code></pre></div><h2 id="5-æµ‹è¯•"><a href="#5-æµ‹è¯•" class="headerlink" title="5. æµ‹è¯•"></a>5. æµ‹è¯•</h2><p>è¿™é‡Œæµ‹è¯•è½®æ’­å›¾é¡µé¢ä¿®æ”¹ã€å‘å¸ƒçš„æµç¨‹</p><p>1ã€ä¿®æ”¹è½®æ’­å›¾é¡µé¢æ¨¡æ¿æˆ–ä¿®æ”¹è½®æ’­å›¾åœ°å€</p><p>æ³¨æ„ å…ˆä¿®æ”¹é¡µé¢åŸå‹ï¼Œé¡µé¢åŸå‹è°ƒè¯•æ­£å¸¸åå†ä¿®æ”¹é¡µé¢æ¨¡æ¿ã€‚</p><p>2ã€æ‰§è¡Œé¡µé¢é¢„è§ˆ</p><p>3ã€æ‰§è¡Œé¡µé¢å‘å¸ƒï¼ŒæŸ¥çœ‹é¡µé¢æ˜¯å¦å†™åˆ°ç½‘ç«™ç›®å½•</p><p>4ã€åˆ·æ–°é—¨æˆ·é¦–é¡µå¹¶è§‚å¯Ÿè½®æ’­å›¾æ˜¯å¦å˜åŒ–ã€‚</p><h2 id="6-æ€è€ƒ"><a href="#6-æ€è€ƒ" class="headerlink" title="6. æ€è€ƒ"></a>6. æ€è€ƒ</h2><p>1ã€å¦‚æœå‘å¸ƒåˆ°æœåŠ¡å™¨çš„é¡µé¢å†…å®¹ä¸æ­£ç¡®æ€ä¹ˆåŠï¼Ÿ</p><p>2ã€ä¸€ä¸ªé¡µé¢éœ€è¦å‘å¸ƒå¾ˆå¤šæœåŠ¡å™¨ï¼Œç‚¹å‡»â€œå‘å¸ƒâ€åå¦‚ä½•çŸ¥é“è¯¦ç»†çš„å‘å¸ƒç»“æœï¼Ÿ</p><p>3ã€ä¸€ä¸ªé¡µé¢å‘å¸ƒåˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæœåŠ¡å™¨å‘å¸ƒå¤±è´¥æ—¶æ€ä¹ˆåŠï¼Ÿ</p><h1 id="äºŒã€è¯¾ç¨‹ç®¡ç†"><a href="#äºŒã€è¯¾ç¨‹ç®¡ç†" class="headerlink" title="äºŒã€è¯¾ç¨‹ç®¡ç†"></a>äºŒã€è¯¾ç¨‹ç®¡ç†</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åœ¨çº¿æ•™è‚²å¹³å°çš„è¯¾ç¨‹ä¿¡æ¯ç›¸å½“äºç”µå•†å¹³å°çš„å•†å“ã€‚è¯¾ç¨‹ç®¡ç†æ˜¯åå°ç®¡ç†åŠŸèƒ½ä¸­æœ€é‡è¦çš„æ¨¡å—ã€‚æœ¬é¡¹ç›®ä¸ºæ•™å­¦æœºæ„æä¾›è¯¾ç¨‹ç®¡ç†åŠŸèƒ½ï¼Œæ•™å­¦æœºæ„å¯ä»¥æ·»åŠ å±äºè‡ªå·±çš„è¯¾ç¨‹ï¼Œä¾›å­¦ç”Ÿåœ¨çº¿å­¦ä¹ ã€‚</p><p><strong>è¯¾ç¨‹ç®¡ç†åŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½éœ€æ±‚</strong></p><p>1ã€åˆ†ç±»ç®¡ç†<br>2ã€æ–°å¢è¯¾ç¨‹<br>3ã€ä¿®æ”¹è¯¾ç¨‹<br>4ã€é¢„è§ˆè¯¾ç¨‹<br>5ã€å‘å¸ƒè¯¾ç¨‹</p><p><strong>ç”¨æˆ·çš„æ“ä½œæµç¨‹å¦‚ä¸‹</strong></p><p><strong>1ã€è¿›å…¥æˆ‘çš„è¯¾ç¨‹</strong></p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image3.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image3.png" srcset="/img/loading.gif" alt="image-20200401214528987"></a></p><p><strong>2ã€ç‚¹å‡»â€œæ·»åŠ è¯¾ç¨‹â€ï¼Œè¿›å…¥æ·»åŠ è¯¾ç¨‹ç•Œé¢</strong></p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image4.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image4.png" srcset="/img/loading.gif" alt="image-20200401214540896"></a></p><p><strong>3ã€è¾“å…¥è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ï¼Œç‚¹å‡»æäº¤</strong></p><p><strong>4ã€è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯æäº¤æˆåŠŸï¼Œè‡ªåŠ¨è¿›å…¥â€œç®¡ç†è¯¾ç¨‹â€ç•Œé¢ï¼Œç‚¹å‡»â€œç®¡ç†è¯¾ç¨‹â€ä¹Ÿå¯ä»¥è¿›å…¥â€œç®¡ç†è¯¾ç¨‹â€ç•Œé¢</strong></p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image5.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image5.png" srcset="/img/loading.gif" alt="image-20200401214605318"></a></p><p><strong>5ã€ç¼–è¾‘å›¾ç‰‡ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡ã€‚</strong></p><p><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image6.png" srcset="/img/loading.gif" alt="image-20200401214657046"></p><p><strong>6ã€ç¼–è¾‘è¯¾ç¨‹è¥é”€ä¿¡æ¯</strong></p><p>è¥é”€ä¿¡æ¯ä¸»è¦æ˜¯è®¾ç½®è¯¾ç¨‹çš„æ”¶è´¹æ–¹å¼åŠä»·æ ¼ã€‚</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image7.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image7.png" srcset="/img/loading.gif" alt="image-20200401214707765"></a></p><p><strong>7ã€ç¼–è¾‘è¯¾ç¨‹è®¡åˆ’</strong></p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image8.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image8.png" srcset="/img/loading.gif" alt="image-20200401214718496"></a></p><h2 id="2-æ•™å­¦æ–¹æ³•"><a href="#2-æ•™å­¦æ–¹æ³•" class="headerlink" title="2. æ•™å­¦æ–¹æ³•"></a>2. æ•™å­¦æ–¹æ³•</h2><p>æœ¬æ¨¡å—å¯¹è¯¾ç¨‹ä¿¡æ¯ç®¡ç†åŠŸèƒ½çš„æ•™å­¦æ–¹æ³•é‡‡ç”¨å®æˆ˜æ•™å­¦æ–¹æ³•ï¼Œæ—¨åœ¨é€šè¿‡å®æˆ˜æé«˜æ¥å£ç¼–å†™çš„èƒ½åŠ›ï¼Œå…·ä½“æ•™å­¦æ–¹æ³•å¦‚ä¸‹ï¼š</p><p>1ã€å‰åç«¯å·¥ç¨‹å¯¼å…¥</p><p>æ•™å­¦ç®¡ç†å‰ç«¯å·¥ç¨‹é‡‡ç”¨ä¸ç³»ç»Ÿç®¡ç†å·¥ç¨‹ç›¸åŒçš„æŠ€æœ¯ï¼Œç›´æ¥å¯¼å…¥ååœ¨æ­¤åŸºç¡€ä¸Šå¼€å‘ã€‚<br>è¯¾ç¨‹ç®¡ç†æœåŠ¡ç«¯å·¥ç¨‹é‡‡ç”¨Spring BootæŠ€æœ¯æ„å»ºï¼ŒæŠ€æœ¯å±‚æŠ€æœ¯ä½¿ç”¨Spring data Jpaï¼ˆä¸Spring data Mongodbç±»<br>ä¼¼ï¼‰ã€Mybatisï¼Œç›´æ¥å¯¼å…¥ååœ¨æ­¤åŸºç¡€ä¸Šå¼€å‘ã€‚</p><p>2ã€è¯¾ç¨‹è®¡åˆ’åŠŸèƒ½</p><p>è¯¾ç¨‹è®¡åˆ’åŠŸèƒ½é‡‡ç”¨å…¨ç¨‹æ•™å­¦ã€‚</p><p>3ã€æˆ‘çš„è¯¾ç¨‹ã€æ–°å¢è¯¾ç¨‹ã€ä¿®æ”¹è¯¾ç¨‹ã€è¯¾ç¨‹è¥é”€</p><p>æˆ‘çš„è¯¾ç¨‹ã€æ–°å¢è¯¾ç¨‹ã€ä¿®æ”¹è¯¾ç¨‹ã€è¯¾ç¨‹è¥é”€å››ä¸ªåŠŸèƒ½é‡‡ç”¨å®æˆ˜æ–¹å¼ï¼Œè¯¾å ‚ä¸Šä¼šè®²è§£æ¯ä¸ªåŠŸèƒ½çš„éœ€æ±‚åŠæŠ€æœ¯ç‚¹ï¼Œè®²è§£å®Œæˆå­¦ç”Ÿå¼€å§‹å®æˆ˜ï¼Œç”±å¯¼å¸ˆè¿›è¡ŒæŠ€æœ¯æŒ‡å¯¼ã€‚</p><p>4ã€å‚è€ƒæ–‡æ¡£</p><p>å®æˆ˜ç»“æŸæä¾›æ¯ä¸ªåŠŸèƒ½çš„å¼€å‘æ–‡æ¡£ï¼Œå­¦ç”Ÿå‚è€ƒæ–‡æ¡£å¹¶ä¿®æ­£åŠŸèƒ½ç¼ºé™·ã€‚</p><h2 id="3-ç¯å¢ƒæ­å»º"><a href="#3-ç¯å¢ƒæ­å»º" class="headerlink" title="3. ç¯å¢ƒæ­å»º"></a>3. ç¯å¢ƒæ­å»º</h2><h3 id="1ã€æ­å»ºæ•°æ®åº“ç¯å¢ƒ"><a href="#1ã€æ­å»ºæ•°æ®åº“ç¯å¢ƒ" class="headerlink" title="1ã€æ­å»ºæ•°æ®åº“ç¯å¢ƒ"></a>1ã€æ­å»ºæ•°æ®åº“ç¯å¢ƒ</h3><ol><li><strong>åˆ›å»ºæ•°æ®åº“</strong></li></ol><p>è¯¾ç¨‹ç®¡ç†ä½¿ç”¨ <code>MySQL</code> æ•°æ®åº“ï¼Œåˆ›å»ºè¯¾ç¨‹ç®¡ç†æ•°æ®åº“ï¼š<code>xc_course</code>ã€‚</p><p>å¯¼å…¥ <code>xc_course.sql</code> è„šæœ¬</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image9.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image9.png" srcset="/img/loading.gif" alt="image-20200401215113957"></a></p><ol><li><strong>æ•°æ®è¡¨ä»‹ç»</strong></li></ol><p>è¯¾ç¨‹ä¿¡æ¯å†…å®¹ç¹å¤šï¼Œå°†è¯¾ç¨‹ä¿¡æ¯åˆ†ç±»ä¿å­˜åœ¨å¦‚ä¸‹è¡¨ä¸­ï¼š</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image10.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image10.png" srcset="/img/loading.gif" alt="image-20200401215204860"></a></p><p>åˆ†ç±»å‚¨å­˜æ—¢å¯ä»¥æé«˜è§£è€¦åˆåº¦ï¼Œä¹Ÿå¯ä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p><p>æ•°æ®è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image11.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image11.png" srcset="/img/loading.gif" alt="image-20200401215300618"></a></p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image12.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image12.png" srcset="/img/loading.gif" alt="image-20200401215305777"></a></p><p><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image13.png" srcset="/img/loading.gif" alt="image-20200401215310490"></p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image14.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image14.png" srcset="/img/loading.gif" alt="image-20200401215313716"></a></p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image15.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image15.png" srcset="/img/loading.gif" alt="image-20200401215316397"></a></p><h3 id="2ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹"><a href="#2ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹" class="headerlink" title="2ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹"></a>2ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹</h3><p>1ï¼‰æŒä¹…å±‚æŠ€æœ¯ä»‹ç»ï¼š</p><p>è¯¾ç¨‹ç®¡ç†æœåŠ¡ä½¿ç”¨MySQLæ•°æ®åº“å­˜å‚¨è¯¾ç¨‹ä¿¡æ¯ï¼ŒæŒä¹…å±‚æŠ€æœ¯å¦‚ä¸‹ï¼š</p><p>1ã€spring data jpaï¼šç”¨äºè¡¨çš„åŸºæœ¬CRUDã€‚</p><p>2ã€mybatisï¼šç”¨äºå¤æ‚çš„æŸ¥è¯¢æ“ä½œã€‚</p><p>3ã€druidï¼šä½¿ç”¨é˜¿é‡Œå·´å·´æä¾›çš„spring boot æ•´åˆdruidåŒ…druid-spring-boot-starterç®¡ç†è¿æ¥æ± ã€‚</p><blockquote><p>druid-spring-boot-starteråœ°å€ï¼š<a href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter" target="_blank" rel="noopener">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p></blockquote><p><strong>ä¸ºä»€ä¹ˆæŒä¹…å±‚ç”¨åˆ°äº† JPA è¿˜è¦ç”¨ Mybatis ï¼Ÿ</strong></p><p>å› ä¸º JPA æ˜¯é¢å‘å¯¹è±¡è¿›è¡Œå¼€å‘çš„ï¼Œå¯¹äºä¸€äº›å¤æ‚çš„sqlæ“ä½œï¼Œä¼˜åŒ–èµ·æ¥ä¼šæ¯”è¾ƒéº»çƒ¦ï¼š</p><p>è€Œ Mybatis æ˜¯é¢å‘sqlçš„ï¼Œå¯¹ä¸€äº›å¤æ‚çš„å¤šè¡¨æ“ä½œæ¯”è¾ƒå‹å¥½ã€‚</p><p>å¯¼å…¥èµ„æ–™ä¸‹çš„ â€œxc-service-manage-course.zipâ€ã€‚</p><h3 id="3ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†å‰ç«¯å·¥ç¨‹"><a href="#3ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†å‰ç«¯å·¥ç¨‹" class="headerlink" title="3ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†å‰ç«¯å·¥ç¨‹"></a>3ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†å‰ç«¯å·¥ç¨‹</h3><p>è¯¾ç¨‹ç®¡ç†å±äºæ•™å­¦ç®¡ç†å­ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œä½¿ç”¨ç”¨æˆ·ä¸ºæ•™å­¦æœºæ„çš„ç®¡ç†äººå‘˜å’Œè€å¸ˆï¼Œä¸ºä¿è¯ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ï¼Œå•ç‹¬åˆ›å»ºä¸€ä¸ªæ•™å­¦ç®¡ç†å‰ç«¯å·¥ç¨‹ã€‚ æ•™å­¦ç®¡ç†å‰ç«¯å·¥ç¨‹ä¸ç³»ç»Ÿç®¡ç†å‰ç«¯çš„å·¥ç¨‹ç»“æ„ä¸€æ ·ï¼Œä¹Ÿé‡‡ç”¨ <code>vue.js</code> æ¡†æ¶æ¥å®ç°ã€‚</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image16.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image16.png" srcset="/img/loading.gif" alt="image-20200401215549740"></a></p><p>ä»è¯¾ç¨‹èµ„æ–™ç›®å½•æ‹·è´ <code>xc-ui-pc-teach.zip</code> åˆ°å·¥ç¨‹ï¼Œä½¿ç”¨ <code>webstorm</code> æ‰“å¼€ï¼Œå¯åŠ¨å·¥ç¨‹</p><p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image17.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image17.png" srcset="/img/loading.gif" alt="image-20200401215618671"></a></p><h1 id="ä¸‰ã€è¯¾ç¨‹è®¡åˆ’"><a href="#ä¸‰ã€è¯¾ç¨‹è®¡åˆ’" class="headerlink" title="ä¸‰ã€è¯¾ç¨‹è®¡åˆ’"></a>ä¸‰ã€è¯¾ç¨‹è®¡åˆ’</h1><h2 id="1-éœ€æ±‚åˆ†æ-1"><a href="#1-éœ€æ±‚åˆ†æ-1" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>ä»€ä¹ˆæ˜¯è¯¾ç¨‹è®¡åˆ’ï¼Ÿ</p><p>è¯¾ç¨‹è®¡åˆ’å®šä¹‰äº†è¯¾ç¨‹çš„ç« èŠ‚å†…å®¹ï¼Œå­¦ç”Ÿé€šè¿‡è¯¾ç¨‹è®¡åˆ’è¿›è¡Œåœ¨çº¿å­¦ä¹ ï¼Œä¸‹å›¾ä¸­å³ä¾§æ˜¾ç¤ºçš„å°±æ˜¯è¯¾ç¨‹è®¡åˆ’ã€‚</p><p>è¯¾ç¨‹è®¡åˆ’åŒ…æ‹¬ä¸¤çº§ï¼Œç¬¬ä¸€çº§æ˜¯è¯¾ç¨‹çš„å¤§ç« èŠ‚ã€ç¬¬äºŒçº§æ˜¯å¤§ç« èŠ‚ä¸‹å±çš„å°ç« èŠ‚ï¼Œæ¯ä¸ªå°ç« èŠ‚é€šå¸¸æ˜¯ä¸€æ®µè§†é¢‘ï¼Œå­¦ç”Ÿç‚¹å‡»å°ç« èŠ‚åœ¨çº¿å­¦ä¹ ã€‚</p><p>æ•™å­¦ç®¡ç†äººå‘˜å¯¹è¯¾ç¨‹è®¡åˆ’å¦‚ä½•ç®¡ç†ï¼Ÿ</p><p>åŠŸèƒ½åŒ…æ‹¬ï¼šæ·»åŠ è¯¾ç¨‹è®¡åˆ’ã€åˆ é™¤è¯¾ç¨‹è®¡åˆ’ã€ä¿®æ”¹è¯¾ç¨‹è®¡åˆ’ç­‰ã€‚ä¾‹å¦‚ï¼š</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image18.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image18.png" srcset="/img/loading.gif" alt="image-20200401215716660"></a></p><h2 id="2-è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢"><a href="#2-è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢" class="headerlink" title="2. è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢"></a>2. è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢</h2><p>è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢æ˜¯å°†æŸä¸ªè¯¾ç¨‹çš„è¯¾ç¨‹è®¡åˆ’å†…å®¹å®Œæ•´çš„æ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image19.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image19.png" srcset="/img/loading.gif" alt="image-20200401215738194"></a></p><p>å·¦ä¾§æ˜¾ç¤ºçš„å°±æ˜¯è¯¾ç¨‹è®¡åˆ’ï¼Œè¯¾ç¨‹è®¡åˆ’æ˜¯ä¸€ä¸ªæ ‘å‹ç»“æ„ï¼Œæ–¹ä¾¿æ‰©å±•è¯¾ç¨‹è®¡åˆ’çš„çº§åˆ«ã€‚</p><p>åœ¨ä¸Šè¾¹é¡µé¢ä¸­ï¼Œç‚¹å‡»â€œæ·»åŠ è¯¾ç¨‹è®¡åˆ’â€å³å¯å¯¹è¯¾ç¨‹è®¡åˆ’è¿›è¡Œæ·»åŠ æ“ä½œã€‚</p><p>ç‚¹å‡»ä¿®æ”¹å¯å¯¹æŸä¸ªç« èŠ‚å†…å®¹è¿›è¡Œä¿®æ”¹ã€‚</p><p>ç‚¹å‡»åˆ é™¤å¯åˆ é™¤æŸä¸ªç« èŠ‚ã€‚</p><h3 id="é¡µé¢åŸå‹"><a href="#é¡µé¢åŸå‹" class="headerlink" title="é¡µé¢åŸå‹"></a>é¡µé¢åŸå‹</h3><h4 id="treeç»„ä»¶ä»‹ç»"><a href="#treeç»„ä»¶ä»‹ç»" class="headerlink" title="treeç»„ä»¶ä»‹ç»"></a>treeç»„ä»¶ä»‹ç»</h4><p>æœ¬åŠŸèƒ½ä½¿ç”¨ <code>element-ui</code> çš„ <code>tree</code> ç»„ä»¶æ¥å®Œæˆ</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image20.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image20.png" srcset="/img/loading.gif" alt="image-20200401215821019"></a></p><p>åœ¨ <code>course_plan.vue</code> æ–‡ä»¶ä¸­æ·»åŠ  <code>tree</code> ç»„ä»¶çš„ä»£ç ï¼Œè¿›è¡Œæµ‹è¯•ï¼š</p><p>1ã€ç»„ä»¶æ ‡ç­¾</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€tree</span></span><span class="hljs-tag">      <span class="hljs-attr">:data</span>=<span class="hljs-string">"data"</span></span><span class="hljs-tag">      <span class="hljs-attr">show</span>â€<span class="hljs-attr">checkbox</span></span><span class="hljs-tag">      <span class="hljs-attr">node</span>â€<span class="hljs-attr">key</span>=<span class="hljs-string">"id"</span></span><span class="hljs-tag">      <span class="hljs-attr">default</span>â€<span class="hljs-attr">expand</span>â€<span class="hljs-attr">all</span></span><span class="hljs-tag">      <span class="hljs-attr">:expand</span>â€<span class="hljs-attr">on</span>â€<span class="hljs-attr">click</span>â€<span class="hljs-attr">node</span>=<span class="hljs-string">"false"</span></span><span class="hljs-tag">      <span class="hljs-attr">:render</span>â€<span class="hljs-attr">content</span>=<span class="hljs-string">"renderContent"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€tree</span>&gt;</span></code></pre></div><p>2ã€æ•°æ®å¯¹è±¡</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">let</span> id = <span class="hljs-number">1000</span>;  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;    data() &#123;      <span class="hljs-keyword">return</span> &#123;        data : [&#123;          id: <span class="hljs-number">1</span>,          label: <span class="hljs-string">'ä¸€çº§ 1'</span>,          children: [&#123;            id: <span class="hljs-number">4</span>,            label: <span class="hljs-string">'äºŒçº§ 1â€1'</span>,            children: [&#123;              id: <span class="hljs-number">9</span>,              label: <span class="hljs-string">'ä¸‰çº§ 1â€1â€1'</span>            &#125;, &#123;              id: <span class="hljs-number">10</span>,              label: <span class="hljs-string">'ä¸‰çº§ 1â€1â€2'</span>            &#125;]          &#125;]        &#125;]      &#125;     &#125; &#125;</code></pre></div><h4 id="webstorm-é…ç½®JSX"><a href="#webstorm-é…ç½®JSX" class="headerlink" title="webstorm é…ç½®JSX"></a>webstorm é…ç½®JSX</h4><p>æœ¬ç»„ä»¶ç”¨åˆ°äº†JSXè¯­æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image21.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image21.png" srcset="/img/loading.gif" alt="image-20200401215955630"></a></p><p><code>JSX</code> æ˜¯ <code>Javascript</code> å’Œ <code>XML</code> ç»“åˆçš„ä¸€ç§æ ¼å¼ï¼Œå®ƒæ˜¯ <code>React</code> çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œ<code>JSX</code>å’Œ<code>XML</code> è¯­æ³•ç±»ä¼¼ï¼Œå¯ä»¥å®šä¹‰å±æ€§ä»¥åŠå­å…ƒç´ ã€‚å”¯ä¸€ç‰¹æ®Šçš„æ˜¯å¯ä»¥ç”¨å¤§æ‹¬å·æ¥åŠ å…¥<code>JavaScript</code> è¡¨è¾¾å¼ã€‚é‡åˆ° <code>HTML</code> æ ‡ç­¾ï¼ˆä»¥ &lt; å¼€å¤´ï¼‰ï¼Œå°±ç”¨ <code>HTML</code> è§„åˆ™è§£æï¼›<br>é‡åˆ°ä»£ç å—ï¼ˆä»¥ { å¼€å¤´ï¼‰ï¼Œå°±ç”¨ <code>JavaScript</code> è§„åˆ™è§£æã€‚</p><p>ä¸‹é¢æ˜¯å®˜æ–¹çš„ä¸€ä¸ªä¾‹å­ï¼š</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image22.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/C:%5CUsers%5CMI%5CDesktop%5CHexo%5Csource_posts%5C%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06%5Cimage22.png" srcset="/img/loading.gif" alt="image-20200401220038034"></a></p><p>è®¾ç½®æ–¹æ³• å¦‚ä¸‹ï¼š</p><p>1 ã€Javascript version é€‰æ‹© React JSX ï¼ˆå¦‚æœæ²¡æœ‰å°±é€‰æ‹©JSX Harmonyï¼‰</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image23.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image23.png" srcset="/img/loading.gif" alt="image-20200401220056325"></a></p><p>2ã€HTML ç±»å‹æ–‡ä»¶ä¸­å¢åŠ vue</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image24.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image24.png" srcset="/img/loading.gif" alt="image-20200401220104955"></a></p><p>preferences -&gt; Editor -&gt; File Types ä¸­æ‰¾åˆ°ä¸Šè¾¹æ¡†ä¸­HTML åœ¨ä¸‹è¾¹åŠ ä¸€ä¸ª *.vue</p><p>å¦‚æœå·²ç»åœ¨ vue template ä¸­å·²å­˜åœ¨.vue åˆ™æŠŠå®ƒæ”¹ä¸º.vue2(å› ä¸ºè¦åœ¨Htmlä¸­æ·»åŠ .vue)</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image25.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image25.png" srcset="/img/loading.gif" alt="image-20200401220120452"></a></p><h3 id="APIæ¥å£"><a href="#APIæ¥å£" class="headerlink" title="APIæ¥å£"></a>APIæ¥å£</h3><h4 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h4><p>1ã€è¡¨ç»“æ„</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image26.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image26.png" srcset="/img/loading.gif" alt="image-20200401220143626"></a></p><p>2ã€æ¨¡å‹ç±»</p><p>è¯¾ç¨‹è®¡åˆ’ä¸ºæ ‘å‹ç»“æ„ï¼Œç”±æ ‘æ ¹ï¼ˆè¯¾ç¨‹ï¼‰å’Œæ ‘æï¼ˆç« èŠ‚ï¼‰ç»„æˆï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡æ—¶å°†è¯¾ç¨‹è®¡åˆ’è®¾ç½®ä¸ºæ ‘å‹ç»“æ„ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-meta">@Entity</span><span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"teachplan"</span>)<span class="hljs-meta">@GenericGenerator</span>(name = <span class="hljs-string">"jpaâ€uuid"</span>, strategy = <span class="hljs-string">"uuid"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Teachplan</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = â€<span class="hljs-number">916357110051689485L</span>;    <span class="hljs-meta">@Id</span>    <span class="hljs-meta">@GeneratedValue</span>(generator = <span class="hljs-string">"jpaâ€uuid"</span>)    <span class="hljs-meta">@Column</span>(length = <span class="hljs-number">32</span>)    <span class="hljs-keyword">private</span> String id;    <span class="hljs-keyword">private</span> String pname;    <span class="hljs-keyword">private</span> String parentid;    <span class="hljs-keyword">private</span> String grade;    <span class="hljs-keyword">private</span> String ptype;    <span class="hljs-keyword">private</span> String description;    <span class="hljs-keyword">private</span> String courseid;    <span class="hljs-keyword">private</span> String status;    <span class="hljs-keyword">private</span> Integer orderby;    <span class="hljs-keyword">private</span> Double timelength;    <span class="hljs-keyword">private</span> String trylearn;&#125;</code></pre></div><h4 id="è‡ªå®šä¹‰æ¨¡å‹ç±»"><a href="#è‡ªå®šä¹‰æ¨¡å‹ç±»" class="headerlink" title="è‡ªå®šä¹‰æ¨¡å‹ç±»"></a>è‡ªå®šä¹‰æ¨¡å‹ç±»</h4><p>å‰ç«¯é¡µé¢éœ€è¦æ ‘å‹ç»“æ„çš„æ•°æ®æ¥å±•ç¤ºTreeç»„ä»¶ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js">[&#123;      id: <span class="hljs-number">1</span>,      label: <span class="hljs-string">'ä¸€çº§ 1'</span>,      children: [&#123;        id: <span class="hljs-number">4</span>,        label: <span class="hljs-string">'äºŒçº§ 1â€1'</span>       &#125;]     &#125;]</code></pre></div><p>è‡ªå®šä¹‰è¯¾ç¨‹è®¡åˆ’ç»“ç‚¹ç±»å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TeachplanNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Teachplan</span> </span>&#123;    List&lt;TeachplanNode&gt; children;&#125;</code></pre></div><h4 id="æ¥å£å®šä¹‰"><a href="#æ¥å£å®šä¹‰" class="headerlink" title="æ¥å£å®šä¹‰"></a>æ¥å£å®šä¹‰</h4><p>æ ¹æ®è¯¾ç¨‹idæŸ¥è¯¢è¯¾ç¨‹çš„è®¡åˆ’æ¥å£å¦‚ä¸‹ï¼Œåœ¨apiå·¥ç¨‹åˆ›å»º <code>course</code> åŒ…ï¼Œåˆ›å»º<code>CourseControllerApi</code> æ¥å£ç±»å¹¶å®šä¹‰æ¥å£æ–¹æ³•å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseControllerApi</span> </span>&#123;    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">findTeachplanList</span><span class="hljs-params">(String courseId)</span></span>;&#125;</code></pre></div><h3 id="è¯¾ç¨‹ç®¡ç†æœåŠ¡"><a href="#è¯¾ç¨‹ç®¡ç†æœåŠ¡" class="headerlink" title="è¯¾ç¨‹ç®¡ç†æœåŠ¡"></a>è¯¾ç¨‹ç®¡ç†æœåŠ¡</h3><h4 id="SQLè¯­å¥"><a href="#SQLè¯­å¥" class="headerlink" title="SQLè¯­å¥"></a>SQLè¯­å¥</h4><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>  a.id one_id,  a.pname one_pname,  b.id two_id,  b.pname two_pname,  c.id three_id,  c.pname three_pname<span class="hljs-keyword">FROM</span>  teachplan a  <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> teachplan b    <span class="hljs-keyword">ON</span> a.id = b.parentid  <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> teachplan c    <span class="hljs-keyword">ON</span> b.id = c.parentid<span class="hljs-keyword">WHERE</span> a.parentid = <span class="hljs-string">'0'</span>  <span class="hljs-keyword">AND</span> a.courseid = <span class="hljs-string">'402885816243d2dd016243f24c030002'</span><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a.orderby,  b.orderby,  c.orderby</code></pre></div><h4 id="DAO"><a href="#DAO" class="headerlink" title="DAO"></a>DAO</h4><ol><li>mapperæ¥å£</li></ol><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TeachplanMapper</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">selectList</span><span class="hljs-params">(String courseId)</span></span>;&#125;</code></pre></div><p>2ï¼‰mapperæ˜ å°„æ–‡ä»¶</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.xuecheng.manage_course.dao.TeachplanMapper"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"teachplanMap"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.ext.TeachplanNode"</span>&gt;</span>        <span class="hljs-comment">&lt;!--ä¸€çº§èŠ‚ç‚¹--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_id"</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"pname"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_pname"</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"children"</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.ext.TeachplanNode"</span>&gt;</span>            <span class="hljs-comment">&lt;!--äºŒçº§èŠ‚ç‚¹--&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_id"</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"pname"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_pname"</span>/&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"children"</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.ext.TeachplanNode"</span>&gt;</span>                <span class="hljs-comment">&lt;!--ä¸‰çº§èŠ‚ç‚¹--&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_id"</span>/&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"pname"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_pname"</span>/&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>    <span class="hljs-comment">&lt;!--ä¸‰çº§èœå•æŸ¥è¯¢--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectList"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"teachplanMap"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"java.lang.String"</span>&gt;</span>        SELECT            a.id one_id,            a.pname one_pname,            a.courseid one_course,            b.id two_id,            b.pname two_pname,            c.id three_id,            c.pname three_pname        FROM            teachplan a        LEFT JOIN teachplan b            ON b.parentid = a.id        LEFT JOIN teachplan c            ON c.parentid = b.id        WHERE            a.parentid = '0'        <span class="hljs-comment">&lt;!--åˆ¤æ–­å‚æ•°ä¸ä¸ºç©ºæ—¶æ‰è¿›è¡Œå‚æ•°çš„åŒ¹é…--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"_parameter!=null and _parameter!=''"</span>&gt;</span>            and a.courseid = #&#123;courseId&#125;        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>        ORDER BY a.orderby,            b.orderby,            c.orderby    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div><p>è¯´æ˜ï¼šé’ˆå¯¹è¾“å…¥å‚æ•°ä¸ºç®€å•ç±»å‹ #{}ä¸­å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œåˆ¤æ–­å‚æ•°æ˜¯å¦ä¸ºç©ºè¦ç”¨ _parameterï¼ˆå®ƒå±äº<code>mybatis</code>çš„å†…ç½®å‚æ•°ï¼‰</p><h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    TeachplanMapper teachplanMapper;    <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">findTeachplanList</span><span class="hljs-params">(String courseId)</span></span>&#123;        TeachplanNode teachplanNode = teachplanMapper.selectList(courseId);        <span class="hljs-keyword">return</span> teachplanNode;    &#125;&#125;</code></pre></div><h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/course"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CourseControllerApi</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CourseService courseService;    <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’</span>    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/teachplan/list/&#123;courseId&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">findTeachplanList</span><span class="hljs-params">(String courseId)</span> </span>&#123;        <span class="hljs-keyword">return</span> courseService.findTeachplanList(courseId);    &#125;&#125;</code></pre></div><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>ä½¿ç”¨postmanæˆ–swagger-uiæµ‹è¯•æŸ¥è¯¢æ¥å£ã€‚</p><p>Get è¯·æ±‚ï¼š<a href="http://localhost:31200/course/teachplan/list/402885816243d2dd016243f24c030002" target="_blank" rel="noopener">http://localhost:31200/course/teachplan/list/402885816243d2dd016243f24c030002</a></p><h3 id="å‰ç«¯é¡µé¢"><a href="#å‰ç«¯é¡µé¢" class="headerlink" title="å‰ç«¯é¡µé¢"></a>å‰ç«¯é¡µé¢</h3><h4 id="APIæ–¹æ³•-1"><a href="#APIæ–¹æ³•-1" class="headerlink" title="APIæ–¹æ³•"></a>APIæ–¹æ³•</h4><p>å®šä¹‰è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢çš„apiæ–¹æ³•ï¼š</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/*æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’*/</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> findTeachplanList = <span class="hljs-function"><span class="hljs-params">courseid</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl+<span class="hljs-string">'/course/teachplan/list/'</span>+courseid)&#125;</code></pre></div><h4 id="Apiè°ƒç”¨"><a href="#Apiè°ƒç”¨" class="headerlink" title="Apiè°ƒç”¨"></a>Apiè°ƒç”¨</h4><ol><li>åœ¨ <code>mounted</code> é’©å­æ–¹æ³• ä¸­æŸ¥è¯¢ è¯¾ç¨‹è®¡åˆ’<br>å®šä¹‰æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’çš„æ–¹æ³•ï¼Œèµ‹å€¼ç»™æ•°æ®å¯¹è±¡ <code>teachplanList</code></li></ol><div class="hljs"><pre><code class="hljs js">findTeachplan()&#123;    courseApi.findTeachplanList(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span>&#123;    <span class="hljs-keyword">this</span>.teachplanList = [];<span class="hljs-comment">//æ¸…ç©ºæ ‘</span>    <span class="hljs-keyword">if</span>(res.children)&#123;    <span class="hljs-keyword">this</span>.teachplanList = res.children;    &#125;&#125;);&#125;</code></pre></div><p>2ï¼‰åœ¨mountedé’©å­ä¸­æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’</p><div class="hljs"><pre><code class="hljs js">mounted()&#123;   <span class="hljs-comment">//è¯¾ç¨‹id</span>  <span class="hljs-keyword">this</span>.courseid = <span class="hljs-keyword">this</span>.$route.params.courseid;  <span class="hljs-comment">//è¯¾ç¨‹è®¡åˆ’</span>  <span class="hljs-keyword">this</span>.findTeachplan();&#125;</code></pre></div><p>3ï¼‰ä¿®æ”¹æ ‘ç»“ç‚¹çš„æ ‡ç­¾å±æ€§</p><p>è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯ä¸­ <code>pname</code> ä¸ºç»“ç‚¹çš„åç§°ï¼Œéœ€è¦ä¿®æ”¹æ ‘ç»“ç‚¹çš„æ ‡ç­¾å±æ€§æ–¹å¯æ­£å¸¸æ˜¾ç¤ºè¯¾ç¨‹è®¡åˆ’åç§°ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js">defaultProps: &#123;   children: <span class="hljs-string">'children'</span>,  label: <span class="hljs-string">'pname'</span>&#125;</code></pre></div><h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image27.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image27.png" srcset="/img/loading.gif" alt="image-20200401221133565"></a></p><h2 id="3-æ·»åŠ è¯¾ç¨‹è®¡åˆ’"><a href="#3-æ·»åŠ è¯¾ç¨‹è®¡åˆ’" class="headerlink" title="3. æ·»åŠ è¯¾ç¨‹è®¡åˆ’"></a>3. æ·»åŠ è¯¾ç¨‹è®¡åˆ’</h2><h3 id="éœ€æ±‚åˆ†æ-2"><a href="#éœ€æ±‚åˆ†æ-2" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>ç”¨æˆ·æ“ä½œæµç¨‹</p><p>1 ã€è¿›å…¥è¯¾ç¨‹è®¡åˆ’é¡µé¢ï¼Œç‚¹å‡»â€œæ·»åŠ è¯¾ç¨‹è®¡åˆ’â€</p><p>2ã€æ‰“å¼€æ·»åŠ è¯¾ç¨‹è®¡åˆ’é¡µé¢ï¼Œè¾“å…¥è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯</p><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image28.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image28.png" srcset="/img/loading.gif" alt="image-20200401221202889"></a></p><p><strong>ä¸Šçº§ç»“ç‚¹è¯´æ˜</strong>ï¼š</p><p>å¦‚æœä¸é€‰æ‹©ä¸Šçº§èŠ‚ç‚¹çš„è¯ï¼Œè¡¨ç¤ºå½“å‰æ·»åŠ çš„è¯¾ç¨‹è®¡åˆ’çš„çˆ¶èŠ‚ç‚¹ä½œä¸ºè¯¥è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ·»åŠ çš„æ˜¯äºŒçº§èœå•ï¼Œå¦‚æœé€‰æ‹©äº†ä¸Šçº§èŠ‚ç‚¹ï¼Œè¡¨ç¤ºæ·»åŠ çš„æ˜¯ä¸‰çº§èœå•ï¼Œå¦‚æœæ·»åŠ è¯¥è¯¾ç¨‹æ—¶ï¼Œåœ¨è¯¾ç¨‹è®¡åˆ’ä¸­æ²¡æœ‰è¯¥è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹æ—¶ï¼Œè¦è‡ªåŠ¨å°†è¯¥è¯¾ç¨‹è®¾ç½®ä¸ºæ ¹èŠ‚ç‚¹ã€‚</p><h4 id="é¡µé¢åŸå‹è¯´æ˜"><a href="#é¡µé¢åŸå‹è¯´æ˜" class="headerlink" title="é¡µé¢åŸå‹è¯´æ˜"></a>é¡µé¢åŸå‹è¯´æ˜</h4><p>æ·»åŠ è¯¾ç¨‹è®¡åˆ’é‡‡ç”¨å¼¹å‡ºçª—å£ç»„ä»¶Dialogã€‚</p><p>1ã€è§†å›¾éƒ¨åˆ†</p><p>åœ¨course_plan.vueé¡µé¢æ·»åŠ æ·»åŠ è¯¾ç¨‹è®¡åˆ’çš„å¼¹å‡ºçª—å£ä»£ç ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€dialog</span> <span class="hljs-attr">title</span>=<span class="hljs-string">" æ·»åŠ è¯¾ç¨‹è®¡åˆ’"</span> <span class="hljs-attr">:visible.sync</span>=<span class="hljs-string">"teachplayFormVisible"</span> &gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"teachplayForm"</span>  <span class="hljs-attr">:model</span>=<span class="hljs-string">"teachplanActive"</span> <span class="hljs-attr">label</span>â€<span class="hljs-attr">width</span>=<span class="hljs-string">"140px"</span></span><span class="hljs-tag"><span class="hljs-attr">style</span>=<span class="hljs-string">"width:600px;"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"teachplanRules"</span> &gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"ä¸Šçº§ç»“ç‚¹"</span> &gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€select</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.parentid"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"ä¸å¡«è¡¨ç¤ºæ ¹ç»“ç‚¹"</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">elâ€option</span></span><span class="hljs-tag">              <span class="hljs-attr">v</span>â€<span class="hljs-attr">for</span>=<span class="hljs-string">"item in teachplanList"</span></span><span class="hljs-tag">              <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span></span><span class="hljs-tag">              <span class="hljs-attr">:label</span>=<span class="hljs-string">"item.pname"</span></span><span class="hljs-tag">              <span class="hljs-attr">:value</span>=<span class="hljs-string">"item.id"</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€option</span>&gt;</span>          <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€select</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"ç« èŠ‚/è¯¾æ—¶åç§°"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"pname"</span>&gt;</span>                  <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.pname"</span> <span class="hljs-attr">auto</span>â€<span class="hljs-attr">complete</span>=<span class="hljs-string">"off"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>         <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"è¯¾ç¨‹ç±»å‹"</span> &gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radioâ€group</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.ptype"</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">'1'</span>&gt;</span>è§†é¢‘<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radio</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">'2'</span>&gt;</span>æ–‡æ¡£<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radio</span>&gt;</span>          <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radioâ€group</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"å­¦ä¹ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰  è¯·è¾“å…¥æ•°å­—"</span> &gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"number"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.timelength"</span> <span class="hljs-attr">auto</span>â€<span class="hljs-attr">complete</span>=<span class="hljs-string">"off"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€</span></span><span class="hljs-tag"><span class="hljs-attr">input</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"æ’åºå­—æ®µ"</span> &gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.orderby"</span> <span class="hljs-attr">auto</span>â€<span class="hljs-attr">complete</span>=<span class="hljs-string">"off"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"ç« èŠ‚/è¯¾æ—¶ä»‹ç»"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"description"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textarea"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.description"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"çŠ¶æ€"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"status"</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radioâ€group</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.status"</span> &gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"0"</span> &gt;</span>æœªå‘å¸ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radio</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">'1'</span>&gt;</span>å·²å‘å¸ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radio</span>&gt;</span>          <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radioâ€group</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span>  &gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">on:click</span>=<span class="hljs-string">"addTeachplan"</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">on:click</span>=<span class="hljs-string">"resetForm"</span>&gt;</span>é‡ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€form</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€dialog</span>&gt;</span></code></pre></div><p>2ã€æ•°æ®æ¨¡å‹</p><p>åœ¨æ•°æ®æ¨¡å‹ä¸­æ·»åŠ å¦‚ä¸‹å˜é‡ï¼š</p><div class="hljs"><pre><code class="hljs js">teachplayFormVisible:<span class="hljs-literal">false</span>,teachplanRules: &#123;        pname: [            &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥è¯¾ç¨‹è®¡åˆ’åç§°'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;        ],            status: [                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·é€‰æ‹©çŠ¶æ€'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;            ]&#125;,teachplanActive:&#123;&#125;,</code></pre></div><p>3ã€ æ·»åŠ æŒ‰é’®</p><p>é€šè¿‡å˜é‡ <code>teachplayFormVisible</code> æ§åˆ¶å¼¹å‡ºçª—å£æ˜¯å¦æ˜¾ç¤ºã€‚</p><div class="hljs"><pre><code class="hljs vue">&lt;elâ€button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;teachplayFormVisible &#x3D; true&quot;&gt; æ·»åŠ è¯¾ç¨‹è®¡åˆ’&lt;&#x2F;elâ€button&gt;</code></pre></div><p>4ã€å®šä¹‰è¡¨å•æäº¤æ–¹æ³•å’Œé‡ç½®æ–¹æ³•</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// æäº¤è¯¾ç¨‹è®¡åˆ’</span>addTeachplan()&#123;    alert()&#125;,<span class="hljs-comment">//é‡ç½®è¡¨å•</span>resetForm()&#123;  <span class="hljs-keyword">this</span>.teachplanActive = &#123;&#125;&#125;,</code></pre></div><h3 id="APIæ¥å£-1"><a href="#APIæ¥å£-1" class="headerlink" title="APIæ¥å£"></a>APIæ¥å£</h3><p>1ï¼‰æ·»åŠ è¯¾ç¨‹è®¡åˆ’</p><div class="hljs"><pre><code class="hljs java">ApiOperation(<span class="hljs-string">"æ·»åŠ è¯¾ç¨‹è®¡åˆ’"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">addTeachplan</span><span class="hljs-params">(Teachplan teachplan)</span></span>;</code></pre></div><h3 id="è¯¾ç¨‹ç®¡ç†æœåŠ¡-1"><a href="#è¯¾ç¨‹ç®¡ç†æœåŠ¡-1" class="headerlink" title="è¯¾ç¨‹ç®¡ç†æœåŠ¡"></a>è¯¾ç¨‹ç®¡ç†æœåŠ¡</h3><h4 id="DAOå±‚"><a href="#DAOå±‚" class="headerlink" title="DAOå±‚"></a>DAOå±‚</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TeachplanRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Teachplan</span>, <span class="hljs-title">String</span>&gt; </span>&#123;    <span class="hljs-comment">//å®šä¹‰æ–¹æ³•æ ¹æ®è¯¾ç¨‹idå’Œçˆ¶ç»“ç‚¹idæŸ¥è¯¢å‡ºç»“ç‚¹åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•å®ç°æŸ¥è¯¢æ ¹ç»“ç‚¹</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Teachplan&gt; <span class="hljs-title">findByCourseidAndParentid</span><span class="hljs-params">(String courseId,String parentId)</span></span>;&#125;</code></pre></div><h4 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_course.service;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseBase;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.Teachplan;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.ext.TeachplanNode;<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;<span class="hljs-keyword">import</span> com.xuecheng.manage_course.dao.CourseBaseRepository;<span class="hljs-keyword">import</span> com.xuecheng.manage_course.dao.TeachplanMapper;<span class="hljs-keyword">import</span> com.xuecheng.manage_course.dao.TeachplanRepository;<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;<span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-keyword">import</span> java.util.Optional;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    TeachplanMapper teachplanMapper;    <span class="hljs-meta">@Autowired</span>    CourseBaseRepository courseBaseRepository;    <span class="hljs-meta">@Autowired</span>    TeachplanRepository teachplanRepository;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æ·»åŠ è¯¾ç¨‹è®¡åˆ’</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> teachplan</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Transactional</span>  <span class="hljs-comment">//å¢åˆ æ”¹æ“ä½œéƒ½éœ€è¦åŠ springäº‹åŠ¡</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">addTeachplan</span><span class="hljs-params">(Teachplan teachplan)</span> </span>&#123;        <span class="hljs-comment">//æ ¡éªŒè¯¾ç¨‹idå’Œè¯¾ç¨‹è®¡åˆ’åç§°</span>        <span class="hljs-keyword">if</span>(teachplan == <span class="hljs-keyword">null</span>|| StringUtils.isEmpty(teachplan.getCourseid()) || StringUtils.isEmpty(teachplan.getPname()))&#123;            ExceptionCast.cast(CommonCode.INVALID_PARAM);        &#125;        <span class="hljs-comment">//å–å‡ºè¯¾ç¨‹id</span>        String courseId = teachplan.getCourseid();        <span class="hljs-comment">//å–å‡ºçˆ¶èŠ‚ç‚¹id</span>        String parentId = teachplan.getParentid();        String newTeachplanGrade = <span class="hljs-string">"3"</span>;  <span class="hljs-comment">//è®¾ç½®æ–°èŠ‚ç‚¹çš„èœå•ç­‰çº§</span>        <span class="hljs-comment">// å¦‚æœç”¨æˆ·æœªåœ¨æ·»åŠ æ—¶å€™æœªé€‰æ‹©æ ¹èŠ‚ç‚¹,è¡¨ç¤ºéœ€è¦æ·»åŠ çš„æ˜¯ä¸€ä¸ªäºŒçº§èœå•ï¼Œå¹¶ä¸”é»˜è®¤æ·»åŠ åˆ°å½“å‰è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹ä¸‹</span>        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(parentId))&#123;            newTeachplanGrade = <span class="hljs-string">"2"</span>;            <span class="hljs-comment">//æ ¹æ®è¯¾ç¨‹idå–æ ¹èŠ‚ç‚¹çš„id</span>            parentId = <span class="hljs-keyword">this</span>.getTeachplanRoot(courseId);            <span class="hljs-keyword">if</span>(StringUtils.isEmpty(parentId))&#123;                ExceptionCast.cast(CommonCode.INVALID_PARAM);            &#125;        &#125;        <span class="hljs-comment">//åˆ›å»ºæ–°èŠ‚ç‚¹</span>        Teachplan teachplanNew = <span class="hljs-keyword">new</span> Teachplan();        <span class="hljs-comment">//å°†ä¼ å…¥çš„èŠ‚ç‚¹ä¿¡æ¯èµ‹å€¼åˆ°æ–°èŠ‚ç‚¹å†…</span>        BeanUtils.copyProperties(teachplan,teachplanNew);        teachplanNew.setParentid(parentId);        teachplanNew.setCourseid(courseId);        <span class="hljs-comment">/* è®¾ç½®æ–°èŠ‚ç‚¹çš„çº§åˆ«</span><span class="hljs-comment">            æ–¹æ³•1ï¼šæ ¹æ®çˆ¶èŠ‚ç‚¹çš„çº§åˆ«è¿›è¡Œè®¾ç½®ï¼Œçˆ¶èŠ‚ç‚¹çº§åˆ«ä¸º1ï¼Œå½“å‰åˆ™ä¸º2ï¼Œä¸º2åˆ™å½“å‰ä¸º3</span><span class="hljs-comment">            æ–¹æ³•2ï¼šåœ¨åˆ¤æ–­å‰ç«¯ä¼ å…¥çš„çˆ¶èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºæ—¶è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœä¸ºç©ºï¼Œè¡¨ç¤ºéœ€æ±‚ä¸ºæ·»åŠ äºŒçº§èŠ‚ç‚¹ï¼Œè®¾ç½®2</span><span class="hljs-comment">                  å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºè¦æ·»åŠ çš„æ˜¯ä¸‰çº§èŠ‚ç‚¹ï¼Œè®¾ç½®ä¸º3ï¼Œä¸æ–¹æ³•1ç›¸æ¯”å¯ä»¥å‡å°‘ä¸€æ¬¡æŸ¥è¯¢ã€‚</span><span class="hljs-comment">         */</span>        teachplanNew.setGrade(newTeachplanGrade); <span class="hljs-comment">//èŠ‚ç‚¹çº§åˆ«ï¼Œæ ¹æ®çˆ¶èŠ‚ç‚¹çš„çº§åˆ«è¿›è¡Œè®¾ç½®</span>        teachplanRepository.save(teachplanNew);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);    &#125;    <span class="hljs-comment">//æ ¹æ®è¯¾ç¨‹idè·å–è¯¾ç¨‹æ ¹èŠ‚ç‚¹idï¼Œå¦‚æœæ ¹èŠ‚ç‚¹ä¸å­˜åœ¨ åˆ™åˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå¹¶ä½œä¸ºè¯¥è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹</span>    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getTeachplanRoot</span><span class="hljs-params">(String courseId)</span></span>&#123;        <span class="hljs-comment">//æ ¡éªŒè¯¾ç¨‹id</span>        Optional&lt;CourseBase&gt; optional = courseBaseRepository.findById(courseId);        <span class="hljs-keyword">if</span>(!optional.isPresent())&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;        &#125;        CourseBase courseBase = optional.get();        <span class="hljs-comment">//å–å‡ºä¸€çº§æ ¹èŠ‚ç‚¹èœå•</span>        List&lt;Teachplan&gt; teachplanList = teachplanRepository.findByCourseidAndParentid(courseId, <span class="hljs-string">"0"</span>);        <span class="hljs-comment">//å¦‚æœæ ¹èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”ä½œä¸ºè¯¥è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹</span>        <span class="hljs-keyword">if</span>(teachplanList == <span class="hljs-keyword">null</span> || teachplanList.size() == <span class="hljs-number">0</span>)&#123;            <span class="hljs-comment">//æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹</span>            Teachplan teachplanNewRoot = <span class="hljs-keyword">new</span> Teachplan();            teachplanNewRoot.setCourseid(courseId);            teachplanNewRoot.setPname(courseBase.getName());            teachplanNewRoot.setCourseid(courseId);            teachplanNewRoot.setGrade(<span class="hljs-string">"1"</span>); <span class="hljs-comment">//1çº§èœå•</span>            teachplanNewRoot.setStatus(<span class="hljs-string">"0"</span>); <span class="hljs-comment">//æœªå‘å¸ƒ</span>            teachplanRepository.save(teachplanNewRoot);            <span class="hljs-keyword">return</span> teachplanNewRoot.getId();        &#125;        Teachplan teachplan = teachplanList.get(<span class="hljs-number">0</span>);        <span class="hljs-keyword">return</span> teachplan.getId();    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseId</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">findTeachplanList</span><span class="hljs-params">(String courseId)</span></span>&#123;        TeachplanNode teachplanNode = teachplanMapper.selectList(courseId);        <span class="hljs-keyword">return</span> teachplanNode;    &#125;&#125;</code></pre></div><h4 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_course.controller;<span class="hljs-keyword">import</span> com.xuecheng.api.course.CourseControllerApi;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.Teachplan;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.ext.TeachplanNode;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;<span class="hljs-keyword">import</span> com.xuecheng.manage_course.service.CourseService;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/course"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CourseControllerApi</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CourseService courseService;    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/teachplan/list/&#123;courseId&#125;"</span>)    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">findTeachplanList</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"courseId"</span>)</span> String courseId) </span>&#123;        <span class="hljs-keyword">return</span> courseService.findTeachplanList(courseId);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/teachplan/add"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">addTeachplan</span><span class="hljs-params">(@RequestBody Teachplan teachplan)</span> </span>&#123;        <span class="hljs-keyword">return</span> courseService.addTeachplan(teachplan);    &#125;&#125;</code></pre></div><h4 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>å¤æ‚ä¸€äº›çš„ä¸šåŠ¡é€»è¾‘å»ºè®®å†™å®ŒæœåŠ¡ç«¯ä»£ç å°±è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p><p>ä½¿ç”¨<code>swagger-ui</code> æˆ–<code>postman</code>æµ‹è¯•ä¸Šè¾¹çš„è¯¾ç¨‹è®¡åˆ’æ·»åŠ æ¥å£ã€‚</p><h3 id="å‰ç«¯Apiè°ƒç”¨"><a href="#å‰ç«¯Apiè°ƒç”¨" class="headerlink" title="å‰ç«¯Apiè°ƒç”¨"></a>å‰ç«¯Apiè°ƒç”¨</h3><p>1ã€å®šä¹‰ apiæ–¹æ³•</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/* æ·»åŠ è¯¾ç¨‹è®¡åˆ’*/</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addTeachplan = <span class="hljs-function"><span class="hljs-params">teachplah</span> =&gt;</span> &#123;  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/course/teachplan/add'</span>,teachplah)&#125;</code></pre></div><p>2ã€è°ƒç”¨ api</p><div class="hljs"><pre><code class="hljs js">addTeachplan()&#123;  <span class="hljs-keyword">this</span>.$refs.teachplayForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;    <span class="hljs-keyword">if</span> (valid) &#123;      <span class="hljs-comment">//æ·»åŠ è¯¾ç¨‹è®¡åˆ’æ—¶å¸¦ä¸Šè¯¾ç¨‹id</span>      <span class="hljs-keyword">this</span>.teachplanActive.courseid = <span class="hljs-keyword">this</span>.courseid;      courseApi.addTeachplan(<span class="hljs-keyword">this</span>.teachplanActive).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;        <span class="hljs-keyword">if</span>(res.success)&#123;          <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">'æäº¤æˆåŠŸ'</span>);          <span class="hljs-comment">//æ¸…ç©ºè¡¨å•</span>          <span class="hljs-keyword">this</span>.teachplanActive = &#123;&#125;          <span class="hljs-comment">//åˆ·æ–°æ•´ä¸ªæ ‘</span>          <span class="hljs-keyword">this</span>.findTeachplan();          &#125;<span class="hljs-keyword">else</span>&#123;          <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);        &#125;      &#125;);    &#125;  &#125;)&#125;,</code></pre></div><h3 id="æµ‹è¯•-3"><a href="#æµ‹è¯•-3" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æµ‹è¯•æµç¨‹ï¼š</p><p>1ã€æ–°å»ºä¸€ä¸ªè¯¾ç¨‹</p><p>2ã€å‘æ–°å»ºè¯¾ç¨‹ä¸­æ·»åŠ è¯¾ç¨‹è®¡åˆ’</p><p> æ·»åŠ ä¸€çº§ç»“ç‚¹</p><p> æ·»åŠ äºŒçº§ç»“ç‚¹</p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RabbitMQ</tag>
      
      <tag>GridFS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day05ï¼šæ¶ˆæ¯ä¸­é—´ä»¶RabbitMQ</title>
    <link href="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/"/>
    <url>/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day05</code> çš„å†…å®¹</p><ul><li><code>RabbitMQ</code> çš„åŸºæœ¬åº”ç”¨åœºæ™¯</li><li>ä½¿ç”¨åŸç”Ÿ<code>RabbitMQ</code> åº“æ„å»ºç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å‹</li><li>æ•´åˆ <code>Springboot</code> å®ç° <code>RabbitMQ</code> ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å‹</li></ul><h1 id="ä¸€ã€éœ€æ±‚åˆ†æ"><a href="#ä¸€ã€éœ€æ±‚åˆ†æ" class="headerlink" title="ä¸€ã€éœ€æ±‚åˆ†æ"></a>ä¸€ã€éœ€æ±‚åˆ†æ</h1><p><a href="https://qnoss.codeyee.com/20200704_5/image1" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image1.png" srcset="/img/loading.gif" alt="img"></a></p><p><strong>ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</strong></p><p>1ã€ç®¡ç†å‘˜è¿›å…¥ç®¡ç†ç•Œé¢ç‚¹å‡» â€œé¡µé¢å‘å¸ƒâ€ï¼Œå‰ç«¯è¯·æ±‚ <code>cms</code> é¡µé¢å‘å¸ƒæ¥å£ã€‚</p><p>2ã€cms é¡µé¢å‘å¸ƒæ¥å£æ‰§è¡Œé¡µé¢é™æ€åŒ–ï¼Œå¹¶å°†é™æ€åŒ–é¡µé¢(<code>html</code>æ–‡ä»¶)å­˜å‚¨è‡³<code>GridFS</code>ä¸­ã€‚</p><p>3ã€é™æ€åŒ–æˆåŠŸåï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€é¡µé¢å‘å¸ƒçš„æ¶ˆæ¯ã€‚é¡µé¢å‘å¸ƒçš„æœ€ç»ˆç›®æ ‡æ˜¯å°†é¡µé¢å‘å¸ƒåˆ°<strong>æœåŠ¡å™¨</strong>ã€‚é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†é¡µé¢å‘å¸ƒçš„æ¶ˆæ¯å‘é€ç»™å„ä¸ªæœåŠ¡å™¨ã€‚</p><p>4ã€æ¶ˆæ¯é˜Ÿåˆ—è´Ÿè´£å°†æ¶ˆæ¯å‘é€ç»™å„å„æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ <strong>Cms Client (Cmså®¢æˆ·ç«¯)</strong>ã€‚åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½² <strong>Cms Client(Cmså®¢æˆ·ç«¯)</strong>ï¼Œå®¢æˆ·ç«¯æ¥æ”¶æ¶ˆæ¯é˜Ÿåˆ—çš„é€šçŸ¥ã€‚</p><p>5ã€æ¯ä¸ªæ¥æ”¶åˆ°é¡µé¢å‘å¸ƒæ¶ˆæ¯çš„ <code>Cms Client</code> ä» <code>GridFS</code> è·å– <code>Html</code> é¡µé¢æ–‡ä»¶ï¼Œå¹¶å°† <code>Html</code> æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨ã€‚<code>CmsClient</code> æ ¹æ®é¡µé¢å‘å¸ƒæ¶ˆæ¯çš„å†…å®¹è¯·æ±‚ <code>GridFS</code> è·å–é¡µé¢æ–‡ä»¶ï¼Œå­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨ ã€‚</p><h1 id="äºŒã€åˆè¯†RabbitMQ"><a href="#äºŒã€åˆè¯†RabbitMQ" class="headerlink" title="äºŒã€åˆè¯†RabbitMQ"></a>äºŒã€åˆè¯†RabbitMQ</h1><p>è¦å®ç°ä¸Šè¾¹é¡µé¢å‘å¸ƒçš„åŠŸèƒ½ï¼Œæœ‰ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚å°±æ˜¯ç”±æ¶ˆæ¯é˜Ÿåˆ—å°†é¡µé¢å‘å¸ƒçš„æ¶ˆæ¯é€šçŸ¥ç»™å„å„æœåŠ¡å™¨ã€‚</p><p>æœ¬èŠ‚çš„æ•™å­¦ç›®æ ‡æ˜¯å¯¹MQçš„ç ”ç©¶ï¼š</p><p>1ã€ç†è§£MQçš„åº”ç”¨åœºæ™¯</p><p>2ã€ç†è§£MQå¸¸ç”¨çš„å·¥ä½œæ¨¡å¼</p><h2 id="1-ç®€å•çš„ä»‹ç»"><a href="#1-ç®€å•çš„ä»‹ç»" class="headerlink" title="1.ç®€å•çš„ä»‹ç»"></a>1.ç®€å•çš„ä»‹ç»</h2><h3 id="RabbitMQ-ç®€ä»‹"><a href="#RabbitMQ-ç®€ä»‹" class="headerlink" title="RabbitMQ ç®€ä»‹"></a>RabbitMQ ç®€ä»‹</h3><p>MQå…¨ç§°ä¸º Message Queueï¼Œå³æ¶ˆæ¯é˜Ÿåˆ—ï¼Œ <code>RabbitMQ</code>æ˜¯ç”± <code>erlang</code> è¯­è¨€å¼€å‘ï¼ŒåŸºäº<strong>AMQPï¼ˆAdvanced Message Queue é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰</strong>åè®®å®ç°çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒæ˜¯ä¸€ç§åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡æ–¹æ³•ï¼Œæ¶ˆæ¯é˜Ÿåˆ—åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘ä¸­åº”ç”¨éå¸¸å¹¿æ³›ã€‚</p><p>RabbitMQå®˜æ–¹åœ°å€ï¼š<a href="http://www.rabbitmq.com/" target="_blank" rel="noopener">http://www.rabbitmq.com/</a></p><p>å¼€å‘ä¸­æ¶ˆæ¯é˜Ÿåˆ—é€šå¸¸æœ‰å¦‚ä¸‹åº”ç”¨åœºæ™¯ï¼š</p><ul><li><p><strong>ä»»åŠ¡å¼‚æ­¥å¤„ç†</strong></p><p>å°†ä¸éœ€è¦åŒæ­¥å¤„ç†çš„å¹¶ä¸”è€—æ—¶é•¿çš„æ“ä½œç”±æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥æ¶ˆæ¯æ¥æ”¶æ–¹è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚æé«˜äº†åº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´ã€‚</p></li><li><p><strong>åº”ç”¨ç¨‹åºè§£è€¦åˆ</strong></p><p>MQç›¸å½“äºä¸€ä¸ªä¸­ä»‹ï¼Œç”Ÿäº§æ–¹é€šè¿‡MQä¸æ¶ˆè´¹æ–¹äº¤äº’ï¼Œå®ƒå°†åº”ç”¨ç¨‹åºè¿›è¡Œè§£è€¦åˆã€‚</p></li><li><p><strong>å¸‚åœºä¸Šè¿˜æœ‰å“ªäº›æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</strong><br>ActiveMQï¼ŒRabbitMQï¼ŒZeroMQï¼ŒKafkaï¼ŒMetaMQï¼ŒRocketMQã€Redisã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨RabbitMQå‘¢ï¼Ÿ</strong></p><p>1ã€ä½¿å¾—ç®€å•ï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚<br>2ã€åŸºäº <code>AMQP</code> åè®®ã€‚<br>3ã€ç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å®Œå–„ã€‚<br>4ã€é«˜å¹¶å‘æ€§èƒ½å¥½ï¼Œè¿™ä¸»è¦å¾—ç›Šäº <code>Erlang</code> è¯­è¨€ã€‚<br>5ã€Spring Boot é»˜è®¤å·²é›†æˆ <code>RabbitMQ</code></p></li></ul><h3 id="å…¶å®ƒç›¸å…³çŸ¥è¯†"><a href="#å…¶å®ƒç›¸å…³çŸ¥è¯†" class="headerlink" title="å…¶å®ƒç›¸å…³çŸ¥è¯†"></a>å…¶å®ƒç›¸å…³çŸ¥è¯†</h3><p>AMQPæ˜¯ä»€ä¹ˆ ï¼Ÿ</p><p><code>AMQP</code> æ˜¯ä¸€å¥—å…¬å¼€çš„æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæœ€æ—©åœ¨2003å¹´è¢«æå‡ºï¼Œå®ƒæ—¨åœ¨ä»åè®®å±‚å®šä¹‰æ¶ˆæ¯é€šä¿¡æ•°æ®çš„æ ‡å‡†æ ¼å¼ï¼Œä¸ºçš„å°±æ˜¯è§£å†³ <code>MQ</code> å¸‚åœºä¸Šåè®®ä¸ç»Ÿä¸€çš„é—®é¢˜ã€‚<code>RabbitMQ</code> å°±æ˜¯éµå¾ª <code>AMQP</code> æ ‡å‡†åè®®å¼€å‘çš„MQæœåŠ¡ã€‚</p><p>JMSæ˜¯ä»€ä¹ˆ ï¼Ÿ</p><p><code>JMS</code>æ˜¯ <code>java</code> æä¾›çš„ä¸€å¥—æ¶ˆæ¯æœåŠ¡APIæ ‡å‡†ï¼Œå…¶ç›®çš„æ˜¯ä¸ºæ‰€æœ‰çš„ <code>java</code> åº”ç”¨ç¨‹åºæä¾›ç»Ÿä¸€çš„æ¶ˆæ¯é€šä¿¡çš„æ ‡å‡†ï¼Œç±»ä¼¼ <code>java</code> çš„ <code>jdbc</code>ï¼Œåªè¦éµå¾ª <code>jms</code> æ ‡å‡†çš„åº”ç”¨ç¨‹åºä¹‹é—´éƒ½å¯ä»¥è¿›è¡Œæ¶ˆæ¯é€šä¿¡ã€‚å®ƒå’Œ <code>AMQP</code> æœ‰ä»€ä¹ˆ ä¸åŒï¼Œ<code>jms</code> æ˜¯javaè¯­è¨€ä¸“å±çš„æ¶ˆæ¯æœåŠ¡æ ‡å‡†ï¼Œå®ƒæ˜¯åœ¨apiå±‚å®šä¹‰æ ‡å‡†ï¼Œå¹¶ä¸”åªèƒ½ç”¨äº <code>java</code> åº”ç”¨ï¼›è€Œ <code>AMQP</code> æ˜¯åœ¨åè®®å±‚å®šä¹‰çš„æ ‡å‡†ï¼Œæ˜¯è·¨è¯­è¨€çš„ ã€‚</p><h2 id="2-å¿«é€Ÿå…¥é—¨"><a href="#2-å¿«é€Ÿå…¥é—¨" class="headerlink" title="2. å¿«é€Ÿå…¥é—¨"></a>2. å¿«é€Ÿå…¥é—¨</h2><h3 id="RabbitMQ-çš„å·¥ä½œåŸç†"><a href="#RabbitMQ-çš„å·¥ä½œåŸç†" class="headerlink" title="RabbitMQ çš„å·¥ä½œåŸç†"></a>RabbitMQ çš„å·¥ä½œåŸç†</h3><p>ä¸‹å›¾æ˜¯ <code>RabbitMQ</code> çš„åŸºæœ¬ç»“æ„</p><p><a href="https://qnoss.codeyee.com/20200704_5/image2" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image2.png" srcset="/img/loading.gif" alt="img"></a></p><p>ç»„æˆéƒ¨åˆ†è¯´æ˜å¦‚ä¸‹ï¼š</p><ul><li><strong>Broker</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡è¿›ç¨‹ï¼Œæ­¤è¿›ç¨‹åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼š<code>Exchange</code> å’Œ <code>Queue</code>ã€‚</li><li><strong>Exchange</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—äº¤æ¢æœºï¼ŒæŒ‰ä¸€å®šçš„è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±è½¬å‘åˆ°æŸä¸ªé˜Ÿåˆ—ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œè¿‡æ»¤ã€‚</li><li><strong>Queue</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‚¨å­˜æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œæ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—å¹¶è½¬å‘ç»™æŒ‡å®šçš„æ¶ˆè´¹æ–¹ã€‚</li><li><strong>Producer</strong>ï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå³ç”Ÿäº§æ–¹å®¢æˆ·ç«¯ï¼Œç”Ÿäº§æ–¹å®¢æˆ·ç«¯å°†æ¶ˆæ¯å‘é€åˆ° <code>MQ</code> ã€‚</li><li><strong>Consumer</strong>ï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå³æ¶ˆè´¹æ–¹å®¢æˆ·ç«¯ï¼Œæ¥æ”¶ <code>MQ</code> è½¬å‘çš„æ¶ˆæ¯ã€‚</li></ul><p>æ¶ˆæ¯ <strong>å‘å¸ƒ</strong> ä¸ <strong>æ¥æ”¶</strong> æµç¨‹ï¼š</p><p>â€”â€“å‘é€æ¶ˆæ¯â€”â€“</p><p>1ã€ç”Ÿäº§è€…å’Œ <code>Broker</code> å»ºç«‹TCPè¿æ¥ã€‚</p><p>2ã€ç”Ÿäº§è€…å’Œ <code>Broker</code> å»ºç«‹é€šé“ã€‚</p><p>3ã€ç”Ÿäº§è€…é€šè¿‡é€šé“æ¶ˆæ¯å‘é€ç»™ <code>Broker</code> ï¼Œç”± <code>Exchange</code> å°†æ¶ˆæ¯è¿›è¡Œè½¬å‘ã€‚</p><p>4ã€<code>Exchange</code>å°†æ¶ˆæ¯è½¬å‘åˆ°æŒ‡å®šçš„ <code>Queue</code>ï¼ˆé˜Ÿåˆ—ï¼‰</p><p>â€”-æ¥æ”¶æ¶ˆæ¯â€”â€“</p><p>1ã€æ¶ˆè´¹è€…å’Œ <code>Broker</code> å»ºç«‹TCPè¿æ¥</p><p>2ã€æ¶ˆè´¹è€…å’Œ <code>Broker</code> å»ºç«‹é€šé“</p><p>3ã€æ¶ˆè´¹è€…ç›‘å¬æŒ‡å®šçš„ <code>Queue</code>ï¼ˆé˜Ÿåˆ—ï¼‰</p><p>4ã€å½“æœ‰æ¶ˆæ¯åˆ°è¾¾ <code>Queue</code> æ—¶ <code>Broker</code> é»˜è®¤å°†æ¶ˆæ¯æ¨é€ç»™æ¶ˆè´¹è€…ã€‚</p><p>5ã€æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚</p><h3 id="å®‰è£…-RabbitMQ"><a href="#å®‰è£…-RabbitMQ" class="headerlink" title="å®‰è£… RabbitMQ"></a>å®‰è£… RabbitMQ</h3><h4 id="1ã€ä¸‹è½½å¹¶å®‰è£…"><a href="#1ã€ä¸‹è½½å¹¶å®‰è£…" class="headerlink" title="1ã€ä¸‹è½½å¹¶å®‰è£…"></a>1ã€ä¸‹è½½å¹¶å®‰è£…</h4><p>RabbitMQç”± <code>Erlang</code> è¯­è¨€å¼€å‘ï¼Œ<code>Erlang</code> è¯­è¨€ç”¨äºå¹¶å‘åŠåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼€å‘ï¼Œåœ¨ç”µä¿¡é¢†åŸŸåº”ç”¨å¹¿æ³›ï¼ŒOTPï¼ˆOpenTelecom Platformï¼‰ä½œä¸º <code>Erlang</code> è¯­è¨€çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ…å«äº†å¾ˆå¤šåŸºäº <code>Erlang</code> å¼€å‘çš„ä¸­é—´ä»¶åŠå·¥å…·åº“ï¼Œå®‰è£… <code>RabbitMQ</code> éœ€è¦å®‰è£… Erlang/OTPï¼Œå¹¶ä¿æŒç‰ˆæœ¬åŒ¹é…ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_5/image3" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image3.png" srcset="/img/loading.gif" alt="img"></a></p><p>æœ¬é¡¹ç›®ä½¿ç”¨ <code>Erlang/OTP 20.3</code> ç‰ˆæœ¬å’Œ <code>RabbitMQ3.7.3</code> ç‰ˆæœ¬ã€‚</p><p>å®˜ç½‘ <code>RabbitMQ</code> çš„ä¸‹è½½åœ°å€ï¼š<a href="http://www.rabbitmq.com/download.html" target="_blank" rel="noopener">http://www.rabbitmq.com/download.html</a></p><h5 id="ä¸‹è½½erlang"><a href="#ä¸‹è½½erlang" class="headerlink" title="ä¸‹è½½erlang"></a>ä¸‹è½½erlang</h5><p>åœ°å€å¦‚ä¸‹ï¼š<a href="http://erlang.org/download/otp_win64_20.3.exe" target="_blank" rel="noopener">http://erlang.org/download/otp_win64_20.3.exe</a></p><p>erlangå®‰è£…å®Œæˆéœ€è¦é…ç½®erlangç¯å¢ƒå˜é‡ï¼š ERLANG_HOME=D:\Program Files\erl9.3 åœ¨pathä¸­æ·»<br>åŠ %ERLANG_HOME%\bin;</p><h5 id="å®‰è£…RabbitMQ"><a href="#å®‰è£…RabbitMQ" class="headerlink" title="å®‰è£…RabbitMQ"></a>å®‰è£…RabbitMQ</h5><p>ä¸‹è½½åœ°å€ <a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v3.7.3" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-server/releases/tag/v3.7.3</a></p><p>è¿™é‡Œè¦æ³¨æ„ rabbitMQçš„å®‰è£…è·¯å¾„</p><h4 id="2ã€å¯åŠ¨"><a href="#2ã€å¯åŠ¨" class="headerlink" title="2ã€å¯åŠ¨"></a>2ã€å¯åŠ¨</h4><p>å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨åˆ›å»ºRabbitMQæœåŠ¡å¹¶ä¸”å¯åŠ¨ã€‚</p><ol><li><p>åœ¨ç³»ç»Ÿpathå˜é‡ä¸­æ·»åŠ  <code>rabbitMQ</code> çš„ç¯å¢ƒå˜é‡ï¼š<code>D:\[rabbitMQçš„å®‰è£…è·¯å¾„]\sbin;</code></p></li><li><p>æ·»åŠ ç¯å¢ƒå˜é‡åï¼ŒæŒ‰ä¸‹ <code>Win + X</code> ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œpowershell æˆ–è€… cmd</p></li><li><p>è¿è¡Œ <code>rabbitmq-plugins.bat enable rabbitmq_management</code> å‘½ä»¤</p><p><a href="https://qnoss.codeyee.com/20200704_5/image4" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image4.png" srcset="/img/loading.gif" alt="å®‰è£…è¿‡ç¨‹"></a></p><p><a href="https://qnoss.codeyee.com/20200704_5/image4" target="_blank" rel="noopener">å®‰è£…è¿‡ç¨‹</a></p><p>â€‹</p></li><li><p>è¿è¡Œ <code>rabbitmq-service.bat stop</code> å’Œ <code>rabbitmq-service.bat start</code> é‡å¯ rabbitMQ</p></li><li><p>å¯åŠ¨æˆåŠŸï¼Œè®¿é—® <a href="http://localhost:15672/" target="_blank" rel="noopener">http://localhost:15672</a> ç™»å½•Rabbit MQï¼Œåˆå§‹è´¦å·å¯†ç ä¸º guest/guest</p></li></ol><h4 id="3ã€æ³¨æ„äº‹é¡¹"><a href="#3ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="3ã€æ³¨æ„äº‹é¡¹"></a>3ã€æ³¨æ„äº‹é¡¹</h4><p>1ã€å®‰è£… <code>erlang</code> å’Œ <code>rabbitMQ</code> ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€‚</p><p>2ã€å½“å¸è½½é‡æ–°å®‰è£…æ—¶ä¼šå‡ºç° <code>RabbitMQ</code> æœåŠ¡æ³¨å†Œå¤±è´¥ï¼Œæ­¤æ—¶éœ€è¦è¿›å…¥æ³¨å†Œè¡¨æ¸…ç† <code>erlang</code><br>æœç´¢RabbitMQã€ErlSrvï¼Œå°†å¯¹åº”çš„é¡¹å…¨éƒ¨åˆ é™¤ã€‚</p><h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><p><a href="https://qnoss.codeyee.com/20200704_5/image5" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image5.png" srcset="/img/loading.gif" alt="å·¥ä½œæ¨¡å¼"></a></p><p>ä»¥ä¸‹è¿‡ç¨‹æˆ‘ä»¬å‚è€ƒå®˜æ–¹æ•™ç¨‹(<a href="http://www.rabbitmq.com/getstarted.html" target="_blank" rel="noopener">http://www.rabbitmq.com/getstarted.html</a>)æµ‹è¯•hello world:</p><h4 id="1ã€æ­å»ºç¯å¢ƒ"><a href="#1ã€æ­å»ºç¯å¢ƒ" class="headerlink" title="1ã€æ­å»ºç¯å¢ƒ"></a>1ã€æ­å»ºç¯å¢ƒ</h4><h5 id="java-client"><a href="#java-client" class="headerlink" title="java client"></a>java client</h5><p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½å±äºå®¢æˆ·ç«¯ï¼ŒrabbitMQçš„javaå®¢æˆ·ç«¯å¦‚ä¸‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_5/image6" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image6.png" srcset="/img/loading.gif" alt="img"></a></p><p>æˆ‘ä»¬å…ˆç”¨ <code>rabbitMQ</code> å®˜æ–¹æä¾›çš„ <code>java client</code> æµ‹è¯•ï¼Œç›®çš„æ˜¯å¯¹ <code>RabbitMQ</code> çš„äº¤äº’è¿‡ç¨‹æœ‰ä¸ªæ¸…æ™°çš„è®¤è¯†ã€‚</p><p>å‚è€ƒ ï¼š<a href="https://github.com/rabbitmq/rabbitmq-java-client/" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-java-client/</a></p><h5 id="åˆ›å»ºmavenå·¥ç¨‹"><a href="#åˆ›å»ºmavenå·¥ç¨‹" class="headerlink" title="åˆ›å»ºmavenå·¥ç¨‹"></a>åˆ›å»ºmavenå·¥ç¨‹</h5><p>åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹å’Œæ¶ˆè´¹è€…å·¥ç¨‹ï¼Œåˆ†åˆ«åŠ å…¥<code>RabbitMQ java client</code>çš„ä¾èµ–ã€‚</p><p>test-rabbitmq-producerï¼šç”Ÿäº§è€…å·¥ç¨‹</p><p>test-rabbitmq-consumerï¼šæ¶ˆè´¹è€…å·¥ç¨‹</p><p><strong>ä¾èµ–é…ç½®å¦‚ä¸‹ï¼š</strong></p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.rabbitmq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>amqp-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-comment">&lt;!--æ­¤ç‰ˆæœ¬ä¸spring boot 1.5.9ç‰ˆæœ¬åŒ¹é…--&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div><p><a href="https://qnoss.codeyee.com/20200704_5/image7" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image7.png" srcset="/img/loading.gif" alt="img"></a></p><h4 id="2ã€ç”Ÿäº§è€…"><a href="#2ã€ç”Ÿäº§è€…" class="headerlink" title="2ã€ç”Ÿäº§è€…"></a>2ã€ç”Ÿäº§è€…</h4><p>åœ¨ç”Ÿäº§è€…å·¥ç¨‹ä¸‹çš„å•å…ƒæµ‹è¯•å†…åˆ›å»ºæµ‹è¯•ç±»å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer01</span> </span>&#123;    <span class="hljs-comment">//é˜Ÿåˆ—åç§°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE = <span class="hljs-string">"helloworld2"</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;        Connection connection = <span class="hljs-keyword">null</span>;        Channel channel = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">//æ„å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½®ä¸€äº›åŸºæœ¬çš„é“¾æ¥ä¿¡æ¯</span>            ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();            factory.setHost(<span class="hljs-string">"localhost"</span>);            factory.setPort(<span class="hljs-number">5672</span>);            factory.setUsername(<span class="hljs-string">"guest"</span>);            factory.setPassword(<span class="hljs-string">"guest"</span>);            <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>            factory.setVirtualHost(<span class="hljs-string">"/"</span>);            <span class="hljs-comment">//åˆ›å»ºä¸RabbitMQæœåŠ¡çš„TCPè¿æ¥</span>            connection = factory.newConnection();            <span class="hljs-comment">//åˆ›å»ºä¸Exchangeçš„é€šé“ï¼Œæ¯ä¸ªè¿æ¥å¯ä»¥åˆ›å»ºå¤šä¸ªé€šé“ï¼Œæ¯ä¸ªé€šé“ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡</span>            channel = connection.createChannel();            <span class="hljs-comment">/**</span><span class="hljs-comment">             * å£°æ˜é˜Ÿåˆ—ï¼Œå¦‚æœRabbitä¸­æ²¡æœ‰æ­¤é˜Ÿåˆ—ï¼Œå°†è‡ªåŠ¨åˆ›å»º</span><span class="hljs-comment">             * String queue, boolean durable, boolean exclusive, boolean autoDelete,Map&lt;String, Object&gt; arguments</span><span class="hljs-comment">             *</span><span class="hljs-comment">             * param1:é˜Ÿåˆ—åç§°</span><span class="hljs-comment">             * param2:æ˜¯å¦æŒä¹…åŒ–</span><span class="hljs-comment">             * param3:é˜Ÿåˆ—æ˜¯å¦ç‹¬å æ­¤è¿æ¥</span><span class="hljs-comment">             * param4:é˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—</span><span class="hljs-comment">             * param5:é˜Ÿåˆ—å‚æ•°</span><span class="hljs-comment">             */</span>            channel.queueDeclare(QUEUE,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);            String message = <span class="hljs-string">"hello world å°æ˜"</span> + System.currentTimeMillis();            <span class="hljs-comment">/**</span><span class="hljs-comment">             * æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span><span class="hljs-comment">             æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span><span class="hljs-comment">             * param1ï¼šExchangeçš„åç§°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä½¿ç”¨Default Exchange</span><span class="hljs-comment">             * param2:routingKey,æ¶ˆæ¯çš„è·¯ç”±Keyï¼Œæ˜¯ç”¨äºExchangeï¼ˆäº¤æ¢æœºï¼‰å°†æ¶ˆæ¯è½¬å‘åˆ°æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—</span><span class="hljs-comment">             * param3:æ¶ˆæ¯åŒ…å«çš„å±æ€§</span><span class="hljs-comment">             * param4ï¼šæ¶ˆæ¯ä½“</span><span class="hljs-comment">             * è¿™é‡Œæ²¡æœ‰æŒ‡å®šäº¤æ¢æœºï¼Œæ¶ˆæ¯å°†å‘é€ç»™é»˜è®¤äº¤æ¢æœºï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¹Ÿä¼šç»‘å®šé‚£ä¸ªé»˜è®¤çš„äº¤æ¢æœºï¼Œä½†æ˜¯ä¸èƒ½æ˜¾ç¤ºç»‘å®šæˆ–è§£é™¤ç»‘å®š</span><span class="hljs-comment">             * é»˜è®¤çš„äº¤æ¢æœºï¼ŒroutingKeyç­‰äºé˜Ÿåˆ—åç§°</span><span class="hljs-comment">             */</span>            channel.basicPublish(<span class="hljs-string">""</span>,QUEUE,<span class="hljs-keyword">null</span>,message.getBytes());            System.out.println(<span class="hljs-string">"Send Message is: ' "</span> + message + <span class="hljs-string">" '"</span>);        &#125;<span class="hljs-keyword">catch</span> ( Exception ex)&#123;            ex.printStackTrace();        &#125;<span class="hljs-keyword">finally</span> &#123;            <span class="hljs-comment">//å…ˆå…³é—­é€šé“ï¼Œå†å…³é—­è¿æ¥</span>            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;                channel.close();            &#125;            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;                connection.close();            &#125;        &#125;    &#125;&#125;</code></pre></div><p>è¿è¡Œç”Ÿäº§è€…åï¼Œ<code>RabbitMQ</code> åå°ä¼šæ¥æ”¶åˆ°ä¸€æ¡ç­‰å¾…æ¶ˆè´¹çš„æ¶ˆæ¯</p><p><a href="https://qnoss.codeyee.com/20200704_5/image8" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image8.png" srcset="/img/loading.gif" alt="img"></a></p><h4 id="3ã€æ¶ˆè´¹è€…"><a href="#3ã€æ¶ˆè´¹è€…" class="headerlink" title="3ã€æ¶ˆè´¹è€…"></a>3ã€æ¶ˆè´¹è€…</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.rabbitmq.client.*;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer01</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE = <span class="hljs-string">"helloworld2"</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;        ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();        factory.setHost(<span class="hljs-string">"localhost"</span>);        factory.setPort(<span class="hljs-number">5672</span>);        factory.setUsername(<span class="hljs-string">"guest"</span>);        factory.setPassword(<span class="hljs-string">"guest"</span>);        <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>        factory.setVirtualHost(<span class="hljs-string">"/"</span>);        Connection connection = factory.newConnection();        Channel channel = connection.createChannel();        <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span>        <span class="hljs-comment">/** å‚æ•°ï¼šString queue, boolean durable, boolean exclusive, boolean autoDelete,</span><span class="hljs-comment">         Map&lt;String, Object&gt; arguments</span><span class="hljs-comment">         * å‚æ•°æ˜ç»†ï¼š</span><span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span><span class="hljs-comment">         * 2ã€durable æ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ï¼Œmqé‡å¯åé˜Ÿåˆ—è¿˜åœ¨</span><span class="hljs-comment">         * 3ã€exclusive æ˜¯å¦ç‹¬å è¿æ¥ï¼Œé˜Ÿåˆ—åªå…è®¸åœ¨è¯¥è¿æ¥ä¸­è®¿é—®ï¼Œå¦‚æœconnectionè¿æ¥å…³é—­ï¼Œé˜Ÿåˆ—åˆ™è‡ªåŠ¨åˆ é™¤,å¯ç”¨äºä¸´æ—¶é˜Ÿåˆ—çš„åˆ›å»º</span><span class="hljs-comment">         * 4ã€autoDelete è‡ªåŠ¨åˆ é™¤ï¼Œé˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—ï¼Œå¦‚æœå°†æ­¤å‚æ•°å’Œexclusiveå…±åŒä¸ºtrueï¼Œå°±å¯ä»¥å®ç°ä¸´æ—¶é˜Ÿåˆ—</span><span class="hljs-comment">         * 5ã€argmuacntsï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—æ‰©å±•å‚æ•°ï¼Œæ¯”å¦‚ï¼šå¯è®¾ç½®å­˜æ´»çš„æ—¶é—´</span><span class="hljs-comment">         */</span>        channel.queueDeclare(QUEUE, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);        <span class="hljs-comment">//å®šä¹‰æ¶ˆè´¹æ–¹æ³•</span>        DefaultConsumer defaultConsumer = <span class="hljs-keyword">new</span> DefaultConsumer(channel) &#123;            <span class="hljs-comment">/**</span><span class="hljs-comment">             * æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯è°ƒç”¨æ­¤æ–¹æ³•</span><span class="hljs-comment">             * <span class="hljs-doctag">@param</span> consumerTag æ¶ˆè´¹è€…çš„æ ‡ç­¾ï¼Œåœ¨channel.basicConsume()å»æŒ‡å®š</span><span class="hljs-comment">             * <span class="hljs-doctag">@param</span> envelope æ¶ˆæ¯åŒ…çš„å†…å®¹ï¼Œå¯ä»ä¸­è·å–æ¶ˆæ¯idï¼Œæ¶ˆæ¯routingkeyï¼Œäº¤æ¢æœºï¼Œæ¶ˆæ¯å’Œé‡ä¼ æ ‡å¿—</span><span class="hljs-comment">            (æ”¶åˆ°æ¶ˆæ¯å¤±è´¥åæ˜¯å¦éœ€è¦é‡æ–°å‘é€)</span><span class="hljs-comment">             * <span class="hljs-doctag">@param</span> properties æ¶ˆæ¯å±æ€§</span><span class="hljs-comment">             * <span class="hljs-doctag">@param</span> body æ¶ˆæ¯å†…å®¹</span><span class="hljs-comment">             * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">            1ã€å‘é€ç«¯æ“ä½œæµç¨‹</span><span class="hljs-comment">            1ï¼‰åˆ›å»ºè¿æ¥</span><span class="hljs-comment">            2ï¼‰åˆ›å»ºé€šé“</span><span class="hljs-comment">            3ï¼‰å£°æ˜é˜Ÿåˆ—</span><span class="hljs-comment">            4ï¼‰å‘é€æ¶ˆæ¯</span><span class="hljs-comment">            2ã€æ¥æ”¶ç«¯</span><span class="hljs-comment">            1ï¼‰åˆ›å»ºè¿æ¥</span><span class="hljs-comment">            2ï¼‰åˆ›å»ºé€šé“</span><span class="hljs-comment">            3ï¼‰å£°æ˜é˜Ÿåˆ—</span><span class="hljs-comment">            4ï¼‰ç›‘å¬é˜Ÿåˆ—</span><span class="hljs-comment">            5ï¼‰æ¥æ”¶æ¶ˆæ¯</span><span class="hljs-comment">             */</span>            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleDelivery</span><span class="hljs-params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="hljs-keyword">byte</span>[] body)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;                <span class="hljs-comment">//äº¤æ¢æœº</span>                String exchange = envelope.getExchange();                <span class="hljs-comment">//è·¯ç”±key</span>                String routingKey = envelope.getRoutingKey();                <span class="hljs-comment">//æ¶ˆæ¯id</span>                <span class="hljs-keyword">long</span> deliveryTag = envelope.getDeliveryTag();                <span class="hljs-comment">//æ¶ˆæ¯å†…å®¹</span>                String msg = <span class="hljs-keyword">new</span> String(body, <span class="hljs-string">"utf-8"</span>);                System.out.println(<span class="hljs-string">"receive message.."</span> + msg);            &#125;        &#125;;        <span class="hljs-comment">/**</span><span class="hljs-comment">         * ç›‘å¬é˜Ÿåˆ—String queue, boolean autoAck,Consumer callback</span><span class="hljs-comment">         * å‚æ•°æ˜ç»†</span><span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span><span class="hljs-comment">         * 2ã€autoAck æ˜¯å¦è‡ªåŠ¨å›å¤ï¼Œè®¾ç½®ä¸ºtrueä¸ºè¡¨ç¤ºæ¶ˆæ¯æ¥æ”¶åˆ°è‡ªåŠ¨å‘mqå›å¤æ¥æ”¶åˆ°äº†ï¼Œmqæ¥æ”¶åˆ°å›å¤ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œè®¾ç½®ä¸ºfalseåˆ™éœ€è¦æ‰‹åŠ¨å›å¤</span><span class="hljs-comment">         * 3ã€callback æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³•ï¼Œæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åè°ƒç”¨æ­¤æ–¹æ³•</span><span class="hljs-comment">         */</span>        channel.basicConsume(QUEUE, <span class="hljs-keyword">true</span>, defaultConsumer);    &#125;&#125;</code></pre></div><h4 id="4ã€æ¶ˆæ¯æ¥æ”¶æµ‹è¯•"><a href="#4ã€æ¶ˆæ¯æ¥æ”¶æµ‹è¯•" class="headerlink" title="4ã€æ¶ˆæ¯æ¥æ”¶æµ‹è¯•"></a>4ã€æ¶ˆæ¯æ¥æ”¶æµ‹è¯•</h4><p><a href="https://qnoss.codeyee.com/20200704_5/image9" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image9.gif" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-å·¥ä½œæ¨¡å¼"><a href="#3-å·¥ä½œæ¨¡å¼" class="headerlink" title="3. å·¥ä½œæ¨¡å¼"></a>3. å·¥ä½œæ¨¡å¼</h2><p><code>RabbitMQ</code> æœ‰ä»¥ä¸‹å‡ ç§å·¥ä½œæ¨¡å¼ ï¼š</p><p>1ã€Work queuesï¼Œå·¥ä½œé˜Ÿåˆ—æ¨¡å¼</p><p>2ã€Publish/Subscribeï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼</p><p>3ã€Routingï¼Œè·¯ç”±æ¨¡å¼</p><p>4ã€Topicsï¼Œé€šé…ç¬¦æ¨¡å¼</p><p>5ã€Headerï¼Œheaderæ¨¡å¼</p><p>6ã€RPC ï¼Œrpcæ¨¡å¼</p><h3 id="Work-queues-æ¨¡å¼"><a href="#Work-queues-æ¨¡å¼" class="headerlink" title="Work queues æ¨¡å¼"></a>Work queues æ¨¡å¼</h3><p><code>work queues</code> å·¥ä½œæ¨¡å¼ï¼Œä¸å…¥é—¨ç¨‹åºç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªæ¶ˆè´¹ç«¯ï¼Œä¸¤ä¸ªæ¶ˆè´¹ç«¯å…±åŒæ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</p><p>åº”ç”¨åœºæ™¯ï¼šå¯¹äº <strong>ä»»åŠ¡è¿‡é‡</strong> æˆ– <strong>ä»»åŠ¡è¾ƒå¤š</strong> æƒ…å†µä½¿ç”¨å·¥ä½œé˜Ÿåˆ—å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦ ã€‚</p><p><strong>æµ‹è¯•ï¼š</strong></p><p>1ã€ä½¿ç”¨å…¥é—¨ç¨‹åºï¼Œå¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…ã€‚</p><p>2ã€ç”Ÿäº§è€…å‘é€å¤šä¸ªæ¶ˆæ¯ã€‚</p><p><strong>æµ‹è¯•ç»“æœï¼š</strong></p><p><a href="https://qnoss.codeyee.com/20200704_5/image10" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image10.gif" srcset="/img/loading.gif" alt="img"></a></p><p>1ã€ä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶ï¼›</p><p>2ã€<code>rabbit</code> é‡‡ç”¨ <strong>è½®è¯¢</strong> çš„æ–¹å¼å°†æ¶ˆæ¯æ˜¯å¹³å‡å‘é€ç»™æ¶ˆè´¹è€…çš„ï¼›</p><p>3ã€æ¶ˆè´¹è€…åœ¨å¤„ç†å®ŒæŸæ¡æ¶ˆæ¯åï¼Œæ‰ä¼šæ”¶åˆ°ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚</p><h3 id="Publish-Subscribe-æ¨¡å¼"><a href="#Publish-Subscribe-æ¨¡å¼" class="headerlink" title="Publish/Subscribe æ¨¡å¼"></a>Publish/Subscribe æ¨¡å¼</h3><h4 id="1ã€å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#1ã€å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="1ã€å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>1ã€å‘å¸ƒè®¢é˜…æ¨¡å¼</h4><p><a href="https://qnoss.codeyee.com/20200704_5/image11" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image11.png" srcset="/img/loading.gif" alt="å‘å¸ƒè®¢é˜…æ¨¡å¼"></a></p><p><a href="https://qnoss.codeyee.com/20200704_5/image11" target="_blank" rel="noopener"></a></p><p>1ã€æ¯ä¸ªæ¶ˆè´¹è€…ç›‘å¬è‡ªå·±çš„é˜Ÿåˆ—ã€‚</p><p>2ã€ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™ <code>broker</code>ï¼Œç”±äº¤æ¢æœºå°†æ¶ˆæ¯è½¬å‘åˆ°ç»‘å®šæ­¤äº¤æ¢æœºçš„æ¯ä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªç»‘å®šäº¤æ¢æœºçš„é˜Ÿåˆ—éƒ½å°†æ¥æ”¶åˆ°æ¶ˆæ¯ ã€‚</p><h4 id="2ã€ä»£ç "><a href="#2ã€ä»£ç " class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><p>æ¡ˆä¾‹ï¼š</p><p>ç”¨æˆ·é€šçŸ¥ï¼Œå½“ç”¨æˆ·å……å€¼æˆåŠŸæˆ–è½¬è´¦å®Œæˆç³»ç»Ÿé€šçŸ¥ç”¨æˆ·ï¼Œé€šçŸ¥æ–¹å¼æœ‰çŸ­ä¿¡ã€é‚®ä»¶å¤šç§æ–¹æ³• ã€‚</p><h5 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h5><p>å£°æ˜ <code>Exchange_fanout_inform</code> äº¤æ¢æœºã€‚</p><p>å£°æ˜ä¸¤ä¸ªé˜Ÿåˆ—å¹¶ä¸”ç»‘å®šåˆ°æ­¤äº¤æ¢æœºï¼Œç»‘å®šæ—¶ä¸éœ€è¦æŒ‡å®š <code>routingkey</code></p><p>å‘é€æ¶ˆæ¯æ—¶ä¸éœ€è¦æŒ‡å®š <code>routingkey</code></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> rabbitmq;<span class="hljs-keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;<span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer02_publish</span> </span>&#123;    <span class="hljs-comment">//é˜Ÿåˆ—åç§°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="hljs-string">"queue_inform_email"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_SMS = <span class="hljs-string">"queue_inform_sms"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_FANOUT_INFORM = <span class="hljs-string">"exchange_fanout_inform"</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;        Connection connection = <span class="hljs-keyword">null</span>;        Channel channel = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">//æ„å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½®ä¸€äº›åŸºæœ¬çš„é“¾æ¥ä¿¡æ¯</span>            ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();            factory.setHost(<span class="hljs-string">"localhost"</span>);            factory.setPort(<span class="hljs-number">5672</span>);            factory.setUsername(<span class="hljs-string">"guest"</span>);            factory.setPassword(<span class="hljs-string">"guest"</span>);            <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>            factory.setVirtualHost(<span class="hljs-string">"/"</span>);            <span class="hljs-comment">//åˆ›å»ºä¸RabbitMQæœåŠ¡çš„TCPè¿æ¥</span>            connection = factory.newConnection();            <span class="hljs-comment">//åˆ›å»ºä¸Exchangeçš„é€šé“ï¼Œæ¯ä¸ªè¿æ¥å¯ä»¥åˆ›å»ºå¤šä¸ªé€šé“ï¼Œæ¯ä¸ªé€šé“ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡</span>            channel = connection.createChannel();            <span class="hljs-comment">/**</span><span class="hljs-comment">             * å£°æ˜äº¤æ¢æœº</span><span class="hljs-comment">             * 1ã€äº¤æ¢æœºåç§°</span><span class="hljs-comment">             * 2ã€äº¤æ¢æœºç±»å‹ï¼šfanoutã€topicã€directã€headers</span><span class="hljs-comment">             */</span>            channel.exchangeDeclare(EXCHANGE_FANOUT_INFORM, BuiltinExchangeType.FANOUT);            <span class="hljs-comment">/**</span><span class="hljs-comment">             * å£°æ˜é˜Ÿåˆ—ï¼Œå¦‚æœRabbitä¸­æ²¡æœ‰æ­¤é˜Ÿåˆ—ï¼Œå°†è‡ªåŠ¨åˆ›å»º</span><span class="hljs-comment">             * String queue, boolean durable, boolean exclusive, boolean autoDelete,Map&lt;String, Object&gt; arguments</span><span class="hljs-comment">             *</span><span class="hljs-comment">             * param1:é˜Ÿåˆ—åç§°</span><span class="hljs-comment">             * param2:æ˜¯å¦æŒä¹…åŒ–</span><span class="hljs-comment">             * param3:é˜Ÿåˆ—æ˜¯å¦ç‹¬å æ­¤è¿æ¥</span><span class="hljs-comment">             * param4:é˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—</span><span class="hljs-comment">             * param5:é˜Ÿåˆ—å‚æ•°</span><span class="hljs-comment">             */</span>            channel.queueDeclare(QUEUE_INFORM_EMAIL,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);            channel.queueDeclare(QUEUE_INFORM_SMS,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);            <span class="hljs-comment">/**</span><span class="hljs-comment">             * å°†äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®š</span><span class="hljs-comment">             */</span>            channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_FANOUT_INFORM,<span class="hljs-string">""</span>);            channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_FANOUT_INFORM,<span class="hljs-string">""</span>);            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯</span>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;                String message = <span class="hljs-string">"inform to user "</span> + i;                <span class="hljs-comment">/**</span><span class="hljs-comment">                 * æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span><span class="hljs-comment">                 æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span><span class="hljs-comment">                 * param1ï¼šExchangeçš„åç§°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä½¿ç”¨Default Exchange</span><span class="hljs-comment">                 * param2:routingKey,æ¶ˆæ¯çš„è·¯ç”±Keyï¼Œæ˜¯ç”¨äºExchangeï¼ˆäº¤æ¢æœºï¼‰å°†æ¶ˆæ¯è½¬å‘åˆ°æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—</span><span class="hljs-comment">                 * param3:æ¶ˆæ¯åŒ…å«çš„å±æ€§</span><span class="hljs-comment">                 * param4ï¼šæ¶ˆæ¯ä½“</span><span class="hljs-comment">                 * è¿™é‡Œæ²¡æœ‰æŒ‡å®šäº¤æ¢æœºï¼Œæ¶ˆæ¯å°†å‘é€ç»™é»˜è®¤äº¤æ¢æœºï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¹Ÿä¼šç»‘å®šé‚£ä¸ªé»˜è®¤çš„äº¤æ¢æœºï¼Œä½†æ˜¯ä¸èƒ½æ˜¾ç¤ºç»‘å®šæˆ–è§£é™¤ç»‘å®š</span><span class="hljs-comment">                 * é»˜è®¤çš„äº¤æ¢æœºï¼ŒroutingKeyç­‰äºé˜Ÿåˆ—åç§°</span><span class="hljs-comment">                 */</span>                channel.basicPublish(EXCHANGE_FANOUT_INFORM,<span class="hljs-string">""</span>,<span class="hljs-keyword">null</span>,message.getBytes());                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);            &#125;        &#125;<span class="hljs-keyword">catch</span> ( Exception ex)&#123;            ex.printStackTrace();        &#125;<span class="hljs-keyword">finally</span> &#123;            <span class="hljs-comment">//å…³é—­é€šé“å’Œè¿æ¥</span>            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;                channel.close();            &#125;            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;                connection.close();            &#125;        &#125;    &#125;&#125;</code></pre></div><h5 id="é‚®ä»¶æ¶ˆè´¹è€…"><a href="#é‚®ä»¶æ¶ˆè´¹è€…" class="headerlink" title="é‚®ä»¶æ¶ˆè´¹è€…"></a>é‚®ä»¶æ¶ˆè´¹è€…</h5><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> rabbitmq;<span class="hljs-keyword">import</span> com.rabbitmq.client.*;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer02_subscribe_email</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="hljs-string">"queue_inform_email"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_FANOUT_INFORM = <span class="hljs-string">"exchange_fanout_inform"</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;        ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();        factory.setHost(<span class="hljs-string">"localhost"</span>);        factory.setPort(<span class="hljs-number">5672</span>);        factory.setUsername(<span class="hljs-string">"guest"</span>);        factory.setPassword(<span class="hljs-string">"guest"</span>);        <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>        factory.setVirtualHost(<span class="hljs-string">"/"</span>);        Connection connection = factory.newConnection();        Channel channel = connection.createChannel();        <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span>        <span class="hljs-comment">/** å‚æ•°ï¼šString queue, boolean durable, boolean exclusive, boolean autoDelete,</span><span class="hljs-comment">         Map&lt;String, Object&gt; arguments</span><span class="hljs-comment">         * å‚æ•°æ˜ç»†ï¼š</span><span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span><span class="hljs-comment">         * 2ã€durable æ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ï¼Œmqé‡å¯åé˜Ÿåˆ—è¿˜åœ¨</span><span class="hljs-comment">         * 3ã€exclusive æ˜¯å¦ç‹¬å è¿æ¥ï¼Œé˜Ÿåˆ—åªå…è®¸åœ¨è¯¥è¿æ¥ä¸­è®¿é—®ï¼Œå¦‚æœconnectionè¿æ¥å…³é—­ï¼Œé˜Ÿåˆ—åˆ™è‡ªåŠ¨åˆ é™¤,å¯ç”¨äºä¸´æ—¶é˜Ÿåˆ—çš„åˆ›å»º</span><span class="hljs-comment">         * 4ã€autoDelete è‡ªåŠ¨åˆ é™¤ï¼Œé˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—ï¼Œå¦‚æœå°†æ­¤å‚æ•°å’Œexclusiveå…±åŒä¸ºtrueï¼Œå°±å¯ä»¥å®ç°ä¸´æ—¶é˜Ÿåˆ—</span><span class="hljs-comment">         * 5ã€argmuacntsï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—æ‰©å±•å‚æ•°ï¼Œæ¯”å¦‚ï¼šå¯è®¾ç½®å­˜æ´»çš„æ—¶é—´</span><span class="hljs-comment">         */</span>        channel.queueDeclare(QUEUE_INFORM_EMAIL, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);        <span class="hljs-comment">/**</span><span class="hljs-comment">         * å£°æ˜äº¤æ¢æœº</span><span class="hljs-comment">         */</span>        channel.exchangeDeclare(EXCHANGE_FANOUT_INFORM,BuiltinExchangeType.FANOUT);        <span class="hljs-comment">/**</span><span class="hljs-comment">         * ç»‘å®šäº¤æ¢æœº</span><span class="hljs-comment">         */</span>        channel.queueBind(QUEUE_INFORM_EMAIL, EXCHANGE_FANOUT_INFORM,<span class="hljs-string">""</span>);        <span class="hljs-comment">//å®šä¹‰æ¶ˆè´¹æ–¹æ³•</span>        DefaultConsumer defaultConsumer = <span class="hljs-keyword">new</span> DefaultConsumer(channel) &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleDelivery</span><span class="hljs-params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="hljs-keyword">byte</span>[] body)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;                <span class="hljs-comment">//äº¤æ¢æœº</span>                String exchange = envelope.getExchange();                <span class="hljs-comment">//è·¯ç”±key</span>                String routingKey = envelope.getRoutingKey();                <span class="hljs-comment">//æ¶ˆæ¯id</span>                <span class="hljs-keyword">long</span> deliveryTag = envelope.getDeliveryTag();                <span class="hljs-comment">//æ¶ˆæ¯å†…å®¹</span>                String msg = <span class="hljs-keyword">new</span> String(body, <span class="hljs-string">"utf-8"</span>);                System.out.println(<span class="hljs-string">"receive message.."</span> + msg);            &#125;        &#125;;        <span class="hljs-comment">/**</span><span class="hljs-comment">         * ç›‘å¬é˜Ÿåˆ—String queue, boolean autoAck,Consumer callback</span><span class="hljs-comment">         * å‚æ•°æ˜ç»†</span><span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span><span class="hljs-comment">         * 2ã€autoAck æ˜¯å¦è‡ªåŠ¨å›å¤ï¼Œè®¾ç½®ä¸ºtrueä¸ºè¡¨ç¤ºæ¶ˆæ¯æ¥æ”¶åˆ°è‡ªåŠ¨å‘mqå›å¤æ¥æ”¶åˆ°äº†ï¼Œmqæ¥æ”¶åˆ°å›å¤ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œè®¾ç½®ä¸ºfalseåˆ™éœ€è¦æ‰‹åŠ¨å›å¤</span><span class="hljs-comment">         * 3ã€callback æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³•ï¼Œæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åè°ƒç”¨æ­¤æ–¹æ³•</span><span class="hljs-comment">         */</span>        channel.basicConsume(QUEUE_INFORM_EMAIL, <span class="hljs-keyword">true</span>, defaultConsumer);    &#125;&#125;</code></pre></div><h5 id="çŸ­ä¿¡æ¶ˆè´¹è€…"><a href="#çŸ­ä¿¡æ¶ˆè´¹è€…" class="headerlink" title="çŸ­ä¿¡æ¶ˆè´¹è€…"></a>çŸ­ä¿¡æ¶ˆè´¹è€…</h5><p>å‚è€ƒä¸Šè¾¹çš„é‚®ä»¶å‘é€æ¶ˆè´¹è€…ä»£ç ï¼Œä¿®æ”¹é˜Ÿåˆ—åç§°å³å¯</p><h4 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h4><p><a href="https://qnoss.codeyee.com/20200704_5/image12" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image12.gif" srcset="/img/loading.gif" alt="img"></a></p><h4 id="4ã€æ€è€ƒ"><a href="#4ã€æ€è€ƒ" class="headerlink" title="4ã€æ€è€ƒ"></a>4ã€æ€è€ƒ</h4><ol><li><p><strong>publish/subscribeä¸work queuesæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</strong></p><p><strong>åŒºåˆ«ï¼š</strong><br>1ï¼‰<code>work queues</code> ä¸ç”¨å®šä¹‰äº¤æ¢æœºï¼Œè€Œ <code>publish/subscribe</code> éœ€è¦å®šä¹‰äº¤æ¢æœºã€‚</p><p>2ï¼‰<code>publish/subscribe</code> çš„ç”Ÿäº§æ–¹æ˜¯é¢å‘äº¤æ¢æœºå‘é€æ¶ˆæ¯ï¼Œ<code>work queues</code> çš„ç”Ÿäº§æ–¹æ˜¯é¢å‘é˜Ÿåˆ—</p><p>å‘é€æ¶ˆæ¯(åº•å±‚ä½¿ç”¨é»˜è®¤äº¤æ¢æœº)ã€‚</p><p>3ï¼‰<code>publish/subscribe</code> éœ€è¦è®¾ç½®é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®šï¼Œ<code>work queues</code> ä¸éœ€è¦è®¾ç½®ï¼Œå®è´¨ä¸Š<code>work queues</code> ä¼šå°†é˜Ÿåˆ—ç»‘å®šåˆ°é»˜è®¤çš„äº¤æ¢æœº ã€‚</p><p><strong>ç›¸åŒç‚¹ï¼š</strong></p><p>æ‰€ä»¥ä¸¤è€…å®ç°çš„å‘å¸ƒ/è®¢é˜…çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¤šä¸ªæ¶ˆè´¹ç«¯ç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—ä¸ä¼šé‡å¤æ¶ˆè´¹æ¶ˆæ¯ã€‚</p></li><li><p><strong>å®è´¨å·¥ä½œç”¨ä»€ä¹ˆ publish/subscribe è¿˜æ˜¯ work queues</strong></p><p>å»ºè®®ä½¿ç”¨ <code>publish/subscribe</code>ï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼æ¯”å·¥ä½œé˜Ÿåˆ—æ¨¡å¼æ›´å¼ºå¤§ï¼Œå¹¶ä¸”å‘å¸ƒè®¢é˜…æ¨¡å¼å¯ä»¥æŒ‡å®šè‡ªå·±ä¸“ç”¨çš„äº¤æ¢æœºã€‚</p></li></ol><h3 id="Routing-æ¨¡å¼"><a href="#Routing-æ¨¡å¼" class="headerlink" title="Routing æ¨¡å¼"></a>Routing æ¨¡å¼</h3><h4 id="1ã€è·¯ç”±æ¨¡å¼"><a href="#1ã€è·¯ç”±æ¨¡å¼" class="headerlink" title="1ã€è·¯ç”±æ¨¡å¼"></a>1ã€è·¯ç”±æ¨¡å¼</h4><p><a href="https://qnoss.codeyee.com/20200704_5/image13" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image13.png" srcset="/img/loading.gif" alt=" "></a></p><p>1ã€æ¯ä¸ªæ¶ˆè´¹è€…ç›‘å¬è‡ªå·±çš„é˜Ÿåˆ—ï¼Œå¹¶ä¸”è®¾ç½® <code>routingkey</code>ã€‚</p><p>2ã€ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™äº¤æ¢æœºï¼Œç”±äº¤æ¢æœºæ ¹æ® <code>routingkey</code> æ¥è½¬å‘æ¶ˆæ¯åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚</p><h4 id="2ã€ä»£ç -1"><a href="#2ã€ä»£ç -1" class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><h5 id="ç”Ÿäº§è€…-1"><a href="#ç”Ÿäº§è€…-1" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h5><p>è·¯ç”±æ¨¡å¼çš„ç”Ÿäº§è€…ä»£ç åŸºäº <strong>å‘å¸ƒè®¢é˜…æ¨¡å¼</strong> çš„ä»£ç ï¼Œåœ¨è¿™åŸºç¡€ä¸Šå¢åŠ ä»¥ä¸‹å‡ ç‚¹</p><ul><li>å¢åŠ  <code>routing key</code> ä»¥åŠ ä¿®æ”¹äº¤æ¢æœºçš„æ¨¡å¼</li><li>ä¸ºæ¯ä¸ªé˜Ÿåˆ—ç»‘å®š <code>routing key</code></li><li>åœ¨ä¸‹é¢çš„ä»£ç å½“ä¸­ï¼Œæˆ‘ä¸º <code>CMS</code> å’Œ <code>EMAIL</code> çš„é˜Ÿåˆ—åˆ†åˆ«ç»‘å®šäº†ä¸€ä¸ªå•ç‹¬çš„ <code>routing key</code>ï¼Œå†ç»‘å®šäº†ä¸€ä¸ª å…±æœ‰çš„åä¸º <code>ALL</code> çš„keyï¼Œä»¥ä¾¿æµ‹è¯• <code>routing</code> æ¨¡å¼çš„ç‰¹æ€§</li></ul><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> rabbitmq;<span class="hljs-keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;<span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer03_routing</span> </span>&#123;    <span class="hljs-comment">//é˜Ÿåˆ—åç§°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="hljs-string">"queue_inform_email"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_SMS = <span class="hljs-string">"queue_inform_sms"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_ROUTING_INFORM = <span class="hljs-string">"exchange_routing_inform"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTINGKEY_INFORM_EMAIL = <span class="hljs-string">"inform_email"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTINGKEY_INFORM_SMS = <span class="hljs-string">"inform_sms"</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;        Connection connection = <span class="hljs-keyword">null</span>;        Channel channel = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">//æ„å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½®ä¸€äº›åŸºæœ¬çš„é“¾æ¥ä¿¡æ¯</span>            ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();            factory.setHost(<span class="hljs-string">"localhost"</span>);            factory.setPort(<span class="hljs-number">5672</span>);            factory.setUsername(<span class="hljs-string">"guest"</span>);            factory.setPassword(<span class="hljs-string">"guest"</span>);            <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>            factory.setVirtualHost(<span class="hljs-string">"/"</span>);            <span class="hljs-comment">//åˆ›å»ºä¸RabbitMQæœåŠ¡çš„TCPè¿æ¥</span>            connection = factory.newConnection();            <span class="hljs-comment">//åˆ›å»ºä¸Exchangeçš„é€šé“ï¼Œæ¯ä¸ªè¿æ¥å¯ä»¥åˆ›å»ºå¤šä¸ªé€šé“ï¼Œæ¯ä¸ªé€šé“ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡</span>            channel = connection.createChannel();            <span class="hljs-comment">/**</span><span class="hljs-comment">             * å£°æ˜äº¤æ¢æœº</span><span class="hljs-comment">             * 1ã€äº¤æ¢æœºåç§°</span><span class="hljs-comment">             * 2ã€äº¤æ¢æœºç±»å‹ï¼šfanoutã€topicã€directã€headers</span><span class="hljs-comment">             */</span>            channel.exchangeDeclare(EXCHANGE_ROUTING_INFORM, BuiltinExchangeType.DIRECT);            <span class="hljs-comment">/**</span><span class="hljs-comment">             * å£°æ˜é˜Ÿåˆ—ï¼Œå¦‚æœRabbitä¸­æ²¡æœ‰æ­¤é˜Ÿåˆ—ï¼Œå°†è‡ªåŠ¨åˆ›å»º</span><span class="hljs-comment">             * String queue, boolean durable, boolean exclusive, boolean autoDelete,Map&lt;String, Object&gt; arguments</span><span class="hljs-comment">             *</span><span class="hljs-comment">             * param1:é˜Ÿåˆ—åç§°</span><span class="hljs-comment">             * param2:æ˜¯å¦æŒä¹…åŒ–</span><span class="hljs-comment">             * param3:é˜Ÿåˆ—æ˜¯å¦ç‹¬å æ­¤è¿æ¥</span><span class="hljs-comment">             * param4:é˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—</span><span class="hljs-comment">             * param5:é˜Ÿåˆ—å‚æ•°</span><span class="hljs-comment">             */</span>            channel.queueDeclare(QUEUE_INFORM_EMAIL,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);            channel.queueDeclare(QUEUE_INFORM_SMS,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);            <span class="hljs-comment">/**</span><span class="hljs-comment">             * å°†äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®š</span><span class="hljs-comment">             */</span>            channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_ROUTING_INFORM,ROUTINGKEY_INFORM_SMS);            channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_ROUTING_INFORM,ROUTINGKEY_INFORM_EMAIL);            <span class="hljs-comment">//ä¸¤ä¸ªé˜Ÿåˆ—éƒ½ç»‘å®šä¸€ä¸ªALLçš„KEY</span>            channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_ROUTING_INFORM,<span class="hljs-string">"ALL"</span>);            channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_ROUTING_INFORM,<span class="hljs-string">"ALL"</span>);            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯åˆ°EMAIL</span>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;                String message = <span class="hljs-string">"inform to email "</span> + i;                <span class="hljs-comment">/**</span><span class="hljs-comment">                 * æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span><span class="hljs-comment">                 æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span><span class="hljs-comment">                 * param1ï¼šExchangeçš„åç§°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä½¿ç”¨Default Exchange</span><span class="hljs-comment">                 * param2:routingKey,æ¶ˆæ¯çš„è·¯ç”±Keyï¼Œæ˜¯ç”¨äºExchangeï¼ˆäº¤æ¢æœºï¼‰å°†æ¶ˆæ¯è½¬å‘åˆ°æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—</span><span class="hljs-comment">                 * param3:æ¶ˆæ¯åŒ…å«çš„å±æ€§</span><span class="hljs-comment">                 * param4ï¼šæ¶ˆæ¯ä½“</span><span class="hljs-comment">                 * è¿™é‡Œæ²¡æœ‰æŒ‡å®šäº¤æ¢æœºï¼Œæ¶ˆæ¯å°†å‘é€ç»™é»˜è®¤äº¤æ¢æœºï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¹Ÿä¼šç»‘å®šé‚£ä¸ªé»˜è®¤çš„äº¤æ¢æœºï¼Œä½†æ˜¯ä¸èƒ½æ˜¾ç¤ºç»‘å®šæˆ–è§£é™¤ç»‘å®š</span><span class="hljs-comment">                 * é»˜è®¤çš„äº¤æ¢æœºï¼ŒroutingKeyç­‰äºé˜Ÿåˆ—åç§°</span><span class="hljs-comment">                 */</span>                channel.basicPublish(EXCHANGE_ROUTING_INFORM,ROUTINGKEY_INFORM_EMAIL,<span class="hljs-keyword">null</span>,message.getBytes());                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);            &#125;            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯SMS</span>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;                String message = <span class="hljs-string">"inform to sms "</span> + i;                channel.basicPublish(EXCHANGE_ROUTING_INFORM,ROUTINGKEY_INFORM_SMS,<span class="hljs-keyword">null</span>,message.getBytes());                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);            &#125;            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯ALL</span>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;                String message = <span class="hljs-string">"inform to all user "</span> + i;                channel.basicPublish(EXCHANGE_ROUTING_INFORM,<span class="hljs-string">"ALL"</span>,<span class="hljs-keyword">null</span>,message.getBytes());                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);            &#125;        &#125;<span class="hljs-keyword">catch</span> ( Exception ex)&#123;            ex.printStackTrace();        &#125;<span class="hljs-keyword">finally</span> &#123;            <span class="hljs-comment">//å…³é—­é€šé“å’Œè¿æ¥</span>            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;                channel.close();            &#125;            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;                connection.close();            &#125;        &#125;    &#125;&#125;</code></pre></div><p>å•ç‹¬è¿è¡Œç”Ÿäº§è€…åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ rabbitMQ åå°çš„ <code>EXCHANGES</code> æ ä¸­çœ‹åˆ°ï¼Œå»ºç«‹äº†4ä¸ªé˜Ÿåˆ—å¯¹åº” <code>routing key</code> çš„é€šè®¯è¿æ¥</p><p><a href="https://qnoss.codeyee.com/20200704_5/image14" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image14.png" srcset="/img/loading.gif" alt="img"></a></p><h5 id="çŸ­ä¿¡æ¶ˆè´¹è€…-1"><a href="#çŸ­ä¿¡æ¶ˆè´¹è€…-1" class="headerlink" title="çŸ­ä¿¡æ¶ˆè´¹è€…"></a>çŸ­ä¿¡æ¶ˆè´¹è€…</h5><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> rabbitmq;<span class="hljs-keyword">import</span> com.rabbitmq.client.*;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer03_routing_sms</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_SMS = <span class="hljs-string">"queue_inform_sms"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_ROUTING_INFORM = <span class="hljs-string">"exchange_routing_inform"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTINGKEY_INFORM_SMS = <span class="hljs-string">"inform_sms"</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;        ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();        factory.setHost(<span class="hljs-string">"localhost"</span>);        factory.setPort(<span class="hljs-number">5672</span>);        factory.setUsername(<span class="hljs-string">"guest"</span>);        factory.setPassword(<span class="hljs-string">"guest"</span>);        <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>        factory.setVirtualHost(<span class="hljs-string">"/"</span>);        Connection connection = factory.newConnection();        Channel channel = connection.createChannel();        <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span>        <span class="hljs-comment">/** å‚æ•°ï¼šString queue, boolean durable, boolean exclusive, boolean autoDelete,</span><span class="hljs-comment">         Map&lt;String, Object&gt; arguments</span><span class="hljs-comment">         * å‚æ•°æ˜ç»†ï¼š</span><span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span><span class="hljs-comment">         * 2ã€durable æ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ï¼Œmqé‡å¯åé˜Ÿåˆ—è¿˜åœ¨</span><span class="hljs-comment">         * 3ã€exclusive æ˜¯å¦ç‹¬å è¿æ¥ï¼Œé˜Ÿåˆ—åªå…è®¸åœ¨è¯¥è¿æ¥ä¸­è®¿é—®ï¼Œå¦‚æœconnectionè¿æ¥å…³é—­ï¼Œé˜Ÿåˆ—åˆ™è‡ªåŠ¨åˆ é™¤,å¯ç”¨äºä¸´æ—¶é˜Ÿåˆ—çš„åˆ›å»º</span><span class="hljs-comment">         * 4ã€autoDelete è‡ªåŠ¨åˆ é™¤ï¼Œé˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—ï¼Œå¦‚æœå°†æ­¤å‚æ•°å’Œexclusiveå…±åŒä¸ºtrueï¼Œå°±å¯ä»¥å®ç°ä¸´æ—¶é˜Ÿåˆ—</span><span class="hljs-comment">         * 5ã€argmuacntsï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—æ‰©å±•å‚æ•°ï¼Œæ¯”å¦‚ï¼šå¯è®¾ç½®å­˜æ´»çš„æ—¶é—´</span><span class="hljs-comment">         */</span>        channel.queueDeclare(QUEUE_INFORM_SMS, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);        <span class="hljs-comment">/**</span><span class="hljs-comment">         * å£°æ˜äº¤æ¢æœº</span><span class="hljs-comment">         */</span>        channel.exchangeDeclare(EXCHANGE_ROUTING_INFORM,BuiltinExchangeType.DIRECT);        <span class="hljs-comment">/**</span><span class="hljs-comment">         * ç»‘å®šäº¤æ¢æœº</span><span class="hljs-comment">         */</span>        channel.queueBind(QUEUE_INFORM_SMS, EXCHANGE_ROUTING_INFORM,ROUTINGKEY_INFORM_SMS);        channel.queueBind(QUEUE_INFORM_SMS, EXCHANGE_ROUTING_INFORM,<span class="hljs-string">"ALL"</span>); <span class="hljs-comment">//ç»‘å®šä¸€ä¸ªå…¬æœ‰çš„key,ç”¨äºæ¥æ”¶å…¬å…±çš„key</span>        <span class="hljs-comment">//å®šä¹‰æ¶ˆè´¹æ–¹æ³•</span>        DefaultConsumer defaultConsumer = <span class="hljs-keyword">new</span> DefaultConsumer(channel) &#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleDelivery</span><span class="hljs-params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="hljs-keyword">byte</span>[] body)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;                <span class="hljs-comment">//äº¤æ¢æœº</span>                String exchange = envelope.getExchange();                <span class="hljs-comment">//è·¯ç”±key</span>                String routingKey = envelope.getRoutingKey();                <span class="hljs-comment">//æ¶ˆæ¯id</span>                <span class="hljs-keyword">long</span> deliveryTag = envelope.getDeliveryTag();                <span class="hljs-comment">//æ¶ˆæ¯å†…å®¹</span>                String msg = <span class="hljs-keyword">new</span> String(body, <span class="hljs-string">"utf-8"</span>);                System.out.println(<span class="hljs-string">"receive message.."</span> + msg);            &#125;        &#125;;        <span class="hljs-comment">/**</span><span class="hljs-comment">         * ç›‘å¬é˜Ÿåˆ—String queue, boolean autoAck,Consumer callback</span><span class="hljs-comment">         * å‚æ•°æ˜ç»†</span><span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span><span class="hljs-comment">         * 2ã€autoAck æ˜¯å¦è‡ªåŠ¨å›å¤ï¼Œè®¾ç½®ä¸ºtrueä¸ºè¡¨ç¤ºæ¶ˆæ¯æ¥æ”¶åˆ°è‡ªåŠ¨å‘mqå›å¤æ¥æ”¶åˆ°äº†ï¼Œmqæ¥æ”¶åˆ°å›å¤ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œè®¾ç½®ä¸ºfalseåˆ™éœ€è¦æ‰‹åŠ¨å›å¤</span><span class="hljs-comment">         * 3ã€callback æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³•ï¼Œæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åè°ƒç”¨æ­¤æ–¹æ³•</span><span class="hljs-comment">         */</span>        channel.basicConsume(QUEUE_INFORM_SMS, <span class="hljs-keyword">true</span>, defaultConsumer);    &#125;&#125;</code></pre></div><p>è¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºçš„ä»£ç ä¸­ï¼Œé™¤äº†ç»‘å®šçŸ­ä¿¡çš„key æˆ‘è¿˜å•ç‹¬ç»‘å®šäº†ä¸€ä¸ª ALL çš„keyï¼Œç”¨äºæ¥æ”¶å…¨å±€çš„æ¶ˆæ¯ï¼Œä»£ç å—å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs java">channel.queueBind(QUEUE_INFORM_SMS, EXCHANGE_ROUTING_INFORM,<span class="hljs-string">"ALL"</span>); <span class="hljs-comment">//ç»‘å®šä¸€ä¸ªå…¬æœ‰çš„key,ç”¨äºæ¥æ”¶å…¬å…±çš„key</span></code></pre></div><h5 id="é‚®ä»¶æ¶ˆè´¹è€…-1"><a href="#é‚®ä»¶æ¶ˆè´¹è€…-1" class="headerlink" title="é‚®ä»¶æ¶ˆè´¹è€…"></a>é‚®ä»¶æ¶ˆè´¹è€…</h5><p>å…·ä½“ä»£ç å‚è€ƒçŸ­ä¿¡æ¶ˆè´¹è€…çš„ä»£ç </p><h4 id="3ã€æµ‹è¯•-1"><a href="#3ã€æµ‹è¯•-1" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h4><p>é¢„æœŸç»“æœï¼šç”Ÿäº§è€…åˆ†åˆ«å‘é€5æ¡æ¶ˆæ¯åˆ° <strong>SMSæ¶ˆè´¹è€…</strong> å’Œ <strong>EMAIL æ¶ˆè´¹è€…</strong>ï¼Œä»¥åŠå‘é€5æ¡æ¶ˆæ¯ç»™<strong>å…¨éƒ¨æ¶ˆè´¹è€…</strong>ã€‚</p><p><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image15.gif" srcset="/img/loading.gif" alt="img"></p><h4 id="4ã€æ€è€ƒ-1"><a href="#4ã€æ€è€ƒ-1" class="headerlink" title="4ã€æ€è€ƒ"></a>4ã€æ€è€ƒ</h4><p>1ã€Routingæ¨¡å¼ å’Œ Publish/subscibeæœ‰å•¥åŒºåˆ«ï¼Ÿ</p><p>Routingæ¨¡å¼è¦æ±‚é˜Ÿåˆ—åœ¨ç»‘å®šäº¤æ¢æœºæ—¶è¦æŒ‡å®š<code>routingkey</code>ï¼Œæ¶ˆæ¯ä¼šè½¬å‘åˆ°ç¬¦åˆ <code>routingkey</code> çš„é˜Ÿåˆ—ã€‚</p><h3 id="Topics-æ¨¡å¼"><a href="#Topics-æ¨¡å¼" class="headerlink" title="Topics æ¨¡å¼"></a>Topics æ¨¡å¼</h3><h4 id="4-1ã€é€šé…ç¬¦æ¨¡å¼ï¼ˆTopicsï¼‰"><a href="#4-1ã€é€šé…ç¬¦æ¨¡å¼ï¼ˆTopicsï¼‰" class="headerlink" title="4-1ã€é€šé…ç¬¦æ¨¡å¼ï¼ˆTopicsï¼‰"></a>4-1ã€é€šé…ç¬¦æ¨¡å¼ï¼ˆTopicsï¼‰</h4><p><a href="https://qnoss.codeyee.com/20200704_5/image16" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image16.png" srcset="/img/loading.gif" alt="img"></a></p><p>é€šé…ç¬¦è·¯ç”±æ¨¡å¼ï¼š</p><p>1ã€æ¯ä¸ªæ¶ˆè´¹è€…ç›‘å¬è‡ªå·±çš„é˜Ÿåˆ—ï¼Œå¹¶ä¸”è®¾ç½®å¸¦ <strong>é€šé…ç¬¦</strong> çš„ <code>routingkey</code>ã€‚</p><p>2ã€ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™ <code>broker</code>ï¼Œç”±äº¤æ¢æœºæ ¹æ® <code>routingkey</code> æ¥è½¬å‘æ¶ˆæ¯åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚</p><h4 id="4-2ã€ä»£ç "><a href="#4-2ã€ä»£ç " class="headerlink" title="4-2ã€ä»£ç "></a>4-2ã€ä»£ç </h4><p>æ ¹æ®ç”¨æˆ·çš„é€šçŸ¥è®¾ç½®å»é€šçŸ¥ç”¨æˆ·ï¼Œè®¾ç½®æ¥æ”¶ <code>Email</code> çš„ç”¨æˆ·åªæ¥æ”¶ <code>Email</code>ï¼Œè®¾ç½®æ¥æ”¶ <code>sms</code> çš„ç”¨æˆ·åªæ¥æ”¶ <code>sms</code> ï¼Œè®¾ç½®ä¸¤ç§é€šçŸ¥ç±»å‹éƒ½æ¥æ”¶çš„åˆ™ä¸¤ç§é€šçŸ¥éƒ½æœ‰æ•ˆ</p><h5 id="ç”Ÿäº§è€…-2"><a href="#ç”Ÿäº§è€…-2" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h5><p>å£°æ˜äº¤æ¢æœºï¼ŒæŒ‡å®štopicç±»å‹ï¼š</p><p>æ ¸å¿ƒä»£ç </p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">* å£°æ˜äº¤æ¢æœº</span><span class="hljs-comment">* param1ï¼šäº¤æ¢æœºåç§°</span><span class="hljs-comment">* param2:äº¤æ¢æœºç±»å‹ å››ç§äº¤æ¢æœºç±»å‹ï¼šdirectã€fanoutã€topicã€headers</span><span class="hljs-comment">*/</span>channel.exchangeDeclare(EXCHANGE_TOPICS_INFORM, BuiltinExchangeType.TOPIC);<span class="hljs-comment">//Emailé€šçŸ¥</span>channel.basicPublish(EXCHANGE_TOPICS_INFORM, <span class="hljs-string">"inform.email"</span>, <span class="hljs-keyword">null</span>, message.getBytes());<span class="hljs-comment">//smsé€šçŸ¥</span>channel.basicPublish(EXCHANGE_TOPICS_INFORM, <span class="hljs-string">"inform.sms"</span>, <span class="hljs-keyword">null</span>, message.getBytes());<span class="hljs-comment">//ä¸¤ç§éƒ½é€šçŸ¥</span>channel.basicPublish(EXCHANGE_TOPICS_INFORM, <span class="hljs-string">"inform.sms.email"</span>, <span class="hljs-keyword">null</span>, message.getBytes());</code></pre></div><p>å…¨éƒ¨ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> rabbitmq;<span class="hljs-keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;<span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;<span class="hljs-keyword">import</span> java.io.IOException;<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer04_topcis</span> </span>&#123;    <span class="hljs-comment">//é˜Ÿåˆ—åç§°</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="hljs-string">"queue_inform_email"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_SMS = <span class="hljs-string">"queue_inform_sms"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_TOPICS_INFORM = <span class="hljs-string">"exchange_topics_inform"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTINGKEY_INFORM_EMAIL = <span class="hljs-string">"inform.#.email.#"</span>;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTINGKEY_INFORM_SMS = <span class="hljs-string">"inform.#.sms.#"</span>;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;        Connection connection = <span class="hljs-keyword">null</span>;        Channel channel = <span class="hljs-keyword">null</span>;        <span class="hljs-keyword">try</span> &#123;            <span class="hljs-comment">//æ„å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½®ä¸€äº›åŸºæœ¬çš„é“¾æ¥ä¿¡æ¯</span>            ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();            factory.setHost(<span class="hljs-string">"localhost"</span>);            factory.setPort(<span class="hljs-number">5672</span>);            factory.setUsername(<span class="hljs-string">"guest"</span>);            factory.setPassword(<span class="hljs-string">"guest"</span>);            <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>            factory.setVirtualHost(<span class="hljs-string">"/"</span>);            <span class="hljs-comment">//åˆ›å»ºä¸RabbitMQæœåŠ¡çš„TCPè¿æ¥</span>            connection = factory.newConnection();            <span class="hljs-comment">//åˆ›å»ºä¸Exchangeçš„é€šé“ï¼Œæ¯ä¸ªè¿æ¥å¯ä»¥åˆ›å»ºå¤šä¸ªé€šé“ï¼Œæ¯ä¸ªé€šé“ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡</span>            channel = connection.createChannel();            <span class="hljs-comment">/**</span><span class="hljs-comment">             * å£°æ˜äº¤æ¢æœº</span><span class="hljs-comment">             * 1ã€äº¤æ¢æœºåç§°</span><span class="hljs-comment">             * 2ã€äº¤æ¢æœºç±»å‹ï¼šfanoutã€topicã€directã€headers</span><span class="hljs-comment">             */</span>            channel.exchangeDeclare(EXCHANGE_TOPICS_INFORM, BuiltinExchangeType.TOPIC);            <span class="hljs-comment">/**</span><span class="hljs-comment">             * å£°æ˜é˜Ÿåˆ—ï¼Œå¦‚æœRabbitä¸­æ²¡æœ‰æ­¤é˜Ÿåˆ—ï¼Œå°†è‡ªåŠ¨åˆ›å»º</span><span class="hljs-comment">             * String queue, boolean durable, boolean exclusive, boolean autoDelete,Map&lt;String, Object&gt; arguments</span><span class="hljs-comment">             *</span><span class="hljs-comment">             * param1:é˜Ÿåˆ—åç§°</span><span class="hljs-comment">             * param2:æ˜¯å¦æŒä¹…åŒ–</span><span class="hljs-comment">             * param3:é˜Ÿåˆ—æ˜¯å¦ç‹¬å æ­¤è¿æ¥</span><span class="hljs-comment">             * param4:é˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—</span><span class="hljs-comment">             * param5:é˜Ÿåˆ—å‚æ•°</span><span class="hljs-comment">             */</span>            channel.queueDeclare(QUEUE_INFORM_EMAIL,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);            channel.queueDeclare(QUEUE_INFORM_SMS,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);            <span class="hljs-comment">/**</span><span class="hljs-comment">             * å°†äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®š</span><span class="hljs-comment">             */</span>            channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_TOPICS_INFORM,ROUTINGKEY_INFORM_SMS);            channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_TOPICS_INFORM,ROUTINGKEY_INFORM_EMAIL);            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯åˆ°EMAIL</span>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;                String message = <span class="hljs-string">"inform to email "</span> + i;                channel.basicPublish(EXCHANGE_TOPICS_INFORM,<span class="hljs-string">"inform.email"</span>,<span class="hljs-keyword">null</span>,message.getBytes());                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);            &#125;            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯SMS</span>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;                String message = <span class="hljs-string">"inform to sms "</span> + i;                channel.basicPublish(EXCHANGE_TOPICS_INFORM,<span class="hljs-string">"inform.sms"</span>,<span class="hljs-keyword">null</span>,message.getBytes());                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);            &#125;            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯åˆ°cmså’Œemail</span>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;                String message = <span class="hljs-string">"inform to sms and email "</span> + i;                channel.basicPublish(EXCHANGE_TOPICS_INFORM,<span class="hljs-string">"inform.sms.email"</span>,<span class="hljs-keyword">null</span>,message.getBytes());                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);            &#125;        &#125;<span class="hljs-keyword">catch</span> ( Exception ex)&#123;            ex.printStackTrace();        &#125;<span class="hljs-keyword">finally</span> &#123;            <span class="hljs-comment">//å…³é—­é€šé“å’Œè¿æ¥</span>            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;                channel.close();            &#125;            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;                connection.close();            &#125;        &#125;    &#125;&#125;</code></pre></div><h5 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h5><p>é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºæŒ‡å®šé€šé…ç¬¦ <code>routing key</code></p><p>ç»Ÿé…ç¬¦è§„åˆ™ï¼šä¸­é—´ä»¥â€œ.â€åˆ†éš”ã€‚ç¬¦å·#å¯ä»¥åŒ¹é…å¤šä¸ªè¯ï¼Œç¬¦å·*å¯ä»¥åŒ¹é…ä¸€ä¸ªè¯è¯­ã€‚</p><p>æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼Œå…·ä½“ä»£ç å‚è€ƒ <code>routing</code> æ¨¡å¼çš„æ¶ˆè´¹è€…</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span>channel.queueDeclare(QUEUE_INFORM_EMAIL, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);channel.queueDeclare(QUEUE_INFORM_SMS, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);<span class="hljs-comment">//å£°æ˜äº¤æ¢æœº</span>channel.exchangeDeclare(EXCHANGE_TOPICS_INFORM, BuiltinExchangeType.TOPIC);<span class="hljs-comment">//ç»‘å®šemailé€šçŸ¥é˜Ÿåˆ—</span>channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_TOPICS_INFORM,<span class="hljs-string">"inform.#.email.#"</span>);<span class="hljs-comment">//ç»‘å®šsmsé€šçŸ¥é˜Ÿåˆ—</span>channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_TOPICS_INFORM,<span class="hljs-string">"inform.#.sms.#"</span>);</code></pre></div><h4 id="4-3ã€æµ‹è¯•"><a href="#4-3ã€æµ‹è¯•" class="headerlink" title="4-3ã€æµ‹è¯•"></a>4-3ã€æµ‹è¯•</h4><p>åœ¨ç”Ÿäº§è€…ç«¯åˆ†åˆ«å‘ inform.emailã€inform.smsã€inform.sms.email è¿™ä¸‰ä¸ªé€šé…ç¬¦å‘é€äº†æ¶ˆæ¯</p><p><a href="https://qnoss.codeyee.com/20200704_5/image17" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image17.png" srcset="/img/loading.gif" alt="rabbitMQä¸Šçš„äº¤æ¢çŠ¶æ€"></a></p><p>é¢„æœŸç»“æœï¼šemså’Œemailæ¶ˆè´¹è€…åˆ†åˆ«æ¥æ”¶åˆ° <code>sms</code> å’Œ <code>email</code> ä¿¡æ¯å’Œ <code>sms and email</code> ä¿¡æ¯</p><p><strong>æ‰§è¡Œç”Ÿäº§è€…</strong></p><p><a href="https://qnoss.codeyee.com/20200704_5/image18" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image18.png" srcset="/img/loading.gif" alt="img"></a></p><p><strong>æŸ¥çœ‹æ‰§è¡Œæ¶ˆè´¹è€…ç«¯</strong></p><p>smsæ¶ˆè´¹è€…</p><p><a href="https://qnoss.codeyee.com/20200704_5/image19" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image19.png" srcset="/img/loading.gif" alt="img"></a></p><p>emailæ¶ˆè´¹è€…</p><p><a href="https://qnoss.codeyee.com/20200704_5/image20" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image20.png" srcset="/img/loading.gif" alt="img"></a></p><h4 id="4-4ã€æ€è€ƒ"><a href="#4-4ã€æ€è€ƒ" class="headerlink" title="4-4ã€æ€è€ƒ"></a>4-4ã€æ€è€ƒ</h4><p>1ã€æœ¬æ¡ˆä¾‹çš„éœ€æ±‚ä½¿ç”¨ <code>routing</code> æ¨¡å¼æ˜¯å¦èƒ½å®ç°ï¼Ÿ</p><p>ä½¿ç”¨ <code>routing</code> æ¨¡å¼ä¹Ÿå¯ä»¥å®ç°æœ¬æ¡ˆä¾‹ï¼Œå…±è®¾ç½®ä¸‰ä¸ª <code>routing key</code> ï¼Œåˆ†åˆ«æ˜¯ emailã€smsã€all è¿™ä¸‰ä¸ªï¼Œemail é˜Ÿåˆ—ç»‘å®š <code>email</code> å’Œ <code>all</code> ï¼Œsms é˜Ÿåˆ—ç»‘å®š sms å’Œ allï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ä¸Šè¿°çš„æ¡ˆä¾‹ï¼Œä½†æ˜¯å®ç°è¿‡ç¨‹æ¯” <code>topics</code> å¤æ‚ã€‚</p><p>Topics æ¨¡å¼æ›´å¼ºå¤§ï¼Œå®ƒå¯ä»¥å®ç° <code>Routing</code> ã€<code>publish/subscirbe</code> æ¨¡å¼çš„åŠŸèƒ½ã€‚</p><h3 id="Header-æ¨¡å¼"><a href="#Header-æ¨¡å¼" class="headerlink" title="Header æ¨¡å¼"></a>Header æ¨¡å¼</h3><p><code>header</code> æ¨¡å¼ä¸ <code>routing</code> ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œ<code>header</code> æ¨¡å¼å–æ¶ˆ <code>routing key</code>ï¼Œä½¿ç”¨ <code>header</code>ä¸­çš„ <code>key/value</code>ï¼ˆé”®å€¼å¯¹ï¼‰åŒ¹é…<br>é˜Ÿåˆ—ã€‚</p><h4 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a><strong>æ¡ˆä¾‹</strong></h4><p>æ ¹æ®ç”¨çš„é€šçŸ¥è®¾ç½®å»é€šçŸ¥ç”¨æˆ·ï¼Œè®¾ç½®æ¥æ”¶ <code>Email</code> çš„ç”¨æˆ·åªæ¥æ”¶<code>Email</code>ï¼Œè®¾ç½®æ¥æ”¶ <code>sms</code> çš„ç”¨æˆ·åªæ¥æ”¶ <code>sms</code>ï¼Œè®¾ç½®ä¸¤ç§é€šçŸ¥ç±»å‹éƒ½æ¥æ”¶çš„åˆ™ä¸¤ç§é€šçŸ¥éƒ½æœ‰æ•ˆã€‚</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>ç”Ÿäº§è€…</p><p>é˜Ÿåˆ—ä¸äº¤æ¢æœºç»‘å®šçš„ä»£ç ä¸ä¹‹å‰ä¸åŒï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java">Map&lt;String, Object&gt; headers_email = <span class="hljs-keyword">new</span> Hashtable&lt;String, Object&gt;();headers_email.put(<span class="hljs-string">"inform_type"</span>, <span class="hljs-string">"email"</span>);Map&lt;String, Object&gt; headers_sms = <span class="hljs-keyword">new</span> Hashtable&lt;String, Object&gt;();headers_sms.put(<span class="hljs-string">"inform_type"</span>, <span class="hljs-string">"sms"</span>);channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_HEADERS_INFORM,<span class="hljs-string">""</span>,headers_email);channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_HEADERS_INFORM,<span class="hljs-string">""</span>,headers_sms);</code></pre></div><p>å‘å¸ƒæ¶ˆæ¯æ ¸å¿ƒä»£ç :</p><div class="hljs"><pre><code class="hljs java">String message = <span class="hljs-string">"email inform to user"</span>+i;Map&lt;String,Object&gt; headers = <span class="hljs-keyword">new</span> Hashtable&lt;String, Object&gt;();headers.put(<span class="hljs-string">"inform_type"</span>, <span class="hljs-string">"email"</span>);<span class="hljs-comment">//åŒ¹é…emailé€šçŸ¥æ¶ˆè´¹è€…ç»‘å®šçš„header</span><span class="hljs-comment">//headers.put("inform_type", "sms");//åŒ¹é…smsé€šçŸ¥æ¶ˆè´¹è€…ç»‘å®šçš„header</span>AMQP.BasicProperties.Builder properties = <span class="hljs-keyword">new</span> AMQP.BasicProperties.Builder();properties.headers(headers);<span class="hljs-comment">//Emailé€šçŸ¥</span>channel.basicPublish(EXCHANGE_HEADERS_INFORM, <span class="hljs-string">""</span>, properties.build(), message.getBytes());</code></pre></div><h4 id="é‚®æ¶ˆè´¹è€…"><a href="#é‚®æ¶ˆè´¹è€…" class="headerlink" title="é‚®æ¶ˆè´¹è€…"></a>é‚®æ¶ˆè´¹è€…</h4><p>email æ¶ˆè´¹è€…æ ¸å¿ƒä»£ç </p><div class="hljs"><pre><code class="hljs java">channel.exchangeDeclare(EXCHANGE_HEADERS_INFORM, BuiltinExchangeType.HEADERS);Map&lt;String, Object&gt; headers_email = <span class="hljs-keyword">new</span> Hashtable&lt;String, Object&gt;();headers_email.put(<span class="hljs-string">"inform_email"</span>, <span class="hljs-string">"email"</span>);<span class="hljs-comment">//äº¤æ¢æœºå’Œé˜Ÿåˆ—ç»‘å®š</span>channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_HEADERS_INFORM,<span class="hljs-string">""</span>,headers_email);<span class="hljs-comment">//æŒ‡å®šæ¶ˆè´¹é˜Ÿåˆ—</span>channel.basicConsume(QUEUE_INFORM_EMAIL, <span class="hljs-keyword">true</span>, consumer);</code></pre></div><p>æµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_5/image21" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image21.png" srcset="/img/loading.gif" alt="img"></a></p><h3 id="RPCæ¨¡å¼"><a href="#RPCæ¨¡å¼" class="headerlink" title="RPCæ¨¡å¼"></a>RPCæ¨¡å¼</h3><p><a href="https://qnoss.codeyee.com/20200704_5/image22" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image22.png" srcset="/img/loading.gif" alt="img"></a></p><p>RPCå³å®¢æˆ·ç«¯è¿œç¨‹è°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³• ï¼Œä½¿ç”¨ <code>MQ</code> å¯ä»¥å®ç° <code>RPC</code> çš„å¼‚æ­¥è°ƒç”¨ï¼ŒåŸºäº <code>Direct</code> äº¤æ¢æœºå®ç°ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€å®¢æˆ·ç«¯å³æ˜¯ç”Ÿäº§è€…å°±æ˜¯æ¶ˆè´¹è€…ï¼Œå‘ <code>RPC</code> è¯·æ±‚é˜Ÿåˆ—å‘é€ <code>RPC</code> è°ƒç”¨æ¶ˆæ¯ï¼ŒåŒæ—¶ç›‘å¬ <code>RPC</code> å“åº”é˜Ÿåˆ—ã€‚</p><p>2ã€æœåŠ¡ç«¯ç›‘å¬ <code>RPC</code> è¯·æ±‚é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œæ”¶åˆ°æ¶ˆæ¯åæ‰§è¡ŒæœåŠ¡ç«¯çš„æ–¹æ³•ï¼Œå¾—åˆ°æ–¹æ³•è¿”å›çš„ç»“æœ</p><p>3ã€æœåŠ¡ç«¯å°† <code>RPC</code> æ–¹æ³• çš„ç»“æœå‘é€åˆ° <code>RPC</code> å“åº”é˜Ÿåˆ—</p><p>4ã€å®¢æˆ·ç«¯ï¼ˆ<strong>RPCè°ƒç”¨æ–¹</strong>ï¼‰ç›‘å¬<code>RPC</code>å“åº”é˜Ÿåˆ—ï¼Œæ¥æ”¶åˆ° <code>RPC</code> è°ƒç”¨ç»“æœã€‚</p><h2 id="4-Spring-Bootæ•´åˆRibbitMQ"><a href="#4-Spring-Bootæ•´åˆRibbitMQ" class="headerlink" title="4. Spring Bootæ•´åˆRibbitMQ"></a>4. Spring Bootæ•´åˆRibbitMQ</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>æˆ‘ä»¬é€‰æ‹©åŸºäºSpring-Rabbitå»æ“ä½œ<code>RabbitMQ</code></p><p>æºä»£ç åœ°å€ï¼š<a href="https://github.com/spring-projects/spring-amqp" target="_blank" rel="noopener">https://github.com/spring-projects/spring-amqp</a></p><p>åœ¨æˆ‘ä»¬ä¹‹å‰åˆ›å»ºå¾—ç”Ÿäº§è€…æ¨¡å—ä¸­è¿›è¡Œæ„å»ºï¼Œæ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼Œæ³¨é‡Šæ‰ä¹‹å‰åŸç”Ÿçš„ <code>rabbitmq</code> ä¾èµ–</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>    <span class="hljs-comment">&lt;!--åŸç”ŸrabbitMQ--&gt;</span>    <span class="hljs-comment">&lt;!--&lt;dependency&gt;--&gt;</span>    <span class="hljs-comment">&lt;!--&lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;--&gt;</span>    <span class="hljs-comment">&lt;!--&lt;artifactId&gt;amqp-client&lt;/artifactId&gt;--&gt;</span>    <span class="hljs-comment">&lt;!--&lt;version&gt;4.0.3&lt;/version&gt;&amp;lt;!&amp;ndash;æ­¤ç‰ˆæœ¬ä¸spring boot 1.5.9ç‰ˆæœ¬åŒ¹é…&amp;ndash;&amp;gt;--&gt;</span>    <span class="hljs-comment">&lt;!--&lt;/dependency&gt;--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-comment">&lt;!--Springbootæ•´åˆrabbitMQå¯åŠ¨å™¨--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>1ã€é…ç½®application.yml</p><p>é…ç½®è¿æ¥ <code>rabbitmq</code> çš„å‚æ•°</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">44000</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">test-rabbitmq-producer</span>  <span class="hljs-attr">rabbitmq:</span>    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>    <span class="hljs-attr">virtualHost:</span> <span class="hljs-string">/</span></code></pre></div><p>åˆ›å»º Springbootå¯åŠ¨ç¨‹åº</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.rabbitmq;<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-meta">@SpringBootApplication</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestRabbitmqApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(TestRabbitmqApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;    &#125;&#125;</code></pre></div><h3 id="ç”Ÿäº§ç«¯"><a href="#ç”Ÿäº§ç«¯" class="headerlink" title="ç”Ÿäº§ç«¯"></a>ç”Ÿäº§ç«¯</h3><p>æ„å»º <code>RabbitmqConfig</code> ï¼Œç”¨äºé…ç½®äº¤æ¢æœºä»¥åŠç»‘å®šé˜Ÿåˆ—</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.rabbitmq.config;<span class="hljs-keyword">import</span> org.springframework.amqp.core.*;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitmqConfig</span> </span>&#123;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="hljs-string">"queue_inform_email"</span>;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_SMS = <span class="hljs-string">"queue_inform_sms"</span>;    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_TOPICS_INFORM = <span class="hljs-string">"exchange_topics_inform"</span>;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * äº¤æ¢æœºé…ç½®</span><span class="hljs-comment">     * ExchangeBuilderæä¾›äº†fanoutã€directã€topicã€headeräº¤æ¢æœºç±»å‹çš„é…ç½®</span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Bean</span>(EXCHANGE_TOPICS_INFORM)    <span class="hljs-function"><span class="hljs-keyword">public</span> Exchange <span class="hljs-title">EXCHANGE_TOPICS_INFORM</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-comment">//DURABLE(true) æŒä¹…åŒ–ï¼Œæ¶ˆæ¯é˜Ÿåˆ—é‡å¯åäº¤æ¢æœºä»ç„¶å­˜åœ¨</span>        <span class="hljs-keyword">return</span> ExchangeBuilder.topicExchange(EXCHANGE_TOPICS_INFORM).durable(<span class="hljs-keyword">true</span>).build();    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * å£°æ˜é˜Ÿåˆ—</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Bean</span>(QUEUE_INFORM_SMS)    <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">QUEUE_INFORM_SMS</span><span class="hljs-params">()</span></span>&#123;        Queue queue = <span class="hljs-keyword">new</span> Queue(QUEUE_INFORM_SMS);        <span class="hljs-keyword">return</span> queue;    &#125;    <span class="hljs-meta">@Bean</span>(QUEUE_INFORM_EMAIL)    <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">QUEUE_INFORM_EMAIL</span><span class="hljs-params">()</span></span>&#123;        Queue queue = <span class="hljs-keyword">new</span> Queue(QUEUE_INFORM_EMAIL);        <span class="hljs-keyword">return</span> queue;    &#125;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> queue æŒ‡å®šé˜Ÿåˆ—</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> exchange æŒ‡å®šäº¤æ¢æœº</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">BINDING_QUEUE_INFORM_SMS</span><span class="hljs-params">(@Qualifier(QUEUE_INFORM_SMS)</span> Queue queue,</span><span class="hljs-function">                                            @<span class="hljs-title">Qualifier</span><span class="hljs-params">(EXCHANGE_TOPICS_INFORM)</span> Exchange exchange)</span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(<span class="hljs-string">"inform.#.sms.#"</span>).noargs();    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">BINDING_QUEUE_INFORM_EMAIL</span><span class="hljs-params">(@Qualifier(QUEUE_INFORM_EMAIL)</span> Queue queue,</span><span class="hljs-function">                                            @<span class="hljs-title">Qualifier</span><span class="hljs-params">(EXCHANGE_TOPICS_INFORM)</span> Exchange exchange)</span>&#123;        <span class="hljs-keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(<span class="hljs-string">"inform.#.email.#"</span>).noargs();    &#125;&#125;</code></pre></div><p>è¿è¡Œæµ‹è¯•ï¼ŒæˆåŠŸç”Ÿæˆ5æ¡æ¶ˆæ¯åˆ°rabbitmq</p><p><a href="https://qnoss.codeyee.com/20200704_5/image23" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image23.png" srcset="/img/loading.gif" alt="img"></a></p><blockquote><p>è¿è¡Œç”Ÿäº§ç«¯å‰åˆ é™¤åŸæœ‰çš„äº¤æ¢æœº</p></blockquote><h3 id="æ¶ˆè´¹ç«¯"><a href="#æ¶ˆè´¹ç«¯" class="headerlink" title="æ¶ˆè´¹ç«¯"></a>æ¶ˆè´¹ç«¯</h3><p>å‡†å¤‡å·¥ä½œ</p><ol><li>é…ç½® <strong>4.1</strong> ç»™å‡ºçš„ä¾èµ–åŒ…</li><li>å¤åˆ¶ ç”Ÿäº§è€…ç«¯çš„ <code>RabbitmqConfig.java</code></li><li>åˆ›å»ºæ¶ˆè´¹ç«¯ <code>Springboot</code> å¯åŠ¨ç¨‹åº</li></ol><p>ç›®å½•ç»“æ„å¦‚ä¸‹</p><p><a href="https://qnoss.codeyee.com/20200704_5/image24" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image24.png" srcset="/img/loading.gif" alt="æ¶ˆè´¹ç«¯ç›®å½•ç»“æ„"></a></p><p>é…ç½® <code>ReceiveHandler.java</code>ï¼Œç›‘å¬ rabbitMQ çš„æ¶ˆæ¯</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.rabbitmq.mq;<span class="hljs-keyword">import</span> com.xuecheng.test.rabbitmq.config.RabbitmqConfig;<span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.amqp.RabbitProperties;<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;<span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReceiveHandler</span> </span>&#123;    <span class="hljs-comment">//ç›‘å¬emailé˜Ÿåˆ—</span>    <span class="hljs-meta">@RabbitListener</span>(queues = &#123;RabbitmqConfig.QUEUE_INFORM_EMAIL&#125;)    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">receive_email</span><span class="hljs-params">(String msg, Message message, Channel channel)</span></span>&#123;        System.out.println(<span class="hljs-string">"receive: "</span>+msg);    &#125;    <span class="hljs-comment">//ç›‘å¬smsé˜Ÿåˆ—</span>    <span class="hljs-meta">@RabbitListener</span>(queues = &#123;RabbitmqConfig.QUEUE_INFORM_SMS&#125;)    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">receive_sms</span><span class="hljs-params">(String msg, Message message,Channel channel)</span></span>&#123;        System.out.println(<span class="hljs-string">"receive: "</span>+msg);    &#125;&#125;</code></pre></div><p>å¯åŠ¨æ¶ˆè´¹è€…æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°åˆšæ‰æˆ‘ä»¬è¿è¡Œç”Ÿäº§è€…æ‰€ç”Ÿäº§çš„æ¶ˆæ¯ï¼Œå¦‚ä¸‹å›¾</p><p><a href="https://qnoss.codeyee.com/20200704_5/image25" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image25.png" srcset="/img/loading.gif" alt="æ¶ˆè´¹è€…ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯"></a></p><p><a href="https://qnoss.codeyee.com/20200704_5/image25" target="_blank" rel="noopener"></a></p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>RabbitMQ</tag>
      
      <tag>SpringBootæ•´åˆRabbitMQ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day04ï¼šé¡µé¢é™æ€åŒ–</title>
    <link href="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/"/>
    <url>/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day04</code> çš„å†…å®¹</p><ul><li>é¡µé¢é™æ€åŒ–çš„åŸºæœ¬æ¦‚å¿µ</li><li><code>Freemarker</code> æ¡†æ¶åŸºç¡€å…¥é—¨</li><li>ä½¿ç”¨ <code>MongoDB</code> æä¾›çš„ <code>GridFS</code> æ¥å®ç°é¡µé¢æ•°æ®çš„åˆ†å¸ƒå¼å‚¨å­˜</li><li>ä½¿ç”¨ <code>freemarker</code> æ¡†æ¶å®ç°é¡µé¢é™æ€åŒ–ä»¥åŠå‘å¸ƒ</li></ul><h1 id="ä¸€ã€é¡µé¢é™æ€åŒ–éœ€æ±‚"><a href="#ä¸€ã€é¡µé¢é™æ€åŒ–éœ€æ±‚" class="headerlink" title="ä¸€ã€é¡µé¢é™æ€åŒ–éœ€æ±‚"></a>ä¸€ã€é¡µé¢é™æ€åŒ–éœ€æ±‚</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><ol><li><p><strong>ä¸ºä»€ä¹ˆè¦è¿›è¡Œé¡µé¢ç®¡ç†ï¼Ÿ</strong></p><p>æœ¬é¡¹ç›®çš„ <code>cms</code> ç³»ç»Ÿçš„åŠŸèƒ½å°±æ˜¯æ ¹æ®è¿è¥çš„éœ€è¦ï¼Œå¯¹é—¨æˆ·ç­‰å­ç³»ç»Ÿçš„éƒ¨åˆ†é¡µé¢è¿›è¡Œç®¡ç†ï¼Œä»è€Œå®ç°å¿«é€Ÿçš„æ ¹æ®ç”¨æˆ·éœ€æ±‚ä¿®æ”¹é¡µé¢çš„å†…å®¹å¹¶ä¸Šçº¿éœ€æ±‚ã€‚</p></li><li><p><strong>å¦‚ä½•ä¿®æ”¹é¡µé¢çš„å†…å®¹ï¼Ÿ</strong></p><p>åœ¨å¼€å‘ä¸­ä¿®æ”¹é¡µé¢çš„å†…å®¹æ˜¯éœ€è¦äººå·¥ç¼–å†™ <code>html</code> ä»¥åŠ <code>js</code> æ–‡ä»¶ï¼Œ <code>cms</code> ç³»ç»Ÿæ˜¯é€šè¿‡ç¨‹åºè‡ªåŠ¨åŒ–çš„å¯¹é¡µé¢çš„å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œé€šè¿‡é¡µé¢é™æ€åŒ–æŠ€æœ¯ç”Ÿæˆ <code>html</code> é¡µé¢ã€‚</p></li><li><p><strong>å¦‚ä½•å¯¹é¡µé¢è¿›è¡Œé™æ€åŒ–ï¼Ÿ</strong></p><p>ä¸€ä¸ªé¡µé¢ç­‰äº <code>æ¨¡æ¿</code> + <code>æ•°æ®</code>ï¼Œåœ¨æ·»åŠ é¡µé¢çš„æ—¶å€™æˆ‘ä»¬é€‰æ‹©äº†é¡µé¢çš„æ¨¡æ¿ã€‚</p></li><li><p><strong>é¡µé¢é™æ€åŒ–ä»¥åŠé¡µé¢å‘å¸ƒçš„æµç¨‹</strong></p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image1" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image1.png" srcset="/img/loading.gif" alt="å‘å¸ƒæµç¨‹å›¾"></a></p><p>â€‹</p><p>â€‹</p></li></ol><h2 id="ä¸šåŠ¡æµç¨‹"><a href="#ä¸šåŠ¡æµç¨‹" class="headerlink" title="ä¸šåŠ¡æµç¨‹"></a>ä¸šåŠ¡æµç¨‹</h2><p>ä¸šåŠ¡æµç¨‹å¦‚ä¸‹</p><ol><li>è·å–æ¨¡å‹æ•°æ®</li><li>åˆ¶ä½œæ¨¡æ¿</li><li>å¯¹é¡µé¢è¿›è¡Œé™æ€åŒ–</li><li>å°†é™æ€åŒ–ç”Ÿæˆçš„ <code>html</code> é¡µé¢å­˜æ”¾åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­</li><li>å°†å­˜æ”¾åœ¨æ–‡ä»¶ç³»ç»Ÿçš„ <code>html</code> é¡µé¢å‘å¸ƒåˆ°æœåŠ¡å™¨</li></ol><h1 id="äºŒã€FreeMarkerç ”ç©¶"><a href="#äºŒã€FreeMarkerç ”ç©¶" class="headerlink" title="äºŒã€FreeMarkerç ”ç©¶"></a>äºŒã€FreeMarkerç ”ç©¶</h1><h2 id="1-FreeMarkerä»‹ç»"><a href="#1-FreeMarkerä»‹ç»" class="headerlink" title="1. FreeMarkerä»‹ç»"></a>1. FreeMarkerä»‹ç»</h2><ol><li><p><code>freemarker</code> æ˜¯ä¸€ä¸ªç”¨ <code>Java</code> å¼€å‘çš„æ¨¡æ¿å¼•æ“</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image2" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image2.png" srcset="/img/loading.gif" alt="img"></a></p><p>å¸¸ç”¨çš„ <code>java</code> æ¨¡æ¿å¼•æ“è¿˜æœ‰å“ªäº›?</p><p>Jspã€Freemarkerã€Thymeleafã€Velocity ç­‰</p></li><li><p>æ¨¡æ¿+æ•°æ®æ¨¡å‹ = è¾“å‡º</p><p><code>freemarker</code> å¹¶ä¸å…³å¿ƒæ•°æ®çš„æ¥æºï¼Œåªæ˜¯æ ¹æ®æ¨¡æ¿çš„å†…å®¹ï¼Œå°†æ•°æ®æ¨¡å‹åœ¨æ¨¡æ¿ä¸­æ˜¾ç¤ºå¹¶è¾“å‡ºå…·ä½“çš„ï¼ˆé€šå¸¸ä¸º <code>html</code> ï¼Œä¹Ÿå¯ä»¥ç”Ÿæˆå…¶ä»–æ ¼å¼çš„æ–‡ä»¶ï¼‰</p><ol><li><p><strong>æ•°æ®æ¨¡å‹</strong></p><p>æ•°æ®æ¨¡å‹åœ¨ <code>java</code> ä¸­å¯ä»¥æ˜¯åŸºæœ¬ç±»å‹ä¹Ÿå¯ä»¥æ˜¯ Listã€Mapã€Pojo ç­‰å¤æ‚ç±»å‹</p></li><li><p><strong>æ¥è‡ªå®˜æ–¹çš„ä¾‹å­</strong>ï¼šï¼ˆ<a href="https://freemarker.apache.org/docs/dgui_quickstart_basics.html%EF%BC%89" target="_blank" rel="noopener">https://freemarker.apache.org/docs/dgui_quickstart_basics.htmlï¼‰</a></p><p>æ•°æ®æ¨¡å‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image3" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image3.png" srcset="/img/loading.gif" alt="img"></a></p><p>æ¨¡æ¿ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image4" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image4.png" srcset="/img/loading.gif" alt="img"></a></p><p>è¾“å‡ºï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image5" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image5.png" srcset="/img/loading.gif" alt="img"></a></p></li></ol></li></ol><h2 id="2-FreeMark-å¿«é€Ÿå…¥é—¨"><a href="#2-FreeMark-å¿«é€Ÿå…¥é—¨" class="headerlink" title="2. FreeMark å¿«é€Ÿå…¥é—¨"></a>2. FreeMark å¿«é€Ÿå…¥é—¨</h2><p>freemarker ä½œä¸º <code>Springmvc</code> ä¸€ç§è§†å›¾çš„æ ¼å¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>SpringMvc</code> æ”¯æŒ <code>freemarker</code> è§†å›¾æ ¼å¼ã€‚</p><p>éœ€è¦åˆ›å»º <code>Spring boot</code> + <code>Freemarker</code>å·¥ç¨‹ç”¨äºæµ‹è¯•çš„æ¨¡æ¿ã€‚</p><h3 id="1ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹"><a href="#1ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹" class="headerlink" title="1ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹"></a>1ã€åˆ›å»ºæµ‹è¯•å·¥ç¨‹</h3><p>æˆ‘ä»¬åœ¨åŸæœ‰çš„å·¥ç¨‹ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª<code>test-freemarker</code> çš„ <code>maven</code> æ¨¡å—ï¼Œæµ‹è¯•å·¥ç¨‹ä¸“é—¨ç”¨äºfreemarkerçš„åŠŸèƒ½æµ‹è¯•ä¸æ¨¡æ¿çš„æµ‹è¯•ã€‚</p><p>pomå¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0</span></span><span class="hljs-tag"><span class="hljs-string">http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../xc-framework-parent/pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>test-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><h3 id="2ã€é…ç½®æ–‡ä»¶"><a href="#2ã€é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€é…ç½®æ–‡ä»¶"></a>2ã€é…ç½®æ–‡ä»¶</h3><p>é…ç½® <code>application.yml</code> å’Œ <code>logback-spring.xml</code>ï¼Œä» <code>cms</code> å·¥ç¨‹æ‹·è´è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œè¿›è¡Œæ›´æ”¹ï¼Œ <code>logback-spring.xml</code> æ— éœ€æ›´æ”¹ï¼Œ<code>application.yml</code> å†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs yml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">8088</span> <span class="hljs-comment">#æœåŠ¡ç«¯å£</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">testâ€freemarker</span> <span class="hljs-comment">#æŒ‡å®šæœåŠ¡å</span>  <span class="hljs-attr">freemarker:</span>    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#å…³é—­æ¨¡æ¿ç¼“å­˜ï¼Œæ–¹ä¾¿æµ‹è¯•</span>    <span class="hljs-attr">settings:</span>      <span class="hljs-attr">template_update_delay:</span> <span class="hljs-number">0</span> <span class="hljs-comment">#æ£€æŸ¥æ¨¡æ¿æ›´æ–°å»¶è¿Ÿæ—¶é—´ï¼Œè®¾ç½®ä¸º0è¡¨ç¤ºç«‹å³æ£€æŸ¥ï¼Œå¦‚æœæ—¶é—´å¤§äº0ä¼šæœ‰ç¼“å­˜ä¸æ–¹ä¾¿</span></code></pre></div><h3 id="3ã€åˆ›å»ºæ¨¡å‹ç±»"><a href="#3ã€åˆ›å»ºæ¨¡å‹ç±»" class="headerlink" title="3ã€åˆ›å»ºæ¨¡å‹ç±»"></a>3ã€åˆ›å»ºæ¨¡å‹ç±»</h3><p>åœ¨ <code>freemarker</code> çš„æµ‹è¯•å·¥ç¨‹ä¸‹åˆ›å»ºæ¨¡å‹ç±»å‹ç”¨äºæµ‹è¯•ï¼›</p><p>åˆ›å»º <code>com.xuecheng.test.freemarker.model</code> åŒ…ï¼Œå¹¶æ„å»ºä¸€ä¸ª <code>Student</code> æ¨¡å‹ç±»ç”¨äºåé¢çš„æµ‹è¯•</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.freemarker.model;<span class="hljs-keyword">import</span> lombok.Data;<span class="hljs-keyword">import</span> lombok.ToString;<span class="hljs-keyword">import</span> java.util.Date;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> </span>&#123;    <span class="hljs-keyword">private</span> String name;<span class="hljs-comment">//å§“å</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> age;<span class="hljs-comment">//å¹´é¾„</span>    <span class="hljs-keyword">private</span> Date birthday;<span class="hljs-comment">//ç”Ÿæ—¥</span>    <span class="hljs-keyword">private</span> Float money;<span class="hljs-comment">//é’±åŒ…</span>    <span class="hljs-keyword">private</span> List&lt;Student&gt; friends;<span class="hljs-comment">//æœ‹å‹åˆ—è¡¨</span>    <span class="hljs-keyword">private</span> Student bestFriend;<span class="hljs-comment">//æœ€å¥½çš„æœ‹å‹</span>&#125;</code></pre></div><h3 id="4ã€åˆ›å»ºæ¨¡æ¿"><a href="#4ã€åˆ›å»ºæ¨¡æ¿" class="headerlink" title="4ã€åˆ›å»ºæ¨¡æ¿"></a>4ã€åˆ›å»ºæ¨¡æ¿</h3><p>åœ¨ <code>src/main/resources</code> ä¸‹åˆ›å»º <code>templates</code>ï¼Œæ­¤ç›®å½•ä¸º <code>freemarker</code> çš„é»˜è®¤æ¨¡æ¿å­˜æ”¾ç›®å½•ï¼›</p><p>åœ¨ <code>templates</code> ä¸‹åˆ›å»ºæ¨¡æ¿æ–‡ä»¶ <code>test1.ftl</code>ï¼Œæ¨¡æ¿ä¸­çš„ <code>${name}</code> æœ€ç»ˆä¼šè¢«<code>freemarker</code> æ›¿æ¢æˆå…·ä½“çš„æ•°æ®ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utfâ€8"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>Hello $&#123;name&#125;!<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h3 id="5ã€-åˆ›å»º-controller"><a href="#5ã€-åˆ›å»º-controller" class="headerlink" title="5ã€ åˆ›å»º controller"></a>5ã€ åˆ›å»º controller</h3><p>åˆ›å»º <code>Controller</code> ç±»ï¼Œå‘ <code>Map</code> ä¸­æ·»åŠ  <code>name</code>ï¼Œæœ€åè¿”å›æ¨¡æ¿æ–‡ä»¶ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/freemarker"</span>)<span class="hljs-meta">@Controller</span>  <span class="hljs-comment">//è¿™é‡Œä¸»è¦ä¸è¦ä½¿ç”¨RestController,RestControlleré»˜è®¤è¿”å›jsonæ•°æ®,ä½¿æ¨¡æ¿å¼•æ“å¤±æ•ˆ</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreemarkerController</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æµ‹è¯•1</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map freemarkerå¼•æ“ä¼šè‡ªåŠ¨ä»Mapå½¢å‚ä¸­è¯»å–å˜é‡è¿›è¡Œæ¸²æŸ“</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/test1"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">freemarker</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span></span>&#123;        map.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"é»‘é©¬ç¨‹åºå‘˜"</span>);        <span class="hljs-comment">//è¿”å›æ¨¡æ¿æ–‡ä»¶åç§°</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"test1"</span>;    &#125;&#125;</code></pre></div><h3 id="6ã€åˆ›å»ºå¯åŠ¨ç±»"><a href="#6ã€åˆ›å»ºå¯åŠ¨ç±»" class="headerlink" title="6ã€åˆ›å»ºå¯åŠ¨ç±»"></a>6ã€åˆ›å»ºå¯åŠ¨ç±»</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.freemarker;<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-meta">@SpringBootApplication</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreemarkerTestApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(FreemarkerTestApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;    &#125;&#125;</code></pre></div><h3 id="7ã€æµ‹è¯•"><a href="#7ã€æµ‹è¯•" class="headerlink" title="7ã€æµ‹è¯•"></a>7ã€æµ‹è¯•</h3><p>è®¿é—® <a href="http://localhost:8088/freemarker/test1" target="_blank" rel="noopener">http://localhost:8088/freemarker/test1</a> æµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image6" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image6.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-Freemarker-åŸºç¡€è¯­æ³•"><a href="#3-Freemarker-åŸºç¡€è¯­æ³•" class="headerlink" title="3.Freemarker åŸºç¡€è¯­æ³•"></a>3.Freemarker åŸºç¡€è¯­æ³•</h2><h3 id="1ã€æ ¸å¿ƒæŒ‡ä»¤"><a href="#1ã€æ ¸å¿ƒæŒ‡ä»¤" class="headerlink" title="1ã€æ ¸å¿ƒæŒ‡ä»¤"></a>1ã€æ ¸å¿ƒæŒ‡ä»¤</h3><h4 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h4><p><code>Freemarker</code> é™æ€åŒ–ä¾èµ–æ•°æ®æ¨¡å‹å’Œæ¨¡æ¿ï¼Œä¸‹è¾¹å®šä¹‰æ•°æ®æ¨¡å‹ï¼›</p><p>ä¸‹è¾¹æ–¹æ³•å½¢å‚ <code>map</code> å³ä¸º <code>freemarker</code> é™æ€åŒ–æ‰€éœ€è¦çš„æ•°æ®æ¨¡å‹ï¼Œåœ¨ <code>map</code> ä¸­å¡«å……æ•°æ®ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.freemarker.controller;<span class="hljs-keyword">import</span> com.xuecheng.test.freemarker.model.Student;<span class="hljs-keyword">import</span> org.springframework.stereotype.Controller;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="hljs-keyword">import</span> java.util.ArrayList;<span class="hljs-keyword">import</span> java.util.Date;<span class="hljs-keyword">import</span> java.util.HashMap;<span class="hljs-keyword">import</span> java.util.Map;<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/freemarker"</span>)<span class="hljs-meta">@Controller</span>  <span class="hljs-comment">//è¿™é‡Œä¸»è¦ä¸è¦ä½¿ç”¨RestController,RestControlleré»˜è®¤è¿”å›jsonæ•°æ®,ä½¿æ¨¡æ¿å¼•æ“å¤±æ•ˆ</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreemarkerController</span> </span>&#123;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * æµ‹è¯•1</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> map freemarkerå¼•æ“ä¼šè‡ªåŠ¨ä»Mapå½¢å‚ä¸­è¯»å–å˜é‡è¿›è¡Œæ¸²æŸ“</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/test1"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">freemarker</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span></span>&#123;        map.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"é»‘é©¬ç¨‹åºå‘˜"</span>);        <span class="hljs-comment">//å­¦ç”Ÿå¯¹è±¡1</span>        Student stu1 = <span class="hljs-keyword">new</span> Student();        stu1.setName(<span class="hljs-string">"å°æ˜"</span>);        stu1.setAge(<span class="hljs-number">18</span>);        stu1.setMoney(<span class="hljs-number">1888.123f</span>);        stu1.setBirthday(<span class="hljs-keyword">new</span> Date());        <span class="hljs-comment">//å­¦ç”Ÿå¯¹è±¡2</span>        Student stu2 = <span class="hljs-keyword">new</span> Student();        stu2.setName(<span class="hljs-string">"å°çº¢"</span>);        stu2.setAge(<span class="hljs-number">22</span>);        stu2.setMoney(<span class="hljs-number">1888.123f</span>);        stu2.setBirthday(<span class="hljs-keyword">new</span> Date());        <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªListå¯¹è±¡ï¼Œç”¨äºå‚¨å­˜ä¸Šé¢è¿™ä¸¤ä¸ªå­¦ç”Ÿå¯¹è±¡</span>        ArrayList&lt;Object&gt; stus = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();        stus.add(stu1);        stus.add(stu2);        <span class="hljs-comment">//å‘æ•°æ®æ¨¡å‹ä¸­æ”¾å…¥List</span>        map.put(<span class="hljs-string">"stus"</span>,stus);        <span class="hljs-comment">//è¿”å›æ¨¡æ¿æ–‡ä»¶åç§°</span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"test1"</span>;    &#125;&#125;</code></pre></div><h4 id="ListæŒ‡ä»¤"><a href="#ListæŒ‡ä»¤" class="headerlink" title="ListæŒ‡ä»¤"></a>ListæŒ‡ä»¤</h4><p>æœ¬èŠ‚å®šä¹‰freemarkeræ¨¡æ¿ï¼Œæ¨¡æ¿ä¸­ä½¿ç”¨freemarkerçš„æŒ‡ä»¤ï¼Œå…³äºfreemarkerçš„æŒ‡ä»¤éœ€è¦çŸ¥é“ï¼š</p><div class="hljs"><pre><code class="hljs html">1ã€æ³¨é‡Šï¼Œå³<span class="hljs-tag">&lt;<span class="hljs-name">#â€â€å’Œâ€â€</span>&gt;</span>ï¼Œä»‹äºå…¶ä¹‹é—´çš„å†…å®¹ä¼šè¢«freemarkerå¿½ç•¥2ã€æ’å€¼ï¼ˆInterpolationï¼‰ï¼šå³$&#123;..&#125;éƒ¨åˆ†,freemarkerä¼šç”¨çœŸå®çš„å€¼ä»£æ›¿$&#123;..&#125;3ã€FTLæŒ‡ä»¤ï¼šå’ŒHTMLæ ‡è®°ç±»ä¼¼ï¼Œåå­—å‰åŠ #äºˆä»¥åŒºåˆ†ï¼ŒFreemarkerä¼šè§£ææ ‡ç­¾ä¸­çš„è¡¨è¾¾å¼æˆ–é€»è¾‘ã€‚4ã€æ–‡æœ¬ï¼Œä»…æ–‡æœ¬ä¿¡æ¯ï¼Œè¿™äº›ä¸æ˜¯freemarkerçš„æ³¨é‡Šã€æ’å€¼ã€FTLæŒ‡ä»¤çš„å†…å®¹ä¼šè¢«freemarkerå¿½ç•¥è§£æï¼Œç›´æ¥è¾“å‡ºå†…å®¹</code></pre></div><p>åœ¨ <code>test1.ftl</code> æ¨¡æ¿ä¸­ä½¿ç”¨listæŒ‡ä»¤éå†æ•°æ®æ¨¡å‹ä¸­çš„æ•°æ®ï¼š</p><div class="hljs"><pre><code class="hljs jsp">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;    &lt;meta charset=<span class="hljs-string">"utfâ€8"</span>&gt;    &lt;title&gt;Hello World!&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Hello $&#123;name&#125;!&lt;p&gt;åœ¨test1.ftlæ¨¡æ¿ä¸­ä½¿ç”¨listæŒ‡ä»¤éå†æ•°æ®æ¨¡å‹ä¸­çš„æ•°æ®ï¼š&lt;/p&gt;&lt;table&gt;    &lt;thead&gt;        &lt;td&gt;åºå·&lt;/td&gt;        &lt;td&gt;å§“å&lt;/td&gt;        &lt;td&gt;å¹´é¾„&lt;/td&gt;        &lt;td&gt;é’±åŒ…&lt;/td&gt;    &lt;/thead&gt;    &lt;#list stus as stu&gt;        &lt;tr&gt;            &lt;#--ä½¿ç”¨ _index æ¥éå†çš„åºå·--&gt;            &lt;td&gt;$&#123;stu_index + 1&#125;&lt;/td&gt;            &lt;td&gt;$&#123;stu.name&#125;&lt;/td&gt;            &lt;td&gt;$&#123;stu.age&#125;&lt;/td&gt;            &lt;td&gt;$&#123;stu.money&#125;&lt;/td&gt;        &lt;/tr&gt;    &lt;/#list&gt;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;</code></pre></div><p>æ•ˆæœ</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image7" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image7.png" srcset="/img/loading.gif" alt="LISTè¾“å‡ºæ•ˆæœ"></a></p><h4 id="éå†Mapæ•°æ®"><a href="#éå†Mapæ•°æ®" class="headerlink" title="éå†Mapæ•°æ®"></a>éå†Mapæ•°æ®</h4><p>1ã€æ•°æ®æ¨¡å‹</p><p>åœ¨<code>controller</code> å†…ä½¿ç”¨<code>map</code>æŒ‡ä»¤éå†æ•°æ®æ¨¡å‹ä¸­çš„ <code>stuMap</code>ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//å‡†å¤‡mapæ•°æ®</span>HashMap&lt;Object, Object&gt; stuMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();stuMap.put(<span class="hljs-string">"stu1"</span>,stu1);stuMap.put(<span class="hljs-string">"stu2"</span>,stu2);<span class="hljs-comment">//åƒæ•°æ®æ¨¡å‹å†…æ”¾æ•°æ®</span>map.put(<span class="hljs-string">"stu1"</span>,stu1);<span class="hljs-comment">//å‘æ•°æ®æ¨¡å‹æ”¾å…¥stuMap</span>map.put(<span class="hljs-string">"stuMap"</span>, stuMap);</code></pre></div><p>2ã€æ¨¡æ¿</p><div class="hljs"><pre><code class="hljs html">é€šè¿‡Mapè¾“å‡ºstu1çš„å­¦ç”Ÿä¿¡æ¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>å§“åï¼š$&#123;stuMap['stu1'].name&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>å¹´é¾„ï¼š$&#123;stuMap['stu1'].age&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>é€šè¿‡Mapè¾“å‡ºstu1çš„å­¦ç”Ÿä¿¡æ¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>å§“åï¼š$&#123;stuMap.stu1.name&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>å¹´é¾„ï¼š$&#123;stuMap.stu1.age&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ä½¿ç”¨mapæŒ‡ä»¤éå†æ•°æ®æ¨¡å‹ä¸­çš„stuMapã€‚<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åºå·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>é’±åŒ…<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stuMap</span>?<span class="hljs-attr">keys</span> <span class="hljs-attr">as</span> <span class="hljs-attr">k</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;k_index + 1&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stuMap[k].name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stuMap[k].age&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stuMap[k].money&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></code></pre></div><p>3ã€è¾“å‡º</p><p><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image8.png" srcset="/img/loading.gif" alt></p><h4 id="ifæŒ‡ä»¤"><a href="#ifæŒ‡ä»¤" class="headerlink" title="ifæŒ‡ä»¤"></a>ifæŒ‡ä»¤</h4><p>if æŒ‡ä»¤å³åˆ¤æ–­æŒ‡ä»¤ï¼Œæ˜¯å¸¸ç”¨çš„FTLæŒ‡ä»¤ï¼Œfreemarkeråœ¨è§£ææ—¶é‡åˆ°ifä¼šè¿›è¡Œåˆ¤æ–­ï¼Œæ¡ä»¶ä¸ºçœŸåˆ™è¾“å‡ºifä¸­é—´çš„å†…å®¹ï¼Œå¦åˆ™è·³è¿‡å†…å®¹ä¸å†è¾“å‡ºã€‚</p><ol><li><p><strong>æ•°æ®æ¨¡å‹ï¼š</strong></p><p>ä½¿ç”¨listæŒ‡ä»¤ä¸­æµ‹è¯•æ•°æ®æ¨¡å‹ã€‚</p></li><li><p><strong>æ¨¡æ¿</strong></p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åºå·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>é’±åŒ…<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stus</span> <span class="hljs-attr">as</span> <span class="hljs-attr">stu</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">#--ä½¿ç”¨</span> <span class="hljs-attr">_index</span> æ¥éå†çš„åºå·<span class="hljs-attr">--</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu_index + 1&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            &lt;td &lt;#if stu.name == 'å°æ˜'&gt;style="background: red" &lt;/#if&gt;&gt;$&#123;stu.name&#125;&lt;/td&gt;            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.age&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.money&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span></code></pre></div><p>é€šè¿‡é˜…è¯»ä¸Šè¾¹çš„ä»£ç ï¼Œå®ç°çš„åŠŸèƒ½æ˜¯ï¼šå¦‚æœå§“åä¸º â€œ<code>å°æ˜</code>â€ åˆ™èƒŒæ™¯è‰²æ˜¾ç¤ºä¸ºçº¢è‰²ã€‚</p></li><li><p><strong>è¾“å‡º</strong></p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image9" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image9.png" srcset="/img/loading.gif" alt="img"></a></p><p>é€šè¿‡æµ‹è¯•å‘ç° å§“åä¸ºå°æ˜çš„èƒŒæ™¯è‰²ä¸ºçº¢è‰²ã€‚</p></li></ol><h4 id="ä¸‰å…ƒè¿ç®—"><a href="#ä¸‰å…ƒè¿ç®—" class="headerlink" title="ä¸‰å…ƒè¿ç®—"></a>ä¸‰å…ƒè¿ç®—</h4><div class="hljs"><pre><code class="hljs js">$&#123; (type == <span class="hljs-string">'SPOT'</span>) ?string(<span class="hljs-string">'çƒ­ç‚¹è¯'</span>,<span class="hljs-string">'çƒ­ç‚¹æœç´¢'</span>)&#125;</code></pre></div><h3 id="2ã€å…¶ä»–æŒ‡ä»¤"><a href="#2ã€å…¶ä»–æŒ‡ä»¤" class="headerlink" title="2ã€å…¶ä»–æŒ‡ä»¤"></a>2ã€å…¶ä»–æŒ‡ä»¤</h3><h4 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h4><ol><li>ç®—æ•°è¿ç®—ç¬¦ FreeMarkerè¡¨è¾¾å¼ä¸­å®Œå…¨æ”¯æŒç®—æœ¯è¿ç®—,FreeMarkeræ”¯æŒçš„ç®—æœ¯è¿ç®—ç¬¦åŒ…æ‹¬:+, - , * , / , %</li><li>é€»è¾‘è¿ç®—ç¬¦ é€»è¾‘è¿ç®—ç¬¦æœ‰å¦‚ä¸‹å‡ ä¸ª: é€»è¾‘ä¸:&amp;&amp; é€»è¾‘æˆ–:|| é€»è¾‘é:! é€»è¾‘è¿ç®—ç¬¦åªèƒ½ä½œç”¨äºå¸ƒå°”å€¼,å¦åˆ™å°†äº§ç”Ÿé”™è¯¯</li><li>æ¯”è¾ƒè¿ç®—ç¬¦ è¡¨è¾¾å¼ä¸­æ”¯æŒçš„æ¯”è¾ƒè¿ç®—ç¬¦æœ‰å¦‚ä¸‹å‡ ä¸ª: 1 =æˆ–è€…==:åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ç›¸ç­‰. 2 !=:åˆ¤æ–­ä¸¤ä¸ªå€¼æ˜¯å¦ä¸ç­‰. 3 &gt;<br>æˆ–è€…gt:åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºå³è¾¹å€¼</li><li><code>&gt;=</code> æˆ–è€… <code>gte:</code> åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å¤§äºç­‰äºå³è¾¹å€¼</li><li><code>&lt;</code> æˆ–è€… <code>lt:</code> åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºå³è¾¹å€¼</li><li><code>&lt;=</code> æˆ–è€… <code>lte:</code> åˆ¤æ–­å·¦è¾¹å€¼æ˜¯å¦å°äºç­‰äºå³è¾¹å€¼ï¼Œæ³¨æ„: <code>=</code> å’Œ <code>!=</code> å¯ä»¥ç”¨äºå­—ç¬¦</li></ol><p>ä¸²,æ•°å€¼å’Œæ—¥æœŸæ¥æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰,ä½†=å’Œ!=ä¸¤è¾¹å¿…é¡»æ˜¯ç›¸åŒç±»å‹çš„å€¼,å¦åˆ™ä¼šäº§ç”Ÿé”™è¯¯</p><p>è€Œä¸” <code>FreeMarker</code> æ˜¯ç²¾ç¡®æ¯”è¾ƒ, <code>&quot;x&quot;,&quot;x &quot;,&quot;X&quot;</code> æ˜¯ä¸ç­‰çš„.å…¶å®ƒçš„è¿è¡Œç¬¦å¯ä»¥ä½œç”¨</p><p>äºæ•°å­—å’Œæ—¥æœŸ,ä½†ä¸èƒ½ä½œç”¨äºå­—ç¬¦ä¸²,å¤§éƒ¨åˆ†çš„æ—¶å€™,ä½¿ç”¨gtç­‰å­—æ¯è¿ç®—ç¬¦ä»£æ›¿ <code>&gt;</code> ä¼šæœ‰æ›´å¥½çš„æ•ˆæœ,å› ä¸º <code>FreeMarker</code> ä¼šæŠŠ <code>&gt;</code> è§£é‡Šæˆ <code>FTL</code> æ ‡ç­¾çš„ç»“æŸå­—ç¬¦, å½“ç„¶,ä¹Ÿå¯ä»¥ä½¿ <strong>æ‹¬å·</strong> æ¥é¿å…è¿™ç§æƒ…å†µ, å¦‚:<code>&lt;#if (x&gt;y)&gt;</code></p><h4 id="ç©ºå€¼å¤„ç†"><a href="#ç©ºå€¼å¤„ç†" class="headerlink" title="ç©ºå€¼å¤„ç†"></a>ç©ºå€¼å¤„ç†</h4><ol><li><p>åˆ¤æ–­æŸå˜é‡æ˜¯å¦å­˜åœ¨ä½¿ç”¨ â€œ??â€ ç”¨æ³•ä¸º:variable??,å¦‚æœè¯¥å˜é‡å­˜åœ¨,è¿”å›true,å¦åˆ™è¿”å›false</p><p>ä¾‹ï¼šä¸ºé˜²æ­¢stusä¸ºç©ºæŠ¥é”™å¯ä»¥åŠ ä¸Šåˆ¤æ–­å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">stus</span>??&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stus</span> <span class="hljs-attr">as</span> <span class="hljs-attr">stu</span>&gt;</span>......<span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span></code></pre></div></li><li><p>ç¼ºå¤±å˜é‡é»˜è®¤å€¼ä½¿ç”¨ <code>â€œ!â€</code> ä½¿ç”¨ <code>!</code> è¦ä»¥æŒ‡å®šä¸€ä¸ªé»˜è®¤å€¼ï¼Œå½“å˜é‡ä¸ºç©ºæ—¶æ˜¾ç¤ºé»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼š <code>${name!&#39;&#39;}</code> è¡¨ç¤ºå¦‚æœ <code>name</code> ä¸ºç©ºæ˜¾ç¤ºç©ºå­—ç¬¦ä¸²ã€‚</p><p>å¦‚æœæ˜¯åµŒå¥—å¯¹è±¡åˆ™å»ºè®®ä½¿ç”¨ï¼ˆï¼‰æ‹¬èµ·æ¥ã€‚</p><p>ä¾‹ï¼š ${(stu.bestFriend.name)!â€™â€™}è¡¨ç¤ºï¼Œå¦‚æœstuæˆ–bestFriendæˆ–nameä¸ºç©ºé»˜è®¤æ˜¾ç¤ºç©ºå­—ç¬¦ä¸²ã€‚</p></li></ol><h4 id="å†…å»ºå‡½æ•°"><a href="#å†…å»ºå‡½æ•°" class="headerlink" title="å†…å»ºå‡½æ•°"></a>å†…å»ºå‡½æ•°</h4><p>å†…å»ºå‡½æ•°è¯­æ³•æ ¼å¼ï¼š å˜é‡+?+å‡½æ•°åç§°</p><ol><li><p>å¾—åˆ°æŸä¸ªé›†åˆçš„å¤§å°ï¼š<code>${é›†åˆå?size}</code></p></li><li><p>æ—¥æœŸæ ¼å¼åŒ–</p><div class="hljs"><pre><code class="hljs html">æ˜¾ç¤ºå¹´æœˆæ—¥: $&#123;today?date&#125;æ˜¾ç¤ºæ—¶åˆ†ç§’ï¼š$&#123;today?time&#125;æ˜¾ç¤ºæ—¥æœŸ+æ—¶é—´ï¼š$&#123;today?datetime&#125; <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span>è‡ªå®šä¹‰æ ¼å¼åŒ–ï¼š $&#123;today?string("yyyyå¹´MMæœˆ")&#125;</code></pre></div></li><li><p>å†…å»ºå‡½æ•° <code>c</code></p><p><code>map.put(&quot;point&quot;, 102920122);</code></p><p><code>point</code> æ˜¯æ•°å­—å‹ï¼Œä½¿ç”¨ <code>${point}</code> ä¼šæ˜¾ç¤ºè¿™ä¸ªæ•°å­—çš„å€¼ï¼Œå¹¶ä¸”æ¯ä¸‰ä½ä½¿ç”¨é€—å·åˆ†éš”ã€‚ä¾‹å¦‚ï¼šâ€œ102,920,122â€</p><p>å¦‚æœä¸æƒ³æ˜¾ç¤ºä¸ºæ¯ä¸‰ä½åˆ†éš”çš„æ•°å­—ï¼Œå¯ä»¥ä½¿ç”¨ <code>c</code> å‡½æ•°å°†æ•°å­—å‹è½¬æˆå­—ç¬¦ä¸²è¾“å‡º</p><p>ä¾‹å¦‚ï¼š<code>${point?c}</code></p></li><li><p>å°†jsonå­—ç¬¦ä¸²è½¬æˆå¯¹è±¡</p><p>ä¸€ä¸ªä¾‹å­ï¼š</p><p>å…¶ä¸­ç”¨åˆ°äº† assignæ ‡ç­¾ï¼Œassignçš„ä½œç”¨æ˜¯å®šä¹‰ä¸€ä¸ªå˜é‡ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">#assign</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"&#123;'bank':'å·¥å•†é“¶è¡Œ','account':'10101920201920212'&#125;"</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">#assign</span> <span class="hljs-attr">data</span>=<span class="hljs-string">text?eval</span> /&gt;</span>å¼€æˆ·è¡Œï¼š$&#123;data.bank&#125; è´¦å·ï¼š$&#123;data.account&#125;</code></pre></div></li></ol><h4 id="å®Œæ•´çš„æ¨¡æ¿"><a href="#å®Œæ•´çš„æ¨¡æ¿" class="headerlink" title="å®Œæ•´çš„æ¨¡æ¿"></a>å®Œæ•´çš„æ¨¡æ¿</h4><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utfâ€8"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello World!<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>Hello $&#123;name&#125;!<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>    åŒ—äº¬å¸‚æ˜Œå¹³åŒºå»ºæåŸè¥¿è·¯é‡‘ç‡•é¾™åŠå…¬æ¥¼ä¸€å±‚ ç”µè¯ï¼š400-618-9090<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åºå·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>é’±åŒ…<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stus</span> <span class="hljs-attr">as</span> <span class="hljs-attr">stu</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu_index + 1&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    &lt;td &lt;#if stu.name =='å°æ˜'&gt;style="background:red;"&lt;/#if&gt;&gt;$&#123;stu.name&#125;&lt;/td&gt;    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.age&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span>$&#123;stu.money&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>è¾“å‡ºstu1çš„å­¦ç”Ÿä¿¡æ¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>å§“åï¼š$&#123;stuMap['stu1'].name&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>å¹´é¾„ï¼š$&#123;stuMap['stu1'].age&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>è¾“å‡ºstu1çš„å­¦ç”Ÿä¿¡æ¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>å§“åï¼š$&#123;stu1.name&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>å¹´é¾„ï¼š$&#123;stu1.age&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>éå†è¾“å‡ºä¸¤ä¸ªå­¦ç”Ÿä¿¡æ¯ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>åºå·<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>é’±åŒ…<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stuMap</span>?<span class="hljs-attr">keys</span> <span class="hljs-attr">as</span> <span class="hljs-attr">k</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;k_index + 1&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stuMap[k].name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stuMap[k].age&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span> &gt;</span>$&#123;stuMap[k].money&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>å‡ºç”Ÿæ—¥æœŸ<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>é’±åŒ…<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>æœ€å¥½çš„æœ‹å‹<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>æœ‹å‹ä¸ªæ•°<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>æœ‹å‹åˆ—è¡¨<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">stus</span>??&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stus</span> <span class="hljs-attr">as</span> <span class="hljs-attr">stu</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.name!''&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.age&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;(stu.birthday?date)!''&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;stu.money&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;(stu.bestFriend.name)!''&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;(stu.friends?size)!0&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">stu.friends</span>??&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">stu.friends</span> <span class="hljs-attr">as</span> <span class="hljs-attr">firend</span>&gt;</span>    $&#123;firend.name!''&#125;<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">#assign</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"&#123;'bank':'å·¥å•†é“¶è¡Œ','account':'10101920201920212'&#125;"</span> /&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">#assign</span> <span class="hljs-attr">data</span>=<span class="hljs-string">text?eval</span> /&gt;</span>å¼€æˆ·è¡Œï¼š$&#123;data.bank&#125; è´¦å·ï¼š$&#123;data.account&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>&gt;</code></pre></div><h3 id="3ã€é™æ€åŒ–æµ‹è¯•"><a href="#3ã€é™æ€åŒ–æµ‹è¯•" class="headerlink" title="3ã€é™æ€åŒ–æµ‹è¯•"></a>3ã€é™æ€åŒ–æµ‹è¯•</h3><p>åœ¨cmsä¸­ä½¿ç”¨freemarkerå°†é¡µé¢ç”Ÿæˆhtmlæ–‡ä»¶ï¼Œæœ¬èŠ‚æµ‹è¯•htmlæ–‡ä»¶ç”Ÿæˆçš„æ–¹æ³•ï¼š</p><p><strong>1ã€ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶é™æ€åŒ–</strong></p><p>å®šä¹‰æ¨¡æ¿æ–‡ä»¶ï¼Œä½¿ç”¨freemarkeré™æ€åŒ–ç¨‹åºç”Ÿæˆhtmlæ–‡ä»¶ã€‚</p><p><strong>2ã€ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²é™æ€åŒ–</strong></p><p>å®šä¹‰æ¨¡æ¿å­—ç¬¦ä¸²ï¼Œä½¿ç”¨freemarkeré™æ€åŒ–ç¨‹åºç”Ÿæˆhtmlæ–‡ä»¶ã€‚</p><h4 id="ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶é™æ€åŒ–"><a href="#ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶é™æ€åŒ–" class="headerlink" title="ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶é™æ€åŒ–"></a>ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶é™æ€åŒ–</h4><p>åœ¨ <code>test</code> ä¸‹åˆ›å»ºæµ‹è¯•ç±»ï¼Œå¹¶ä¸”å°†<code>main</code>ä¸‹çš„ <code>resource/templates</code> æ‹·è´åˆ° <code>test</code> ä¸‹ï¼Œæœ¬æ¬¡æµ‹è¯•ä½¿ç”¨ä¹‹å‰æˆ‘ä»¬åœ¨ <code>main</code> ä¸‹åˆ›å»ºçš„æ¨¡æ¿æ–‡ä»¶ï¼Œå¹¶åˆ›å»ºæµ‹è¯•ç±»ã€‚ ç›®å½•ç»“æ„å¦‚ä¸‹</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image10" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image10.png" srcset="/img/loading.gif" alt="img"></a></p><p>åˆ›å»ºæµ‹è¯•ç±»</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åŸºäºæ¨¡æ¿ç”Ÿæˆé™æ€æ–‡ä»¶</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGenerateHtml</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;    <span class="hljs-comment">//åˆ›å»ºé…ç½®ç±»</span>    Configuration configuration = <span class="hljs-keyword">new</span> Configuration(Configuration.getVersion());    <span class="hljs-comment">//è®¾ç½®æ¨¡æ¿è·¯å¾„</span>    String classPath = <span class="hljs-keyword">this</span>.getClass().getResource(<span class="hljs-string">"/"</span>).getPath();    classPath = java.net.URLDecoder.decode(classPath,<span class="hljs-string">"utf-8"</span>); <span class="hljs-comment">//è·¯å¾„åŒ…å«ä¸­æ–‡éœ€è¦è¿›è¡Œè½¬ç </span>    configuration.setDirectoryForTemplateLoading(<span class="hljs-keyword">new</span> File(classPath +<span class="hljs-string">"/templates"</span>));    <span class="hljs-comment">//è®¾ç½®å­—ç¬¦é›†</span>    configuration.setDefaultEncoding(<span class="hljs-string">"utf-8"</span>);    <span class="hljs-comment">//åŠ è½½æ¨¡æ¿</span>    Template template = configuration.getTemplate(<span class="hljs-string">"test1.ftl"</span>);    <span class="hljs-comment">//æ•°æ®æ¨¡å‹</span>    Map map = getMap();    <span class="hljs-comment">//é™æ€åŒ–</span>    String content = FreeMarkerTemplateUtils.processTemplateIntoString(template, map);    <span class="hljs-comment">//é™æ€åŒ–å†…å®¹</span>    InputStream inputStream = IOUtils.toInputStream(content);    <span class="hljs-comment">//è¾“å‡ºåˆ°æ–‡ä»¶</span>    FileOutputStream fileOutputStream = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-keyword">new</span> File(<span class="hljs-string">"d:/test1.html"</span>));    <span class="hljs-keyword">int</span> copy = IOUtils.copy(inputStream, fileOutputStream);&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> Map <span class="hljs-title">getMap</span><span class="hljs-params">()</span></span>&#123;    Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    map.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"é»‘é©¬ç¨‹åºå‘˜"</span>);    <span class="hljs-comment">//å­¦ç”Ÿå¯¹è±¡1</span>    Student stu1 = <span class="hljs-keyword">new</span> Student();    stu1.setName(<span class="hljs-string">"å°æ˜"</span>);    stu1.setAge(<span class="hljs-number">18</span>);    stu1.setMoney(<span class="hljs-number">1888.123f</span>);    stu1.setBirthday(<span class="hljs-keyword">new</span> Date());    <span class="hljs-comment">//å­¦ç”Ÿå¯¹è±¡2</span>    Student stu2 = <span class="hljs-keyword">new</span> Student();    stu2.setName(<span class="hljs-string">"å°çº¢"</span>);    stu2.setAge(<span class="hljs-number">22</span>);    stu2.setMoney(<span class="hljs-number">1888.123f</span>);    stu2.setBirthday(<span class="hljs-keyword">new</span> Date());    <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªListå¯¹è±¡ï¼Œç”¨äºå‚¨å­˜ä¸Šé¢è¿™ä¸¤ä¸ªå­¦ç”Ÿå¯¹è±¡</span>    ArrayList&lt;Object&gt; stus = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    stus.add(stu1);    stus.add(stu2);    <span class="hljs-comment">//å‘æ•°æ®æ¨¡å‹ä¸­æ”¾å…¥List</span>    map.put(<span class="hljs-string">"stus"</span>,stus);    <span class="hljs-comment">//å‡†å¤‡mapæ•°æ®</span>    HashMap&lt;Object, Object&gt; stuMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();    stuMap.put(<span class="hljs-string">"stu1"</span>,stu1);    stuMap.put(<span class="hljs-string">"stu2"</span>,stu2);    <span class="hljs-comment">//åƒæ•°æ®æ¨¡å‹å†…æ”¾æ•°æ®</span>    map.put(<span class="hljs-string">"stu1"</span>,stu1);    <span class="hljs-comment">//å‘æ•°æ®æ¨¡å‹æ”¾å…¥stuMap</span>    map.put(<span class="hljs-string">"stuMap"</span>, stuMap);    <span class="hljs-keyword">return</span> map;&#125;</code></pre></div><p>è¿è¡Œæµ‹è¯•ï¼Œå¾—åˆ°htmlæ¨¡æ¿</p><p><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image11.png" srcset="/img/loading.gif" alt="img"></p><h4 id="ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²é™æ€åŒ–"><a href="#ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²é™æ€åŒ–" class="headerlink" title="ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²é™æ€åŒ–"></a>ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²é™æ€åŒ–</h4><p>è¯¦ç»†ä»£ç çœç•¥ï¼Œä½¿ç”¨å­—ç¬¦ä¸²å’Œä½¿ç”¨æ¨¡æ¿çš„åŒºåˆ«æ˜¯ è¿™é‡Œç›´æ¥å®šä¹‰ä¸€ä¸ª <code>HTML</code> çš„å­—ç¬¦ä¸²å˜é‡ï¼Œä¾‹å¦‚</p><div class="hljs"><pre><code class="hljs java">String templateString=<span class="hljs-string">""</span> +    <span class="hljs-string">"&lt;html&gt;\n"</span> +    <span class="hljs-string">" &lt;head&gt;&lt;/head&gt;\n"</span> +    <span class="hljs-string">" &lt;body&gt;\n"</span> +    <span class="hljs-string">" åç§°ï¼š$&#123;name&#125;\n"</span> +    <span class="hljs-string">" &lt;/body&gt;\n"</span> +    <span class="hljs-string">"&lt;/html&gt;"</span>;</code></pre></div><p>è€Œå‰é¢çš„ä¾‹å­æ˜¯ä»ftlæ¨¡æ¿ä¸­è·å–å†…å®¹</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åŠ è½½æ¨¡æ¿</span>Template template = configuration.getTemplate(<span class="hljs-string">"test1.ftl"</span>);</code></pre></div><h2 id="4-ç« èŠ‚æ€»ç»“"><a href="#4-ç« èŠ‚æ€»ç»“" class="headerlink" title="4. ç« èŠ‚æ€»ç»“"></a>4. ç« èŠ‚æ€»ç»“</h2><p>æœ¬ç« èŠ‚ä¸»è¦ä»‹ç»äº† <code>Freemarker</code> æ¨¡æ¿å¼•æ“çš„è¯­æ³•ä»‹ç»å’ŒåŸºæœ¬çš„åº”ç”¨ï¼Œå¹¶äº†è§£äº† <code>Freemarker</code> åœ¨è¿›è¡Œæ¨¡æ¿æ¸²æŸ“æ—¶çš„APIè°ƒç”¨è¿‡ç¨‹ã€‚</p><h1 id="ä¸‰ã€é¡µé¢é™æ€åŒ–å®æˆ˜"><a href="#ä¸‰ã€é¡µé¢é™æ€åŒ–å®æˆ˜" class="headerlink" title="ä¸‰ã€é¡µé¢é™æ€åŒ–å®æˆ˜"></a>ä¸‰ã€é¡µé¢é™æ€åŒ–å®æˆ˜</h1><h2 id="1-é¡µé¢é™æ€åŒ–æµç¨‹"><a href="#1-é¡µé¢é™æ€åŒ–æµç¨‹" class="headerlink" title="1.é¡µé¢é™æ€åŒ–æµç¨‹"></a>1.é¡µé¢é™æ€åŒ–æµç¨‹</h2><p>é€šè¿‡ä¸Šè¾¹å¯¹ <code>FreeMarker</code> çš„ç ”ç©¶æˆ‘ä»¬å¾—å‡ºï¼š<strong>æ¨¡æ¿ + æ•°æ®æ¨¡å‹ = è¾“å‡º</strong>ï¼Œé¡µé¢é™æ€åŒ–éœ€è¦å‡†å¤‡æ•°æ®æ¨¡å‹å’Œæ¨¡æ¿ï¼Œå…ˆçŸ¥é“æ•°æ®æ¨¡å‹çš„ç»“æ„æ‰å¯ä»¥ç¼–å†™æ¨¡æ¿ï¼Œå› ä¸ºåœ¨æ¨¡æ¿ä¸­è¦å¼•ç”¨æ•°æ®æ¨¡å‹ä¸­çš„æ•°æ®ï¼Œæœ¬èŠ‚å°†ç³»ç»Ÿè®²è§£ <code>CMS</code> é¡µé¢æ•°æ®æ¨¡å‹è·å–ã€æ¨¡æ¿ç®¡ç†åŠé™æ€åŒ–çš„è¿‡ç¨‹ã€‚</p><p>ä¸‹è¾¹æˆ‘ä»¬è®¨è®ºä¸€ä¸ªé—®é¢˜ï¼š<strong>å¦‚ä½•è·å–é¡µé¢çš„æ•°æ®æ¨¡å‹ï¼Ÿ</strong></p><p><code>CMS</code> ç®¡ç†äº†å„ç§é¡µé¢ï¼Œ<code>CMS</code> å¯¹é¡µé¢è¿›è¡Œé™æ€åŒ–æ—¶éœ€è¦æ•°æ®æ¨¡å‹ï¼Œä½†æ˜¯ <code>CMS</code> å¹¶ä¸çŸ¥é“æ¯ä¸ªé¡µé¢çš„æ•°æ®æ¨¡å‹çš„å…·ä½“å†…å®¹ï¼Œå®ƒåªç®¡æ‰§è¡Œé™æ€åŒ–ç¨‹åºä¾¿å¯å¯¹é¡µé¢è¿›è¡Œé™æ€åŒ–ï¼Œæ‰€ä»¥ <code>CMS</code> é™æ€åŒ–ç¨‹åºéœ€è¦é€šè¿‡ä¸€ç§é€šç”¨çš„æ–¹æ³•æ¥è·å–æ•°æ®æ¨¡å‹ã€‚</p><p>åœ¨ç¼–è¾‘é¡µé¢ä¿¡æ¯æ—¶æŒ‡å®šä¸€ä¸ª <code>DataUrl</code> ï¼Œæ­¤ <code>DataUrl</code> ä¾¿æ˜¯è·å–æ•°æ®æ¨¡å‹çš„ <code>Url</code>ï¼Œå®ƒåŸºäº <code>Http</code>æ–¹å¼ï¼Œ<code>CMS</code> å¯¹é¡µé¢è¿›è¡Œé™æ€åŒ–æ—¶ä¼šä»é¡µé¢ä¿¡æ¯ä¸­è¯»å– <code>DataUrl</code>ï¼Œé€šè¿‡ <code>Http</code> è¿œç¨‹è°ƒç”¨çš„æ–¹æ³•è¯·æ±‚ <code>DataUrl</code> è·å–æ•°æ®æ¨¡å‹ ã€‚</p><p>ç®¡ç†å‘˜æ€ä¹ˆçŸ¥é“ <code>DataUrl</code> çš„å†…å®¹å‘¢ï¼Ÿ</p><p><strong>ä¸¾ä¾‹è¯´æ˜</strong>ï¼š</p><p>æ­¤é¡µé¢æ˜¯è½®æ’­å›¾é¡µé¢ï¼Œå®ƒçš„ <code>DataUrl</code> ç”±å¼€å‘è½®æ’­å›¾ç®¡ç†çš„ç¨‹åºå‘˜æä¾›ã€‚</p><p>æ­¤é¡µé¢æ˜¯ç²¾å“è¯¾ç¨‹æ¨èé¡µé¢ï¼Œå®ƒçš„ <code>DataUrl</code> ç”±ç²¾å“è¯¾ç¨‹æ¨èçš„ç¨‹åºå‘˜æä¾›ã€‚</p><p>æ­¤é¡µé¢æ˜¯è¯¾ç¨‹è¯¦æƒ…é¡µé¢ï¼Œå®ƒçš„ <code>DataUrl</code> ç”±è¯¾ç¨‹ç®¡ç†çš„ç¨‹åºå‘˜æä¾›ã€‚</p><p>é¡µé¢é™æ€åŒ–æµç¨‹å¦‚ä¸‹å›¾ï¼š</p><p>1ã€é™æ€åŒ–ç¨‹åºé¦–å…ˆè¯»å–é¡µé¢è·å–DataUrlã€‚</p><p>2ã€é™æ€åŒ–ç¨‹åºè¿œç¨‹è¯·æ±‚DataUrlå¾—åˆ°æ•°æ®æ¨¡å‹ã€‚</p><p>3ã€è·å–é¡µé¢æ¨¡æ¿ã€‚</p><p>4ã€æ‰§è¡Œé¡µé¢é™æ€åŒ–</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image12" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image12.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="2-æ•°æ®æ¨¡å‹"><a href="#2-æ•°æ®æ¨¡å‹" class="headerlink" title="2. æ•°æ®æ¨¡å‹"></a>2. æ•°æ®æ¨¡å‹</h2><h3 id="1ã€è½®æ’­å›¾DataUrlæ¥å£"><a href="#1ã€è½®æ’­å›¾DataUrlæ¥å£" class="headerlink" title="1ã€è½®æ’­å›¾DataUrlæ¥å£"></a>1ã€è½®æ’­å›¾DataUrlæ¥å£</h3><h4 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h4><p><code>CMS</code> ä¸­æœ‰è½®æ’­å›¾ç®¡ç†ã€ç²¾å“è¯¾ç¨‹æ¨èçš„åŠŸèƒ½ï¼Œä»¥è½®æ’­å›¾ç®¡ç†ä¸ºä¾‹è¯´æ˜ï¼šè½®æ’­å›¾ç®¡ç†æ˜¯é€šè¿‡å¯è§†åŒ–çš„æ“ä½œç•Œé¢ç”±ç®¡ç†å‘˜æŒ‡å®šè½®æ’­å›¾å›¾ç‰‡åœ°å€ï¼Œæœ€åå°†è½®æ’­å›¾å›¾ç‰‡åœ°å€ä¿å­˜åœ¨ <code>cms_config</code> é›†åˆä¸­ï¼Œä¸‹è¾¹æ˜¯è½®æ’­å›¾æ•°æ®æ¨¡å‹</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image13" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image13.png" srcset="/img/loading.gif" alt="img"></a></p><p>é’ˆå¯¹é¦–é¡µçš„è½®æ’­å›¾ä¿¡æ¯ã€ç²¾å“æ¨èç­‰ä¿¡æ¯çš„è·å–ç»Ÿä¸€æä¾›ä¸€ä¸ª <code>Url</code> ä¾›é™æ€åŒ–ç¨‹åºè°ƒç”¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±çŸ¥é“äº†è½®æ’­å›¾é¡µé¢ã€ç²¾å“è¯¾ç¨‹æ¨èé¡µé¢çš„ <code>DataUrl</code>ï¼Œç®¡ç†åœ¨é¡µé¢é…ç½®ä¸­å°†æ­¤ <code>Url</code> é…ç½®åœ¨é¡µé¢ä¿¡æ¯ä¸­ã€‚æœ¬å°èŠ‚å¼€å‘ä¸€ä¸ªæŸ¥è¯¢è½®æ’­å›¾ã€ç²¾å“æ¨èä¿¡æ¯çš„æ¥å£ï¼Œæ­¤æ¥å£ä¾›é™æ€åŒ–ç¨‹åºè°ƒç”¨è·å–æ•°æ®æ¨¡å‹ ã€‚</p><h4 id="æ¥å£å®šä¹‰"><a href="#æ¥å£å®šä¹‰" class="headerlink" title="æ¥å£å®šä¹‰"></a>æ¥å£å®šä¹‰</h4><p>è½®æ’­å›¾ä¿¡æ¯ã€ç²¾å“æ¨èç­‰ä¿¡æ¯å­˜å‚¨åœ¨MongoDBçš„cms_configé›†åˆä¸­ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image14" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image14.png" srcset="/img/loading.gif" alt="img"></a></p><p>cms_configæœ‰å›ºå®šçš„æ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.cms;<span class="hljs-keyword">import</span> lombok.Data;<span class="hljs-keyword">import</span> lombok.ToString;<span class="hljs-keyword">import</span> org.springframework.data.annotation.Id;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.mapping.Document;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-meta">@Document</span>(collection = <span class="hljs-string">"cms_config"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsConfig</span> </span>&#123;    <span class="hljs-meta">@Id</span>    <span class="hljs-keyword">private</span> String id; <span class="hljs-comment">//ä¸»é”®</span>    <span class="hljs-keyword">private</span> String name; <span class="hljs-comment">//æ•°æ®æ¨¡å‹åç§°</span>    <span class="hljs-keyword">private</span> List&lt;CmsConfigModel&gt; model;  <span class="hljs-comment">//æ•°æ®æ¨¡å‹é¡¹ç›®</span>&#125;</code></pre></div><p>æ•°æ®ç±»å‹é¡¹ç›®çš„å†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.cms;<span class="hljs-keyword">import</span> lombok.Data;<span class="hljs-keyword">import</span> lombok.ToString;<span class="hljs-keyword">import</span> java.util.Map;<span class="hljs-meta">@Data</span><span class="hljs-meta">@ToString</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsConfigModel</span> </span>&#123;    <span class="hljs-keyword">private</span> String key;  <span class="hljs-comment">//ä¸»é”®</span>    <span class="hljs-keyword">private</span> String name; <span class="hljs-comment">//é¡¹ç›®åç§°</span>    <span class="hljs-keyword">private</span> String url;  <span class="hljs-comment">//é¡¹ç›®url</span>    <span class="hljs-keyword">private</span> Map mapValue;  <span class="hljs-comment">//é¡¹ç›®å¤æ‚å€¼</span>    <span class="hljs-keyword">private</span> String value;  <span class="hljs-comment">//é¡¹ç›®ç®€å•å€¼</span>&#125;</code></pre></div><p>ä¸Šè¾¹çš„æ•°æ®ç»“æ„å¯ä»¥å¯¹ç…§ <code>cms_config</code> çš„æ•°æ®è¿›è¡Œåˆ†æã€‚</p><p>å…¶ä¸­ï¼Œåœ¨ <code>mapValue</code> ä¸­å¯ä»¥å‚¨å­˜ä¸€äº›å¤æ‚çš„æ•°æ®çš„æ¨¡å‹å†…å®¹ã€‚</p><p>æ ¹æ®é…ç½®ä¿¡æ¯IdæŸ¥è¯¢é…ç½®ä¿¡æ¯ï¼Œå®šä¹‰æ¥å£å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.api.cms;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsConfig;<span class="hljs-keyword">import</span> io.swagger.annotations.Api;<span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;<span class="hljs-meta">@Api</span>(value=<span class="hljs-string">"cmsé…ç½®ç®¡ç†æ¥å£"</span>,description = <span class="hljs-string">"cmsé…ç½®ç®¡ç†æ¥å£ï¼Œæä¾›æ•°æ®æ¨¡å‹çš„ç®¡ç†ã€æŸ¥è¯¢æ¥å£"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsConfigControllerApi</span> </span>&#123;    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æ ¹æ®idæŸ¥è¯¢CMSé…ç½®ä¿¡æ¯"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsConfig <span class="hljs-title">getModel</span><span class="hljs-params">(String id)</span></span>;&#125;</code></pre></div><h4 id="Daoå±‚"><a href="#Daoå±‚" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.dao;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsConfig;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsConfigRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsConfig</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div><h4 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><p>åœ¨åŸserviceå±‚æ·»åŠ ï¼ˆæ­¤å¤„åº”æ–°åˆ›å»ºä¸€ä¸ªServiceï¼‰</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">     * æ ¹æ®idæŸ¥è¯¢cmsconfig</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsConfig <span class="hljs-title">getConfigById</span><span class="hljs-params">(String id)</span></span>&#123;        Optional&lt;CmsConfig&gt; optional = cmsConfigRepository.findById(id);        <span class="hljs-keyword">if</span> (optional.isPresent())&#123;            CmsConfig cmsConfig = optional.get();            <span class="hljs-keyword">return</span> cmsConfig;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;</code></pre></div><h4 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.controller;<span class="hljs-keyword">import</span> com.xuecheng.api.cms.CmsConfigControllerApi;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsConfig;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.service.CmsConfigService;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/cms/config"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsConfigController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CmsConfigControllerApi</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CmsConfigService cmsConfigService;    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/getmodel/&#123;id&#125;"</span>)    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsConfig <span class="hljs-title">getModel</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id) </span>&#123;        CmsConfig configById = cmsConfigService.getConfigById(id);        <span class="hljs-keyword">return</span> configById;    &#125;&#125;</code></pre></div><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>ä½¿ç”¨postmanæµ‹è¯•æ¥å£ï¼š</p><p>getè¯·æ±‚ï¼š<a href="http://localhost:31001/cms/config/getmodel/5a791725dd573c3574ee333f" target="_blank" rel="noopener">http://localhost:31001/cms/config/getmodel/5a791725dd573c3574ee333f</a> ï¼ˆè½®æ’­å›¾ä¿¡æ¯ï¼‰</p><h3 id="2ã€è¿œç¨‹è¯·æ±‚æ¥å£"><a href="#2ã€è¿œç¨‹è¯·æ±‚æ¥å£" class="headerlink" title="2ã€è¿œç¨‹è¯·æ±‚æ¥å£"></a>2ã€è¿œç¨‹è¯·æ±‚æ¥å£</h3><p><code>SpringMVC</code> æä¾› <code>RestTemplate</code> è¯·æ±‚ <code>http</code> æ¥å£ï¼Œ<code>RestTemplate</code> çš„åº•å±‚å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ <code>http</code> å®¢æˆ·ç«¯å·¥å…·å®ç° <code>http</code> çš„è¯·æ±‚ï¼Œå¸¸ç”¨çš„ <code>http</code> å®¢æˆ·ç«¯å·¥å…·æœ‰ <code>Apache HttpClient</code>ã€<code>OkHttpClient</code> ç­‰ï¼Œæœ¬é¡¹ç›®ä½¿ç”¨ <code>OkHttpClient</code> å®Œæˆ <code>http</code> è¯·æ±‚ï¼ŒåŸå› ä¹Ÿæ˜¯å› ä¸ºå®ƒçš„æ€§èƒ½æ¯”è¾ƒå‡ºä¼—ã€‚</p><h4 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h4><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span></span></code></pre></div><h4 id="é…ç½®-RestTemplate"><a href="#é…ç½®-RestTemplate" class="headerlink" title="é…ç½® RestTemplate"></a>é…ç½® RestTemplate</h4><p>åœ¨<code>SpringBoot</code>å¯åŠ¨ç±»ä¸­é…ç½® <code>RestTemplate</code></p><div class="hljs"><pre><code class="hljs java">...<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCmsApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(ManageCmsApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate(<span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory());    &#125;&#125;</code></pre></div><h4 id="3ã€æµ‹è¯•-RestTemplate"><a href="#3ã€æµ‹è¯•-RestTemplate" class="headerlink" title="3ã€æµ‹è¯• RestTemplate"></a>3ã€æµ‹è¯• RestTemplate</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">RestTemplateTest</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    RestTemplate restTemplate;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testRestTemplate</span><span class="hljs-params">()</span></span>&#123;        ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(<span class="hljs-string">"http://localhost:31001/cms/config/getmodel/5a791725dd573c3574ee333f"</span>, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;        System.out.println(forEntity);    &#125;&#125;</code></pre></div><p>è¿è¡Œæµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image15" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image15.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-æ¨¡æ¿ç®¡ç†"><a href="#3-æ¨¡æ¿ç®¡ç†" class="headerlink" title="3.æ¨¡æ¿ç®¡ç†"></a>3.æ¨¡æ¿ç®¡ç†</h2><h3 id="1ã€æ¨¡æ¿ç®¡ç†ä¸šåŠ¡æµç¨‹"><a href="#1ã€æ¨¡æ¿ç®¡ç†ä¸šåŠ¡æµç¨‹" class="headerlink" title="1ã€æ¨¡æ¿ç®¡ç†ä¸šåŠ¡æµç¨‹"></a>1ã€æ¨¡æ¿ç®¡ç†ä¸šåŠ¡æµç¨‹</h3><p>CMSæä¾›æ¨¡æ¿ç®¡ç†åŠŸèƒ½ï¼Œä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image16" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image16.png" srcset="/img/loading.gif" alt="img"></a></p><p>1ã€è¦å¢åŠ æ–°æ¨¡æ¿é¦–å…ˆéœ€è¦åˆ¶ä½œæ¨¡æ¿ï¼Œæ¨¡æ¿çš„å†…å®¹å°±æ˜¯ <code>Freemarker ftl</code> æ¨¡æ¿å†…å®¹ã€‚</p><p>2ã€é€šè¿‡æ¨¡æ¿ç®¡ç†æ¨¡å—åŠŸèƒ½æ–°å¢æ¨¡æ¿ã€ä¿®æ”¹æ¨¡æ¿ã€åˆ é™¤æ¨¡æ¿ã€‚</p><p>3ã€æ¨¡æ¿ä¿¡æ¯å­˜å‚¨åœ¨ <code>MongoDB</code> æ•°æ®åº“ï¼Œå…¶ä¸­æ¨¡æ¿ä¿¡æ¯å­˜å‚¨åœ¨ <code>cms_template</code> é›†åˆä¸­ï¼Œæ¨¡æ¿æ–‡ä»¶å­˜å‚¨åœ¨ <code>GridFS</code> æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p><p>ä¸‹è¾¹æ˜¯ä¸€ä¸ªæ¨¡æ¿çš„ä¾‹å­ï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;    <span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5a962b52b00ffc514038faf7"</span>),    <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsTemplate"</span>,    <span class="hljs-attr">"siteId"</span> : <span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>,    <span class="hljs-attr">"templateName"</span> : <span class="hljs-string">"é¦–é¡µ"</span>,    <span class="hljs-attr">"templateParameter"</span> : <span class="hljs-string">""</span>,    <span class="hljs-attr">"templateFileId"</span> : <span class="hljs-string">"5a962b52b00ffc514038faf5"</span>&#125;</code></pre></div><p>ä¸Šè¾¹æ¨¡æ¿ä¿¡æ¯ä¸­ <code>templateFileId</code> æ˜¯æ¨¡æ¿æ–‡ä»¶çš„IDï¼Œæ­¤IDå¯¹åº” <code>GridFS</code> æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶IDã€‚</p><h3 id="2ã€æ¨¡æ¿åˆ¶ä½œ"><a href="#2ã€æ¨¡æ¿åˆ¶ä½œ" class="headerlink" title="2ã€æ¨¡æ¿åˆ¶ä½œ"></a>2ã€æ¨¡æ¿åˆ¶ä½œ</h3><h4 id="ç¼–å†™æ¨¡æ¿æ–‡ä»¶"><a href="#ç¼–å†™æ¨¡æ¿æ–‡ä»¶" class="headerlink" title="ç¼–å†™æ¨¡æ¿æ–‡ä»¶"></a>ç¼–å†™æ¨¡æ¿æ–‡ä»¶</h4><p>è½®æ’­å›¾é¡µé¢åŸå‹</p><p>åœ¨é—¨æˆ·çš„é™æ€å·¥ç¨‹ç›®å½•æœ‰è½®æ’­å›¾çš„é™æ€é¡µé¢ï¼Œè·¯å¾„æ˜¯ï¼š<code>/include/index_banner.html</code>ã€‚</p><p>æ•°æ®æ¨¡å‹ä¸ºï¼š</p><p>é€šè¿‡http è·å–åˆ°æ•°æ®æ¨¡å‹å¦‚ä¸‹ï¼š</p><p>ä¸‹å›¾æ•°æ®æ¨¡å‹çš„å›¾ç‰‡è·¯å¾„æ”¹æˆå¯ä»¥æµè§ˆçš„æ­£ç¡®è·¯å¾„ã€‚</p><div class="hljs"><pre><code class="hljs json">&#123;     <span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5a791725dd573c3574ee333f"</span>),     <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsConfig"</span>,     <span class="hljs-attr">"name"</span> : <span class="hljs-string">"è½®æ’­å›¾"</span>,     <span class="hljs-attr">"model"</span> : [        &#123;            <span class="hljs-attr">"key"</span> : <span class="hljs-string">"banner1"</span>,             <span class="hljs-attr">"name"</span> : <span class="hljs-string">"è½®æ’­å›¾1åœ°å€"</span>,             <span class="hljs-attr">"value"</span> : <span class="hljs-string">"http://www.xuecheng.com/img/widget-bannerA.jpg"</span>        &#125;,         &#123;            <span class="hljs-attr">"key"</span> : <span class="hljs-string">"banner2"</span>,             <span class="hljs-attr">"name"</span> : <span class="hljs-string">"è½®æ’­å›¾2åœ°å€"</span>,             <span class="hljs-attr">"value"</span> : <span class="hljs-string">"http://www.xuecheng.com/img/widget-bannerB.jpg"</span>        &#125;    ]&#125;</code></pre></div><p>ç¼–å†™æ¨¡æ¿</p><p>åœ¨freemarkeræµ‹è¯•å·¥ç¨‹ä¸­æ–°å»ºæ¨¡æ¿ <code>index_banner.ftl</code>ã€‚</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.xuecheng.com/plugins/normalize-css/normalize.css"</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.xuecheng.com/plugins/bootstrap/dist/css/bootstrap.css"</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.xuecheng.com/css/page-learing-index.css"</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.xuecheng.com/css/page-header.css"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"banner-roll"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"banner-item"</span>&gt;</span>        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-bannerB.jpg);"&gt;&lt;/div&gt;--&gt;        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-bannerA.jpg);"&gt;&lt;/div&gt;--&gt;        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-banner3.png);"&gt;&lt;/div&gt;--&gt;        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-bannerB.jpg);"&gt;&lt;/div&gt;--&gt;        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-bannerA.jpg);"&gt;&lt;/div&gt;--&gt;        &lt;#--&lt;div class="item" style="background-image: url(http://www.xuecheng.com/img/widget-banner3.png);"&gt;&lt;/div&gt;--&gt;        <span class="hljs-tag">&lt;<span class="hljs-name">#--æ¸²æŸ“è½®æ’­å›¾--</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">#if</span> <span class="hljs-attr">model</span>??&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">#list</span> <span class="hljs-attr">model</span> <span class="hljs-attr">as</span> <span class="hljs-attr">item</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"background-image: url($&#123;item.value&#125;);"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">#list</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">#if</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"indicators"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.xuecheng.com/plugins/jquery/dist/jquery.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"http://www.xuecheng.com/plugins/bootstrap/dist/js/bootstrap.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript">    <span class="hljs-keyword">var</span> tg = $(<span class="hljs-string">'.banner-item .item'</span>);</span><span class="actionscript">    <span class="hljs-keyword">var</span> num = <span class="hljs-number">0</span>;</span>    for (i = 0; i &lt; tg.length; i++) &#123;<span class="javascript">        $(<span class="hljs-string">'.indicators'</span>).append(<span class="hljs-string">'&lt;span&gt;&lt;/span&gt;'</span>);</span><span class="javascript">        $(<span class="hljs-string">'.indicators'</span>).find(<span class="hljs-string">'span'</span>).eq(num).addClass(<span class="hljs-string">'active'</span>);</span>    &#125;<span class="actionscript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">roll</span><span class="hljs-params">()</span> </span>&#123;</span>        tg.eq(num).animate(&#123;<span class="actionscript">            <span class="hljs-string">'opacity'</span>: <span class="hljs-string">'1'</span>,</span><span class="actionscript">            <span class="hljs-string">'z-index'</span>: num</span>        &#125;, 1000).siblings().animate(&#123;<span class="actionscript">            <span class="hljs-string">'opacity'</span>: <span class="hljs-string">'0'</span>,</span><span class="actionscript">            <span class="hljs-string">'z-index'</span>: <span class="hljs-number">0</span></span>        &#125;, 1000);<span class="javascript">        $(<span class="hljs-string">'.indicators'</span>).find(<span class="hljs-string">'span'</span>).eq(num).addClass(<span class="hljs-string">'active'</span>).siblings().removeClass(<span class="hljs-string">'active'</span>);</span>        if (num &gt;= tg.length - 1) &#123;            num = 0;<span class="actionscript">        &#125; <span class="hljs-keyword">else</span> &#123;</span>            num++;        &#125;    &#125;<span class="javascript">    $(<span class="hljs-string">'.indicators'</span>).find(<span class="hljs-string">'span'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;</span><span class="javascript">        num = $(<span class="hljs-keyword">this</span>).index();</span>        roll();    &#125;);<span class="actionscript">    <span class="hljs-keyword">var</span> timer = setInterval(roll, <span class="hljs-number">3000</span>);</span><span class="javascript">    $(<span class="hljs-string">'.banner-item'</span>).mouseover(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;</span>        clearInterval(timer)    &#125;);<span class="javascript">    $(<span class="hljs-string">'.banner-item'</span>).mouseout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>&#123;</span>        timer = setInterval(roll, 3000)    &#125;);<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h4 id="æ¨¡æ¿æµ‹è¯•"><a href="#æ¨¡æ¿æµ‹è¯•" class="headerlink" title="æ¨¡æ¿æµ‹è¯•"></a>æ¨¡æ¿æµ‹è¯•</h4><p>åœ¨ <code>freemarker</code> æµ‹è¯•å·¥ç¨‹çš„å…¥å£æ–‡ä»¶æ³¨å†Œ <code>RestTemplate</code> çš„Bean</p><blockquote><p>åŸè®²ä¹‰åªåœ¨ cmså·¥ç¨‹ä¸‹æ³¨å†Œäº†beanï¼Œè®°å¾— <code>freemarker</code> æµ‹è¯•å·¥ç¨‹ä¸‹ä¹Ÿè¦æ³¨å†Œ</p></blockquote><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreemarkerTestApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(FreemarkerTestApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;    &#125;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title">restTemplate</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestTemplate(<span class="hljs-keyword">new</span> OkHttp3ClientHttpRequestFactory());    &#125;&#125;</code></pre></div><p>åœ¨ <code>freemarker</code> æµ‹è¯•å·¥ç¨‹çš„ <code>FreemarkerController</code> ä¸‹ç¼–å†™ä¸€ä¸ªæ–¹æ³•æµ‹è¯•è½®æ’­å›¾æ¨¡æ¿ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>RestTemplate restTemplate;<span class="hljs-comment">/**</span><span class="hljs-comment"> * ç”¨äºè°ƒè¯•banneræ¨¡æ¿</span><span class="hljs-comment"> */</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/banner"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">indexBanner</span><span class="hljs-params">(Map&lt;String,Object&gt; map)</span></span>&#123;    String dataUrl = <span class="hljs-string">"http://localhost:31001/cms/config/getmodel/5a791725dd573c3574ee333f"</span>;    ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(dataUrl, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;    Map body = forEntity.getBody();    map.putAll(body); <span class="hljs-comment">//å°†è·å–åˆ°çš„æ•°æ®èµ‹å€¼ç»™mapï¼Œå¹¶æ¸²æŸ“è‡³æ¨¡æ¿å†…</span>    <span class="hljs-keyword">return</span> <span class="hljs-string">"index-banner"</span>;&#125;</code></pre></div><p>è¯·æ±‚ï¼š<a href="http://localhost:8088/freemarker/banner" target="_blank" rel="noopener">http://localhost:8088/freemarker/banner</a></p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image17" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image17.png" srcset="/img/loading.gif" alt="img"></a></p><h3 id="3ã€GridFS-ç ”ç©¶"><a href="#3ã€GridFS-ç ”ç©¶" class="headerlink" title="3ã€GridFS ç ”ç©¶"></a>3ã€GridFS ç ”ç©¶</h3><h4 id="GridFSä»‹ç»"><a href="#GridFSä»‹ç»" class="headerlink" title="GridFSä»‹ç»"></a>GridFSä»‹ç»</h4><p><code>GridFS</code> æ˜¯ <code>MongoDB</code> æä¾›çš„ç”¨äºæŒä¹…åŒ–å­˜å‚¨æ–‡ä»¶çš„æ¨¡å—ï¼ŒCMSä½¿ç”¨<code>MongoDB</code>å­˜å‚¨æ•°æ®ï¼Œä½¿ç”¨<code>GridFS</code> å¯ä»¥å¿«é€Ÿé›†æˆå¼€å‘ã€‚</p><p>å®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼š</p><p>åœ¨ <code>GridFS</code> å­˜å‚¨æ–‡ä»¶æ˜¯å°†æ–‡ä»¶åˆ†å—å­˜å‚¨ï¼Œæ–‡ä»¶ä¼šæŒ‰ç…§256KBçš„å¤§å°åˆ†å‰²æˆå¤šä¸ªå—è¿›è¡Œå­˜å‚¨ï¼Œ<code>GridFS</code> ä½¿ç”¨ä¸¤ä¸ªé›†åˆï¼ˆ<code>collection</code>ï¼‰å­˜å‚¨æ–‡ä»¶ï¼Œä¸€ä¸ªé›†åˆæ˜¯ <code>chunks</code>, ç”¨äºå­˜å‚¨æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®ï¼›ä¸€ä¸ªé›†åˆæ˜¯ <code>files</code>ï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ˆæ–‡ä»¶åç§°ã€å—å¤§å°ã€ä¸Šä¼ æ—¶é—´ç­‰ä¿¡æ¯ï¼‰ã€‚</p><p>ä» <code>GridFS</code> ä¸­è¯»å–æ–‡ä»¶è¦å¯¹æ–‡ä»¶çš„å„å„å—è¿›è¡Œç»„è£…ã€åˆå¹¶ã€‚<br>è¯¦ç»†å‚è€ƒï¼š<a href="https://docs.mongodb.com/manual/core/gridfs/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/core/gridfs/</a></p><h4 id="GridFS-å­˜å–æ–‡ä»¶æµ‹è¯•"><a href="#GridFS-å­˜å–æ–‡ä»¶æµ‹è¯•" class="headerlink" title="GridFS å­˜å–æ–‡ä»¶æµ‹è¯•"></a>GridFS å­˜å–æ–‡ä»¶æµ‹è¯•</h4><p>1ã€å­˜æ–‡ä»¶</p><p>è¿™é‡Œæˆ‘ä»¬åœ¨cmså·¥ç¨‹å†…è¿›è¡Œæµ‹è¯•</p><p>ä½¿ç”¨ <code>GridFsTemplate</code> å­˜å‚¨æ–‡ä»¶æµ‹è¯•ä»£ç ï¼š<br>å‘æµ‹è¯•ç¨‹åºæ³¨å…¥ <code>GridFsTemplate</code> ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">GridFsTest</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    GridFsTemplate gridFsTemplate;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGridFs</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> FileNotFoundException </span>&#123;        <span class="hljs-comment">//è¦å‚¨å­˜çš„æ–‡ä»¶</span>        File file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">"d:/resources/index-banner.ftl"</span>);        <span class="hljs-comment">//å®šä¹‰è¾“å…¥æµ</span>        FileInputStream fileInputStream = <span class="hljs-keyword">new</span> FileInputStream(file);        <span class="hljs-comment">//å‘GridFSå­˜å‚¨æ–‡ä»¶</span>        ObjectId objectId = gridFsTemplate.store(fileInputStream, <span class="hljs-string">"index-banner"</span>);        <span class="hljs-comment">//å¾—åˆ°æ–‡ä»¶ID</span>        String fileId = objectId.toString();        System.out.println(fileId);    &#125;&#125;</code></pre></div><p>å‚¨å­˜ç»“æœ</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image18" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image18.png" srcset="/img/loading.gif" alt="img"></a></p><p><strong>å­˜å‚¨åŸç†è¯´æ˜ï¼š</strong></p><p>æ–‡ä»¶å­˜å‚¨æˆåŠŸå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ <code>id</code><br>æ­¤æ–‡ä»¶ <code>id</code> æ˜¯ <code>fs.files</code> é›†åˆä¸­çš„ä¸»é”®ã€‚<br>å¯ä»¥é€šè¿‡æ–‡ä»¶ <code>id</code> æŸ¥è¯¢ <code>fs.chunks</code> è¡¨ä¸­çš„è®°å½•ï¼Œå¾—åˆ°æ–‡ä»¶çš„å†…å®¹ã€‚</p><p>2ã€è¯»å–æ–‡ä»¶</p><p>1ï¼‰åœ¨<code>config</code>åŒ…ä¸­å®šä¹‰ <code>Mongodb</code> çš„é…ç½®ç±»ï¼Œå¦‚ä¸‹ï¼š</p><p><code>GridFSBucket</code>ç”¨äºæ‰“å¼€ä¸‹è½½æµå¯¹è±¡</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MongoConfig</span> </span>&#123;    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;spring.data.mongodb.database&#125;"</span>)    String db;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> GridFSBucket <span class="hljs-title">getGridFSBucket</span><span class="hljs-params">(MongoClient mongoClient)</span></span>&#123;        MongoDatabase database = mongoClient.getDatabase(db);        GridFSBucket gridFSBucket = GridFSBuckets.create(database);        <span class="hljs-keyword">return</span> gridFSBucket;    &#125;&#125;</code></pre></div><p>2ï¼‰æµ‹è¯•ä»£ç å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>GridFSBucket gridFSBucket;<span class="hljs-comment">//å–æ–‡ä»¶</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queryFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;    String fileId = <span class="hljs-string">"5e79e4323304a26aecec55cd"</span>;    <span class="hljs-comment">//æ ¹æ®IDæŸ¥è¯¢æ–‡ä»¶</span>    GridFSFile gridFSFile = gridFsTemplate.findOne(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(fileId)));    <span class="hljs-comment">//æ‰“å¼€ä¸‹è½½æµå¯¹è±¡</span>    GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(gridFSFile.getObjectId());    <span class="hljs-comment">//åˆ›å»ºgridFsResourceï¼Œç”¨äºè·å–æµå¯¹è±¡</span>    GridFsResource gridFsResource = <span class="hljs-keyword">new</span> GridFsResource(gridFSFile, gridFSDownloadStream);    <span class="hljs-comment">//è·å–æµä¸­çš„æ•°æ®</span>    String s = IOUtils.toString(gridFsResource.getInputStream(), <span class="hljs-string">"utf-8"</span>);    System.out.println(s);&#125;</code></pre></div><h4 id="åˆ é™¤æ–‡ä»¶"><a href="#åˆ é™¤æ–‡ä»¶" class="headerlink" title="åˆ é™¤æ–‡ä»¶"></a>åˆ é™¤æ–‡ä»¶</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åˆ é™¤æ–‡ä»¶</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDelFile</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<span class="hljs-comment">//æ ¹æ®æ–‡ä»¶idåˆ é™¤fs.fileså’Œfs.chunksä¸­çš„è®°å½•</span>gridFsTemplate.delete(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(<span class="hljs-string">"5b32480ed3a022164c4d2f92"</span>)));&#125;</code></pre></div><h3 id="4ã€æ¨¡æ¿å‚¨å­˜"><a href="#4ã€æ¨¡æ¿å‚¨å­˜" class="headerlink" title="4ã€æ¨¡æ¿å‚¨å­˜"></a>4ã€æ¨¡æ¿å‚¨å­˜</h3><p>æ ¹æ®æ¨¡æ¿ç®¡ç†çš„æµç¨‹ï¼Œæœ€ç»ˆå°†æ¨¡æ¿ä¿¡æ¯å­˜å‚¨åˆ° <code>MongoDB</code> çš„ <code>cms_template</code> ä¸­ï¼Œå°†æ¨¡æ¿æ–‡ä»¶å­˜å‚¨åˆ° <code>GridFS</code>ä¸­ã€‚æ¨¡æ¿ç®¡ç†åŠŸèƒ½åœ¨è¯¾å ‚ä¸­ä¸å†è®²è§£ï¼Œæ•™å­¦ä¸­æ‰‹åŠ¨å‘ <code>cms_template</code> åŠ <code>GridFS</code> ä¸­å­˜å‚¨æ¨¡æ¿ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p><h4 id="1ï¼‰æ·»åŠ æ¨¡æ¿"><a href="#1ï¼‰æ·»åŠ æ¨¡æ¿" class="headerlink" title="1ï¼‰æ·»åŠ æ¨¡æ¿"></a>1ï¼‰æ·»åŠ æ¨¡æ¿</h4><p>ä½¿ç”¨ <code>GridFS</code> æµ‹è¯•ä»£ç å­˜å‚¨æ¨¡æ¿æ–‡ä»¶åˆ° <code>GridFS</code>ï¼Œå¹¶å¾—åˆ°æ–‡ä»¶æ¨¡æ¿ <code>id</code>ï¼Œå‘ <code>cms_template</code> æ·»åŠ è®°å½•</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image19" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image19.png" srcset="/img/loading.gif" alt="img"></a></p><h4 id="2ï¼‰åˆ é™¤æ¨¡æ¿"><a href="#2ï¼‰åˆ é™¤æ¨¡æ¿" class="headerlink" title="2ï¼‰åˆ é™¤æ¨¡æ¿"></a>2ï¼‰åˆ é™¤æ¨¡æ¿</h4><p>ä½¿ç”¨ <code>GridFS</code> æµ‹è¯•ä»£ç æ ¹æ®æ–‡ä»¶idåˆ é™¤æ¨¡æ¿æ–‡ä»¶ã€‚</p><p>æ ¹æ®æ¨¡æ¿idåˆ é™¤ <code>cms_template</code> ä¸­çš„è®°å½•ã€‚</p><h4 id="3ï¼‰ä¿®æ”¹æ¨¡æ¿ä¿¡æ¯"><a href="#3ï¼‰ä¿®æ”¹æ¨¡æ¿ä¿¡æ¯" class="headerlink" title="3ï¼‰ä¿®æ”¹æ¨¡æ¿ä¿¡æ¯"></a>3ï¼‰ä¿®æ”¹æ¨¡æ¿ä¿¡æ¯</h4><p>ä½¿ç”¨Studio 3Tä¿®æ”¹ <code>cms_template</code> ä¸­çš„è®°å½•ã€‚</p><h4 id="4ï¼‰ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶"><a href="#4ï¼‰ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶" class="headerlink" title="4ï¼‰ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶"></a>4ï¼‰ä¿®æ”¹æ¨¡æ¿æ–‡ä»¶</h4><p>1ï¼‰é€šè¿‡Studio 3Tä¿®æ”¹æ¨¡æ¿æ–‡ä»¶(æ­¤æ–¹æ³•é™æ–‡ä»¶å°äº256K)å¯ä»¥é€šè¿‡Studio 3Tä¿®æ”¹æ¨¡æ¿æ–‡ä»¶ï¼Œå…ˆæ‰¾åˆ°æ¨¡æ¿æ–‡ä»¶ï¼Œå†å¯¼å…¥è¿›å»ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image20" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image20.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="4-é™æ€åŒ–æµ‹è¯•"><a href="#4-é™æ€åŒ–æµ‹è¯•" class="headerlink" title="4. é™æ€åŒ–æµ‹è¯•"></a>4. é™æ€åŒ–æµ‹è¯•</h2><h3 id="1ã€å¡«å†™é¡µé¢-DataUrl"><a href="#1ã€å¡«å†™é¡µé¢-DataUrl" class="headerlink" title="1ã€å¡«å†™é¡µé¢ DataUrl"></a>1ã€å¡«å†™é¡µé¢ DataUrl</h3><p>ä¿®æ”¹é¡µé¢ç®¡ç†æ¨¡æ¿ä»£ç ï¼Œå®ç°ç¼–è¾‘é¡µé¢DataUrlã€‚<br>æ³¨æ„ï¼šæ­¤åœ°å€ç”±ç¨‹åºå‘˜æä¾›ç»™ç³»ç»Ÿç®¡ç†å‘˜ï¼Œç”±ç³»ç»Ÿç®¡ç†å‘˜å½•å…¥åˆ°ç³»ç»Ÿä¸­ã€‚</p><p><strong>ä¿®æ”¹é¡µé¢ç®¡ç†å‰ç«¯çš„ page_edit.vue</strong></p><p>åœ¨è¡¨å•ä¸­æ·»åŠ  <code>dataUrl</code> è¾“å…¥æ¡†ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"æ•°æ®Url"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"dataUrl"</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"pageForm.dataUrl"</span> <span class="hljs-attr">auto-complete</span>=<span class="hljs-string">"off"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span></code></pre></div><p><code>fromData</code> è¡¨å•å†…æ·»åŠ  <code>dataUrl</code> å­—æ®µ</p><p><strong>ä¿®æ”¹é¡µé¢ç®¡ç†æœåŠ¡ç«¯ PageService</strong></p><p>åœ¨ <code>PageService.updateCmsPage</code> æ›´æ–° <code>cmsPage</code> æ•°æ®ä»£ç ä¸­æ·»åŠ ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ›´æ–°dataUrl</span>one.setDataUrl(cmsPage.getDataUrl());</code></pre></div><p><strong>æ–°å¢é¡µé¢ä¹Ÿé‡å¤ä¸Šé¢çš„æ“ä½œï¼Œæ–°å¢ dataUrl çš„è¡¨å•</strong></p><h3 id="2ã€é™æ€åŒ–ç¨‹åº"><a href="#2ã€é™æ€åŒ–ç¨‹åº" class="headerlink" title="2ã€é™æ€åŒ–ç¨‹åº"></a>2ã€é™æ€åŒ–ç¨‹åº</h3><p>åœ¨ <code>model.response.cmscode</code> ä¸‹æ–°å¢ä¸€äº›é”™è¯¯ä»£ç </p><div class="hljs"><pre><code class="hljs java">CMS_PAGE_NOT_EXISTS(<span class="hljs-keyword">false</span>,<span class="hljs-number">24002</span>,<span class="hljs-string">"é¡µé¢ä¸å­˜åœ¨ï¼"</span>),CMS_GENRATEHTML_DATAURL_IS_NULL(<span class="hljs-keyword">false</span>,<span class="hljs-number">24003</span>,<span class="hljs-string">"ä»é¡µé¢ä¿¡æ¯ä¸­æ‰¾ä¸åˆ°è·å–æ•°æ®çš„url"</span>),CMS_GENRATEHTML_DATA_IS_NULL(<span class="hljs-keyword">false</span>,<span class="hljs-number">24004</span>,<span class="hljs-string">"æ ¹æ®é¡µé¢çš„æ•°æ®urlè·å–ä¸åˆ°æ•°æ®"</span>),CMS_GENRATEHTML_TEMPLATE_IS_NULL(<span class="hljs-keyword">false</span>,<span class="hljs-number">24005</span>,<span class="hljs-string">"é¡µé¢æ¨¡æ¿ä¸ºç©º"</span>),CMS_GENRATEHTML_HTML_IS_NULL(<span class="hljs-keyword">false</span>,<span class="hljs-number">24006</span>,<span class="hljs-string">"ç”Ÿæˆçš„é™æ€htmlä¸ºç©º"</span>),CMS_GENRATEHTML_SAVE_HTML_ERROR(<span class="hljs-keyword">false</span>,<span class="hljs-number">24007</span>,<span class="hljs-string">"ä¿å­˜é™æ€htmlå‡ºé”™"</span>),CMS_GENRATEHTML_PERVIEW_IS_NULL(<span class="hljs-keyword">false</span>,<span class="hljs-number">24008</span>,<span class="hljs-string">"é¢„è§ˆé¡µé¢ä¸ºç©º"</span>);</code></pre></div><h4 id="è·å–æ•°æ®æ¨¡å‹"><a href="#è·å–æ•°æ®æ¨¡å‹" class="headerlink" title="è·å–æ•°æ®æ¨¡å‹"></a>è·å–æ•°æ®æ¨¡å‹</h4><blockquote><p>é™æ€åŒ–ç¨‹åºè¿œç¨‹è¯·æ±‚DataUrlå¾—åˆ°æ•°æ®æ¨¡å‹</p></blockquote><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>RestTemplate restTemplate;<span class="hljs-comment">//ä»dataUrlä¸­è·å–é¡µé¢æ¨¡å‹æ•°æ®</span><span class="hljs-function"><span class="hljs-keyword">private</span> Map <span class="hljs-title">getModelByPageId</span><span class="hljs-params">(String pageId)</span></span>&#123;    <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>    CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.cmsPageQueryById(pageId);    CmsPage cmsPage = cmsPageResult.getCmsPage();    <span class="hljs-comment">//é¡µé¢ä¸å­˜åœ¨</span>    <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;        ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);    &#125;    <span class="hljs-comment">//å–å‡ºdataUrl</span>    String dataUrl = cmsPage.getDataUrl();    <span class="hljs-keyword">if</span>(StringUtils.isEmpty(dataUrl))&#123;        ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_DATAURL_IS_NULL);    &#125;    <span class="hljs-comment">//å‘é€è¯·æ±‚è·å–æ¨¡å‹æ•°æ®</span>    ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(dataUrl,Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;    Map body = forEntity.getBody();    <span class="hljs-keyword">return</span> body;&#125;</code></pre></div><h4 id="è·å–é¡µé¢æ¨¡æ¿"><a href="#è·å–é¡µé¢æ¨¡æ¿" class="headerlink" title="è·å–é¡µé¢æ¨¡æ¿"></a>è·å–é¡µé¢æ¨¡æ¿</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>CmsTemplateRepository templateRepository;<span class="hljs-meta">@Autowired</span>GridFsTemplate gridFsTemplate;<span class="hljs-meta">@Autowired</span>GridFSBucket gridFSBucket;<span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿æ•°æ®</span><span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getTemplateByPageId</span><span class="hljs-params">(String pageId)</span></span>&#123;    <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>    CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.cmsPageQueryById(pageId);    CmsPage cmsPage = cmsPageResult.getCmsPage();    <span class="hljs-comment">//é¡µé¢ä¸å­˜åœ¨</span>    <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;        ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);    &#125;    <span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿</span>    String templateId = cmsPage.getTemplateId();    <span class="hljs-keyword">if</span>(StringUtils.isEmpty(templateId))&#123;        ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_TEMPLATE_IS_NULL);    &#125;    Optional&lt;CmsTemplate&gt; optional = templateRepository.findById(templateId);    <span class="hljs-keyword">if</span>(optional.isPresent())&#123;        CmsTemplate cmsTemplate = optional.get();        <span class="hljs-comment">//è·å–æ¨¡æ¿æ–‡ä»¶id</span>        String templateFileId = cmsTemplate.getTemplateFileId();        <span class="hljs-comment">//å–å‡ºæ¨¡æ¿æ–‡ä»¶å†…å®¹</span>        GridFSFile gridFSFile = gridFsTemplate.findOne(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(templateFileId)));        <span class="hljs-comment">//æ‰“å¼€ä¸‹è½½æµå¯¹è±¡</span>        GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(gridFSFile.getObjectId());        <span class="hljs-comment">//åˆ›å»ºGridResource</span>        GridFsResource gridFsResource = <span class="hljs-keyword">new</span> GridFsResource(gridFSFile, gridFSDownloadStream);        <span class="hljs-keyword">try</span> &#123;            String content = IOUtils.toString(gridFsResource.getInputStream(), <span class="hljs-string">"utfâ€8"</span>);            <span class="hljs-keyword">return</span> content;        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;            e.printStackTrace();        &#125;    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;&#125;</code></pre></div><h4 id="æ‰§è¡Œé¡µé¢é™æ€åŒ–"><a href="#æ‰§è¡Œé¡µé¢é™æ€åŒ–" class="headerlink" title="æ‰§è¡Œé¡µé¢é™æ€åŒ–"></a>æ‰§è¡Œé¡µé¢é™æ€åŒ–</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">     * é¡µé¢é™æ€åŒ–</span><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageId</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> TemplateException</span><span class="hljs-comment">     */</span><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPageHtml</span><span class="hljs-params">(String pageId)</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;    <span class="hljs-comment">//è·å–é¡µé¢æ¨¡å‹æ•°æ®</span>    Map modelByPageId = <span class="hljs-keyword">this</span>.getModelByPageId(pageId);    <span class="hljs-keyword">if</span>(modelByPageId == <span class="hljs-keyword">null</span>)&#123;        <span class="hljs-comment">//è·å–é¡µé¢æ¨¡å‹æ•°æ®ä¸ºç©º</span>        ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_DATA_IS_NULL);    &#125;    <span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿</span>    String templateContent = getTemplateByPageId(pageId);    <span class="hljs-keyword">if</span>(StringUtils.isEmpty(templateContent))&#123;        <span class="hljs-comment">//é¡µé¢æ¨¡æ¿ä¸ºç©º</span>        ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_TEMPLATE_IS_NULL);    &#125;    <span class="hljs-comment">//è·å–é¡µé¢é™æ€åŒ–æ•°æ®</span>    String html = generateHtml(templateContent, modelByPageId);    <span class="hljs-keyword">if</span>(StringUtils.isEmpty(html))&#123;        ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_HTML_IS_NULL);    &#125;    <span class="hljs-keyword">return</span> html;&#125;<span class="hljs-comment">//æ„å»ºé™æ€åŒ–é¡µé¢æ•°æ®</span><span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">generateHtml</span><span class="hljs-params">(String template,Map model)</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;    <span class="hljs-comment">//ç”Ÿæˆé…ç½®ç±»</span>    Configuration configuration = <span class="hljs-keyword">new</span> Configuration(Configuration.getVersion());    <span class="hljs-comment">//æ¨¡æ¿åŠ è½½å™¨</span>    StringTemplateLoader stringTemplateLoader = <span class="hljs-keyword">new</span> StringTemplateLoader();    stringTemplateLoader.putTemplate(<span class="hljs-string">"template"</span>,template);    <span class="hljs-comment">//é…ç½®æ¨¡æ¿åŠ è½½å™¨</span>    configuration.setTemplateLoader(stringTemplateLoader);    <span class="hljs-comment">//è·å–æ¨¡æ¿</span>    Template template1 = configuration.getTemplate(<span class="hljs-string">"template"</span>);    String html = FreeMarkerTemplateUtils.processTemplateIntoString(template1, model);    <span class="hljs-keyword">return</span> html;&#125;</code></pre></div><p>è°ƒç”¨é€»è¾‘</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image21" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image21.png" srcset="/img/loading.gif" alt="img"></a></p><h4 id="åˆ›å»ºæµ‹è¯•çš„é¡µé¢"><a href="#åˆ›å»ºæµ‹è¯•çš„é¡µé¢" class="headerlink" title="åˆ›å»ºæµ‹è¯•çš„é¡µé¢"></a>åˆ›å»ºæµ‹è¯•çš„é¡µé¢</h4><blockquote><p>åŸè®²ä¹‰ä¸­è¯¥æ­¥éª¤æ˜¯çœç•¥çš„</p></blockquote><p>ä¸ºäº†æ›´æ¸…æ™°çš„äº†è§£é¡µé¢é™æ€åŒ–çš„é€»è¾‘ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªé¡µé¢æ¥è¿›è¡Œæµ‹è¯•ï¼›</p><p>åœ¨<code>GridFS</code> çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬åœ¨å•å…ƒæµ‹è¯•ä¸­å°† <code>index-banner.ftl</code> æ–‡ä»¶çš„å†…å®¹å‚¨å­˜åˆ°äº† <code>GridFS</code> å¾—åˆ°ä¸€ä¸ª <code>fileId</code> ï¼Œæˆ‘è¿™é‡Œçš„æ˜¯ <code>5e7a20fc3304a25230861f4c</code> ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ª<code>fileId</code> åœ¨ mongoDB çš„ <code>cms_tempalte</code> é›†åˆä¸­æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªé¡µé¢æ¨¡æ¿ï¼Œåˆ›å»ºæˆåŠŸåæˆ‘ä»¬å¾—åˆ°å¦‚ä¸‹çš„æ•°æ®</p><div class="hljs"><pre><code class="hljs json">&#123;     <span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5e7a2212b1afec2187ed89ac"</span>),     <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsTemplate"</span>,     <span class="hljs-attr">"siteId"</span> : <span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>,     <span class="hljs-attr">"templateName"</span> : <span class="hljs-string">"è½®æ’­å›¾_æµ‹è¯•"</span>,     <span class="hljs-attr">"templateParameter"</span> : <span class="hljs-string">""</span>,     <span class="hljs-attr">"templateFileId"</span> : <span class="hljs-string">"5e7a20fc3304a25230861f4c"</span>&#125;</code></pre></div><p>ç„¶åè¿›å…¥åˆ°æˆ‘ä»¬ä¹‹å‰æ„å»ºçš„æ–°å¢é¡µé¢é€‰é¡¹ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„é¡µé¢ï¼›</p><p>å¡«å…¥ dataUrl <code>http://localhost:31001/cms/config/getmodel/5a791725dd573c3574ee333f</code></p><p><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image22.png" srcset="/img/loading.gif" alt="img"></p><p>å¾—åˆ°è¯¥é¡µé¢çš„idä¸º <code>5e7a251a3304a252280804dc</code></p><h4 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span><span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestPageService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    PageService pageService;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testGetPageHtml</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;        String pageHtml = pageService.getPageHtml(<span class="hljs-string">"5e7a251a3304a252280804dc"</span>);        System.out.println(pageHtml);    &#125;&#125;</code></pre></div><h1 id="å››ã€é¡µé¢é¢„è§ˆ"><a href="#å››ã€é¡µé¢é¢„è§ˆ" class="headerlink" title="å››ã€é¡µé¢é¢„è§ˆ"></a>å››ã€é¡µé¢é¢„è§ˆ</h1><h2 id="1ã€é¡µé¢é¢„è§ˆå¼€å‘"><a href="#1ã€é¡µé¢é¢„è§ˆå¼€å‘" class="headerlink" title="1ã€é¡µé¢é¢„è§ˆå¼€å‘"></a>1ã€é¡µé¢é¢„è§ˆå¼€å‘</h2><h3 id="éœ€æ±‚åˆ†æ-1"><a href="#éœ€æ±‚åˆ†æ-1" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>é¡µé¢åœ¨å‘å¸ƒå‰å¢åŠ é¡µé¢é¢„è§ˆçš„æ­¥éª¤ï¼Œæ–¹ä¾¿ç”¨æˆ·æ£€æŸ¥é¡µé¢å†…å®¹æ˜¯å¦æ­£ç¡®ã€‚é¡µé¢é¢„è§ˆçš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image23" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image23.png" srcset="/img/loading.gif" alt="img"></a></p><p>1ã€ç”¨æˆ·è¿›å…¥ <code>cms</code> å‰ç«¯ï¼Œç‚¹å‡» â€œ<strong>é¡µé¢é¢„è§ˆ</strong>â€ åœ¨æµè§ˆå™¨è¯·æ±‚ <strong>cms</strong> é¡µé¢é¢„è§ˆé“¾æ¥ã€‚</p><p>2ã€<strong>cms</strong> æ ¹æ®é¡µé¢ <code>id</code> æŸ¥è¯¢<code>DataUrl</code>å¹¶è¿œç¨‹è¯·æ±‚DataUrlè·å–æ•°æ®æ¨¡å‹ã€‚</p><p>3ã€<strong>cms</strong> æ ¹æ®é¡µé¢idæŸ¥è¯¢é¡µé¢æ¨¡æ¿å†…å®¹</p><p>4ã€<strong>cms</strong> æ‰§è¡Œé¡µé¢é™æ€åŒ–ã€‚</p><h3 id="æ­å»ºç¯å¢ƒ"><a href="#æ­å»ºç¯å¢ƒ" class="headerlink" title="æ­å»ºç¯å¢ƒ"></a>æ­å»ºç¯å¢ƒ</h3><p>åœ¨cmsæœåŠ¡éœ€è¦é›†æˆfreemarkerï¼š</p><p>1ã€åœ¨CMSæœåŠ¡ä¸­åŠ å…¥freemarkerçš„ä¾èµ–</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--freemarker--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>2ã€åœ¨application.ymlé…ç½®freemarker</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">31001</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">xc-service-manage-cms</span>  <span class="hljs-attr">data:</span>    <span class="hljs-attr">mongodb:</span>      <span class="hljs-attr">uri:</span> <span class="hljs-string">mongodb://root:123123@localhost:27017</span>      <span class="hljs-attr">database:</span> <span class="hljs-string">xc_cms</span>  <span class="hljs-attr">freemarker:</span>    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#å…³é—­æ¨¡æ¿ç¼“å­˜ï¼Œæ–¹ä¾¿æµ‹è¯•</span>    <span class="hljs-attr">settings:</span>      <span class="hljs-attr">template_update_delay:</span> <span class="hljs-number">0</span></code></pre></div><h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>é™æ€åŒ–æ–¹æ³•åœ¨é™æ€åŒ–æµ‹è¯•ç« èŠ‚å·²ç»å®ç°</p><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><p>è°ƒç”¨ <code>service</code> çš„é™æ€åŒ–æ–¹æ³•ï¼Œå°†é™æ€åŒ–å†…å®¹é€šè¿‡ <code>response</code> è¾“å‡ºåˆ°æµè§ˆå™¨æ˜¾ç¤º</p><p>åˆ›å»º <code>CmsPagePreviewController</code> ç±»ï¼Œç”¨äºé¡µé¢é¢„è§ˆï¼š</p><p>è¯·æ±‚é¡µé¢idï¼ŒæŸ¥è¯¢å¾—åˆ°é¡µé¢çš„æ¨¡æ¿ä¿¡æ¯ã€æ•°æ®æ¨¡å‹ <code>url</code>ï¼Œæ ¹æ®æ¨¡æ¿å’Œæ•°æ®ç”Ÿæˆé™æ€åŒ–å†…å®¹ï¼Œå¹¶è¾“å‡ºåˆ°æµè§ˆå™¨ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Controller</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPagePreviewController</span>  <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseController</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    PageService pageService;    <span class="hljs-comment">//æ¥æ”¶åˆ°é¡µé¢id</span>    <span class="hljs-meta">@RequestMapping</span>(value = <span class="hljs-string">"/cms/preview/&#123;pageId&#125;"</span>, method = RequestMethod.GET)    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">preView</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"pageId"</span>)</span> String pageId) <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;        String pageHtml = pageService.getPageHtml(pageId);        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(pageHtml))&#123;            <span class="hljs-keyword">try</span> &#123;                <span class="hljs-comment">//é€šè¿‡responseå¯¹è±¡å°†é¡µé¢å†…å®¹è¾“å‡º</span>                ServletOutputStream outputStream = response.getOutputStream();                outputStream.write(pageHtml.getBytes(<span class="hljs-string">"utf-8"</span>));            &#125; <span class="hljs-keyword">catch</span> (IOException e)&#123;                e.printStackTrace();            &#125;        &#125;    &#125;&#125;</code></pre></div><h2 id="2ã€é¡µé¢é¢„è§ˆæµ‹è¯•"><a href="#2ã€é¡µé¢é¢„è§ˆæµ‹è¯•" class="headerlink" title="2ã€é¡µé¢é¢„è§ˆæµ‹è¯•"></a>2ã€é¡µé¢é¢„è§ˆæµ‹è¯•</h2><h3 id="é…ç½®nginxä»£ç†"><a href="#é…ç½®nginxä»£ç†" class="headerlink" title="é…ç½®nginxä»£ç†"></a>é…ç½®nginxä»£ç†</h3><blockquote><p>è¿™é‡Œè¯´ä¸€ä¸‹æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦é€šè¿‡nginxä»£ç†æ¥é…ç½®é¡µé¢é¢„è§ˆï¼Œå› ä¸ºåœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬çš„cmsèŠ‚ç‚¹å¯èƒ½ä¼šæœ‰å¤šä¸ªï¼Œéœ€è¦ä»nginxè¿›è¡Œåå‘ä»£ç†ï¼Œå®ç°è´Ÿè½½å‡è¡¡çš„ç­‰éœ€æ±‚ã€‚</p></blockquote><p>ä¸ºäº†é€šè¿‡ <code>nginx</code> è¯·æ±‚é™æ€èµ„æºï¼ˆ<code>css</code>ã€å›¾ç‰‡ç­‰ï¼‰ï¼Œé€šè¿‡ <code>nginx</code> ä»£ç†è¿›è¡Œé¡µé¢é¢„è§ˆã€‚</p><p>åœ¨<a href="http://www.xuecheng.xn--com:-2h5f960ibngim6ct9m7zz/">www.xuecheng.comè™šæ‹Ÿä¸»æœºé…ç½®ï¼š</a></p><div class="hljs"><pre><code class="hljs c">#é¡µé¢é¢„è§ˆlocation /cms/preview/ &#123;proxy_pass http:<span class="hljs-comment">//cms_server_pool/cms/preview/;</span>&#125;</code></pre></div><p>é…ç½® <code>cms_server_pool</code> å°†è¯·æ±‚è½¬å‘åˆ° <code>cms</code>ï¼š</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#cmsé¡µé¢é¢„è§ˆ</span>upstream cms_server_pool&#123;server <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">31001</span> weight=<span class="hljs-number">10</span>;&#125;</code></pre></div><p>å…¨éƒ¨é…ç½®</p><div class="hljs"><pre><code class="hljs c"><span class="hljs-meta">#cmsé¡µé¢é¢„è§ˆ</span>upstream cms_server_pool&#123;server <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">31001</span> weight=<span class="hljs-number">10</span>;&#125;server&#123;<span class="hljs-built_in">listen</span>       <span class="hljs-number">80</span>;server_name  www.xuecheng.com;ssi on;ssi_silent_errors on;location / &#123;alias  C:/Users/root/Desktop/ç¬”è®°/demos/JavaEE/å¾®æœåŠ¡/Project/XueChengOnline/xcEduUI01/xc-ui-pc-<span class="hljs-keyword">static</span>-portal/;index  index.html;&#125;#é¡µé¢é¢„è§ˆlocation /cms/preview/ &#123;proxy_pass http:<span class="hljs-comment">//cms_server_pool/cms/preview/;</span>&#125;&#125;</code></pre></div><p>é‡æ–°åŠ è½½nginx é…ç½®æ–‡ä»¶ã€‚<br>ä»cms_pageæ‰¾ä¸€ä¸ªé¡µé¢è¿›è¡Œæµ‹è¯•ã€‚æ³¨æ„ï¼šé¡µé¢é…ç½®ä¸€å®šè¦æ­£ç¡®ï¼Œéœ€è®¾ç½®æ­£ç¡®çš„æ¨¡æ¿ <code>id</code> å’Œ<code>dataUrl</code>ã€‚</p><p>åœ¨æµè§ˆå™¨æ‰“å¼€ï¼š<a href="http://www.xuecheng.com/cms/preview/5e7a251a3304a252280804dc" target="_blank" rel="noopener">http://www.xuecheng.com/cms/preview/5e7a251a3304a252280804dc</a></p><p>5e7a251a3304a252280804dcï¼šè½®æ’­å›¾é¡µé¢çš„id ï¼ˆæ ¹æ®è‡ªå·±å®é™…ç”¨äºæµ‹è¯•çš„é¡µé¢IDï¼‰</p><p><a href="https://qnoss.codeyee.com/20200704_xuechengday04/image24" target="_blank" rel="noopener"><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image24.png" srcset="/img/loading.gif" alt="img"></a></p><h3 id="æ·»åŠ -â€œé¡µé¢é¢„è§ˆâ€-é“¾æ¥"><a href="#æ·»åŠ -â€œé¡µé¢é¢„è§ˆâ€-é“¾æ¥" class="headerlink" title="æ·»åŠ  â€œé¡µé¢é¢„è§ˆâ€ é“¾æ¥"></a>æ·»åŠ  â€œé¡µé¢é¢„è§ˆâ€ é“¾æ¥</h3><p>æ·»åŠ é¢„è§ˆæŒ‰é’®</p><div class="hljs"><pre><code class="hljs java"> &lt;el-table-column label=<span class="hljs-string">"æ“ä½œ"</span> width=<span class="hljs-string">"230"</span> fixed=<span class="hljs-string">"right"</span>&gt;    &lt;template slot-scope=<span class="hljs-string">"scope"</span>&gt;        &lt;el-button        size=<span class="hljs-string">"mini"</span>        type=<span class="hljs-string">"success"</span>        <span class="hljs-meta">@click</span>=<span class="hljs-string">"preview(scope.row.pageId)"</span>&gt;é¢„è§ˆ        &lt;/el-button&gt;    &lt;/template&gt;&lt;/el-table-column&gt;</code></pre></div><p>é¢„è§ˆå‡½æ•°</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//é¡µé¢é¢„è§ˆ</span>preview(pageId)&#123;  <span class="hljs-built_in">window</span>.open(<span class="hljs-string">"http://www.xuecheng.com/cms/preview/"</span>+pageId)&#125;,</code></pre></div><p>æµ‹è¯•</p><p><img src="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/image25.gif" srcset="/img/loading.gif" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>GridFS</tag>
      
      <tag>Freemarker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day03ï¼šCMSé¡µé¢ç®¡ç†å¼€å‘</title>
    <link href="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/"/>
    <url>/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day03</code> çš„å†…å®¹</p><ul><li>ä½¿ç”¨ <code>Spring data</code> æä¾›çš„ <code>PageRequest</code> æ¨¡å—è¿›è¡Œåˆ†é¡µæŸ¥è¯¢çš„åº”ç”¨</li><li>ä½¿ç”¨ <code>Spring data</code> æä¾› <code>MongoDB</code> çš„daoæ¥å£è¿›è¡Œå‰åç«¯è”è°ƒçš„ CRUD æ“ä½œ</li><li>åŸºäº <code>VUE.JS</code> çš„å‰ç«¯æ¨¡å—åŒ–å¼€å‘</li><li>ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ¨¡å‹ã€çŠ¶æ€ç è¿›è¡Œ <code>RESTful</code> é£æ ¼çš„APIå¼€å‘</li><li>ç†Ÿæ‚‰ä½¿ç”¨ <code>Swagger</code> è¿›è¡Œæ¥å£æ–‡æ¡£çš„ç”Ÿæˆä¸æµ‹è¯•</li><li>å¼‚å¸¸å¤„ç†ä»¥åŠå¦‚ä½•è‡ªå®šä¹‰å¼‚å¸¸ï¼Œæ ¹æ®ä¸åŒçš„å¼‚å¸¸è‡ªå®šä¹‰è¿”å›çš„æ¶ˆæ¯æ ¼å¼ã€‚</li></ul><h1 id="ä¸€ã€è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢"><a href="#ä¸€ã€è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="ä¸€ã€è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢"></a>ä¸€ã€è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åœ¨é¡µé¢è¾“å…¥æŸ¥è¯¢æ¡ä»¶ï¼ŒæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„é¡µé¢ä¿¡æ¯ã€‚</p><p>æŸ¥è¯¢æ¡ä»¶å¦‚ä¸‹ï¼š</p><p>ç«™ç‚¹Idï¼šç²¾ç¡®åŒ¹é…</p><p>æ¨¡æ¿Idï¼šç²¾ç¡®åŒ¹é…</p><p>é¡µé¢åˆ«åï¼šæ¨¡ç³ŠåŒ¹é…</p><h2 id="2-æœåŠ¡ç«¯"><a href="#2-æœåŠ¡ç«¯" class="headerlink" title="2.æœåŠ¡ç«¯"></a>2.æœåŠ¡ç«¯</h2><h3 id="Daoå±‚"><a href="#Daoå±‚" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h3><p>ä½¿ç”¨ <code>CmsPageRepository</code> ä¸­çš„ <code>findAll(Example&lt;S&gt; var1, Pageable var2)</code> æ–¹æ³•å®ç°ï¼Œæ— éœ€å®šä¹‰ã€‚</p><h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><p>ä¸‹è¾¹æµ‹è¯•findAllæ–¹æ³•å®ç°è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢ï¼š</p><p>1ã€æŒ‡å®šç«™ç‚¹idã€æ¨¡æ¿idä½œä¸ºæŸ¥è¯¢æ¡ä»¶</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDiyFindAll</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-comment">//ç²¾ç¡®åŒ¹é…æ¡ä»¶å€¼</span>    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();    cmsPage.setSiteId(<span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>);    cmsPage.setTemplateId(<span class="hljs-string">"5a925be7b00ffc4b3c1578b5"</span>);    <span class="hljs-comment">//æ¡ä»¶åŒ¹é…å™¨,ç”¨äºæ¨¡ç³ŠåŒ¹é…</span>    ExampleMatcher matching = ExampleMatcher.matching();    <span class="hljs-comment">//æ¡ä»¶æŸ¥è¯¢å®ä¾‹</span>    Example&lt;CmsPage&gt; example = Example.of(cmsPage, matching);    <span class="hljs-comment">//åˆ†é¡µå‚æ•°</span>    <span class="hljs-keyword">int</span> page = <span class="hljs-number">0</span>;    <span class="hljs-keyword">int</span> size = <span class="hljs-number">20</span>;    Pageable pageable = PageRequest.of(page,size);    <span class="hljs-comment">//è°ƒç”¨dao</span>    Page&lt;CmsPage&gt; all = cmsPageRepository.findAll(example, pageable);    List&lt;CmsPage&gt; content = all.getContent();    System.out.println(content);&#125;</code></pre></div><p>æŸ¥è¯¢ç»“æœ</p><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image1.png" srcset="/img/loading.gif" alt></p><p>åœ¨ä¸Šé¢çš„ä»£ç åŸºç¡€ä¸Šï¼Œå¢åŠ  <code>ExampleMatcher</code> å®ä¾‹çš„ä¸€äº›å±æ€§ä½œä¸ºæ¨¡ç³ŠæŸ¥è¯¢çš„å‚æ•°ï¼Œå¢åŠ çš„ä»£ç å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs java">cmsPage.setPageAliase(<span class="hljs-string">"è¯¦ç»†"</span>);<span class="hljs-comment">//æ¡ä»¶åŒ¹é…å™¨,ç”¨äºæ¨¡ç³ŠåŒ¹é…</span>ExampleMatcher matching = ExampleMatcher.matching()       .withMatcher(<span class="hljs-string">"pageAliase"</span>,ExampleMatcher.GenericPropertyMatchers.contains());</code></pre></div><p><code>.withMatcher</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºè¦å°†å“ªä¸ªå­—æ®µè¿›è¡ŒåŒ¹é…ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯è¦ä½¿ç”¨çš„åŒ¹é…å™¨ï¼›</p><p><code>ExampleMatcher.GenericPropertyMatchers</code> æœ‰å¤šä¸ªåŒ¹é…å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨ <code>.contains()</code> è¿›è¡Œæ¨¡ç³ŠåŒ¹é…</p><p><a href="https://qnoss.codeyee.com/20200704_3/image2" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image2.png" srcset="/img/loading.gif" alt="img"></a></p><h3 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>CmsPageRepository cmsPageRepository;<span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ†é¡µæŸ¥è¯¢</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page é¡µå·</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> size æ¯é¡µå¤§å°</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> queryPageRequest æŸ¥è¯¢æ¡ä»¶</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page,<span class="hljs-keyword">int</span> size,QueryPageRequest queryPageRequest)</span> </span>&#123;    <span class="hljs-comment">//åˆ¤æ–­æ¡ä»¶å¯¹è±¡æ˜¯å¦ä¸ºç©º</span>    <span class="hljs-keyword">if</span>(queryPageRequest == <span class="hljs-keyword">null</span>)&#123;        queryPageRequest = <span class="hljs-keyword">new</span> QueryPageRequest();    &#125;    <span class="hljs-comment">//åŒ¹é…æ¡ä»¶å€¼</span>    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();    <span class="hljs-comment">//è®¾ç½®æ¡ä»¶å€¼</span>    <span class="hljs-comment">//ç«™ç‚¹ID</span>    <span class="hljs-keyword">if</span>(!StringUtil.isNullOrEmpty(queryPageRequest.getSiteId()))&#123;        cmsPage.setSiteId(queryPageRequest.getSiteId());    &#125;    <span class="hljs-comment">//æ¨¡æ¿ID</span>    <span class="hljs-keyword">if</span>(!StringUtil.isNullOrEmpty(queryPageRequest.getTemplateId()))&#123;        cmsPage.setTemplateId(queryPageRequest.getTemplateId());    &#125;    <span class="hljs-comment">//ç«™ç‚¹åˆ«å</span>    <span class="hljs-keyword">if</span>(!StringUtil.isNullOrEmpty(queryPageRequest.getPageAliase()))&#123;        cmsPage.setPageAliase(queryPageRequest.getPageAliase());    &#125;    <span class="hljs-comment">//æ¡ä»¶åŒ¹é…å™¨ï¼Œç”¨äºæ¨¡ç³ŠæŸ¥è¯¢</span>    ExampleMatcher exampleMatcher = ExampleMatcher.matching()            .withMatcher(<span class="hljs-string">"pageAliase"</span>, ExampleMatcher.GenericPropertyMatchers.contains());    <span class="hljs-comment">//æ¡ä»¶æŸ¥è¯¢å®ä¾‹</span>    Example&lt;CmsPage&gt; example = Example.of(cmsPage, exampleMatcher);    <span class="hljs-comment">//è¿‡æ»¤æ¡ä»¶</span>    <span class="hljs-keyword">if</span>(page &lt;= <span class="hljs-number">0</span>)&#123;        page = <span class="hljs-number">1</span>;    &#125;    <span class="hljs-keyword">if</span>(size &lt;= <span class="hljs-number">0</span>)&#123;        size = <span class="hljs-number">10</span>;    &#125;    page = page - <span class="hljs-number">1</span>;    <span class="hljs-comment">//åˆ›å»ºåˆ†é¡µæŸ¥è¯¢å‚æ•°</span>    PageRequest pageable = PageRequest.of(page, size);    <span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢æ•°æ®</span>    Page&lt;CmsPage&gt; all = cmsPageRepository.findAll(example, pageable);    <span class="hljs-comment">//æ•´ç†æŸ¥è¯¢åˆ°çš„æ•°æ®</span>    QueryResult queryResult = <span class="hljs-keyword">new</span> QueryResult();    queryResult.setList(all.getContent());    queryResult.setTotal(all.getTotalElements());    <span class="hljs-comment">//è¿”å›ç»“æœ</span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult(CommonCode.SUCCESS,queryResult);&#125;</code></pre></div><p>Controllerå±‚æ— éœ€ä¿®æ”¹</p><h3 id="ä½¿ç”¨SwaggerUIæµ‹è¯•"><a href="#ä½¿ç”¨SwaggerUIæµ‹è¯•" class="headerlink" title="ä½¿ç”¨SwaggerUIæµ‹è¯•"></a>ä½¿ç”¨SwaggerUIæµ‹è¯•</h3><p>å‚æ•°</p><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image3.png" srcset="/img/loading.gif" alt="img"></p><p>æŸ¥è¯¢ç»“æœ</p><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image4.png" srcset="/img/loading.gif" alt="img"></p><p>ä»æŸ¥è¯¢ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ ¹æ®æˆ‘ä»¬è¾“å…¥çš„æ¡ä»¶ï¼ŒæŸ¥è¯¢åˆ°äº†æŒ‡å®š <code>sizeId</code> å¹¶ä¸” <code>pageAliase</code> åŒ…å«é¢„è§ˆçš„ä¿¡æ¯ã€‚</p><h2 id="3-å‰ç«¯"><a href="#3-å‰ç«¯" class="headerlink" title="3. å‰ç«¯"></a>3. å‰ç«¯</h2><h3 id="é¡µé¢"><a href="#é¡µé¢" class="headerlink" title="é¡µé¢"></a>é¡µé¢</h3><p>1ã€å¢åŠ æŸ¥è¯¢è¡¨å•</p><blockquote><p>åœ¨el-tableä¸Šæ–¹æ·»åŠ è¯¥è¡¨å•</p></blockquote><div class="hljs"><pre><code class="hljs vue">&lt;!--æŸ¥è¯¢è¡¨å•--&gt;&lt;el-form :model&#x3D;&quot;params&quot;&gt;  &lt;el-select v-model&#x3D;&quot;params.siteId&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©ç«™ç‚¹&quot;&gt;    &lt;el-option    v-for&#x3D;&quot;item in siteList&quot;    :key&#x3D;&quot;item.siteId&quot;    :label&#x3D;&quot;item.siteName&quot;    :value&#x3D;&quot;item.siteId&quot;&gt;    &lt;&#x2F;el-option&gt;  &lt;&#x2F;el-select&gt;  é¡µé¢åˆ«å: &lt;el-input v-model&#x3D;&quot;params.pageAliase&quot; style&#x3D;&quot;width: 100px&quot;&gt;&lt;&#x2F;el-input&gt;&lt;el-button type&#x3D;&quot;primary&quot; v-on:click&#x3D;&quot;query&quot; size&#x3D;&quot;small&quot;&gt;æŸ¥è¯¢&lt;&#x2F;el-button&gt;&lt;&#x2F;el-form&gt;</code></pre></div><p>2ã€æ–°å¢æ•°æ®æ¨¡å‹å¯¹è±¡</p><div class="hljs"><pre><code class="hljs js">data() &#123;  <span class="hljs-keyword">return</span> &#123;    siteList:[],<span class="hljs-comment">//ç«™ç‚¹åˆ—è¡¨</span>    list:[],    total:<span class="hljs-number">0</span>,    params:&#123;      siteId:<span class="hljs-string">''</span>,      pageAliase:<span class="hljs-string">''</span>,      page:<span class="hljs-number">1</span>,<span class="hljs-comment">//é¡µç </span>      size:<span class="hljs-number">10</span><span class="hljs-comment">//æ¯é¡µæ˜¾ç¤ºä¸ªæ•°</span>    &#125;  &#125;&#125;,</code></pre></div><p>3ã€åœ¨é’©å­æ–¹æ³•ä¸­ è·å– <code>siteList</code> ç«™ç‚¹åˆ—è¡¨ï¼ˆè¿™é‡Œæš‚æ—¶ç”¨é™æ€æ•°æ®ä»£æ›¿ï¼‰</p><div class="hljs"><pre><code class="hljs js">mounted() &#123;  <span class="hljs-comment">//é»˜è®¤æŸ¥è¯¢é¡µé¢</span>  <span class="hljs-keyword">this</span>.query()  <span class="hljs-comment">//åˆå§‹åŒ–ç«™ç‚¹åˆ—è¡¨</span>  <span class="hljs-keyword">this</span>.siteList = [    &#123;      siteId:<span class="hljs-string">'5a751fab6abb5044e0d19ea1'</span>,      siteName:<span class="hljs-string">'é—¨æˆ·ä¸»ç«™'</span>    &#125;,    &#123;      siteId:<span class="hljs-string">'102'</span>,      siteName:<span class="hljs-string">'æµ‹è¯•ç«™'</span>    &#125;  ]&#125;,</code></pre></div><h3 id="APIè°ƒç”¨"><a href="#APIè°ƒç”¨" class="headerlink" title="APIè°ƒç”¨"></a>APIè°ƒç”¨</h3><p>1ã€å‘æœåŠ¡ç«¯ä¼ é€’æŸ¥è¯¢æ¡ä»¶ï¼Œä¿®æ”¹ cms.jsï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//publicæ˜¯å¯¹axiosçš„å·¥å…·ç±»å°è£…ï¼Œå®šä¹‰äº†httpè¯·æ±‚æ–¹æ³•</span><span class="hljs-keyword">import</span> http from <span class="hljs-string">'./../../../base/api/public'</span>  <span class="hljs-comment">//ES6 å¯¼å…¥</span><span class="hljs-keyword">import</span> querystring from <span class="hljs-string">"querystring"</span>let sysConfig = require(<span class="hljs-string">'@/../config/sysConfig'</span>)let apiUrl = sysConfig.xcApiUrlPre<span class="hljs-comment">//é¡µé¢æŸ¥è¯¢</span>export <span class="hljs-keyword">const</span> page_list = (page,size,params) =&gt; &#123;  <span class="hljs-comment">//å°†jsonå¯¹è±¡è½¬æˆkey/valueå¯¹</span>  let queryString = querystring.stringify(params);  <span class="hljs-comment">//å®šä¹‰æ–¹æ³•ï¼Œè¯·æ±‚æœåŠ¡ç«¯æŸ¥è¯¢æ¥å£</span>  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl + <span class="hljs-string">'/cms/page/list/'</span>+page+<span class="hljs-string">'/'</span>+ size +<span class="hljs-string">'?'</span> + queryString)&#125;</code></pre></div><p>2ã€é¡µé¢è°ƒç”¨apiæ–¹æ³•</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æŸ¥è¯¢</span>query:function () &#123;  <span class="hljs-comment">//è°ƒç”¨æœåŠ¡ç«¯æ¥å£</span>  cmsApi.page_list(<span class="hljs-keyword">this</span>.params.page, <span class="hljs-keyword">this</span>.params.size, <span class="hljs-keyword">this</span>.params).then((res) =&gt;&#123;    console.log(res)    <span class="hljs-comment">//å°†resç»“æœæ•°æ®èµ‹å€¼ç»™æ•°æ®æ¨¡å‹å¯¹è±¡</span>    <span class="hljs-keyword">this</span>.list = res.queryResult.list    <span class="hljs-keyword">this</span>.total = res.queryResult.total  &#125;)&#125;</code></pre></div><p>3ã€æµ‹è¯•</p><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image5.png" srcset="/img/loading.gif" alt="img"></p><h1 id="äºŒã€æ–°å¢é¡µé¢"><a href="#äºŒã€æ–°å¢é¡µé¢" class="headerlink" title="äºŒã€æ–°å¢é¡µé¢"></a>äºŒã€æ–°å¢é¡µé¢</h1><h2 id="1-å‡†å¤‡å·¥ä½œï¼Œé¡µé¢ç®¡ç†API"><a href="#1-å‡†å¤‡å·¥ä½œï¼Œé¡µé¢ç®¡ç†API" class="headerlink" title="1.å‡†å¤‡å·¥ä½œï¼Œé¡µé¢ç®¡ç†API"></a>1.å‡†å¤‡å·¥ä½œï¼Œé¡µé¢ç®¡ç†API</h2><p>åœ¨é…ç½®æ–°å¢é¡µé¢çš„åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆé…ç½®ä¸€ä¸ªæ¥å£ï¼Œç”¨äºè·å–é¡µé¢çš„ä¿¡æ¯</p><h3 id="Daoå±‚-1"><a href="#Daoå±‚-1" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h3><p>CmsPageRepository</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * ç»§æ‰¿MongoDBè‡ªå¸¦çš„Repository</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  22:36</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsPage</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div><h3 id="å®šä¹‰æŸ¥è¯¢æ¨¡å‹"><a href="#å®šä¹‰æŸ¥è¯¢æ¨¡å‹" class="headerlink" title="å®šä¹‰æŸ¥è¯¢æ¨¡å‹"></a>å®šä¹‰æŸ¥è¯¢æ¨¡å‹</h3><p>QueryPageRequest</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.cms.request;<span class="hljs-keyword">import</span> io.swagger.annotations.ApiModelProperty;<span class="hljs-keyword">import</span> lombok.Data;<span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  21:13</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Data</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryPageRequest</span> </span>&#123;    <span class="hljs-comment">//æ¥æ”¶é¡µé¢æŸ¥è¯¢çš„æŸ¥è¯¢æ¡ä»¶</span>    <span class="hljs-comment">//ç«™ç‚¹id</span>    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"ç«™ç‚¹id"</span>)    <span class="hljs-keyword">private</span> String siteId;    <span class="hljs-comment">//é¡µé¢id</span>    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"é¡µé¢id"</span>)    <span class="hljs-keyword">private</span> String pageId;    <span class="hljs-comment">//é¡µé¢åç§°</span>    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"é¡µé¢åç§°"</span>)    <span class="hljs-keyword">private</span> String pageName;    <span class="hljs-comment">//åˆ«å</span>    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"åˆ«å"</span>)    <span class="hljs-keyword">private</span> String pageAliase;    <span class="hljs-comment">//æ¨¡æ¿id</span>    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"æ¨¡æ¿id"</span>)    <span class="hljs-keyword">private</span> String templateId;    <span class="hljs-comment">//...</span>&#125;</code></pre></div><h3 id="å®šä¹‰å“åº”æ¨¡å‹"><a href="#å®šä¹‰å“åº”æ¨¡å‹" class="headerlink" title="å®šä¹‰å“åº”æ¨¡å‹"></a>å®šä¹‰å“åº”æ¨¡å‹</h3><p>CmsPageResult</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPageResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;    CmsPage cmsPage;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CmsPageResult</span><span class="hljs-params">(ResultCode resultCode,CmsPage cmsPage)</span> </span>&#123;        <span class="hljs-keyword">super</span>(resultCode);        <span class="hljs-keyword">this</span>.cmsPage = cmsPage;    &#125;&#125;</code></pre></div><h3 id="Serviceå±‚-1"><a href="#Serviceå±‚-1" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h3><p>PageService</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CmsPageRepository cmsPageRepository;    &#125;</code></pre></div><h3 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h3><p>å®šä¹‰é¡µé¢ç›¸å…³æ“ä½œçš„api</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  21:16</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Api</span>(value = <span class="hljs-string">"cmsé¡µé¢ç®¡ç†æ¥å£"</span>,description = <span class="hljs-string">"cmsé¡µé¢ç®¡ç†æ¥å£ï¼Œæä¾›é¡µé¢çš„å¢ï¼Œåˆ ï¼Œæ”¹ï¼ŒæŸ¥"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageControllerApi</span> </span>&#123;    <span class="hljs-comment">//é¡µé¢æŸ¥è¯¢</span>    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"åˆ†é¡µæŸ¥è¯¢é¡µé¢åˆ—è¡¨"</span>)    <span class="hljs-meta">@ApiImplicitParams</span>(&#123;            <span class="hljs-meta">@ApiImplicitParam</span>(name = <span class="hljs-string">"page"</span>,value = <span class="hljs-string">"é¡µç "</span>,required = <span class="hljs-keyword">true</span>,paramType = <span class="hljs-string">"path"</span>,dataType = <span class="hljs-string">"int"</span>),            <span class="hljs-meta">@ApiImplicitParam</span>(name = <span class="hljs-string">"size"</span>,value = <span class="hljs-string">"æ¯é¡µè®°å½•æ•°"</span>,required = <span class="hljs-keyword">true</span>,paramType = <span class="hljs-string">"path"</span>,dataType = <span class="hljs-string">"int"</span>)    &#125;)    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, QueryPageRequest queryPageRequest)</span></span>; &#125;</code></pre></div><p>CmsPageController</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.controller;<span class="hljs-keyword">import</span> com.xuecheng.api.cms.CmsPageControllerApi;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.request.QueryPageRequest;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.response.CmsPageResult;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResponseResult;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.service.PageService;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  22:04</span><span class="hljs-comment"> */</span><span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/cms/page"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPageController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CmsPageControllerApi</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    PageService pageService;        <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/list/&#123;page&#125;/&#123;size&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"page"</span>)</span> <span class="hljs-keyword">int</span> page, </span><span class="hljs-function">               @<span class="hljs-title">PathVariable</span><span class="hljs-params">(<span class="hljs-string">"size"</span>)</span> <span class="hljs-keyword">int</span> size, QueryPageRequest queryPageRequest) </span>&#123;                   QueryResponseResult responseResult = pageService.findList(page, size, queryPageRequest);        <span class="hljs-keyword">return</span> responseResult;    &#125;</code></pre></div><p>æµ‹è¯•</p><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image6.png" srcset="/img/loading.gif" alt="img"></p><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image7.png" srcset="/img/loading.gif" alt="img"></p><h2 id="2-åç«¯æ¥å£å®šä¹‰"><a href="#2-åç«¯æ¥å£å®šä¹‰" class="headerlink" title="2.åç«¯æ¥å£å®šä¹‰"></a>2.åç«¯æ¥å£å®šä¹‰</h2><h3 id="1ã€å®šä¹‰å“åº”æ¨¡å‹"><a href="#1ã€å®šä¹‰å“åº”æ¨¡å‹" class="headerlink" title="1ã€å®šä¹‰å“åº”æ¨¡å‹"></a>1ã€å®šä¹‰å“åº”æ¨¡å‹</h3><blockquote><p>ç”¨äºæ¥å£çš„å“åº”è§„èŒƒï¼Œç»§æ‰¿äºé¡¹ç›®ä¸­çš„ResponseResult</p></blockquote><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPageResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;    CmsPage cmsPage;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CmsPageResult</span><span class="hljs-params">(ResultCode resultCode,CmsPage cmsPage)</span> </span>&#123;        <span class="hljs-keyword">super</span>(resultCode);        <span class="hljs-keyword">this</span>.cmsPage = cmsPage;&#125;&#125;</code></pre></div><h3 id="2ã€å®šä¹‰æ·»åŠ Api"><a href="#2ã€å®šä¹‰æ·»åŠ Api" class="headerlink" title="2ã€å®šä¹‰æ·»åŠ Api"></a>2ã€å®šä¹‰æ·»åŠ Api</h3><p>åœ¨ <code>CmsPageControllerApi</code> ä¸­æ–°å¢ <code>addCmsPage</code> æ¥å£</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ·»åŠ é¡µé¢æ•°æ®</span><span class="hljs-comment"> */</span><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æ·»åŠ é¡µé¢æ•°æ®"</span>)<span class="hljs-meta">@ApiImplicitParams</span>(&#123;        <span class="hljs-meta">@ApiImplicitParam</span>(name=<span class="hljs-string">"cmsPage"</span>,value = <span class="hljs-string">"è¯·æäº¤jsonå½¢å¼çš„é¡µé¢æ•°æ®"</span>,required=<span class="hljs-keyword">true</span>,paramType=<span class="hljs-string">"CmsPage"</span>,dataType=<span class="hljs-string">"CmsPage"</span>),&#125;)<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span></span>;</code></pre></div><h2 id="3-æœåŠ¡ç«¯å¼€å‘"><a href="#3-æœåŠ¡ç«¯å¼€å‘" class="headerlink" title="3. æœåŠ¡ç«¯å¼€å‘"></a>3. æœåŠ¡ç«¯å¼€å‘</h2><h3 id="1ã€é¡µé¢å”¯ä¸€å€¼ç´¢å¼•"><a href="#1ã€é¡µé¢å”¯ä¸€å€¼ç´¢å¼•" class="headerlink" title="1ã€é¡µé¢å”¯ä¸€å€¼ç´¢å¼•"></a>1ã€é¡µé¢å”¯ä¸€å€¼ç´¢å¼•</h3><blockquote><p>ä¸ºäº†ä¿è¯ç«™ç‚¹çš„å”¯ä¸€æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ ¹æ® sizeIdã€pageNameã€pageWebPath è¿™ä¸‰ä¸ªå­—æ®µæ¥å†³å®šç«™ç‚¹çš„æ•°æ®æ˜¯å¦å”¯ä¸€ã€‚</p></blockquote><p>å³é”® <code>cms_page</code> é›†åˆï¼Œé€‰æ‹© <code>Add Index</code> æ·»åŠ ä¸€ä¸ªç´¢å¼•</p><p><a href="https://qnoss.codeyee.com/20200704_3/image8" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image8.png" srcset="/img/loading.gif" alt="img"></a></p><p>æ ¹æ®ä¸‹å›¾æ‰€ç¤ºï¼Œç‚¹å‡» <code>Add Field</code> æŒ‰é’®ï¼Œé€‰æ‹© sizeIdã€pageNameã€pageWebPath è¿™ä¸‰ä¸ªå­—æ®µï¼Œç„¶åç‚¹å‡»æ·»åŠ ï¼Œé€‰æ‹©ç¬¬ä¸‰æ­¥æ‰€ç¤ºçš„ <code>Unique</code>ï¼Œæœ€åç‚¹å‡»å³è¾¹çš„ <code>Create Index</code> åˆ›å»ºç´¢å¼•ã€‚</p><p><a href="https://qnoss.codeyee.com/20200704_3/image9" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image9.png" srcset="/img/loading.gif" alt="img"></a></p><p>åˆ›å»ºæˆåŠŸå</p><p><a href="https://qnoss.codeyee.com/20200704_3/image10" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image10.png" srcset="/img/loading.gif" alt="img"></a></p><h3 id="2ã€Daoå±‚"><a href="#2ã€Daoå±‚" class="headerlink" title="2ã€Daoå±‚"></a>2ã€Daoå±‚</h3><p>1ã€æ·»åŠ æ ¹æ®é¡µé¢åç§°ã€ç«™ç‚¹Idã€é¡µé¢webpathæŸ¥è¯¢é¡µé¢æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ç”¨äºæ ¡éªŒé¡µé¢æ˜¯å¦å­˜åœ¨</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ ¹æ®ç«™ç‚¹idã€ç«™ç‚¹åç§°ã€ç«™ç‚¹è·¯å¾„æ¥æŸ¥è¯¢ç«™ç‚¹ä¿¡æ¯</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> siteId</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageName</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageWebPath</span><span class="hljs-comment"> */</span><span class="hljs-function">CmsPage <span class="hljs-title">findBySiteIdAndPageNameAndPageWebPath</span><span class="hljs-params">(String siteId, String pageName, String pageWebPath)</span></span>;</code></pre></div><p>2ã€ä½¿ç”¨ CmsPageRepositoryæä¾›çš„saveæ–¹æ³• ã€‚</p><h3 id="3ã€Serviceå±‚"><a href="#3ã€Serviceå±‚" class="headerlink" title="3ã€Serviceå±‚"></a>3ã€Serviceå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ·»åŠ é¡µé¢æ•°æ®</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span></span>&#123;    <span class="hljs-comment">//éªŒè¯æ•°æ®å”¯ä¸€æ€§ï¼šsizeIdã€pageNameã€pageWebPath</span>    CmsPage cmsPage1 = cmsPageRepository.findBySiteIdAndPageNameAndPageWebPath(cmsPage.getSiteId(), cmsPage.getPageName(), cmsPage.getPageWebPath());    <span class="hljs-keyword">if</span>(cmsPage1 == <span class="hljs-keyword">null</span>)&#123;        <span class="hljs-comment">//ç«™ç‚¹idç”±mongoDBè‡ªåŠ¨ç”Ÿæˆï¼Œé˜²æ­¢å‰ç«¯ä¼ å€¼</span>        cmsPage.setPageId(<span class="hljs-keyword">null</span>);        CmsPage save = cmsPageRepository.save(cmsPage);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS,save);    &#125;    <span class="hljs-comment">//æ·»åŠ å¤±è´¥</span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL,cmsPage);&#125;</code></pre></div><h3 id="4ã€Controllerå±‚"><a href="#4ã€Controllerå±‚" class="headerlink" title="4ã€Controllerå±‚"></a>4ã€Controllerå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/add"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(@RequestBody CmsPage cmsPage)</span> </span>&#123;    <span class="hljs-keyword">return</span> pageService.addCmsPage(cmsPage);&#125;</code></pre></div><h3 id="5ã€æ¥å£æµ‹è¯•"><a href="#5ã€æ¥å£æµ‹è¯•" class="headerlink" title="5ã€æ¥å£æµ‹è¯•"></a>5ã€æ¥å£æµ‹è¯•</h3><p>æˆ‘ä»¬åœ¨ <code>swagger</code> è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£æ¥å£ä¸­è¿›è¡Œæµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_3/image11" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image11.png" srcset="/img/loading.gif" alt="img"></a></p><p>ç¬¬ä¸€æ¬¡æ·»åŠ ï¼Œæ·»åŠ æˆåŠŸ</p><p><a href="https://qnoss.codeyee.com/20200704_3/image12" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image12.png" srcset="/img/loading.gif" alt="img"></a></p><p>ç¬¬äºŒæ¬¡æ·»åŠ é‡å¤çš„å†…å®¹ï¼Œç”±äºå”¯ä¸€æ€§çš„æ•ˆéªŒï¼Œè¿”å›æ·»åŠ å¤±è´¥</p><p><a href="https://qnoss.codeyee.com/20200704_3/image13" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image13.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="4-å‰ç«¯å¼€å‘"><a href="#4-å‰ç«¯å¼€å‘" class="headerlink" title="4. å‰ç«¯å¼€å‘"></a>4. å‰ç«¯å¼€å‘</h2><h3 id="æ„å»ºæ–°å¢é¡µé¢"><a href="#æ„å»ºæ–°å¢é¡µé¢" class="headerlink" title="æ„å»ºæ–°å¢é¡µé¢"></a>æ„å»ºæ–°å¢é¡µé¢</h3><h4 id="1ã€é¡µé¢åˆ›å»º"><a href="#1ã€é¡µé¢åˆ›å»º" class="headerlink" title="1ã€é¡µé¢åˆ›å»º"></a>1ã€é¡µé¢åˆ›å»º</h4><p>ä½¿ç”¨Element-UIçš„formç»„ä»¶ç¼–å†™æ·»åŠ è¡¨å•å†…å®¹ï¼Œé¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image14.png" srcset="/img/loading.gif" alt="img"></p><p><strong>1ï¼‰åˆ›å»ºé¡µé¢</strong></p><p>åˆ›å»ºpage_add.vueé¡µé¢</p><p><strong>2ï¼‰é…ç½®è·¯ç”±</strong></p><p>åœ¨cmsæ¨¡å—çš„è·¯ç”±æ–‡ä»¶ä¸­é…ç½®â€œæ·»åŠ é¡µé¢â€çš„è·¯ç”±ï¼š</p><div class="hljs"><pre><code class="hljs vue">&#123;path:&#39;&#x2F;cms&#x2F;page&#x2F;add&#39;,name:&#39;æ–°å¢é¡µé¢&#39;,component: page_add,hidden:true&#125;</code></pre></div><p>æ³¨æ„ï¼šç”±äº â€œæ·»åŠ é¡µé¢â€ ä¸éœ€è¦æ˜¾ç¤ºä¸ºä¸€ä¸ªèœå•ï¼Œè¿™é‡Œ <code>hidden</code> è®¾ç½®ä¸º <code>true</code> éšè—èœå•ã€‚</p><p>æµ‹è¯•ï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥<a href="http://localhost:11000/#/cms/page/add" target="_blank" rel="noopener">http://localhost:11000/#/cms/page/add</a></p><p><strong>3ï¼‰â€œæ·»åŠ é¡µé¢â€ çš„æŒ‰é’®</strong></p><p>å®é™…æƒ…å†µæ˜¯ç”¨æˆ·è¿›å…¥é¡µé¢æŸ¥è¯¢åˆ—è¡¨ï¼Œç‚¹å‡»â€œæ–°å¢é¡µé¢â€æŒ‰é’®è¿›å…¥æ–°å¢é¡µé¢çª—å£ã€‚</p><p>åœ¨æŸ¥è¯¢æŒ‰é’®çš„æ—è¾¹æ·»åŠ ï¼š</p><div class="hljs"><pre><code class="hljs vue">&lt;routerâ€link class&#x3D;&quot;muiâ€tabâ€item&quot; :to&#x3D;&quot;&#123;path:&#39;&#x2F;cms&#x2F;page&#x2F;add&#x2F;&#39;&#125;&quot;&gt;&lt;elâ€button type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot;&gt;æ–°å¢é¡µé¢&lt;&#x2F;elâ€button&gt;&lt;&#x2F;routerâ€link&gt;</code></pre></div><blockquote><p>router-linkæ˜¯vueæä¾›çš„è·¯ç”±åŠŸèƒ½ï¼Œç”¨äºåœ¨é¡µé¢ç”Ÿæˆè·¯ç”±é“¾æ¥ï¼Œæœ€ç»ˆåœ¨htmlæ¸²æŸ“åå°±æ˜¯&lt;aæ ‡ç­¾ã€‚<br>toï¼šç›®æ ‡è·¯ç”±åœ°å€</p></blockquote><p><strong>4ï¼‰å®Œå–„é¡µé¢å†…å®¹</strong></p><div class="hljs"><pre><code class="hljs vue">&lt;el-form :model&#x3D;&quot;pageForm&quot; label-width&#x3D;&quot;80px&quot;&gt;  &lt;el-form-item label&#x3D;&quot;æ‰€å±ç«™ç‚¹&quot; prop&#x3D;&quot;siteId&quot;&gt;    &lt;el-select v-model&#x3D;&quot;pageForm.siteId&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©ç«™ç‚¹&quot;&gt;      &lt;el-option        v-for&#x3D;&quot;item in siteList&quot;        :key&#x3D;&quot;item.siteId&quot;        :label&#x3D;&quot;item.siteName&quot;        :value&#x3D;&quot;item.siteId&quot;&gt;      &lt;&#x2F;el-option&gt;    &lt;&#x2F;el-select&gt;  &lt;&#x2F;el-form-item&gt;  &lt;el-form-item label&#x3D;&quot;é€‰æ‹©æ¨¡ç‰ˆ&quot; prop&#x3D;&quot;templateId&quot;&gt;    &lt;el-select v-model&#x3D;&quot;pageForm.templateId&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©&quot;&gt;      &lt;el-option        v-for&#x3D;&quot;item in templateList&quot;        :key&#x3D;&quot;item.templateId&quot;        :label&#x3D;&quot;item.templateName&quot;        :value&#x3D;&quot;item.templateId&quot;&gt;      &lt;&#x2F;el-option&gt;    &lt;&#x2F;el-select&gt;  &lt;&#x2F;el-form-item&gt;  &lt;el-form-item label&#x3D;&quot;é¡µé¢åç§°&quot; prop&#x3D;&quot;pageName&quot;&gt;    &lt;el-input v-model&#x3D;&quot;pageForm.pageName&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;  &lt;&#x2F;el-form-item&gt;  &lt;el-form-item label&#x3D;&quot;åˆ«å&quot; prop&#x3D;&quot;pageAliase&quot;&gt;    &lt;el-input v-model&#x3D;&quot;pageForm.pageAliase&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;  &lt;&#x2F;el-form-item&gt;  &lt;el-form-item label&#x3D;&quot;è®¿é—®è·¯å¾„&quot; prop&#x3D;&quot;pageWebPath&quot;&gt;    &lt;el-input v-model&#x3D;&quot;pageForm.pageWebPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;  &lt;&#x2F;el-form-item&gt;  &lt;el-form-item label&#x3D;&quot;ç‰©ç†è·¯å¾„&quot; prop&#x3D;&quot;pagePhysicalPath&quot;&gt;    &lt;el-input v-model&#x3D;&quot;pageForm.pagePhysicalPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;  &lt;&#x2F;el-form-item&gt;  &lt;el-form-item label&#x3D;&quot;ç±»å‹&quot;&gt;    &lt;el-radio-group v-model&#x3D;&quot;pageForm.pageType&quot;&gt;      &lt;el-radio label&#x3D;&quot;0&quot;&gt;é™æ€&lt;&#x2F;el-radio&gt;      &lt;el-radio label&#x3D;&quot;1&quot;&gt;åŠ¨æ€&lt;&#x2F;el-radio&gt;    &lt;&#x2F;el-radio-group&gt;  &lt;&#x2F;el-form-item&gt;  &lt;el-form-item label&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot;&gt;    &lt;el-date-picker type&#x3D;&quot;datetime&quot; placeholder&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot; v-model&#x3D;&quot;pageForm.pageCreateTime&quot;&gt;    &lt;&#x2F;el-date-picker&gt;  &lt;&#x2F;el-form-item&gt;&lt;&#x2F;el-form&gt;&lt;div slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;  &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;addSubmit&quot;&gt;æäº¤&lt;&#x2F;el-button&gt;&lt;&#x2F;div&gt;</code></pre></div><p>Form Attributesè¯´æ˜ï¼š</p><ul><li>model è¡¨å•æ•°æ®å¯¹è±¡</li><li>rules è¡¨å•éªŒè¯è§„åˆ™</li></ul><p>Form-Item Attributesè¯´æ˜ï¼š</p><ul><li>prop è¡¨å•åŸŸ model å­—æ®µï¼Œåœ¨ä½¿ç”¨ validateã€resetFields æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œè¯¥å±æ€§æ˜¯å¿…å¡«çš„</li><li>label æ ‡ç­¾æ–‡æœ¬</li></ul><p>è¯¦æƒ…å±æ€§åŠäº‹ä»¶å‚è€ƒ <a href="http://element.eleme.io/#/zh-CN/component/form" target="_blank" rel="noopener">http://element.eleme.io/#/zh-CN/component/form</a></p><p><strong>5ï¼‰æ•°æ®å¯¹è±¡</strong></p><div class="hljs"><pre><code class="hljs js">  <span class="hljs-comment">//ç«™ç‚¹åˆ—è¡¨</span>    siteList: [],    <span class="hljs-comment">//æ¨¡ç‰ˆåˆ—è¡¨</span>    templateList: [],    <span class="hljs-comment">//æ–°å¢ç•Œé¢æ•°æ®</span>    pageForm: &#123;      siteId: <span class="hljs-string">''</span>,      templateId: <span class="hljs-string">''</span>,      pageName: <span class="hljs-string">''</span>,      pageAliase: <span class="hljs-string">''</span>,      pageWebPath: <span class="hljs-string">''</span>,      pageParameter: <span class="hljs-string">''</span>,      pagePhysicalPath: <span class="hljs-string">''</span>,      pageType: <span class="hljs-string">'0'</span>,  <span class="hljs-comment">//é»˜è®¤é€‰ä¸­0</span>      pageCreateTime: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()    &#125;  &#125;&#125;,methods: &#123;  addSubmit() &#123;    alert(<span class="hljs-string">"æäº¤"</span>)  &#125;,&#125;</code></pre></div><p><strong>6ï¼‰ç«™ç‚¹åŠæ¨¡æ¿æ•°æ®</strong></p><p>å®šä¹‰è¯·æ±‚api</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//è·å–æ‰€æœ‰ç«™ç‚¹ä¿¡æ¯</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> site_list = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>&#123;  <span class="hljs-keyword">return</span> http.requestGet(apiUrl + <span class="hljs-string">"/cms/site/list"</span>)&#125;<span class="hljs-comment">//è·å–æ‰€æœ‰æ¨¡æ¿ä¿¡æ¯</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> template_list = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>&#123;  <span class="hljs-keyword">return</span> http.requestGet(apiUrl + <span class="hljs-string">"/cms/template/list"</span>)&#125;</code></pre></div><blockquote><p>åœ¨createdé’©å­ä¸­å®šä¹‰ï¼ŒåŸè®²ä¹‰å†…ä½¿ç”¨çš„æ˜¯é™æ€æ•°æ®</p></blockquote><div class="hljs"><pre><code class="hljs js">created: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;    <span class="hljs-comment">//åˆå§‹åŒ–ç«™ç‚¹æ•°æ®</span>    cmsApi.site_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;        <span class="hljs-keyword">if</span> (res.success) &#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"ç«™ç‚¹æ•°æ®"</span>,res)            <span class="hljs-comment">//èµ‹å€¼ç»™ç«™ç‚¹ä¿¡æ¯åˆ—è¡¨</span>            <span class="hljs-keyword">this</span>.siteList = res.queryResult.list        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"è·å–ç«™ç‚¹ä¿¡æ¯æ—¶å‘ç”Ÿäº†é”™è¯¯"</span>, res)        &#125;    &#125;)    <span class="hljs-comment">//åˆå§‹åŒ–æ¨¡æ¿æ•°æ®</span>    cmsApi.template_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;        <span class="hljs-keyword">if</span> (res.success) &#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"æ¨¡æ¿æ•°æ®"</span>,res)            <span class="hljs-comment">//èµ‹å€¼ç»™æ¨¡æ¿åˆ—è¡¨</span>            <span class="hljs-keyword">this</span>.templateList = res.queryResult.list        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"è·å–æ¨¡æ¿ä¿¡æ¯æ—¶å‘ç”Ÿäº†é”™è¯¯"</span>, res)        &#125;    &#125;)&#125;,</code></pre></div><p><strong>7ï¼‰æµ‹è¯•é¢„è§ˆ</strong></p><p><a href="https://qnoss.codeyee.com/20200704_3/image15" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image15.png" srcset="/img/loading.gif" alt="img"></a></p><h4 id="2ã€æ·»åŠ è¿”å›"><a href="#2ã€æ·»åŠ è¿”å›" class="headerlink" title="2ã€æ·»åŠ è¿”å›"></a>2ã€æ·»åŠ è¿”å›</h4><blockquote><p>è¿›å…¥æ–°å¢é¡µé¢ååªèƒ½é€šè¿‡èœå•å†æ¬¡è¿›å…¥é¡µé¢åˆ—è¡¨ï¼Œå¯ä»¥åœ¨æ–°å¢é¡µé¢æ·»åŠ â€œè¿”å›â€æŒ‰é’®ï¼Œç‚¹å‡»è¿”å›æŒ‰é’®è¿”å›åˆ°é¡µé¢åˆ—è¡¨ã€‚</p></blockquote><ol><li>æ–°å¢é¡µé¢æŒ‰é’®å¸¦ä¸Šå‚æ•°</li></ol><div class="hljs"><pre><code class="hljs vue">&lt;router-link class&#x3D;&quot;mui-tab-item&quot;             :to&#x3D;&quot;&#123;path:&#39;&#x2F;cms&#x2F;page&#x2F;add&#x2F;&#39;, query:&#123; page:this.params.page,siteId:this.params.siteId &#125;&#125;&quot;&gt;  &lt;el-button type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot;&gt;æ–°å¢é¡µé¢&lt;&#x2F;el-button&gt;&lt;&#x2F;router-link&gt;</code></pre></div><p>è¯´æ˜ï¼šqueryè¡¨ç¤ºåœ¨è·¯ç”±urlä¸Šå¸¦ä¸Šå‚æ•°</p><p>2ï¼‰å®šä¹‰è¿”å›æ–¹æ³•</p><p>åœ¨page_add.vueä¸Šå®šä¹‰è¿”å›æŒ‰é’®</p><div class="hljs"><pre><code class="hljs vue">&lt;elâ€button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;go_back&quot; &gt;è¿”å›&lt;&#x2F;elâ€button&gt;</code></pre></div><p>åœ¨page_add.vueä¸Šå®šä¹‰è¿”å›æ–¹æ³•</p><div class="hljs"><pre><code class="hljs js">go_back()&#123;    <span class="hljs-keyword">this</span>.$router.push(&#123;        path: <span class="hljs-string">'/cms/page/list'</span>, <span class="hljs-attr">query</span>: &#123;        page: <span class="hljs-keyword">this</span>.$route.query.page,        siteId:<span class="hljs-keyword">this</span>.$route.query.siteId    &#125;    &#125;)&#125;</code></pre></div><p>è¯´æ˜ï¼šthis.$route.query è¡¨ç¤ºå–å‡ºè·¯ç”±ä¸Šçš„å‚æ•°åˆ—è¡¨ï¼Œæœ‰ä¸¤ä¸ªå–è·¯ç”±å‚æ•°çš„æ–¹æ³•ï¼š</p><blockquote><p>aã€é€šè¿‡åœ¨è·¯ç”±ä¸Šæ·»åŠ  key/value ä¸²ä½¿ç”¨ <code>this.$route.query</code> æ¥å–å‚æ•°ï¼Œä¾‹å¦‚ï¼š<code>/router1?id=123</code> , <code>/router1?id=456</code> å¯ä»¥é€šè¿‡ <code>this.$route.query.id</code> è·å–å‚æ•°idçš„å€¼ã€‚</p><p>bã€é€šè¿‡å°†å‚æ•°ä½œä¸ºè·¯ç”±ä¸€éƒ¨åˆ†è¿›è¡Œä¼ å‚æ•°ä½¿ç”¨ <code>this.$route.params</code> æ¥è·å–ï¼Œä¾‹å¦‚ï¼šå®šä¹‰çš„è·¯ç”±ä¸º <code>/router1/:id</code> ï¼Œè¯·æ±‚ <code>/router1/123</code> æ—¶å¯ä»¥é€šè¿‡ <code>this.$route.params.id</code> æ¥è·å–ï¼Œæ­¤ç§æƒ…å†µç”¨ <code>this.$route.query.id</code> æ˜¯æ‹¿ä¸åˆ°çš„ã€‚</p></blockquote><p>3ï¼‰æŸ¥è¯¢åˆ—è¡¨æ”¯æŒå›æ˜¾</p><p>è¿›å…¥æŸ¥è¯¢åˆ—è¡¨ï¼Œä»urlä¸­è·å–é¡µç å’Œç«™ç‚¹idå¹¶èµ‹å€¼ç»™æ•°æ®æ¨¡å‹å¯¹è±¡ï¼Œä»è€Œå®ç°é¡µé¢å›æ˜¾ã€‚</p><p>urlä¾‹å­ï¼š<a href="http://localhost:12000/#/cms/page/list?page=2&amp;siteId=5a751fab6abb5044e0d19ea1" target="_blank" rel="noopener">http://localhost:12000/#/cms/page/list?page=2&amp;siteId=5a751fab6abb5044e0d19ea1</a></p><div class="hljs"><pre><code class="hljs js">created() &#123;    <span class="hljs-comment">//ä»è·¯ç”±ä¸Šè·å–å‚æ•°</span>    <span class="hljs-keyword">this</span>.params.page = <span class="hljs-built_in">Number</span>.parseInt(<span class="hljs-keyword">this</span>.$route.query.page||<span class="hljs-number">1</span>);    <span class="hljs-keyword">this</span>.params.siteId = <span class="hljs-keyword">this</span>.$route.query.siteId||<span class="hljs-string">''</span>;    .....&#125;</code></pre></div><blockquote><p>å°æŠ€å·§ï¼šä½¿ç”¨ ||è¿”å›ç¬¬ä¸€ä¸ªæœ‰æ•ˆå€¼</p></blockquote><h4 id="1-3ã€è¡¨å•éªŒè¯"><a href="#1-3ã€è¡¨å•éªŒè¯" class="headerlink" title="1.3ã€è¡¨å•éªŒè¯"></a>1.3ã€è¡¨å•éªŒè¯</h4><p>1ï¼‰é…ç½®æ ¡éªŒè§„åˆ™</p><p>Element-UIçš„Formç»„ä»¶æä¾›è¡¨å•æ ¡éªŒçš„æ–¹æ³•ï¼š</p><p>åœ¨formå±æ€§ä¸Šé…ç½®rulesï¼ˆè¡¨å•éªŒè¯è§„åˆ™ï¼‰</p><div class="hljs"><pre><code class="hljs vue">&lt;elâ€form :model&#x3D;&quot;pageForm&quot; :rules&#x3D;&quot;pageFormRules&quot; labelâ€width&#x3D;&quot;80px&quot; &gt;</code></pre></div><p>åœ¨æ•°æ®æ¨¡å‹ä¸­é…ç½®æ ¡éªŒè§„åˆ™ï¼š</p><div class="hljs"><pre><code class="hljs js">data() &#123;    <span class="hljs-keyword">return</span> &#123;        pageFormRules: &#123;            siteId:[                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·é€‰æ‹©ç«™ç‚¹'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;            ],            templateId:[                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·é€‰æ‹©æ¨¡ç‰ˆ'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;            ],            pageName: [                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥é¡µé¢åç§°'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;            ],            pageAliase: [                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥é¡µé¢åˆ«å'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;            ],            pageWebPath: [                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥è®¿é—®è·¯å¾„'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;            ],            pagePhysicalPath: [                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥ç‰©ç†è·¯å¾„'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;            ]        &#125;,    &#125;&#125;</code></pre></div><p>æ›´å¤šçš„æ ¡éªŒè§„åˆ™å‚è€ƒ <a href="http://element.eleme.io/#/zh-CN/component/form" target="_blank" rel="noopener">http://element.eleme.io/#/zh-CN/component/form</a> ä¸­â€œè¡¨å•éªŒè¯â€çš„ä¾‹å­</p><p>2ï¼‰ç‚¹å‡»æäº¤æŒ‰é’®è§¦å‘æ ¡éªŒ</p><p>åœ¨formè¡¨å•ä¸Šæ·»åŠ  refå±æ€§ï¼ˆref=â€pageFormâ€ï¼‰åœ¨æ ¡éªŒæ—¶å¼•ç”¨æ­¤è¡¨å•å¯¹è±¡</p><div class="hljs"><pre><code class="hljs vue">&lt;elâ€form :model&#x3D;&quot;pageForm&quot; :rules&#x3D;&quot;pageFormRules&quot; labelâ€width&#x3D;&quot;80px&quot; ref&#x3D;&quot;pageForm&quot;&gt;</code></pre></div><p>åœ¨æäº¤è¡¨å•æ—¶æ‰§è¡Œæ ¡éªŒ</p><div class="hljs"><pre><code class="hljs js">addSubmit() &#123;    <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;        <span class="hljs-keyword">if</span> (valid) &#123;            alert(<span class="hljs-string">'æäº¤'</span>);        &#125; <span class="hljs-keyword">else</span> &#123;            alert(<span class="hljs-string">'æ ¡éªŒå¤±è´¥'</span>);            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;        &#125;    &#125;)&#125;,</code></pre></div><p>æµ‹è¯•</p><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image16.png" srcset="/img/loading.gif" alt="img"></p><h3 id="APIè°ƒç”¨-1"><a href="#APIè°ƒç”¨-1" class="headerlink" title="APIè°ƒç”¨"></a>APIè°ƒç”¨</h3><h4 id="1ã€åœ¨cms-jsä¸­å®šä¹‰page-addæ–¹æ³•"><a href="#1ã€åœ¨cms-jsä¸­å®šä¹‰page-addæ–¹æ³•" class="headerlink" title="1ã€åœ¨cms.jsä¸­å®šä¹‰page_addæ–¹æ³•"></a>1ã€åœ¨cms.jsä¸­å®šä¹‰page_addæ–¹æ³•</h4><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_add = <span class="hljs-function"><span class="hljs-params">params</span> =&gt;</span>&#123;  <span class="hljs-keyword">return</span> http.requestPost(apiUrl + <span class="hljs-string">"/cms/page/add"</span>,params)&#125;</code></pre></div><h4 id="2ã€æ·»åŠ äº‹ä»¶"><a href="#2ã€æ·»åŠ äº‹ä»¶" class="headerlink" title="2ã€æ·»åŠ äº‹ä»¶"></a>2ã€æ·»åŠ äº‹ä»¶</h4><p>å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æäº¤è¡¨å•</span>addSubmit()&#123;  <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;    <span class="hljs-keyword">if</span> (valid) &#123;      <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤æäº¤å—ï¼Ÿ'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;        cmsApi.page_add(<span class="hljs-keyword">this</span>.pageForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;          <span class="hljs-built_in">console</span>.log(res);          <span class="hljs-keyword">if</span>(res.success)&#123;            <span class="hljs-keyword">this</span>.$message(&#123;              message: <span class="hljs-string">'æäº¤æˆåŠŸ'</span>,              type: <span class="hljs-string">'success'</span>          &#125;);          <span class="hljs-keyword">this</span>.$refs[<span class="hljs-string">'pageForm'</span>].resetFields();          &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);          &#125;        &#125;);      &#125;);    &#125;  &#125;)&#125;,</code></pre></div><p>æœ¬åŠŸèƒ½ä½¿ç”¨åˆ°ä¸¤ä¸ªUIç»„ä»¶ï¼š</p><ul><li>ä½¿ç”¨ <code>element-ui</code> çš„ <code>message-box</code> ç»„ä»¶å¼¹å‡ºç¡®è®¤æäº¤çª—å£ï¼ˆ<a href="http://element.eleme.io/#/zhCN/component/message-box%EF%BC%89" target="_blank" rel="noopener">http://element.eleme.io/#/zhCN/component/message-boxï¼‰</a></li><li>ä½¿ç”¨ <code>message</code>ç»„ä»¶æç¤ºæ“ä½œç»“æœ ï¼ˆ<a href="http://element.eleme.io/#/zh-CN/component/message%EF%BC%89" target="_blank" rel="noopener">http://element.eleme.io/#/zh-CN/component/messageï¼‰</a></li></ul><h4 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h4><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image17.gif" srcset="/img/loading.gif" alt="img"></p><h1 id="ä¸‰ã€ä¿®æ”¹é¡µé¢"><a href="#ä¸‰ã€ä¿®æ”¹é¡µé¢" class="headerlink" title="ä¸‰ã€ä¿®æ”¹é¡µé¢"></a>ä¸‰ã€ä¿®æ”¹é¡µé¢</h1><p>ä¿®æ”¹é¡µé¢ç”¨æˆ·æ“ä½œæµç¨‹ï¼š</p><p>1ã€ç”¨æˆ·è¿›å…¥ä¿®æ”¹é¡µé¢ï¼Œåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºäº†ä¿®æ”¹é¡µé¢çš„ä¿¡æ¯</p><p>2ã€ç”¨æˆ·ä¿®æ”¹é¡µé¢çš„å†…å®¹ï¼Œç‚¹å‡»â€œæäº¤â€ï¼Œæç¤ºâ€œä¿®æ”¹æˆåŠŸâ€æˆ–â€œä¿®æ”¹å¤±è´¥â€</p><h2 id="1-åç«¯æ¥å£å®šä¹‰"><a href="#1-åç«¯æ¥å£å®šä¹‰" class="headerlink" title="1. åç«¯æ¥å£å®šä¹‰"></a>1. åç«¯æ¥å£å®šä¹‰</h2><p>ä¿®æ”¹é¡µé¢éœ€è¦å®šä¹‰çš„APIå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ ¹æ®é¡µé¢idæŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æ ¹æ®é¡µé¢idæŸ¥è¯¢é¡µé¢ä¿¡æ¯"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPage <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;    <span class="hljs-comment">//ä¿®æ”¹é¡µé¢</span>    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"ä¿®æ”¹é¡µé¢"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">edit</span><span class="hljs-params">(String id,CmsPage cmsPage)</span></span>;</code></pre></div><blockquote><p>æˆ‘ä»¬ä»å‰é¢å®šä¹‰çš„ findList ç”¨çš„æ˜¯ <code>QueryResponseResult</code> ä½œä¸ºå“åº”æ¨¡å‹ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å®šä¹‰çš„ <code>CmsPageResult</code> ä½œä¸ºå“åº”æ¨¡å‹ï¼Œä¸¤è€…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æˆ‘ä¸ªäººçš„ç†è§£æ˜¯ï¼Œ<code>findList</code> æ˜¯åˆ†é¡µæŸ¥è¯¢å¹¶ä¸”è¿”å›äº†å¤šä¸ªå¯¹è±¡çš„ä¿¡æ¯ï¼Œè€Œ <code>findById</code> åˆ™æ˜¯æŸ¥è¯¢å•ä¸ªå¯¹è±¡çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ <code>CmsPageResult</code> ä½œä¸ºæ“ä½œæˆ–æŸ¥è¯¢å•ä¸ªå¯¹è±¡æ—¶çš„å“åº”æ¨¡å‹ï¼Œè€Œ <code>QueryResponseResult</code> åˆ™ä½œä¸ºæ“ä½œå¤šä¸ªå¯¹è±¡æ—¶çš„å“åº”æ¨¡å‹ã€‚</p></blockquote><p>è¯´æ˜ï¼šæäº¤æ•°æ®ä½¿ç”¨postã€putéƒ½å¯ä»¥ï¼Œåªæ˜¯æ ¹æ®httpæ–¹æ³•çš„è§„èŒƒï¼Œputæ–¹æ³•æ˜¯å¯¹æœåŠ¡å™¨æŒ‡å®šèµ„æºè¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨putæ–¹æ³•å¯¹é¡µé¢ä¿®æ”¹è¿›è¡Œä¿®æ”¹ã€‚</p><h2 id="2-æœåŠ¡ç«¯å¼€å‘"><a href="#2-æœåŠ¡ç«¯å¼€å‘" class="headerlink" title="2. æœåŠ¡ç«¯å¼€å‘"></a>2. æœåŠ¡ç«¯å¼€å‘</h2><h3 id="Daoå±‚-2"><a href="#Daoå±‚-2" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h3><p>ä½¿ç”¨ Spring Dataæä¾›çš„findByIdæ–¹æ³•å®Œæˆæ ¹æ®ä¸»é”®æŸ¥è¯¢ ã€‚<br>ä½¿ç”¨ Spring Dataæä¾›çš„saveæ–¹æ³•å®Œæˆæ•°æ®ä¿å­˜ ã€‚</p><h3 id="Serviceå±‚-2"><a href="#Serviceå±‚-2" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ ¹æ®é¡µé¢idæŸ¥è¯¢é¡µé¢</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPage <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span> </span>&#123;        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(id);        <span class="hljs-keyword">if</span> (optional.isPresent())&#123;            CmsPage cmsPage = optional.get();            <span class="hljs-keyword">return</span> cmsPage;        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;    &#125;    <span class="hljs-comment">//ä¿®æ”¹é¡µé¢</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">edit</span><span class="hljs-params">(String id, CmsPage cmsPage)</span> </span>&#123;        <span class="hljs-comment">//æ ¹æ®idä»æ•°æ®æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>        CmsPage updateCmsPage = <span class="hljs-keyword">this</span>.findById(id);        <span class="hljs-keyword">if</span> (updateCmsPage != <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-comment">//è®¾ç½®è¦ä¿®æ”¹çš„æ•°æ®</span>            updateCmsPage.setTemplateId(cmsPage.getTemplateId());            updateCmsPage.setSiteId(cmsPage.getSiteId());            updateCmsPage.setPageAliase(cmsPage.getPageAliase());            updateCmsPage.setPageName(cmsPage.getPageName());            updateCmsPage.setPageWebPath(cmsPage.getPageWebPath());            updateCmsPage.setPagePhysicalPath(cmsPage.getPagePhysicalPath());            <span class="hljs-comment">//æäº¤ä¿®æ”¹</span>            cmsPageRepository.save(updateCmsPage);            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS,updateCmsPage);        &#125;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);    &#125;</code></pre></div><h3 id="Controllerå±‚-1"><a href="#Controllerå±‚-1" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/get/&#123;id&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPage <span class="hljs-title">findById</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id) </span>&#123;        <span class="hljs-keyword">return</span> pageService.findById(id);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@PutMapping</span>(<span class="hljs-string">"/edit/&#123;id&#125;"</span>)<span class="hljs-comment">//putè¡¨ç¤ºæ›´æ–°</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">edit</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id,@RequestBody CmsPage cmsPage) </span>&#123;        <span class="hljs-keyword">return</span> pageService.edit(id,cmsPage);    &#125;</code></pre></div><h2 id="3-ä¿®æ”¹ï¼šå‰ç«¯å¼€å‘"><a href="#3-ä¿®æ”¹ï¼šå‰ç«¯å¼€å‘" class="headerlink" title="3. ä¿®æ”¹ï¼šå‰ç«¯å¼€å‘"></a>3. ä¿®æ”¹ï¼šå‰ç«¯å¼€å‘</h2><h3 id="é¡µé¢å¤„ç†æµç¨‹"><a href="#é¡µé¢å¤„ç†æµç¨‹" class="headerlink" title="é¡µé¢å¤„ç†æµç¨‹"></a>é¡µé¢å¤„ç†æµç¨‹</h3><blockquote><p>å¯ä»¥å‚è€ƒæ–°å¢çš„é€»è¾‘</p></blockquote><ol><li>è¿›å…¥é¡µé¢ï¼Œé€šè¿‡é’©å­æ–¹æ³•è¯·æ±‚æœåŠ¡ç«¯è·å–é¡µé¢ä¿¡æ¯ï¼Œå¹¶èµ‹å€¼ç»™æ•°æ®æ¨¡å‹å¯¹è±¡ã€‚</li><li>é¡µé¢ä¿¡æ¯é€šè¿‡æ•°æ®ç»‘å®šåœ¨è¡¨å•ä¸­æ˜¾ç¤ºã€‚</li><li>ç”¨æˆ·ä¿®æ”¹ä¿¡æ¯ç‚¹å‡» â€œæäº¤â€ è¯·æ±‚æœåŠ¡ç«¯ä¿®æ”¹é¡µé¢ä¿¡æ¯æ¥å£ã€‚</li></ol><h3 id="å‰ç«¯HTTP-APIæ„å»º"><a href="#å‰ç«¯HTTP-APIæ„å»º" class="headerlink" title="å‰ç«¯HTTP APIæ„å»º"></a>å‰ç«¯HTTP APIæ„å»º</h3><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æŸ¥è¯¢å•ä¸ªé¡µé¢ä¿¡æ¯</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_query = <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span>&#123;  <span class="hljs-keyword">return</span> http.requestPut(apiUrl + <span class="hljs-string">"/cms/page/get/"</span> + id)&#125;<span class="hljs-comment">//æ›´æ–°æ¥å£</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_update = <span class="hljs-function">(<span class="hljs-params">id,params</span>) =&gt;</span>&#123;  <span class="hljs-keyword">return</span> http.requestPut(apiUrl + <span class="hljs-string">"/cms/page/edit/"</span> + id,params)&#125;<span class="hljs-comment">//è·å–ç«™ç‚¹å’Œæ¨¡æ¿åˆ—è¡¨</span></code></pre></div><h3 id="æ·»åŠ é¡µé¢è·¯ç”±"><a href="#æ·»åŠ é¡µé¢è·¯ç”±" class="headerlink" title="æ·»åŠ é¡µé¢è·¯ç”±"></a>æ·»åŠ é¡µé¢è·¯ç”±</h3><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> page_update <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/cms/page/page_update.vue'</span>;<span class="hljs-comment">//å­èœå•</span>children: [    &#123;        path: <span class="hljs-string">'/cms/page/edit/:pageId'</span>, <span class="hljs-attr">name</span>:<span class="hljs-string">"ç¼–è¾‘é¡µé¢ä¿¡æ¯"</span>,<span class="hljs-attr">component</span>: page_edit, <span class="hljs-attr">hidden</span>:<span class="hljs-literal">true</span>    &#125;,]</code></pre></div><p>pathä¸­çš„ <code>:pageId</code> è¡¨ç¤ºåœ¨è·¯ç”±urlä¸­å®šä¹‰äº†ä¸€ä¸ªpageIdå˜é‡</p><h3 id="æ„å»ºå‰ç«¯é¡µé¢"><a href="#æ„å»ºå‰ç«¯é¡µé¢" class="headerlink" title="æ„å»ºå‰ç«¯é¡µé¢"></a>æ„å»ºå‰ç«¯é¡µé¢</h3><p>åœ¨ <code>page_list</code> é¡µé¢æ–°å¢ç¼–è¾‘æŒ‰é’®</p><div class="hljs"><pre><code class="hljs vue">&lt;el-table-column label&#x3D;&quot;ç¼–è¾‘&quot; width&#x3D;&quot;75&quot; fixed&#x3D;&quot;right&quot;&gt;    &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;&lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;info&quot; @click&#x3D;&quot;toEdit(scope.row.pageId)&quot;&gt;ç¼–è¾‘&lt;&#x2F;el-button&gt;    &lt;&#x2F;template&gt;&lt;&#x2F;el-table-column&gt;</code></pre></div><p>å¢åŠ è·³è½¬edité¡µé¢çš„å‡½æ•°</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//è·³è½¬è‡³ç¼–è¾‘é¡µé¢</span>toEdit(pageId)&#123;  <span class="hljs-keyword">this</span>.$router.push(&#123;    path:<span class="hljs-string">"/cms/page/edit/"</span> + pageId,    query:&#123;      page:<span class="hljs-keyword">this</span>.params.page,      siteId:<span class="hljs-keyword">this</span>.params.siteId    &#125;  &#125;)&#125;,</code></pre></div><p>ä½¿ç”¨ <code>scope</code> è·å–å½“å‰è¡Œæ•°æ®ä¸­çš„ <code>pageId</code> ä¼ å…¥ toEdit å‡½æ•°è¿›è¡Œé¡µé¢è·³è½¬</p><p>å®Œæˆ<code>page_edit.vue</code> é¡µé¢çš„åŸºæœ¬æ„é€ </p><div class="hljs"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;el-form :model&#x3D;&quot;pageForm&quot; label-width&#x3D;&quot;80px&quot; :rules&#x3D;&quot;pageFormRules&quot; ref&#x3D;&quot;pageForm&quot;&gt;      &lt;el-form-item label&#x3D;&quot;æ‰€å±ç«™ç‚¹&quot; prop&#x3D;&quot;siteId&quot;&gt;        &lt;el-select v-model&#x3D;&quot;pageForm.siteId&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©ç«™ç‚¹&quot;&gt;          &lt;el-option            v-for&#x3D;&quot;item in siteList&quot;            :key&#x3D;&quot;item.siteId&quot;            :label&#x3D;&quot;item.siteName&quot;            :value&#x3D;&quot;item.siteId&quot;&gt;          &lt;&#x2F;el-option&gt;        &lt;&#x2F;el-select&gt;      &lt;&#x2F;el-form-item&gt;      &lt;el-form-item label&#x3D;&quot;é€‰æ‹©æ¨¡ç‰ˆ&quot; prop&#x3D;&quot;templateId&quot;&gt;        &lt;el-select v-model&#x3D;&quot;pageForm.templateId&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©&quot;&gt;          &lt;el-option            v-for&#x3D;&quot;item in templateList&quot;            :key&#x3D;&quot;item.templateId&quot;            :label&#x3D;&quot;item.templateName&quot;            :value&#x3D;&quot;item.templateId&quot;&gt;          &lt;&#x2F;el-option&gt;        &lt;&#x2F;el-select&gt;      &lt;&#x2F;el-form-item&gt;      &lt;el-form-item label&#x3D;&quot;é¡µé¢åç§°&quot; prop&#x3D;&quot;pageName&quot;&gt;        &lt;el-input v-model&#x3D;&quot;pageForm.pageName&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;      &lt;&#x2F;el-form-item&gt;      &lt;el-form-item label&#x3D;&quot;åˆ«å&quot; prop&#x3D;&quot;pageAliase&quot;&gt;        &lt;el-input v-model&#x3D;&quot;pageForm.pageAliase&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;      &lt;&#x2F;el-form-item&gt;      &lt;el-form-item label&#x3D;&quot;è®¿é—®è·¯å¾„&quot; prop&#x3D;&quot;pageWebPath&quot;&gt;        &lt;el-input v-model&#x3D;&quot;pageForm.pageWebPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;      &lt;&#x2F;el-form-item&gt;      &lt;el-form-item label&#x3D;&quot;ç‰©ç†è·¯å¾„&quot; prop&#x3D;&quot;pagePhysicalPath&quot;&gt;        &lt;el-input v-model&#x3D;&quot;pageForm.pagePhysicalPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;      &lt;&#x2F;el-form-item&gt;      &lt;el-form-item label&#x3D;&quot;ç±»å‹&quot;&gt;        &lt;el-radio-group v-model&#x3D;&quot;pageForm.pageType&quot;&gt;          &lt;el-radio class&#x3D;&quot;radio&quot; label&#x3D;&quot;0&quot; &gt;é™æ€&lt;&#x2F;el-radio&gt;          &lt;el-radio class&#x3D;&quot;radio&quot; label&#x3D;&quot;1&quot; &gt;åŠ¨æ€&lt;&#x2F;el-radio&gt;        &lt;&#x2F;el-radio-group&gt;      &lt;&#x2F;el-form-item&gt;      &lt;el-form-item label&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot;&gt;        &lt;el-date-picker type&#x3D;&quot;datetime&quot; placeholder&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot; v-model&#x3D;&quot;pageForm.pageCreateTime&quot;&gt;        &lt;&#x2F;el-date-picker&gt;      &lt;&#x2F;el-form-item&gt;    &lt;&#x2F;el-form&gt;    &lt;div slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;      &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;addSubmit&quot;&gt;æäº¤&lt;&#x2F;el-button&gt;      &lt;el-button type&#x3D;&quot;info&quot; @click&#x3D;&quot;goBack&quot;&gt;è¿”å›&lt;&#x2F;el-button&gt;    &lt;&#x2F;div&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;  import * as cmsApi from &#39;..&#x2F;api&#x2F;cms&#39;  export default &#123;    created: function () &#123;    &#125;,    mounted() &#123;    &#125;,    data() &#123;      return &#123;        pageFormRules: &#123;          siteId: [            &#123;required: true, message: &#39;è¯·é€‰æ‹©ç«™ç‚¹&#39;, trigger: &#39;blur&#39;&#125;          ],          templateId: [            &#123;required: true, message: &#39;è¯·é€‰æ‹©æ¨¡ç‰ˆ&#39;, trigger: &#39;blur&#39;&#125;          ],          pageName: [            &#123;required: true, message: &#39;è¯·è¾“å…¥é¡µé¢åç§°&#39;, trigger: &#39;blur&#39;&#125;          ],          pageAliase: [            &#123;required: true, message: &#39;è¯·è¾“å…¥é¡µé¢åˆ«å&#39;, trigger: &#39;blur&#39;&#125;          ],          pageWebPath: [            &#123;required: true, message: &#39;è¯·è¾“å…¥è®¿é—®è·¯å¾„&#39;, trigger: &#39;blur&#39;&#125;          ],          pagePhysicalPath: [            &#123;required: true, message: &#39;è¯·è¾“å…¥ç‰©ç†è·¯å¾„&#39;, trigger: &#39;blur&#39;&#125;          ]        &#125;,        &#x2F;&#x2F;ç«™ç‚¹åˆ—è¡¨        siteList: [],        &#x2F;&#x2F;æ¨¡ç‰ˆåˆ—è¡¨        templateList: [],        &#x2F;&#x2F;æ–°å¢ç•Œé¢æ•°æ®        pageForm: &#123;          siteId: &#39;&#39;,          templateId: &#39;&#39;,          pageName: &#39;&#39;,          pageAliase: &#39;&#39;,          pageWebPath: &#39;&#39;,          pageParameter: &#39;&#39;,          pagePhysicalPath: &#39;&#39;,          pageType: &#39;&#39;,          pageCreateTime: new Date()        &#125;      &#125;    &#125;,    methods: &#123;      &#x2F;&#x2F;è¿”å›ä¸Šä¸€é¡µ      goBack() &#123;        this.$router.push(&#123;          path: &quot;&#x2F;cms&#x2F;page&#x2F;list&quot;,          query: &#123;            page: this.$route.query.page,            siteId: this.$route.query.siteId          &#125;        &#125;)      &#125;    &#125;  &#125;&lt;&#x2F;script&gt;</code></pre></div><h4 id="1ã€é¡µé¢åˆå§‹åŒ–"><a href="#1ã€é¡µé¢åˆå§‹åŒ–" class="headerlink" title="1ã€é¡µé¢åˆå§‹åŒ–"></a>1ã€é¡µé¢åˆå§‹åŒ–</h4><p>åœ¨é’©å­å‡½æ•° <code>created</code> ä¸­è¿›è¡Œä¸€äº›æ•°æ®çš„åˆå§‹åŒ–è¯·æ±‚ï¼Œä¾‹å¦‚ç«™ç‚¹ã€æ¨¡æ¿çš„ä¿¡æ¯ï¼Œç”¨äºä¸‹æ‹‰æ¡†çš„é€‰æ‹©ï¼Œä»¥åŠåœ¨æ‰“å¼€ç¼–è¾‘é¡µé¢ä¹‹å‰ï¼Œç”¨æˆ·éœ€è¦è·å–å½“å‰ç¼–è¾‘çš„é¡µé¢åŸæœ‰çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>page_list</code> é¡µé¢é€šè¿‡çš„ <code>pageId</code> æ¥è·å–å½“å‰ç¼–è¾‘çš„é¡µé¢çš„æ•°æ®ã€‚</p><div class="hljs"><pre><code class="hljs js">created: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;     <span class="hljs-comment">//åˆå§‹åŒ–ç«™ç‚¹æ•°æ®</span>    cmsApi.site_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;        <span class="hljs-keyword">if</span> (res.success) &#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"ç«™ç‚¹æ•°æ®"</span>, res)            <span class="hljs-keyword">this</span>.siteList = res.queryResult.list        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"è·å–ç«™ç‚¹ä¿¡æ¯æ—¶å‘ç”Ÿäº†é”™è¯¯"</span>, res)        &#125;    &#125;)    <span class="hljs-comment">//åˆå§‹åŒ–æ¨¡æ¿æ•°æ®</span>    cmsApi.template_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;        <span class="hljs-keyword">if</span> (res.success) &#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"æ¨¡æ¿æ•°æ®"</span>, res)            <span class="hljs-keyword">this</span>.templateList = res.queryResult.list        &#125; <span class="hljs-keyword">else</span> &#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"è·å–æ¨¡æ¿ä¿¡æ¯æ—¶å‘ç”Ÿäº†é”™è¯¯"</span>, res)        &#125;    &#125;)    <span class="hljs-comment">//åˆå§‹åŒ–é¡µé¢çš„æ•°æ®</span>    cmsApi.page_query(<span class="hljs-keyword">this</span>.$route.params.pageId).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span>&#123;        <span class="hljs-keyword">if</span>(res.success)&#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"åˆå§‹åŒ–é¡µé¢æ•°æ®"</span>,res.cmsPage)            <span class="hljs-keyword">this</span>.pageForm = res.cmsPage        &#125;<span class="hljs-keyword">else</span>&#123;            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"åˆå§‹åŒ–é¡µé¢æ•°æ®å¤±è´¥"</span>,res)        &#125;    &#125;)&#125;,</code></pre></div><p>æˆ‘ä»¬åœ¨é¡µé¢è·¯ç”±å®šä¹‰äº†ä¸€ä¸ª:pageIdçš„å‚æ•°ï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–é¡µé¢çš„æ•°æ®éƒ¨åˆ†ä» <code>this.$route.params</code> å–å‡ºäº†<code>pageId</code></p><h4 id="2ã€æäº¤æ›´æ–°è¡¨å•"><a href="#2ã€æäº¤æ›´æ–°è¡¨å•" class="headerlink" title="2ã€æäº¤æ›´æ–°è¡¨å•"></a>2ã€æäº¤æ›´æ–°è¡¨å•</h4><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æäº¤è¡¨å•</span>addSubmit() &#123;    <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;        <span class="hljs-keyword">if</span> (valid) &#123;            <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤æäº¤ä¿®æ”¹å—ï¼Ÿ'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;                cmsApi.page_edit(<span class="hljs-keyword">this</span>.$route.params.pageId,<span class="hljs-keyword">this</span>.pageForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;                    <span class="hljs-keyword">if</span> (res.success) &#123;                        <span class="hljs-keyword">this</span>.$message(&#123;                            message: <span class="hljs-string">'ä¿®æ”¹æäº¤æˆåŠŸ'</span>,                            type: <span class="hljs-string">'success'</span>                        &#125;);                    &#125; <span class="hljs-keyword">else</span> &#123;                        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);                    &#125;                &#125;);            &#125;);        &#125;    &#125;)&#125;,</code></pre></div><h1 id="å››ã€åˆ é™¤é¡µé¢"><a href="#å››ã€åˆ é™¤é¡µé¢" class="headerlink" title="å››ã€åˆ é™¤é¡µé¢"></a>å››ã€åˆ é™¤é¡µé¢</h1><p>ä¿®æ”¹é¡µé¢ç”¨æˆ·æ“ä½œæµç¨‹ï¼š</p><p>1ã€ç”¨æˆ·è¿›å…¥ä¿®æ”¹é¡µé¢ï¼Œåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºäº†ä¿®æ”¹é¡µé¢çš„ä¿¡æ¯</p><p>2ã€ç”¨æˆ·ä¿®æ”¹é¡µé¢çš„å†…å®¹ï¼Œç‚¹å‡»â€œæäº¤â€ï¼Œæç¤ºâ€œä¿®æ”¹æˆåŠŸâ€æˆ–â€œä¿®æ”¹å¤±è´¥â€</p><h2 id="1-åç«¯æ¥å£å®šä¹‰-1"><a href="#1-åç«¯æ¥å£å®šä¹‰-1" class="headerlink" title="1. åç«¯æ¥å£å®šä¹‰"></a>1. åç«¯æ¥å£å®šä¹‰</h2><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ é™¤æ¥å£</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id é¡µé¢id</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"åˆ é™¤é¡µé¢"</span>)<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">delete</span><span class="hljs-params">(String id)</span></span>;</code></pre></div><h2 id="2-æœåŠ¡ç«¯å¼€å‘-1"><a href="#2-æœåŠ¡ç«¯å¼€å‘-1" class="headerlink" title="2. æœåŠ¡ç«¯å¼€å‘"></a>2. æœåŠ¡ç«¯å¼€å‘</h2><h3 id="Daoå±‚-3"><a href="#Daoå±‚-3" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h3><p><code>dao</code>å±‚ ä½¿ç”¨ <code>MongoDB</code> æä¾›çš„daoæ¥å£æ¥å®ç°</p><h3 id="Serviceå±‚-3"><a href="#Serviceå±‚-3" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ ¹æ®idåˆ é™¤</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">deleteCmsPage</span><span class="hljs-params">(String id)</span></span>&#123;    <span class="hljs-comment">//æ£€ç´¢è¯¥é¡µé¢idæ˜¯å¦å­˜åœ¨</span>    Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(id);    <span class="hljs-keyword">if</span>(optional.isPresent())&#123;        <span class="hljs-comment">//åˆ é™¤å¹¶è¿”å›ç»“æœ</span>        cmsPageRepository.deleteById(id);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.FAIL);&#125;</code></pre></div><h3 id="Controllerå±‚-2"><a href="#Controllerå±‚-2" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ é™¤é¡µé¢</span><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id é¡µé¢id</span><span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span><span class="hljs-comment"> */</span><span class="hljs-meta">@DeleteMapping</span>(<span class="hljs-string">"/delete/&#123;id&#125;"</span>)<span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">delete</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id) </span>&#123;    <span class="hljs-keyword">return</span> pageService.deleteCmsPage(id);&#125;</code></pre></div><h3 id="æ¥å£æµ‹è¯•"><a href="#æ¥å£æµ‹è¯•" class="headerlink" title="æ¥å£æµ‹è¯•"></a>æ¥å£æµ‹è¯•</h3><p><a href="https://qnoss.codeyee.com/20200704_3/image18" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image18.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="3-å‰ç«¯å¼€å‘"><a href="#3-å‰ç«¯å¼€å‘" class="headerlink" title="3.å‰ç«¯å¼€å‘"></a>3.å‰ç«¯å¼€å‘</h2><h3 id="é¡µé¢ç¼–å†™"><a href="#é¡µé¢ç¼–å†™" class="headerlink" title="é¡µé¢ç¼–å†™"></a>é¡µé¢ç¼–å†™</h3><p>1ã€åœ¨ <code>page_list</code> é¡µé¢å†…æ–°å¢ä¸€ä¸ªåˆ é™¤æŒ‰é’®</p><div class="hljs"><pre><code class="hljs vue">&lt;el-table-column label&#x3D;&quot;åˆ é™¤&quot; width&#x3D;&quot;75&quot; fixed&#x3D;&quot;right&quot;&gt;  &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;    &lt;el-button      size&#x3D;&quot;mini&quot;      type&#x3D;&quot;danger&quot;      @click&#x3D;&quot;deletePage(scope.row.pageId)&quot;&gt;åˆ é™¤    &lt;&#x2F;el-button&gt;  &lt;&#x2F;template&gt;&lt;&#x2F;el-table-column&gt;</code></pre></div><p>2ã€åœ¨ <code>cms.js</code> å®šä¹‰åˆ é™¤çš„api</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åˆ é™¤æ¥å£</span>export <span class="hljs-keyword">const</span> page_delete = (id) =&gt;&#123;  <span class="hljs-keyword">return</span> http.requestDelete(apiUrl + <span class="hljs-string">"/cms/page/delete/"</span> + id)&#125;</code></pre></div><p>3ã€åˆ›å»º <code>deletePage</code> å‡½æ•°ï¼Œæ¥æ”¶åˆ° å½“å‰è¡Œçš„ <code>pageId</code></p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//åˆ é™¤é¡µé¢</span>deletePage(pageId) &#123;  <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">"æ­¤æ“ä½œå°†æ°¸ä¹…çš„åˆ é™¤è¯¥é¡µé¢"</span>, <span class="hljs-string">"æç¤º"</span>, &#123;    confirmButtonText: <span class="hljs-string">'ç¡®å®š'</span>,    cancelButtonText: <span class="hljs-string">'å–æ¶ˆ'</span>,    type: <span class="hljs-string">'warning'</span>  &#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;    cmsApi.page_delete(pageId).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;      <span class="hljs-keyword">if</span> (res.success) &#123;        <span class="hljs-keyword">this</span>.$message(&#123;          type: <span class="hljs-string">'success'</span>,          message: <span class="hljs-string">'åˆ é™¤æˆåŠŸ!'</span>        &#125;)        <span class="hljs-keyword">this</span>.query()      &#125; <span class="hljs-keyword">else</span> &#123;        <span class="hljs-keyword">this</span>.$message(&#123;          type: <span class="hljs-string">'warning'</span>,          message: <span class="hljs-string">'åˆ é™¤å¤±è´¥'</span>        &#125;);      &#125;    &#125;)  &#125;).catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;    <span class="hljs-keyword">this</span>.$message(&#123;      type: <span class="hljs-string">'info'</span>,      message: <span class="hljs-string">'å·²å–æ¶ˆåˆ é™¤'</span>    &#125;);  &#125;);&#125;,</code></pre></div><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><a href="https://qnoss.codeyee.com/20200704_3/image19" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image19.gif" srcset="/img/loading.gif" alt="img"></a></p><h1 id="äº”ã€å¼‚å¸¸å¤„ç†"><a href="#äº”ã€å¼‚å¸¸å¤„ç†" class="headerlink" title="äº”ã€å¼‚å¸¸å¤„ç†"></a>äº”ã€å¼‚å¸¸å¤„ç†</h1><h2 id="1-å¼‚å¸¸å¤„ç†çš„é—®é¢˜åˆ†æ"><a href="#1-å¼‚å¸¸å¤„ç†çš„é—®é¢˜åˆ†æ" class="headerlink" title="1. å¼‚å¸¸å¤„ç†çš„é—®é¢˜åˆ†æ"></a>1. å¼‚å¸¸å¤„ç†çš„é—®é¢˜åˆ†æ</h2><p>ä»æ·»åŠ é¡µé¢çš„serviceæ–¹æ³•ä¸­æ‰¾é—®é¢˜ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment">* æ·»åŠ é¡µé¢æ•°æ®</span><span class="hljs-comment">*/</span><span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;    <span class="hljs-comment">//éªŒè¯æ•°æ®å”¯ä¸€æ€§ï¼šsizeIdã€pageNameã€pageWebPath</span>    CmsPage cmsPage1 = cmsPageRepository.findByPageNameAndSiteIdAndPageWebPath(cmsPage.getPageName(), cmsPage.getSiteId(), cmsPage.getPageWebPath());    <span class="hljs-keyword">if</span> (cmsPage1 == <span class="hljs-keyword">null</span>) &#123;        <span class="hljs-comment">//ç«™ç‚¹idç”±mongoDBè‡ªåŠ¨ç”Ÿæˆï¼Œé˜²æ­¢å‰ç«¯ä¼ å€¼</span>        cmsPage.setPageId(<span class="hljs-keyword">null</span>);        CmsPage save = cmsPageRepository.save(cmsPage);        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS, save);    &#125;    <span class="hljs-comment">//æ·»åŠ å¤±è´¥</span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL, cmsPage);&#125;</code></pre></div><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a><strong>é—®é¢˜</strong></h3><p>1ã€ä¸Šè¾¹çš„ä»£ç åªè¦æ“ä½œä¸æˆåŠŸä»…å‘ç”¨æˆ·è¿”å›â€œé”™è¯¯ä»£ç ï¼š11111ï¼Œå¤±è´¥ä¿¡æ¯ï¼šæ“ä½œå¤±è´¥â€ï¼Œæ— æ³•åŒºåˆ«å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚</p><p>2ã€<code>service</code> æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹å‡ºç°å¼‚å¸¸åœ¨å“ªæ•è·ï¼Ÿåœ¨ <code>service</code> ä¸­éœ€è¦éƒ½åŠ  <code>try</code>/<code>catch</code>ï¼Œå¦‚æœåœ¨<code>controller</code> ä¹Ÿéœ€è¦æ·»åŠ  try/catchï¼Œä»£ç å†—ä½™ä¸¥é‡ä¸”ä¸æ˜“ç»´æŠ¤ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>1ã€åœ¨ <code>Service</code> æ–¹æ³•ä¸­çš„ç¼–ç é¡ºåºæ˜¯å…ˆæ ¡éªŒåˆ¤æ–­ï¼Œæœ‰é—®é¢˜åˆ™æŠ›å‡ºå…·ä½“çš„å¼‚å¸¸ä¿¡æ¯ï¼Œæœ€åæ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡æ“ä½œï¼Œè¿”å›æˆåŠŸä¿¡æ¯ã€‚</p><p>2ã€åœ¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»ä¸­å»æ•è·å¼‚å¸¸ï¼Œæ— éœ€<code>controller</code>æ•è·å¼‚å¸¸ï¼Œå‘ç”¨æˆ·è¿”å›ç»Ÿä¸€è§„èŒƒçš„å“åº”ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬çš„ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * æ·»åŠ é¡µé¢æ•°æ®</span><span class="hljs-comment"> */</span><span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;    <span class="hljs-comment">//æ•ˆéªŒcmsPageæ˜¯å¦ä¸ºç©º</span>    <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;        <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸ï¼Œéæ³•å‚æ•°</span>    &#125;    <span class="hljs-comment">//éªŒè¯æ•°æ®å”¯ä¸€æ€§ï¼šsizeIdã€pageNameã€pageWebPath</span>    CmsPage cmsPage1 = cmsPageRepository.findByPageNameAndSiteIdAndPageWebPath(cmsPage.getPageName(), cmsPage.getSiteId(), cmsPage.getPageWebPath());    <span class="hljs-comment">//æ£€éªŒé¡µé¢æ˜¯å¦å·²å­˜åœ¨</span>    <span class="hljs-keyword">if</span> (cmsPage1 != <span class="hljs-keyword">null</span>) &#123;        <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸</span>    &#125;    <span class="hljs-comment">//ç«™ç‚¹idç”±mongoDBè‡ªåŠ¨ç”Ÿæˆï¼Œé˜²æ­¢å‰ç«¯ä¼ å€¼</span>    cmsPage.setPageId(<span class="hljs-keyword">null</span>);    CmsPage save = cmsPageRepository.save(cmsPage);    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS, save);    <span class="hljs-comment">//æ·»åŠ å¤±è´¥</span>&#125;</code></pre></div><p>åœ¨æ‰§è¡Œæ­£å¸¸çš„é€»è¾‘ä¹‹å‰ï¼Œè¦æŠŠå·²çŸ¥çš„å¼‚å¸¸è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯å…¨éƒ¨é€šè¿‡åæ‰ä¼šå»æ‰§è¡Œæ­£å¸¸çš„é€»è¾‘ä»£ç ã€‚</p><h2 id="2-å¼‚å¸¸å¤„ç†æµç¨‹"><a href="#2-å¼‚å¸¸å¤„ç†æµç¨‹" class="headerlink" title="2. å¼‚å¸¸å¤„ç†æµç¨‹"></a>2. å¼‚å¸¸å¤„ç†æµç¨‹</h2><p>ç³»ç»Ÿå¯¹å¼‚å¸¸çš„å¤„ç†ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æµç¨‹ï¼š</p><p>1ã€è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹ã€‚</p><p>2ã€è‡ªå®šä¹‰é”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ã€‚</p><p>3ã€å¯¹äºå¯é¢„çŸ¥çš„å¼‚å¸¸ç”±ç¨‹åºå‘˜åœ¨ä»£ç ä¸­ä¸»åŠ¨æŠ›å‡ºï¼Œç”± <code>SpringMVC</code> ç»Ÿä¸€æ•è·ã€‚</p><p>å¯é¢„çŸ¥å¼‚å¸¸æ˜¯ç¨‹åºå‘˜åœ¨ä»£ç ä¸­æ‰‹åŠ¨æŠ›å‡ºæœ¬ç³»ç»Ÿå®šä¹‰çš„ç‰¹å®šå¼‚å¸¸ç±»å‹ï¼Œç”±äºæ˜¯ç¨‹åºå‘˜æŠ›å‡ºçš„å¼‚å¸¸ï¼Œé€šå¸¸å¼‚å¸¸ä¿¡æ¯æ¯”è¾ƒé½å…¨ï¼Œç¨‹åºå‘˜åœ¨æŠ›å‡ºæ—¶ä¼šæŒ‡å®šé”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ï¼Œè·å–å¼‚å¸¸ä¿¡æ¯ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚</p><p>4ã€å¯¹äºä¸å¯é¢„çŸ¥çš„å¼‚å¸¸ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰ç”±<code>SpringMVC</code>ç»Ÿä¸€æ•è· <code>Exception</code> ç±»å‹çš„å¼‚å¸¸ã€‚</p><p>ä¸å¯é¢„çŸ¥å¼‚å¸¸é€šå¸¸æ˜¯ç”±äºç³»ç»Ÿå‡ºç°bugã€æˆ–ä¸€äº›ä¸è¦æŠ—æ‹’çš„é”™è¯¯ï¼ˆæ¯”å¦‚ç½‘ç»œä¸­æ–­ã€æœåŠ¡å™¨å®•æœºç­‰ï¼‰ï¼Œå¼‚å¸¸ç±»å‹ä¸º <code>RuntimeException</code>ç±»å‹ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰ã€‚</p><p>5ã€å¯é¢„çŸ¥çš„å¼‚å¸¸åŠä¸å¯é¢„çŸ¥çš„è¿è¡Œæ—¶å¼‚å¸¸æœ€ç»ˆä¼šé‡‡ç”¨ç»Ÿä¸€çš„ä¿¡æ¯æ ¼å¼ï¼ˆé”™è¯¯ä»£ç +é”™è¯¯ä¿¡æ¯ï¼‰æ¥è¡¨ç¤ºï¼Œæœ€ç»ˆä¹Ÿä¼šéšè¯·æ±‚å“åº”ç»™å®¢æˆ·ç«¯ã€‚</p><p>å¼‚å¸¸æŠ›å‡ºåŠå¤„ç†æµç¨‹ï¼š</p><p><a href="https://qnoss.codeyee.com/20200704_3/image20" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image20.png" srcset="/img/loading.gif" alt="img"></a></p><p>1ã€åœ¨ <code>controller</code>ã€<code>service</code>ã€<code>dao</code> ä¸­ç¨‹åºå‘˜æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ï¼›<code>springMVC</code> æ¡†æ¶æŠ›å‡ºæ¡†æ¶å¼‚å¸¸ç±»å‹</p><p>2ã€ç»Ÿä¸€ç”±å¼‚å¸¸æ•è·ç±»æ•è·å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œå¤„ç†</p><p>3ã€æ•è·åˆ°è‡ªå®šä¹‰å¼‚å¸¸åˆ™ç›´æ¥å–å‡ºé”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ï¼Œå“åº”ç»™ç”¨æˆ·</p><p>4ã€æ•è·åˆ°éè‡ªå®šä¹‰å¼‚å¸¸ç±»å‹é¦–å…ˆä» <code>Map</code> ä¸­æ‰¾è¯¥å¼‚å¸¸ç±»å‹æ˜¯å¦å¯¹åº”å…·ä½“çš„é”™è¯¯ä»£ç ï¼Œå¦‚æœæœ‰åˆ™å–å‡ºé”™è¯¯ä»£ç å’Œé”™è¯¯ä¿¡æ¯å¹¶å“åº”ç»™ç”¨æˆ·ï¼Œå¦‚æœä» <code>Map</code> ä¸­æ‰¾ä¸åˆ°å¼‚å¸¸ç±»å‹æ‰€å¯¹åº”çš„é”™è¯¯ä»£ç åˆ™ç»Ÿä¸€ä¸º <code>99999</code> é”™è¯¯ä»£ç å¹¶å“åº”ç»™ç”¨æˆ·ã€‚</p><p>5ã€å°†é”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ä»¥ <code>Json</code> æ ¼å¼å“åº”ç»™ç”¨æˆ·ã€‚</p><h2 id="3-å¯é¢„çŸ¥å¼‚å¸¸å¤„ç†"><a href="#3-å¯é¢„çŸ¥å¼‚å¸¸å¤„ç†" class="headerlink" title="3. å¯é¢„çŸ¥å¼‚å¸¸å¤„ç†"></a>3. å¯é¢„çŸ¥å¼‚å¸¸å¤„ç†</h2><h3 id="è‡ªå®šä¹‰å¼‚å¸¸ç±»"><a href="#è‡ªå®šä¹‰å¼‚å¸¸ç±»" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸ç±»"></a>è‡ªå®šä¹‰å¼‚å¸¸ç±»</h3><p>åœ¨commonå·¥ç¨‹å®šä¹‰å¼‚å¸¸ç±»å‹ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>&#123;    <span class="hljs-keyword">private</span> ResultCode resultCode;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomException</span><span class="hljs-params">(ResultCode resultCode)</span></span>&#123;        <span class="hljs-comment">//å¼‚å¸¸ä¿¡æ¯ä¸ºé”™è¯¯ä»£ç +å¼‚å¸¸ä¿¡æ¯</span>        <span class="hljs-keyword">super</span>(<span class="hljs-string">"é”™è¯¯ä»£ç : "</span> + resultCode.code() + <span class="hljs-string">" é”™è¯¯ä¿¡æ¯: "</span> + resultCode.message());        <span class="hljs-keyword">this</span>.resultCode = resultCode;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultCode <span class="hljs-title">getResultCode</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.resultCode;    &#125;&#125;</code></pre></div><p>ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ªåä¸º <code>CustomException</code> çš„å¼‚å¸¸ï¼Œå¹¶ä¸”ç»§æ‰¿äº† <code>RuntimeException</code> å¼‚å¸¸ç±»ï¼Œæœ‰çš„äººå¯èƒ½ä¼šé—®ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ç›´æ¥ç»§æ‰¿ <code>Exception</code> ç±»ï¼Ÿå› ä¸ºå¦‚æœç»§æ‰¿äº† <code>Exception</code> ç±»ï¼Œæˆ‘ä»¬åœ¨æŠ›å‡ºå¼‚å¸¸æ—¶å¯¹ä»£ç ä¼šæœ‰ä¸€å®šçš„ä¾µå…¥æ€§ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦åœ¨æŠ›å‡ºè¯¥å¼‚å¸¸çš„æ–¹æ³•å‰åŠ å…¥ <code>throws Exception</code> ï¼Œä¾‹å¦‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;&#125;</code></pre></div><p>æˆ–è€…ä½¿ç”¨</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;    <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸ï¼Œéæ³•å‚æ•°</span>&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;    e.printStackTrace();&#125;</code></pre></div><p>è€Œæˆ‘ä»¬å¦‚æœä½¿ç”¨ <code>RuntimeException</code> ,è‡³éœ€è¦åœ¨æŠ›å‡ºå¼‚å¸¸çš„åœ°æ–¹å†™å…¥ä¸‹é¢ä»£ç å°±èƒ½æŠ›å‡ºæˆ‘ä»¬è‡ªå®šä¹‰çš„å¼‚å¸¸</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomException(resultCode);</code></pre></div><h3 id="æŠ›å‡ºå¼‚å¸¸ç±»"><a href="#æŠ›å‡ºå¼‚å¸¸ç±»" class="headerlink" title="æŠ›å‡ºå¼‚å¸¸ç±»"></a>æŠ›å‡ºå¼‚å¸¸ç±»</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionCast</span> </span>&#123;    <span class="hljs-comment">//ä½¿ç”¨æ­¤é™æ€æ–¹æ³•æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cast</span><span class="hljs-params">(ResultCode resultCode)</span> </span>&#123;        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomException(resultCode);    &#125;&#125;</code></pre></div><h3 id="å¼‚å¸¸æ•è·ç±»"><a href="#å¼‚å¸¸æ•è·ç±»" class="headerlink" title="å¼‚å¸¸æ•è·ç±»"></a>å¼‚å¸¸æ•è·ç±»</h3><p>ä½¿ç”¨ @ControllerAdviceå’Œ@ExceptionHandleræ³¨è§£æ¥æ•è·æŒ‡å®šç±»å‹çš„å¼‚å¸¸</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<span class="hljs-keyword">import</span> org.slf4j.Logger;<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<span class="hljs-meta">@ControllerAdvice</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionCatch</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ExceptionCatch<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;    <span class="hljs-comment">//æ•è· CustomException å¼‚å¸¸</span>    <span class="hljs-meta">@ExceptionHandler</span>(CustomException<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class">    @<span class="hljs-title">ResponseBody</span></span><span class="hljs-class">    <span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">customException</span>(<span class="hljs-title">CustomException</span> <span class="hljs-title">e</span>)</span>&#123;        LOGGER.error(<span class="hljs-string">"catch exceptionï¼š&#123;&#125;\r\nExceptionï¼š"</span>,e.getMessage(),e);        ResultCode resultCode = e.getResultCode();        ResponseResult responseResult = <span class="hljs-keyword">new</span> ResponseResult(resultCode);        <span class="hljs-keyword">return</span> responseResult;    &#125;&#125;</code></pre></div><h3 id="å¼‚å¸¸å¤„ç†æµ‹è¯•"><a href="#å¼‚å¸¸å¤„ç†æµ‹è¯•" class="headerlink" title="å¼‚å¸¸å¤„ç†æµ‹è¯•"></a>å¼‚å¸¸å¤„ç†æµ‹è¯•</h3><h4 id="1ï¼‰å®šä¹‰é”™è¯¯ä»£ç "><a href="#1ï¼‰å®šä¹‰é”™è¯¯ä»£ç " class="headerlink" title="1ï¼‰å®šä¹‰é”™è¯¯ä»£ç "></a>1ï¼‰å®šä¹‰é”™è¯¯ä»£ç </h4><p>æ¯ä¸ªä¸šåŠ¡æ“ä½œçš„å¼‚å¸¸ä½¿ç”¨å¼‚å¸¸ä»£ç å»æ ‡è¯†ã€‚</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.model.response;<span class="hljs-keyword">import</span> lombok.ToString;<span class="hljs-meta">@ToString</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> CmsCode implements ResultCode &#123;    CMS_ADDPAGE_EXISTS(<span class="hljs-keyword">false</span>,<span class="hljs-number">24001</span>,<span class="hljs-string">"é¡µé¢å·²å­˜åœ¨ï¼"</span>);    <span class="hljs-comment">//æ“ä½œç»“æœ</span>    <span class="hljs-keyword">boolean</span> success;    <span class="hljs-comment">//æ“ä½œä»£ç </span>    <span class="hljs-keyword">int</span> code;    <span class="hljs-comment">//æç¤ºä¿¡æ¯</span>    String message;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">CmsCode</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> success, <span class="hljs-keyword">int</span> code, String message)</span></span>&#123;        <span class="hljs-keyword">this</span>.success = success;        <span class="hljs-keyword">this</span>.code = code;        <span class="hljs-keyword">this</span>.message = message;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">success</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> success;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">code</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> code;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">message</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> message;    &#125;&#125;</code></pre></div><h4 id="2ï¼‰å¼‚å¸¸å¤„ç†æµ‹è¯•"><a href="#2ï¼‰å¼‚å¸¸å¤„ç†æµ‹è¯•" class="headerlink" title="2ï¼‰å¼‚å¸¸å¤„ç†æµ‹è¯•"></a>2ï¼‰å¼‚å¸¸å¤„ç†æµ‹è¯•</h4><p>1ã€æŠ›å‡ºå¼‚å¸¸</p><p>å›åˆ°æˆ‘ä»¬ <code>PageService</code> ä¸­çš„ <code>addCmsPage</code> æŠ›å‡ºå¼‚å¸¸</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ£€éªŒé¡µé¢æ˜¯å¦å·²å­˜åœ¨</span><span class="hljs-keyword">if</span> (cmsPage1 != <span class="hljs-keyword">null</span>) &#123;    <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸</span>    ExceptionCast.cast(CmsCode.CMS_ADDPAGE_EXISTS);&#125;</code></pre></div><p>2ã€åœ¨å¯åŠ¨å·¥ç¨‹ä¸­æ‰«æå¼‚å¸¸æ•è·ç±»</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)  <span class="hljs-comment">// æ‰«æframeworkä¸‹çš„å¼‚å¸¸æ•è·ç±»</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCmsApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(ManageCmsApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;    &#125;&#125;</code></pre></div><p>3ã€å‰ç«¯å±•ç¤ºå¼‚å¸¸ä¿¡æ¯</p><p>åœ¨å‰ç«¯æ–°å¢é¡µé¢çš„è¡¨å•æäº¤ä¸­å¢åŠ åˆ¤æ–­</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(res.message)&#123;<span class="hljs-keyword">this</span>.$message.error(res.message)&#125;</code></pre></div><p>å…¨éƒ¨ä»£ç å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æäº¤è¡¨å•</span>addSubmit() &#123;  <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;    <span class="hljs-keyword">if</span> (valid) &#123;      <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤æäº¤å—ï¼Ÿ'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;        cmsApi.page_add(<span class="hljs-keyword">this</span>.pageForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;          <span class="hljs-built_in">console</span>.log(res);          <span class="hljs-keyword">if</span> (res.success) &#123;            <span class="hljs-keyword">this</span>.$message(&#123;              message: <span class="hljs-string">'æäº¤æˆåŠŸ'</span>,              type: <span class="hljs-string">'success'</span>            &#125;);            <span class="hljs-keyword">this</span>.$refs[<span class="hljs-string">'pageForm'</span>].resetFields();          &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(res.message)&#123;            <span class="hljs-keyword">this</span>.$message.error(res.message)          &#125;          <span class="hljs-keyword">else</span> &#123;            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);          &#125;        &#125;);      &#125;);    &#125;  &#125;)&#125;,</code></pre></div><p>æµ‹è¯•</p><p><a href="https://qnoss.codeyee.com/20200704_3/image21" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image21.png" srcset="/img/loading.gif" alt="img"></a></p><h2 id="4-ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸å¤„ç†"><a href="#4-ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="4. ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸å¤„ç†"></a>4. ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸å¤„ç†</h2><h4 id="1ï¼‰å®šä¹‰å¼‚å¸¸æ•è·æ–¹æ³•"><a href="#1ï¼‰å®šä¹‰å¼‚å¸¸æ•è·æ–¹æ³•" class="headerlink" title="1ï¼‰å®šä¹‰å¼‚å¸¸æ•è·æ–¹æ³•"></a>1ï¼‰å®šä¹‰å¼‚å¸¸æ•è·æ–¹æ³•</h4><h5 id="æŠ›å‡ºå¼‚å¸¸æµ‹è¯•"><a href="#æŠ›å‡ºå¼‚å¸¸æµ‹è¯•" class="headerlink" title="æŠ›å‡ºå¼‚å¸¸æµ‹è¯•"></a>æŠ›å‡ºå¼‚å¸¸æµ‹è¯•</h5><p>ä½¿ç”¨postmanæµ‹è¯•æ·»åŠ é¡µé¢ï¼Œä¸è¾“å…¥cmsPostä¿¡æ¯ï¼Œæäº¤ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs json">org.springframework.http.converter.HttpMessageNotReadableExceptionæ­¤å¼‚å¸¸æ˜¯springMVCåœ¨è¿›è¡Œå‚æ•°è½¬æ¢æ—¶æŠ¥çš„é”™è¯¯ã€‚&#123;    <span class="hljs-attr">"timestamp"</span>: <span class="hljs-number">1528712906727</span>,    <span class="hljs-attr">"status"</span>: <span class="hljs-number">400</span>,    <span class="hljs-attr">"error"</span>: <span class="hljs-string">"Bad Request"</span>,    <span class="hljs-attr">"exception"</span>: <span class="hljs-string">"org.springframework.http.converter.HttpMessageNotReadableException"</span>,    <span class="hljs-attr">"message"</span>: <span class="hljs-string">"Required request body is missing: public</span><span class="hljs-string">    com.xuecheng.framework.domain.cms.response.CmsPageResult</span><span class="hljs-string">    com.xuecheng.manage_cms.web.controller.CmsPageController.add(com.xuecheng.framework.domain.cms.C</span><span class="hljs-string">    msPage)"</span>,    <span class="hljs-attr">"path"</span>: <span class="hljs-string">"/cms/page/add"</span>&#125;</code></pre></div><p>ä¸Šè¾¹çš„å“åº”ä¿¡æ¯åœ¨å®¢æˆ·ç«¯æ˜¯æ— æ³•è§£æçš„ã€‚</p><p>åœ¨å¼‚å¸¸æ•è·ç±» <code>ExceptionCatch</code> ä¸­æ·»åŠ å¯¹Exceptionå¼‚å¸¸çš„æ•è·ï¼Œä¸‹é¢å¤§è‡´çš„ä»£ç ç»“æ„ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ExceptionHandler</span>(Exception<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class">@<span class="hljs-title">ResponseBody</span></span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">exception</span>(<span class="hljs-title">Exception</span> <span class="hljs-title">exception</span>)</span>&#123;    <span class="hljs-comment">//è®°å½•æ—¥å¿—</span>    LOGGER.error(<span class="hljs-string">"catch exception:&#123;&#125;"</span>,exception.getMessage());    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;&#125;</code></pre></div><h5 id="å¼‚å¸¸æ•è·æ–¹æ³•"><a href="#å¼‚å¸¸æ•è·æ–¹æ³•" class="headerlink" title="å¼‚å¸¸æ•è·æ–¹æ³•"></a>å¼‚å¸¸æ•è·æ–¹æ³•</h5><p>é’ˆå¯¹ä¸Šè¾¹çš„é—®é¢˜å…¶è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p><ol><li>æˆ‘ä»¬åœ¨mapä¸­é…ç½®HttpMessageNotReadableExceptionå’Œé”™è¯¯ä»£ç ã€‚</li><li>åœ¨å¼‚å¸¸æ•è·ç±»ä¸­å¯¹Exceptionå¼‚å¸¸è¿›è¡Œæ•è·ï¼Œå¹¶ä»mapä¸­è·å–å¼‚å¸¸ç±»å‹å¯¹åº”çš„é”™è¯¯ä»£ç ï¼Œå¦‚æœå­˜åœ¨é”™è¯¯ä»£ç åˆ™è¿”å›æ­¤é”™è¯¯ï¼Œå¦åˆ™ç»Ÿä¸€è¿”å›99999é”™è¯¯ã€‚</li></ol><p>å…·ä½“çš„å¼€å‘å®ç°å¦‚ä¸‹ï¼š</p><p>1ã€åœ¨é€šç”¨é”™è¯¯ä»£ç ç±»CommCodeä¸­é…ç½®éæ³•å‚æ•°å¼‚å¸¸</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ToString</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> CommonCode implements ResultCode&#123;    INVALID_PARAM(<span class="hljs-keyword">false</span>,<span class="hljs-number">10003</span>,<span class="hljs-string">"éæ³•å‚æ•°ï¼"</span>),    <span class="hljs-comment">/**å…¶ä»–ä»£ç çœç•¥**/</span>&#125;</code></pre></div><p>2ã€åœ¨å¼‚å¸¸æ•è·ç±»ä¸­é…ç½® HttpMessageNotReadableException ä¸ºéæ³•å‚æ•°å¼‚å¸¸ã€‚</p><p>å…·ä½“çš„è¯´æ˜æˆ‘éƒ½å†™åœ¨æ³¨é‡Šå½“ä¸­äº†ï¼Œå°±ä¸å¤šåšè§£é‡Šï¼Œç›´æ¥çœ‹ä»£ç </p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;<span class="hljs-keyword">import</span> com.google.common.collect.ImmutableMap;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;<span class="hljs-keyword">import</span> org.slf4j.Logger;<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<span class="hljs-keyword">import</span> org.springframework.http.converter.HttpMessageNotReadableException;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;<span class="hljs-comment">/**</span><span class="hljs-comment"> * ç»Ÿä¸€å¼‚å¸¸æ•è·ç±»</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-09  11:12</span><span class="hljs-comment"> */</span><span class="hljs-meta">@ControllerAdvice</span><span class="hljs-comment">//æ§åˆ¶å™¨å¢å¼º</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionCatch</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ExceptionCatch<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;    <span class="hljs-comment">//å®šä¹‰mapï¼Œé…ç½®å¼‚å¸¸ç±»å‹æ‰€å¯¹åº”çš„é”™è¯¯ä»£ç ï¼ˆImmutableMap åªè¯»ï¼Œçº¿ç¨‹å®‰å…¨</span>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ImmutableMap&lt;Class&lt;? extends Throwable&gt;,ResultCode&gt; EXCEPTIONS;    <span class="hljs-comment">//å®šä¹‰mapçš„builderå¯¹è±¡ï¼Œå»æ„å»ºimmutablemap</span>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> ImmutableMap.Builder&lt;Class&lt;? extends Throwable&gt;,ResultCode&gt; builder = ImmutableMap.builder();    <span class="hljs-comment">//æ•è·CustomExceptionç±»çš„å¼‚å¸¸</span>    <span class="hljs-meta">@ExceptionHandler</span>(CustomException<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class">    <span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">customException</span>(<span class="hljs-title">CustomException</span> <span class="hljs-title">customException</span>)</span>&#123;        <span class="hljs-comment">//è®°å½•æ—¥å¿—</span>        LOGGER.error(<span class="hljs-string">"catch exception:&#123;&#125;"</span>,customException.getMessage());        ResultCode resultCode = customException.getResultCode();        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(resultCode);    &#125;    <span class="hljs-comment">//æ•è·Exceptionç±»çš„å¼‚å¸¸</span>    <span class="hljs-meta">@ExceptionHandler</span>(Exception<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class">    @<span class="hljs-title">ResponseBody</span></span><span class="hljs-class">    <span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">exception</span>(<span class="hljs-title">Exception</span> <span class="hljs-title">exception</span>)</span>&#123;        <span class="hljs-comment">//è®°å½•æ—¥å¿—</span>        LOGGER.error(<span class="hljs-string">"catch exception:&#123;&#125;"</span>,exception.getMessage());        <span class="hljs-keyword">if</span> (EXCEPTIONS == <span class="hljs-keyword">null</span>)&#123;            EXCEPTIONS = builder.build();<span class="hljs-comment">//EXCEPTIONSæ„å»ºæˆåŠŸ</span>        &#125;        <span class="hljs-comment">//ä»EXCEPTIONSä¸­æ‰¾å‡ºå¼‚å¸¸ç±»å‹æ‰€å¯¹åº”çš„é”™è¯¯ä»£ç ï¼Œå¦‚æœæ‰¾åˆ°äº†å°†é”™è¯¯ä»£ç å“åº”ç»™ç”¨æˆ·</span>        <span class="hljs-comment">// å¦‚æœæ‰¾ä¸åˆ°ç»™ç”¨æˆ·å“åº”99999å¼‚å¸¸</span>        ResultCode resultCode = EXCEPTIONS.get(exception.getClass());        <span class="hljs-keyword">if</span> (resultCode != <span class="hljs-keyword">null</span>)&#123;            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(resultCode);        &#125;<span class="hljs-keyword">else</span> &#123;            <span class="hljs-comment">//å¦‚æœéé¢„å®šä¹‰çš„é”™è¯¯ï¼Œåˆ™è¿”å›æœåŠ¡å™¨é”™è¯¯</span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SERVER_ERROR);        &#125;    &#125;    <span class="hljs-keyword">static</span> &#123;        builder.put(HttpMessageNotReadableException<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">CommonCode</span>.<span class="hljs-title">INVALID_PARAM</span>)</span>;    &#125;&#125;</code></pre></div><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæ˜¯å¦èƒ½æˆåŠŸæ•æŠ“åˆ°è¯¥å¼‚å¸¸</p><p><a href="https://qnoss.codeyee.com/20200704_3/image22" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image22.png" srcset="/img/loading.gif" alt="img"></a></p><p>æˆ‘ä»¬æ”¹æˆ GET è¯·æ±‚è¿›è¡Œæµ‹è¯•ï¼Œç”±äºæˆ‘ä»¬æ²¡æœ‰é¢„å®šè¿™ç§å¼‚å¸¸çš„é”™è¯¯ä»£ç ï¼Œæ‰€ä»¥ç»Ÿä¸€è¿”å›99999é”™è¯¯ä»£ç </p><p><a href="https://qnoss.codeyee.com/20200704_3/image23" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image23.png" srcset="/img/loading.gif" alt="img"></a></p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Spring Data MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day02ï¼šCMSå‰ç«¯å¼€å‘</title>
    <link href="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/"/>
    <url>/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day02</code> çš„å†…å®¹</p><ul><li><code>vue</code> åŸºç¡€è¯­æ³•</li><li>å¯¹ <code>webpack</code>ä¸ <code>webpack-dev-server</code> çš„åŸºæœ¬ä½¿ç”¨ï¼Œç†è§£ <code>webpack</code> çš„æ‰“åŒ…è¿‡ç¨‹ã€‚</li><li><code>CMS</code> å‰ç«¯å·¥ç¨‹çš„åŸºç¡€æ„å»º</li><li>è§£å†³å‰ç«¯è·¨åŸŸè¯·æ±‚çš„é—®é¢˜ï¼Œå¹¶ç†è§£å‰ç«¯è¯·æ±‚æ•°æ®çš„æµç¨‹ã€‚</li><li>é…åˆä½¿ç”¨ <code>Element-UI</code> çš„ <code>table</code> ç»„ä»¶è¿›è¡Œåˆ†é¡µæŸ¥è¯¢</li></ul><h1 id="ä¸€ã€vueåŸºç¡€"><a href="#ä¸€ã€vueåŸºç¡€" class="headerlink" title="ä¸€ã€vueåŸºç¡€"></a>ä¸€ã€vueåŸºç¡€</h1><p>vueåŸºç¡€éƒ¨åˆ†å†…å®¹çš„ç¬”è®°ç•¥è¿‡ï¼Œå¦‚è¿‡ä½ ä»éœ€è¦è¯¥é˜¶æ®µçš„å­¦ä¹ ï¼Œé˜…è¯»å®˜æ–¹çš„è®²ä¹‰æˆ–è€…ç§»æ­¥ï¼š<a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener">https://cn.vuejs.org/v2/guide/</a> è¿›è¡Œé˜…è¯»å’Œç»ƒä¹ ã€‚</p><h1 id="äºŒã€webpackå…¥é—¨"><a href="#äºŒã€webpackå…¥é—¨" class="headerlink" title="äºŒã€webpackå…¥é—¨"></a>äºŒã€webpackå…¥é—¨</h1><h2 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h2><p>ä½¿ç”¨vue.jså¼€å‘å¤§å‹åº”ç”¨éœ€è¦ä½¿ç”¨ <code>webpack</code> æ‰“åŒ…å·¥å…·ï¼Œæœ¬èŠ‚ç ”ç©¶webpackçš„ä½¿ç”¨æ–¹æ³•ã€‚</p><p>Webpack æ˜¯ä¸€ä¸ªå‰ç«¯èµ„æºçš„æ‰“åŒ…å·¥å…·ï¼Œå®ƒå¯ä»¥å°†jsã€imageã€cssç­‰èµ„æºå½“æˆä¸€ä¸ªæ¨¡å—è¿›è¡Œæ‰“åŒ…ã€‚</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image7.png" srcset="/img/loading.gif" alt></p><h2 id="2-ä½¿ç”¨webpackæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ"><a href="#2-ä½¿ç”¨webpackæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ" class="headerlink" title="2. ä½¿ç”¨webpackæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ"></a>2. ä½¿ç”¨webpackæœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ</h2><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒWebpack å¯ä»¥å°†jsã€cssã€pngç­‰å¤šç§é™æ€èµ„æº è¿›è¡Œæ‰“åŒ…</p><ul><li>æ¨¡å—åŒ–å¼€å‘<br>ç¨‹åºå‘˜åœ¨å¼€å‘æ—¶å¯ä»¥åˆ†æ¨¡å—åˆ›å»ºä¸åŒçš„jsã€ cssç­‰å°æ–‡ä»¶æ–¹ä¾¿å¼€å‘ï¼Œæœ€åä½¿ç”¨webpackå°†è¿™äº›å°æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªæ–‡<br>ä»¶ï¼Œå‡å°‘äº†httpçš„è¯·æ±‚æ¬¡æ•°ã€‚<br>webpackå¯ä»¥å®ç°æŒ‰éœ€æ‰“åŒ…ï¼Œä¸ºäº†é¿å…å‡ºç°æ‰“åŒ…æ–‡ä»¶è¿‡å¤§å¯ä»¥æ‰“åŒ…æˆå¤šä¸ªæ–‡ä»¶ã€‚</li><li>ç¼–è¯‘typescriptã€ES6ç­‰é«˜çº§jsè¯­æ³•<br>éšç€å‰ç«¯æŠ€æœ¯çš„å¼ºå¤§ï¼Œå¼€å‘ä¸­å¯ä»¥ä½¿ç”¨javascriptçš„å¾ˆå¤šé«˜çº§ç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼štypescriptã€ES6ç­‰ï¼Œæ–¹ä¾¿å¼€å‘ï¼Œ<br>webpackå¯ä»¥å°†æ‰“åŒ…æ–‡ä»¶è½¬æ¢æˆæµè§ˆå™¨å¯è¯†åˆ«çš„jsè¯­æ³•ã€‚</li><li>CSSé¢„ç¼–è¯‘<br>webpackå…è®¸åœ¨å¼€å‘ä¸­ä½¿ç”¨Sass å’Œ Lessç­‰åŸç”ŸCSSçš„æ‰©å±•æŠ€æœ¯ï¼Œé€šè¿‡sass-loaderã€less-loaderå°†Sass å’Œ Lessçš„<br>è¯­æ³•ç¼–è¯‘æˆæµè§ˆå™¨å¯è¯†åˆ«çš„cssè¯­æ³•ã€‚</li></ul><h2 id="3-webpackçš„ç¼ºç‚¹"><a href="#3-webpackçš„ç¼ºç‚¹" class="headerlink" title="3. webpackçš„ç¼ºç‚¹"></a>3. webpackçš„ç¼ºç‚¹</h2><p>1ã€é…ç½®æœ‰äº›ç¹ç<br>2ã€æ–‡æ¡£ä¸ä¸°å¯Œ</p><h2 id="4-å®‰è£…-npm"><a href="#4-å®‰è£…-npm" class="headerlink" title="4.å®‰è£… npm"></a>4.å®‰è£… npm</h2><p><code>node.js</code> å·²ç»é›†æˆäº†npmå·¥å…·ï¼Œåœ¨å‘½ä»¤æç¤ºç¬¦è¾“å…¥ npm -v å¯æŸ¥çœ‹å½“å‰npmç‰ˆæœ¬ï¼Œnodeå¯ä»¥ç›´æ¥å»å®˜ç½‘ä¸‹è½½å®‰è£…</p><p>è®¾ç½®åŒ…è·¯å¾„</p><div class="hljs"><pre><code class="hljs shell">npm config set prefix "C:\Program Files\nodejs\npm_modules"npm config set cache "c:\Program Files\nodejs\npm_cache"</code></pre></div><h2 id="5-å®‰è£…-cnpm"><a href="#5-å®‰è£…-cnpm" class="headerlink" title="5. å®‰è£… cnpm"></a>5. å®‰è£… cnpm</h2><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><div class="hljs"><pre><code class="hljs shell">npm install -g cnpm --registry=https://registry.npm.taobao.org</code></pre></div><p>å®‰è£…å®Œæˆåæ‰§è¡Œå‘½ä»¤ <code>cnpm -v</code></p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image8.png" srcset="/img/loading.gif" alt></p><h2 id="6-å®‰è£…-webpack"><a href="#6-å®‰è£…-webpack" class="headerlink" title="6. å®‰è£… webpack"></a>6. å®‰è£… webpack</h2><p><strong>node.js å®‰è£…åŒ…åˆ†ä¸ºä¸¤ç§æ¨¡å¼</strong></p><ul><li>æœ¬åœ°å®‰è£…ï¼šä»…å°†webpackå®‰è£…åœ¨å½“å‰é¡¹ç›®çš„node_modulesç›®å½•ä¸­ï¼Œä»…å¯¹å½“å‰é¡¹ç›®æœ‰æ•ˆã€‚</li><li>å…¨å±€å®‰è£…ï¼šå°†webpackå®‰è£…åœ¨æœ¬æœºï¼Œå¯¹æ‰€æœ‰é¡¹ç›®æœ‰æ•ˆï¼Œå…¨å±€å®‰è£…ä¼šé”å®šä¸€ä¸ªwebpackç‰ˆæœ¬ï¼Œè¯¥ç‰ˆæœ¬å¯èƒ½ä¸é€‚ç”¨æŸä¸ªé¡¹ç›®ã€‚å…¨å±€å®‰è£…éœ€è¦æ·»åŠ  -g å‚æ•°</li></ul><p><strong>æœ¬åœ°å®‰è£…</strong></p><div class="hljs"><pre><code class="hljs shell">npm install --save-dev webpack æˆ– cnpm install --save-dev webpacknpm install --save-dev webpack-cli (4.0ä»¥åçš„ç‰ˆæœ¬éœ€è¦å®‰è£…webpack-cli)</code></pre></div><p><strong>å…¨å±€å®‰è£…</strong></p><p>å…¨å±€å®‰è£…åŠ -gï¼Œå¦‚ä¸‹ï¼šå…¨å±€å®‰è£…å°±å°†webpackçš„jsåŒ…ä¸‹è½½åˆ°npmçš„åŒ…è·¯å¾„ä¸‹ã€‚</p><div class="hljs"><pre><code class="hljs shell">npm install webpack -g æˆ– cnpm install webpack -g</code></pre></div><p><strong>å®‰è£… webpack æŒ‡å®šçš„ç‰ˆæœ¬ï¼š</strong><br>è¿›å…¥webpacktestæµ‹è¯•ç›®å½•ï¼Œè¿è¡Œï¼š<code>cnpm install --save-dev webpack@3.6.0</code><br>å…¨å±€å®‰è£…ï¼š<code>npm install webpack@3.6.0 -g</code> æˆ– <code>cnpm install webpack@3.6.0 -g</code></p><h2 id="7-å…¥é—¨ç¨‹åº"><a href="#7-å…¥é—¨ç¨‹åº" class="headerlink" title="7. å…¥é—¨ç¨‹åº"></a>7. å…¥é—¨ç¨‹åº</h2><p>é€šè¿‡æœ¬å…¥é—¨ç¨‹åºä½“ä¼šwebpackæ‰“åŒ…çš„è¿‡ç¨‹åŠæ¨¡å—åŒ–å¼€å‘çš„æ€æƒ³ã€‚</p><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>é€šè¿‡å…¥é—¨ç¨‹åºå®ç°å¯¹jsæ–‡ä»¶çš„æ‰“åŒ…ï¼Œä½“ä¼šwebpackæ˜¯å¦‚ä½•å¯¹åº”ç”¨è¿›è¡Œæ¨¡å—åŒ–ç®¡ç†ã€‚<br>å¯¹ä¸Šè¾¹1+1=2çš„ä¾‹å­ä½¿ç”¨webpackè¿›è¡Œæ¨¡å—åŒ–ç®¡ç†</p><h3 id="å®šä¹‰-model01-js"><a href="#å®šä¹‰-model01-js" class="headerlink" title="å®šä¹‰ model01.js"></a>å®šä¹‰ model01.js</h3><p>åœ¨<code>webpacktest01</code>ç›®å½•ä¸‹åˆ›å»º<code>model01.js</code></p><p>å°†æœ¬ç¨‹åºä½¿ç”¨çš„åŠ æ³•è¿ç®—çš„jsæ–¹æ³•æŠ½å–åˆ°ä¸€ä¸ªjsæ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å— ï¼Œä»£ç å¦‚ä¸‹</p><div class="hljs"><pre><code class="hljs javascript"><span class="hljs-comment">//å®šä¹‰addå‡½æ•°</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">x, y</span>) </span>&#123;    <span class="hljs-keyword">return</span> x+y;&#125;<span class="hljs-comment">//å¯¼å‡ºaddå‡½æ•°</span><span class="hljs-built_in">module</span>.exports.add = add;</code></pre></div><h3 id="å®šä¹‰main-js"><a href="#å®šä¹‰main-js" class="headerlink" title="å®šä¹‰main.js"></a>å®šä¹‰main.js</h3><p>åœ¨<code>webpacktest01</code>ç›®å½•ä¸‹åˆ›å»º<code>main.js</code>ï¼Œ<code>main.js</code>æ˜¯æœ¬ç¨‹åºçš„jsä¸»æ–‡ä»¶ï¼ŒåŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š</p><p>1ã€åœ¨æ­¤æ–‡ä»¶ä¸­ä¼šå¼•ç”¨model01.jsæ¨¡å—<br>2ã€å¼•ç”¨vue.min.jsï¼ˆå®ƒä¹Ÿä¸€ä¸ªæ¨¡å—ï¼‰<br>3ã€å°†htmlé¡µé¢ä¸­æ„å»ºvueå®ä¾‹çš„ä»£ç æ”¾åœ¨main.jsä¸­ã€‚</p><div class="hljs"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> &#123;add&#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./model01.js"</span>)<span class="hljs-keyword">var</span> Vue = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./vue.min"</span>)<span class="hljs-comment">// å®ä¾‹åŒ–Vueå¯¹è±¡</span><span class="hljs-comment">//vm :å«åšMVVMä¸­çš„ View Model</span><span class="hljs-keyword">var</span> VM = <span class="hljs-keyword">new</span> Vue(&#123;    el:<span class="hljs-string">"#app"</span>,<span class="hljs-comment">//è¡¨ç¤ºå½“å‰vueå¯¹è±¡æ¥ç®¡appçš„divåŒºåŸŸ</span>    data:&#123;        name:<span class="hljs-string">'é»‘é©¬ç¨‹åºå‘˜'</span>,<span class="hljs-comment">// ç›¸å½“äºæ˜¯MVVMä¸­çš„Modelè¿™ä¸ªè§’è‰²</span>        num1:<span class="hljs-number">0</span>,        num2:<span class="hljs-number">0</span>,        result:<span class="hljs-number">0</span>,        url:<span class="hljs-string">'http://www.itcast.cn'</span>    &#125;,    methods:&#123;        change:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>&#123;            <span class="hljs-keyword">this</span>.result = add(<span class="hljs-built_in">Number</span>.parseInt(<span class="hljs-keyword">this</span>.num1),<span class="hljs-built_in">Number</span>.parseInt(<span class="hljs-keyword">this</span>.num2));        &#125;    &#125;&#125;);</code></pre></div><h3 id="æ‰“åŒ…æµ‹è¯•"><a href="#æ‰“åŒ…æµ‹è¯•" class="headerlink" title="æ‰“åŒ…æµ‹è¯•"></a>æ‰“åŒ…æµ‹è¯•</h3><p>ä¸Šè¾¹å°† <code>mode01.js</code> æ¨¡å—åŠ <code>main.js</code> ä¸»æ–‡ä»¶ç¼–å†™å®Œæˆï¼Œä¸‹è¾¹ä½¿ç”¨ <code>webpack</code> å¯¹è¿™äº›jsæ–‡ä»¶è¿›è¡Œæ‰“åŒ…</p><p>1ã€è¿›å…¥ç¨‹åºç›®å½•ï¼Œæ‰§è¡Œ <code>webpack main.js -o build.js</code> ï¼Œè¿™æ®µæŒ‡ä»¤è¡¨ç¤ºå°† <code>main.js</code> æ‰“åŒ…è¾“å‡ºä¸º <code>build.js</code> æ–‡ä»¶æ‰§è¡Œå®Œæˆï¼Œè§‚å¯Ÿç¨‹åºç›®å½•æ˜¯å¦å‡ºç° <code>build.js</code>ã€‚</p><p>2ã€åœ¨åˆ›å»ºä¸€ä¸ªhtml ï¼Œè¿™é‡Œæˆ‘å‘½åä¸º <code>vue_02.html</code> å¹¶ ä¸­å¼•ç”¨ <code>build.js</code></p><div class="hljs"><pre><code class="hljs java">&lt;!DOCTYPE html&gt;&lt;html lang=<span class="hljs-string">"en"</span> xmlns:v-on=<span class="hljs-string">"http://www.w3.org/1999/xhtml"</span>&gt;&lt;head&gt;    &lt;meta http-equiv=<span class="hljs-string">"Content-Type"</span> content=<span class="hljs-string">"text/html; charset=utf-8"</span> /&gt;    &lt;title&gt;vue.jså…¥é—¨ç¨‹åº&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;div id=<span class="hljs-string">"app"</span>&gt;    &#123;&#123;name&#125;&#125;    &lt;input type=<span class="hljs-string">"text"</span> v-model=<span class="hljs-string">"num1"</span>&gt;+    &lt;input type=<span class="hljs-string">"text"</span> v-model=<span class="hljs-string">"num2"</span>&gt;=    &lt;input type=<span class="hljs-string">"text"</span> v-model=<span class="hljs-string">"result"</span>&gt;    &lt;button v-on:click="change"&gt;è®¡ç®—&lt;/button&gt;&lt;/div&gt;&lt;/body&gt;&lt;script src="build.js"&gt;&lt;/script&gt;&lt;/html&gt;</code></pre></div><h3 id="è¿è¡Œhtml"><a href="#è¿è¡Œhtml" class="headerlink" title="è¿è¡Œhtml"></a>è¿è¡Œhtml</h3><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image9.png" srcset="/img/loading.gif" alt></p><h1 id="ä¸‰ã€webpack-dev-server"><a href="#ä¸‰ã€webpack-dev-server" class="headerlink" title="ä¸‰ã€webpack-dev-server"></a>ä¸‰ã€webpack-dev-server</h1><h2 id="1-æµ‹è¯•ç¯å¢ƒæ­å»º"><a href="#1-æµ‹è¯•ç¯å¢ƒæ­å»º" class="headerlink" title="1. æµ‹è¯•ç¯å¢ƒæ­å»º"></a>1. æµ‹è¯•ç¯å¢ƒæ­å»º</h2><p><code>webpack-dev-server</code> å¼€å‘æœåŠ¡å™¨ï¼Œå®ƒçš„åŠŸèƒ½å¯ä»¥å®ç°çƒ­åŠ è½½ å¹¶ä¸”è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ã€‚</p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç¨‹åºç›®å½•ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»º <code>webpacktest02</code> ç›®å½•ï¼Œå°† <code>webpack</code> å…¥é—¨ç¨‹åº( <code>webpacktest01</code> )çš„ä»£ç æ‹·è´è¿›æ¥ï¼Œå¹¶åœ¨ç›®å½•ä¸‹åˆ›å»º <code>src</code> ç›®å½•ã€<code>dist</code> ç›®å½•ï¼Œå¹¶å°†main.jså’Œmodel01.jsæ‹·è´åˆ°srcç›®å½•ã€‚</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image10.png" srcset="/img/loading.gif" alt></p><h2 id="2-å®‰è£…é…ç½®"><a href="#2-å®‰è£…é…ç½®" class="headerlink" title="2. å®‰è£…é…ç½®"></a>2. å®‰è£…é…ç½®</h2><h3 id="å®‰è£…webpack-dev-server"><a href="#å®‰è£…webpack-dev-server" class="headerlink" title="å®‰è£…webpack-dev-server"></a>å®‰è£…webpack-dev-server</h3><p>ä½¿ç”¨ <code>webpack-dev-server</code> éœ€è¦å®‰è£…webpackã€ webpack-dev-server å’Œ html-webpack-pluginä¸‰ä¸ªåŒ…ã€‚</p><div class="hljs"><pre><code class="hljs shell">cnpm install webpackwebpack-dev-server html-webpack-plugin</code></pre></div><p>å®‰è£…å®Œæˆï¼Œä¼šå‘ç°ç¨‹åºç›®å½•å‡ºç°ä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶ä¸­è®°å½•äº†ç¨‹åºçš„ä¾èµ–ã€‚</p><h3 id="é…ç½®webpack-dev-server"><a href="#é…ç½®webpack-dev-server" class="headerlink" title="é…ç½®webpack-dev-server"></a>é…ç½®webpack-dev-server</h3><p>åœ¨package.jsonä¸­é…ç½®script</p><div class="hljs"><pre><code class="hljs json">"scripts": &#123;  "dev": "webpack-dev-server --inline --hot --open --port 5008"&#125;</code></pre></div><p>â€“inlineï¼šè‡ªåŠ¨åˆ·æ–°<br>â€“hotï¼šçƒ­åŠ è½½<br>â€“portï¼šæŒ‡å®šç«¯å£<br>â€“openï¼šè‡ªåŠ¨åœ¨é»˜è®¤æµè§ˆå™¨æ‰“å¼€<br>â€“hostï¼šå¯ä»¥æŒ‡å®šæœåŠ¡å™¨çš„ ipï¼Œä¸æŒ‡å®šåˆ™ä¸º127.0.0.1ï¼Œå¦‚æœå¯¹å¤–å‘å¸ƒåˆ™å¡«å†™å…¬ç½‘ipåœ°å€</p><p>æ­¤æ—¶package.jsonçš„æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs json">&#123;  <span class="hljs-attr">"devDependencies"</span>: &#123;    <span class="hljs-attr">"html-webpack-plugin"</span>: <span class="hljs-string">"^3.2.0"</span>,    <span class="hljs-attr">"webpack-dev-server"</span>: <span class="hljs-string">"^3.10.3"</span>  &#125;,  <span class="hljs-attr">"scripts"</span>: &#123;    <span class="hljs-attr">"dev"</span>: <span class="hljs-string">"webpack-dev-server --inline --hot --open --port 5008"</span>  &#125;&#125;</code></pre></div><blockquote><p>devDependenciesï¼šå¼€å‘äººå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„ä¾èµ–ã€‚<br>scriptsï¼šå¯æ‰§è¡Œçš„å‘½ä»¤</p></blockquote><h2 id="3-webpack-config-js"><a href="#3-webpack-config-js" class="headerlink" title="3. webpack.config.js"></a>3. webpack.config.js</h2><p>åœ¨ <code>webpacktest02</code> ç›®å½•ä¸‹åˆ›å»º <code>webpack.config.js</code>ï¼Œ <code>webpack.config.js</code> æ˜¯ <code>webpack</code> çš„é…ç½®æ–‡ä»¶ã€‚</p><p>åœ¨æ­¤æ–‡ä»¶ä¸­å¯ä»¥é…ç½®åº”ç”¨çš„å…¥å£æ–‡ä»¶ã€è¾“å‡ºé…ç½®ã€æ’ä»¶ç­‰ï¼Œå…¶ä¸­è¦å®ç°çƒ­åŠ è½½è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½éœ€è¦é…ç½® <code>html-webpack-plugin</code> æ’ä»¶ã€‚</p><p><code>html-webpack-plugin</code> çš„ä½œç”¨æ˜¯æ ¹æ® <code>html</code> æ¨¡æ¿åœ¨å†…å­˜ç”Ÿæˆ <code>html</code> æ–‡ä»¶ï¼Œå®ƒçš„å·¥ä½œåŸç†æ˜¯æ ¹æ®æ¨¡æ¿æ–‡ä»¶åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ª <code>index.html</code> æ–‡ä»¶ã€‚</p><h3 id="é…ç½®æ¨¡æ¿æ–‡ä»¶"><a href="#é…ç½®æ¨¡æ¿æ–‡ä»¶" class="headerlink" title="é…ç½®æ¨¡æ¿æ–‡ä»¶"></a>é…ç½®æ¨¡æ¿æ–‡ä»¶</h3><p>å°†åŸæ¥çš„ <code>vue_02.html</code> ä½œä¸ºæ¨¡æ¿æ–‡ä»¶ï¼Œä¸ºäº†å’Œå†…å­˜ä¸­çš„ <code>index.html</code> æ–‡ä»¶ååŒºåˆ«ï¼Œæ³¨æ„å°† <code>vue_02.html</code> ä¸­çš„<code>script</code> æ ‡ç­¾å»æ‰ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span> <span class="hljs-attr">xmlns:v-on</span>=<span class="hljs-string">"http://www.w3.org/1999/xhtml"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"Content-Type"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"text/html; charset=utf-8"</span> /&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>vue.jså…¥é—¨ç¨‹åº<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>    &#123;&#123;name&#125;&#125;    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"num1"</span>&gt;</span>+    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"num2"</span>&gt;</span>=<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">"result"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">v-on:click</span>=<span class="hljs-string">"change"</span>&gt;</span>è®¡ç®—<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div><h3 id="é…ç½®-html-webpack-plugin"><a href="#é…ç½®-html-webpack-plugin" class="headerlink" title="é…ç½® html-webpack-plugin"></a>é…ç½® html-webpack-plugin</h3><p>åœ¨ <code>webpack.config.js</code> ä¸­é…ç½® <code>html-webpack-plugin</code> æ’ä»¶</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">var</span> htmlwp = require(<span class="hljs-string">'html-webpack-plugin'</span>);<span class="hljs-keyword">module</span>.<span class="hljs-keyword">exports</span>=&#123;    entry:<span class="hljs-string">'./src/main.js'</span>, <span class="hljs-comment">//æŒ‡å®šæ‰“åŒ…çš„å…¥å£æ–‡ä»¶</span>    output:&#123;        path : __dirname + <span class="hljs-string">'/dist'</span>, <span class="hljs-comment">// æ³¨æ„ï¼š__dirnameè¡¨ç¤ºwebpack.config.jsæ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„</span>        filename:<span class="hljs-string">'build.js'</span> <span class="hljs-comment">//è¾“å‡ºæ–‡ä»¶</span>    &#125;,    plugins:[        <span class="hljs-keyword">new</span> htmlwp(&#123;            <span class="hljs-comment">//ç”Ÿæˆçš„é¡µé¢æ ‡é¢˜&lt;head&gt;&lt;title&gt;é¦–é¡µ&lt;/title&gt;&lt;/head&gt;</span>            title: <span class="hljs-string">'é¦–é¡µ'</span>,            <span class="hljs-comment">//webpack-dev-serveråœ¨å†…å­˜ä¸­ç”Ÿæˆçš„æ–‡ä»¶åç§°ï¼Œè‡ªåŠ¨å°†buildæ³¨å…¥åˆ°è¿™ä¸ªé¡µé¢åº•éƒ¨æ‰èƒ½å®ç°è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½</span>            filename: <span class="hljs-string">'index.html'</span>,            <span class="hljs-comment">//æ ¹æ®vue_02.htmlè¿™ä¸ªæ¨¡æ¿æ¥ç”Ÿæˆ(è¿™ä¸ªæ–‡ä»¶è¯·ç¨‹åºå‘˜è‡ªå·±ç”Ÿæˆ)</span>            template: <span class="hljs-string">'vue_02.html'</span>        &#125;)    ]&#125;</code></pre></div><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>å¯åŠ¨æ–‡ä»¶ï¼š<br>1ã€è¿›å…¥ <code>webpacktest02</code>ç›®å½•ï¼Œæ‰§è¡Œ<code>npm run dev</code><br>2ã€ä½¿ç”¨webstormï¼Œå³é”®<code>package.json</code>æ–‡ä»¶ï¼Œé€‰æ‹© â€œShow npm Scriptsâ€</p><p>æ‰“å¼€çª—å£ï¼š</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image11.png" srcset="/img/loading.gif" alt></p><p>åŒå‡» <code>dev</code>ã€‚<br>æ³¨æ„ï¼šdev å°±æ˜¯åœ¨ <code>package.json</code> ä¸­é…ç½®çš„ <code>webpack dev server</code> å‘½ä»¤ã€‚<br>å‘ç°å¯åŠ¨æˆåŠŸè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ã€‚<br>ä¿®æ”¹srcä¸­çš„ä»»æ„æ–‡ä»¶å†…å®¹ï¼Œè‡ªåŠ¨åŠ è½½å¹¶åˆ·æ–°æµè§ˆå™¨ã€‚</p><h3 id="debugè°ƒè¯•"><a href="#debugè°ƒè¯•" class="headerlink" title="debugè°ƒè¯•"></a>debugè°ƒè¯•</h3><p>ä½¿ç”¨äº† <code>webpack</code> ä¹‹åå°±ä¸èƒ½é‡‡ç”¨ä¼ ç»Ÿjsçš„è°ƒè¯•æ–¹æ³•åœ¨ <code>chrome</code> ä¸­æ‰“æ–­ç‚¹ã€‚</p><p><code>webpack</code> å°†å¤šä¸ªæºæ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸”æ–‡ä»¶çš„å†…å®¹äº§ç”Ÿäº†å¾ˆå¤§çš„å˜åŒ–ï¼Œ<code>webpack</code> æä¾› <code>devtool</code> è¿›è¡Œè°ƒè¯•ï¼Œ<code>devtool</code> æ˜¯åŸºäº <code>sourcemap</code> çš„æ–¹å¼ï¼Œåœ¨è°ƒè¯•æ—¶ä¼šç”Ÿæˆä¸€ä¸ª <code>map</code> æ–‡ä»¶ï¼Œå…¶å†…å®¹è®°å½•ç”Ÿæˆæ–‡ä»¶å’Œæºæ–‡ä»¶çš„å†…å®¹æ˜ å°„ï¼Œå³ç”Ÿæˆæ–‡ä»¶ä¸­çš„å“ªä¸ªä½ç½®å¯¹åº”æºæ–‡ä»¶ä¸­çš„å“ªä¸ªä½ç½®ï¼Œæœ‰äº† <code>sourcemap</code> å°±å¯ä»¥åœ¨è°ƒè¯•æ—¶çœ‹åˆ°æºä»£ç ã€‚</p><p><strong>é…ç½®å¦‚ä¸‹</strong></p><p>1ã€åœ¨webpack.config.jsä¸­é…ç½®ï¼š</p><div class="hljs"><pre><code class="hljs js">devtool: <span class="hljs-string">'evalâ€sourceâ€map'</span>,</code></pre></div><p>devtool: â€˜evalâ€sourceâ€mapâ€™,</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">var</span> htmlwp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'htmlâ€webpackâ€plugin'</span>);    <span class="hljs-built_in">module</span>.exports=&#123;    entry:<span class="hljs-string">'./src/main.js'</span>, <span class="hljs-comment">//æŒ‡å®šæ‰“åŒ…çš„å…¥å£æ–‡ä»¶</span>    output:&#123;    path : __dirname+<span class="hljs-string">'/dist'</span>, <span class="hljs-comment">// æ³¨æ„ï¼š__dirnameè¡¨ç¤ºwebpack.config.jsæ‰€åœ¨ç›®å½•çš„ç»å¯¹è·¯å¾„</span>    filename:<span class="hljs-string">'build.js'</span> <span class="hljs-comment">//è¾“å‡ºæ–‡ä»¶</span>&#125;,devtool: <span class="hljs-string">'evalâ€sourceâ€map'</span>,......</code></pre></div><p>2ã€åœ¨jsä¸­è·Ÿè¸ªä»£ç çš„ä½ç½®ä¸Šæ·»åŠ debugger</p><p>ä¸€ä¸ªä¾‹å­ï¼š<br>åœ¨addæ–¹æ³•ä¸­æ·»åŠ debugger</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// å®šä¹‰addå‡½æ•°</span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">x, y</span>) </span>&#123;    <span class="hljs-keyword">debugger</span>    <span class="hljs-keyword">return</span> x + y&#125;</code></pre></div><p>å¯åŠ¨åº”ç”¨ï¼Œåˆ·æ–°é¡µé¢è·Ÿè¸ªä»£ç ï¼š<br>ç‚¹å‡»â€œè®¡ç®—â€ å³è¿›å…¥debuggerä»£ç ä½ç½®ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨chromeè¿›è¡Œè°ƒè¯•äº†ã€‚</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image12.png" srcset="/img/loading.gif" alt></p><h3 id="æ— æ³•æ­£å¸¸å¯åŠ¨è°ƒè¯•ï¼Ÿ"><a href="#æ— æ³•æ­£å¸¸å¯åŠ¨è°ƒè¯•ï¼Ÿ" class="headerlink" title="æ— æ³•æ­£å¸¸å¯åŠ¨è°ƒè¯•ï¼Ÿ"></a>æ— æ³•æ­£å¸¸å¯åŠ¨è°ƒè¯•ï¼Ÿ</h3><p>è°·æ­Œæµè§ˆå™¨ä¸­å…ˆæŒ‰ä¸‹ <code>F12</code> æ‰“å¼€è°ƒè¯•æ¨¡å¼ååœ¨ç‚¹å‡» <code>è®¡ç®—</code> æŒ‰é’®è¿›è¡Œè§¦å‘ä»£ç ä¸­çš„ <code>debugger</code></p><h1 id="å››ã€CMSå‰ç«¯å·¥ç¨‹åˆ›å»º"><a href="#å››ã€CMSå‰ç«¯å·¥ç¨‹åˆ›å»º" class="headerlink" title="å››ã€CMSå‰ç«¯å·¥ç¨‹åˆ›å»º"></a>å››ã€CMSå‰ç«¯å·¥ç¨‹åˆ›å»º</h1><h2 id="1-å¯¼å…¥ç³»ç»Ÿç®¡ç†å‰ç«¯å·¥ç¨‹"><a href="#1-å¯¼å…¥ç³»ç»Ÿç®¡ç†å‰ç«¯å·¥ç¨‹" class="headerlink" title="1.å¯¼å…¥ç³»ç»Ÿç®¡ç†å‰ç«¯å·¥ç¨‹"></a>1.å¯¼å…¥ç³»ç»Ÿç®¡ç†å‰ç«¯å·¥ç¨‹</h2><p>CMSç³»ç»Ÿä½¿ç”¨Vue-cliè„šæ‰‹æ¶åˆ›å»ºï¼Œ <code>Vue-cli</code>æ˜¯ <code>Vue</code> å®˜æ–¹æä¾›çš„å¿«é€Ÿæ„å»ºå•é¡µåº”ç”¨çš„è„šæ‰‹æ¶ï¼Œ<code>github</code>åœ°å€ï¼š<br><a href="https://github.com/vuejs/vue-cli%EF%BC%88%E6%9C%89%E5%85%B4%E8%B6%A3%E7%9A%84%E5%90%8C%E5%AD%A6%E5%8F%AF%E4%BB%A5%E5%8F%82%E8%80%83%E5%AE%98%E6%96%B9%E6%8C%87%E5%AF%BC%E4%BD%BF%E7%94%A8vue-cli%E5%88%9B%E5%BB%BA%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%EF%BC%89%EF%BC%8C%E6%9C%AC%E9%A1%B9%E7%9B%AE%E5%AF%B9" target="_blank" rel="noopener">https://github.com/vuejs/vue-cliï¼ˆæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒå®˜æ–¹æŒ‡å¯¼ä½¿ç”¨vue-cliåˆ›å»ºå‰ç«¯å·¥ç¨‹ï¼‰ï¼Œæœ¬é¡¹ç›®å¯¹</a> <code>Vue-cli</code>åˆ›å»ºçš„å·¥ç¨‹è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œä¸‹è¾¹ä»‹ç»CMSå·¥ç¨‹çš„æƒ…å†µã€‚</p><h2 id="2-å·¥ç¨‹ç»“æ„"><a href="#2-å·¥ç¨‹ç»“æ„" class="headerlink" title="2. å·¥ç¨‹ç»“æ„"></a>2. å·¥ç¨‹ç»“æ„</h2><p>å¦‚æœæˆ‘è¦åŸºäºVue-Cliåˆ›å»ºçš„å·¥ç¨‹è¿›è¡Œå¼€å‘è¿˜éœ€è¦åœ¨å®ƒåŸºç¡€ä¸Šä½œä¸€äº›å°è£…ï¼Œå¯¼å…¥è¯¾ç¨‹èµ„æ–™ä¸­æä¾›Vue-Cliå°è£…å·¥ç¨‹ã€‚<br><code>èµ„æ–™/xc-ui-pc-sysmanage.7z</code> æ‹·è´åˆ°UIå·¥ç¨‹ç›®å½•ä¸­ï¼Œå¹¶è§£å‹ï¼Œç”¨<code>WebStorm</code>æ‰“å¼€ <code>xc-ui-pc-sysmanage</code> ç›®å½•ã€‚</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image13.png" srcset="/img/loading.gif" alt></p><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>package.jsonè®°å½•äº†å·¥ç¨‹æ‰€æœ‰ä¾èµ–ï¼ŒåŠè„šæœ¬å‘½ä»¤ï¼š</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image14.png" srcset="/img/loading.gif" alt></p><p>å¼€å‘ä½¿ç”¨ï¼š<code>npm run dev</code><br>æ‰“åŒ…ä½¿ç”¨ï¼š<code>npm run build</code></p><h3 id="webpack-base-conf-js"><a href="#webpack-base-conf-js" class="headerlink" title="webpack.base.conf.js"></a>webpack.base.conf.js</h3><p><code>webpack.base.conf.js</code> å°±æ˜¯ webpack çš„ <code>webpack.config.js</code> é…ç½®æ–‡ä»¶ï¼Œåœ¨æ­¤æ–‡ä»¶ä¸­é…ç½®äº†å…¥å£æ–‡ä»¶åŠå„ç§<code>Loader</code>ã€‚webpack æ˜¯é€šè¿‡<code>vue-load</code>è§£æ <code>.vue</code> æ–‡ä»¶ï¼Œé€šè¿‡ <code>css-load</code> æ‰“åŒ… <code>css</code> æ–‡ä»¶ç­‰ã€‚</p><h3 id="main-js"><a href="#main-js" class="headerlink" title="main.js"></a>main.js</h3><p><code>main.js</code> æ˜¯å·¥ç¨‹çš„å…¥å£æ–‡ä»¶ï¼Œåœ¨æ­¤æ–‡ä»¶ä¸­åŠ è½½äº†å¾ˆå¤šç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œå¦‚ï¼šElement-UIã€Base64ã€VueRouter ç­‰ã€‚<br><code>index.html</code> æ˜¯æ¨¡æ¿æ–‡ä»¶ã€‚</p><h3 id="srcç›®å½•"><a href="#srcç›®å½•" class="headerlink" title="srcç›®å½•"></a>srcç›®å½•</h3><p>srcç›®å½•ä¸‹å­˜æ”¾é¡µé¢åŠjsä»£ç ã€‚</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image15.png" srcset="/img/loading.gif" alt></p><ul><li>assetsï¼šå­˜æ”¾ä¸€äº›é™æ€æ–‡ä»¶ï¼Œå¦‚å›¾ç‰‡ã€‚</li><li>baseï¼šå­˜æ”¾åŸºç¡€ç»„ä»¶</li><li>base/apiï¼šåŸºç¡€apiæ¥å£</li><li>base/componentï¼šåŸºç¡€ç»„ä»¶ï¼Œè¢«å„å„æ¨¡å—éƒ½ä½¿ç”¨çš„ç»„ä»¶</li><li>base/routerï¼šæ€»çš„è·¯ç”±é…ç½®ï¼ŒåŠ è½½å„æ¨¡å—çš„è·¯ç”±é…ç½®æ–‡ä»¶ã€‚</li><li>commonï¼šå·¥å…·ç±»</li><li>componentï¼šç»„ä»¶ç›®å½•ï¼Œæœ¬é¡¹ç›®ä¸ç”¨ã€‚</li><li>mockï¼šå­˜æ”¾å‰ç«¯å•å…ƒæµ‹è¯•æ–¹æ³•ã€‚</li><li>moduleï¼šå­˜æ”¾å„ä¸šåŠ¡æ¨¡å—çš„é¡µé¢å’Œapiæ–¹æ³•ã€‚</li></ul><p>ä¸‹çº§ç›®å½•ä»¥æ¨¡å—åå‘½åï¼Œä¸‹è¾¹ä»¥cmsä¸¾ä¾‹ï¼š</p><ul><li>cms/apiï¼šcmsæ¨¡å—çš„apiæ¥å£</li><li>cms/componentï¼šcmsæ¨¡å—çš„ç»„ä»¶</li><li>cms/pageï¼š cmsæ¨¡å—çš„é¡µé¢</li><li>cms/routerï¼šcmsæ¨¡å—çš„è·¯ç”±é…ç½®</li><li>staticsï¼šå­˜æ”¾ç¬¬ä¸‰æ–¹ç»„ä»¶çš„é™æ€èµ„æº</li><li>vuexï¼šå­˜æ”¾vuexæ–‡ä»¶ï¼Œæœ¬é¡¹ç›®ä¸ä½¿ç”¨</li><li>staticï¼šä¸srcçš„å¹³çº§ç›®å½•ï¼Œæ­¤ç›®å½•å­˜æ”¾é™æ€èµ„æºå®ƒä¸assetsçš„åŒºåˆ«åœ¨äºï¼Œstaticç›®å½•ä¸­çš„æ–‡ä»¶ä¸è¢«webpackæ‰“åŒ…å¤„ç†ï¼Œä¼šåŸæ ·æ‹·è´åˆ°distç›®å½•ä¸‹</li></ul><h2 id="3-å•é¡µé¢åº”ç”¨ä»‹ç»"><a href="#3-å•é¡µé¢åº”ç”¨ä»‹ç»" class="headerlink" title="3. å•é¡µé¢åº”ç”¨ä»‹ç»"></a>3. å•é¡µé¢åº”ç”¨ä»‹ç»</h2><h3 id="å•é¡µé¢åº”ç”¨çš„ä¼˜ç¼ºç‚¹ï¼š"><a href="#å•é¡µé¢åº”ç”¨çš„ä¼˜ç¼ºç‚¹ï¼š" class="headerlink" title="å•é¡µé¢åº”ç”¨çš„ä¼˜ç¼ºç‚¹ï¼š"></a>å•é¡µé¢åº”ç”¨çš„ä¼˜ç¼ºç‚¹ï¼š</h3><p><strong>ä¼˜ç‚¹</strong>ï¼š<br>1ã€ç”¨æˆ·æ“ä½œä½“éªŒå¥½ï¼Œç”¨æˆ·ä¸ç”¨åˆ·æ–°é¡µé¢ï¼Œæ•´ä¸ªäº¤äº’è¿‡ç¨‹éƒ½æ˜¯é€šè¿‡Ajaxæ¥æ“ä½œã€‚<br>2ã€é€‚åˆå‰åç«¯åˆ†ç¦»å¼€å‘ï¼ŒæœåŠ¡ç«¯æä¾›httpæ¥å£ï¼Œå‰ç«¯è¯·æ±‚httpæ¥å£è·å–æ•°æ®ï¼Œä½¿ç”¨JSè¿›è¡Œå®¢æˆ·ç«¯æ¸²æŸ“ã€‚</p><p><strong>ç¼ºç‚¹</strong>ï¼š<br>1ã€é¦–é¡µåŠ è½½æ…¢<br>å•é¡µé¢åº”ç”¨ä¼šå°†jsã€ cssæ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œåœ¨åŠ è½½é¡µé¢æ˜¾ç¤ºçš„æ—¶å€™åŠ è½½æ‰“åŒ…æ–‡ä»¶ï¼Œå¦‚æœæ‰“åŒ…æ–‡ä»¶è¾ƒå¤§æˆ–è€…ç½‘é€Ÿæ…¢åˆ™<br>ç”¨æˆ·ä½“éªŒä¸å¥½ã€‚</p><p>2ã€SEOä¸å‹å¥½<br>SEOï¼ˆSearch Engine Optimizationï¼‰ä¸ºæœç´¢å¼•æ“ä¼˜åŒ–ã€‚å®ƒæ˜¯ä¸€ç§åˆ©ç”¨æœç´¢å¼•æ“çš„æœç´¢è§„åˆ™æ¥æé«˜ç½‘ç«™åœ¨æœç´¢å¼•æ“<br>æ’åçš„æ–¹æ³•ã€‚ç›®å‰å„å®¶æœç´¢å¼•æ“å¯¹JSæ”¯æŒä¸å¥½ï¼Œæ‰€ä»¥ä½¿ç”¨å•é¡µé¢åº”ç”¨å°†å¤§å¤§å‡å°‘æœç´¢å¼•æ“å¯¹ç½‘ç«™çš„æ”¶å½•ã€‚</p><p>æ€»ç»“ï¼šæœ¬é¡¹ç›®çš„é—¨æˆ·ã€è¯¾ç¨‹ä»‹ç»ä¸é‡‡ç”¨å•é¡µé¢åº”ç”¨æ¶æ„å»å¼€å‘ï¼Œå¯¹äºéœ€è¦ç”¨æˆ·ç™»å½•çš„ç®¡ç†ç³»ç»Ÿé‡‡ç”¨å•é¡µé¢å¼€å‘ã€‚</p><h1 id="äº”ã€CMSå‰ç«¯é¡µé¢æŸ¥è¯¢å¼€å‘"><a href="#äº”ã€CMSå‰ç«¯é¡µé¢æŸ¥è¯¢å¼€å‘" class="headerlink" title="äº”ã€CMSå‰ç«¯é¡µé¢æŸ¥è¯¢å¼€å‘"></a>äº”ã€CMSå‰ç«¯é¡µé¢æŸ¥è¯¢å¼€å‘</h1><h2 id="1-é¡µé¢åŸå‹"><a href="#1-é¡µé¢åŸå‹" class="headerlink" title="1. é¡µé¢åŸå‹"></a>1. é¡µé¢åŸå‹</h2><h3 id="1ã€åˆ›å»ºé¡µé¢"><a href="#1ã€åˆ›å»ºé¡µé¢" class="headerlink" title="1ã€åˆ›å»ºé¡µé¢"></a>1ã€åˆ›å»ºé¡µé¢</h3><h4 id="é¡µé¢ç»“æ„"><a href="#é¡µé¢ç»“æ„" class="headerlink" title="é¡µé¢ç»“æ„"></a>é¡µé¢ç»“æ„</h4><p>åœ¨modelç›®å½•åˆ›å»º cmsæ¨¡å—çš„ç›®å½•ç»“æ„</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image16.png" srcset="/img/loading.gif" alt></p><p>åœ¨pageç›®å½•æ–°å»ºpage_list.vueï¼Œæ‰©å±•åä¸º.vueã€‚<br>.vueæ–‡ä»¶çš„ç»“æ„å¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs vue">&lt;template&gt;&lt;!â€â€ç¼–å†™é¡µé¢é™æ€éƒ¨åˆ†ï¼Œå³viewéƒ¨åˆ†â€â€&gt;æµ‹è¯•é¡µé¢æ˜¾ç¤º...&lt;&#x2F;template&gt;&lt;script&gt;&#x2F;*ç¼–å†™é¡µé¢é™æ€éƒ¨åˆ†ï¼Œå³modelåŠvméƒ¨åˆ†ã€‚*&#x2F;&lt;&#x2F;script&gt;&lt;style&gt;&#x2F;*ç¼–å†™é¡µé¢æ ·å¼ï¼Œä¸æ˜¯å¿…é¡»*&#x2F;&lt;&#x2F;style&gt;</code></pre></div><p>åœ¨é¡µé¢çš„<code>template</code>ä¸­å¡«å†™ â€œæµ‹è¯•é¡µé¢æ˜¾ç¤ºâ€¦â€ã€‚<br>æ³¨æ„ï¼š<code>template</code>å†…å®¹å¿…é¡»æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ï¼Œå¦åˆ™vueä¼šæŠ¥é”™ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨<code>template</code>æ ‡ç­¾å†…å®šä¹‰ä¸€ä¸ª<code>div</code>ã€‚</p><h4 id="é¡µé¢è·¯ç”±"><a href="#é¡µé¢è·¯ç”±" class="headerlink" title="é¡µé¢è·¯ç”±"></a>é¡µé¢è·¯ç”±</h4><p>åœ¨ <code>cms</code> ç›®å½•ä¸‹åˆ›å»º <code>page_list.vue</code> é¡µé¢ã€‚<br>ç°åœ¨å…ˆé…ç½®è·¯ç”±ï¼Œå®ç° url è®¿é—®åˆ°é¡µé¢å†è¿›è¡Œå†…å®¹å®Œå–„ä¸è°ƒè¯•ã€‚</p><p>1ã€åœ¨cmsçš„routerä¸‹é…ç½®è·¯ç”±</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> Home <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/home/page/home.vue'</span>;<span class="hljs-keyword">import</span> page_list <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/cms/page/page_list.vue'</span>;    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [&#123;        path: <span class="hljs-string">'/cms'</span>,        component: Home,        name: <span class="hljs-string">'CMSå†…å®¹ç®¡ç†'</span>,        hidden: <span class="hljs-literal">false</span>,        children:[            &#123;<span class="hljs-attr">path</span>:<span class="hljs-string">'/cms/page/list'</span>,<span class="hljs-attr">name</span>:<span class="hljs-string">'é¡µé¢åˆ—è¡¨'</span>,<span class="hljs-attr">component</span>: page_list,<span class="hljs-attr">hidden</span>:<span class="hljs-literal">false</span>&#125;        ]    &#125;]</code></pre></div><p>2ã€åœ¨baseç›®å½•ä¸‹çš„routerå¯¼å…¥cmsæ¨¡å—çš„è·¯ç”±</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// // å¯¼å…¥è·¯ç”±è§„åˆ™</span><span class="hljs-keyword">import</span> HomeRouter <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/home/router'</span><span class="hljs-keyword">import</span> CmsRouter <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/cms/router'</span><span class="hljs-comment">// åˆå¹¶è·¯ç”±è§„åˆ™</span>concat(HomeRouter)concat(CmsRouter)</code></pre></div><p>3ã€æµ‹è¯•</p><p>å¯åŠ¨å·¥ç¨‹ï¼Œåˆ·æ–°é¡µé¢ï¼Œé¡µé¢å¯ä»¥å¤–æ­£å¸¸æµè§ˆï¼Œå¹¶ä¸”çœ‹åˆ°â€œæµ‹è¯•é¡µé¢æ˜¾ç¤ºâ€¦â€å­—æ ·</p><h3 id="2ã€Tableç»„ä»¶æµ‹è¯•"><a href="#2ã€Tableç»„ä»¶æµ‹è¯•" class="headerlink" title="2ã€Tableç»„ä»¶æµ‹è¯•"></a>2ã€Tableç»„ä»¶æµ‹è¯•</h3><p>æœ¬åŠŸèƒ½å®ç°çš„é¡µé¢åˆ—è¡¨ï¼Œç”¨æˆ·å¯ä»¥è¿›è¡Œåˆ†é¡µæŸ¥è¯¢ã€è¾“å…¥æŸ¥è¯¢æ¡ä»¶æŸ¥è¯¢ï¼Œé€šè¿‡æŸ¥çœ‹ <code>Element-UI</code> åº“ï¼Œæˆ‘ä»¬éœ€è¦<code>Table</code> è¡¨æ ¼ã€<code>Form</code>è¡¨å• åŠ<code>Pagination</code> åˆ†é¡µç»„ä»¶ã€‚</p><p>è¿›å…¥<a href="https://element.eleme.cn/#/zh-CN/component/table" target="_blank" rel="noopener">Element-UI</a>å®˜æ–¹ï¼Œæ‰¾åˆ° <code>Table</code> ç»„ä»¶ï¼Œæ‹·è´æºä»£ç åˆ° <code>vue</code> é¡µé¢ä¸­ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;el-table      :data&#x3D;&quot;tableData&quot;      border      style&#x3D;&quot;width: 100%&quot;&gt;      &lt;el-table-column        prop&#x3D;&quot;date&quot;        label&#x3D;&quot;æ—¥æœŸ&quot;        width&#x3D;&quot;180&quot;&gt;      &lt;&#x2F;el-table-column&gt;      &lt;el-table-column        prop&#x3D;&quot;name&quot;        label&#x3D;&quot;å§“å&quot;        width&#x3D;&quot;180&quot;&gt;      &lt;&#x2F;el-table-column&gt;      &lt;el-table-column        prop&#x3D;&quot;address&quot;        label&#x3D;&quot;åœ°å€&quot;&gt;      &lt;&#x2F;el-table-column&gt;      &lt;el-table-column        prop&#x3D;&quot;test&quot;        label&#x3D;&quot;æµ‹è¯•åˆ—&quot;&gt;      &lt;&#x2F;el-table-column&gt;    &lt;&#x2F;el-table&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;  export default &#123;    data() &#123;      return &#123;        tableData: [&#123;          date: &#39;2016-05-02&#39;,          name: &#39;ç‹å°è™&#39;,          address: &#39;ä¸Šæµ·å¸‚æ™®é™€åŒºé‡‘æ²™æ±Ÿè·¯ 1518 å¼„&#39;,          test: &#39;æµ‹è¯•&#39;        &#125;, &#123;          date: &#39;2016-05-04&#39;,          name: &#39;ç‹å°è™&#39;,          address: &#39;ä¸Šæµ·å¸‚æ™®é™€åŒºé‡‘æ²™æ±Ÿè·¯ 1517 å¼„&#39;        &#125;, &#123;          date: &#39;2016-05-01&#39;,          name: &#39;ç‹å°è™&#39;,          address: &#39;ä¸Šæµ·å¸‚æ™®é™€åŒºé‡‘æ²™æ±Ÿè·¯ 1519 å¼„&#39;        &#125;, &#123;          date: &#39;2016-05-03&#39;,          name: &#39;ç‹å°è™&#39;,          address: &#39;ä¸Šæµ·å¸‚æ™®é™€åŒºé‡‘æ²™æ±Ÿè·¯ 1516 å¼„&#39;        &#125;]      &#125;    &#125;  &#125;&lt;&#x2F;script&gt;&lt;style&gt;&lt;&#x2F;style&gt;</code></pre></div><p>æµ‹è¯•ï¼š</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image17.png" srcset="/img/loading.gif" alt></p><p>é€šè¿‡æŸ¥çœ‹ä»£ç å‘ç°ï¼Œ<code>el-table</code> ç»„ä»¶ç»‘å®šäº†<code>tableData</code>æ¨¡å‹æ•°æ®ï¼Œ<code>tableData</code>æ¨¡å‹æ•°æ®åœ¨<code>script</code>æ ‡ç­¾ä¸­å®šä¹‰ã€‚</p><h3 id="3ã€é¡µé¢å†…å®¹å®Œå–„"><a href="#3ã€é¡µé¢å†…å®¹å®Œå–„" class="headerlink" title="3ã€é¡µé¢å†…å®¹å®Œå–„"></a>3ã€é¡µé¢å†…å®¹å®Œå–„</h3><p>æ ¹æ®éœ€æ±‚å®Œå–„é¡µé¢å†…å®¹ï¼Œå®Œå–„åˆ—è¡¨å­—æ®µï¼Œæ·»åŠ åˆ†é¡µç»„ä»¶ã€‚</p><div class="hljs"><pre><code class="hljs vue">&lt;template&gt;  &lt;div&gt;    &lt;el-button type&#x3D;&quot;primary&quot; v-on:click&#x3D;&quot;query&quot; size&#x3D;&quot;small&quot;&gt;æŸ¥è¯¢&lt;&#x2F;el-button&gt;    &lt;el-table    :data&#x3D;&quot;list&quot;    border    style&#x3D;&quot;width: 100%&quot;&gt;    &lt;el-table-column prop&#x3D;&quot;pageName&quot; label&#x3D;&quot;é¡µé¢åç§°&quot; width&#x3D;&quot;120&quot;&gt;    &lt;&#x2F;el-table-column&gt;    &lt;el-table-column prop&#x3D;&quot;pageAliase&quot; label&#x3D;&quot;åˆ«å&quot; width&#x3D;&quot;120&quot;&gt;    &lt;&#x2F;el-table-column&gt;    &lt;el-table-column prop&#x3D;&quot;pageType&quot; label&#x3D;&quot;é¡µé¢ç±»å‹&quot; width&#x3D;&quot;150&quot;&gt;    &lt;&#x2F;el-table-column&gt;    &lt;el-table-column prop&#x3D;&quot;pageWebPath&quot; label&#x3D;&quot;è®¿é—®è·¯å¾„&quot; width&#x3D;&quot;250&quot;&gt;    &lt;&#x2F;el-table-column&gt;    &lt;el-table-column prop&#x3D;&quot;pagePhysicalPath&quot; label&#x3D;&quot;ç‰©ç†è·¯å¾„&quot; width&#x3D;&quot;250&quot;&gt;    &lt;&#x2F;el-table-column&gt;    &lt;el-table-column prop&#x3D;&quot;pageCreateTime&quot; label&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot;&gt;    &lt;&#x2F;el-table-column&gt;    &lt;&#x2F;el-table&gt;    &lt;el-pagination    layout&#x3D;&quot;prev, pager, next&quot;    :page-size&#x3D;&quot;this.params.size&quot;    v-on:current-change&#x3D;&quot;changePage&quot;    :total&#x3D;&quot;total&quot; :current-page&#x3D;&quot;this.params.page&quot; style&#x3D;&quot;float:right;&quot;&gt;    &lt;&#x2F;el-pagination&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;template&gt;&lt;script&gt;  export default &#123;    data() &#123;      return &#123;        list:[],        total:50,        params:&#123;          page:1,&#x2F;&#x2F;é¡µç           size:2&#x2F;&#x2F;æ¯é¡µæ˜¾ç¤ºä¸ªæ•°        &#125;      &#125;    &#125;,    methods:&#123;      changePage:function () &#123;        this.query()      &#125;,    &#x2F;&#x2F;æŸ¥è¯¢      query:function () &#123;        alert(&quot;æŸ¥è¯¢&quot;)      &#125;    &#125;  &#125;&lt;&#x2F;script&gt;</code></pre></div><p>æµ‹è¯•</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image18.png" srcset="/img/loading.gif" alt></p><h2 id="2-APIè°ƒç”¨"><a href="#2-APIè°ƒç”¨" class="headerlink" title="2. APIè°ƒç”¨"></a>2. APIè°ƒç”¨</h2><h3 id="1ã€å®šä¹‰"><a href="#1ã€å®šä¹‰" class="headerlink" title="1ã€å®šä¹‰"></a>1ã€å®šä¹‰</h3><p>åœ¨cmsæ¨¡å—çš„ <code>api</code> ç›®å½•å®šä¹‰<code>cms.js</code>ï¼Œ<br>åœ¨ <code>cms.js</code> ä¸­å®šä¹‰å¦‚ä¸‹jsæ–¹æ³•ï¼Œæ­¤æ–¹æ³•å®ç° <code>http</code> è¯·æ±‚æœåŠ¡ç«¯é¡µé¢æŸ¥è¯¢æ¥å£ã€‚</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//publicæ˜¯å¯¹axiosçš„å·¥å…·ç±»å°è£…ï¼Œå®šä¹‰äº†httpè¯·æ±‚æ–¹æ³•</span><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'./../../../base/api/public'</span><span class="hljs-comment">//é¡µé¢æŸ¥è¯¢</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_list = <span class="hljs-function">(<span class="hljs-params">page,size,params</span>) =&gt;</span> &#123;    <span class="hljs-comment">//å®šä¹‰æ–¹æ³•ï¼Œè¯·æ±‚æœåŠ¡ç«¯æŸ¥è¯¢æ¥å£</span>    <span class="hljs-keyword">return</span> http.requestQuickGet(<span class="hljs-string">'http://localhost:31001/cms/page/list/'</span>+page+<span class="hljs-string">'/'</span>+size)&#125;</code></pre></div><p><code>axios</code>å®ç°äº†<code>http</code>æ–¹æ³•çš„å°è£…ï¼Œ<code>vue.js</code> å®˜æ–¹ä¸å†ç»§ç»­ç»´æŠ¤ <code>vue-resource</code>,æ¨èä½¿ç”¨ <code>axios</code>ã€‚</p><h3 id="2ã€è°ƒç”¨"><a href="#2ã€è°ƒç”¨" class="headerlink" title="2ã€è°ƒç”¨"></a>2ã€è°ƒç”¨</h3><p>å‰ç«¯ <code>page_list.vue</code> é¡µé¢å¯¼å…¥cms.jsï¼Œè°ƒç”¨jsæ–¹æ³•è¯·æ±‚æœåŠ¡ç«¯é¡µé¢æŸ¥è¯¢æ¥å£ã€‚</p><p>è¯·æ±‚çš„å‚æ•°æ ¹æ®åç«¯çš„ <code>Swagger</code> æ–‡æ¡£è¿›è¡Œé…ç½® <a href="http://localhost:31001/swagger-ui.html" target="_blank" rel="noopener">http://localhost:31001/swagger-ui.html</a></p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image19.png" srcset="/img/loading.gif" alt></p><p>é…ç½®</p><div class="hljs"><pre><code class="hljs js">&lt;script&gt;  <span class="hljs-comment">//å¯¼å…¥api</span>  <span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> cmsApi <span class="hljs-keyword">from</span> <span class="hljs-string">'../api/cms'</span>;  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;    data() &#123;      <span class="hljs-keyword">return</span> &#123;        list:[],        total:<span class="hljs-number">50</span>,        params:&#123;          page:<span class="hljs-number">1</span>,<span class="hljs-comment">//é¡µç </span>          size:<span class="hljs-number">2</span><span class="hljs-comment">//æ¯é¡µæ˜¾ç¤ºä¸ªæ•°</span>        &#125;      &#125;    &#125;,    methods:&#123;      changePage:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-keyword">this</span>.query()      &#125;,    <span class="hljs-comment">//æŸ¥è¯¢</span>      query:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;        <span class="hljs-comment">//è°ƒç”¨æœåŠ¡ç«¯æ¥å£</span>        cmsApi.page_list(<span class="hljs-keyword">this</span>.params.page, <span class="hljs-keyword">this</span>.params.size).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span>&#123;          <span class="hljs-comment">//å°†resç»“æœæ•°æ®èµ‹å€¼ç»™æ•°æ®æ¨¡å‹å¯¹è±¡</span>          <span class="hljs-keyword">this</span>.list = res.queryResult.list          <span class="hljs-keyword">this</span>.total = res.queryResult.total        &#125;)      &#125;    &#125;  &#125;&lt;<span class="hljs-regexp">/script&gt;</span></code></pre></div><h2 id="3-è·¨åŸŸé—®é¢˜è§£å†³"><a href="#3-è·¨åŸŸé—®é¢˜è§£å†³" class="headerlink" title="3. è·¨åŸŸé—®é¢˜è§£å†³"></a>3. è·¨åŸŸé—®é¢˜è§£å†³</h2><p>æµ‹è¯• ä¸Šè¾¹çš„ä»£ç† ï¼Œç»“æœ æŠ¥é”™å¦‚ä¸‹ ï¼š</p><div class="hljs"><pre><code class="hljs html">No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin'http://localhost:11000' is therefore not allowed access.</code></pre></div><p>åŸå› ï¼šæµè§ˆå™¨çš„åŒæºç­–ç•¥ä¸å…è®¸è·¨åŸŸè®¿é—®ï¼Œæ‰€è°“åŒæºç­–ç•¥æ˜¯æŒ‡åè®®ã€åŸŸåã€ç«¯å£ç›¸åŒã€‚</p><p>è§£å†³ï¼šé‡‡ç”¨ <code>proxyTable</code> è§£å†³ã€‚</p><h3 id="proxyTable-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#proxyTable-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="proxyTable æ˜¯ä»€ä¹ˆï¼Ÿ"></a>proxyTable æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>vue-cliæä¾›çš„è§£å†³vueå¼€å‘ç¯å¢ƒä¸‹è·¨åŸŸé—®é¢˜çš„æ–¹æ³•ï¼ŒproxyTableçš„åº•å±‚ä½¿ç”¨äº† <code>http-proxymiddleware</code>ï¼ˆ<a href="https://github.com/chimurai/http-proxy-middleware%EF%BC%89%EF%BC%8C%E5%AE%83%E6%98%AFhttp%E4%BB%A3%E7%90%86%E4%B8%AD%E9%97%B4%E4%BB%B6%EF%BC%8C%E5%AE%83%E4%BE%9D%E8%B5%96" target="_blank" rel="noopener">https://github.com/chimurai/http-proxy-middlewareï¼‰ï¼Œå®ƒæ˜¯httpä»£ç†ä¸­é—´ä»¶ï¼Œå®ƒä¾èµ–</a> <code>node.js</code>ï¼Œ<br>åŸºæœ¬åŸç†æ˜¯ç”¨æœåŠ¡ç«¯ä»£ç†è§£å†³æµè§ˆå™¨è·¨åŸŸï¼š</p><h3 id="cmsè·¨åŸŸè§£å†³åŸç†ï¼š"><a href="#cmsè·¨åŸŸè§£å†³åŸç†ï¼š" class="headerlink" title="cmsè·¨åŸŸè§£å†³åŸç†ï¼š"></a>cmsè·¨åŸŸè§£å†³åŸç†ï¼š</h3><p>1ã€è®¿é—®é¡µé¢<a href="http://localhost:11000/" target="_blank" rel="noopener">http://localhost:11000/</a></p><p>2ã€é¡µé¢è¯·æ±‚<a href="http://localhost:11000/cms" target="_blank" rel="noopener">http://localhost:11000/cms</a></p><blockquote><p>ç”±äºurlç”±<a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:31001/cmsâ€¦æ”¹ä¸ºâ€œ<a href="http://localhost:11000/cms.&quot;ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è·¨åŸŸ" target="_blank" rel="noopener">http://localhost:11000/cms.&quot;ï¼Œæ‰€ä»¥ä¸å­˜åœ¨è·¨åŸŸ</a></p></blockquote><p>3ã€é€šè¿‡proxyTableç”±nodeæœåŠ¡å™¨ä»£ç†è¯·æ±‚ <a href="http://localhost:31001/cms" target="_blank" rel="noopener">http://localhost:31001/cms</a>.</p><blockquote><p>æœåŠ¡ç«¯ä¸å­˜åœ¨è·¨åŸŸé—®é¢˜</p></blockquote><p>å…·ä½“çš„é…ç½®å¦‚ä¸‹ï¼š</p><p>1ã€ä¿®æ”¹<code>api</code>æ–¹æ³•ä¸­<code>url</code>çš„å®šä¹‰</p><p>è¯·æ±‚å‰åŠ /apiå‰ç¼€</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//publicæ˜¯å¯¹axiosçš„å·¥å…·ç±»å°è£…ï¼Œå®šä¹‰äº†httpè¯·æ±‚æ–¹æ³•</span><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'./../../../base/api/public'</span>  <span class="hljs-comment">//ES6 å¯¼å…¥</span><span class="hljs-keyword">let</span> sysConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@/../config/sysConfig'</span>)<span class="hljs-keyword">let</span> apiUrl = sysConfig.xcApiUrlPre<span class="hljs-comment">//é¡µé¢æŸ¥è¯¢</span><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_list = <span class="hljs-function">(<span class="hljs-params">page,size,params</span>) =&gt;</span> &#123;  <span class="hljs-comment">//å®šä¹‰æ–¹æ³•ï¼Œè¯·æ±‚æœåŠ¡ç«¯æŸ¥è¯¢æ¥å£</span>  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl + <span class="hljs-string">'/cms/page/list/'</span>+page+<span class="hljs-string">'/'</span>+size)&#125;</code></pre></div><p>2ã€åœ¨ <code>config/index.js</code> ä¸‹é…ç½® <code>proxyTable</code></p><div class="hljs"><pre><code class="hljs js"><span class="hljs-string">'/api/cms'</span>: &#123;    target: <span class="hljs-string">'http://localhost:31001'</span>,    pathRewrite: &#123;    <span class="hljs-string">'^/api'</span>: <span class="hljs-string">''</span><span class="hljs-comment">//å®é™…è¯·æ±‚å»æ‰/api</span>&#125;</code></pre></div><h2 id="4-åˆ†é¡µæŸ¥è¯¢æµ‹è¯•"><a href="#4-åˆ†é¡µæŸ¥è¯¢æµ‹è¯•" class="headerlink" title="4. åˆ†é¡µæŸ¥è¯¢æµ‹è¯•"></a>4. åˆ†é¡µæŸ¥è¯¢æµ‹è¯•</h2><p>1ã€å®šä¹‰åˆ†é¡µè§†å›¾</p><div class="hljs"><pre><code class="hljs vue"> &lt;el-pagination      @size-change&#x3D;&quot;handleSizeChange&quot;      @current-change&#x3D;&quot;handleCurrentChange&quot;      :page-sizes&#x3D;&quot;[5,10, 20, 30, 100]&quot;      :current-page&#x3D;&quot;this.params.page&quot;      :page-size&#x3D;&quot;this.params.size&quot;      :total&#x3D;&quot;this.total&quot;      layout&#x3D;&quot;total, sizes, prev, pager, next, jumper&quot;      v-on:current-change&#x3D;&quot;changePage&quot;      style&#x3D;&quot;float:right;&quot;&gt;&lt;&#x2F;el-pagination&gt;</code></pre></div><p>2ã€å®šä¹‰æ•°æ®æ¨¡å‹å¯¹è±¡</p><div class="hljs"><pre><code class="hljs js">data() &#123;     <span class="hljs-keyword">return</span> &#123;       list:[],       total:<span class="hljs-number">0</span>,  <span class="hljs-comment">//æ•°æ®æ€»é‡</span>       params:&#123;         page:<span class="hljs-number">1</span>,<span class="hljs-comment">//é»˜è®¤é¡µç </span>         size:<span class="hljs-number">10</span><span class="hljs-comment">//é»˜è®¤æ¯é¡µæ˜¾ç¤ºä¸ªæ•°</span>       &#125;     &#125;&#125;,</code></pre></div><p>3ã€å®šä¹‰åˆ†é¡µæ–¹æ³•ï¼Œæ¥æ”¶é¡µç å‚æ•°</p><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//è§¦å‘åˆ†é¡µå‚æ•°å˜åŠ¨</span>handleSizeChange(val) &#123;  <span class="hljs-keyword">this</span>.params.size = val  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`æ¯é¡µ <span class="hljs-subst">$&#123;val&#125;</span> æ¡`</span>);&#125;,handleCurrentChange(val) &#123;  <span class="hljs-keyword">this</span>.params.page = val  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">`å½“å‰é¡µ: <span class="hljs-subst">$&#123;val&#125;</span>`</span>);&#125;,<span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢ï¼Œæ¥æ”¶pageé¡µç </span>changePage()&#123;  <span class="hljs-keyword">this</span>.query()&#125;,<span class="hljs-comment">//æŸ¥è¯¢</span>query:<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;  <span class="hljs-comment">//è°ƒç”¨æœåŠ¡ç«¯æ¥å£</span>  cmsApi.page_list(<span class="hljs-keyword">this</span>.params.page, <span class="hljs-keyword">this</span>.params.size).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span>&#123;    <span class="hljs-comment">//å°†resç»“æœæ•°æ®èµ‹å€¼ç»™æ•°æ®æ¨¡å‹å¯¹è±¡</span>    <span class="hljs-keyword">this</span>.list = res.queryResult.list    <span class="hljs-keyword">this</span>.total = res.queryResult.total  &#125;)&#125;</code></pre></div><p>ä¿®æ”¹å®Œæ¯•ï¼Œåˆ†é¡µæµ‹è¯•æ•ˆæœå¦‚ä¸‹</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image20.png" srcset="/img/loading.gif" alt></p><h2 id="5-è¿›å…¥é¡µé¢ç«‹å³æŸ¥è¯¢"><a href="#5-è¿›å…¥é¡µé¢ç«‹å³æŸ¥è¯¢" class="headerlink" title="5.è¿›å…¥é¡µé¢ç«‹å³æŸ¥è¯¢"></a>5.è¿›å…¥é¡µé¢ç«‹å³æŸ¥è¯¢</h2><p>ç›®å‰å®ç°çš„åŠŸèƒ½æ˜¯è¿›å…¥é¡µé¢ç‚¹å‡»æŸ¥è¯¢æŒ‰é’®å‘æœåŠ¡ç«¯è¡¨æ±‚æŸ¥è¯¢ï¼Œå®é™…çš„éœ€æ±‚æ˜¯è¿›å…¥é¡µé¢ç«‹å³æŸ¥è¯¢ã€‚</p><p><strong>é‚£ä¹ˆå¦‚ä½•å®ç°ï¼Ÿ</strong></p><p>è¿™è¦ç”¨åˆ° <code>vue</code> çš„é’©å­å‡½æ•°ï¼Œæ¯ä¸ª <code>Vue</code> å®ä¾‹åœ¨è¢«åˆ›å»ºæ—¶éƒ½è¦ç»è¿‡ä¸€ç³»åˆ—çš„åˆå§‹åŒ–è¿‡ç¨‹â€”â€”ä¾‹å¦‚ï¼Œéœ€è¦è®¾ç½®æ•°æ®ç›‘å¬ã€ç¼–è¯‘æ¨¡æ¿ã€å°†å®ä¾‹æŒ‚è½½åˆ° <code>DOM</code> å¹¶åœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–° <code>DOM</code> ç­‰ã€‚åŒæ—¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿä¼šè¿è¡Œä¸€äº›å«åšç”Ÿå‘½å‘¨æœŸé’©å­çš„å‡½æ•°ï¼Œè¿™ç»™äº†ç”¨æˆ·åœ¨ä¸åŒé˜¶æ®µæ·»åŠ è‡ªå·±çš„ä»£ç çš„æœºä¼š ã€‚</p><p>é€šå¸¸ä½¿ç”¨æœ€å¤šçš„æ˜¯ <code>created</code> å’Œ <code>mounted</code> ä¸¤ä¸ªé’©å­ï¼š</p><p><code>created</code>ï¼švueå®ä¾‹å·²åˆ›å»ºä½†æ˜¯DOMå…ƒç´ è¿˜æ²¡æœ‰æ¸²æŸ“ç”Ÿæˆã€‚</p><p><code>mounted</code>ï¼šDOMå…ƒç´ æ¸²æŸ“ç”Ÿæˆå®Œæˆåè°ƒç”¨ ã€‚</p><p>æœ¬ä¾‹å­åœ¨ä¸¤ä¸ªæ–¹æ³•çš„ä»»æ„ä¸€ä¸ªéƒ½æ»¡è¶³éœ€æ±‚ï¼š</p><p>æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p><div class="hljs"><pre><code class="hljs js">mounted() &#123;    <span class="hljs-comment">//é»˜è®¤æŸ¥è¯¢é¡µé¢</span>    <span class="hljs-keyword">this</span>.query()&#125;</code></pre></div><p>é‡æ–°åˆ·æ–°é¡µé¢ã€‚</p><h1 id="å…­ã€å‰ç«¯è¯·æ±‚å“åº”æµç¨‹å°ç»“"><a href="#å…­ã€å‰ç«¯è¯·æ±‚å“åº”æµç¨‹å°ç»“" class="headerlink" title="å…­ã€å‰ç«¯è¯·æ±‚å“åº”æµç¨‹å°ç»“"></a>å…­ã€å‰ç«¯è¯·æ±‚å“åº”æµç¨‹å°ç»“</h1><p>å‚è€ƒ â€œè®²ä¹‰â€“&gt;å‰åç«¯è¯·æ±‚å“åº”æµç¨‹.pngâ€ï¼Œå¦‚ä¸‹ï¼š</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/image21.png" srcset="/img/loading.gif" alt></p><p>æ ¹æ®å›¾ä¸­æ‰€ç¤ºï¼Œæˆ‘ä»¬æ€»ç»“æµç¨‹å¦‚ä¸‹ï¼š</p><p>1ã€åœ¨æµè§ˆå™¨è¾“å…¥å‰ç«¯url</p><p>2ã€å‰ç«¯æ¡†æ¶ <code>vue.js</code> æ ¹æ® <code>url</code> è§£æè·¯ç”±ï¼Œæ ¹æ®è·¯ç”±æ‰¾åˆ° <code>page_list.vue</code> é¡µé¢</p><p>3ã€é¦–å…ˆæ‰§è¡Œ <code>page_list.vue</code> ä¸­çš„é’©å­æ–¹æ³•</p><p>4ã€åœ¨é’©å­æ–¹æ³•ä¸­è°ƒç”¨ <code>query</code> æ–¹æ³•ã€‚</p><p>5ã€åœ¨ <code>query</code> æ–¹æ³•ä¸­è°ƒç”¨ <code>cms.js</code> ä¸­çš„ <code>page_list</code> æ–¹æ³•</p><p>6ã€<code>cms.js</code> ä¸­çš„ <code>page_list</code> æ–¹æ³•é€šè¿‡ <code>axios</code> è¯·æ±‚æœåŠ¡ç«¯æ¥å£</p><p>7ã€é‡‡ç”¨ <code>proxyTable</code> è§£å†³è·¨åŸŸé—®é¢˜ï¼Œ<code>node.js</code> å°†è¯·æ±‚è½¬å‘åˆ°æœåŠ¡ç«¯(<a href="http://localhost:31001/cms/page/list" target="_blank" rel="noopener">http://localhost:31001/cms/page/list</a>)</p><p>8ã€æœåŠ¡ç«¯å¤„ç†ï¼Œå°†æŸ¥è¯¢ç»“æœå“åº”ç»™å‰ç«¯</p><p>9ã€æˆåŠŸå“åº”è°ƒç”¨ <code>then</code> æ–¹æ³•ï¼Œåœ¨ <code>then</code> æ–¹æ³•ä¸­å¤„ç†å“åº”ç»“æœï¼Œå°†æŸ¥è¯¢ç»“æœèµ‹å€¼ç»™æ•°æ®æ¨¡å‹ä¸­çš„totalå’Œlistå˜é‡ã€‚</p><p>10ã€<code>vue.js</code> é€šè¿‡åŒå‘æ•°æ®ç»‘å®šå°†listæ•°æ®æ¸²æŸ“è¾“å‡º ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Vue</tag>
      
      <tag>webpack</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å­¦æˆåœ¨çº¿day01ï¼šæ­å»ºç¯å¢ƒã€CMSæœåŠ¡ç«¯å¼€å‘</title>
    <link href="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday01/"/>
    <url>/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday01/</url>
    
    <content type="html"><![CDATA[<h1 id="ğŸ˜-çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜-çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜ çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜ çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote><p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p></blockquote><p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day01</code> çš„å†…å®¹</p><ul><li>æ­å»ºé—¨æˆ·é¡µé¢</li><li>æ­å»ºæœåŠ¡ç«¯åŸºç¡€å·¥ç¨‹</li><li>é¡µé¢æŸ¥è¯¢æœåŠ¡çš„æ„å»º</li><li>ä½¿ç”¨<code>MangoDB</code> è¿›è¡Œ <code>CRUD</code> æ“ä½œ</li><li><code>Swagger</code> çš„åŸºæœ¬ä½¿ç”¨</li><li><code>Postman</code> çš„åŸºæœ¬ä½¿ç”¨</li></ul><h1 id="ä¸€ã€é¡¹ç›®æ¶æ„"><a href="#ä¸€ã€é¡¹ç›®æ¶æ„" class="headerlink" title="ä¸€ã€é¡¹ç›®æ¶æ„"></a>ä¸€ã€é¡¹ç›®æ¶æ„</h1><h2 id="1-ä¸šåŠ¡æ¶æ„"><a href="#1-ä¸šåŠ¡æ¶æ„" class="headerlink" title="1. ä¸šåŠ¡æ¶æ„"></a>1. ä¸šåŠ¡æ¶æ„</h2><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday01/image1.png" srcset="/img/loading.gif" alt></p><h2 id="2-æŠ€æœ¯æ¶æ„"><a href="#2-æŠ€æœ¯æ¶æ„" class="headerlink" title="2. æŠ€æœ¯æ¶æ„"></a>2. æŠ€æœ¯æ¶æ„</h2><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday01/image2.png" srcset="/img/loading.gif" alt></p><h1 id="äºŒã€CMS-é—¨æˆ·å·¥ç¨‹æ­å»º"><a href="#äºŒã€CMS-é—¨æˆ·å·¥ç¨‹æ­å»º" class="headerlink" title="äºŒã€CMS é—¨æˆ·å·¥ç¨‹æ­å»º"></a>äºŒã€CMS é—¨æˆ·å·¥ç¨‹æ­å»º</h1><h2 id="1-å®‰è£…-WebStorm"><a href="#1-å®‰è£…-WebStorm" class="headerlink" title="1. å®‰è£… WebStorm"></a>1. å®‰è£… WebStorm</h2><p>å‚è€ƒ <code>WebStormå®‰è£…æ‰‹å†Œ.md</code> å®‰è£…WebStormï¼Œå¯¼å…¥ <code>èµ„æ–™\é—¨æˆ·\xc-ui-pc-static-portal.rar</code> å‹ç¼©åŒ…ä¸‹çš„å†…å®¹ã€‚</p><h2 id="2-Nginxè™šæ‹Ÿä¸»æœº"><a href="#2-Nginxè™šæ‹Ÿä¸»æœº" class="headerlink" title="2. Nginxè™šæ‹Ÿä¸»æœº"></a>2. Nginxè™šæ‹Ÿä¸»æœº</h2><p>åœ¨nginxä¸­é…ç½®è™šæ‹Ÿä¸»æœºï¼š</p><div class="hljs"><pre><code class="hljs nginx">server&#123;    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;    <span class="hljs-attribute">server_name</span> www.xuecheng.com;    <span class="hljs-attribute">ssi</span> <span class="hljs-literal">on</span>;    <span class="hljs-attribute">ssi_silent_errors</span> <span class="hljs-literal">on</span>;    <span class="hljs-attribute">location</span> / &#123;    <span class="hljs-attribute">alias</span> F:/teach/xcEdu/xcEduUI/xcâ€uiâ€pcâ€staticâ€portal/;    <span class="hljs-attribute">index</span> index.html;    &#125;&#125;</code></pre></div><p>F:/teach/xcEdu/xcEduUI/xc-ui-pc-static-portal/ æœ¬ç›®å½•å³ä¸ºé—¨æˆ·çš„ä¸»ç›®å½•ï¼Œè‡ªè¡Œä¿®æ”¹ä¸ºè‡ªå·±çš„è·¯å¾„</p><h1 id="ä¸‰ã€CMS-æœåŠ¡ç«¯å·¥ç¨‹æ­å»º"><a href="#ä¸‰ã€CMS-æœåŠ¡ç«¯å·¥ç¨‹æ­å»º" class="headerlink" title="ä¸‰ã€CMS æœåŠ¡ç«¯å·¥ç¨‹æ­å»º"></a>ä¸‰ã€CMS æœåŠ¡ç«¯å·¥ç¨‹æ­å»º</h1><h2 id="1-åŸºç¡€å·¥ç¨‹æ­å»º"><a href="#1-åŸºç¡€å·¥ç¨‹æ­å»º" class="headerlink" title="1. åŸºç¡€å·¥ç¨‹æ­å»º"></a>1. åŸºç¡€å·¥ç¨‹æ­å»º</h2><p>åˆ›å»ºä¸€ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ <code>xcEduService01</code>å¯¼å…¥ <code>èµ„æ–™\åŸºç¡€å·¥ç¨‹\åŸºç¡€å·¥ç¨‹.zip</code> ä¸­çš„åŸºç¡€å·¥ç¨‹ï¼Œå¹¶ä¾æ¬¡å°†æ‰€æœ‰åŸºç¡€å·¥ç¨‹æ·»åŠ è‡³<code>pom</code>é¡¹ç›®ä¸­</p><h2 id="2-å¯¼å…¥MongoDBæ•°æ®"><a href="#2-å¯¼å…¥MongoDBæ•°æ®" class="headerlink" title="2. å¯¼å…¥MongoDBæ•°æ®"></a>2. å¯¼å…¥MongoDBæ•°æ®</h2><p>æ­å»ºå¥½mongodbæ•°æ®åº“åï¼Œå¯¼å…¥ <code>èµ„æ–™\mongodb\xc_cms</code> å†…çš„jsonæ•°æ®</p><h2 id="3-å®šä¹‰æ¥å£"><a href="#3-å®šä¹‰æ¥å£" class="headerlink" title="3. å®šä¹‰æ¥å£"></a>3. å®šä¹‰æ¥å£</h2><h3 id="å®šä¹‰è¯·æ±‚ä»¥åŠç›¸åº”ç±»å‹"><a href="#å®šä¹‰è¯·æ±‚ä»¥åŠç›¸åº”ç±»å‹" class="headerlink" title="å®šä¹‰è¯·æ±‚ä»¥åŠç›¸åº”ç±»å‹"></a>å®šä¹‰è¯·æ±‚ä»¥åŠç›¸åº”ç±»å‹</h3><p>åœ¨ <code>domain.cms.request</code> ä¸‹åˆ›å»º <code>QueryPageRequest</code> å¹¶ç»§æ‰¿ <code>RequestData</code></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.cms.request;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.request.RequestData;<span class="hljs-keyword">import</span> lombok.Data;<span class="hljs-meta">@Data</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryPageRequest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RequestData</span> </span>&#123;    <span class="hljs-comment">//ç«™ç‚¹id</span>    <span class="hljs-keyword">private</span> String siteId;    <span class="hljs-comment">//é¡µé¢id</span>    <span class="hljs-keyword">private</span> String pageId;    <span class="hljs-comment">//é¡µé¢åç§°</span>    <span class="hljs-keyword">private</span> String pageName;    <span class="hljs-comment">//åˆ«å</span>    <span class="hljs-keyword">private</span> String pageAliase;    <span class="hljs-comment">//æ¨¡æ¿id</span>    <span class="hljs-keyword">private</span> String templateId;&#125;</code></pre></div><h3 id="å®šä¹‰å“åº”æ¥å£"><a href="#å®šä¹‰å“åº”æ¥å£" class="headerlink" title="å®šä¹‰å“åº”æ¥å£"></a>å®šä¹‰å“åº”æ¥å£</h3><p>åœ¨ <code>com.xuecheng.api.cms</code> ä¸‹å®šä¹‰ <code>CmsPageControllerApi</code> æŸ¥è¯¢åˆ—è¡¨çš„å“åº”æ ¼å¼ç»Ÿä¸€ä¸º <code>QueryResponseResult</code></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.api.cms;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.request.QueryPageRequest;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResponseResult;<span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ†é¡µæŸ¥è¯¢æ¥å£</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageControllerApi</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, QueryPageRequest queryPageRequest)</span></span>;&#125;</code></pre></div><h1 id="å››ã€é¡µé¢æŸ¥è¯¢æœåŠ¡å¼€å‘"><a href="#å››ã€é¡µé¢æŸ¥è¯¢æœåŠ¡å¼€å‘" class="headerlink" title="å››ã€é¡µé¢æŸ¥è¯¢æœåŠ¡å¼€å‘"></a>å››ã€é¡µé¢æŸ¥è¯¢æœåŠ¡å¼€å‘</h1><h2 id="1-åˆ›å»ºCMSæœåŠ¡å·¥ç¨‹"><a href="#1-åˆ›å»ºCMSæœåŠ¡å·¥ç¨‹" class="headerlink" title="1. åˆ›å»ºCMSæœåŠ¡å·¥ç¨‹"></a>1. åˆ›å»ºCMSæœåŠ¡å·¥ç¨‹</h2><p>å¯¼å…¥ <code>pom.xml</code> é…ç½®</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../xc-framework-parent/pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-manage-cms<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-model<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-utils<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>okhttp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><p>åˆ›å»ºä¸€ä¸ª <code>xc-service-manage-cms</code> çš„mavenå·¥ç¨‹ï¼Œä¾èµ–çˆ¶å·¥ç¨‹ <code>xc-framework-parent</code> ï¼Œ</p><p>åˆ›å»ºåœ¨ <code>com.xuecheng.manage_cms</code> åŒ…å¹¶åœ¨åŒ…ä¸‹åˆ›å»ºconfigã€daoã€serviceã€controller ç­‰åŒ…ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday01/image3.png" srcset="/img/loading.gif" alt></p><p>åˆ›å»ºå…¥å£æ–‡ä»¶ <code>ManageCmsApplication</code>ï¼Œå¹¶æ‰«æç›¸åº”çš„åŒ…</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms;<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.domain.EntityScan;<span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;<span class="hljs-meta">@SpringBootApplication</span><span class="hljs-meta">@EntityScan</span>(<span class="hljs-string">"com.xuecheng.framework.domain.cms"</span>) <span class="hljs-comment">//æ‰«æå…¬å…±çš„å®ä½“ç±»</span><span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.api"</span>&#125;) <span class="hljs-comment">//æ‰«ææ¥å£</span><span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.manage_cms"</span>&#125;)  <span class="hljs-comment">// æ‰«ææœ¬é¡¹ç›®ä¸‹çš„æ‰€æœ‰ç±»</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCmsApplication</span> </span>&#123;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        SpringApplication.run(ManageCmsApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;    &#125;&#125;</code></pre></div><p>resources ä¸‹åˆ›å»º <code>application.yml</code></p><div class="hljs"><pre><code class="hljs yml"><span class="hljs-attr">server:</span>  <span class="hljs-attr">port:</span> <span class="hljs-number">31001</span><span class="hljs-attr">spring:</span>  <span class="hljs-attr">application:</span>    <span class="hljs-attr">name:</span> <span class="hljs-string">xc-service-manage-cms</span>  <span class="hljs-attr">data:</span>    <span class="hljs-attr">mongodb:</span>      <span class="hljs-attr">uri:</span> <span class="hljs-string">mongodb://root:123123@localhost:27017</span>      <span class="hljs-attr">database:</span> <span class="hljs-string">xc_cms</span></code></pre></div><p>resources ä¸‹å¯¼å…¥æ—¥å¿—æ–‡ä»¶ï¼Œç›´æ¥å¤åˆ¶ <code>èµ„æ–™\CMSé…ç½®æ–‡ä»¶</code> ä¸‹çš„ <code>logback-spring.xml</code></p><h2 id="2-å®šä¹‰dao"><a href="#2-å®šä¹‰dao" class="headerlink" title="2. å®šä¹‰dao"></a>2. å®šä¹‰dao</h2><p>åœ¨daoä¸‹å®šä¹‰ä¸€ä¸ªæ¥å£ <code>CmsPageRepository</code> ç»§æ‰¿ <code>MongoRepository</code> ç±»</p><blockquote><p>MongoRepository&lt;CmsPage,String&gt; ä¸­çš„ CmsPage å¯¹åº”æˆ‘ä»¬mongodbä¸­é›†åˆçš„å®ä½“ç±»</p></blockquote><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.dao;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;<span class="hljs-keyword">import</span> org.springframework.data.mongodb.repository.MongoRepository;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsPage</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div><h2 id="3-å•å…ƒæµ‹è¯•"><a href="#3-å•å…ƒæµ‹è¯•" class="headerlink" title="3. å•å…ƒæµ‹è¯•"></a>3. å•å…ƒæµ‹è¯•</h2><h3 id="æŸ¥è¯¢æµ‹è¯•"><a href="#æŸ¥è¯¢æµ‹è¯•" class="headerlink" title="æŸ¥è¯¢æµ‹è¯•"></a>æŸ¥è¯¢æµ‹è¯•</h3><p>å®šä¹‰<code>CmsPageRepository</code> çš„æµ‹è¯•ç±» <code>CmsPageRepositoryTest</code></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.junit.runner.RunWith;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<span class="hljs-keyword">import</span> org.springframework.data.domain.Page;<span class="hljs-keyword">import</span> org.springframework.data.domain.PageRequest;<span class="hljs-keyword">import</span> org.springframework.data.domain.Pageable;<span class="hljs-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-meta">@SpringBootTest</span><span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">CmsPageRepositoryTest</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CmsPageRepository cmsPageRepository;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindAll</span><span class="hljs-params">()</span></span>&#123;        List&lt;CmsPage&gt; all = cmsPageRepository.findAll();        System.out.println(all);    &#125;    <span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢</span>    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFindPage</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-comment">//åˆ†é¡µå‚æ•°</span>        <span class="hljs-keyword">int</span> page = <span class="hljs-number">0</span>; <span class="hljs-comment">//ä»0å¼€å§‹</span>        <span class="hljs-keyword">int</span> size = <span class="hljs-number">10</span>;        Pageable pageable = PageRequest.of(page,size);        Page&lt;CmsPage&gt; all = cmsPageRepository.findAll(pageable);        System.out.println(all);    &#125;&#125;</code></pre></div><p>è¿è¡Œæµ‹è¯•ï¼ŒæˆåŠŸæŸ¥è¯¢åˆ°åˆ†é¡µæ•°æ®ã€‚</p><h3 id="æ·»åŠ "><a href="#æ·»åŠ " class="headerlink" title="æ·»åŠ "></a>æ·»åŠ </h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ·»åŠ </span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testInsert</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-comment">//å®šä¹‰å®ä½“ç±»</span>    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();    <span class="hljs-comment">//è®¾ç½®å±æ€§</span>    cmsPage.setSiteId(<span class="hljs-string">"s01"</span>);    cmsPage.setTemplateId(<span class="hljs-string">"t01"</span>);    cmsPage.setPageName(<span class="hljs-string">"æµ‹è¯•é¡µé¢"</span>);    cmsPage.setPageCreateTime(<span class="hljs-keyword">new</span> Date());    <span class="hljs-comment">//å‚æ•°é›†åˆ</span>    List&lt;CmsPageParam&gt; cmsPageParams = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();    CmsPageParam cmsPageParam = <span class="hljs-keyword">new</span> CmsPageParam();    cmsPageParam.setPageParamName(<span class="hljs-string">"param1"</span>);    cmsPageParam.setPageParamValue(<span class="hljs-string">"value1"</span>);    <span class="hljs-comment">//å°†å‚æ•°æ·»åŠ è‡³é›†åˆå†…</span>    cmsPageParams.add(cmsPageParam);    <span class="hljs-comment">//å®ä½“æ·»åŠ å‚æ•°é›†</span>    cmsPage.setPageParams(cmsPageParams);    cmsPageRepository.save(cmsPage);&#125;</code></pre></div><h3 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åˆ é™¤</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDelete</span><span class="hljs-params">()</span></span>&#123;    cmsPageRepository.deleteById(<span class="hljs-string">"5e705470cc53e4266c135ee7"</span>);    System.out.println(<span class="hljs-string">"åˆ é™¤æˆåŠŸ!"</span>);&#125;</code></pre></div><h3 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä¿®æ”¹</span><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testUpdate</span><span class="hljs-params">()</span></span>&#123;    Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(<span class="hljs-string">"5e705470cc53e4266c135ee7"</span>);    <span class="hljs-keyword">if</span>(optional.isPresent())&#123;  <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦ä¸ºç©ºï¼Œjdk1.8æ–°ç‰¹æ€§optional</span>        CmsPage cmsPage = optional.get();        cmsPage.setPageName(<span class="hljs-string">"æµ‹è¯•é¡µé¢02"</span>);        CmsPage save = cmsPageRepository.save(cmsPage);        System.out.println(<span class="hljs-string">"ä¿®æ”¹æˆåŠŸ "</span> + save);    &#125;&#125;</code></pre></div><h2 id="4-é…ç½®-Service"><a href="#4-é…ç½®-Service" class="headerlink" title="4.é…ç½® Service"></a>4.é…ç½® Service</h2><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.service;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.request.QueryPageRequest;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResponseResult;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResult;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.dao.CmsPageRepository;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.data.domain.Page;<span class="hljs-keyword">import</span> org.springframework.data.domain.PageRequest;<span class="hljs-keyword">import</span> org.springframework.data.domain.Pageable;<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<span class="hljs-meta">@Service</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageService</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    CmsPageRepository cmsPageRepository;    <span class="hljs-comment">/**</span><span class="hljs-comment">     * åˆ†é¡µæŸ¥è¯¢</span><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><span class="hljs-comment">     */</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page,<span class="hljs-keyword">int</span> size,QueryPageRequest queryPageRequest)</span> </span>&#123;        <span class="hljs-comment">//è¿‡æ»¤æ¡ä»¶</span>        <span class="hljs-keyword">if</span>(page &lt;= <span class="hljs-number">0</span>)&#123;            page = <span class="hljs-number">1</span>;        &#125;        <span class="hljs-keyword">if</span>(size &lt;= <span class="hljs-number">0</span>)&#123;            size = <span class="hljs-number">10</span>;        &#125;        <span class="hljs-comment">//åˆ›å»ºåˆ†é¡µæŸ¥è¯¢å‚æ•°</span>        PageRequest pageable = PageRequest.of(page, size);        <span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢æ•°æ®</span>        Page&lt;CmsPage&gt; all = cmsPageRepository.findAll(pageable);        <span class="hljs-comment">//æ•´ç†æŸ¥è¯¢åˆ°çš„æ•°æ®</span>        QueryResult queryResult = <span class="hljs-keyword">new</span> QueryResult();        queryResult.setList(all.getContent());        queryResult.setTotal(all.getTotalElements());        <span class="hljs-comment">//è¿”å›ç»“æœ</span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult(CommonCode.SUCCESS,queryResult);    &#125;&#125;</code></pre></div><h2 id="5-é…ç½®-Controller"><a href="#5-é…ç½®-Controller" class="headerlink" title="5. é…ç½® Controller"></a>5. é…ç½® Controller</h2><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.web.controller;<span class="hljs-keyword">import</span> com.xuecheng.api.cms.CmsPageControllerApi;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.request.QueryPageRequest;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResponseResult;<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResult;<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.service.PageService;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;<span class="hljs-keyword">import</span> java.util.ArrayList;<span class="hljs-keyword">import</span> java.util.List;<span class="hljs-meta">@RestController</span><span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/cms/page"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPageController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CmsPageControllerApi</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    PageService pageService;    <span class="hljs-meta">@Override</span>    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/list/&#123;page&#125;/&#123;size&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"page"</span>)</span> <span class="hljs-keyword">int</span> page, @<span class="hljs-title">PathVariable</span><span class="hljs-params">(<span class="hljs-string">"size"</span>)</span> <span class="hljs-keyword">int</span> size, QueryPageRequest queryPageRequest) </span>&#123;        <span class="hljs-keyword">return</span> pageService.findList(page,size,queryPageRequest);    &#125;&#125;</code></pre></div><h2 id="6-æ¥å£å¼€å‘è§„èŒƒ"><a href="#6-æ¥å£å¼€å‘è§„èŒƒ" class="headerlink" title="6.æ¥å£å¼€å‘è§„èŒƒ"></a>6.æ¥å£å¼€å‘è§„èŒƒ</h2><h3 id="Apiè¯·æ±‚åŠå“åº”è§„èŒƒ"><a href="#Apiè¯·æ±‚åŠå“åº”è§„èŒƒ" class="headerlink" title="Apiè¯·æ±‚åŠå“åº”è§„èŒƒ"></a>Apiè¯·æ±‚åŠå“åº”è§„èŒƒ</h3><p>ä¸ºäº†ä¸¥æ ¼æŒ‰ç…§æ¥å£è¿›è¡Œå¼€å‘ï¼Œæé«˜æ•ˆç‡ï¼Œå¯¹è¯·æ±‚åŠå“åº”æ ¼å¼è¿›è¡Œè§„èŒƒåŒ–ã€‚</p><ul><li><code>get</code> è¯·æ±‚æ—¶ï¼Œé‡‡ç”¨key/valueæ ¼å¼è¯·æ±‚ï¼ŒSpringMVCå¯é‡‡ç”¨åŸºæœ¬ç±»å‹çš„å˜é‡æ¥æ”¶ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨å¯¹è±¡æ¥æ”¶ã€‚</li><li><code>Post</code> è¯·æ±‚æ—¶ï¼Œå¯ä»¥æäº¤formè¡¨å•æ•°æ®ï¼ˆapplication/x-www-form-urlencodedï¼‰å’Œ <code>Json</code> æ•°æ®ï¼ˆContent-Type=application/jsonï¼‰ï¼Œæ–‡ä»¶ç­‰å¤šéƒ¨ä»¶ç±»å‹ï¼ˆmultipart/form-dataï¼‰ä¸‰ç§æ•°æ®æ ¼å¼ï¼ŒSpringMVCæ¥æ”¶Jsonæ•°æ®ä½¿ç”¨@RequestBodyæ³¨è§£è§£æè¯·æ±‚çš„jsonæ•°æ®ã€‚</li><li>å“åº”ç»“æœç»Ÿä¸€ä¿¡æ¯ä¸ºï¼šæ˜¯å¦æˆåŠŸã€æ“ä½œä»£ç ã€æç¤ºä¿¡æ¯åŠè‡ªå®šä¹‰æ•°æ®ã€‚</li><li>å“åº”ç»“æœç»Ÿä¸€æ ¼å¼ä¸º <code>json</code>ã€‚</li></ul><h3 id="Apiå®šä¹‰çº¦æŸ"><a href="#Apiå®šä¹‰çº¦æŸ" class="headerlink" title="Apiå®šä¹‰çº¦æŸ"></a>Apiå®šä¹‰çº¦æŸ</h3><p>Api å®šä¹‰ä½¿ç”¨SpringMVCæ¥å®Œæˆï¼Œç”±äºæ­¤æ¥å£åæœŸå°†ä½œä¸ºå¾®æœåŠ¡è¿œç¨‹è°ƒç”¨ä½¿ç”¨ï¼Œåœ¨å®šä¹‰æ¥å£æ—¶æœ‰å¦‚ä¸‹é™åˆ¶ï¼š</p><ul><li><code>@PathVariable</code> ç»Ÿä¸€æŒ‡å®šå‚æ•°åç§°ï¼Œå¦‚ï¼š<code>@PathVariable(&quot;id&quot;)</code></li><li><code>@RequestParam</code> ç»Ÿä¸€æŒ‡å®šå‚æ•°åç§°ï¼Œå¦‚ï¼š<code>@RequestParam(&quot;id&quot;)</code></li></ul><h1 id="äº”ã€Swagger-ç”Ÿæˆæ¥å£æ–‡æ¡£"><a href="#äº”ã€Swagger-ç”Ÿæˆæ¥å£æ–‡æ¡£" class="headerlink" title="äº”ã€Swagger ç”Ÿæˆæ¥å£æ–‡æ¡£"></a>äº”ã€Swagger ç”Ÿæˆæ¥å£æ–‡æ¡£</h1><h2 id="1-Swaggerä»‹ç»"><a href="#1-Swaggerä»‹ç»" class="headerlink" title="1. Swaggerä»‹ç»"></a>1. Swaggerä»‹ç»</h2><p>OpenAPIè§„èŒƒï¼ˆOpenAPI Specification ç®€ç§°OASï¼‰æ˜¯LinuxåŸºé‡‘ä¼šçš„ä¸€ä¸ªé¡¹ç›®ï¼Œè¯•å›¾é€šè¿‡å®šä¹‰ä¸€ç§ç”¨æ¥æè¿°APIæ ¼å¼æˆ–APIå®šä¹‰çš„è¯­è¨€ï¼Œæ¥è§„èŒƒRESTfulæœåŠ¡å¼€å‘è¿‡ç¨‹ï¼Œç›®å‰ç‰ˆæœ¬æ˜¯V3.0ï¼Œå¹¶ä¸”å·²ç»å‘å¸ƒå¹¶å¼€æºåœ¨githubä¸Šã€‚<a href="https://github.com/OAI/OpenAPI-Specification" target="_blank" rel="noopener">https://github.com/OAI/OpenAPI-Specification</a></p><p>Swaggeræ˜¯å…¨çƒæœ€å¤§çš„OpenAPIè§„èŒƒï¼ˆOASï¼‰APIå¼€å‘å·¥å…·æ¡†æ¶ï¼Œæ”¯æŒä»è®¾è®¡å’Œæ–‡æ¡£åˆ°æµ‹è¯•å’Œéƒ¨ç½²çš„æ•´ä¸ªAPIç”Ÿå‘½å‘¨æœŸçš„å¼€å‘ã€‚ (<a href="https://swagger.io/" target="_blank" rel="noopener">https://swagger.io/</a>)</p><p>Spring Boot å¯ä»¥é›†æˆSwaggerï¼Œç”ŸæˆSwaggeræ¥å£ï¼ŒSpring Bootæ˜¯Javaé¢†åŸŸçš„ç¥å™¨ï¼Œå®ƒæ˜¯Springé¡¹ç›®ä¸‹å¿«é€Ÿæ„å»ºé¡¹ç›®çš„æ¡†æ¶ã€‚</p><h2 id="2-å¼€å¯-Swagger"><a href="#2-å¼€å¯-Swagger" class="headerlink" title="2. å¼€å¯ Swagger"></a>2. å¼€å¯ Swagger</h2><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.api.config;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;<span class="hljs-keyword">import</span> springfox.documentation.builders.PathSelectors;<span class="hljs-keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;<span class="hljs-keyword">import</span> springfox.documentation.service.ApiInfo;<span class="hljs-keyword">import</span> springfox.documentation.spi.DocumentationType;<span class="hljs-keyword">import</span> springfox.documentation.spring.web.plugins.Docket;<span class="hljs-keyword">import</span> springfox.documentation.swagger2.annotations.EnableSwagger2;<span class="hljs-comment">//</span><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@EnableSwagger</span>2<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Swagger2Configuration</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> Docket <span class="hljs-title">createRestApi</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Docket(DocumentationType.SWAGGER_2)                .apiInfo(apiInfo())                .select()                .apis(RequestHandlerSelectors.basePackage(<span class="hljs-string">"com.xuecheng"</span>))                .paths(PathSelectors.any())                .build();    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> ApiInfo <span class="hljs-title">apiInfo</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ApiInfoBuilder()                .title(<span class="hljs-string">"å­¦æˆç½‘apiæ–‡æ¡£"</span>)                .description(<span class="hljs-string">"å­¦æˆç½‘apiæ–‡æ¡£"</span>)<span class="hljs-comment">//                .termsOfServiceUrl("/")</span>                .version(<span class="hljs-string">"1.0"</span>)                .build();    &#125;&#125;</code></pre></div><p>å¼€å¯ <code>swagger</code> åï¼Œå®ƒä¼šè‡ªåŠ¨æ‰«æ <code>com.xuecheng</code> åŒ…ä¸‹æ‰€æœ‰æ ‡è®°äº† <code>@RestController</code> è¿™ä¸ªæ³¨è§£çš„ç±»ï¼Œæ ¹æ®è¿™ä¸ªç±»çš„æ–¹æ³•æ¥ç”Ÿæˆæ¥å£æ–‡æ¡£ã€‚</p><p>è¿è¡Œé¡¹ç›®ï¼Œè®¿é—® <a href="http://localhost:31001/swagger-ui.html" target="_blank" rel="noopener">http://localhost:31001/swagger-ui.html</a> å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšæ‰å®šä¹‰çš„è¿™ä¸ª controller</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday01/image4.png" srcset="/img/loading.gif" alt="image-20200317171117409.png"></p><h2 id="3-Swaggerå¸¸ç”¨æ³¨è§£"><a href="#3-Swaggerå¸¸ç”¨æ³¨è§£" class="headerlink" title="3. Swaggerå¸¸ç”¨æ³¨è§£"></a>3. Swaggerå¸¸ç”¨æ³¨è§£</h2><p>åœ¨Javaç±»ä¸­æ·»åŠ Swaggerçš„æ³¨è§£å³å¯ç”ŸæˆSwaggeræ¥å£ï¼Œå¸¸ç”¨Swaggeræ³¨è§£å¦‚ä¸‹ï¼š</p><ul><li>@Apiï¼šä¿®é¥°æ•´ä¸ªç±»ï¼Œæè¿°Controllerçš„ä½œç”¨ @ApiOperationï¼šæè¿°ä¸€ä¸ªç±»çš„ä¸€ä¸ªæ–¹æ³•ï¼Œæˆ–è€…è¯´ä¸€ä¸ªæ¥å£</li><li>@ApiParamï¼šå•ä¸ªå‚æ•°æè¿° @ApiModelï¼šç”¨å¯¹è±¡æ¥æ¥æ”¶å‚æ•° @ApiModelPropertyï¼šç”¨å¯¹è±¡æ¥æ”¶å‚æ•°æ—¶ï¼Œæè¿°å¯¹è±¡çš„ä¸€ä¸ªå­—æ®µ</li><li>@ApiResponseï¼šHTTPå“åº”å…¶ä¸­1ä¸ªæè¿° @ApiResponsesï¼šHTTPå“åº”æ•´ä½“æè¿°</li><li>@ApiIgnoreï¼šä½¿ç”¨è¯¥æ³¨è§£å¿½ç•¥è¿™ä¸ªAPI @ApiError ï¼šå‘ç”Ÿé”™è¯¯è¿”å›çš„ä¿¡æ¯</li><li>@ApiImplicitParamï¼šä¸€ä¸ªè¯·æ±‚å‚æ•°</li><li>@ApiImplicitParamsï¼šå¤šä¸ªè¯·æ±‚å‚æ•°</li><li>@ApiImplicitParamå±æ€§ï¼š</li></ul><table><thead><tr><th>å±æ€§</th><th>å–å€¼</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>paramType</td><td>æŸ¥è¯¢å‚æ•°ç±»å‹</td><td></td></tr><tr><td>path</td><td>ä»¥åœ°å€çš„å½¢å¼æäº¤æ•°æ®</td><td></td></tr><tr><td>query</td><td>ç›´æ¥è·Ÿå‚æ•°å®Œæˆè‡ªåŠ¨æ˜ å°„èµ‹å€¼</td><td></td></tr><tr><td>body</td><td>ä»¥æµçš„å½¢å¼æäº¤ ä»…æ”¯æŒPOST</td><td></td></tr><tr><td>header</td><td>å‚æ•°åœ¨request headers é‡Œè¾¹æäº¤</td><td></td></tr><tr><td>form</td><td>ä»¥formè¡¨å•çš„å½¢å¼æäº¤ ä»…æ”¯æŒPOST</td><td></td></tr><tr><td>dataType</td><td>å‚æ•°çš„æ•°æ®ç±»å‹ åªä½œä¸ºæ ‡å¿—è¯´æ˜ï¼Œå¹¶æ²¡æœ‰å®é™…éªŒè¯</td><td></td></tr><tr><td>Long</td><td></td><td></td></tr><tr><td>String</td><td></td><td></td></tr><tr><td>name</td><td>æ¥æ”¶å‚æ•°å</td><td></td></tr><tr><td>value</td><td>æ¥æ”¶å‚æ•°çš„æ„ä¹‰æè¿°</td><td></td></tr><tr><td>required</td><td>å‚æ•°æ˜¯å¦å¿…å¡«</td><td></td></tr><tr><td>true</td><td>å¿…å¡«</td><td></td></tr><tr><td>false</td><td>éå¿…å¡«</td><td></td></tr><tr><td>defaultValue</td><td>é»˜è®¤å€¼</td><td></td></tr></tbody></table><h2 id="4-Swaggeræ¥å£å®šä¹‰"><a href="#4-Swaggeræ¥å£å®šä¹‰" class="headerlink" title="4. Swaggeræ¥å£å®šä¹‰"></a>4. Swaggeræ¥å£å®šä¹‰</h2><p>ä½¿ç”¨ swagger çš„å¸¸ç”¨æ³¨è§£æ¥æè¿°æ¥å£ä¿¡æ¯</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * åˆ†é¡µæŸ¥è¯¢æ¥å£</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Api</span>(value=<span class="hljs-string">"cmsé¡µé¢ç®¡ç†æ¥å£"</span>,description = <span class="hljs-string">"cmsé¡µé¢ç®¡ç†æ¥å£ï¼Œæä¾›é¡µé¢çš„å¢ã€åˆ ã€æ”¹ã€æŸ¥"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageControllerApi</span> </span>&#123;    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"åˆ†é¡µæŸ¥è¯¢é¡µé¢åˆ—è¡¨"</span>)    <span class="hljs-meta">@ApiImplicitParams</span>(&#123;        <span class="hljs-meta">@ApiImplicitParam</span>(name=<span class="hljs-string">"page"</span>,value = <span class="hljs-string">"é¡µç "</span>,required=<span class="hljs-keyword">true</span>,paramType=<span class="hljs-string">"path"</span>,dataType=<span class="hljs-string">"int"</span>),        <span class="hljs-meta">@ApiImplicitParam</span>(name=<span class="hljs-string">"size"</span>,value = <span class="hljs-string">"æ¯é¡µè®°å½•æ•°"</span>,required=<span class="hljs-keyword">true</span>,paramType=<span class="hljs-string">"path"</span>,dataType=<span class="hljs-string">"int"</span>)    &#125;)    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, QueryPageRequest queryPageRequest)</span></span>;&#125;</code></pre></div><p>åœ¨QueryPageRequestç±»ä¸­ä½¿ç”¨æ³¨è§£ ApiModelProperty å¯¹å±æ€§æ³¨é‡Š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryPageRequest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RequestData</span> </span>&#123;    <span class="hljs-comment">//ç«™ç‚¹id</span>    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"ç«™ç‚¹id"</span>)    <span class="hljs-keyword">private</span> String siteId;    <span class="hljs-comment">//é¡µé¢ID</span>    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"é¡µé¢ID"</span>)    <span class="hljs-keyword">private</span> String pageId;    <span class="hljs-comment">//é¡µé¢åç§°</span>    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"é¡µé¢åç§°"</span>)    <span class="hljs-keyword">private</span> String pageName;    <span class="hljs-comment">//é¡µé¢åˆ«å</span>    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"é¡µé¢åˆ«å"</span>)    <span class="hljs-keyword">private</span> String pageAliase;    <span class="hljs-comment">//æ¨¡ç‰ˆid</span>    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"æ¨¡ç‰ˆid"</span>)    <span class="hljs-keyword">private</span> String templateId;&#125;</code></pre></div><p>é‡å¯é¡¹ç›®ï¼Œè®¿é—® <a href="http://localhost:31001/swagger-ui.html" target="_blank" rel="noopener">http://localhost:31001/swagger-ui.html</a> ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ·»åŠ çš„æè¿°ä¿¡æ¯</p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday01/image5.png" srcset="/img/loading.gif" alt></p><h1 id="äº”ã€Postman-åŸºæœ¬ä½¿ç”¨"><a href="#äº”ã€Postman-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="äº”ã€Postman åŸºæœ¬ä½¿ç”¨"></a>äº”ã€Postman åŸºæœ¬ä½¿ç”¨</h1><p><code>Postman</code> æ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„httpæ¥å£æµ‹è¯•å·¥å…·ï¼Œä½¿ç”¨ <code>postman</code> å¯ä»¥å®Œæˆ <code>http</code> å„ç§è¯·æ±‚çš„åŠŸèƒ½æµ‹è¯•ã€‚</p><p>å®˜æ–¹åœ°å€ï¼š<a href="https://www.getpostman.com/" target="_blank" rel="noopener">https://www.getpostman.com/</a></p><p><img src="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday01/image6.png" srcset="/img/loading.gif" alt></p>]]></content>
    
    
    <categories>
      
      <category>å­¦æˆåœ¨çº¿</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
      <tag>Swagger</tag>
      
      <tag>Postman</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDBå…¥é—¨</title>
    <link href="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/"/>
    <url>/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="MongoDBå…¥é—¨"><a href="#MongoDBå…¥é—¨" class="headerlink" title="MongoDBå…¥é—¨"></a>MongoDBå…¥é—¨</h1><h2 id="1-mongodbä»‹ç»"><a href="#1-mongodbä»‹ç»" class="headerlink" title="1.mongodbä»‹ç»"></a>1.mongodbä»‹ç»</h2><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/1.png" srcset="/img/loading.gif" alt></p><h2 id="2-ä¸‹è½½mongodb"><a href="#2-ä¸‹è½½mongodb" class="headerlink" title="2.ä¸‹è½½mongodb"></a>2.ä¸‹è½½mongodb</h2><p>typora-copy-images-to:mongodb_imgmongodbå®‰è£…1mongodbä»‹ç»2ä¸‹è½½mongodbMongoDBæä¾›äº†å¯ç”¨äº32ä½å’Œ64ä½ç³»ç»Ÿçš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶åŒ…ï¼Œä½ å¯ä»¥ä»MongoDBå®˜ç½‘ä¸‹è½½å®‰è£…ã€‚å®˜æ–¹åœ°å€ï¼š<a href="https://www.mongodb.com/æœ¬æ•™ç¨‹ä¸‹è½½3.4ç‰ˆæœ¬http://downloads.mongodb.org/win32/mongodb-win32-x86_64-2008plus-ssl-v3.4-latest-signed.msi" target="_blank" rel="noopener">https://www.mongodb.com/æœ¬æ•™ç¨‹ä¸‹è½½3.4ç‰ˆæœ¬http://downloads.mongodb.org/win32/mongodb-win32-x86_64-2008plus-ssl-v3.4-latest-signed.msi</a></p><h2 id="3-å®‰è£…mongodb"><a href="#3-å®‰è£…mongodb" class="headerlink" title="3.å®‰è£…mongodb"></a>3.å®‰è£…mongodb</h2><p>åœ¨win7ç³»ç»Ÿå®‰è£…mongodbéœ€è¦vc++è¿è¡Œåº“ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šæç¤ºâ€œæ— æ³•å¯åŠ¨æ­¤ç¨‹åºï¼Œå› ä¸ºè®¡ç®—æœºä¸­ä¸¢å¤±VCRUNTIME140.dllâ€ã€‚å»ç½‘ä¸Šä¸‹è½½æˆ–ä½¿ç”¨360å®‰è£…ï¼š</p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/2.png" srcset="/img/loading.gif" alt></p><p>è¿è¡Œmongodb-win32-x86_64-2008plus-ssl-v3.4-latest-signed.msi</p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/3.png" srcset="/img/loading.gif" alt></p><p>é€‰æ‹©è‡ªå®šä¹‰è·¯å¾„</p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/4.png" srcset="/img/loading.gif" alt></p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/5.png" srcset="/img/loading.gif" alt></p><h2 id="4-å¯åŠ¨mongodb"><a href="#4-å¯åŠ¨mongodb" class="headerlink" title="4.å¯åŠ¨mongodb"></a>4.å¯åŠ¨mongodb</h2><p>åˆ›å»ºå‡ ä¸ªæ–‡ä»¶å¤¹å…·ä½“å¦‚ä¸‹ï¼šæ•°æ®åº“è·¯å¾„ï¼ˆdataç›®å½•ï¼‰ã€æ—¥å¿—è·¯å¾„ï¼ˆlogsç›®å½•ï¼‰å’Œæ—¥å¿—æ–‡ä»¶ï¼ˆmongo.logæ–‡ä»¶ï¼‰</p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/6.png" srcset="/img/loading.gif" alt></p><p>åˆ›å»ºé…ç½®æ–‡ä»¶mongo.confï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p><div class="hljs"><pre><code class="hljs properties"><span class="hljs-comment">#æ•°æ®åº“è·¯å¾„</span><span class="hljs-attr">dbpath</span>=<span class="hljs-string">d:\MongoDB\Server\3.4\data</span><span class="hljs-comment">#æ—¥å¿—è¾“å‡ºæ–‡ä»¶è·¯å¾„</span><span class="hljs-attr">logpath</span>=<span class="hljs-string">d:\MongoDB\Server\3.4\logs\mongo.log</span><span class="hljs-comment">#é”™è¯¯æ—¥å¿—é‡‡ç”¨è¿½åŠ æ¨¡å¼</span><span class="hljs-attr">logappend</span>=<span class="hljs-string">true</span><span class="hljs-comment">#å¯ç”¨æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤å¯ç”¨</span><span class="hljs-attr">journal</span>=<span class="hljs-string">true</span><span class="hljs-comment">#è¿™ä¸ªé€‰é¡¹å¯ä»¥è¿‡æ»¤æ‰ä¸€äº›æ— ç”¨çš„æ—¥å¿—ä¿¡æ¯ï¼Œè‹¥éœ€è¦è°ƒè¯•ä½¿ç”¨è¯·è®¾ç½®ä¸ºfalse</span><span class="hljs-attr">quiet</span>=<span class="hljs-string">true</span><span class="hljs-comment">#ç«¯å£å·é»˜è®¤ä¸º27017</span><span class="hljs-attr">port</span>=<span class="hljs-string">27017</span></code></pre></div><p>æ³¨æ„å¦‚æœå‡ºç°æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œæˆ–è€…é‡åˆ°ç‰¹ç‚¹é”™è¯¯100æƒ…å†µ ç¬¬ä¸€ç§æƒ…å†µæ˜¯dbpathåæœ‰å¤šä½™ç©ºæ ¼ï¼Œç¬¬äºŒç§æƒ…å†µæ˜¯å…¶ä»–å‚æ•°åé¢å¸¦æœ‰ç©ºæ ¼ï¼ˆäº²æµ‹è¢«å‘</p><p>å®‰è£…MongoDBæœåŠ¡é€šè¿‡æ‰§è¡Œbin/mongod.exeï¼Œä½¿ç”¨â€“installé€‰é¡¹æ¥å®‰è£…æœåŠ¡ï¼Œä½¿ç”¨â€“configé€‰é¡¹æ¥æŒ‡å®šä¹‹å‰åˆ›å»ºçš„é…ç½®æ–‡ä»¶ã€‚cmdè¿›å…¥d:\MongoDB\Server\3.4\bin</p><div class="hljs"><pre><code class="hljs shell">mongod.exeâ€â€config"d:\MongoDB\Server\3.4\mongo.conf"â€â€install</code></pre></div><p>å¯åŠ¨MongoDBæœåŠ¡</p><div class="hljs"><pre><code class="hljs shell">net start MongoDB</code></pre></div><p>å…³é—­MongoDBæœåŠ¡</p><div class="hljs"><pre><code class="hljs shell">net stop MongoDB</code></pre></div><p>ç§»é™¤MongoDBæœåŠ¡</p><div class="hljs"><pre><code class="hljs shell">"d:\MongoDB\Server\3.4\bin\mongod.exe"â€â€remove</code></pre></div><p>å¯åŠ¨mongodbæœåŠ¡ï¼Œå‘½ä»¤æ‰§è¡Œåï¼Œæµè§ˆå™¨ä¸­è¾“å…¥<a href="http://127.0.0.1:27017" target="_blank" rel="noopener">http://127.0.0.1:27017</a></p><p>çœ‹åˆ°å¦‚ä¸‹ç•Œé¢å³è¯´æ˜å¯åŠ¨æˆåŠŸ</p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/7.png" srcset="/img/loading.gif" alt></p><h2 id="5-å®‰è£…studio3t"><a href="#5-å®‰è£…studio3t" class="headerlink" title="5.å®‰è£…studio3t"></a>5.å®‰è£…studio3t</h2><p>studio3tæ˜¯mongodbä¼˜ç§€çš„å®¢æˆ·ç«¯å·¥å…·(ç±»ä¼¼sqlyogæ“ä½œmysqlçš„å·¥å…·ï¼‰ã€‚å®˜æ–¹åœ°å€åœ¨<a href="https://studio3t.com/" target="_blank" rel="noopener">https://studio3t.com/</a></p><p>ä¸‹è½½æœ€æ–°ç‰ˆå³å¯</p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/8.png" srcset="/img/loading.gif" alt></p><p>ä¸‹è½½é»˜è®¤å®‰è£…åï¼Œä¼šæç¤ºéœ€è¦è´¦å·ç§˜å¯†ï¼Œå¯ç›´æ¥ç‚¹å‡»å®Œæˆï¼Œè·³è¿‡ é»˜è®¤ä¸ºè¯•ç”¨ç‰ˆ</p><p>åˆ›å»ºä¸€ä¸ªæ–°è¿æ¥ï¼š</p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/9.png" srcset="/img/loading.gif" alt></p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/10.png" srcset="/img/loading.gif" alt></p><p>å¡«å†™è¿æ¥ä¿¡æ¯ï¼šï¼ˆå¯ä¸éœ€è¦mangodbè´¦å·ç§˜å¯†ç›´æ¥è¿æ¥ï¼‰</p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/11.png" srcset="/img/loading.gif" alt></p><p>è¿æ¥æˆåŠŸï¼š</p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/12.png" srcset="/img/loading.gif" alt></p><h2 id="6-mongodbå…¥é—¨"><a href="#6-mongodbå…¥é—¨" class="headerlink" title="6.mongodbå…¥é—¨"></a>6.mongodbå…¥é—¨</h2><h3 id="6-1åŸºç¡€æ¦‚å¿µ"><a href="#6-1åŸºç¡€æ¦‚å¿µ" class="headerlink" title="6.1åŸºç¡€æ¦‚å¿µ"></a>6.1åŸºç¡€æ¦‚å¿µ</h3><p>åœ¨mongodbä¸­æ˜¯é€šè¿‡æ•°æ®åº“ã€é›†åˆã€æ–‡æ¡£çš„æ–¹å¼æ¥ç®¡ç†æ•°æ®ï¼Œä¸‹è¾¹æ˜¯mongodbä¸å…³ç³»æ•°æ®åº“çš„ä¸€äº›æ¦‚å¿µå¯¹æ¯”ï¼š</p><table><thead><tr><th align="center">SQLæœ¯è¯­/æ¦‚å¿µ</th><th align="center">MongoDBæœ¯è¯­/æ¦‚å¿µ</th><th align="left">è§£é‡Š/è¯´æ˜</th></tr></thead><tbody><tr><td align="center">database</td><td align="center">database</td><td align="left">æ•°æ®åº“</td></tr><tr><td align="center">table</td><td align="center">collection</td><td align="left">æ•°æ®åº“è¡¨/é›†åˆ</td></tr><tr><td align="center">row</td><td align="center">document</td><td align="left">æ•°æ®è®°å½•è¡Œ/æ–‡æ¡£</td></tr><tr><td align="center">column</td><td align="center">field</td><td align="left">æ•°æ®å­—æ®µ/åŸŸ</td></tr><tr><td align="center">index</td><td align="center">index</td><td align="left">ç´¢å¼•</td></tr><tr><td align="center">table joins</td><td align="center"></td><td align="left">è¡¨è¿æ¥ï¼ˆMongoDBä¸æ”¯æŒï¼‰</td></tr><tr><td align="center">primary key</td><td align="center">primary key</td><td align="left">ä¸»é”®,MongoDBè‡ªåŠ¨åœ¨æ¯ä¸ªé›†åˆä¸­æ·»åŠ _idçš„ä¸»é”®</td></tr></tbody></table><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/13.png" srcset="/img/loading.gif" alt></p><p>1ã€ä¸€ä¸ªmongodbå®ä¾‹å¯ä»¥åˆ›å»ºå¤šä¸ªæ•°æ®åº“</p><p>2ã€ä¸€ä¸ªæ•°æ®åº“å¯ä»¥åˆ›å»ºå¤šä¸ªé›†åˆ</p><p>3ã€ä¸€ä¸ªé›†åˆå¯ä»¥åŒ…æ‹¬å¤šä¸ªæ–‡æ¡£ã€‚</p><h3 id="6-2è¿æ¥mongodb"><a href="#6-2è¿æ¥mongodb" class="headerlink" title="6.2è¿æ¥mongodb"></a>6.2è¿æ¥mongodb</h3><p>mongodbçš„ä½¿ç”¨æ–¹å¼æ˜¯å®¢æˆ·æœåŠ¡å™¨æ¨¡å¼ï¼Œå³ä½¿ç”¨ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥mongodbæ•°æ®åº“ï¼ˆæœåŠ¡ç«¯ï¼‰ã€‚</p><p>1ã€å‘½ä»¤æ ¼å¼</p><div class="hljs"><pre><code class="hljs shell">mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]</code></pre></div><p>mongodb://å›ºå®šå‰ç¼€</p><p>usernameï¼šè´¦å·ï¼Œå¯ä¸å¡«</p><p>passwordï¼šå¯†ç ï¼Œå¯ä¸å¡«</p><p>hostï¼šä¸»æœºåæˆ–ipåœ°å€ï¼Œåªæœ‰hostä¸»æœºåä¸ºå¿…å¡«é¡¹ã€‚</p><p>portï¼šç«¯å£ï¼Œå¯ä¸å¡«ï¼Œé»˜è®¤27017</p><p>/databaseï¼šè¿æ¥æŸä¸€ä¸ªæ•°æ®åº“</p><p>?optionsï¼šè¿æ¥å‚æ•°ï¼Œkey/valueå¯¹</p><p>ä¾‹å­ï¼š</p><div class="hljs"><pre><code class="hljs shell">mongodb://localhostè¿æ¥æœ¬åœ°æ•°æ®åº“27017ç«¯å£mongodb://root:itcast@localhostä½¿ç”¨ç”¨æˆ·årootå¯†ç ä¸ºitcastè¿æ¥æœ¬åœ°æ•°æ®åº“27017ç«¯å£mongodb://localhost,localhost:27018,localhost:27019ï¼Œè¿æ¥ä¸‰å°ä¸»ä»æœåŠ¡å™¨ï¼Œç«¯å£ä¸º27017ã€27018ã€27019</code></pre></div><p>2ã€ä½¿ç”¨mongodbè‡ªå¸¦çš„javascriptshellï¼ˆmongo.exeï¼‰è¿æ¥</p><p>windowsç‰ˆæœ¬çš„mongodbå®‰è£…æˆåŠŸï¼Œåœ¨å®‰è£…ç›®å½•ä¸‹çš„binç›®å½•æœ‰mongo.exeå®¢æˆ·ç«¯ç¨‹åº</p><p>cmdçŠ¶æ€æ‰§è¡Œmongo.exe:</p><p><img src="/2020/08/06/MongoDB%E5%85%A5%E9%97%A8/14.png" srcset="/img/loading.gif" alt></p><p>æ­¤æ—¶å°±å¯ä»¥è¾“å…¥å‘½ä»¤æ¥æ“ä½œmongodbæ•°æ®åº“äº†ï¼Œjavascriptshellå¯ä»¥è¿è¡Œjavascriptç¨‹åºã€‚</p><p>3ã€ä½¿ç”¨studio3Tè¿æ¥</p><p>4ã€ä½¿ç”¨javaç¨‹åºè¿æ¥</p><p>è¯¦ç»†å‚æ•°ï¼š<a href="http://mongodb.github.io/mongo-java-driver/3.4/driver/tutorials/connect-to-mongodb/" target="_blank" rel="noopener">http://mongodb.github.io/mongo-java-driver/3.4/driver/tutorials/connect-to-mongodb/</a></p><p>æ·»åŠ ä¾èµ–ï¼š</p><div class="hljs"><pre><code class="hljs java">&lt;dependency&gt;&lt;groupId&gt;org.mongodb&lt;/groupId&gt;&lt;artifactId&gt;mongoâ€javaâ€driver&lt;/artifactId&gt;&lt;version&gt;3.4.3&lt;/version&gt;&lt;/dependency&gt;</code></pre></div><p>æµ‹è¯•ç¨‹åºï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testConnection</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-comment">//åˆ›å»ºmongodbå®¢æˆ·ç«¯</span>    MongoClientmongoClient=newMongoClient(<span class="hljs-string">"localhost"</span>,<span class="hljs-number">27017</span>);    <span class="hljs-comment">//æˆ–è€…é‡‡ç”¨è¿æ¥å­—ç¬¦ä¸²</span>    <span class="hljs-comment">//MongoClientURIconnectionString=newMongoClientURI("mongodb://root:root@localhost:27017");</span>    <span class="hljs-comment">//MongoClientmongoClient=newMongoClient(connectionString);</span>    <span class="hljs-comment">//è¿æ¥æ•°æ®åº“</span>    MongoDatabasedatabase=mongoClient.getDatabase(<span class="hljs-string">"test"</span>);    <span class="hljs-comment">//è¿æ¥collectionMongo</span>    Collection&lt;Document&gt;collection=database.getCollection(<span class="hljs-string">"student"</span>);    <span class="hljs-comment">//æŸ¥è¯¢ç¬¬ä¸€ä¸ªæ–‡æ¡£</span>    DocumentmyDoc=collection.find().first();    <span class="hljs-comment">//å¾—åˆ°æ–‡ä»¶å†…å®¹jsonä¸²</span>    Stringjson=myDoc.toJson();System.out.println(json);&#125;</code></pre></div><h3 id="6-3æ•°æ®åº“"><a href="#6-3æ•°æ®åº“" class="headerlink" title="6.3æ•°æ®åº“"></a>6.3æ•°æ®åº“</h3><p>1ã€æŸ¥è¯¢æ•°æ®åº“</p><p>showv dbs æŸ¥è¯¢å…¨éƒ¨æ•°æ®åº“</p><p>db æ˜¾ç¤ºå½“å‰æ•°æ®åº“</p><p>2ã€åˆ›å»ºæ•°æ®åº“å‘½ä»¤æ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs shell">useDATABASE_NAME</code></pre></div><p>ä¾‹å­ï¼š</p><p>usetest02</p><p>æœ‰test02æ•°æ®åº“åˆ™åˆ‡æ¢åˆ°æ­¤æ•°æ®åº“ï¼Œæ²¡æœ‰åˆ™åˆ›å»º</p><p>æ³¨æ„ï¼š</p><p>æ–°åˆ›å»ºçš„æ•°æ®åº“ä¸æ˜¾ç¤ºï¼Œéœ€è¦è‡³å°‘åŒ…æ‹¬ä¸€ä¸ªé›†åˆã€‚</p><p>3ã€åˆ é™¤æ•°æ®åº“ï¼ˆæ…ç”¨ï¼ï¼ï¼ï¼‰</p><p>å‘½ä»¤æ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs shell">db.dropDatabase()</code></pre></div><p>ä¾‹å­ï¼š</p><p>åˆ é™¤test02æ•°æ®åº“</p><p>å…ˆåˆ‡æ¢æ•°æ®åº“ï¼šusetest02</p><p>å†æ‰§è¡Œåˆ é™¤ï¼šdb.dropDatabase()</p><h3 id="6-4é›†åˆ"><a href="#6-4é›†åˆ" class="headerlink" title="6.4é›†åˆ"></a>6.4é›†åˆ</h3><p>é›†åˆç›¸å½“äºå…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ï¼Œä¸€ä¸ªæ•°æ®åº“å¯ä»¥åˆ›å»ºå¤šä¸ªé›†åˆï¼Œä¸€ä¸ªé›†åˆæ˜¯å°†ç›¸åŒç±»å‹çš„æ–‡æ¡£ç®¡ç†èµ·æ¥ã€‚</p><p>1ã€åˆ›å»ºé›†åˆ</p><div class="hljs"><pre><code class="hljs shel">db.createCollection(name,options)name: æ–°åˆ›å»ºçš„é›†åˆåç§°options: åˆ›å»ºå‚æ•°</code></pre></div><p>2.åˆ é™¤é›†åˆ</p><div class="hljs"><pre><code class="hljs shell">db.collection.drop()ä¾‹å­ï¼šdb.student.drop() åˆ é™¤studenté›†åˆ</code></pre></div><h3 id="6-5æ–‡æ¡£"><a href="#6-5æ–‡æ¡£" class="headerlink" title="6.5æ–‡æ¡£"></a>6.5æ–‡æ¡£</h3><h4 id="6-5-1æ’å…¥æ–‡æ¡£"><a href="#6-5-1æ’å…¥æ–‡æ¡£" class="headerlink" title="6.5.1æ’å…¥æ–‡æ¡£"></a>6.5.1æ’å…¥æ–‡æ¡£</h4><p>mongodbä¸­æ–‡æ¡£çš„æ ¼å¼æ˜¯jsonæ ¼å¼ï¼Œä¸‹è¾¹å°±æ˜¯ä¸€ä¸ªæ–‡æ¡£ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªkeyï¼š_idä¸»é”®å’Œname</p><div class="hljs"><pre><code class="hljs shell">&#123;"_id":ObjectId("5b2cc4bfa6a44812707739b5"),"name":"é»‘é©¬ç¨‹åºå‘˜"&#125;</code></pre></div><p>æ’å…¥å‘½ä»¤ï¼š</p><div class="hljs"><pre><code class="hljs shell">db.COLLECTION_NAME.insert(document)</code></pre></div><p>æ¯ä¸ªæ–‡æ¡£é»˜è®¤ä»¥_idä½œä¸ºä¸»é”®ï¼Œä¸»é”®é»˜è®¤ç±»å‹ä¸ºObjectIdï¼ˆå¯¹è±¡ç±»å‹ï¼‰ï¼Œmongodbä¼šè‡ªåŠ¨ç”Ÿæˆä¸»é”®å€¼ã€‚</p><p>ä¾‹å­ï¼š</p><div class="hljs"><pre><code class="hljs shell">db.student.insert(&#123;"name":"é»‘é©¬ç¨‹åºå‘˜","age":10&#125;)</code></pre></div><p>æ³¨æ„ï¼šåŒä¸€ä¸ªé›†åˆä¸­çš„æ–‡æ¡£çš„keyå¯ä»¥ä¸ç›¸åŒï¼ä½†æ˜¯å»ºè®®è®¾ç½®ä¸ºç›¸åŒçš„</p><h4 id="6-5-2æ›´æ–°æ–‡æ¡£"><a href="#6-5-2æ›´æ–°æ–‡æ¡£" class="headerlink" title="6.5.2æ›´æ–°æ–‡æ¡£"></a>6.5.2æ›´æ–°æ–‡æ¡£</h4><p>å‘½ä»¤æ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs shell">db.collection.update(&lt;query&gt;,&lt;update&gt;,&lt;options&gt;)query:æŸ¥è¯¢æ¡ä»¶ï¼Œç›¸å½“äºsqlè¯­å¥çš„whereupdateï¼šæ›´æ–°æ–‡æ¡£å†…å®¹optionsï¼šé€‰é¡¹</code></pre></div><p>1ã€æ›¿æ¢æ–‡æ¡£</p><p>å°†ç¬¦åˆæ¡ä»¶â€nameâ€:â€åŒ—äº¬é»‘é©¬ç¨‹åºâ€çš„ç¬¬ä¸€ä¸ªæ–‡æ¡£æ›¿æ¢ä¸º{â€œnameâ€:â€åŒ—äº¬é»‘é©¬ç¨‹åºå‘˜â€,â€ageâ€:10}</p><div class="hljs"><pre><code class="hljs shell">db.student.update(&#123;"name":"é»‘é©¬ç¨‹åºå‘˜"&#125;,&#123;"name":"åŒ—äº¬é»‘é©¬ç¨‹åºå‘˜","age":10&#125;)</code></pre></div><p>2ã€$setä¿®æ”¹å™¨</p><p>ä½¿ç”¨$setä¿®æ”¹å™¨æŒ‡å®šè¦æ›´æ–°çš„keyï¼Œkeyä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™æ›´æ–°ã€‚</p><p>å°†ç¬¦åˆæ¡ä»¶â€nameâ€:â€åŒ—äº¬é»‘é©¬ç¨‹åºâ€çš„æ‰€æœ‰æ–‡æ¡£æ›´æ–°nameå’Œageçš„å€¼ã€‚</p><div class="hljs"><pre><code class="hljs shell">db.student.update(&#123;"name":"é»‘é©¬ç¨‹åºå‘˜"&#125;,&#123;$set:&#123;"name":"åŒ—äº¬é»‘é©¬ç¨‹åºå‘˜","age":10&#125;&#125;,&#123;multi:true&#125;)</code></pre></div><p>multiï¼šfalseè¡¨ç¤ºæ›´æ–°ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ–‡æ¡£ï¼Œtrueè¡¨ç¤ºæ›´æ–°æ‰€æœ‰åŒ¹é…çš„æ–‡æ¡£</p><h4 id="6-5-3åˆ é™¤æ–‡æ¡£"><a href="#6-5-3åˆ é™¤æ–‡æ¡£" class="headerlink" title="6.5.3åˆ é™¤æ–‡æ¡£"></a>6.5.3åˆ é™¤æ–‡æ¡£</h4><p>å‘½ä»¤æ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs shell">db.student.remove(&lt;query&gt;)queryï¼šåˆ é™¤æ¡ä»¶ï¼Œç›¸å½“äºsqlè¯­å¥ä¸­çš„where</code></pre></div><p>1ã€åˆ é™¤æ‰€æœ‰æ–‡æ¡£</p><p>db.student.remove({})</p><p>2ã€åˆ é™¤ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£</p><p>db.student.remove({â€œnameâ€:â€é»‘é©¬ç¨‹åºå‘˜â€})</p><h4 id="6-5-4æŸ¥è¯¢æ–‡æ¡£"><a href="#6-5-4æŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="6.5.4æŸ¥è¯¢æ–‡æ¡£"></a>6.5.4æŸ¥è¯¢æ–‡æ¡£</h4><p>å‘½ä»¤æ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs shell">db.collection.find(query,projection)queryï¼šæŸ¥è¯¢æ¡ä»¶ï¼Œå¯ä¸å¡«projectionï¼šæŠ•å½±æŸ¥è¯¢keyï¼Œå¯ä¸å¡«</code></pre></div><p>1ã€æŸ¥è¯¢å…¨éƒ¨</p><div class="hljs"><pre><code class="hljs shell">db.student.find()</code></pre></div><p>2ã€æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„è®°å½•</p><p>æŸ¥è¯¢nameç­‰ä¸ºâ€é»‘é©¬ç¨‹åºå‘˜â€çš„æ–‡æ¡£ã€‚</p><div class="hljs"><pre><code class="hljs shell">db.student.find(&#123;"name":"é»‘é©¬ç¨‹åºå‘˜"&#125;)</code></pre></div><p>3ã€æŠ•å½±æŸ¥è¯¢</p><p>åªæ˜¾ç¤ºnameå’Œageä¸¤ä¸ªkeyï¼Œ_idä¸»é”®ä¸æ˜¾ç¤ºã€‚</p><div class="hljs"><pre><code class="hljs shell">db.student.find(&#123;"name":"é»‘é©¬ç¨‹åºå‘˜"&#125;,&#123;name:1,age:1,_id:0&#125;)</code></pre></div><h3 id="6-6ç”¨æˆ·"><a href="#6-6ç”¨æˆ·" class="headerlink" title="6.6ç”¨æˆ·"></a>6.6ç”¨æˆ·</h3><h4 id="6-6-1åˆ›å»ºç”¨æˆ·"><a href="#6-6-1åˆ›å»ºç”¨æˆ·" class="headerlink" title="6.6.1åˆ›å»ºç”¨æˆ·"></a>6.6.1åˆ›å»ºç”¨æˆ·</h4><p>è¯­æ³•æ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs json">mongo&gt;db.createUser(    &#123;user:"&lt;name&gt;",     pwd:"&lt;cleartextpassword&gt;",customData:&#123;&lt;anyinformation&gt;&#125;,     roles:[         &#123;role:"&lt;role&gt;",db:"&lt;database&gt;"&#125;|"&lt;role&gt;",         ...     ]&#125;)</code></pre></div><p>ä¾‹å­ï¼š</p><p>åˆ›å»ºrootç”¨æˆ·ï¼Œè§’è‰²ä¸ºroot</p><div class="hljs"><pre><code class="hljs json">use admindb.createUser(    &#123;        user:"root",        pwd:"root",        roles:[&#123;role:"root",db:"admin"&#125;]    &#125;)</code></pre></div><p>å†…ç½®è§’è‰²å¦‚ä¸‹ï¼š</p><p>1.æ•°æ®åº“ç”¨æˆ·è§’è‰²ï¼šreadã€readWrite;</p><p>2.æ•°æ®åº“ç®¡ç†è§’è‰²ï¼šdbAdminã€dbOwnerã€userAdmin;</p><p>3.é›†ç¾¤ç®¡ç†è§’è‰²ï¼šclusterAdminã€clusterManagerã€clusterMonitorã€hostManagerï¼›</p><p>4.å¤‡ä»½æ¢å¤è§’è‰²ï¼šbackupã€restoreï¼›</p><p>5.æ‰€æœ‰æ•°æ®åº“è§’è‰²ï¼šreadAnyDatabaseã€readWriteAnyDatabaseã€userAdminAnyDatabaseã€dbAdminAnyDatabase</p><p>6.è¶…çº§ç”¨æˆ·è§’è‰²ï¼šroot</p><h4 id="6-6-2æŸ¥è¯¢ç”¨æˆ·"><a href="#6-6-2æŸ¥è¯¢ç”¨æˆ·" class="headerlink" title="6.6.2æŸ¥è¯¢ç”¨æˆ·"></a>6.6.2æŸ¥è¯¢ç”¨æˆ·</h4><p>æŸ¥è¯¢å½“å‰åº“ä¸‹çš„æ‰€æœ‰ç”¨æˆ·ï¼š</p><div class="hljs"><pre><code class="hljs shell">show users</code></pre></div><h4 id="6-6-3åˆ é™¤ç”¨æˆ·"><a href="#6-6-3åˆ é™¤ç”¨æˆ·" class="headerlink" title="6.6.3åˆ é™¤ç”¨æˆ·"></a>6.6.3åˆ é™¤ç”¨æˆ·</h4><p>è¯­æ³•æ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs shell">db.dropUser("ç”¨æˆ·å")</code></pre></div><p>ä¾‹å­ï¼š</p><p>åˆ é™¤root1ç”¨æˆ·</p><div class="hljs"><pre><code class="hljs shell">db.dropUser("root1")</code></pre></div><h4 id="6-6-4ä¿®æ”¹ç”¨æˆ·"><a href="#6-6-4ä¿®æ”¹ç”¨æˆ·" class="headerlink" title="6.6.4ä¿®æ”¹ç”¨æˆ·"></a>6.6.4ä¿®æ”¹ç”¨æˆ·</h4><p>è¯­æ³•æ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs json">db.updateUser(    "&lt;username&gt;",    &#123;customData:&#123;&lt;anyinformation&gt;&#125;,     roles:[         &#123;role:"&lt;role&gt;",db:"&lt;database&gt;"&#125;|"&lt;role&gt;",         ...     ],         pwd:"&lt;cleartextpassword&gt;"         &#125;,         writeConcern:&#123;&lt;writeconcern&gt;&#125;)</code></pre></div><p>ä¾‹å­:</p><p>ä¿®æ”¹rootç”¨æˆ·çš„è§’è‰²ä¸ºreadWriteAnyDatabase</p><div class="hljs"><pre><code class="hljs shell">use admindb.updateUser("root",&#123;roles:[&#123;role:"readWriteAnyDatabase",db:"admin"&#125;]&#125;)</code></pre></div><h4 id="6-6-5ä¿®æ”¹å¯†ç "><a href="#6-6-5ä¿®æ”¹å¯†ç " class="headerlink" title="6.6.5ä¿®æ”¹å¯†ç "></a>6.6.5ä¿®æ”¹å¯†ç </h4><p>è¯­æ³•æ ¼å¼ï¼š</p><div class="hljs"><pre><code class="hljs shell">db.changeUserPassword("username","newPasswd")</code></pre></div><p>ä¾‹å­ï¼š</p><p>ä¿®æ”¹rootç”¨æˆ·çš„å¯†ç ä¸º123</p><div class="hljs"><pre><code class="hljs shell">use admindb.changeUserPassword("root","123")</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>æ–°æ‰‹æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootè‡ªå®šä¹‰starter</title>
    <link href="/2020/08/04/SpringBoot%E8%87%AA%E5%AE%9A%E4%B9%89starter/"/>
    <url>/2020/08/04/SpringBoot%E8%87%AA%E5%AE%9A%E4%B9%89starter/</url>
    
    <content type="html"><![CDATA[<h1 id="è‡ªå®šä¹‰starter"><a href="#è‡ªå®šä¹‰starter" class="headerlink" title="è‡ªå®šä¹‰starter"></a>è‡ªå®šä¹‰starter</h1><p>starterï¼š</p><p>â€‹    1ã€è¿™ä¸ªåœºæ™¯éœ€è¦ä½¿ç”¨åˆ°çš„ä¾èµ–æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>â€‹    2ã€å¦‚ä½•ç¼–å†™è‡ªåŠ¨é…ç½®</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>  <span class="hljs-comment">//æŒ‡å®šè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»</span><span class="hljs-meta">@ConditionalOnXXX</span>  <span class="hljs-comment">//åœ¨æŒ‡å®šæ¡ä»¶æˆç«‹çš„æƒ…å†µä¸‹è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆ</span><span class="hljs-meta">@AutoConfigureAfter</span>  <span class="hljs-comment">//æŒ‡å®šè‡ªåŠ¨é…ç½®ç±»çš„é¡ºåº</span><span class="hljs-meta">@Bean</span>  <span class="hljs-comment">//ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</span><span class="hljs-meta">@ConfigurationPropertie</span>ç»“åˆç›¸å…³xxxPropertiesç±»æ¥ç»‘å®šç›¸å…³çš„é…ç½®<span class="hljs-meta">@EnableConfigurationProperties</span> <span class="hljs-comment">//è®©xxxPropertiesç”Ÿæ•ˆåŠ å…¥åˆ°å®¹å™¨ä¸­</span>è‡ªåŠ¨é…ç½®ç±»è¦èƒ½åŠ è½½å°†éœ€è¦å¯åŠ¨å°±åŠ è½½çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œé…ç½®åœ¨META-INF/spring.factoriesorg.springframework.boot.autoconfigure.EnableAutoConfiguration=\org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</code></pre></div><p>â€‹    3ã€æ¨¡å¼ï¼š</p><p>å¯åŠ¨å™¨åªç”¨æ¥åšä¾èµ–å¯¼å…¥ï¼›</p><p>ä¸“é—¨æ¥å†™ä¸€ä¸ªè‡ªåŠ¨é…ç½®æ¨¡å—ï¼›</p><p>å¯åŠ¨å™¨ä¾èµ–è‡ªåŠ¨é…ç½®ï¼›åˆ«äººåªéœ€è¦å¼•å…¥å¯åŠ¨å™¨ï¼ˆstarterï¼‰</p><p>mybatis-spring-boot-starterï¼›è‡ªå®šä¹‰å¯åŠ¨å™¨å-spring-boot-starter</p><p>æ­¥éª¤ï¼š</p><h2 id="1ï¼‰ã€å¯åŠ¨å™¨æ¨¡å—"><a href="#1ï¼‰ã€å¯åŠ¨å™¨æ¨¡å—" class="headerlink" title="1ï¼‰ã€å¯åŠ¨å™¨æ¨¡å—"></a>1ï¼‰ã€å¯åŠ¨å™¨æ¨¡å—</h2><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.starter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atguigu-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>    <span class="hljs-comment">&lt;!--å¯åŠ¨å™¨--&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>        <span class="hljs-comment">&lt;!--å¼•å…¥è‡ªåŠ¨é…ç½®æ¨¡å—--&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.starter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><h2 id="2ï¼‰ã€è‡ªåŠ¨é…ç½®æ¨¡å—"><a href="#2ï¼‰ã€è‡ªåŠ¨é…ç½®æ¨¡å—" class="headerlink" title="2ï¼‰ã€è‡ªåŠ¨é…ç½®æ¨¡å—"></a>2ï¼‰ã€è‡ªåŠ¨é…ç½®æ¨¡å—</h2><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><span class="hljs-tag">   <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.atguigu.starter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>jar<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>atguigu-spring-boot-starter-autoconfigurer<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Demo project for Spring Boot<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.5.10.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.build.sourceEncoding</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">project.reporting.outputEncoding</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>      <span class="hljs-comment">&lt;!--å¼•å…¥spring-boot-starterï¼›æ‰€æœ‰starterçš„åŸºæœ¬é…ç½®--&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>         <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>         <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.starter;<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;<span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"atguigu.hello"</span>)<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloProperties</span> </span>&#123;    <span class="hljs-keyword">private</span> String prefix;    <span class="hljs-keyword">private</span> String suffix;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPrefix</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> prefix;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPrefix</span><span class="hljs-params">(String prefix)</span> </span>&#123;        <span class="hljs-keyword">this</span>.prefix = prefix;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getSuffix</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> suffix;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setSuffix</span><span class="hljs-params">(String suffix)</span> </span>&#123;        <span class="hljs-keyword">this</span>.suffix = suffix;    &#125;&#125;</code></pre></div><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.starter;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloService</span> </span>&#123;    HelloProperties helloProperties;    <span class="hljs-function"><span class="hljs-keyword">public</span> HelloProperties <span class="hljs-title">getHelloProperties</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">return</span> helloProperties;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHelloProperties</span><span class="hljs-params">(HelloProperties helloProperties)</span> </span>&#123;        <span class="hljs-keyword">this</span>.helloProperties = helloProperties;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">sayHellAtguigu</span><span class="hljs-params">(String name)</span></span>&#123;        <span class="hljs-keyword">return</span> helloProperties.getPrefix()+<span class="hljs-string">"-"</span> +name + helloProperties.getSuffix();    &#125;&#125;</code></pre></div><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.atguigu.starter;<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnWebApplication</span> <span class="hljs-comment">//webåº”ç”¨æ‰ç”Ÿæ•ˆ</span><span class="hljs-meta">@EnableConfigurationProperties</span>(HelloProperties<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">HelloServiceAutoConfiguration</span> </span>&#123;    <span class="hljs-meta">@Autowired</span>    HelloProperties helloProperties;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> HelloService <span class="hljs-title">helloService</span><span class="hljs-params">()</span></span>&#123;        HelloService service = <span class="hljs-keyword">new</span> HelloService();        service.setHelloProperties(helloProperties);        <span class="hljs-keyword">return</span> service;    &#125;&#125;</code></pre></div><h1 id><a href="#" class="headerlink" title></a></h1>]]></content>
    
    
    <categories>
      
      <category>æ–°æ‰‹æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootå¯åŠ¨é…ç½®åŸç†</title>
    <link href="/2020/08/04/SpringBoot%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/"/>
    <url>/2020/08/04/SpringBoot%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="å¯åŠ¨é…ç½®åŸç†"><a href="#å¯åŠ¨é…ç½®åŸç†" class="headerlink" title="å¯åŠ¨é…ç½®åŸç†"></a>å¯åŠ¨é…ç½®åŸç†</h1><p>å‡ ä¸ªé‡è¦çš„äº‹ä»¶å›è°ƒæœºåˆ¶</p><p>é…ç½®åœ¨META-INF/spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><p><strong>SpringApplicationRunListener</strong></p><p>åªéœ€è¦æ”¾åœ¨iocå®¹å™¨ä¸­</p><p><strong>ApplicationRunner</strong></p><p><strong>CommandLineRunner</strong></p><p>å¯åŠ¨æµç¨‹ï¼š</p><h2 id="1ã€åˆ›å»ºSpringApplicationå¯¹è±¡"><a href="#1ã€åˆ›å»ºSpringApplicationå¯¹è±¡" class="headerlink" title="1ã€åˆ›å»ºSpringApplicationå¯¹è±¡"></a><strong>1ã€åˆ›å»ºSpringApplicationå¯¹è±¡</strong></h2><div class="hljs"><pre><code class="hljs java">initialize(sources);<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">(Object[] sources)</span> </span>&#123;    <span class="hljs-comment">//ä¿å­˜ä¸»é…ç½®ç±»</span>    <span class="hljs-keyword">if</span> (sources != <span class="hljs-keyword">null</span> &amp;&amp; sources.length &gt; <span class="hljs-number">0</span>) &#123;        <span class="hljs-keyword">this</span>.sources.addAll(Arrays.asList(sources));    &#125;    <span class="hljs-comment">//åˆ¤æ–­å½“å‰æ˜¯å¦ä¸€ä¸ªwebåº”ç”¨</span>    <span class="hljs-keyword">this</span>.webEnvironment = deduceWebEnvironment();    <span class="hljs-comment">//ä»ç±»è·¯å¾„ä¸‹æ‰¾åˆ°META-INF/spring.factoriesé…ç½®çš„æ‰€æœ‰ApplicationContextInitializerï¼›ç„¶åä¿å­˜èµ·æ¥</span>    setInitializers((Collection) getSpringFactoriesInstances(        ApplicationContextInitializer<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;    <span class="hljs-comment">//ä»ç±»è·¯å¾„ä¸‹æ‰¾åˆ°ETA-INF/spring.factoriesé…ç½®çš„æ‰€æœ‰ApplicationListener</span>    setListeners((Collection) getSpringFactoriesInstances(ApplicationListener<span class="hljs-class">.<span class="hljs-keyword">class</span>))</span>;    <span class="hljs-comment">//ä»å¤šä¸ªé…ç½®ç±»ä¸­æ‰¾åˆ°æœ‰mainæ–¹æ³•çš„ä¸»é…ç½®ç±»</span>    <span class="hljs-keyword">this</span>.mainApplicationClass = deduceMainApplicationClass();&#125;</code></pre></div><p><img src="/2020/08/04/SpringBoot%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145727.png" srcset="/img/loading.gif" alt></p><p><img src="/2020/08/04/SpringBoot%E5%90%AF%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306145855.png" srcset="/img/loading.gif" alt></p><h2 id="2ã€è¿è¡Œrunæ–¹æ³•"><a href="#2ã€è¿è¡Œrunæ–¹æ³•" class="headerlink" title="2ã€è¿è¡Œrunæ–¹æ³•"></a>2ã€è¿è¡Œrunæ–¹æ³•</h2><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> ConfigurableApplicationContext <span class="hljs-title">run</span><span class="hljs-params">(String... args)</span> </span>&#123;   StopWatch stopWatch = <span class="hljs-keyword">new</span> StopWatch();   stopWatch.start();   ConfigurableApplicationContext context = <span class="hljs-keyword">null</span>;   FailureAnalyzers analyzers = <span class="hljs-keyword">null</span>;   configureHeadlessProperty();       <span class="hljs-comment">//è·å–SpringApplicationRunListenersï¼›ä»ç±»è·¯å¾„ä¸‹META-INF/spring.factories</span>   SpringApplicationRunListeners listeners = getRunListeners(args);    <span class="hljs-comment">//å›è°ƒæ‰€æœ‰çš„è·å–SpringApplicationRunListener.starting()æ–¹æ³•</span>   listeners.starting();   <span class="hljs-keyword">try</span> &#123;       <span class="hljs-comment">//å°è£…å‘½ä»¤è¡Œå‚æ•°</span>      ApplicationArguments applicationArguments = <span class="hljs-keyword">new</span> DefaultApplicationArguments(            args);      <span class="hljs-comment">//å‡†å¤‡ç¯å¢ƒ</span>      ConfigurableEnvironment environment = prepareEnvironment(listeners,            applicationArguments);       <span class="hljs-comment">//åˆ›å»ºç¯å¢ƒå®Œæˆåå›è°ƒSpringApplicationRunListener.environmentPrepared()ï¼›è¡¨ç¤ºç¯å¢ƒå‡†å¤‡å®Œæˆ</span>             Banner printedBanner = printBanner(environment);              <span class="hljs-comment">//åˆ›å»ºApplicationContextï¼›å†³å®šåˆ›å»ºwebçš„iocè¿˜æ˜¯æ™®é€šçš„ioc</span>      context = createApplicationContext();             analyzers = <span class="hljs-keyword">new</span> FailureAnalyzers(context);       <span class="hljs-comment">//å‡†å¤‡ä¸Šä¸‹æ–‡ç¯å¢ƒ;å°†environmentä¿å­˜åˆ°iocä¸­ï¼›è€Œä¸”applyInitializers()ï¼›</span>       <span class="hljs-comment">//applyInitializers()ï¼šå›è°ƒä¹‹å‰ä¿å­˜çš„æ‰€æœ‰çš„ApplicationContextInitializerçš„initializeæ–¹æ³•</span>       <span class="hljs-comment">//å›è°ƒæ‰€æœ‰çš„SpringApplicationRunListenerçš„contextPrepared()ï¼›</span>       <span class="hljs-comment">//</span>      prepareContext(context, environment, listeners, applicationArguments,            printedBanner);       <span class="hljs-comment">//prepareContextè¿è¡Œå®Œæˆä»¥åå›è°ƒæ‰€æœ‰çš„SpringApplicationRunListenerçš„contextLoadedï¼ˆï¼‰ï¼›</span>              <span class="hljs-comment">//såˆ·æ–°å®¹å™¨ï¼›iocå®¹å™¨åˆå§‹åŒ–ï¼ˆå¦‚æœæ˜¯webåº”ç”¨è¿˜ä¼šåˆ›å»ºåµŒå…¥å¼çš„Tomcatï¼‰ï¼›Springæ³¨è§£ç‰ˆ</span>       <span class="hljs-comment">//æ‰«æï¼Œåˆ›å»ºï¼ŒåŠ è½½æ‰€æœ‰ç»„ä»¶çš„åœ°æ–¹ï¼›ï¼ˆé…ç½®ç±»ï¼Œç»„ä»¶ï¼Œè‡ªåŠ¨é…ç½®ï¼‰</span>      refreshContext(context);       <span class="hljs-comment">//ä»iocå®¹å™¨ä¸­è·å–æ‰€æœ‰çš„ApplicationRunnerå’ŒCommandLineRunnerè¿›è¡Œå›è°ƒ</span>       <span class="hljs-comment">//ApplicationRunnerå…ˆå›è°ƒï¼ŒCommandLineRunnerå†å›è°ƒ</span>      afterRefresh(context, applicationArguments);       <span class="hljs-comment">//æ‰€æœ‰çš„SpringApplicationRunListenerå›è°ƒfinishedæ–¹æ³•</span>      listeners.finished(context, <span class="hljs-keyword">null</span>);      stopWatch.stop();      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.logStartupInfo) &#123;         <span class="hljs-keyword">new</span> StartupInfoLogger(<span class="hljs-keyword">this</span>.mainApplicationClass)               .logStarted(getApplicationLog(), stopWatch);      &#125;       <span class="hljs-comment">//æ•´ä¸ªSpringBootåº”ç”¨å¯åŠ¨å®Œæˆä»¥åè¿”å›å¯åŠ¨çš„iocå®¹å™¨ï¼›</span>      <span class="hljs-keyword">return</span> context;   &#125;   <span class="hljs-keyword">catch</span> (Throwable ex) &#123;      handleRunFailure(context, listeners, analyzers, ex);      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalStateException(ex);   &#125;&#125;</code></pre></div><h2 id="3ã€äº‹ä»¶ç›‘å¬æœºåˆ¶"><a href="#3ã€äº‹ä»¶ç›‘å¬æœºåˆ¶" class="headerlink" title="3ã€äº‹ä»¶ç›‘å¬æœºåˆ¶"></a>3ã€äº‹ä»¶ç›‘å¬æœºåˆ¶</h2><p>é…ç½®åœ¨META-INF/spring.factories</p><p><strong>ApplicationContextInitializer</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloApplicationContextInitializer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationContextInitializer</span>&lt;<span class="hljs-title">ConfigurableApplicationContext</span>&gt; </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialize</span><span class="hljs-params">(ConfigurableApplicationContext applicationContext)</span> </span>&#123;        System.out.println(<span class="hljs-string">"ApplicationContextInitializer...initialize..."</span>+applicationContext);    &#125;&#125;</code></pre></div><p><strong>SpringApplicationRunListener</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloSpringApplicationRunListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">SpringApplicationRunListener</span> </span>&#123;    <span class="hljs-comment">//å¿…é¡»æœ‰çš„æ„é€ å™¨</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HelloSpringApplicationRunListener</span><span class="hljs-params">(SpringApplication application, String[] args)</span></span>&#123;    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">starting</span><span class="hljs-params">()</span> </span>&#123;        System.out.println(<span class="hljs-string">"SpringApplicationRunListener...starting..."</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">environmentPrepared</span><span class="hljs-params">(ConfigurableEnvironment environment)</span> </span>&#123;        Object o = environment.getSystemProperties().get(<span class="hljs-string">"os.name"</span>);        System.out.println(<span class="hljs-string">"SpringApplicationRunListener...environmentPrepared.."</span>+o);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextPrepared</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> </span>&#123;        System.out.println(<span class="hljs-string">"SpringApplicationRunListener...contextPrepared..."</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextLoaded</span><span class="hljs-params">(ConfigurableApplicationContext context)</span> </span>&#123;        System.out.println(<span class="hljs-string">"SpringApplicationRunListener...contextLoaded..."</span>);    &#125;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">finished</span><span class="hljs-params">(ConfigurableApplicationContext context, Throwable exception)</span> </span>&#123;        System.out.println(<span class="hljs-string">"SpringApplicationRunListener...finished..."</span>);    &#125;&#125;</code></pre></div><p>é…ç½®ï¼ˆMETA-INF/spring.factoriesï¼‰</p><div class="hljs"><pre><code class="hljs properties"><span class="hljs-meta">org.springframework.context.ApplicationContextInitializer</span>=<span class="hljs-string">\</span><span class="hljs-attr">com.atguigu.springboot.listener.HelloApplicationContextInitializer</span><span class="hljs-meta">org.springframework.boot.SpringApplicationRunListener</span>=<span class="hljs-string">\</span><span class="hljs-attr">com.atguigu.springboot.listener.HelloSpringApplicationRunListener</span></code></pre></div><p>åªéœ€è¦æ”¾åœ¨iocå®¹å™¨ä¸­</p><p><strong>ApplicationRunner</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloApplicationRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">ApplicationRunner</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">"ApplicationRunner...run...."</span>);    &#125;&#125;</code></pre></div><p><strong>CommandLineRunner</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloCommandLineRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CommandLineRunner</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;        System.out.println(<span class="hljs-string">"CommandLineRunner...run..."</span>+ Arrays.asList(args));    &#125;&#125;</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>æºç åˆ†æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootä¸æ•°æ®è®¿é—®</title>
    <link href="/2020/08/04/SpringBoot%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/"/>
    <url>/2020/08/04/SpringBoot%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="SpringBootä¸æ•°æ®è®¿é—®"><a href="#SpringBootä¸æ•°æ®è®¿é—®" class="headerlink" title="SpringBootä¸æ•°æ®è®¿é—®"></a>SpringBootä¸æ•°æ®è®¿é—®</h1><h2 id="1ã€JDBC"><a href="#1ã€JDBC" class="headerlink" title="1ã€JDBC"></a>1ã€JDBC</h2><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span>  <span class="hljs-attr">datasource:</span>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.15.22:3306/jdbc</span>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span></code></pre></div><p>æ•ˆæœï¼š</p><p>â€‹    é»˜è®¤æ˜¯ç”¨org.apache.tomcat.jdbc.pool.DataSourceä½œä¸ºæ•°æ®æºï¼›</p><p>â€‹    æ•°æ®æºçš„ç›¸å…³é…ç½®éƒ½åœ¨DataSourcePropertiesé‡Œé¢ï¼›</p><p>è‡ªåŠ¨é…ç½®åŸç†ï¼š</p><p>org.springframework.boot.autoconfigure.jdbcï¼š</p><p>1ã€å‚è€ƒDataSourceConfigurationï¼Œæ ¹æ®é…ç½®åˆ›å»ºæ•°æ®æºï¼Œé»˜è®¤ä½¿ç”¨Tomcatè¿æ¥æ± ï¼›å¯ä»¥ä½¿ç”¨spring.datasource.typeæŒ‡å®šè‡ªå®šä¹‰çš„æ•°æ®æºç±»å‹ï¼›</p><p>2ã€SpringBooté»˜è®¤å¯ä»¥æ”¯æŒï¼›</p><div class="hljs"><pre><code class="hljs css"><span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.tomcat</span><span class="hljs-selector-class">.jdbc</span><span class="hljs-selector-class">.pool</span><span class="hljs-selector-class">.DataSource</span>ã€<span class="hljs-selector-tag">HikariDataSource</span>ã€<span class="hljs-selector-tag">BasicDataSource</span>ã€</code></pre></div><p>3ã€è‡ªå®šä¹‰æ•°æ®æºç±»å‹</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span><span class="hljs-comment"> * Generic DataSource configuration.</span><span class="hljs-comment"> */</span><span class="hljs-meta">@ConditionalOnMissingBean</span>(DataSource<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class">@<span class="hljs-title">ConditionalOnProperty</span>(<span class="hljs-title">name</span> </span>= <span class="hljs-string">"spring.datasource.type"</span>)<span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Generic</span> </span>&#123;   <span class="hljs-meta">@Bean</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">dataSource</span><span class="hljs-params">(DataSourceProperties properties)</span> </span>&#123;       <span class="hljs-comment">//ä½¿ç”¨DataSourceBuilderåˆ›å»ºæ•°æ®æºï¼Œåˆ©ç”¨åå°„åˆ›å»ºå“åº”typeçš„æ•°æ®æºï¼Œå¹¶ä¸”ç»‘å®šç›¸å…³å±æ€§</span>      <span class="hljs-keyword">return</span> properties.initializeDataSourceBuilder().build();   &#125;&#125;</code></pre></div><p>4ã€<strong>DataSourceInitializerï¼šApplicationListener</strong>ï¼›</p><p>â€‹    ä½œç”¨ï¼š</p><p>â€‹        1ï¼‰ã€runSchemaScripts();è¿è¡Œå»ºè¡¨è¯­å¥ï¼›</p><p>â€‹        2ï¼‰ã€runDataScripts();è¿è¡Œæ’å…¥æ•°æ®çš„sqlè¯­å¥ï¼›</p><p>é»˜è®¤åªéœ€è¦å°†æ–‡ä»¶å‘½åä¸ºï¼š</p><div class="hljs"><pre><code class="hljs properties"><span class="hljs-attr">schema-*.sqlã€data-*.sql</span><span class="hljs-attr">é»˜è®¤è§„åˆ™ï¼šschema.sqlï¼Œschema-all.sqlï¼›</span><span class="hljs-meta">å¯ä»¥ä½¿ç”¨</span>   <span class="hljs-string"></span><span class="hljs-attr">schema</span>:<span class="hljs-string"></span>      <span class="hljs-meta">-</span> <span class="hljs-string">classpath:department.sql</span>      <span class="hljs-attr">æŒ‡å®šä½ç½®</span></code></pre></div><p>5ã€æ“ä½œæ•°æ®åº“ï¼šè‡ªåŠ¨é…ç½®äº†JdbcTemplateæ“ä½œæ•°æ®åº“</p><h2 id="2ã€æ•´åˆDruidæ•°æ®æº"><a href="#2ã€æ•´åˆDruidæ•°æ®æº" class="headerlink" title="2ã€æ•´åˆDruidæ•°æ®æº"></a>2ã€æ•´åˆDruidæ•°æ®æº</h2><div class="hljs"><pre><code class="hljs java">å¯¼å…¥druidæ•°æ®æº<span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DruidConfig</span> </span>&#123;    <span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"spring.datasource"</span>)    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> DataSource <span class="hljs-title">druid</span><span class="hljs-params">()</span></span>&#123;       <span class="hljs-keyword">return</span>  <span class="hljs-keyword">new</span> DruidDataSource();    &#125;    <span class="hljs-comment">//é…ç½®Druidçš„ç›‘æ§</span>    <span class="hljs-comment">//1ã€é…ç½®ä¸€ä¸ªç®¡ç†åå°çš„Servlet</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">statViewServlet</span><span class="hljs-params">()</span></span>&#123;        ServletRegistrationBean bean = <span class="hljs-keyword">new</span> ServletRegistrationBean(<span class="hljs-keyword">new</span> StatViewServlet(), <span class="hljs-string">"/druid/*"</span>);        Map&lt;String,String&gt; initParams = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();        initParams.put(<span class="hljs-string">"loginUsername"</span>,<span class="hljs-string">"admin"</span>);        initParams.put(<span class="hljs-string">"loginPassword"</span>,<span class="hljs-string">"123456"</span>);        initParams.put(<span class="hljs-string">"allow"</span>,<span class="hljs-string">""</span>);<span class="hljs-comment">//é»˜è®¤å°±æ˜¯å…è®¸æ‰€æœ‰è®¿é—®</span>        initParams.put(<span class="hljs-string">"deny"</span>,<span class="hljs-string">"192.168.15.21"</span>);        bean.setInitParameters(initParams);        <span class="hljs-keyword">return</span> bean;    &#125;    <span class="hljs-comment">//2ã€é…ç½®ä¸€ä¸ªwebç›‘æ§çš„filter</span>    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">webStatFilter</span><span class="hljs-params">()</span></span>&#123;        FilterRegistrationBean bean = <span class="hljs-keyword">new</span> FilterRegistrationBean();        bean.setFilter(<span class="hljs-keyword">new</span> WebStatFilter());        Map&lt;String,String&gt; initParams = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();        initParams.put(<span class="hljs-string">"exclusions"</span>,<span class="hljs-string">"*.js,*.css,/druid/*"</span>);        bean.setInitParameters(initParams);        bean.setUrlPatterns(Arrays.asList(<span class="hljs-string">"/*"</span>));        <span class="hljs-keyword">return</span>  bean;    &#125;&#125;</code></pre></div><h2 id="3ã€æ•´åˆMyBatis"><a href="#3ã€æ•´åˆMyBatis" class="headerlink" title="3ã€æ•´åˆMyBatis"></a>3ã€æ•´åˆMyBatis</h2><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><img src="/2020/08/04/SpringBoot%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180305194443.png" srcset="/img/loading.gif" alt></p><p>æ­¥éª¤ï¼š</p><p>â€‹    1ï¼‰ã€é…ç½®æ•°æ®æºç›¸å…³å±æ€§ï¼ˆè§ä¸Šä¸€èŠ‚Druidï¼‰</p><p>â€‹    2ï¼‰ã€ç»™æ•°æ®åº“å»ºè¡¨</p><p>â€‹    3ï¼‰ã€åˆ›å»ºJavaBean</p><h3 id="4ï¼‰ã€æ³¨è§£ç‰ˆ"><a href="#4ï¼‰ã€æ³¨è§£ç‰ˆ" class="headerlink" title="4ï¼‰ã€æ³¨è§£ç‰ˆ"></a>4ï¼‰ã€æ³¨è§£ç‰ˆ</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æŒ‡å®šè¿™æ˜¯ä¸€ä¸ªæ“ä½œæ•°æ®åº“çš„mapper</span><span class="hljs-meta">@Mapper</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DepartmentMapper</span> </span>&#123;    <span class="hljs-meta">@Select</span>(<span class="hljs-string">"select * from department where id=#&#123;id&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> Department <span class="hljs-title">getDeptById</span><span class="hljs-params">(Integer id)</span></span>;    <span class="hljs-meta">@Delete</span>(<span class="hljs-string">"delete from department where id=#&#123;id&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">deleteDeptById</span><span class="hljs-params">(Integer id)</span></span>;    <span class="hljs-meta">@Options</span>(useGeneratedKeys = <span class="hljs-keyword">true</span>,keyProperty = <span class="hljs-string">"id"</span>)    <span class="hljs-meta">@Insert</span>(<span class="hljs-string">"insert into department(departmentName) values(#&#123;departmentName&#125;)"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">insertDept</span><span class="hljs-params">(Department department)</span></span>;    <span class="hljs-meta">@Update</span>(<span class="hljs-string">"update department set departmentName=#&#123;departmentName&#125; where id=#&#123;id&#125;"</span>)    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">updateDept</span><span class="hljs-params">(Department department)</span></span>;&#125;</code></pre></div><p>é—®é¢˜ï¼š</p><p>è‡ªå®šä¹‰MyBatisçš„é…ç½®è§„åˆ™ï¼›ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªConfigurationCustomizerï¼›</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@org</span>.springframework.context.annotation.Configuration<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisConfig</span> </span>&#123;    <span class="hljs-meta">@Bean</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> ConfigurationCustomizer <span class="hljs-title">configurationCustomizer</span><span class="hljs-params">()</span></span>&#123;        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ConfigurationCustomizer()&#123;            <span class="hljs-meta">@Override</span>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">customize</span><span class="hljs-params">(Configuration configuration)</span> </span>&#123;                configuration.setMapUnderscoreToCamelCase(<span class="hljs-keyword">true</span>);            &#125;        &#125;;    &#125;&#125;</code></pre></div><div class="hljs"><pre><code class="hljs java">ä½¿ç”¨MapperScanæ‰¹é‡æ‰«ææ‰€æœ‰çš„Mapperæ¥å£ï¼›<span class="hljs-meta">@MapperScan</span>(value = <span class="hljs-string">"com.atguigu.springboot.mapper"</span>)<span class="hljs-meta">@SpringBootApplication</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringBoot06DataMybatisApplication</span> </span>&#123;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;SpringApplication.run(SpringBoot06DataMybatisApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;&#125;&#125;</code></pre></div><h3 id="5ï¼‰ã€é…ç½®æ–‡ä»¶ç‰ˆ"><a href="#5ï¼‰ã€é…ç½®æ–‡ä»¶ç‰ˆ" class="headerlink" title="5ï¼‰ã€é…ç½®æ–‡ä»¶ç‰ˆ"></a>5ï¼‰ã€é…ç½®æ–‡ä»¶ç‰ˆ</h3><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">mybatis:</span>  <span class="hljs-attr">config-location:</span> <span class="hljs-string">classpath:mybatis/mybatis-config.xml</span> <span class="hljs-string">æŒ‡å®šå…¨å±€é…ç½®æ–‡ä»¶çš„ä½ç½®</span>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mybatis/mapper/*.xml</span>  <span class="hljs-string">æŒ‡å®šsqlæ˜ å°„æ–‡ä»¶çš„ä½ç½®</span></code></pre></div><p>æ›´å¤šä½¿ç”¨å‚ç…§</p><p><a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/" target="_blank" rel="noopener">http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/</a></p><h2 id="4ã€æ•´åˆSpringData-JPA"><a href="#4ã€æ•´åˆSpringData-JPA" class="headerlink" title="4ã€æ•´åˆSpringData JPA"></a>4ã€æ•´åˆSpringData JPA</h2><h3 id="1ï¼‰ã€SpringDataç®€ä»‹"><a href="#1ï¼‰ã€SpringDataç®€ä»‹" class="headerlink" title="1ï¼‰ã€SpringDataç®€ä»‹"></a>1ï¼‰ã€SpringDataç®€ä»‹</h3><p><img src="/2020/08/04/SpringBoot%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180306105412.png" srcset="/img/loading.gif" alt></p><h3 id="2ï¼‰ã€æ•´åˆSpringData-JPA"><a href="#2ï¼‰ã€æ•´åˆSpringData-JPA" class="headerlink" title="2ï¼‰ã€æ•´åˆSpringData JPA"></a>2ï¼‰ã€æ•´åˆSpringData JPA</h3><p>JPA:ORMï¼ˆObject Relational Mappingï¼‰ï¼›</p><p>1ï¼‰ã€ç¼–å†™ä¸€ä¸ªå®ä½“ç±»ï¼ˆbeanï¼‰å’Œæ•°æ®è¡¨è¿›è¡Œæ˜ å°„ï¼Œå¹¶ä¸”é…ç½®å¥½æ˜ å°„å…³ç³»ï¼›</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä½¿ç”¨JPAæ³¨è§£é…ç½®æ˜ å°„å…³ç³»</span><span class="hljs-meta">@Entity</span> <span class="hljs-comment">//å‘Šè¯‰JPAè¿™æ˜¯ä¸€ä¸ªå®ä½“ç±»ï¼ˆå’Œæ•°æ®è¡¨æ˜ å°„çš„ç±»ï¼‰</span><span class="hljs-meta">@Table</span>(name = <span class="hljs-string">"tbl_user"</span>) <span class="hljs-comment">//@Tableæ¥æŒ‡å®šå’Œå“ªä¸ªæ•°æ®è¡¨å¯¹åº”;å¦‚æœçœç•¥é»˜è®¤è¡¨åå°±æ˜¯userï¼›</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;    <span class="hljs-meta">@Id</span> <span class="hljs-comment">//è¿™æ˜¯ä¸€ä¸ªä¸»é”®</span>    <span class="hljs-meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)<span class="hljs-comment">//è‡ªå¢ä¸»é”®</span>    <span class="hljs-keyword">private</span> Integer id;    <span class="hljs-meta">@Column</span>(name = <span class="hljs-string">"last_name"</span>,length = <span class="hljs-number">50</span>) <span class="hljs-comment">//è¿™æ˜¯å’Œæ•°æ®è¡¨å¯¹åº”çš„ä¸€ä¸ªåˆ—</span>    <span class="hljs-keyword">private</span> String lastName;    <span class="hljs-meta">@Column</span> <span class="hljs-comment">//çœç•¥é»˜è®¤åˆ—åå°±æ˜¯å±æ€§å</span>    <span class="hljs-keyword">private</span> String email;</code></pre></div><p>2ï¼‰ã€ç¼–å†™ä¸€ä¸ªDaoæ¥å£æ¥æ“ä½œå®ä½“ç±»å¯¹åº”çš„æ•°æ®è¡¨ï¼ˆRepositoryï¼‰</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ç»§æ‰¿JpaRepositoryæ¥å®Œæˆå¯¹æ•°æ®åº“çš„æ“ä½œ</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">User</span>,<span class="hljs-title">Integer</span>&gt; </span>&#123;&#125;</code></pre></div><p>3ï¼‰ã€åŸºæœ¬çš„é…ç½®JpaProperties</p><div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span>   <span class="hljs-attr">jpa:</span>    <span class="hljs-attr">hibernate:</span><span class="hljs-comment">#     æ›´æ–°æˆ–è€…åˆ›å»ºæ•°æ®è¡¨ç»“æ„</span>      <span class="hljs-attr">ddl-auto:</span> <span class="hljs-string">update</span><span class="hljs-comment">#    æ§åˆ¶å°æ˜¾ç¤ºSQL</span>    <span class="hljs-attr">show-sql:</span> <span class="hljs-literal">true</span></code></pre></div><h1 id><a href="#" class="headerlink" title></a></h1>]]></content>
    
    
    <categories>
      
      <category>æ–°æ‰‹æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>MyBatis</tag>
      
      <tag>JDBC</tag>
      
      <tag>SpringData JPA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dockerå…¥é—¨</title>
    <link href="/2020/08/03/Docker%E5%85%A5%E9%97%A8/"/>
    <url>/2020/08/03/Docker%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="1ã€ç®€ä»‹"><a href="#1ã€ç®€ä»‹" class="headerlink" title="1ã€ç®€ä»‹"></a>1ã€ç®€ä»‹</h2><p><strong>Docker</strong>æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼›æ˜¯ä¸€ä¸ªè½»é‡çº§å®¹å™¨æŠ€æœ¯ï¼›</p><p>Dockeræ”¯æŒå°†è½¯ä»¶ç¼–è¯‘æˆä¸€ä¸ªé•œåƒï¼›ç„¶ååœ¨é•œåƒä¸­å„ç§è½¯ä»¶åšå¥½é…ç½®ï¼Œå°†é•œåƒå‘å¸ƒå‡ºå»ï¼Œå…¶ä»–ä½¿ç”¨è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªé•œåƒï¼›</p><p>è¿è¡Œä¸­çš„è¿™ä¸ªé•œåƒç§°ä¸ºå®¹å™¨ï¼Œå®¹å™¨å¯åŠ¨æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚</p><p><img src="/2020/08/03/Docker%E5%85%A5%E9%97%A8/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145450.png" srcset="/img/loading.gif" alt></p><p><img src="/2020/08/03/Docker%E5%85%A5%E9%97%A8/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303145531.png" srcset="/img/loading.gif" alt></p><h2 id="2ã€æ ¸å¿ƒæ¦‚å¿µ"><a href="#2ã€æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="2ã€æ ¸å¿ƒæ¦‚å¿µ"></a>2ã€æ ¸å¿ƒæ¦‚å¿µ</h2><p>dockerä¸»æœº(Host)ï¼šå®‰è£…äº†Dockerç¨‹åºçš„æœºå™¨ï¼ˆDockerç›´æ¥å®‰è£…åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸Šï¼‰ï¼›</p><p>dockerå®¢æˆ·ç«¯(Client)ï¼šè¿æ¥dockerä¸»æœºè¿›è¡Œæ“ä½œï¼›</p><p>dockerä»“åº“(Registry)ï¼šç”¨æ¥ä¿å­˜å„ç§æ‰“åŒ…å¥½çš„è½¯ä»¶é•œåƒï¼›</p><p>dockeré•œåƒ(Images)ï¼šè½¯ä»¶æ‰“åŒ…å¥½çš„é•œåƒï¼›æ”¾åœ¨dockerä»“åº“ä¸­ï¼›</p><p>dockerå®¹å™¨(Container)ï¼šé•œåƒå¯åŠ¨åçš„å®ä¾‹ç§°ä¸ºä¸€ä¸ªå®¹å™¨ï¼›å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨</p><p><img src="/2020/08/03/Docker%E5%85%A5%E9%97%A8/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180303165113.png" srcset="/img/loading.gif" alt></p><p>ä½¿ç”¨Dockerçš„æ­¥éª¤ï¼š</p><p>1ï¼‰ã€å®‰è£…Docker</p><p>2ï¼‰ã€å»Dockerä»“åº“æ‰¾åˆ°è¿™ä¸ªè½¯ä»¶å¯¹åº”çš„é•œåƒï¼›</p><p>3ï¼‰ã€ä½¿ç”¨Dockerè¿è¡Œè¿™ä¸ªé•œåƒï¼Œè¿™ä¸ªé•œåƒå°±ä¼šç”Ÿæˆä¸€ä¸ªDockerå®¹å™¨ï¼›</p><p>4ï¼‰ã€å¯¹å®¹å™¨çš„å¯åŠ¨åœæ­¢å°±æ˜¯å¯¹è½¯ä»¶çš„å¯åŠ¨åœæ­¢ï¼›</p><h2 id="3ã€å®‰è£…Docker"><a href="#3ã€å®‰è£…Docker" class="headerlink" title="3ã€å®‰è£…Docker"></a>3ã€å®‰è£…Docker</h2><h4 id="1ï¼‰ã€å®‰è£…linuxè™šæ‹Ÿæœº"><a href="#1ï¼‰ã€å®‰è£…linuxè™šæ‹Ÿæœº" class="headerlink" title="1ï¼‰ã€å®‰è£…linuxè™šæ‹Ÿæœº"></a>1ï¼‰ã€å®‰è£…linuxè™šæ‹Ÿæœº</h4><p>â€‹    1ï¼‰ã€VMWareã€VirtualBoxï¼ˆå®‰è£…ï¼‰ï¼›</p><p>â€‹    2ï¼‰ã€å¯¼å…¥è™šæ‹Ÿæœºæ–‡ä»¶centos7-atguigu.ovaï¼›</p><p>â€‹    3ï¼‰ã€åŒå‡»å¯åŠ¨linuxè™šæ‹Ÿæœº;ä½¿ç”¨  root/ 123456ç™»é™†</p><p>â€‹    4ï¼‰ã€ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥linuxæœåŠ¡å™¨è¿›è¡Œå‘½ä»¤æ“ä½œï¼›</p><p>â€‹    5ï¼‰ã€è®¾ç½®è™šæ‹Ÿæœºç½‘ç»œï¼›</p><p>â€‹        æ¡¥æ¥ç½‘ç»œ===é€‰å¥½ç½‘å¡====æ¥å…¥ç½‘çº¿ï¼›</p><p>â€‹    6ï¼‰ã€è®¾ç½®å¥½ç½‘ç»œä»¥åä½¿ç”¨å‘½ä»¤é‡å¯è™šæ‹Ÿæœºçš„ç½‘ç»œ</p><div class="hljs"><pre><code class="hljs shell">service network restart</code></pre></div><p>â€‹    7ï¼‰ã€æŸ¥çœ‹linuxçš„ipåœ°å€</p><div class="hljs"><pre><code class="hljs shell">ip addr</code></pre></div><p>â€‹    8ï¼‰ã€ä½¿ç”¨å®¢æˆ·ç«¯è¿æ¥linuxï¼›</p><h4 id="2ï¼‰ã€åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker"><a href="#2ï¼‰ã€åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker" class="headerlink" title="2ï¼‰ã€åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker"></a>2ï¼‰ã€åœ¨linuxè™šæ‹Ÿæœºä¸Šå®‰è£…docker</h4><p>æ­¥éª¤ï¼š</p><div class="hljs"><pre><code class="hljs shell">1ã€æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼Œå¿…é¡»æ˜¯3.10åŠä»¥ä¸Šuname -r2ã€å®‰è£…dockeryum install docker3ã€è¾“å…¥yç¡®è®¤å®‰è£…4ã€å¯åŠ¨docker[root@localhost ~]# systemctl start docker[root@localhost ~]# docker -vDocker version 1.12.6, build 3e8e77d/1.12.65ã€å¼€æœºå¯åŠ¨docker[root@localhost ~]# systemctl enable dockerCreated symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.6ã€åœæ­¢dockersystemctl stop docker</code></pre></div><h2 id="4ã€Dockerå¸¸ç”¨å‘½ä»¤-amp-æ“ä½œ"><a href="#4ã€Dockerå¸¸ç”¨å‘½ä»¤-amp-æ“ä½œ" class="headerlink" title="4ã€Dockerå¸¸ç”¨å‘½ä»¤&amp;æ“ä½œ"></a>4ã€Dockerå¸¸ç”¨å‘½ä»¤&amp;æ“ä½œ</h2><h3 id="1ï¼‰é•œåƒæ“ä½œ"><a href="#1ï¼‰é•œåƒæ“ä½œ" class="headerlink" title="1ï¼‰é•œåƒæ“ä½œ"></a>1ï¼‰é•œåƒæ“ä½œ</h3><table><thead><tr><th>æ“ä½œ</th><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ£€ç´¢</td><td>docker  search å…³é”®å­—  egï¼šdocker  search redis</td><td>æˆ‘ä»¬ç»å¸¸å»docker  hubä¸Šæ£€ç´¢é•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚é•œåƒçš„TAGã€‚</td></tr><tr><td>æ‹‰å–</td><td>docker pull é•œåƒå:tag</td><td>:tagæ˜¯å¯é€‰çš„ï¼Œtagè¡¨ç¤ºæ ‡ç­¾ï¼Œå¤šä¸ºè½¯ä»¶çš„ç‰ˆæœ¬ï¼Œé»˜è®¤æ˜¯latest</td></tr><tr><td>åˆ—è¡¨</td><td>docker images</td><td>æŸ¥çœ‹æ‰€æœ‰æœ¬åœ°é•œåƒ</td></tr><tr><td>åˆ é™¤</td><td>docker rmi image-id</td><td>åˆ é™¤æŒ‡å®šçš„æœ¬åœ°é•œåƒ</td></tr></tbody></table><p><a href="https://hub.docker.com/" target="_blank" rel="noopener">https://hub.docker.com/</a></p><h3 id="2ï¼‰å®¹å™¨æ“ä½œ"><a href="#2ï¼‰å®¹å™¨æ“ä½œ" class="headerlink" title="2ï¼‰å®¹å™¨æ“ä½œ"></a>2ï¼‰å®¹å™¨æ“ä½œ</h3><p>è½¯ä»¶é•œåƒï¼ˆQQå®‰è£…ç¨‹åºï¼‰â€”-è¿è¡Œé•œåƒâ€”-äº§ç”Ÿä¸€ä¸ªå®¹å™¨ï¼ˆæ­£åœ¨è¿è¡Œçš„è½¯ä»¶ï¼Œè¿è¡Œçš„QQï¼‰ï¼›</p><p>æ­¥éª¤ï¼š</p><div class="hljs"><pre><code class="hljs shell">1ã€æœç´¢é•œåƒ[root@localhost ~]# docker search tomcat2ã€æ‹‰å–é•œåƒ[root@localhost ~]# docker pull tomcat3ã€æ ¹æ®é•œåƒå¯åŠ¨å®¹å™¨docker run --name mytomcat -d tomcat:latest4ã€docker ps  æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨5ã€ åœæ­¢è¿è¡Œä¸­çš„å®¹å™¨docker stop  å®¹å™¨çš„id6ã€æŸ¥çœ‹æ‰€æœ‰çš„å®¹å™¨docker ps -a7ã€å¯åŠ¨å®¹å™¨docker start å®¹å™¨id8ã€åˆ é™¤ä¸€ä¸ªå®¹å™¨ docker rm å®¹å™¨id9ã€å¯åŠ¨ä¸€ä¸ªåšäº†ç«¯å£æ˜ å°„çš„tomcat[root@localhost ~]# docker run -d -p 8888:8080 tomcat-dï¼šåå°è¿è¡Œ-p: å°†ä¸»æœºçš„ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ä¸€ä¸ªç«¯å£    ä¸»æœºç«¯å£:å®¹å™¨å†…éƒ¨çš„ç«¯å£10ã€ä¸ºäº†æ¼”ç¤ºç®€å•å…³é—­äº†linuxçš„é˜²ç«å¢™service firewalld status ï¼›æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€service firewalld stopï¼šå…³é—­é˜²ç«å¢™11ã€æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—docker logs container-name/container-idæ›´å¤šå‘½ä»¤å‚çœ‹https://docs.docker.com/engine/reference/commandline/docker/å¯ä»¥å‚è€ƒæ¯ä¸€ä¸ªé•œåƒçš„æ–‡æ¡£</code></pre></div><h3 id="3ï¼‰å®‰è£…MySQLç¤ºä¾‹"><a href="#3ï¼‰å®‰è£…MySQLç¤ºä¾‹" class="headerlink" title="3ï¼‰å®‰è£…MySQLç¤ºä¾‹"></a>3ï¼‰å®‰è£…MySQLç¤ºä¾‹</h3><div class="hljs"><pre><code class="hljs shell">docker pull mysql</code></pre></div><p>é”™è¯¯çš„å¯åŠ¨</p><div class="hljs"><pre><code class="hljs shell">[root@localhost ~]# docker run --name mysql01 -d mysql42f09819908bb72dd99ae19e792e0a5d03c48638421fa64cce5f8ba0f40f5846mysqlé€€å‡ºäº†[root@localhost ~]# docker ps -aCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                           PORTS               NAMES42f09819908b        mysql               "docker-entrypoint.sh"   34 seconds ago      Exited (1) 33 seconds ago                            mysql01538bde63e500        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       compassionate_goldstinec4f1ac60b3fc        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       lonely_fermi81ec743a5271        tomcat              "catalina.sh run"        About an hour ago   Exited (143) About an hour ago                       sick_ramanujan//é”™è¯¯æ—¥å¿—[root@localhost ~]# docker logs 42f09819908berror: database is uninitialized and password option is not specified   You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORDï¼›è¿™ä¸ªä¸‰ä¸ªå‚æ•°å¿…é¡»æŒ‡å®šä¸€ä¸ª</code></pre></div><p>æ­£ç¡®çš„å¯åŠ¨</p><div class="hljs"><pre><code class="hljs shell">[root@localhost ~]# docker run --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 -d mysqlb874c56bec49fb43024b3805ab51e9097da779f2f572c22c695305dedd684c5f[root@localhost ~]# docker psCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMESb874c56bec49        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 3 seconds        3306/tcp            mysql01</code></pre></div><p>åšäº†ç«¯å£æ˜ å°„</p><div class="hljs"><pre><code class="hljs shell">[root@localhost ~]# docker run -p 3306:3306 --name mysql02 -e MYSQL_ROOT_PASSWORD=123456 -d mysqlad10e4bc5c6a0f61cbad43898de71d366117d120e39db651844c0e73863b9434[root@localhost ~]# docker psCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMESad10e4bc5c6a        mysql               "docker-entrypoint.sh"   4 seconds ago       Up 2 seconds        0.0.0.0:3306-&gt;3306/tcp   mysql02</code></pre></div><p>å‡ ä¸ªå…¶ä»–çš„é«˜çº§æ“ä½œ</p><div class="hljs"><pre><code class="hljs routeros">docker <span class="hljs-builtin-name">run</span> --name mysql03 -v /conf/mysql:/etc/mysql/conf.d -e <span class="hljs-attribute">MYSQL_ROOT_PASSWORD</span>=my-secret-pw -d mysql:tagæŠŠä¸»æœºçš„/conf/mysqlæ–‡ä»¶å¤¹æŒ‚è½½åˆ° mysqldockerå®¹å™¨çš„/etc/mysql/conf.dæ–‡ä»¶å¤¹é‡Œé¢æ”¹mysqlçš„é…ç½®æ–‡ä»¶å°±åªéœ€è¦æŠŠmysqlé…ç½®æ–‡ä»¶æ”¾åœ¨è‡ªå®šä¹‰çš„æ–‡ä»¶å¤¹ä¸‹ï¼ˆ/conf/mysqlï¼‰docker <span class="hljs-builtin-name">run</span> --name some-mysql -e <span class="hljs-attribute">MYSQL_ROOT_PASSWORD</span>=my-secret-pw -d mysql:tag <span class="hljs-attribute">--character-set-server</span>=utf8mb4 <span class="hljs-attribute">--collation-server</span>=utf8mb4_unicode_ciæŒ‡å®šmysqlçš„ä¸€äº›é…ç½®å‚æ•°</code></pre></div>]]></content>
    
    
    <categories>
      
      <category>æ–°æ‰‹æ•™ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>é…ç½®åµŒå…¥å¼Servletå®¹å™¨</title>
    <link href="/2020/08/03/SpringBoot%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8/"/>
    <url>/2020/08/03/SpringBoot%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="é…ç½®åµŒå…¥å¼Servletå®¹å™¨"><a href="#é…ç½®åµŒå…¥å¼Servletå®¹å™¨" class="headerlink" title="é…ç½®åµŒå…¥å¼Servletå®¹å™¨"></a>é…ç½®åµŒå…¥å¼Servletå®¹å™¨</h1><p>SpringBooté»˜è®¤ä½¿ç”¨Tomcatä½œä¸ºåµŒå…¥å¼çš„Servletå®¹å™¨ï¼›</p><p><img src="/2020/08/03/SpringBoot%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180301142915.png" srcset="/img/loading.gif" alt></p><p>é—®é¢˜ï¼Ÿ</p><h3 id="ä¸€ã€å¦‚ä½•å®šåˆ¶å’Œä¿®æ”¹Servletå®¹å™¨çš„ç›¸å…³é…ç½®"><a href="#ä¸€ã€å¦‚ä½•å®šåˆ¶å’Œä¿®æ”¹Servletå®¹å™¨çš„ç›¸å…³é…ç½®" class="headerlink" title="ä¸€ã€å¦‚ä½•å®šåˆ¶å’Œä¿®æ”¹Servletå®¹å™¨çš„ç›¸å…³é…ç½®"></a>ä¸€ã€å¦‚ä½•å®šåˆ¶å’Œä¿®æ”¹Servletå®¹å™¨çš„ç›¸å…³é…ç½®</h3><p>1ã€ä¿®æ”¹å’Œserveræœ‰å…³çš„é…ç½®ï¼ˆServerPropertiesã€ä¹Ÿæ˜¯EmbeddedServletContainerCustomizerã€‘ï¼‰ï¼›</p><div class="hljs"><pre><code class="hljs properties"><span class="hljs-meta">server.port</span>=<span class="hljs-string">8081</span><span class="hljs-meta">server.context-path</span>=<span class="hljs-string">/crud</span><span class="hljs-meta">server.tomcat.uri-encoding</span>=<span class="hljs-string">UTF-8</span><span class="hljs-attr">//é€šç”¨çš„Servletå®¹å™¨è®¾ç½®</span><span class="hljs-attr">server.xxx</span><span class="hljs-attr">//Tomcatçš„è®¾ç½®</span><span class="hljs-attr">server.tomcat.xxx</span></code></pre></div><p>2ã€ç¼–å†™ä¸€ä¸ª<strong>EmbeddedServletContainerCustomizer</strong>ï¼šåµŒå…¥å¼çš„Servletå®¹å™¨çš„å®šåˆ¶å™¨ï¼›æ¥ä¿®æ”¹Servletå®¹å™¨çš„é…ç½®</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>  <span class="hljs-comment">//ä¸€å®šè¦å°†è¿™ä¸ªå®šåˆ¶å™¨åŠ å…¥åˆ°å®¹å™¨ä¸­</span><span class="hljs-function"><span class="hljs-keyword">public</span> EmbeddedServletContainerCustomizer <span class="hljs-title">embeddedServletContainerCustomizer</span><span class="hljs-params">()</span></span>&#123;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> EmbeddedServletContainerCustomizer() &#123;        <span class="hljs-comment">//å®šåˆ¶åµŒå…¥å¼çš„Servletå®¹å™¨ç›¸å…³çš„è§„åˆ™</span>        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">customize</span><span class="hljs-params">(ConfigurableEmbeddedServletContainer container)</span> </span>&#123;            container.setPort(<span class="hljs-number">8083</span>);        &#125;    &#125;;&#125;</code></pre></div><h3 id="äºŒã€æ³¨å†ŒServletä¸‰å¤§ç»„ä»¶ã€Servletã€Filterã€Listenerã€‘"><a href="#äºŒã€æ³¨å†ŒServletä¸‰å¤§ç»„ä»¶ã€Servletã€Filterã€Listenerã€‘" class="headerlink" title="äºŒã€æ³¨å†ŒServletä¸‰å¤§ç»„ä»¶ã€Servletã€Filterã€Listenerã€‘"></a>äºŒã€æ³¨å†ŒServletä¸‰å¤§ç»„ä»¶ã€Servletã€Filterã€Listenerã€‘</h3><p>ç”±äºSpringBooté»˜è®¤æ˜¯ä»¥jaråŒ…çš„æ–¹å¼å¯åŠ¨åµŒå…¥å¼çš„Servletå®¹å™¨æ¥å¯åŠ¨SpringBootçš„webåº”ç”¨ï¼Œæ²¡æœ‰web.xmlæ–‡ä»¶ã€‚</p><p>æ³¨å†Œä¸‰å¤§ç»„ä»¶ç”¨ä»¥ä¸‹æ–¹å¼</p><p>ServletRegistrationBean</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ³¨å†Œä¸‰å¤§ç»„ä»¶</span><span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">myServlet</span><span class="hljs-params">()</span></span>&#123;    ServletRegistrationBean registrationBean = <span class="hljs-keyword">new</span> ServletRegistrationBean(<span class="hljs-keyword">new</span> MyServlet(),<span class="hljs-string">"/myServlet"</span>);    <span class="hljs-keyword">return</span> registrationBean;&#125;</code></pre></div><p>FilterRegistrationBean</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> FilterRegistrationBean <span class="hljs-title">myFilter</span><span class="hljs-params">()</span></span>&#123;    FilterRegistrationBean registrationBean = <span class="hljs-keyword">new</span> FilterRegistrationBean();    registrationBean.setFilter(<span class="hljs-keyword">new</span> MyFilter());    registrationBean.setUrlPatterns(Arrays.asList(<span class="hljs-string">"/hello"</span>,<span class="hljs-string">"/myServlet"</span>));    <span class="hljs-keyword">return</span> registrationBean;&#125;</code></pre></div><p>ServletListenerRegistrationBean</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> ServletListenerRegistrationBean <span class="hljs-title">myListener</span><span class="hljs-params">()</span></span>&#123;    ServletListenerRegistrationBean&lt;MyListener&gt; registrationBean = <span class="hljs-keyword">new</span> ServletListenerRegistrationBean&lt;&gt;(<span class="hljs-keyword">new</span> MyListener());    <span class="hljs-keyword">return</span> registrationBean;&#125;</code></pre></div><p>SpringBootå¸®æˆ‘ä»¬è‡ªåŠ¨SpringMVCçš„æ—¶å€™ï¼Œè‡ªåŠ¨çš„æ³¨å†ŒSpringMVCçš„å‰ç«¯æ§åˆ¶å™¨ï¼›DIspatcherServletï¼›</p><p>DispatcherServletAutoConfigurationä¸­ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span>(name = DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME)<span class="hljs-meta">@ConditionalOnBean</span>(value = DispatcherServlet<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">name</span> </span>= DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)<span class="hljs-function"><span class="hljs-keyword">public</span> ServletRegistrationBean <span class="hljs-title">dispatcherServletRegistration</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">      DispatcherServlet dispatcherServlet)</span> </span>&#123;   ServletRegistrationBean registration = <span class="hljs-keyword">new</span> ServletRegistrationBean(         dispatcherServlet, <span class="hljs-keyword">this</span>.serverProperties.getServletMapping());    <span class="hljs-comment">//é»˜è®¤æ‹¦æˆªï¼š /  æ‰€æœ‰è¯·æ±‚ï¼›åŒ…é™æ€èµ„æºï¼Œä½†æ˜¯ä¸æ‹¦æˆªjspè¯·æ±‚ï¼›   /*ä¼šæ‹¦æˆªjsp</span>    <span class="hljs-comment">//å¯ä»¥é€šè¿‡server.servletPathæ¥ä¿®æ”¹SpringMVCå‰ç«¯æ§åˆ¶å™¨é»˜è®¤æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„</span>       registration.setName(DEFAULT_DISPATCHER_SERVLET_BEAN_NAME);   registration.setLoadOnStartup(         <span class="hljs-keyword">this</span>.webMvcProperties.getServlet().getLoadOnStartup());   <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.multipartConfig != <span class="hljs-keyword">null</span>) &#123;      registration.setMultipartConfig(<span class="hljs-keyword">this</span>.multipartConfig);   &#125;   <span class="hljs-keyword">return</span> registration;&#125;</code></pre></div><p>2ï¼‰ã€SpringBootèƒ½ä¸èƒ½æ”¯æŒå…¶ä»–çš„Servletå®¹å™¨ï¼›</p><h3 id="ä¸‰ã€æ›¿æ¢ä¸ºå…¶ä»–åµŒå…¥å¼Servletå®¹å™¨"><a href="#ä¸‰ã€æ›¿æ¢ä¸ºå…¶ä»–åµŒå…¥å¼Servletå®¹å™¨" class="headerlink" title="ä¸‰ã€æ›¿æ¢ä¸ºå…¶ä»–åµŒå…¥å¼Servletå®¹å™¨"></a>ä¸‰ã€æ›¿æ¢ä¸ºå…¶ä»–åµŒå…¥å¼Servletå®¹å™¨</h3><p><img src="/2020/08/03/SpringBoot%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302114401.png" srcset="/img/loading.gif" alt></p><p>é»˜è®¤æ”¯æŒï¼š</p><p>Tomcatï¼ˆé»˜è®¤ä½¿ç”¨ï¼‰</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>   å¼•å…¥webæ¨¡å—é»˜è®¤å°±æ˜¯ä½¿ç”¨åµŒå…¥å¼çš„Tomcatä½œä¸ºServletå®¹å™¨ï¼›<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>Jetty</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- å¼•å…¥webæ¨¡å— --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>         <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>         <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!--å¼•å…¥å…¶ä»–çš„Servletå®¹å™¨--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>Undertow</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- å¼•å…¥webæ¨¡å— --&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>         <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>         <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>      <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>   <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-comment">&lt;!--å¼•å…¥å…¶ä»–çš„Servletå®¹å™¨--&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>   <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><h3 id="å››ã€åµŒå…¥å¼Servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†ï¼›"><a href="#å››ã€åµŒå…¥å¼Servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†ï¼›" class="headerlink" title="å››ã€åµŒå…¥å¼Servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†ï¼›"></a>å››ã€åµŒå…¥å¼Servletå®¹å™¨è‡ªåŠ¨é…ç½®åŸç†ï¼›</h3><p>EmbeddedServletContainerAutoConfigurationï¼šåµŒå…¥å¼çš„Servletå®¹å™¨è‡ªåŠ¨é…ç½®ï¼Ÿ</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@AutoConfigureOrder</span>(Ordered.HIGHEST_PRECEDENCE)<span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnWebApplication</span><span class="hljs-meta">@Import</span>(BeanPostProcessorsRegistrar<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class">//å¯¼å…¥<span class="hljs-title">BeanPostProcessorsRegistrar</span>ï¼š<span class="hljs-title">Spring</span>æ³¨è§£ç‰ˆï¼›ç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€äº›ç»„ä»¶</span><span class="hljs-class">//å¯¼å…¥äº†<span class="hljs-title">EmbeddedServletContainerCustomizerBeanPostProcessor</span>ï¼š</span><span class="hljs-class">//åç½®å¤„ç†å™¨ï¼š<span class="hljs-title">bean</span>åˆå§‹åŒ–å‰åï¼ˆåˆ›å»ºå®Œå¯¹è±¡ï¼Œè¿˜æ²¡èµ‹å€¼èµ‹å€¼ï¼‰æ‰§è¡Œåˆå§‹åŒ–å·¥ä½œ</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">EmbeddedServletContainerAutoConfiguration</span> </span>&#123;        <span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnClass</span>(&#123; Servlet<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">Tomcat</span>.<span class="hljs-title">class</span> &#125;)//åˆ¤æ–­å½“å‰æ˜¯å¦å¼•å…¥äº†<span class="hljs-title">Tomcat</span>ä¾èµ–ï¼›</span><span class="hljs-class">@<span class="hljs-title">ConditionalOnMissingBean</span>(<span class="hljs-title">value</span> </span>= EmbeddedServletContainerFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">search</span> </span>= SearchStrategy.CURRENT)<span class="hljs-comment">//åˆ¤æ–­å½“å‰å®¹å™¨æ²¡æœ‰ç”¨æˆ·è‡ªå·±å®šä¹‰EmbeddedServletContainerFactoryï¼šåµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼›ä½œç”¨ï¼šåˆ›å»ºåµŒå…¥å¼çš„Servletå®¹å™¨</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmbeddedTomcat</span> </span>&#123;<span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> TomcatEmbeddedServletContainerFactory <span class="hljs-title">tomcatEmbeddedServletContainerFactory</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> TomcatEmbeddedServletContainerFactory();&#125;&#125;        <span class="hljs-comment">/**</span><span class="hljs-comment"> * Nested configuration if Jetty is being used.</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnClass</span>(&#123; Servlet<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">Server</span>.<span class="hljs-title">class</span>, <span class="hljs-title">Loader</span>.<span class="hljs-title">class</span>,</span><span class="hljs-class"><span class="hljs-title">WebAppContext</span>.<span class="hljs-title">class</span> &#125;)</span><span class="hljs-class">@<span class="hljs-title">ConditionalOnMissingBean</span>(<span class="hljs-title">value</span> </span>= EmbeddedServletContainerFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">search</span> </span>= SearchStrategy.CURRENT)<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmbeddedJetty</span> </span>&#123;<span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> JettyEmbeddedServletContainerFactory <span class="hljs-title">jettyEmbeddedServletContainerFactory</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JettyEmbeddedServletContainerFactory();&#125;&#125;<span class="hljs-comment">/**</span><span class="hljs-comment"> * Nested configuration if Undertow is being used.</span><span class="hljs-comment"> */</span><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnClass</span>(&#123; Servlet<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">Undertow</span>.<span class="hljs-title">class</span>, <span class="hljs-title">SslClientAuthMode</span>.<span class="hljs-title">class</span> &#125;)</span><span class="hljs-class">@<span class="hljs-title">ConditionalOnMissingBean</span>(<span class="hljs-title">value</span> </span>= EmbeddedServletContainerFactory<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">search</span> </span>= SearchStrategy.CURRENT)<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmbeddedUndertow</span> </span>&#123;<span class="hljs-meta">@Bean</span><span class="hljs-function"><span class="hljs-keyword">public</span> UndertowEmbeddedServletContainerFactory <span class="hljs-title">undertowEmbeddedServletContainerFactory</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> UndertowEmbeddedServletContainerFactory();&#125;&#125;</code></pre></div><p>1ï¼‰ã€EmbeddedServletContainerFactoryï¼ˆåµŒå…¥å¼Servletå®¹å™¨å·¥å‚ï¼‰</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EmbeddedServletContainerFactory</span> </span>&#123;   <span class="hljs-comment">//è·å–åµŒå…¥å¼çš„Servletå®¹å™¨</span>   <span class="hljs-function">EmbeddedServletContainer <span class="hljs-title">getEmbeddedServletContainer</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">         ServletContextInitializer... initializers)</span></span>;&#125;</code></pre></div><p><img src="/2020/08/03/SpringBoot%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302144910.png" srcset="/img/loading.gif" alt></p><p><img src="/2020/08/03/SpringBoot%E9%85%8D%E7%BD%AE%E5%B5%8C%E5%85%A5%E5%BC%8FServlet%E5%AE%B9%E5%99%A8/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180302221835.png" srcset="/img/loading.gif" alt></p><p>3ï¼‰ã€ä»¥<strong>TomcatEmbeddedServletContainerFactory</strong>ä¸ºä¾‹</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> EmbeddedServletContainer <span class="hljs-title">getEmbeddedServletContainer</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">      ServletContextInitializer... initializers)</span> </span>&#123;    <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªTomcat</span>   Tomcat tomcat = <span class="hljs-keyword">new</span> Tomcat();        <span class="hljs-comment">//é…ç½®Tomcatçš„åŸºæœ¬ç¯èŠ‚</span>   File baseDir = (<span class="hljs-keyword">this</span>.baseDirectory != <span class="hljs-keyword">null</span> ? <span class="hljs-keyword">this</span>.baseDirectory         : createTempDir(<span class="hljs-string">"tomcat"</span>));   tomcat.setBaseDir(baseDir.getAbsolutePath());   Connector connector = <span class="hljs-keyword">new</span> Connector(<span class="hljs-keyword">this</span>.protocol);   tomcat.getService().addConnector(connector);   customizeConnector(connector);   tomcat.setConnector(connector);   tomcat.getHost().setAutoDeploy(<span class="hljs-keyword">false</span>);   configureEngine(tomcat.getEngine());   <span class="hljs-keyword">for</span> (Connector additionalConnector : <span class="hljs-keyword">this</span>.additionalTomcatConnectors) &#123;      tomcat.getService().addConnector(additionalConnector);   &#125;   prepareContext(tomcat.getHost(), initializers);        <span class="hljs-comment">//å°†é…ç½®å¥½çš„Tomcatä¼ å…¥è¿›å»ï¼Œè¿”å›ä¸€ä¸ªEmbeddedServletContainerï¼›å¹¶ä¸”å¯åŠ¨TomcatæœåŠ¡å™¨</span>   <span class="hljs-keyword">return</span> getTomcatEmbeddedServletContainer(tomcat);&#125;</code></pre></div><p>4ï¼‰ã€æˆ‘ä»¬å¯¹åµŒå…¥å¼å®¹å™¨çš„é…ç½®ä¿®æ”¹æ˜¯æ€ä¹ˆç”Ÿæ•ˆï¼Ÿ</p><div class="hljs"><pre><code class="hljs plain">ServerPropertiesã€EmbeddedServletContainerCustomizer</code></pre></div><p><strong>EmbeddedServletContainerCustomizer</strong>ï¼šå®šåˆ¶å™¨å¸®æˆ‘ä»¬ä¿®æ”¹äº†Servletå®¹å™¨çš„é…ç½®ï¼Ÿ</p><p>æ€ä¹ˆä¿®æ”¹çš„åŸç†ï¼Ÿ</p><p>5ï¼‰ã€å®¹å™¨ä¸­å¯¼å…¥äº†<strong>EmbeddedServletContainerCustomizerBeanPostProcessor</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åˆå§‹åŒ–ä¹‹å‰</span><span class="hljs-meta">@Override</span><span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span></span><span class="hljs-function">      <span class="hljs-keyword">throws</span> BeansException </span>&#123;    <span class="hljs-comment">//å¦‚æœå½“å‰åˆå§‹åŒ–çš„æ˜¯ä¸€ä¸ªConfigurableEmbeddedServletContainerç±»å‹çš„ç»„ä»¶</span>   <span class="hljs-keyword">if</span> (bean <span class="hljs-keyword">instanceof</span> ConfigurableEmbeddedServletContainer) &#123;       <span class="hljs-comment">//</span>      postProcessBeforeInitialization((ConfigurableEmbeddedServletContainer) bean);   &#125;   <span class="hljs-keyword">return</span> bean;&#125;<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postProcessBeforeInitialization</span><span class="hljs-params">(</span></span><span class="hljs-function"><span class="hljs-params">ConfigurableEmbeddedServletContainer bean)</span> </span>&#123;    <span class="hljs-comment">//è·å–æ‰€æœ‰çš„å®šåˆ¶å™¨ï¼Œè°ƒç”¨æ¯ä¸€ä¸ªå®šåˆ¶å™¨çš„customizeæ–¹æ³•æ¥ç»™Servletå®¹å™¨è¿›è¡Œå±æ€§èµ‹å€¼ï¼›</span>    <span class="hljs-keyword">for</span> (EmbeddedServletContainerCustomizer customizer : getCustomizers()) &#123;        customizer.customize(bean);    &#125;&#125;<span class="hljs-function"><span class="hljs-keyword">private</span> Collection&lt;EmbeddedServletContainerCustomizer&gt; <span class="hljs-title">getCustomizers</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.customizers == <span class="hljs-keyword">null</span>) &#123;        <span class="hljs-comment">// Look up does not include the parent context</span>        <span class="hljs-keyword">this</span>.customizers = <span class="hljs-keyword">new</span> ArrayList&lt;EmbeddedServletContainerCustomizer&gt;(            <span class="hljs-keyword">this</span>.beanFactory            <span class="hljs-comment">//ä»å®¹å™¨ä¸­è·å–æ‰€æœ‰è¿™è‘›ç±»å‹çš„ç»„ä»¶ï¼šEmbeddedServletContainerCustomizer</span>            <span class="hljs-comment">//å®šåˆ¶Servletå®¹å™¨ï¼Œç»™å®¹å™¨ä¸­å¯ä»¥æ·»åŠ ä¸€ä¸ªEmbeddedServletContainerCustomizerç±»å‹çš„ç»„ä»¶</span>            .getBeansOfType(EmbeddedServletContainerCustomizer<span class="hljs-class">.<span class="hljs-keyword">class</span>,</span><span class="hljs-class">                            <span class="hljs-title">false</span>, <span class="hljs-title">false</span>)</span><span class="hljs-class">            .<span class="hljs-title">values</span>())</span>;        Collections.sort(<span class="hljs-keyword">this</span>.customizers, AnnotationAwareOrderComparator.INSTANCE);        <span class="hljs-keyword">this</span>.customizers = Collections.unmodifiableList(<span class="hljs-keyword">this</span>.customizers);    &#125;    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.customizers;&#125;ServerPropertiesä¹Ÿæ˜¯å®šåˆ¶å™¨</code></pre></div><p>æ­¥éª¤ï¼š</p><p>1ï¼‰ã€SpringBootæ ¹æ®å¯¼å…¥çš„ä¾èµ–æƒ…å†µï¼Œç»™å®¹å™¨ä¸­æ·»åŠ ç›¸åº”çš„EmbeddedServletContainerFactoryã€TomcatEmbeddedServletContainerFactoryã€‘</p><p>2ï¼‰ã€å®¹å™¨ä¸­æŸä¸ªç»„ä»¶è¦åˆ›å»ºå¯¹è±¡å°±ä¼šæƒŠåŠ¨åç½®å¤„ç†å™¨ï¼›EmbeddedServletContainerCustomizerBeanPostProcessorï¼›</p><p>åªè¦æ˜¯åµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼Œåç½®å¤„ç†å™¨å°±å·¥ä½œï¼›</p><p>3ï¼‰ã€åç½®å¤„ç†å™¨ï¼Œä»å®¹å™¨ä¸­è·å–æ‰€æœ‰çš„<strong>EmbeddedServletContainerCustomizer</strong>ï¼Œè°ƒç”¨å®šåˆ¶å™¨çš„å®šåˆ¶æ–¹æ³•</p><h3 id="äº”ã€åµŒå…¥å¼Servletå®¹å™¨å¯åŠ¨åŸç†ï¼›"><a href="#äº”ã€åµŒå…¥å¼Servletå®¹å™¨å¯åŠ¨åŸç†ï¼›" class="headerlink" title="äº”ã€åµŒå…¥å¼Servletå®¹å™¨å¯åŠ¨åŸç†ï¼›"></a>äº”ã€åµŒå…¥å¼Servletå®¹å™¨å¯åŠ¨åŸç†ï¼›</h3><p>ä»€ä¹ˆæ—¶å€™åˆ›å»ºåµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼Ÿä»€ä¹ˆæ—¶å€™è·å–åµŒå…¥å¼çš„Servletå®¹å™¨å¹¶å¯åŠ¨Tomcatï¼›</p><p>è·å–åµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼š</p><p>1ï¼‰ã€SpringBootåº”ç”¨å¯åŠ¨è¿è¡Œrunæ–¹æ³•</p><p>2ï¼‰ã€refreshContext(context);SpringBootåˆ·æ–°IOCå®¹å™¨ã€åˆ›å»ºIOCå®¹å™¨å¯¹è±¡ï¼Œå¹¶åˆå§‹åŒ–å®¹å™¨ï¼Œåˆ›å»ºå®¹å™¨ä¸­çš„æ¯ä¸€ä¸ªç»„ä»¶ã€‘ï¼›å¦‚æœæ˜¯webåº”ç”¨åˆ›å»º<strong>AnnotationConfigEmbeddedWebApplicationContext</strong>ï¼Œå¦åˆ™ï¼š<strong>AnnotationConfigApplicationContext</strong></p><p>3ï¼‰ã€refresh(context);<strong>åˆ·æ–°åˆšæ‰åˆ›å»ºå¥½çš„iocå®¹å™¨ï¼›</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">refresh</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> BeansException, IllegalStateException </span>&#123;   <span class="hljs-keyword">synchronized</span> (<span class="hljs-keyword">this</span>.startupShutdownMonitor) &#123;      <span class="hljs-comment">// Prepare this context for refreshing.</span>      prepareRefresh();      <span class="hljs-comment">// Tell the subclass to refresh the internal bean factory.</span>      ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();      <span class="hljs-comment">// Prepare the bean factory for use in this context.</span>      prepareBeanFactory(beanFactory);      <span class="hljs-keyword">try</span> &#123;         <span class="hljs-comment">// Allows post-processing of the bean factory in context subclasses.</span>         postProcessBeanFactory(beanFactory);         <span class="hljs-comment">// Invoke factory processors registered as beans in the context.</span>         invokeBeanFactoryPostProcessors(beanFactory);         <span class="hljs-comment">// Register bean processors that intercept bean creation.</span>         registerBeanPostProcessors(beanFactory);         <span class="hljs-comment">// Initialize message source for this context.</span>         initMessageSource();         <span class="hljs-comment">// Initialize event multicaster for this context.</span>         initApplicationEventMulticaster();         <span class="hljs-comment">// Initialize other special beans in specific context subclasses.</span>         onRefresh();         <span class="hljs-comment">// Check for listener beans and register them.</span>         registerListeners();         <span class="hljs-comment">// Instantiate all remaining (non-lazy-init) singletons.</span>         finishBeanFactoryInitialization(beanFactory);         <span class="hljs-comment">// Last step: publish corresponding event.</span>         finishRefresh();      &#125;      <span class="hljs-keyword">catch</span> (BeansException ex) &#123;         <span class="hljs-keyword">if</span> (logger.isWarnEnabled()) &#123;            logger.warn(<span class="hljs-string">"Exception encountered during context initialization - "</span> +                  <span class="hljs-string">"cancelling refresh attempt: "</span> + ex);         &#125;         <span class="hljs-comment">// Destroy already created singletons to avoid dangling resources.</span>         destroyBeans();         <span class="hljs-comment">// Reset 'active' flag.</span>         cancelRefresh(ex);         <span class="hljs-comment">// Propagate exception to caller.</span>         <span class="hljs-keyword">throw</span> ex;      &#125;      <span class="hljs-keyword">finally</span> &#123;         <span class="hljs-comment">// Reset common introspection caches in Spring's core, since we</span>         <span class="hljs-comment">// might not ever need metadata for singleton beans anymore...</span>         resetCommonCaches();      &#125;   &#125;&#125;</code></pre></div><p>4ï¼‰ã€  onRefresh(); webçš„iocå®¹å™¨é‡å†™äº†onRefreshæ–¹æ³•</p><p>5ï¼‰ã€webiocå®¹å™¨ä¼šåˆ›å»ºåµŒå…¥å¼çš„Servletå®¹å™¨ï¼›<strong>createEmbeddedServletContainer</strong>();</p><p><strong>6ï¼‰ã€è·å–åµŒå…¥å¼çš„Servletå®¹å™¨å·¥å‚ï¼š</strong></p><p>EmbeddedServletContainerFactory containerFactory = getEmbeddedServletContainerFactory();</p><p>â€‹    ä»iocå®¹å™¨ä¸­è·å–EmbeddedServletContainerFactory ç»„ä»¶ï¼›<strong>TomcatEmbeddedServletContainerFactory</strong>åˆ›å»ºå¯¹è±¡ï¼Œåç½®å¤„ç†å™¨ä¸€çœ‹æ˜¯è¿™ä¸ªå¯¹è±¡ï¼Œå°±è·å–æ‰€æœ‰çš„å®šåˆ¶å™¨æ¥å…ˆå®šåˆ¶Servletå®¹å™¨çš„ç›¸å…³é…ç½®ï¼›</p><p>7ï¼‰ã€<strong>ä½¿ç”¨å®¹å™¨å·¥å‚è·å–åµŒå…¥å¼çš„Servletå®¹å™¨</strong>ï¼šthis.embeddedServletContainer = containerFactory      .getEmbeddedServletContainer(getSelfInitializer());</p><p>8ï¼‰ã€åµŒå…¥å¼çš„Servletå®¹å™¨åˆ›å»ºå¯¹è±¡å¹¶å¯åŠ¨Servletå®¹å™¨ï¼›</p><p><strong>å…ˆå¯åŠ¨åµŒå…¥å¼çš„Servletå®¹å™¨ï¼Œå†å°†iocå®¹å™¨ä¸­å‰©ä¸‹æ²¡æœ‰åˆ›å»ºå‡ºçš„å¯¹è±¡è·å–å‡ºæ¥ï¼›</strong></p><p><strong>==IOCå®¹å™¨å¯åŠ¨åˆ›å»ºåµŒå…¥å¼çš„Servletå®¹å™¨==</strong></p>]]></content>
    
    
    <categories>
      
      <category>æºç åˆ†æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>Servlet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Setæ¥å£åº•å±‚å®ç°ç±»</title>
    <link href="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/"/>
    <url>/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<h1 id="Setæ¥å£åº•å±‚å®ç°ç±»"><a href="#Setæ¥å£åº•å±‚å®ç°ç±»" class="headerlink" title="Setæ¥å£åº•å±‚å®ç°ç±»"></a>Setæ¥å£åº•å±‚å®ç°ç±»</h1><h1 id="ä¸€ã€Setæ¥å£ç»§æ‰¿å…³ç³»"><a href="#ä¸€ã€Setæ¥å£ç»§æ‰¿å…³ç³»" class="headerlink" title="ä¸€ã€Setæ¥å£ç»§æ‰¿å…³ç³»"></a>ä¸€ã€Setæ¥å£ç»§æ‰¿å…³ç³»</h1><p>å­˜å‚¨çš„æ•°æ®ç‰¹ç‚¹ï¼šæ— åºçš„ã€ä¸å¯é‡å¤çš„å…ƒç´ </p><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1595656190066.png" srcset="/img/loading.gif" alt></p><p>|â€”-Setæ¥å£ï¼šå­˜å‚¨æ— åºçš„ã€ä¸å¯é‡å¤çš„æ•°æ®   â€“&gt;é«˜ä¸­è®²çš„â€œé›†åˆâ€</p><ul><li>|â€”-HashSetï¼šä½œä¸ºSetæ¥å£çš„ä¸»è¦å®ç°ç±»ï¼›çº¿ç¨‹ä¸å®‰å…¨çš„ï¼›å¯ä»¥å­˜å‚¨nullå€¼</li><li>|â€”-LinkedHashSetï¼šä½œä¸ºHashSetçš„å­ç±»ï¼›éå†å…¶å†…éƒ¨æ•°æ®æ—¶ï¼Œå¯ä»¥æŒ‰ç…§æ·»åŠ çš„é¡ºåºéå†åœ¨æ·»åŠ æ•°æ®çš„åŒæ—¶ï¼Œæ¯ä¸ªæ•°æ®è¿˜ç»´æŠ¤äº†ä¸¤ä¸ªå¼•ç”¨ï¼Œè®°å½•æ­¤æ•°æ®å‰ä¸€ä¸ªæ•°æ®å’Œåä¸€ä¸ªæ•°æ®ã€‚                   å¯¹äºé¢‘ç¹çš„éå†æ“ä½œï¼ŒLinkedHashSetæ•ˆç‡é«˜äºHashSet.</li><li>|â€”-TreeSetï¼šå¯ä»¥ç…§æ·»åŠ å¯¹è±¡çš„æŒ‡å®šå±æ€§ï¼Œè¿›è¡Œæ’åºã€‚</li></ul><h1 id="äºŒã€HashSet"><a href="#äºŒã€HashSet" class="headerlink" title="äºŒã€HashSet"></a>äºŒã€HashSet</h1><h2 id="1-ç»§æ‰¿æƒ…å†µ"><a href="#1-ç»§æ‰¿æƒ…å†µ" class="headerlink" title="1.ç»§æ‰¿æƒ…å†µ"></a>1.ç»§æ‰¿æƒ…å†µ</h2><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1595656458260.png" srcset="/img/loading.gif" alt></p><p>å¯ä»¥çœ‹åˆ°æ˜¯ç›´æ¥å®ç°äº†Setæ¥å£ï¼Œå’Œé—´æ¥ç»§æ‰¿äº†Collectionæ¥å£</p><h2 id="2-åˆ›å»ºHashSet"><a href="#2-åˆ›å»ºHashSet" class="headerlink" title="2.åˆ›å»ºHashSet"></a>2.åˆ›å»ºHashSet</h2><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/abcsd.png" srcset="/img/loading.gif" alt></p><p>debugè·Ÿè¿›æºä»£ç </p><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1.png" srcset="/img/loading.gif" alt></p><p>å¯ä»¥çœ‹åˆ°ç©ºå‚æ„é€ å™¨é‡Œnewäº†ä¸€ä¸ªHashMapå‡ºæ¥</p><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/2.png" srcset="/img/loading.gif" alt="59565709297"></p><p>è€ŒHashMapåˆå§‹åŒ–äº†ä¸€ä¸ªåŠ è½½å› å­çš„å¸¸é‡ï¼Œè¿™é‡Œç”±äºæ˜¯mapå†…å®¹ä¸å¤šåšç»†è®²</p><p> å®é™…ä¸ŠHashSetå®ç°Setæ¥å£ï¼Œç”±å“ˆå¸Œè¡¨ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ªHashMapå®ä¾‹ï¼‰æ”¯æŒã€‚å®ƒä¸ä¿è¯set çš„è¿­ä»£é¡ºåºï¼›ç‰¹åˆ«æ˜¯å®ƒä¸ä¿è¯è¯¥é¡ºåºæ’ä¹…ä¸å˜ï¼Œæ­¤ç±»å…è®¸ä½¿ç”¨nullå…ƒç´ ã€‚ </p><p>åœ¨HashSetä¸­ï¼Œå…ƒç´ éƒ½å­˜åˆ°HashMapé”®å€¼å¯¹çš„Keyä¸Šé¢ï¼Œè€ŒValueæ—¶æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å€¼<code>private static final Object PRESENT = new Object();</code>ï¼Œ(å®šä¹‰ä¸€ä¸ªè™šæ‹Ÿçš„Objectå¯¹è±¡ä½œä¸ºHashMapçš„valueï¼Œå°†æ­¤å¯¹è±¡å®šä¹‰ä¸ºstatic finalã€‚) åœ¨æ·»åŠ æ•°æ®æ—¶å°±èƒ½è§‚å¯Ÿåˆ°ã€‚</p><h2 id="3-æ·»åŠ æ•°æ®"><a href="#3-æ·»åŠ æ•°æ®" class="headerlink" title="3.æ·»åŠ æ•°æ®"></a>3.æ·»åŠ æ•°æ®</h2><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/3.png" srcset="/img/loading.gif" alt></p><p>è·Ÿè¿› é¦–å…ˆæ˜¯ä¸€ä¸ªè‡ªåŠ¨è£…ç®±</p><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/4.png" srcset="/img/loading.gif" alt></p><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/5.png" srcset="/img/loading.gif" alt></p><div class="hljs"><pre><code class="hljs java">è€ŒPRESENTå°±æ˜¯åˆšæ‰æåŠåˆ°çš„å›ºå®šçš„valueå€¼ å®ç°äº†åŒåˆ—å˜å•åˆ—<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object PRESENT = <span class="hljs-keyword">new</span> Object();</code></pre></div><p>æ¥ä¸‹æ¥çš„putå°±æ˜¯mapçš„æ“ä½œäº†</p><h2 id="4-ä¸å¯é‡å¤æ€§å’Œæ— åºæ€§"><a href="#4-ä¸å¯é‡å¤æ€§å’Œæ— åºæ€§" class="headerlink" title="4.ä¸å¯é‡å¤æ€§å’Œæ— åºæ€§"></a>4.ä¸å¯é‡å¤æ€§å’Œæ— åºæ€§</h2><p>HashSetçš„ä¿©å¤§ç‰¹ç‚¹</p><div class="hljs"><pre><code>1. æ— åºæ€§ï¼šä¸ç­‰äºéšæœºæ€§ã€‚å­˜å‚¨çš„æ•°æ®åœ¨åº•å±‚æ•°ç»„ä¸­å¹¶éç…§æ•°ç»„ç´¢å¼•çš„é¡ºåºæ·»åŠ ï¼Œè€Œæ˜¯æ ¹æ®æ•°æ®çš„å“ˆå¸Œå€¼å†³å®šçš„ã€‚    2. ä¸å¯é‡å¤æ€§ï¼šä¿è¯æ·»åŠ çš„å…ƒç´ ç…§equals()åˆ¤æ–­æ—¶ï¼Œä¸èƒ½è¿”å›true.å³ï¼šç›¸åŒçš„å…ƒç´ åªèƒ½æ·»åŠ ä¸€ä¸ªã€‚</code></pre></div><p>åœ¨è¿›è¡Œæµ‹è¯•è¿‡ç¨‹ä¸­ æˆ‘å‘ç°é¿å…ä¸äº†å»åˆ°mapçš„æºç ï¼Œç”±äºå¤ªè¿‡å¤æ‚ å°½é‡ç”¨å¤§ç™½è¯è¯´æ˜ç™½ï¼Œmapä¼šå•ç‹¬å‡ºä¸€ç¯‡</p><p>åœ¨jdk7å’Œä¹‹å‰ åº•å±‚ä½¿ç”¨çš„æ˜¯æ•°ç»„åŠ é“¾è¡¨ï¼Œåœ¨jdk8åä½¿ç”¨çš„æ˜¯æ•°ç»„åŠ é“¾è¡¨åŠ çº¢é»‘æ ‘ã€‚</p><p>å› ä¸ºæˆ‘ä»¬çŸ¥é“mapçš„keyæ˜¯ä¸å…è®¸çš„é‡å¤çš„ï¼Œå¦‚æœæœ‰é‡å¤çš„keyå€¼å°±ä¼šæŠŠmapçš„keyå’Œvalueè¿›è¡Œæ›´æ–°æ“ä½œï¼Œè¿™ä¸€æ¥å°±è¯´çš„é€šäº†ï¼ŒHashSetå°±æ˜¯é™åˆ¶äº†mapçš„åŠŸèƒ½ï¼Œè®©mapçš„valueå€¼å›ºå®šä¸ºå¸¸é‡ï¼Œåªä½¿ç”¨keyå»æ“ä½œï¼Œæ‰€ä»¥è¯´HashSetä¸å…è®¸æœ‰é‡å¤çš„å€¼ï¼Œå…¶å®ä¹Ÿæ˜¯è¿™ä¸ªæ–°çš„å€¼æŠŠåŸæ¥çš„å€¼ç»™æ›¿æ¢æ‰äº†</p><p><strong>è€Œæ— åºæ€§ï¼Œè¦é‡å­˜æ”¾çš„æ–¹å¼è¯´èµ·ã€‚ï¼ˆæ³¨æ„ï¼Œå­˜è¿›HashSetçš„å¯¹è±¡ä¸€å®šè¦é‡å†™HashCodeå’Œequalsæ–¹æ³•ï¼‰</strong></p><p>æˆ‘ä»¬å‘HashSetä¸­æ·»åŠ å…ƒç´ a,é¦–å…ˆè°ƒç”¨å…ƒç´ aæ‰€åœ¨ç±»çš„hashCode()æ–¹æ³•ï¼Œè®¡ç®—å…ƒç´ açš„å“ˆå¸Œå€¼ï¼Œ<br>        æ­¤å“ˆå¸Œå€¼æ¥ç€é€šè¿‡æŸç§ç®—æ³•è®¡ç®—å‡ºåœ¨HashSetåº•å±‚æ•°ç»„ä¸­çš„å­˜æ”¾ä½ç½®ï¼ˆå³ä¸ºï¼šç´¢å¼•ä½ç½®ï¼Œåˆ¤æ–­<br>        æ•°ç»„æ­¤ä½ç½®ä¸Šæ˜¯å¦å·²ç»å…ƒç´ ï¼‰ï¼š</p><p>  æ­¤æ—¶æœ‰ä¿©ç§æƒ…å†µï¼š  </p><p>â€‹        1.å¦‚æœæ­¤ä½ç½®ä¸Šæ²¡å…¶ä»–å…ƒç´ ï¼Œåˆ™å…ƒç´ aæ·»åŠ æˆåŠŸã€‚ â€”&gt;æ’å…¥æˆåŠŸæƒ…å†µ1<br>               2.å¦‚æœæ­¤ä½ç½®ä¸Šå…¶ä»–å…ƒç´ b(æˆ–ä»¥é“¾è¡¨å½¢å¼å­˜åœ¨çš„å¤šä¸ªå…ƒç´ ï¼Œåˆ™æ¯”è¾ƒå…ƒç´ aä¸å…ƒç´ bçš„hashå€¼ï¼š</p><p>æ­¤æ—¶åˆæœ‰ä¿©ç§æƒ…å†µï¼š</p><p>â€‹                1.å¦‚æœhashå€¼ä¸ç›¸åŒï¼Œåˆ™å…ƒç´ aæ·»åŠ æˆåŠŸã€‚â€”&gt;æˆåŠŸæƒ…å†µ2<br>                2.å¦‚æœhashå€¼ç›¸åŒï¼Œè¿›è€Œéœ€è¦è°ƒç”¨å…ƒç´ aæ‰€åœ¨ç±»çš„equals()æ–¹æ³•ï¼š</p><p>æ­¤æ—¶è¿˜æ˜¯æœ‰ä¿©ç§æƒ…å†µï¼š</p><p>â€‹               1.equals()è¿”å›true,å…ƒç´ aæ·»åŠ å¤±è´¥<br>               2.equals()è¿”å›false,åˆ™å…ƒç´ aæ·»åŠ æˆåŠŸã€‚â€”&gt;æˆåŠŸæƒ…å†µ3</p><p>â€‹    å¯¹äºæ·»åŠ æˆåŠŸçš„æƒ…å†µ2å’Œæƒ…å†µ3è€Œè¨€ï¼šå…ƒç´ a ä¸å·²ç»å­˜åœ¨æŒ‡å®šç´¢å¼•ä½ç½®ä¸Šæ•°æ®ä»¥é“¾è¡¨çš„æ–¹å¼å­˜å‚¨ã€‚</p><p>â€‹    </p><p>ï¼ˆé“¾è¡¨æŒ‡å‘åŒºåˆ«â†“ï¼‰</p><p>jdk 7 :å…ƒç´ aæ”¾åˆ°æ•°ç»„ä¸­ï¼ŒæŒ‡å‘åŸæ¥çš„å…ƒç´ ã€‚<br>jdk 8 :åŸæ¥çš„å…ƒç´ åœ¨æ•°ç»„ä¸­ï¼ŒæŒ‡å‘å…ƒç´ a</p><p>æ­¤æ—¶åŒå­¦ä»¬è‚¯å®šä¼šæœ‰ç–‘é—®ï¼Œå¦‚æœHashCodeç›¸åŒéš¾é“ä¼šå‡ºç°equalsä¸åŒçš„æƒ…å†µå˜›ï¼Ÿï¼ˆè¿˜çœŸä¼šå¾…ä¼šè´´å‡ºä¼˜ç§€ä»£ç ï¼‰</p><p>ç”±äºåœ¨æ•°ç»„ å’Œ é“¾è¡¨ å’Œ çº¢é»‘æ ‘ çš„æ•°æ®ç»“æ„æœ‰ç‚¹æŠ½è±¡ ä¸‹é¢å‡ å‰¯å›¾å¯ä»¥å½¢è±¡çœ‹åˆ°HashSetæ·»åŠ æ—¶å…¨è¿‡ç¨‹</p><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/6.png" srcset="/img/loading.gif" alt></p><p>æƒ…å†µ2ï¼š</p><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/7.png" srcset="/img/loading.gif" alt></p><p>æƒ…å†µ3ï¼š</p><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/8.png" srcset="/img/loading.gif" alt></p><p>è¿™é‡Œæ²¡æœ‰ç”¨åˆ°çº¢é»‘æ ‘ï¼Œæ˜¯å› ä¸ºåŠ å…¥çº¢é»‘æ ‘æ˜¯è®©éå†ç­‰æ“ä½œé€Ÿåº¦å˜å¿«ï¼Œå…·ä½“çš„æ–¹å¼ä¸ºï¼Œåœ¨æ•°ç»„æŸä¸€ä¸ªä½ç½®ä¸Šçš„é“¾è¡¨çš„å±‚æ•°åˆ°8å±‚æˆ–æ€»æ•°é‡å¤šäº64ä¸ªæ—¶ï¼Œé“¾è¡¨é‡æ–°æ‰“æ•£ï¼Œæ”¹ä¸ºä½¿ç”¨æ ‘ç»“æ„ï¼Œå½“ç„¶æ ‘ç»“æ„çš„å¤´è¿˜æ˜¯æ•°ç»„ï¼Œå˜æˆä¸€é¢—é¢—å€’ç€çš„æ ‘ã€‚</p><h2 id="5-æ·»åŠ ä»£ç "><a href="#5-æ·»åŠ ä»£ç " class="headerlink" title="5.æ·»åŠ ä»£ç "></a>5.æ·»åŠ ä»£ç </h2><div class="hljs"><pre><code class="hljs java"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>&#123;        Integer num;        String name;        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span><span class="hljs-params">(Integer num, String name)</span> </span>&#123;            <span class="hljs-keyword">this</span>.num = num;            <span class="hljs-keyword">this</span>.name = name;        &#125;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;            <span class="hljs-keyword">return</span> <span class="hljs-string">"Person&#123;"</span> +                    <span class="hljs-string">"num="</span> + num +                    <span class="hljs-string">", name='"</span> + name + <span class="hljs-string">'\''</span> +                    <span class="hljs-string">'&#125;'</span>;        &#125;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">equals</span><span class="hljs-params">(Object o)</span> </span>&#123;            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> == o) <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;            <span class="hljs-keyword">if</span> (!(o <span class="hljs-keyword">instanceof</span> Person)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;            Person person = (Person) o;            <span class="hljs-keyword">return</span> Objects.equals(num, person.num) &amp;&amp;                    Objects.equals(name, person.name);        &#125;        <span class="hljs-meta">@Override</span>        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">hashCode</span><span class="hljs-params">()</span> </span>&#123;            <span class="hljs-keyword">return</span> Objects.hash(num, name);        &#125;    &#125;    <span class="hljs-meta">@Test</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test1</span><span class="hljs-params">()</span></span>&#123;        HashSet set = <span class="hljs-keyword">new</span> HashSet();        Person p1 = <span class="hljs-keyword">new</span> Person(<span class="hljs-number">1002</span>,<span class="hljs-string">"AA"</span>);        Person p2 = <span class="hljs-keyword">new</span> Person(<span class="hljs-number">1002</span>,<span class="hljs-string">"BB"</span>);        set.add(p1);        set.add(p2);        System.out.println(set);        p1.name = <span class="hljs-string">"CC"</span>;        set.remove(p1);        System.out.println(set);        set.add(<span class="hljs-keyword">new</span> Person(<span class="hljs-number">1002</span>,<span class="hljs-string">"CC"</span>));        System.out.println(set);        set.add(<span class="hljs-keyword">new</span> Person(<span class="hljs-number">1002</span>,<span class="hljs-string">"AA"</span>));        System.out.println(set);    &#125;</code></pre></div><p>è¿è¡Œtest1ä¸­ä»£ç ç»“æœä¸ºï¼š</p><div class="hljs"><pre><code class="hljs java">[Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'AA'</span>&#125;, Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'BB'</span>&#125;][Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'CC'</span>&#125;, Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'BB'</span>&#125;][Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'CC'</span>&#125;, Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'BB'</span>&#125;, Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'CC'</span>&#125;][Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'CC'</span>&#125;, Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'BB'</span>&#125;, Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'CC'</span>&#125;, Person&#123;num=<span class="hljs-number">1002</span>, name=<span class="hljs-string">'AA'</span>&#125;]</code></pre></div><p>æ˜¯ä¸æ˜¯å¾ˆè¯¡å¼‚ï¼Ÿå…¶å®å½’æ ¹ç»“åº•è¿˜æ˜¯é‚£ä¸‰ç§æƒ…å†µ</p><h1 id="ä¸‰ã€LinkedHashSet"><a href="#ä¸‰ã€LinkedHashSet" class="headerlink" title="ä¸‰ã€LinkedHashSet"></a>ä¸‰ã€LinkedHashSet</h1><h2 id="1-ç»§æ‰¿æƒ…å†µ-1"><a href="#1-ç»§æ‰¿æƒ…å†µ-1" class="headerlink" title="1.ç»§æ‰¿æƒ…å†µ"></a>1.ç»§æ‰¿æƒ…å†µ</h2><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/9.png" srcset="/img/loading.gif" alt></p><h2 id="2-ä¼˜åŠ£"><a href="#2-ä¼˜åŠ£" class="headerlink" title="2.ä¼˜åŠ£"></a>2.ä¼˜åŠ£</h2><p>LinkedHashSet ä¸ HashSet åŒºåˆ«åœ¨äº LinkedHashSet éå†å…¶å†…éƒ¨æ•°æ®æ—¶ï¼Œå¯ä»¥æŒ‰ç…§æ·»åŠ çš„é¡ºåºéå†ï¼Œåœ¨æ·»åŠ æ•°æ®çš„åŒæ—¶ï¼Œæ¯ä¸ªæ•°æ®è¿˜ç»´æŠ¤äº†ä¸¤ä¸ªå¼•ç”¨ï¼Œè®°å½•æ­¤æ•°æ®å‰ä¸€ä¸ªæ•°æ®å’Œåä¸€ä¸ªæ•°æ®ã€‚ </p><p>ç‰¹æ€§å°±å‰©ä¸å¯é‡å¤æ€§äº†</p><p>å¯¹äºé¢‘ç¹çš„éå†æ“ä½œï¼ŒLinkedHashSetæ•ˆç‡é«˜äºHashSet</p><h1 id="å››ã€TreeSet"><a href="#å››ã€TreeSet" class="headerlink" title="å››ã€TreeSet"></a>å››ã€TreeSet</h1><h2 id="1-ç»§æ‰¿æƒ…å†µ-2"><a href="#1-ç»§æ‰¿æƒ…å†µ-2" class="headerlink" title="1.ç»§æ‰¿æƒ…å†µ"></a>1.ç»§æ‰¿æƒ…å†µ</h2><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/10.png" srcset="/img/loading.gif" alt></p><p>TreeSetä¸å¤ªä¸€æ ·ï¼Œå®ƒæ˜¯å¯ä»¥å°†æ•°æ®æŒ‰ç…§ä¸€å®šçš„æ’åˆ—é¡ºåºè¿›è¡Œè¾“å‡ºã€‚æœ‰ä¿©ç§æ–¹å¼ï¼ˆå®šåˆ¶æ’åºï¼Œè‡ªç„¶æ’åºï¼‰</p><h2 id="2-è‡ªç„¶æ’åº"><a href="#2-è‡ªç„¶æ’åº" class="headerlink" title="2.è‡ªç„¶æ’åº"></a>2.è‡ªç„¶æ’åº</h2><p>è‡ªç„¶æ’åºå°±æ˜¯å¯¹è±¡å®ç°äº†Comparableæ¥å£</p><p><img src="/2020/07/25/Set%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/11.png" srcset="/img/loading.gif" alt></p><p>æˆ‘ä»¬çŸ¥é“ï¼ŒSetæ˜¯æ— åºçš„ï¼Œä½†æ˜¯ç”¨TreeSetçš„æ•°æ®å°±æ˜¯æœ‰åºçš„ï¼Œé‚£åŸºæœ¬æ•°æ®ç±»å‹ä¸ºä»€ä¹ˆå­˜è¿›å»å°±ä¼šå˜æœ‰åºå‘¢ï¼Ÿ</p><p>å…¶å®è¿™é‡Œæœ‰ä¸€ä¸ªè‡ªåŠ¨è£…ç®±çš„è¿‡ç¨‹åœ¨Integerä¸­å°±å®ç°äº†è¿™ä¸ªæ¥å£</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Integer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Number</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Comparable</span>&lt;<span class="hljs-title">Integer</span>&gt; </span>&#123;         åœ¨é‡Œé¢é‡å†™äº†compareTo     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compareTo</span><span class="hljs-params">(Integer anotherInteger)</span> </span>&#123;        <span class="hljs-keyword">return</span> compare(<span class="hljs-keyword">this</span>.value, anotherInteger.value);    &#125;     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;        <span class="hljs-keyword">return</span> (x &lt; y) ? -<span class="hljs-number">1</span> : ((x == y) ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>);    &#125;    ä»¥åè¦æƒ³æ”¾åœ¨TreeSetå®ç°æ’åºçš„å¯¹è±¡ å…ˆè¦è‡ªå·±é‡å†™compareToæ–¹æ³•ï¼Œç”¨è‡ªå·±çš„æ’åˆ—æ–¹å¼æ‰èƒ½ç”Ÿæ•ˆ</code></pre></div><h2 id="3-å®šåˆ¶æ’åº"><a href="#3-å®šåˆ¶æ’åº" class="headerlink" title="3.å®šåˆ¶æ’åº"></a>3.å®šåˆ¶æ’åº</h2><p>å¾€å¾€åœ¨å¾ˆå¤šæ—¶å€™ï¼Œè‡ªç„¶æ’åºæ ¹æœ¬ä¸èƒ½ç”¨ï¼Œå› ä¸ºä¸èƒ½å»æ›´æ”¹æºä»£ç ï¼Œæ‰€ä»¥æœ‰å¦ä¸€ç§æ–¹æ³•ï¼Œå¸®åŠ©æˆ‘ä»¬å®šåˆ¶æ’åºçš„é¡ºåº</p><p>è¿™ç§æ–¹æ³•å°±æ˜¯ç»™TreeSetæ„é€ å™¨ä¸­ç»™ä¸€ä¸ªComparatorå¯¹è±¡ï¼Œåœ¨Comparatorå¯¹è±¡ä¸­é‡å†™compareæ–¹æ³•ï¼Œå®šåˆ¶è‡ªå·±éœ€è¦çš„æ’åˆ—è§„åˆ™</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>   <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test2</span><span class="hljs-params">()</span></span>&#123;       Comparator com = <span class="hljs-keyword">new</span> Comparator() &#123;           <span class="hljs-comment">//ç…§å¹´é¾„ä»å°åˆ°å¤§æ’åˆ—</span>           <span class="hljs-meta">@Override</span>           <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compare</span><span class="hljs-params">(Object o1, Object o2)</span> </span>&#123;               <span class="hljs-keyword">if</span>(o1 <span class="hljs-keyword">instanceof</span> User &amp;&amp; o2 <span class="hljs-keyword">instanceof</span> User)&#123;                   User u1 = (User)o1;                   User u2 = (User)o2;                   <span class="hljs-keyword">return</span> Integer.compare(u1.getAge(),u2.getAge());               &#125;<span class="hljs-keyword">else</span>&#123;                   <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(<span class="hljs-string">"è¾“å…¥çš„æ•°æ®ç±»å‹ä¸åŒ¹é…"</span>);               &#125;           &#125;       &#125;;       TreeSet set = <span class="hljs-keyword">new</span> TreeSet(com);       set.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"Tom"</span>,<span class="hljs-number">12</span>));       set.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"Jerry"</span>,<span class="hljs-number">32</span>));       set.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"Jim"</span>,<span class="hljs-number">2</span>));       set.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"Mike"</span>,<span class="hljs-number">65</span>));       set.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"Mary"</span>,<span class="hljs-number">33</span>));       set.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"Jack"</span>,<span class="hljs-number">33</span>));       set.add(<span class="hljs-keyword">new</span> User(<span class="hljs-string">"Jack"</span>,<span class="hljs-number">56</span>));       Iterator iterator = set.iterator();       <span class="hljs-keyword">while</span>(iterator.hasNext())&#123;           System.out.println(iterator.next());       &#125;   &#125;</code></pre></div><p>ä¸€èˆ¬æ¥è¯´å¦‚æœæŸä¸ªå¯¹è±¡ä¸éœ€è¦ç»å¸¸ä½¿ç”¨æ’åºï¼Œåˆ™ä½¿ç”¨å®šåˆ¶æ’åºå°±è¡Œï¼Œå› ä¸ºå¯ä»¥ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„æ–¹å¼ï¼Œä¸€æ¬¡æ€§çš„æ’åºï¼Œè€Œä½¿ç”¨è‡ªç„¶æ’åºåˆ™æ˜¯ä¸€ç›´ç»‘å®šç€æ’åºè§„åˆ™ï¼Œä¸çµæ´»ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æºç åˆ†æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Set</tag>
      
      <tag>HashSet</tag>
      
      <tag>LinkedHashSet</tag>
      
      <tag>TreeSet</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Listæ¥å£åº•å±‚å®ç°ç±»</title>
    <link href="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/"/>
    <url>/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<h1 id="Listæ¥å£åº•å±‚å®ç°ç±»"><a href="#Listæ¥å£åº•å±‚å®ç°ç±»" class="headerlink" title="Listæ¥å£åº•å±‚å®ç°ç±»"></a>Listæ¥å£åº•å±‚å®ç°ç±»</h1><h2 id="ä¸€ã€javaé›†åˆç±»åˆ†ç±»"><a href="#ä¸€ã€javaé›†åˆç±»åˆ†ç±»" class="headerlink" title="ä¸€ã€javaé›†åˆç±»åˆ†ç±»"></a>ä¸€ã€javaé›†åˆç±»åˆ†ç±»</h2><p>javaé›†åˆæ¡†æ¶åˆ†ä¸ºä¿©ç§ï¼Œå•åˆ—é›†åˆæ¡†æ¶Collectionï¼Œå’ŒåŒåˆ—é›†åˆæ¡†æ¶Map</p><h3 id="1-å•åˆ—é›†åˆæ¡†æ¶ç»“æ„"><a href="#1-å•åˆ—é›†åˆæ¡†æ¶ç»“æ„" class="headerlink" title="1.å•åˆ—é›†åˆæ¡†æ¶ç»“æ„"></a>1.å•åˆ—é›†åˆæ¡†æ¶ç»“æ„</h3><p>Collectionæ¥å£ï¼šå•åˆ—é›†åˆï¼Œç”¨æ¥å­˜å‚¨ä¸€ä¸ªä¸€ä¸ªçš„å¯¹è±¡</p><ul><li>|â€”-Listæ¥å£ï¼šå­˜å‚¨åºçš„ã€å¯é‡å¤çš„æ•°æ®ã€‚  â€“&gt;â€œåŠ¨æ€â€æ•°ç»„<ul><li>|â€”-ArrayListã€LinkedListã€Vector<br>â€‹</li></ul></li><li>|â€”-Setæ¥å£ï¼šå­˜å‚¨æ— åºçš„ã€ä¸å¯é‡å¤çš„æ•°æ®   â€“&gt;é«˜ä¸­è®²çš„â€œé›†åˆâ€<ul><li>|â€”-HashSetã€LinkedHashSetã€TreeSet</li></ul></li></ul><p>æœ¬æ–‡å°†å¯¹Listæ¥å£è¿›è¡Œè§£æ</p><p>å¯¹åº”å›¾ç¤ºï¼š</p><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1592968971414.png" srcset="/img/loading.gif" alt="å•åˆ—é›†åˆæ¡†æ¶"></p><p><strong>å®çº¿ä¸ºç›´æ¥ç»§æ‰¿æˆ–å®ç°ï¼Œè™šçº¿ä¸ºé—´æ¥ç»§æ‰¿æˆ–å®ç°</strong></p><h2 id="äºŒã€ArrayList"><a href="#äºŒã€ArrayList" class="headerlink" title="äºŒã€ArrayList"></a>äºŒã€ArrayList</h2><h3 id="1-jdk1-7çš„æƒ…å†µ"><a href="#1-jdk1-7çš„æƒ…å†µ" class="headerlink" title="1.jdk1.7çš„æƒ…å†µ"></a>1.jdk1.7çš„æƒ…å†µ</h3><p>â€‹    ArrayList list = new ArrayList();//åº•å±‚åˆ›å»ºäº†é•¿åº¦æ˜¯10çš„Object[]æ•°ç»„elementData</p><ul><li><p>list.add(123);//elementData[0] = new Integer(123);</p></li><li><p>list.add(11);//å¦‚æœæ­¤æ¬¡çš„æ·»åŠ å¯¼è‡´åº•å±‚elementDataæ•°ç»„å®¹é‡ä¸å¤Ÿï¼Œåˆ™æ‰©å®¹ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰©å®¹ä¸ºåŸæ¥çš„å®¹é‡çš„1.5å€ï¼ŒåŒæ—¶éœ€è¦å°†åŸæœ‰æ•°ç»„ä¸­çš„æ•°æ®å¤åˆ¶åˆ°æ–°çš„æ•°ç»„ä¸­ã€‚</p></li><li><p>ç»“è®ºï¼šå»ºè®®å¼€å‘ä¸­ä½¿ç”¨å¸¦å‚çš„æ„é€ å™¨ï¼šArrayList list = new ArrayList(int capacity)</p><p>â€‹</p></li></ul><h3 id="2-jdk1-8çš„æƒ…å†µ"><a href="#2-jdk1-8çš„æƒ…å†µ" class="headerlink" title="2.jdk1.8çš„æƒ…å†µ"></a>2.jdk1.8çš„æƒ…å†µ</h3><p>â€‹    ç”±äºç°ä¸»æµå¼€å‘éƒ½æ˜¯1.8ç‰ˆæœ¬çš„jdkï¼Œæ‰€æœ‰ä»¥ä¸‹å¯¹ArrayListè¿›è¡Œæ·±å…¥è§£è¯»</p><h3 id="3-ç»§æ‰¿æƒ…å†µ"><a href="#3-ç»§æ‰¿æƒ…å†µ" class="headerlink" title="3.ç»§æ‰¿æƒ…å†µ"></a>3.ç»§æ‰¿æƒ…å†µ</h3><p>ä½¿ç”¨ideaè‡ªå¸¦çš„å¯è§†åŒ–å·¥å…·æŸ¥çœ‹ç»§æ‰¿ä¸å®ç°æƒ…å†µï¼Œå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°ArrayListé—´æ¥çš„å®ç°äº†Collectionæ¥å£</p><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1592969473(1).jpg" srcset="/img/loading.gif" alt="ç»§æ‰¿æƒ…å†µ"></p><h3 id="4-åˆ›å»ºArrayList"><a href="#4-åˆ›å»ºArrayList" class="headerlink" title="4.åˆ›å»ºArrayList"></a>4.åˆ›å»ºArrayList</h3><p>â€‹    æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åˆ›å»ºä¸€ä¸ªArrayListå®¹å™¨ä¼šå‘ç”Ÿä»€ä¹ˆ</p><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1592969867(1).jpg" srcset="/img/loading.gif" alt="åˆ›å»ºArrayList"></p><p>å½“æˆ‘ç”¨debugåˆ›å»ºä¸€ä¸ªarrayListæ—¶ è¿”å›çš„æ˜¯ä¸€ä¸ªç©ºçš„ï¼Œé•¿åº¦ä¸º0çš„æ•°ç»„</p><p>æˆ‘ä»¬è·Ÿè¿›å»æ„é€ å‡½æ•°</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ArrayList</span><span class="hljs-params">()</span> </span>&#123;    <span class="hljs-keyword">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;&#125;</code></pre></div><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">transient</span> Object[] elementData; <span class="hljs-comment">//ä¸€ä¸ªæ˜¯Object[]å¯¹è±¡,transientå…³é”®è¯æ˜¯æŒ‡è¯¥å¯¹è±¡ä¸éœ€è¦è¢«åºåˆ—åŒ–</span><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;<span class="hljs-comment">//ä¸€ä¸ªç©ºçš„Object[]å¯¹è±¡</span></code></pre></div><p>ä¸jdk7ç‰ˆæœ¬çš„åŒºåˆ«æ˜¯ jdk7åˆ›å»ºåå°±åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º10çš„æ•°ç»„ï¼Œä½†jdk8å¹¶æ²¡æœ‰ï¼Œæ›´åŠ èŠ‚çœå†…å­˜</p><h3 id="5-æ·»åŠ æ•°æ®"><a href="#5-æ·»åŠ æ•°æ®" class="headerlink" title="5.æ·»åŠ æ•°æ®"></a>5.æ·»åŠ æ•°æ®</h3><div class="hljs"><pre><code class="hljs java">arrayList.add(<span class="hljs-number">123</span>);</code></pre></div><p>æˆ‘ä»¬ç”¨debugè·Ÿè¿›æºç </p><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1592970609(1).jpg" srcset="/img/loading.gif" alt></p><p>å› ä¸ºå­˜å…¥123æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªè‡ªåŠ¨è£…ç®±çš„è¿‡ç¨‹ï¼ˆè£…æ¢ä¸ºIntegerç±»å‹ï¼‰</p><p>åé¢å°±æ˜¯è¿›å…¥addæ–¹æ³•</p><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1592973839(1).jpg" srcset="/img/loading.gif" alt></p><p>sizeé»˜è®¤åˆå§‹åŒ–ä¸º0ï¼Œè¿›å…¥ensureCapacityInternalæ–¹æ³•</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureCapacityInternal</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;        <span class="hljs-keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;            minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);            <span class="hljs-comment">//maxæ–¹æ³•å–ä¿©ä¸ªå‚æ•°æœ€å¤§çš„ä¸€ä¸ªï¼ˆè¿™é‡ŒDEFAULT_CAPACITYä¸º10ï¼‰ï¼Œå°†æœ€å¤§çš„å€¼èµ‹ç»™minCapacity</span>        &#125;        ensureExplicitCapacity(minCapacity);    &#125;è¿›å…¥ensureExplicitCapacity(minCapacity)æ–¹æ³•<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureExplicitCapacity</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;        modCount++;<span class="hljs-comment">//é»˜è®¤ä¸º0 </span>        <span class="hljs-comment">// overflow-conscious code</span>        <span class="hljs-keyword">if</span> (minCapacity - elementData.length &gt; <span class="hljs-number">0</span>)<span class="hljs-comment">//åˆ¤æ–­æœ€å°å®¹é‡å‡å»åŸæ•°ç»„é•¿åº¦æ˜¯å¦å¤§äº0</span>            grow(minCapacity);    &#125;   è¿›å…¥grow(minCapacity)æ–¹æ³• <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">grow</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;        <span class="hljs-comment">// overflow-conscious code</span>        <span class="hljs-keyword">int</span> oldCapacity = elementData.length;<span class="hljs-comment">//è®°å½•è€å®¹é‡é•¿åº¦ æ­¤æ—¶elementDataé•¿åº¦ä¸º0</span>        <span class="hljs-keyword">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="hljs-number">1</span>);<span class="hljs-comment">//å®šä¹‰æ–°å®¹é‡å€¼ï¼Œè€å®¹é‡é•¿åº¦å³ç§»ä¸€ä½ååŠ å†ä¸Šè€å®¹é‡é•¿åº¦ï¼Œè€Œå³ç§»ä¸€ä½æ˜¯å–æ•°å€¼çš„ä¸€åŠï¼Œè¿™é‡Œå°±å†³å®šäº†ArrayListä»¥åè¿›è¡Œæ‰©å®¹éƒ½æ˜¯å¯¹åŸæ•°ç»„æ‰©å®¹1.5å€</span>        <span class="hljs-keyword">if</span> (newCapacity - minCapacity &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">//0 - 10 å°äº0 æ‰€æœ‰è¿›å…¥ </span>            newCapacity = minCapacity;<span class="hljs-comment">//æ–°å®¹é‡é•¿åº¦å°±ä¸º10</span>        <span class="hljs-keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">//åˆ¤æ–­æ­¤å®¹é‡ä¼šä¸ä¼šè¶…è¿‡æœ€å¤§é•¿åº¦ï¼ˆInteger.MAX_VALUE - 8ï¼‰</span>            newCapacity = hugeCapacity(minCapacity);        <span class="hljs-comment">// minCapacity is usually close to size, so this is a win:</span>        elementData = Arrays.copyOf(elementData, newCapacity);<span class="hljs-comment">//è°ƒç”¨Arrayså·¥å…·ç±»ï¼Œå¯¹æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼ŒåŸç†ä¸ºå°†æ—§æ•°ç»„æ•°æ®å¤åˆ¶åˆ°æ–°æ•°ç»„</span>    &#125;</code></pre></div><h2 id="ä¸‰ã€LinkedList"><a href="#ä¸‰ã€LinkedList" class="headerlink" title="ä¸‰ã€LinkedList"></a>ä¸‰ã€LinkedList</h2><h3 id="1-ç»§æ‰¿æƒ…å†µ"><a href="#1-ç»§æ‰¿æƒ…å†µ" class="headerlink" title="1.ç»§æ‰¿æƒ…å†µ"></a>1.ç»§æ‰¿æƒ…å†µ</h3><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1592975059(1).jpg" srcset="/img/loading.gif" alt></p><p>å¯ä»¥çœ‹åˆ°ä¸ä»…é—´æ¥çš„å®ç°äº†Listæ¥å£ï¼Œè¿˜é—´æ¥çš„å®ç°äº†é˜Ÿåˆ—Queueçš„æ¥å£</p><h3 id="2-åˆ›å»ºLinkedList"><a href="#2-åˆ›å»ºLinkedList" class="headerlink" title="2.åˆ›å»ºLinkedList"></a>2.åˆ›å»ºLinkedList</h3><div class="hljs"><pre><code class="hljs java">LinkedList linkedList = <span class="hljs-keyword">new</span> LinkedList();</code></pre></div><p>é€šè¿‡newçš„æ–¹å¼åªæ˜¯åˆå§‹åŒ–LinkedListå®¹å™¨ï¼Œåº•å±‚åŒå‘é“¾è¡¨ç»“æ„è¿˜æœªåˆ›å»ºã€‚LinkedList Nodeç±»å‹çš„firstå’Œlastå±æ€§ï¼Œé»˜è®¤ä¸ºnull</p><h3 id="3-æ·»åŠ æ•°æ®"><a href="#3-æ·»åŠ æ•°æ®" class="headerlink" title="3.æ·»åŠ æ•°æ®"></a>3.æ·»åŠ æ•°æ®</h3><div class="hljs"><pre><code class="hljs java">linkedList.add(<span class="hljs-number">123</span>);</code></pre></div><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1592975703(1).jpg" srcset="/img/loading.gif" alt></p><p>è¿›å…¥linkLastä¸­</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åœ¨linkedListé‡Œé¢æœ‰firstå’Œlastå±æ€§</span><span class="hljs-keyword">transient</span> Node&lt;E&gt; first;<span class="hljs-keyword">transient</span> Node&lt;E&gt; last;<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">linkLast</span><span class="hljs-params">(E e)</span> </span>&#123;    <span class="hljs-keyword">final</span> Node&lt;E&gt; l = last; <span class="hljs-comment">//å°†åŸæ–™çš„lastå¯¹è±¡èµ‹å€¼ç»™l</span>    <span class="hljs-keyword">final</span> Node&lt;E&gt; newNode = <span class="hljs-keyword">new</span> Node&lt;&gt;(l, e, <span class="hljs-keyword">null</span>);<span class="hljs-comment">//Nodeä¸ºä¸€ä¸ªé™æ€å†…éƒ¨ç±» åœ¨ä¸‹é¢ï¼šä½œç”¨æ˜¯åˆå§‹åŒ–Nodeå¯¹è±¡ï¼ˆé“¾è¡¨å¯¹è±¡ï¼Œprevä¸ºå¤´æŒ‡é’ˆï¼Œnextä¸ºå°¾æŒ‡é’ˆï¼Œelementä¸ºæ•°æ®ï¼‰</span>    last = newNode;<span class="hljs-comment">//å°†æœ‰æ•°æ®çš„newNodeèµ‹å€¼ç»™last</span>    <span class="hljs-keyword">if</span> (l == <span class="hljs-keyword">null</span>)<span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯</span>        first = newNode;<span class="hljs-comment">//å°†NewNodeç›´æ¥èµ‹å€¼ç»™å°¾èŠ‚ç‚¹</span>    <span class="hljs-keyword">else</span>        l.next = newNode;<span class="hljs-comment">//ä¸æ˜¯çš„è¯ã€‚å°†èŠ‚ç‚¹æ·»åŠ åˆ°l.next ç›¸å½“äºå°†é“¾è¡¨è¿æ¥èµ·æ¥</span>    size++;    modCount++;&#125;<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Node</span>&lt;<span class="hljs-title">E</span>&gt; </span>&#123;        E item;        Node&lt;E&gt; next;        Node&lt;E&gt; prev;        Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;            <span class="hljs-keyword">this</span>.item = element;            <span class="hljs-keyword">this</span>.next = next;            <span class="hljs-keyword">this</span>.prev = prev;        &#125;    &#125;</code></pre></div><h2 id="å››ã€Vector"><a href="#å››ã€Vector" class="headerlink" title="å››ã€Vector"></a>å››ã€Vector</h2><p>jdk7å’Œjdk8ä¸­é€šè¿‡Vector()æ„é€ å™¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œåº•å±‚éƒ½åˆ›å»ºäº†é•¿åº¦ä¸º10çš„æ•°ç»„ã€‚<br>åœ¨æ‰©å®¹æ–¹é¢ï¼Œé»˜è®¤æ‰©å®¹ä¸ºåŸæ¥çš„æ•°ç»„é•¿åº¦çš„2å€ã€‚</p><h3 id="1-ç»§æ‰¿æƒ…å†µ-1"><a href="#1-ç»§æ‰¿æƒ…å†µ-1" class="headerlink" title="1.ç»§æ‰¿æƒ…å†µ"></a>1.ç»§æ‰¿æƒ…å†µ</h3><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1593002715(1).png" srcset="/img/loading.gif" alt></p><h3 id="2-åˆ›å»ºVector"><a href="#2-åˆ›å»ºVector" class="headerlink" title="2.åˆ›å»ºVector"></a>2.åˆ›å»ºVector</h3><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1593002840(1).jpg" srcset="/img/loading.gif" alt></p><p>è®©æˆ‘ä»¬è·Ÿè¿›å»æ„é€ å‡½æ•°</p><div class="hljs"><pre><code class="hljs java"> <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Vector</span><span class="hljs-params">()</span> </span>&#123;        <span class="hljs-keyword">this</span>(<span class="hljs-number">10</span>);    &#125;å†å¾€ä¸‹è·Ÿï¼Œè°ƒç”¨ä¸€ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Vector</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity)</span> </span>&#123;        <span class="hljs-keyword">this</span>(initialCapacity, <span class="hljs-number">0</span>);    &#125;    å†å¾€ä¸‹è·Ÿï¼Œè°ƒç”¨å‡‰å‚æ•°çš„æ„é€ å‡½æ•°<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Vector</span><span class="hljs-params">(<span class="hljs-keyword">int</span> initialCapacity, <span class="hljs-keyword">int</span> capacityIncrement)</span> </span>&#123;        <span class="hljs-keyword">super</span>();<span class="hljs-comment">//æ˜¾ç¤ºè°ƒç”¨çˆ¶æ„é€ å‡½æ•°</span>        <span class="hljs-keyword">if</span> (initialCapacity &lt; <span class="hljs-number">0</span>)<span class="hljs-comment">//ä¸º0å°±æŠ¥é”™ï¼Œå‚æ•°ä¼ è¿›æ¥ä¸º10</span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> IllegalArgumentException(<span class="hljs-string">"Illegal Capacity: "</span>+                                               initialCapacity);        <span class="hljs-keyword">this</span>.elementData = <span class="hljs-keyword">new</span> Object[initialCapacity]; <span class="hljs-comment">//åˆ›å»ºå¹¶åˆå§‹åŒ–äº†å¯¹è±¡æ•°ç»„</span>        <span class="hljs-keyword">this</span>.capacityIncrement = capacityIncrement;    &#125;    ä¸Šé¢ä¿©ä¸ªå±æ€§å®šä¹‰å¦‚ä¸‹ï¼š<span class="hljs-keyword">protected</span> Object[] elementData;<span class="hljs-keyword">protected</span> <span class="hljs-keyword">int</span> elementCount;</code></pre></div><p>æ­¤ç‰ˆæœ¬ä¸ºjdk8ï¼Œjdk7çš„Vectorä¹Ÿæ˜¯åˆ›å»ºä¸€ä¸ªVectorå®¹å™¨å°±é»˜è®¤åˆå§‹åŒ–é•¿åº¦ä¸º0ï¼Œä¸jdk7çš„ArrayListä¸€æ ·ï¼Œä½†æ˜¯äººå®¶å¼€å‘è€…å¯¹ArrayListè¿›è¡Œäº†æ”¹è¿›ï¼Œä½¿ç”¨æ‡’åŠ è½½ï¼Œå¯èƒ½Vectorè¦è¢«æ”¾å¼ƒäº†å§ï¼ï¼</p><p>æ¥ä¸‹æ¥è®²ä¸ºä»€ä¹ˆä¼šæ”¾å¼ƒVector</p><h3 id="3-æ·»åŠ æ•°æ®-1"><a href="#3-æ·»åŠ æ•°æ®-1" class="headerlink" title="3.æ·»åŠ æ•°æ®"></a>3.æ·»åŠ æ•°æ®</h3><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1593003620(1).jpg" srcset="/img/loading.gif" alt></p><p>æ¥ä¸‹æ¥è·Ÿè¿›æºç </p><p><img src="/2020/06/24/List%E6%8E%A5%E5%8F%A3%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E7%B1%BB/1593003749(1).jpg" srcset="/img/loading.gif" alt></p><p>elementCounté»˜è®¤ä¸º0ã€‚</p><p>å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªensureCapacityHelperæ–¹æ³•ï¼Œæ­¤æ–¹æ³•æ˜¯æ ¡éªŒé•¿åº¦æ˜¯å¦è¶³å¤Ÿï¼Œå¹¶å»æ‰©å®¹çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ensureCapacityHelper</span><span class="hljs-params">(<span class="hljs-keyword">int</span> minCapacity)</span> </span>&#123;    <span class="hljs-comment">// overflow-conscious code</span>    <span class="hljs-keyword">if</span> (minCapacity - elementData.length &gt; <span class="hljs-number">0</span>)        grow(minCapacity);<span class="hljs-comment">//æ‰©å®¹æ–¹æ³•</span>&#125;</code></pre></div><p>ä½†æ­¤å¤„å› ä¸ºé»˜è®¤åˆå§‹åŒ–é•¿åº¦ä¸º10ï¼Œæ‰€ä»¥è¿™é‡Œä¸ä¼šæœ‰æ‰©å®¹çš„éœ€æ±‚ã€‚</p><p>ç¨ç­‰ï¼Vectorä¸æ˜¯æŒºå¥½çš„å˜›ï¼Œä¸ºä»€ä¹ˆè¦æ”¾å¼ƒä»–ï¼Ÿï¼Ÿå› ä¸ºâ€¦</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">add</span><span class="hljs-params">(E e)</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> E <span class="hljs-title">remove</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index)</span> </span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">containsAll</span><span class="hljs-params">(Collection&lt;?&gt; c)</span></span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">addAll</span><span class="hljs-params">(<span class="hljs-keyword">int</span> index, Collection&lt;? extends E&gt; c)</span></span></code></pre></div><p>å› ä¸ºä»–çš„æ–¹æ³•ä¸Šå…¨åŠ äº†synchronizedï¼ŒåŠ ä¸Šè¿™ä¸ªå­—æ®µä»–å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ–¹æ³•ï¼Œè€Œä»–çš„å…¨éƒ¨æ–¹æ³•éƒ½æ˜¯çº¿ç¨‹å®‰å…¨æ–¹æ³•ï¼Œåˆä¼—æ‰€å‘¨çŸ¥ï¼Œçº¿ç¨‹å®‰å…¨æ•ˆç‡å¤§å¤§å‡ä½ï¼Œæ‰€ä»¥è¿å¼€å‘jdkäººå‘˜éƒ½æ‡’å¾—æ•‘ä»–ï¼Œæ¯•ç«Ÿï¼Œå‡ºç°äº†æ›´å¥½çš„äººï¼Œè€æƒ…äººå…¨å¿˜æ‰äº†~</p><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>ä¸Šè¿°ä»‹ç»äº†Listæ¥å£çš„å…¨éƒ¨å®ç°ç±»ï¼Œå¦‚æœæ•°æ®ä¸éœ€è¦çº¿ç¨‹å®‰å…¨ï¼Œåˆ™ä¸è¦å»è€ƒè™‘ä½¿ç”¨Vectorï¼Œè€Œå› ä¸ºArrayListå’ŒLinkedListåº•å±‚å®ç°åŸç†ä¸åŒï¼Œä»–ä»¬ä½¿ç”¨çš„åœ°æ–¹ä¹Ÿæœ‰æ‰€ä¸åŒï¼ŒArrayListåº•å±‚ä½¿ç”¨çš„æ˜¯æ•°ç»„å®ç°ï¼Œå› æ­¤åœ¨éœ€è¦é¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ•°æ®æ—¶æ•ˆç‡ä¼šå¤§å¤§å‡ä½ï¼Œè€Œæ•°ç»„æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯æœ‰ä¸‹æ ‡ï¼Œä¸‹æ ‡æœ€ç›´æ¥å¥½çš„å¥½å¤„å°±æ˜¯æŸ¥è¯¢é€Ÿåº¦éå¸¸çš„å¿«ï¼Œè€ŒLinkedListåº•å±‚ä½¿ç”¨çš„æ˜¯åŒå‘é“¾è¡¨å®ç°ï¼Œæ‰€ä»¥åœ¨é¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ•°æ®æ—¶ï¼Œæœ‰è¶…é«˜æ€§èƒ½çš„è¡¨ç°ï¼Œä½†æ˜¯åœ¨æŸ¥è¯¢çš„é€Ÿåº¦è¿œè¿œæ¯”ä¸ä¸ŠArrayListã€‚</p><p>è®°é‡ç‚¹ï¼šArrayListæ•°ç»„å®ç°ï¼Œæ¯æ¬¡æ‰©å®¹1.5å€ï¼Œä½¿ç”¨æ‡’åŠ è½½ï¼Œé¦–æ¬¡æ‰©å®¹é•¿åº¦ä¸º10</p><p>â€‹        LinkedListåŒå‘é“¾è¡¨å®ç°</p>]]></content>
    
    
    <categories>
      
      <category>æºç åˆ†æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>List</tag>
      
      <tag>ArrayList</tag>
      
      <tag>LinkedList</tag>
      
      <tag>Vector</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot-SpringMVCè‡ªåŠ¨é…ç½®</title>
    <link href="/2020/06/24/SpringBoot-SpringMVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE/"/>
    <url>/2020/06/24/SpringBoot-SpringMVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE/</url>
    
    <content type="html"><![CDATA[<h2 id="SpringMVCè‡ªåŠ¨é…ç½®"><a href="#SpringMVCè‡ªåŠ¨é…ç½®" class="headerlink" title="SpringMVCè‡ªåŠ¨é…ç½®"></a>SpringMVCè‡ªåŠ¨é…ç½®</h2><p><a href="https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/1.5.10.RELEASE/reference/htmlsingle/#boot-features-developing-web-applications</a></p><h3 id="1-Spring-MVC-auto-configuration"><a href="#1-Spring-MVC-auto-configuration" class="headerlink" title="1. Spring MVC auto-configuration"></a>1. Spring MVC auto-configuration</h3><p>Spring Boot è‡ªåŠ¨é…ç½®å¥½äº†SpringMVC</p><p>ä»¥ä¸‹æ˜¯SpringBootå¯¹SpringMVCçš„é»˜è®¤é…ç½®:<strong>==ï¼ˆWebMvcAutoConfigurationï¼‰==</strong></p><ul><li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p><ul><li>è‡ªåŠ¨é…ç½®äº†ViewResolverï¼ˆè§†å›¾è§£æå™¨ï¼šæ ¹æ®æ–¹æ³•çš„è¿”å›å€¼å¾—åˆ°è§†å›¾å¯¹è±¡ï¼ˆViewï¼‰ï¼Œè§†å›¾å¯¹è±¡å†³å®šå¦‚ä½•æ¸²æŸ“ï¼ˆè½¬å‘ï¼Ÿé‡å®šå‘ï¼Ÿï¼‰ï¼‰</li><li>ContentNegotiatingViewResolverï¼šç»„åˆæ‰€æœ‰çš„è§†å›¾è§£æå™¨çš„ï¼›</li><li>==å¦‚ä½•å®šåˆ¶ï¼šæˆ‘ä»¬å¯ä»¥è‡ªå·±ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªè§†å›¾è§£æå™¨ï¼›è‡ªåŠ¨çš„å°†å…¶ç»„åˆè¿›æ¥ï¼›==</li></ul></li><li><p>Support for serving static resources, including support for WebJars (see below).é™æ€èµ„æºæ–‡ä»¶å¤¹è·¯å¾„,webjars</p></li><li><p>Static <code>index.html</code> support. é™æ€é¦–é¡µè®¿é—®</p></li><li><p>Custom <code>Favicon</code> support (see below).  favicon.ico</p><p>â€‹</p></li><li><p>è‡ªåŠ¨æ³¨å†Œäº† of <code>Converter</code>, <code>GenericConverter</code>, <code>Formatter</code> beans.</p><ul><li>Converterï¼šè½¬æ¢å™¨ï¼›  public String hello(User user)ï¼šç±»å‹è½¬æ¢ä½¿ç”¨Converter</li><li><code>Formatter</code>  æ ¼å¼åŒ–å™¨ï¼›  2017.12.17===Dateï¼›</li></ul></li></ul><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><span class="hljs-meta">@ConditionalOnProperty</span>(prefix = <span class="hljs-string">"spring.mvc"</span>, name = <span class="hljs-string">"date-format"</span>)<span class="hljs-comment">//åœ¨æ–‡ä»¶ä¸­é…ç½®æ—¥æœŸæ ¼å¼åŒ–çš„è§„åˆ™</span><span class="hljs-function"><span class="hljs-keyword">public</span> Formatter&lt;Date&gt; <span class="hljs-title">dateFormatter</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> DateFormatter(<span class="hljs-keyword">this</span>.mvcProperties.getDateFormat());<span class="hljs-comment">//æ—¥æœŸæ ¼å¼åŒ–ç»„ä»¶</span>&#125;</code></pre></div><p>â€‹    ==è‡ªå·±æ·»åŠ çš„æ ¼å¼åŒ–å™¨è½¬æ¢å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦æ”¾åœ¨å®¹å™¨ä¸­å³å¯==</p><ul><li><p>Support for <code>HttpMessageConverters</code> (see below).</p><ul><li><p>HttpMessageConverterï¼šSpringMVCç”¨æ¥è½¬æ¢Httpè¯·æ±‚å’Œå“åº”çš„ï¼›Userâ€”Jsonï¼›</p></li><li><p><code>HttpMessageConverters</code> æ˜¯ä»å®¹å™¨ä¸­ç¡®å®šï¼›è·å–æ‰€æœ‰çš„HttpMessageConverterï¼›</p><p>==è‡ªå·±ç»™å®¹å™¨ä¸­æ·»åŠ HttpMessageConverterï¼Œåªéœ€è¦å°†è‡ªå·±çš„ç»„ä»¶æ³¨å†Œå®¹å™¨ä¸­ï¼ˆ@Bean,@Componentï¼‰==</p><p>â€‹</p></li></ul></li><li><p>Automatic registration of <code>MessageCodesResolver</code> (see below).å®šä¹‰é”™è¯¯ä»£ç ç”Ÿæˆè§„åˆ™</p></li><li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (see below).</p><p>==æˆ‘ä»¬å¯ä»¥é…ç½®ä¸€ä¸ªConfigurableWebBindingInitializeræ¥æ›¿æ¢é»˜è®¤çš„ï¼›ï¼ˆæ·»åŠ åˆ°å®¹å™¨ï¼‰==</p><div class="hljs"><pre><code class="hljs diff">åˆå§‹åŒ–WebDataBinderï¼›è¯·æ±‚æ•°æ®<span class="hljs-comment">=====JavaBeanï¼›</span></code></pre></div></li></ul><p><strong>org.springframework.boot.autoconfigure.webï¼šwebçš„æ‰€æœ‰è‡ªåŠ¨åœºæ™¯ï¼›</strong></p><p>If you want to keep Spring Boot MVC features, and you just want to add additional <a href="https://docs.spring.io/spring/docs/4.3.14.RELEASE/spring-framework-reference/htmlsingle#mvc" target="_blank" rel="noopener">MVC configuration</a> (interceptors, formatters, view controllers etc.) you can add your own <code>@Configuration</code> class of type <code>WebMvcConfigurerAdapter</code>, but <strong>without</strong> <code>@EnableWebMvc</code>. If you wish to provide custom instances of <code>RequestMappingHandlerMapping</code>, <code>RequestMappingHandlerAdapter</code> or <code>ExceptionHandlerExceptionResolver</code> you can declare a <code>WebMvcRegistrationsAdapter</code> instance providing such components.</p><p>If you want to take complete control of Spring MVC, you can add your own <code>@Configuration</code> annotated with <code>@EnableWebMvc</code>.</p><h3 id="2ã€æ‰©å±•SpringMVC"><a href="#2ã€æ‰©å±•SpringMVC" class="headerlink" title="2ã€æ‰©å±•SpringMVC"></a>2ã€æ‰©å±•SpringMVC</h3><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">mvc:view-controller</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/hello"</span> <span class="hljs-attr">view-name</span>=<span class="hljs-string">"success"</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptors</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">mvc:interceptor</span>&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">mvc:mapping</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/hello"</span>/&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">bean</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptor</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">mvc:interceptors</span>&gt;</span></code></pre></div><p><strong>==ç¼–å†™ä¸€ä¸ªé…ç½®ç±»ï¼ˆ@Configurationï¼‰ï¼Œæ˜¯WebMvcConfigurerAdapterç±»å‹ï¼›ä¸èƒ½æ ‡æ³¨@EnableWebMvc==</strong>;</p><p>æ—¢ä¿ç•™äº†æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ï¼Œä¹Ÿèƒ½ç”¨æˆ‘ä»¬æ‰©å±•çš„é…ç½®ï¼›</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä½¿ç”¨WebMvcConfigurerAdapterå¯ä»¥æ¥æ‰©å±•SpringMVCçš„åŠŸèƒ½</span><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyMvcConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;       <span class="hljs-comment">// super.addViewControllers(registry);</span>        <span class="hljs-comment">//æµè§ˆå™¨å‘é€ /atguigu è¯·æ±‚æ¥åˆ° success</span>        registry.addViewController(<span class="hljs-string">"/atguigu"</span>).setViewName(<span class="hljs-string">"success"</span>);    &#125;&#125;</code></pre></div><p>åŸç†ï¼š</p><p>â€‹    1ï¼‰ã€WebMvcAutoConfigurationæ˜¯SpringMVCçš„è‡ªåŠ¨é…ç½®ç±»</p><p>â€‹    2ï¼‰ã€åœ¨åšå…¶ä»–è‡ªåŠ¨é…ç½®æ—¶ä¼šå¯¼å…¥ï¼›@Import(<strong>EnableWebMvcConfiguration</strong>.class)</p><div class="hljs"><pre><code class="hljs java">   <span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EnableWebMvcConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DelegatingWebMvcConfiguration</span> </span>&#123;     <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebMvcConfigurerComposite configurers = <span class="hljs-keyword">new</span> WebMvcConfigurerComposite(); <span class="hljs-comment">//ä»å®¹å™¨ä¸­è·å–æ‰€æœ‰çš„WebMvcConfigurer</span>     <span class="hljs-meta">@Autowired</span>(required = <span class="hljs-keyword">false</span>)     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setConfigurers</span><span class="hljs-params">(List&lt;WebMvcConfigurer&gt; configurers)</span> </span>&#123;         <span class="hljs-keyword">if</span> (!CollectionUtils.isEmpty(configurers)) &#123;             <span class="hljs-keyword">this</span>.configurers.addWebMvcConfigurers(configurers);           <span class="hljs-comment">//ä¸€ä¸ªå‚è€ƒå®ç°ï¼›å°†æ‰€æœ‰çš„WebMvcConfigurerç›¸å…³é…ç½®éƒ½æ¥ä¸€èµ·è°ƒç”¨ï¼›  </span>           <span class="hljs-meta">@Override</span>            <span class="hljs-comment">// public void addViewControllers(ViewControllerRegistry registry) &#123;</span>             <span class="hljs-comment">//    for (WebMvcConfigurer delegate : this.delegates) &#123;</span>              <span class="hljs-comment">//       delegate.addViewControllers(registry);</span>              <span class="hljs-comment">//   &#125;</span>             &#125;         &#125;&#125;</code></pre></div><p>â€‹    3ï¼‰ã€å®¹å™¨ä¸­æ‰€æœ‰çš„WebMvcConfigureréƒ½ä¼šä¸€èµ·èµ·ä½œç”¨ï¼›</p><p>â€‹    4ï¼‰ã€æˆ‘ä»¬çš„é…ç½®ç±»ä¹Ÿä¼šè¢«è°ƒç”¨ï¼›</p><p>â€‹    æ•ˆæœï¼šSpringMVCçš„è‡ªåŠ¨é…ç½®å’Œæˆ‘ä»¬çš„æ‰©å±•é…ç½®éƒ½ä¼šèµ·ä½œç”¨ï¼›</p><h3 id="3ã€å…¨é¢æ¥ç®¡SpringMVCï¼›"><a href="#3ã€å…¨é¢æ¥ç®¡SpringMVCï¼›" class="headerlink" title="3ã€å…¨é¢æ¥ç®¡SpringMVCï¼›"></a>3ã€å…¨é¢æ¥ç®¡SpringMVCï¼›</h3><p>SpringBootå¯¹SpringMVCçš„è‡ªåŠ¨é…ç½®ä¸éœ€è¦äº†ï¼Œæ‰€æœ‰éƒ½æ˜¯æˆ‘ä»¬è‡ªå·±é…ç½®ï¼›æ‰€æœ‰çš„SpringMVCçš„è‡ªåŠ¨é…ç½®éƒ½å¤±æ•ˆäº†</p><p><strong>æˆ‘ä»¬éœ€è¦åœ¨é…ç½®ç±»ä¸­æ·»åŠ @EnableWebMvcå³å¯ï¼›</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä½¿ç”¨WebMvcConfigurerAdapterå¯ä»¥æ¥æ‰©å±•SpringMVCçš„åŠŸèƒ½</span><span class="hljs-meta">@EnableWebMvc</span><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyMvcConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurerAdapter</span> </span>&#123;    <span class="hljs-meta">@Override</span>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addViewControllers</span><span class="hljs-params">(ViewControllerRegistry registry)</span> </span>&#123;       <span class="hljs-comment">// super.addViewControllers(registry);</span>        <span class="hljs-comment">//æµè§ˆå™¨å‘é€ /atguigu è¯·æ±‚æ¥åˆ° success</span>        registry.addViewController(<span class="hljs-string">"/atguigu"</span>).setViewName(<span class="hljs-string">"success"</span>);    &#125;&#125;</code></pre></div><p>åŸç†ï¼š</p><p>ä¸ºä»€ä¹ˆ@EnableWebMvcè‡ªåŠ¨é…ç½®å°±å¤±æ•ˆäº†ï¼›</p><p>1ï¼‰@EnableWebMvcçš„æ ¸å¿ƒ</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Import</span>(DelegatingWebMvcConfiguration<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span><span class="hljs-class"><span class="hljs-title">public</span> @<span class="hljs-title">interface</span> <span class="hljs-title">EnableWebMvc</span> </span>&#123;</code></pre></div><p>2ï¼‰ã€</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DelegatingWebMvcConfiguration</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">WebMvcConfigurationSupport</span> </span>&#123;</code></pre></div><p>3ï¼‰ã€</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><span class="hljs-meta">@ConditionalOnWebApplication</span><span class="hljs-meta">@ConditionalOnClass</span>(&#123; Servlet<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">DispatcherServlet</span>.<span class="hljs-title">class</span>,</span><span class="hljs-class"><span class="hljs-title">WebMvcConfigurerAdapter</span>.<span class="hljs-title">class</span> &#125;)</span><span class="hljs-class">//å®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªç»„ä»¶çš„æ—¶å€™ï¼Œè¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»æ‰ç”Ÿæ•ˆ</span><span class="hljs-class">@<span class="hljs-title">ConditionalOnMissingBean</span>(<span class="hljs-title">WebMvcConfigurationSupport</span>.<span class="hljs-title">class</span>)</span><span class="hljs-class">@<span class="hljs-title">AutoConfigureOrder</span>(<span class="hljs-title">Ordered</span>.<span class="hljs-title">HIGHEST_PRECEDENCE</span> + 10)</span><span class="hljs-class">@<span class="hljs-title">AutoConfigureAfter</span>(</span>&#123; DispatcherServletAutoConfiguration<span class="hljs-class">.<span class="hljs-keyword">class</span>,</span><span class="hljs-class"><span class="hljs-title">ValidationAutoConfiguration</span>.<span class="hljs-title">class</span> &#125;)</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">WebMvcAutoConfiguration</span> </span>&#123;</code></pre></div><p>4ï¼‰ã€@EnableWebMvcå°†WebMvcConfigurationSupportç»„ä»¶å¯¼å…¥è¿›æ¥ï¼›</p><p>5ï¼‰ã€å¯¼å…¥çš„WebMvcConfigurationSupportåªæ˜¯SpringMVCæœ€åŸºæœ¬çš„åŠŸèƒ½ï¼›</p><h3 id="4ã€å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®"><a href="#4ã€å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®" class="headerlink" title="4ã€å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®"></a>4ã€å¦‚ä½•ä¿®æ”¹SpringBootçš„é»˜è®¤é…ç½®</h3><p>æ¨¡å¼ï¼š</p><p>â€‹    1ï¼‰ã€SpringBootåœ¨è‡ªåŠ¨é…ç½®å¾ˆå¤šç»„ä»¶çš„æ—¶å€™ï¼Œå…ˆçœ‹å®¹å™¨ä¸­æœ‰æ²¡æœ‰ç”¨æˆ·è‡ªå·±é…ç½®çš„ï¼ˆ@Beanã€@Componentï¼‰å¦‚æœæœ‰å°±ç”¨ç”¨æˆ·é…ç½®çš„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰è‡ªåŠ¨é…ç½®ï¼›å¦‚æœæœ‰äº›ç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªï¼ˆViewResolverï¼‰å°†ç”¨æˆ·é…ç½®çš„å’Œè‡ªå·±é»˜è®¤çš„ç»„åˆèµ·æ¥ï¼›</p><p>â€‹    2ï¼‰ã€åœ¨SpringBootä¸­ä¼šæœ‰éå¸¸å¤šçš„xxxConfigurerå¸®åŠ©æˆ‘ä»¬è¿›è¡Œæ‰©å±•é…ç½®</p><p>â€‹    3ï¼‰ã€åœ¨SpringBootä¸­ä¼šæœ‰å¾ˆå¤šçš„xxxCustomizerå¸®åŠ©æˆ‘ä»¬è¿›è¡Œå®šåˆ¶é…ç½®</p>]]></content>
    
    
    <categories>
      
      <category>æºç åˆ†æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>SpringMVC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootæ—¥å¿—</title>
    <link href="/2020/06/23/SpringBoot%E6%97%A5%E5%BF%97/"/>
    <url>/2020/06/23/SpringBoot%E6%97%A5%E5%BF%97/</url>
    
    <content type="html"><![CDATA[<h1 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h1><h2 id="1ã€æ—¥å¿—æ¡†æ¶"><a href="#1ã€æ—¥å¿—æ¡†æ¶" class="headerlink" title="1ã€æ—¥å¿—æ¡†æ¶"></a>1ã€æ—¥å¿—æ¡†æ¶</h2><p> å°å¼ ï¼›å¼€å‘ä¸€ä¸ªå¤§å‹ç³»ç»Ÿï¼›</p><p>â€‹        1ã€System.out.println(â€œâ€)ï¼›å°†å…³é”®æ•°æ®æ‰“å°åœ¨æ§åˆ¶å°ï¼›å»æ‰ï¼Ÿå†™åœ¨ä¸€ä¸ªæ–‡ä»¶ï¼Ÿ</p><p>â€‹        2ã€æ¡†æ¶æ¥è®°å½•ç³»ç»Ÿçš„ä¸€äº›è¿è¡Œæ—¶ä¿¡æ¯ï¼›æ—¥å¿—æ¡†æ¶ ï¼›  zhanglogging.jarï¼›</p><p>â€‹        3ã€é«˜å¤§ä¸Šçš„å‡ ä¸ªåŠŸèƒ½ï¼Ÿå¼‚æ­¥æ¨¡å¼ï¼Ÿè‡ªåŠ¨å½’æ¡£ï¼Ÿxxxxï¼Ÿ  zhanglogging-good.jarï¼Ÿ</p><p>â€‹        4ã€å°†ä»¥å‰æ¡†æ¶å¸ä¸‹æ¥ï¼Ÿæ¢ä¸Šæ–°çš„æ¡†æ¶ï¼Œé‡æ–°ä¿®æ”¹ä¹‹å‰ç›¸å…³çš„APIï¼›zhanglogging-prefect.jarï¼›</p><p>â€‹        5ã€JDBCâ€”æ•°æ®åº“é©±åŠ¨ï¼›</p><p>â€‹            å†™äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£å±‚ï¼›æ—¥å¿—é—¨é¢ï¼ˆæ—¥å¿—çš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼‰ï¼›logging-abstract.jarï¼›</p><p>â€‹            ç»™é¡¹ç›®ä¸­å¯¼å…¥å…·ä½“çš„æ—¥å¿—å®ç°å°±è¡Œäº†ï¼›æˆ‘ä»¬ä¹‹å‰çš„æ—¥å¿—æ¡†æ¶éƒ½æ˜¯å®ç°çš„æŠ½è±¡å±‚ï¼›</p><p><strong>å¸‚é¢ä¸Šçš„æ—¥å¿—æ¡†æ¶ï¼›</strong></p><p>JULã€JCLã€Jboss-loggingã€logbackã€log4jã€log4j2ã€slf4jâ€¦.</p><table><thead><tr><th>æ—¥å¿—é—¨é¢  ï¼ˆæ—¥å¿—çš„æŠ½è±¡å±‚ï¼‰</th><th>æ—¥å¿—å®ç°</th></tr></thead><tbody><tr><td><del>JCLï¼ˆJakarta  Commons Loggingï¼‰</del>    SLF4jï¼ˆSimple  Logging Facade for Javaï¼‰    <strong><del>jboss-logging</del></strong></td><td>Log4j  JULï¼ˆjava.util.loggingï¼‰  Log4j2  <strong>Logback</strong></td></tr></tbody></table><p>å·¦è¾¹é€‰ä¸€ä¸ªé—¨é¢ï¼ˆæŠ½è±¡å±‚ï¼‰ã€å³è¾¹æ¥é€‰ä¸€ä¸ªå®ç°ï¼›</p><p>æ—¥å¿—é—¨é¢ï¼š  SLF4Jï¼›</p><p>æ—¥å¿—å®ç°ï¼šLogbackï¼›</p><p>SpringBootï¼šåº•å±‚æ˜¯Springæ¡†æ¶ï¼ŒSpringæ¡†æ¶é»˜è®¤æ˜¯ç”¨JCLï¼›â€˜</p><p>â€‹    <strong>==SpringBooté€‰ç”¨ SLF4jå’Œlogbackï¼›==</strong></p><h2 id="2ã€SLF4jä½¿ç”¨"><a href="#2ã€SLF4jä½¿ç”¨" class="headerlink" title="2ã€SLF4jä½¿ç”¨"></a>2ã€SLF4jä½¿ç”¨</h2><h3 id="1ã€å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨SLF4j-https-www-slf4j-org"><a href="#1ã€å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨SLF4j-https-www-slf4j-org" class="headerlink" title="1ã€å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨SLF4j   https://www.slf4j.org"></a>1ã€å¦‚ä½•åœ¨ç³»ç»Ÿä¸­ä½¿ç”¨SLF4j   <a href="https://www.slf4j.org" target="_blank" rel="noopener">https://www.slf4j.org</a></h3><p>ä»¥åå¼€å‘çš„æ—¶å€™ï¼Œæ—¥å¿—è®°å½•æ–¹æ³•çš„è°ƒç”¨ï¼Œä¸åº”è¯¥æ¥ç›´æ¥è°ƒç”¨æ—¥å¿—çš„å®ç°ç±»ï¼Œè€Œæ˜¯è°ƒç”¨æ—¥å¿—æŠ½è±¡å±‚é‡Œé¢çš„æ–¹æ³•ï¼›</p><p>ç»™ç³»ç»Ÿé‡Œé¢å¯¼å…¥slf4jçš„jarå’Œ  logbackçš„å®ç°jar</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">import</span> org.slf4j.Logger;<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld</span> </span>&#123;  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;    Logger logger = LoggerFactory.getLogger(HelloWorld<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;    logger.info(<span class="hljs-string">"Hello World"</span>);  &#125;&#125;</code></pre></div><p>å›¾ç¤ºï¼›</p><p><img src="/2020/06/23/SpringBoot%E6%97%A5%E5%BF%97/concrete-bindings.png" srcset="/img/loading.gif" alt="images/concrete-bindings.png"></p><p>æ¯ä¸€ä¸ªæ—¥å¿—çš„å®ç°æ¡†æ¶éƒ½æœ‰è‡ªå·±çš„é…ç½®æ–‡ä»¶ã€‚ä½¿ç”¨slf4jä»¥åï¼Œ<strong>é…ç½®æ–‡ä»¶è¿˜æ˜¯åšæˆæ—¥å¿—å®ç°æ¡†æ¶è‡ªå·±æœ¬èº«çš„é…ç½®æ–‡ä»¶ï¼›</strong></p><h3 id="2ã€é—ç•™é—®é¢˜"><a href="#2ã€é—ç•™é—®é¢˜" class="headerlink" title="2ã€é—ç•™é—®é¢˜"></a>2ã€é—ç•™é—®é¢˜</h3><p>aï¼ˆslf4j+logbackï¼‰: Springï¼ˆcommons-loggingï¼‰ã€Hibernateï¼ˆjboss-loggingï¼‰ã€MyBatisã€xxxx</p><p>ç»Ÿä¸€æ—¥å¿—è®°å½•ï¼Œå³ä½¿æ˜¯åˆ«çš„æ¡†æ¶å’Œæˆ‘ä¸€èµ·ç»Ÿä¸€ä½¿ç”¨slf4jè¿›è¡Œè¾“å‡ºï¼Ÿ</p><p><img src="/2020/06/23/SpringBoot%E6%97%A5%E5%BF%97/legacy.png" srcset="/img/loading.gif" alt></p><p><strong>å¦‚ä½•è®©ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ—¥å¿—éƒ½ç»Ÿä¸€åˆ°slf4jï¼›</strong></p><p>==1ã€å°†ç³»ç»Ÿä¸­å…¶ä»–æ—¥å¿—æ¡†æ¶å…ˆæ’é™¤å‡ºå»ï¼›==</p><p>==2ã€ç”¨ä¸­é—´åŒ…æ¥æ›¿æ¢åŸæœ‰çš„æ—¥å¿—æ¡†æ¶ï¼›==</p><p>==3ã€æˆ‘ä»¬å¯¼å…¥slf4jå…¶ä»–çš„å®ç°==</p><h2 id="3ã€SpringBootæ—¥å¿—å…³ç³»"><a href="#3ã€SpringBootæ—¥å¿—å…³ç³»" class="headerlink" title="3ã€SpringBootæ—¥å¿—å…³ç³»"></a>3ã€SpringBootæ—¥å¿—å…³ç³»</h2><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>SpringBootä½¿ç”¨å®ƒæ¥åšæ—¥å¿—åŠŸèƒ½ï¼›</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>åº•å±‚ä¾èµ–å…³ç³»</p><p><img src="/2020/06/23/SpringBoot%E6%97%A5%E5%BF%97/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131220946.png" srcset="/img/loading.gif" alt></p><p>æ€»ç»“ï¼š</p><p>â€‹    1ï¼‰ã€SpringBootåº•å±‚ä¹Ÿæ˜¯ä½¿ç”¨slf4j+logbackçš„æ–¹å¼è¿›è¡Œæ—¥å¿—è®°å½•</p><p>â€‹    2ï¼‰ã€SpringBootä¹ŸæŠŠå…¶ä»–çš„æ—¥å¿—éƒ½æ›¿æ¢æˆäº†slf4jï¼›</p><p>â€‹    3ï¼‰ã€ä¸­é—´æ›¿æ¢åŒ…ï¼Ÿ</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SuppressWarnings</span>(<span class="hljs-string">"rawtypes"</span>)<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LogFactory</span> </span>&#123;    <span class="hljs-keyword">static</span> String UNSUPPORTED_OPERATION_IN_JCL_OVER_SLF4J = <span class="hljs-string">"http://www.slf4j.org/codes.html#unsupported_operation_in_jcl_over_slf4j"</span>;    <span class="hljs-keyword">static</span> LogFactory logFactory = <span class="hljs-keyword">new</span> SLF4JLogFactory();</code></pre></div><p><img src="/2020/06/23/SpringBoot%E6%97%A5%E5%BF%97/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20180131221411.png" srcset="/img/loading.gif" alt></p><p>â€‹    4ï¼‰ã€å¦‚æœæˆ‘ä»¬è¦å¼•å…¥å…¶ä»–æ¡†æ¶ï¼Ÿä¸€å®šè¦æŠŠè¿™ä¸ªæ¡†æ¶çš„é»˜è®¤æ—¥å¿—ä¾èµ–ç§»é™¤æ‰ï¼Ÿ</p><p>â€‹            Springæ¡†æ¶ç”¨çš„æ˜¯commons-loggingï¼›</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p><strong>==SpringBootèƒ½è‡ªåŠ¨é€‚é…æ‰€æœ‰çš„æ—¥å¿—ï¼Œè€Œä¸”åº•å±‚ä½¿ç”¨slf4j+logbackçš„æ–¹å¼è®°å½•æ—¥å¿—ï¼Œå¼•å…¥å…¶ä»–æ¡†æ¶çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠè¿™ä¸ªæ¡†æ¶ä¾èµ–çš„æ—¥å¿—æ¡†æ¶æ’é™¤æ‰å³å¯ï¼›==</strong></p><h2 id="4ã€æ—¥å¿—ä½¿ç”¨ï¼›"><a href="#4ã€æ—¥å¿—ä½¿ç”¨ï¼›" class="headerlink" title="4ã€æ—¥å¿—ä½¿ç”¨ï¼›"></a>4ã€æ—¥å¿—ä½¿ç”¨ï¼›</h2><h3 id="1ã€é»˜è®¤é…ç½®"><a href="#1ã€é»˜è®¤é…ç½®" class="headerlink" title="1ã€é»˜è®¤é…ç½®"></a>1ã€é»˜è®¤é…ç½®</h3><p>SpringBooté»˜è®¤å¸®æˆ‘ä»¬é…ç½®å¥½äº†æ—¥å¿—ï¼›</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//è®°å½•å™¨</span>Logger logger = LoggerFactory.getLogger(getClass());<span class="hljs-meta">@Test</span><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">contextLoads</span><span class="hljs-params">()</span> </span>&#123;<span class="hljs-comment">//System.out.println();</span><span class="hljs-comment">//æ—¥å¿—çš„çº§åˆ«ï¼›</span><span class="hljs-comment">//ç”±ä½åˆ°é«˜   trace&lt;debug&lt;info&lt;warn&lt;error</span><span class="hljs-comment">//å¯ä»¥è°ƒæ•´è¾“å‡ºçš„æ—¥å¿—çº§åˆ«ï¼›æ—¥å¿—å°±åªä¼šåœ¨è¿™ä¸ªçº§åˆ«ä»¥ä»¥åçš„é«˜çº§åˆ«ç”Ÿæ•ˆ</span>logger.trace(<span class="hljs-string">"è¿™æ˜¯traceæ—¥å¿—..."</span>);logger.debug(<span class="hljs-string">"è¿™æ˜¯debugæ—¥å¿—..."</span>);<span class="hljs-comment">//SpringBooté»˜è®¤ç»™æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯infoçº§åˆ«çš„ï¼Œæ²¡æœ‰æŒ‡å®šçº§åˆ«çš„å°±ç”¨SpringBooté»˜è®¤è§„å®šçš„çº§åˆ«ï¼›rootçº§åˆ«</span>logger.info(<span class="hljs-string">"è¿™æ˜¯infoæ—¥å¿—..."</span>);logger.warn(<span class="hljs-string">"è¿™æ˜¯warnæ—¥å¿—..."</span>);logger.error(<span class="hljs-string">"è¿™æ˜¯erroræ—¥å¿—..."</span>);&#125;</code></pre></div><div class="hljs"><pre><code class="hljs haml">  æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š<span class="hljs-tag">%<span class="hljs-selector-tag">d</span></span>è¡¨ç¤ºæ—¥æœŸæ—¶é—´ï¼Œ<span class="hljs-tag">%<span class="hljs-selector-tag">thread</span></span>è¡¨ç¤ºçº¿ç¨‹åï¼Œ<span class="hljs-tag">%</span>-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦<span class="hljs-tag">%<span class="hljs-selector-tag">logger</span>&#123;50&#125;</span> è¡¨ç¤ºloggeråå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²ã€‚ <span class="hljs-tag">%<span class="hljs-selector-tag">msg</span></span>ï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ<span class="hljs-tag">%<span class="hljs-selector-tag">n</span></span>æ˜¯æ¢è¡Œç¬¦  -<span class="ruby">-&gt;</span><span class="ruby">  %d&#123;yyyy-MM-dd <span class="hljs-symbol">HH:</span><span class="hljs-symbol">mm:</span>ss.SSS&#125; [%thread] <span class="hljs-string">%-5level %logger&#123;50&#125; -</span> %msg%n</span></code></pre></div><p>SpringBootä¿®æ”¹æ—¥å¿—çš„é»˜è®¤é…ç½®</p><div class="hljs"><pre><code class="hljs properties"><span class="hljs-meta">logging.level.com.atguigu</span>=<span class="hljs-string">trace</span><span class="hljs-comment">#logging.path=</span><span class="hljs-comment"># ä¸æŒ‡å®šè·¯å¾„åœ¨å½“å‰é¡¹ç›®ä¸‹ç”Ÿæˆspringboot.logæ—¥å¿—</span><span class="hljs-comment"># å¯ä»¥æŒ‡å®šå®Œæ•´çš„è·¯å¾„ï¼›</span><span class="hljs-comment">#logging.file=G:/springboot.log</span><span class="hljs-comment"># åœ¨å½“å‰ç£ç›˜çš„æ ¹è·¯å¾„ä¸‹åˆ›å»ºspringæ–‡ä»¶å¤¹å’Œé‡Œé¢çš„logæ–‡ä»¶å¤¹ï¼›ä½¿ç”¨Â spring.log ä½œä¸ºé»˜è®¤æ–‡ä»¶</span><span class="hljs-meta">logging.path</span>=<span class="hljs-string">/spring/log</span><span class="hljs-comment">#  åœ¨æ§åˆ¶å°è¾“å‡ºçš„æ—¥å¿—çš„æ ¼å¼</span><span class="hljs-meta">logging.pattern.console</span>=<span class="hljs-string">%d&#123;yyyy-MM-dd&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span><span class="hljs-comment"># æŒ‡å®šæ–‡ä»¶ä¸­æ—¥å¿—è¾“å‡ºçš„æ ¼å¼</span><span class="hljs-meta">logging.pattern.file</span>=<span class="hljs-string">%d&#123;yyyy-MM-dd&#125; === [%thread] === %-5level === %logger&#123;50&#125; ==== %msg%n</span></code></pre></div><table><thead><tr><th>logging.file</th><th>logging.path</th><th>Example</th><th>Description</th></tr></thead><tbody><tr><td>(none)</td><td>(none)</td><td></td><td>åªåœ¨æ§åˆ¶å°è¾“å‡º</td></tr><tr><td>æŒ‡å®šæ–‡ä»¶å</td><td>(none)</td><td>my.log</td><td>è¾“å‡ºæ—¥å¿—åˆ°my.logæ–‡ä»¶</td></tr><tr><td>(none)</td><td>æŒ‡å®šç›®å½•</td><td>/var/log</td><td>è¾“å‡ºåˆ°æŒ‡å®šç›®å½•çš„ spring.log æ–‡ä»¶ä¸­</td></tr></tbody></table><h3 id="2ã€æŒ‡å®šé…ç½®"><a href="#2ã€æŒ‡å®šé…ç½®" class="headerlink" title="2ã€æŒ‡å®šé…ç½®"></a>2ã€æŒ‡å®šé…ç½®</h3><p>ç»™ç±»è·¯å¾„ä¸‹æ”¾ä¸Šæ¯ä¸ªæ—¥å¿—æ¡†æ¶è‡ªå·±çš„é…ç½®æ–‡ä»¶å³å¯ï¼›SpringBootå°±ä¸ä½¿ç”¨ä»–é»˜è®¤é…ç½®çš„äº†</p><table><thead><tr><th>Logging System</th><th>Customization</th></tr></thead><tbody><tr><td>Logback</td><td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td></tr><tr><td>Log4j2</td><td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td></tr><tr><td>JDK (Java Util Logging)</td><td><code>logging.properties</code></td></tr></tbody></table><p>logback.xmlï¼šç›´æ¥å°±è¢«æ—¥å¿—æ¡†æ¶è¯†åˆ«äº†ï¼›</p><p><strong>logback-spring.xml</strong>ï¼šæ—¥å¿—æ¡†æ¶å°±ä¸ç›´æ¥åŠ è½½æ—¥å¿—çš„é…ç½®é¡¹ï¼Œç”±SpringBootè§£ææ—¥å¿—é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨SpringBootçš„é«˜çº§ProfileåŠŸèƒ½</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"staging"</span>&gt;</span>    <span class="hljs-comment">&lt;!-- configuration to be enabled when the "staging" profile is active --&gt;</span>  å¯ä»¥æŒ‡å®šæŸæ®µé…ç½®åªåœ¨æŸä¸ªç¯å¢ƒä¸‹ç”Ÿæ•ˆ<span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span></code></pre></div><p>å¦‚ï¼š</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"stdout"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span>        <span class="hljs-comment">&lt;!--</span><span class="hljs-comment">        æ—¥å¿—è¾“å‡ºæ ¼å¼ï¼š</span><span class="hljs-comment">%dè¡¨ç¤ºæ—¥æœŸæ—¶é—´ï¼Œ</span><span class="hljs-comment">%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ</span><span class="hljs-comment">%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦</span><span class="hljs-comment">%logger&#123;50&#125; è¡¨ç¤ºloggeråå­—æœ€é•¿50ä¸ªå­—ç¬¦ï¼Œå¦åˆ™æŒ‰ç…§å¥ç‚¹åˆ†å‰²ã€‚ </span><span class="hljs-comment">%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ</span><span class="hljs-comment">%næ˜¯æ¢è¡Œç¬¦</span><span class="hljs-comment">        --&gt;</span>        <span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.classic.PatternLayout"</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dev"</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ----&gt; [%thread] ---&gt; %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">springProfile</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"!dev"</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; ==== [%thread] ==== %-5level %logger&#123;50&#125; - %msg%n<span class="hljs-tag">&lt;/<span class="hljs-name">pattern</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">springProfile</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span></code></pre></div><p>å¦‚æœä½¿ç”¨logback.xmlä½œä¸ºæ—¥å¿—é…ç½®æ–‡ä»¶ï¼Œè¿˜è¦ä½¿ç”¨profileåŠŸèƒ½ï¼Œä¼šæœ‰ä»¥ä¸‹é”™è¯¯</p><p> <code>no applicable action for [springProfile]</code></p><h2 id="5ã€åˆ‡æ¢æ—¥å¿—æ¡†æ¶"><a href="#5ã€åˆ‡æ¢æ—¥å¿—æ¡†æ¶" class="headerlink" title="5ã€åˆ‡æ¢æ—¥å¿—æ¡†æ¶"></a>5ã€åˆ‡æ¢æ—¥å¿—æ¡†æ¶</h2><p>å¯ä»¥æŒ‰ç…§slf4jçš„æ—¥å¿—é€‚é…å›¾ï¼Œè¿›è¡Œç›¸å…³çš„åˆ‡æ¢ï¼›</p><p>slf4j+log4jçš„æ–¹å¼ï¼›</p><div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>logback-classic<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>ch.qos.logback<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j-over-slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>  <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><p>åˆ‡æ¢ä¸ºlog4j2</p><div class="hljs"><pre><code class="hljs xml">   <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span>                <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>                <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div><hr><h1 id><a href="#" class="headerlink" title></a></h1>]]></content>
    
    
    <categories>
      
      <category>æ—¥å¿—</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootè‡ªåŠ¨é…ç½®åŸç†</title>
    <link href="/2020/06/23/SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/"/>
    <url>/2020/06/23/SpringBoot%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="SpringBootè‡ªåŠ¨é…ç½®åŸç†"><a href="#SpringBootè‡ªåŠ¨é…ç½®åŸç†" class="headerlink" title="SpringBootè‡ªåŠ¨é…ç½®åŸç†"></a>SpringBootè‡ªåŠ¨é…ç½®åŸç†</h2><p>é…ç½®æ–‡ä»¶åˆ°åº•èƒ½å†™ä»€ä¹ˆï¼Ÿæ€ä¹ˆå†™ï¼Ÿè‡ªåŠ¨é…ç½®åŸç†ï¼›</p><p><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#common-application-properties" target="_blank" rel="noopener">é…ç½®æ–‡ä»¶èƒ½é…ç½®çš„å±æ€§å‚ç…§</a></p><h3 id="1ã€è‡ªåŠ¨é…ç½®åŸç†ï¼š"><a href="#1ã€è‡ªåŠ¨é…ç½®åŸç†ï¼š" class="headerlink" title="1ã€è‡ªåŠ¨é…ç½®åŸç†ï¼š"></a>1ã€<strong>è‡ªåŠ¨é…ç½®åŸç†ï¼š</strong></h3><p><strong>1ï¼‰ã€SpringBootå¯åŠ¨çš„æ—¶å€™åŠ è½½ä¸»é…ç½®ç±»ï¼Œå¼€å¯äº†è‡ªåŠ¨é…ç½®åŠŸèƒ½ ==@EnableAutoConfiguration==</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span> é‡Œé¢æœ‰ <span class="hljs-meta">@EnableAutoConfiguration</span></code></pre></div><p><strong>2ï¼‰ã€@EnableAutoConfiguration ä½œç”¨ï¼š</strong></p><ul><li><p>åˆ©ç”¨AutoConfigurationImportSelectorç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€äº›ç»„ä»¶</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@EnableAutoConfiguration</span> é‡Œé¢æœ‰ <span class="hljs-meta">@Import</span>(&#123;AutoConfigurationImportSelector<span class="hljs-class">.<span class="hljs-keyword">class</span>&#125;)</span></code></pre></div><p>â€‹</p></li><li><p>å¯ä»¥æŸ¥çœ‹selectImports()æ–¹æ³•çš„å†…å®¹ï¼›</p><div class="hljs"><pre><code class="hljs java">ç±»ä¸­æœ‰selectImportsæ–¹æ³•å…³é”®ä»£ç ï¼šList&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata,      attributes);è·å–å€™é€‰çš„é…ç½®</code></pre></div></li><li><p>SpringFactoriesLoader.loadFactoryNames()</p><div class="hljs"><pre><code class="hljs java">è¿›å…¥getCandidateConfigurationsæ–¹æ³•<span class="hljs-function"><span class="hljs-keyword">protected</span> List&lt;String&gt; <span class="hljs-title">getCandidateConfigurations</span><span class="hljs-params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;        List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="hljs-keyword">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="hljs-keyword">this</span>.getBeanClassLoader());        Assert.notEmpty(configurations, <span class="hljs-string">"No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct."</span>);        <span class="hljs-keyword">return</span> configurations;    &#125;    å†è¿›å…¥loadFactoryNamesæ–¹æ³•<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> List&lt;String&gt; <span class="hljs-title">loadFactoryNames</span><span class="hljs-params">(Class&lt;?&gt; factoryClass, @Nullable ClassLoader classLoader)</span> </span>&#123;        String factoryClassName = factoryClass.getName();        <span class="hljs-keyword">return</span> (List)loadSpringFactories(classLoader).getOrDefault(factoryClassName, Collections.emptyList());    &#125;   å†è¿›å…¥loadSpringFactoriesæ–¹æ³•å¯ä»¥çœ‹åˆ°æœ‰å…³é”®æ€§ä»£ç Enumeration&lt;URL&gt; urls = classLoader != <span class="hljs-keyword">null</span> ? classLoader.getResources(<span class="hljs-string">"META-INF/spring.factories"</span>) : ClassLoader.getSystemResources(<span class="hljs-string">"META-INF/spring.factories"</span>);<span class="hljs-keyword">while</span>(urls.hasMoreElements()) &#123;        URL url = (URL)urls.nextElement();        UrlResource resource = <span class="hljs-keyword">new</span> UrlResource(url);        Properties properties = PropertiesLoaderUtils.loadProperties(resource);       ï¼ˆè¿™å¤„ä»£ç æœ‰åˆ å‡ï¼Œæºç ç¯‡å¹…è¿‡é•¿ï¼‰    &#125;</code></pre></div><p>æ‰«ææ‰€æœ‰jaråŒ…ç±»è·¯å¾„ä¸‹  META-INF/spring.factories<br>æŠŠæ‰«æåˆ°çš„è¿™äº›æ–‡ä»¶çš„å†…å®¹åŒ…è£…æˆpropertieså¯¹è±¡</p><p>ä»propertiesä¸­è·å–åˆ°EnableAutoConfiguration.classç±»ï¼ˆç±»åï¼‰å¯¹åº”çš„å€¼ï¼Œç„¶åæŠŠä»–ä»¬æ·»åŠ åœ¨å®¹å™¨ä¸­</p><p>â€‹</p></li></ul><p><strong>==å°† ç±»è·¯å¾„ä¸‹  META-INF/spring.factories é‡Œé¢é…ç½®çš„æ‰€æœ‰EnableAutoConfigurationçš„å€¼åŠ å…¥åˆ°äº†å®¹å™¨ä¸­ï¼›==</strong></p><div class="hljs"><pre><code class="hljs properties"><span class="hljs-comment"># Auto Configure</span><span class="hljs-meta">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="hljs-string">\</span>org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\org.springframework.boot.autoconfigure.cloud.CloudAutoConfiguration,\org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration,\org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration,\org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration,\org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration,\org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration,\org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration,\org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration,\org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration,\org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration,\org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchAutoConfiguration,\org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration,\org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration,\org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\org.springframework.boot.autoconfigure.data.ldap.LdapDataAutoConfiguration,\org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration,\org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration,\org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration,\org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration,\org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration,\org.springframework.boot.autoconfigure.data.solr.SolrRepositoriesAutoConfiguration,\org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration,\org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration,\org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration,\org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration,\org.springframework.boot.autoconfigure.elasticsearch.jest.JestAutoConfiguration,\org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration,\org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration,\org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration,\org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration,\org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration,\org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration,\org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration,\org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration,\org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration,\org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration,\org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration,\org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration,\org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration,\org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration,\org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration,\org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration,\org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration,\org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration,\org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration,\org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration,\org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration,\org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration,\org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration,\org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration,\org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration,\org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration,\org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration,\org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration,\org.springframework.boot.autoconfigure.mobile.DeviceResolverAutoConfiguration,\org.springframework.boot.autoconfigure.mobile.DeviceDelegatingViewResolverAutoConfiguration,\org.springframework.boot.autoconfigure.mobile.SitePreferenceAutoConfiguration,\org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration,\org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration,\org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\org.springframework.boot.autoconfigure.reactor.ReactorAutoConfiguration,\org.springframework.boot.autoconfigure.security.SecurityAutoConfiguration,\org.springframework.boot.autoconfigure.security.SecurityFilterAutoConfiguration,\org.springframework.boot.autoconfigure.security.FallbackWebSecurityAutoConfiguration,\org.springframework.boot.autoconfigure.security.oauth2.OAuth2AutoConfiguration,\org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration,\org.springframework.boot.autoconfigure.session.SessionAutoConfiguration,\org.springframework.boot.autoconfigure.social.SocialWebAutoConfiguration,\org.springframework.boot.autoconfigure.social.FacebookAutoConfiguration,\org.springframework.boot.autoconfigure.social.LinkedInAutoConfiguration,\org.springframework.boot.autoconfigure.social.TwitterAutoConfiguration,\org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration,\org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration,\org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration,\org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration,\org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration,\org.springframework.boot.autoconfigure.web.DispatcherServletAutoConfiguration,\org.springframework.boot.autoconfigure.web.EmbeddedServletContainerAutoConfiguration,\org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration,\org.springframework.boot.autoconfigure.web.HttpEncodingAutoConfiguration,\org.springframework.boot.autoconfigure.web.HttpMessageConvertersAutoConfiguration,\org.springframework.boot.autoconfigure.web.MultipartAutoConfiguration,\org.springframework.boot.autoconfigure.web.ServerPropertiesAutoConfiguration,\org.springframework.boot.autoconfigure.web.WebClientAutoConfiguration,\org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration,\org.springframework.boot.autoconfigure.websocket.WebSocketAutoConfiguration,\org.springframework.boot.autoconfigure.websocket.WebSocketMessagingAutoConfiguration,\<span class="hljs-attr">org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration</span></code></pre></div><p>æ¯ä¸€ä¸ªè¿™æ ·çš„  xxxAutoConfigurationç±»éƒ½æ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼›ç”¨ä»–ä»¬æ¥åšè‡ªåŠ¨é…ç½®ï¼›</p><p><strong>3ï¼‰ã€æ¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»è¿›è¡Œè‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›</strong></p><p><strong>4ï¼‰ã€ä»¥</strong>HttpEncodingAutoConfigurationï¼ˆHttpç¼–ç è‡ªåŠ¨é…ç½®ï¼‰<strong>ä¸ºä¾‹è§£é‡Šè‡ªåŠ¨é…ç½®åŸç†ï¼›</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span>   <span class="hljs-comment">//è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œä»¥å‰ç¼–å†™çš„é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</span><span class="hljs-meta">@EnableConfigurationProperties</span>(HttpEncodingProperties<span class="hljs-class">.<span class="hljs-keyword">class</span>)  //å¯åŠ¨æŒ‡å®šç±»çš„<span class="hljs-title">ConfigurationProperties</span>åŠŸèƒ½ï¼›å°†é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„å€¼å’Œ<span class="hljs-title">HttpEncodingProperties</span>ç»‘å®šèµ·æ¥ï¼›å¹¶æŠŠ<span class="hljs-title">HttpEncodingProperties</span>åŠ å…¥åˆ°<span class="hljs-title">ioc</span>å®¹å™¨ä¸­</span><span class="hljs-class"></span><span class="hljs-class">@<span class="hljs-title">ConditionalOnWebApplication</span> //<span class="hljs-title">Spring</span>åº•å±‚@<span class="hljs-title">Conditional</span>æ³¨è§£ï¼ˆ<span class="hljs-title">Spring</span>æ³¨è§£ç‰ˆï¼‰ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æŒ‡å®šçš„æ¡ä»¶ï¼Œæ•´ä¸ªé…ç½®ç±»é‡Œé¢çš„é…ç½®å°±ä¼šç”Ÿæ•ˆï¼›    åˆ¤æ–­å½“å‰åº”ç”¨æ˜¯å¦æ˜¯<span class="hljs-title">web</span>åº”ç”¨ï¼Œå¦‚æœæ˜¯ï¼Œå½“å‰é…ç½®ç±»ç”Ÿæ•ˆ</span><span class="hljs-class"></span><span class="hljs-class">@<span class="hljs-title">ConditionalOnClass</span>(<span class="hljs-title">CharacterEncodingFilter</span>.<span class="hljs-title">class</span>)  //åˆ¤æ–­å½“å‰é¡¹ç›®æœ‰æ²¡æœ‰è¿™ä¸ªç±»<span class="hljs-title">CharacterEncodingFilter</span>ï¼›<span class="hljs-title">SpringMVC</span>ä¸­è¿›è¡Œä¹±ç è§£å†³çš„è¿‡æ»¤å™¨ï¼›</span><span class="hljs-class"></span><span class="hljs-class">@<span class="hljs-title">ConditionalOnProperty</span>(<span class="hljs-title">prefix</span> </span>= <span class="hljs-string">"spring.http.encoding"</span>, value = <span class="hljs-string">"enabled"</span>, matchIfMissing = <span class="hljs-keyword">true</span>)  <span class="hljs-comment">//åˆ¤æ–­é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé…ç½®  spring.http.encoding.enabledï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ¤æ–­ä¹Ÿæ˜¯æˆç«‹çš„</span><span class="hljs-comment">//å³ä½¿æˆ‘ä»¬é…ç½®æ–‡ä»¶ä¸­ä¸é…ç½®pring.http.encoding.enabled=trueï¼Œä¹Ÿæ˜¯é»˜è®¤ç”Ÿæ•ˆçš„ï¼›</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpEncodingAutoConfiguration</span> </span>&#123;    <span class="hljs-comment">//ä»–å·²ç»å’ŒSpringBootçš„é…ç½®æ–‡ä»¶æ˜ å°„äº†</span>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> HttpEncodingProperties properties;     <span class="hljs-comment">//åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨çš„æƒ…å†µä¸‹ï¼Œå‚æ•°çš„å€¼å°±ä¼šä»å®¹å™¨ä¸­æ‹¿</span>  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">HttpEncodingAutoConfiguration</span><span class="hljs-params">(HttpEncodingProperties properties)</span> </span>&#123;<span class="hljs-keyword">this</span>.properties = properties;&#125;      <span class="hljs-meta">@Bean</span>   <span class="hljs-comment">//ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶çš„æŸäº›å€¼éœ€è¦ä»propertiesä¸­è·å–</span><span class="hljs-meta">@ConditionalOnMissingBean</span>(CharacterEncodingFilter<span class="hljs-class">.<span class="hljs-keyword">class</span>) //åˆ¤æ–­å®¹å™¨æ²¡æœ‰è¿™ä¸ªç»„ä»¶ï¼Ÿ</span><span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">CharacterEncodingFilter</span> <span class="hljs-title">characterEncodingFilter</span>() </span>&#123;CharacterEncodingFilter filter = <span class="hljs-keyword">new</span> OrderedCharacterEncodingFilter();filter.setEncoding(<span class="hljs-keyword">this</span>.properties.getCharset().name());filter.setForceRequestEncoding(<span class="hljs-keyword">this</span>.properties.shouldForce(Type.REQUEST));filter.setForceResponseEncoding(<span class="hljs-keyword">this</span>.properties.shouldForce(Type.RESPONSE));<span class="hljs-keyword">return</span> filter;&#125;</code></pre></div><p>æ ¹æ®å½“å‰ä¸åŒçš„æ¡ä»¶åˆ¤æ–­ï¼Œå†³å®šè¿™ä¸ªé…ç½®ç±»æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ</p><p>ä¸€ä½†è¿™ä¸ªé…ç½®ç±»ç”Ÿæ•ˆï¼›è¿™ä¸ªé…ç½®ç±»å°±ä¼šç»™å®¹å™¨ä¸­æ·»åŠ å„ç§ç»„ä»¶ï¼›è¿™äº›ç»„ä»¶çš„å±æ€§æ˜¯ä»å¯¹åº”çš„propertiesç±»ä¸­è·å–çš„ï¼Œè¿™äº›ç±»é‡Œé¢çš„æ¯ä¸€ä¸ªå±æ€§åˆæ˜¯å’Œé…ç½®æ–‡ä»¶ç»‘å®šçš„ï¼›</p><p><strong>5ï¼‰ã€æ‰€æœ‰åœ¨é…ç½®æ–‡ä»¶ä¸­èƒ½é…ç½®çš„å±æ€§éƒ½æ˜¯åœ¨xxxxPropertiesç±»ä¸­å°è£…ç€ï¼›é…ç½®æ–‡ä»¶èƒ½é…ç½®ä»€ä¹ˆå°±å¯ä»¥å‚ç…§æŸä¸ªåŠŸèƒ½å¯¹åº”çš„è¿™ä¸ªå±æ€§ç±»</strong></p><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"spring.http.encoding"</span>)  <span class="hljs-comment">//ä»é…ç½®æ–‡ä»¶ä¸­è·å–æŒ‡å®šçš„å€¼å’Œbeançš„å±æ€§è¿›è¡Œç»‘å®š</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HttpEncodingProperties</span> </span>&#123;   <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Charset DEFAULT_CHARSET = Charset.forName(<span class="hljs-string">"UTF-8"</span>);</code></pre></div><p><strong>ç²¾é«“ï¼š</strong></p><p>â€‹    <strong>1ï¼‰ã€SpringBootå¯åŠ¨ä¼šåŠ è½½å¤§é‡çš„è‡ªåŠ¨é…ç½®ç±»</strong></p><p>â€‹    <strong>2ï¼‰ã€æˆ‘ä»¬çœ‹æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½æœ‰æ²¡æœ‰SpringBooté»˜è®¤å†™å¥½çš„è‡ªåŠ¨é…ç½®ç±»ï¼›</strong></p><p>â€‹    <strong>3ï¼‰ã€æˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­åˆ°åº•é…ç½®äº†å“ªäº›ç»„ä»¶ï¼›ï¼ˆåªè¦æˆ‘ä»¬è¦ç”¨çš„ç»„ä»¶æœ‰ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ¥é…ç½®äº†ï¼‰</strong></p><p>â€‹    <strong>4ï¼‰ã€ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç±»æ·»åŠ ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šä»propertiesç±»ä¸­è·å–æŸäº›å±æ€§ã€‚æˆ‘ä»¬å°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¿™äº›å±æ€§çš„å€¼ï¼›</strong></p><p>xxxxAutoConfigurartionï¼šè‡ªåŠ¨é…ç½®ç±»ï¼›</p><p>ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</p><p>xxxxProperties:å°è£…é…ç½®æ–‡ä»¶ä¸­ç›¸å…³å±æ€§ï¼›</p><h3 id="2ã€ç»†èŠ‚"><a href="#2ã€ç»†èŠ‚" class="headerlink" title="2ã€ç»†èŠ‚"></a>2ã€ç»†èŠ‚</h3><p><strong>1ã€@Conditionalæ´¾ç”Ÿæ³¨è§£ï¼ˆSpringæ³¨è§£ç‰ˆåŸç”Ÿçš„@Conditionalä½œç”¨ï¼‰</strong></p><p>ä½œç”¨ï¼šå¿…é¡»æ˜¯@ConditionalæŒ‡å®šçš„æ¡ä»¶æˆç«‹ï¼Œæ‰ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼Œé…ç½®é…é‡Œé¢çš„æ‰€æœ‰å†…å®¹æ‰ç”Ÿæ•ˆï¼›</p><table><thead><tr><th>@Conditionalæ‰©å±•æ³¨è§£</th><th>ä½œç”¨ï¼ˆåˆ¤æ–­æ˜¯å¦æ»¡è¶³å½“å‰æŒ‡å®šæ¡ä»¶ï¼‰</th></tr></thead><tbody><tr><td>@ConditionalOnJava</td><td>ç³»ç»Ÿçš„javaç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚</td></tr><tr><td>@ConditionalOnBean</td><td>å®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šBeanï¼›</td></tr><tr><td>@ConditionalOnMissingBean</td><td>å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šBeanï¼›</td></tr><tr><td>@ConditionalOnExpression</td><td>æ»¡è¶³SpELè¡¨è¾¾å¼æŒ‡å®š</td></tr><tr><td>@ConditionalOnClass</td><td>ç³»ç»Ÿä¸­æœ‰æŒ‡å®šçš„ç±»</td></tr><tr><td>@ConditionalOnMissingClass</td><td>ç³»ç»Ÿä¸­æ²¡æœ‰æŒ‡å®šçš„ç±»</td></tr><tr><td>@ConditionalOnSingleCandidate</td><td>å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªæŒ‡å®šçš„Beanï¼Œæˆ–è€…è¿™ä¸ªBeanæ˜¯é¦–é€‰Bean</td></tr><tr><td>@ConditionalOnProperty</td><td>ç³»ç»Ÿä¸­æŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼</td></tr><tr><td>@ConditionalOnResource</td><td>ç±»è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šèµ„æºæ–‡ä»¶</td></tr><tr><td>@ConditionalOnWebApplication</td><td>å½“å‰æ˜¯webç¯å¢ƒ</td></tr><tr><td>@ConditionalOnNotWebApplication</td><td>å½“å‰ä¸æ˜¯webç¯å¢ƒ</td></tr><tr><td>@ConditionalOnJndi</td><td>JNDIå­˜åœ¨æŒ‡å®šé¡¹</td></tr></tbody></table><p><strong>è‡ªåŠ¨é…ç½®ç±»å¿…é¡»åœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹æ‰èƒ½ç”Ÿæ•ˆï¼›</strong></p><p>æˆ‘ä»¬æ€ä¹ˆçŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆï¼›</p><p><strong>==æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯ç”¨  debug=trueå±æ€§ï¼›æ¥è®©æ§åˆ¶å°æ‰“å°è‡ªåŠ¨é…ç½®æŠ¥å‘Š==</strong>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„çŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆï¼›</p><div class="hljs"><pre><code class="hljs java">=========================AUTO-CONFIGURATION REPORT=========================Positive matches:ï¼ˆè‡ªåŠ¨é…ç½®ç±»å¯ç”¨çš„ï¼‰-----------------   DispatcherServletAutoConfiguration matched:      - <span class="hljs-meta">@ConditionalOnClass</span> found required <span class="hljs-class"><span class="hljs-keyword">class</span> '<span class="hljs-title">org</span>.<span class="hljs-title">springframework</span>.<span class="hljs-title">web</span>.<span class="hljs-title">servlet</span>.<span class="hljs-title">DispatcherServlet</span>'</span>; <span class="hljs-meta">@ConditionalOnMissingClass</span> <span class="hljs-function">did not find unwanted <span class="hljs-title">class</span> <span class="hljs-params">(OnClassCondition)</span></span><span class="hljs-function">      - @<span class="hljs-title">ConditionalOnWebApplication</span> <span class="hljs-params">(required)</span> found <span class="hljs-title">StandardServletEnvironment</span> <span class="hljs-params">(OnWebApplicationCondition)</span></span><span class="hljs-function">        </span><span class="hljs-function">    </span><span class="hljs-function">Negative matches:ï¼ˆæ²¡æœ‰å¯åŠ¨ï¼Œæ²¡æœ‰åŒ¹é…æˆåŠŸçš„è‡ªåŠ¨é…ç½®ç±»ï¼‰</span><span class="hljs-function">-----------------</span><span class="hljs-function"></span><span class="hljs-function">   ActiveMQAutoConfiguration:</span><span class="hljs-function">      Did not match:</span><span class="hljs-function">         - @ConditionalOnClass did not find required classes 'javax.jms.ConnectionFactory', 'org.apache.activemq.ActiveMQConnectionFactory' <span class="hljs-params">(OnClassCondition)</span></span><span class="hljs-function"></span><span class="hljs-function">   AopAutoConfiguration:</span><span class="hljs-function">      Did not match:</span><span class="hljs-function">         - @ConditionalOnClass did not find required classes 'org.aspectj.lang.annotation.Aspect', 'org.aspectj.lang.reflect.Advice' <span class="hljs-params">(OnClassCondition)</span></span></code></pre></div>]]></content>
    
    
    <categories>
      
      <category>æºç åˆ†æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç±»ä¸å®ä¾‹åˆå§‹åŒ–é¢è¯•é¢˜</title>
    <link href="/2020/06/22/%E7%B1%BB%E5%92%8C%E5%AE%9E%E4%BE%8B%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    <url>/2020/06/22/%E7%B1%BB%E5%92%8C%E5%AE%9E%E4%BE%8B%E5%88%9D%E5%A7%8B%E5%8C%96%E9%9D%A2%E8%AF%95%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="é¢è¯•é¢˜"><a href="#é¢è¯•é¢˜" class="headerlink" title="é¢è¯•é¢˜"></a>é¢è¯•é¢˜</h1><h2 id="ä»£ç å¦‚ä¸‹ï¼š"><a href="#ä»£ç å¦‚ä¸‹ï¼š" class="headerlink" title="ä»£ç å¦‚ä¸‹ï¼š"></a>ä»£ç å¦‚ä¸‹ï¼š</h2><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.jk.test;<span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-06-15  21:41</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Father</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> i = test();    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> j = method();    <span class="hljs-keyword">static</span> &#123;        System.out.print(<span class="hljs-string">"(1)"</span>);    &#125;    Father()&#123;        System.out.print(<span class="hljs-string">"(2)"</span>);    &#125;    &#123;        System.out.print(<span class="hljs-string">"(3)"</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> </span>&#123;        System.out.print(<span class="hljs-string">"(4)"</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">method</span><span class="hljs-params">()</span> </span>&#123;        System.out.print(<span class="hljs-string">"(5)"</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    &#125;&#125;<span class="hljs-keyword">package</span> com.jk.test;<span class="hljs-comment">/**</span><span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span><span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-06-15  21:41</span><span class="hljs-comment"> */</span><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Son</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Father</span> </span>&#123;    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> i = test();    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> j = method();    <span class="hljs-keyword">static</span> &#123;        System.out.print(<span class="hljs-string">"(6)"</span>);    &#125;    Son()&#123;        System.out.print(<span class="hljs-string">"(7)"</span>);    &#125;    &#123;        System.out.print(<span class="hljs-string">"(8)"</span>);    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">test</span><span class="hljs-params">()</span></span>&#123;        System.out.print(<span class="hljs-string">"(9)"</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">method</span><span class="hljs-params">()</span></span>&#123;        System.out.print(<span class="hljs-string">"(10)"</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;    &#125;    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;        Son son1 = <span class="hljs-keyword">new</span> Son();        System.out.println();        Son son2 = <span class="hljs-keyword">new</span> Son();    &#125;&#125;</code></pre></div><p>mainå‡½æ•°æ‰§è¡Œåï¼Œå¤§å®¶å¯ä»¥è¯•è¯•çœ‹è¾“å‡ºçš„é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ</p><h2 id="ç±»åˆå§‹åŒ–è¿‡ç¨‹"><a href="#ç±»åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="ç±»åˆå§‹åŒ–è¿‡ç¨‹"></a>ç±»åˆå§‹åŒ–è¿‡ç¨‹</h2><p>1ã€ä¸€ä¸ªç±»çš„åˆ›å»ºå®ä¾‹éœ€è¦å…ˆåŠ è½½å¹¶åˆå§‹åŒ–è¯¥ç±»<br>    - mainæ–¹æ³•æ‰€åœ¨çš„ç±»éœ€è¦å…ˆåŠ è½½å’Œåˆå§‹åŒ–<br>2ã€ä¸€ä¸ªå­ç±»è¦åˆå§‹åŒ–éœ€è¦å…ˆåˆå§‹åŒ–çˆ¶ç±»<br>3ã€ä¸€ä¸ªç±»åˆå§‹åŒ–å°±æ˜¯æ‰§è¡Œ&lt;clinit&gt;()æ–¹æ³•<br>    - &lt;clinit&gt;()æ–¹æ³•ç”±é™æ€ç±»å˜é‡æ˜¾ç¤ºèµ‹å€¼ä»£ç å’Œé™æ€ä»£ç å—ç»„æˆ</p><hr><p>å°±æ˜¯è¯´åœ¨mainæ–¹æ³•å¯åŠ¨çš„æ—¶å€™ï¼Œå°±ä¼šå»åˆå§‹åŒ–ç±»<br>å› ä¸ºåœ¨çˆ¶ç±»å’Œå­ç±»ä¸­éƒ½æœ‰é™æ€å˜é‡å’Œé™æ€ä»£ç å—ï¼Œé™æ€å˜é‡å’Œé™æ€ä»£ç å—é¡ºåºæ˜¯æ ¹æ®ä»£ç ä¹¦å†™çš„é¡ºåºæ‰§è¡Œçš„æ‰€ä»¥ï¼š<br>æ‰§è¡Œé¡ºåºä¸º ï¼ˆ5ï¼‰ï¼ˆ1ï¼‰ï¼ˆ10ï¼‰ï¼ˆ6ï¼‰</p><h2 id="å®ä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹"><a href="#å®ä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="å®ä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹"></a>å®ä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹</h2><p>å®ä¾‹åˆå§‹åŒ–å°±æ˜¯æ‰§è¡Œ&lt;init&gt;()æ–¹æ³•<br>    - &lt;init&gt;()æ–¹æ³•å¯èƒ½é‡è½½æœ‰å¤šä¸ªï¼Œæœ‰å‡ ä¸ªæ„é€ å™¨å°±æœ‰å‡ ä¸ª&lt;init&gt;()æ–¹æ³•<br>    - &lt;init&gt;()æ–¹æ³•ç”±éé™æ€å®ä¾‹å˜é‡æ˜¾ç¤ºèµ‹å€¼ä»£ç å’Œéé™æ€ä»£ç å—ã€å¯¹åº”æ„é€ å™¨ä»£ç ç»„æˆ<br>    - éé™æ€å®ä¾‹å˜é‡æ˜¾ç¤ºå¤åˆ¶ä»£ç å’Œéé™æ€ä»£ç å—ä»£ç ä»ä¸Šåˆ°ä¸‹é¡ºåºæ‰§è¡Œï¼Œè€Œå¯¹åº”æ„é€ å™¨çš„ä»£ç æœ€åæ‰§è¡Œ<br>    - æ¯æ¬¡åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œè°ƒç”¨å¯¹åº”æ„é€ å™¨ï¼Œæ‰§è¡Œçš„å°±æ˜¯å¯¹åº”çš„&lt;init&gt;()æ–¹æ³•<br>    - &lt;init&gt;()æ–¹æ³•çš„é¦–è¡Œæ˜¯super()æˆ–super(å®å‚åˆ—è¡¨)ï¼Œå³å¯¹åº”çˆ¶ç±»çš„&lt;init&gt;()æ–¹æ³•</p><hr><p>å°±æ˜¯è¯´åœ¨è°ƒç”¨æ„é€ å‡½æ•°è¿›è¡Œå®ä¾‹çš„åˆå§‹åŒ–æ—¶ï¼Œä¸ç®¡æœ‰æ²¡æœ‰superå…³é”®å­—ï¼Œéƒ½ä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨å…ˆè¿›è¡Œåˆå§‹åŒ–ï¼Œç„¶ååœ¨åˆå§‹åŒ–çˆ¶ç±»æ„é€ å™¨åï¼Œå†æ‰§è¡Œç±»ä¸­æ˜¾ç¤ºèµ‹å€¼ä»£ç å’Œéé™æ€ä»£ç å— æ¯”å¦‚Sonå­ç±»çš„ï¼š</p><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> i = test();&#123;        System.out.print(<span class="hljs-string">"(8)"</span>);&#125;<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">method</span><span class="hljs-params">()</span></span>&#123;        System.out.print(<span class="hljs-string">"(10)"</span>);        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;&#125;</code></pre></div><p>æœ€åæ‰æ˜¯Sonå­ç±»çš„æ„é€ å™¨</p><div class="hljs"><pre><code class="hljs java">Son()&#123;        System.out.print(<span class="hljs-string">"(7)"</span>);&#125;</code></pre></div><p>æ‰€æœ‰æ ¹æ®ä»¥ä¸Šçš„é¡ºåºå¾—å‡ºçš„å…¨éƒ¨é¡ºåºä¸º<br>ï¼ˆ5ï¼‰ï¼ˆ1ï¼‰ï¼ˆ10ï¼‰ï¼ˆ6ï¼‰ï¼ˆ4ï¼‰ï¼ˆ3ï¼‰ï¼ˆ2ï¼‰ï¼ˆ9ï¼‰ï¼ˆ8ï¼‰ï¼ˆ7ï¼‰<br>ï¼ˆ4ï¼‰ï¼ˆ3ï¼‰ï¼ˆ2ï¼‰ï¼ˆ9ï¼‰ï¼ˆ8ï¼‰ï¼ˆ7ï¼‰</p><p>ä»¥ä¸ºåˆ°è¿™é‡Œç»“æŸäº†å˜›ï¼Œå…¶å®è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå‘ï¼Œå°±æ˜¯å¤šæ€æ€§ï¼Œæ–¹æ³•çš„é‡å†™ï¼</p><h2 id="æ–¹æ³•çš„é‡å†™Override"><a href="#æ–¹æ³•çš„é‡å†™Override" class="headerlink" title="æ–¹æ³•çš„é‡å†™Override"></a>æ–¹æ³•çš„é‡å†™Override</h2><p>1ã€å“ªäº›æ–¹æ³•ä¸å¯ä»¥è¢«é‡å†™<br>    - finalæ–¹æ³•<br>    - é™æ€æ–¹æ³•<br>    - privateç­‰å­ç±»ä¸­ä¸å¯è§æ–¹æ³•<br>2ã€å¯¹è±¡çš„å¤šæ€æ€§<br>    - å­ç±»å¦‚æœé‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œé€šè¿‡å­ç±»å¯¹è±¡è°ƒç”¨çš„ä¸€å®šæ˜¯å­ç±»é‡å†™è¿‡çš„ä»£ç <br>    - éé™æ€æ–¹æ³•é»˜è®¤çš„è°ƒç”¨å¯¹è±¡æ˜¯this<br>    - thiså¯¹è±¡åœ¨æ„é€ å™¨æˆ–è€…è¯´<init>æ–¹æ³•ä¸­å°±æ˜¯æ­£åœ¨åˆ›å»ºçš„å¯¹è±¡</init></p><hr><p>ä¹Ÿå°±æ˜¯è¯´åœ¨åˆå§‹åŒ–çˆ¶ç±»å®ä¾‹æ—¶ï¼Œåˆå§‹åŒ–å˜é‡æ—¶å€™è°ƒç”¨testï¼ˆï¼‰æ–¹æ³•ï¼Œå› ä¸ºæ˜¯éé™æ€æ–¹æ³•ï¼Œæ‰€æœ‰é»˜è®¤è°ƒç”¨å¯¹è±¡thisï¼Œæ˜¯å½“å‰å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯Sonå¯¹è±¡ æ‰€ä»¥å®é™…æ‰§è¡Œçš„æ˜¯å­ç±»é‡å†™çš„æ–¹æ³•</p><p>æœ€ç»ˆçš„ç»“æœé¡ºåºä¸º<br><img src="https://img-blog.csdnimg.cn/2020061522493926.png" srcset="/img/loading.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br>ä¸€å¶çŸ¥ç§‹ï¼Œç©¿æ’äº†ç±»ä¸å®ä¾‹çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚<br>æ­¤æ–‡ç« æ ¹æ®å°šç¡…è°·è§†é¢‘åŠ ä¸Šä¸ªäººç†è§£ä¸å®è·µã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é¢è¯•é¢˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç±»ä¸å®ä¾‹åˆå§‹åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
