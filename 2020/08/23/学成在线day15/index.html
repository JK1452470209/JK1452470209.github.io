<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>å­¦æˆåœ¨çº¿day15ï¼šåª’èµ„ç®¡ç†ç³»ç»Ÿé›†æˆ - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ç§äººåšå®¢</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äºæˆ‘
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-23 10:53">
      2020-08-23
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.5k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      111
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p>
</blockquote>
<p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day15</code> çš„å†…å®¹</p>
<ul>
<li>æ ¹æ® <code>è¯¾ç¨‹ID</code> æœç´¢è¯¥è¯¾ç¨‹å·²å‘å¸ƒçš„è¯¾ç¨‹ä¿¡æ¯ï¼Œå¹¶è¿”å›è¯¥è¯¾ç¨‹çš„æ‰€æœ‰è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯ã€‚</li>
<li>å°†æŒ‡å®šè¯¾ç¨‹ <code>å‘å¸ƒæ—¶</code> æ‰€çš„è¯¾ç¨‹è®¡åˆ’çš„åª’èµ„ä¿¡æ¯ä¿å­˜åˆ° <code>teachplan_media_publish</code> è¡¨ä¸­ï¼Œ</li>
<li>æ ¹æ® <code>è¯¾ç¨‹è®¡åˆ’id</code> æœç´¢è¯¥è¯¾ç¨‹è®¡åˆ’æ‰€å¯¹åº”çš„åª’èµ„ä¿¡æ¯ï¼Œéœ€è¦ç”¨åˆ°çš„æ˜¯è¯¥è¯¾ç¨‹è®¡åˆ’å¯¹åº”çš„ <code>m3u8</code> åœ°å€ï¼Œç”¨äºåœ¨çº¿æ’­æ”¾è§†é¢‘ï¼Œè¯¥æ¥å£åœ¨è¯¾ç¨‹ç®¡ç†æœåŠ¡ä¸­å¼€å‘ï¼Œä¾›å­¦ä¹ æœåŠ¡è¿›è¡Œè¿œç¨‹è°ƒç”¨ã€‚</li>
<li>åœ¨å­¦ä¹ æœåŠ¡ä¸­è¿œç¨‹è°ƒç”¨ è¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯æŸ¥è¯¢æ¥å£ï¼Œè·å–è¯¥è¯¾ç¨‹è®¡åˆ’çš„è§†é¢‘æ’­æ”¾çš„ <code>m3u8</code> urlåœ°å€ï¼Œå¹¶è¿”å›ç»™å‰ç«¯ï¼Œå‰ç«¯ä½¿ç”¨è¯¥ <code>url</code> è¿›è¡Œè§†é¢‘çš„åœ¨çº¿æ’­æ”¾ã€‚</li>
<li>åœ¨çº¿å­¦ä¹ å®Œæ•´çš„æµ‹è¯•æµç¨‹ï¼šåª’èµ„ä¿¡æ¯çš„ä¸Šä¼ ã€é€‰æ‹©ã€å‘å¸ƒåˆ°å‰ç«¯é—¨æˆ·ã€æœç´¢é—¨æˆ·æµ‹è¯•ï¼Œåœ¨çº¿å­¦ä¹ çš„æ’­æ”¾è§†é¢‘ã€‚</li>
</ul>
<h1 id="ä¸€ã€å­¦ä¹ é¡µé¢ï¼šæŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’"><a href="#ä¸€ã€å­¦ä¹ é¡µé¢ï¼šæŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’" class="headerlink" title="ä¸€ã€å­¦ä¹ é¡µé¢ï¼šæŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’"></a>ä¸€ã€å­¦ä¹ é¡µé¢ï¼šæŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²å¯ä»¥ç¼–è¾‘è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯å¹¶ä¸Šä¼ è¯¾ç¨‹è§†é¢‘ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬è¦å®ç°åœ¨çº¿å­¦ä¹ é¡µé¢åŠ¨æ€è¯»å–ç« èŠ‚å¯¹åº”çš„è§†é¢‘å¹¶è¿›è¡Œæ’­æ”¾ã€‚åœ¨çº¿å­¦ä¹ é¡µé¢æ‰€éœ€è¦çš„ä¿¡æ¯æœ‰ä¸¤ç±»ï¼š</p>
<ul>
<li>è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯</li>
<li>è¯¾ç¨‹å­¦ä¹ ä¿¡æ¯ï¼ˆè§†é¢‘åœ°å€ã€å­¦ä¹ è¿›åº¦ç­‰ï¼‰</li>
</ul>
<p>å¦‚ä¸‹å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image1" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image1.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>åœ¨çº¿å­¦ä¹ é›†æˆåª’èµ„ç®¡ç†çš„éœ€æ±‚å¦‚ä¸‹ï¼š</p>
<p>1ã€åœ¨çº¿å­¦ä¹ é¡µé¢æ˜¾ç¤ºè¯¾ç¨‹è®¡åˆ’</p>
<p>2ã€ç‚¹å‡»è¯¾ç¨‹è®¡åˆ’æ’­æ”¾è¯¥è¯¾ç¨‹è®¡åˆ’å¯¹åº”çš„è§†é¢‘</p>
<p>æœ¬ç« èŠ‚å®ç°å­¦ä¹ é¡µé¢åŠ¨æ€æ˜¾ç¤ºè¯¾ç¨‹è®¡åˆ’ï¼Œè¿›å…¥ä¸åŒè¯¾ç¨‹çš„å­¦ä¹ é¡µé¢å³ä¾§åŠ¨æ€æ˜¾ç¤ºå½“å‰è¯¾ç¨‹çš„è¯¾ç¨‹è®¡åˆ’ã€‚</p>
<h2 id="2-Apiæ¥å£"><a href="#2-Apiæ¥å£" class="headerlink" title="2. Apiæ¥å£"></a>2. Apiæ¥å£</h2><p>è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯ä»å“ªé‡Œè·å–ï¼Ÿ</p>
<p>åœ¨è¯¾ç¨‹å‘å¸ƒå®Œæˆåä¼šè‡ªåŠ¨å‘å¸ƒåˆ°ä¸€ä¸ª <code>course_pub</code> çš„è¡¨ä¸­ï¼Œ<code>logstash</code> ä¼šè‡ªåŠ¨å°†è¯¾ç¨‹å‘å¸ƒåçš„ä¿¡æ¯è‡ªåŠ¨é‡‡é›†åˆ° <code>ES</code> ç´¢å¼•åº“ä¸­ï¼Œè¿™äº›ä¿¡æ¯ä¹ŸåŒ…å«è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯ã€‚</p>
<p>æ‰€ä»¥è€ƒè™‘æ€§èƒ½è¦æ±‚ï¼Œè¯¾ç¨‹å‘å¸ƒåå¯¹è¯¾ç¨‹çš„æŸ¥è¯¢ç»Ÿä¸€ä» <code>ES</code> ç´¢å¼•åº“ä¸­æŸ¥è¯¢ã€‚</p>
<p>å‰ç«¯é€šè¿‡è¯·æ±‚ <code>æœç´¢æœåŠ¡</code> è·å–è¯¾ç¨‹ä¿¡æ¯ï¼Œéœ€è¦å•ç‹¬åœ¨ <code>æœç´¢æœåŠ¡</code> ä¸­å®šä¹‰è¯¾ç¨‹ä¿¡æ¯æŸ¥è¯¢æ¥å£ã€‚<br>æœ¬æ¥å£æ¥æ”¶è¯¾ç¨‹idï¼ŒæŸ¥è¯¢è¯¾ç¨‹æ‰€æœ‰ä¿¡æ¯è¿”å›ç»™å‰ç«¯ã€‚</p>
<p>æˆ‘ä»¬åœ¨æœç´ æœåŠ¡ <code>API</code> ä¸‹æ·»åŠ ä»¥ä¸‹æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æ ¹æ®idæœç´¢è¯¾ç¨‹å‘å¸ƒä¿¡æ¯"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String,CoursePub&gt; <span class="hljs-title">getdetail</span><span class="hljs-params">(String id)</span></span>;</code></pre></div>

<p>è¿”å›çš„è¯¾ç¨‹ä¿¡æ¯ä¸º <code>json</code> ç»“æ„ï¼š<code>key</code> ä¸ºè¯¾ç¨‹idï¼Œ<code>value</code> ä¸ºè¯¾ç¨‹å†…å®¹ã€‚</p>
<h2 id="3-æœåŠ¡ç«¯å¼€å‘"><a href="#3-æœåŠ¡ç«¯å¼€å‘" class="headerlink" title="3. æœåŠ¡ç«¯å¼€å‘"></a>3. æœåŠ¡ç«¯å¼€å‘</h2><p>åœ¨æœç´¢æœåŠ¡ä¸­å¼€å‘æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æ¥å£ã€‚</p>
<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><p>åœ¨æœç´ æœåŠ¡ä¸‹æ·»åŠ ä»¥ä¸‹æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æ ¹æ®idæœç´¢è¯¾ç¨‹å‘å¸ƒä¿¡æ¯</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id è¯¾ç¨‹id</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONæ•°æ®</span>
<span class="hljs-comment">     */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/getdetail/&#123;id&#125;"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, CoursePub&gt; <span class="hljs-title">getdetail</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span>String id) </span>&#123;
    <span class="hljs-keyword">return</span> esCourseService.getdetail(id);
&#125;</code></pre></div>

<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æ ¹æ®idæœç´¢è¯¾ç¨‹å‘å¸ƒä¿¡æ¯</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> id è¯¾ç¨‹id</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span> JSONæ•°æ®</span>
<span class="hljs-comment">     */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, CoursePub&gt; <span class="hljs-title">getdetail</span><span class="hljs-params">(String id)</span> </span>&#123;
    <span class="hljs-comment">//è®¾ç½®ç´¢å¼•</span>
    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(es_index);
    <span class="hljs-comment">//è®¾ç½®ç±»å‹</span>
    searchRequest.types(es_type);
    <span class="hljs-comment">//åˆ›å»ºæœç´¢æºå¯¹è±¡</span>
    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();

    <span class="hljs-comment">//è®¾ç½®æŸ¥è¯¢æ¡ä»¶,æ ¹æ®idè¿›è¡ŒæŸ¥è¯¢</span>
    searchSourceBuilder.query(QueryBuilders.termQuery(<span class="hljs-string">"id"</span>,id));
    <span class="hljs-comment">//è¿™é‡Œä¸ä½¿ç”¨sourceçš„åŸå­—æ®µè¿‡æ»¤,æŸ¥è¯¢æ‰€æœ‰å­—æ®µ</span>
    <span class="hljs-comment">// searchSourceBuilder.fetchSource(new String[]&#123;"name", "grade", "charge","pic"&#125;, newString[]&#123;&#125;);</span>

    <span class="hljs-comment">//è®¾ç½®æœç´¢æºå¯¹è±¡</span>
    searchRequest.source(searchSourceBuilder);

    <span class="hljs-comment">//æ‰§è¡Œæœç´¢</span>
    SearchResponse searchResponse = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">try</span> &#123;
        searchResponse = restHighLevelClient.search(searchRequest);
    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
        e.printStackTrace();
    &#125;
    <span class="hljs-comment">//è·å–æœç´¢ç»“æœ</span>
    SearchHits hits = searchResponse.getHits();
    SearchHit[] searchHits = hits.getHits(); <span class="hljs-comment">//è·å–æœ€ä¼˜ç»“æœ</span>
    Map&lt;String,CoursePub&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    <span class="hljs-keyword">for</span> (SearchHit hit: searchHits) &#123;
        <span class="hljs-comment">//ä»æœç´¢ç»“æœä¸­å–å€¼å¹¶æ·»åŠ åˆ°coursePubå¯¹è±¡</span>
        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();
        String courseId = (String) sourceAsMap.get(<span class="hljs-string">"id"</span>);
        String name = (String) sourceAsMap.get(<span class="hljs-string">"name"</span>);
        String grade = (String) sourceAsMap.get(<span class="hljs-string">"grade"</span>);
        String charge = (String) sourceAsMap.get(<span class="hljs-string">"charge"</span>);
        String pic = (String) sourceAsMap.get(<span class="hljs-string">"pic"</span>);
        String description = (String) sourceAsMap.get(<span class="hljs-string">"description"</span>);
        String teachplan = (String) sourceAsMap.get(<span class="hljs-string">"teachplan"</span>);
        CoursePub coursePub = <span class="hljs-keyword">new</span> CoursePub();
        coursePub.setId(courseId);
        coursePub.setName(name);
        coursePub.setPic(pic);
        coursePub.setGrade(grade);
        coursePub.setTeachplan(teachplan);
        coursePub.setDescription(description);
        <span class="hljs-comment">//è®¾ç½®mapå¯¹è±¡</span>
        map.put(courseId,coursePub);
    &#125;
    <span class="hljs-keyword">return</span> map;
&#125;</code></pre></div>

<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ä½¿ç”¨ <code>swagger-ui</code> æˆ– <code>postman</code> æµ‹è¯•æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯æ¥å£ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image2" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image2.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="4-å‰ç«¯å¼€å‘"><a href="#4-å‰ç«¯å¼€å‘" class="headerlink" title="4. å‰ç«¯å¼€å‘"></a>4. å‰ç«¯å¼€å‘</h2><h3 id="é…ç½®NGINXè™šæ‹Ÿä¸»æœº"><a href="#é…ç½®NGINXè™šæ‹Ÿä¸»æœº" class="headerlink" title="é…ç½®NGINXè™šæ‹Ÿä¸»æœº"></a>é…ç½®NGINXè™šæ‹Ÿä¸»æœº</h3><p>å­¦ä¹ ä¸­å¿ƒçš„äºŒçº§åŸŸåä¸º <code>ucenter.xuecheng.com</code> ï¼Œæˆ‘ä»¬åœ¨ <code>nginx</code> ä¸­é…ç½® <code>ucenter</code> è™šæ‹Ÿä¸»æœºã€‚</p>
<div class="hljs"><pre><code class="hljs c">#å­¦æˆç½‘ç”¨æˆ·ä¸­å¿ƒ
server &#123;
    <span class="hljs-built_in">listen</span> <span class="hljs-number">80</span>;
    server_name ucenter.xuecheng.com;
    #ä¸ªäººä¸­å¿ƒ
    location / &#123;
        proxy_pass http:<span class="hljs-comment">//ucenter_server_pool;</span>
    &#125;
&#125; 
#å‰ç«¯ucenter
upstream ucenter_server_pool&#123;
    <span class="hljs-meta">#server 127.0.0.1:7081 weight=10;</span>
    server <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">13000</span> weight=<span class="hljs-number">10</span>;
&#125;</code></pre></div>

<p>åœ¨å­¦ä¹ ä¸­å¿ƒè¦è°ƒç”¨æœç´¢çš„ <code>API</code>ï¼Œä½¿ç”¨ <code>Nginx</code> è§£å†³ä»£ç†ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image3" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image3.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>åœ¨ <code>ucenter</code> è™šæ‹Ÿä¸»æœºä¸‹é…ç½®æœç´¢ <code>Api</code> ä»£ç†è·¯å¾„</p>
<div class="hljs"><pre><code class="hljs java">#åå°æœç´¢ï¼ˆå…¬å¼€apiï¼‰
upstream search_server_pool&#123;
    server <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">40100</span> weight=<span class="hljs-number">10</span>;
&#125; 
#å­¦æˆç½‘ç”¨æˆ·ä¸­å¿ƒ
server &#123;
    listen <span class="hljs-number">80</span>;
    server_name ucenter.xuecheng.com;
    #ä¸ªäººä¸­å¿ƒ
        location / &#123;
        proxy_pass http:<span class="hljs-comment">//ucenter_server_pool;</span>
    &#125;
    #åç«¯æœç´¢æœåŠ¡
        location /openapi/search/ &#123;
        proxy_pass http:<span class="hljs-comment">//search_server_pool/search/;</span>
    &#125;
&#125;</code></pre></div>

<h3 id="å‰ç«¯-API-æ–¹æ³•"><a href="#å‰ç«¯-API-æ–¹æ³•" class="headerlink" title="å‰ç«¯ API æ–¹æ³•"></a>å‰ç«¯ API æ–¹æ³•</h3><p>åœ¨å­¦ä¹ ä¸­å¿ƒ <code>xc-ui-pc-leanring</code> å¯¹è¯¾ç¨‹ä¿¡æ¯çš„æŸ¥è¯¢å±äºåŸºç¡€å¸¸ç”¨åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¯¾ç¨‹æŸ¥è¯¢çš„ <code>api</code> æ–¹æ³•å®šä¹‰åœ¨<code>base</code> æ¨¡å—ä¸‹ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image4" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image4.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>åœ¨<code>system.js</code> ä¸­å®šä¹‰è¯¾ç¨‹æŸ¥è¯¢æ–¹æ³•ï¼š</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> http <span class="hljs-keyword">from</span> <span class="hljs-string">'./public'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> course_view = <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> &#123;
	<span class="hljs-keyword">return</span> http.requestGet(<span class="hljs-string">'/openapi/search/course/getdetail/'</span>+id);
&#125;</code></pre></div>

<h3 id="å‰ç«¯-API-æ–¹æ³•è°ƒç”¨"><a href="#å‰ç«¯-API-æ–¹æ³•è°ƒç”¨" class="headerlink" title="å‰ç«¯ API æ–¹æ³•è°ƒç”¨"></a>å‰ç«¯ API æ–¹æ³•è°ƒç”¨</h3><p>åœ¨ <code>learning_video.vue</code> é¡µé¢ä¸­è°ƒç”¨è¯¾ç¨‹ä¿¡æ¯æŸ¥è¯¢æ¥å£å¾—åˆ°è¯¾ç¨‹è®¡åˆ’ï¼Œå°†è¯¾ç¨‹è®¡åˆ’<code>json</code> ä¸²è½¬æˆå¯¹è±¡ã€‚</p>
<blockquote>
<p>xc-ui-pc-leanring/src/module/course/page/learning_video.vue</p>
</blockquote>
<p>1ã€å®šä¹‰è§†å›¾</p>
<p>è¯¾ç¨‹è®¡åˆ’</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--è¯¾ç¨‹è®¡åˆ’éƒ¨åˆ†ä»£ç --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"navCont"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"course-weeklist"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"nav nav-stacked"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(teachplan_first, index) in teachplanList"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"tit nav-justified text-center"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pull-left glyphicon glyphicon-th-list"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>&#123;&#123;teachplan_first.pname&#125;&#125;<span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"pull-right"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">li</span>   <span class="hljs-attr">v-if</span>=<span class="hljs-string">"teachplan_first.children!=null"</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(teachplan_second, index) in teachplan_first.children"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glyphicon glyphicon-check"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">"url"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"study(teachplan_second.id)"</span>&gt;</span>
                    &#123;&#123;teachplan_second.pname&#125;&#125;
                <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- &lt;div class="tit nav-justified text-center"&gt;&lt;i class="pull-left glyphicon glyphicon-th-list"&gt;&lt;/i&gt;ç¬¬ä¸€ç« &lt;i class="pull-right"&gt;&lt;/i&gt;&lt;/div&gt;</span>
<span class="hljs-comment">&lt;li  &gt;&lt;i class="glyphicon glyphicon-check"&gt;&lt;/i&gt;</span>
<span class="hljs-comment">&lt;a :href="url" &gt;</span>
<span class="hljs-comment">ç¬¬ä¸€èŠ‚</span>
<span class="hljs-comment">&lt;/a&gt;</span>
<span class="hljs-comment">&lt;/li&gt;--&gt;</span>
            <span class="hljs-comment">&lt;!--&lt;li&gt;&lt;i class="glyphicon glyphicon-unchecked"&gt;&lt;/i&gt;ä¸ºä»€ä¹ˆåˆ†ä¸ºAã€Bã€Céƒ¨åˆ†&lt;/li&gt;--&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>

<p>è¯¾ç¨‹åç§°</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"top text-center"</span>&gt;</span>
&#123;&#123;coursename&#125;&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>

<p>å®šä¹‰æ•°æ®å¯¹è±¡</p>
<div class="hljs"><pre><code class="hljs js">data() &#123;
    <span class="hljs-keyword">return</span> &#123;
        url:<span class="hljs-string">''</span>,<span class="hljs-comment">//å½“å‰url</span>
        courseId:<span class="hljs-string">''</span>,<span class="hljs-comment">//è¯¾ç¨‹id</span>
        chapter:<span class="hljs-string">''</span>,<span class="hljs-comment">//ç« èŠ‚Id</span>
        coursename:<span class="hljs-string">''</span>,<span class="hljs-comment">//è¯¾ç¨‹åç§°</span>
        coursepic:<span class="hljs-string">''</span>,<span class="hljs-comment">//è¯¾ç¨‹å›¾ç‰‡</span>
        teachplanList:[],<span class="hljs-comment">//è¯¾ç¨‹è®¡åˆ’</span>
        playerOptions: &#123;<span class="hljs-comment">//æ’­æ”¾å‚æ•°</span>
            autoplay: <span class="hljs-literal">false</span>,
            controls: <span class="hljs-literal">true</span>,
            sources: [&#123;
                type: <span class="hljs-string">"application/x-mpegURL"</span>,
                src: <span class="hljs-string">''</span>
            &#125;]
        &#125;,
    &#125;
&#125;</code></pre></div>

<p>åœ¨ <code>created</code> é’©å­æ–¹æ³•ä¸­è·å–è¯¾ç¨‹ä¿¡æ¯</p>
<div class="hljs"><pre><code class="hljs js">created()&#123;
    <span class="hljs-comment">//å½“å‰è¯·æ±‚çš„url</span>
    <span class="hljs-keyword">this</span>.url = <span class="hljs-built_in">window</span>.location
    <span class="hljs-comment">//è¯¾ç¨‹id</span>
    <span class="hljs-keyword">this</span>.courseId = <span class="hljs-keyword">this</span>.$route.params.courseId
    <span class="hljs-comment">//ç« èŠ‚id</span>
    <span class="hljs-keyword">this</span>.chapter = <span class="hljs-keyword">this</span>.$route.params.chapter
    <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span>
    systemApi.course_view(<span class="hljs-keyword">this</span>.courseId).then(<span class="hljs-function">(<span class="hljs-params">view_course</span>)=&gt;</span>&#123;
        <span class="hljs-keyword">if</span>(!view_course || !view_course[<span class="hljs-keyword">this</span>.courseId])&#123;
            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"è·å–è¯¾ç¨‹ä¿¡æ¯å¤±è´¥ï¼Œè¯·é‡æ–°è¿›å…¥æ­¤é¡µé¢ï¼"</span>)
            <span class="hljs-keyword">return</span> ;
        &#125; 
        <span class="hljs-keyword">let</span> courseInfo = view_course[<span class="hljs-keyword">this</span>.courseId]
        <span class="hljs-built_in">console</span>.log(courseInfo)
        <span class="hljs-keyword">this</span>.coursename = courseInfo.name
        <span class="hljs-keyword">if</span>(courseInfo.teachplan)&#123;
            <span class="hljs-keyword">let</span> teachplan = <span class="hljs-built_in">JSON</span>.parse(courseInfo.teachplan);
            <span class="hljs-keyword">this</span>.teachplanList = teachplan.children;
        &#125;
    &#125;)
&#125;,</code></pre></div>

<h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>åœ¨æµè§ˆå™¨è¯·æ±‚ï¼š<a href="http://ucenter.xuecheng.com/#/learning/4028e581617f945f01617f9dabc40000/0" target="_blank" rel="noopener">http://ucenter.xuecheng.com/#/learning/4028e581617f945f01617f9dabc40000/0</a></p>
<ul>
<li><code>4028e581617f945f01617f9dabc40000</code>ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¯¾ç¨‹ <code>id</code>ï¼Œæµ‹è¯•æ—¶ä» <code>ES</code>ç´¢å¼•åº“æ‰¾ä¸€ä¸ªè¯¾ç¨‹ <code>id</code></li>
<li>0ï¼šç¬¬äºŒä¸ªå‚æ•°ä¸ºè¯¾ç¨‹è®¡åˆ’ <code>id</code>ï¼Œæ­¤å‚æ•°ç”¨äºç‚¹å‡»è¯¾ç¨‹è®¡åˆ’æ’­æ”¾è§†é¢‘ã€‚</li>
</ul>
<p><a href="https://qnoss.codeyee.com/20200704_15/image5" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image5.png" srcset="/img/loading.gif" alt="img"></a></p>
<blockquote>
<p>å¦‚æœå‡ºç°è·¨åŸŸé—®é¢˜ï¼Œä½†æ˜¯ç¡®å®šå·²ç»é…ç½®äº†è·¨åŸŸï¼Œè¯·å°è¯•ç»“æŸæ‰€ä»¥ nginx.exe çš„è¿›ç¨‹ å’Œ æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜ã€‚</p>
<p>å¦‚æœè¿˜æ²¡æœ‰è§£å†³ï¼Ÿé‡å¯ç”µè„‘è¯•è¯•ã€‚</p>
</blockquote>
<h1 id="äºŒã€å­¦ä¹ é¡µé¢ï¼šè·å–è§†é¢‘æ’­æ”¾åœ°å€"><a href="#äºŒã€å­¦ä¹ é¡µé¢ï¼šè·å–è§†é¢‘æ’­æ”¾åœ°å€" class="headerlink" title="äºŒã€å­¦ä¹ é¡µé¢ï¼šè·å–è§†é¢‘æ’­æ”¾åœ°å€"></a>äºŒã€å­¦ä¹ é¡µé¢ï¼šè·å–è§†é¢‘æ’­æ”¾åœ°å€</h1><h2 id="1-éœ€æ±‚åˆ†æ-1"><a href="#1-éœ€æ±‚åˆ†æ-1" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>ç”¨æˆ·è¿›å…¥åœ¨çº¿å­¦ä¹ é¡µé¢ï¼Œç‚¹å‡»è¯¾ç¨‹è®¡åˆ’å°†æ’­æ”¾è¯¥è¯¾ç¨‹è®¡åˆ’å¯¹åº”çš„æ•™å­¦è§†é¢‘ã€‚</p>
<p>ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image6" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image6.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¸šåŠ¡æµç¨‹è¯´æ˜ï¼š</p>
<p>1ã€ç”¨æˆ·è¿›å…¥åœ¨çº¿å­¦ä¹ é¡µé¢ï¼Œé¡µé¢è¯·æ±‚æœç´¢æœåŠ¡è·å–è¯¾ç¨‹ä¿¡æ¯ï¼ˆåŒ…æ‹¬è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯ï¼‰å¹¶ä¸”åœ¨é¡µé¢å±•ç¤ºã€‚</p>
<p>2ã€åœ¨çº¿å­¦ä¹ è¯·æ±‚å­¦ä¹ æœåŠ¡è·å–è§†é¢‘æ’­æ”¾åœ°å€ã€‚</p>
<p>3ã€å­¦ä¹ æœåŠ¡æ ¡éªŒå½“å‰ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å­¦ä¹ ï¼Œå¦‚æœæ²¡æœ‰æƒé™å­¦ä¹ åˆ™æç¤ºç”¨æˆ·ã€‚</p>
<p>4ã€å­¦ä¹ æœåŠ¡æ ¡éªŒé€šè¿‡ï¼Œè¯·æ±‚æœç´¢æœåŠ¡è·å–è¯¾ç¨‹åª’èµ„ä¿¡æ¯ã€‚</p>
<p>5ã€æœç´¢æœåŠ¡è¯·æ±‚ElasticSearchè·å–è¯¾ç¨‹åª’èµ„ä¿¡æ¯ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦è¯·æ±‚ <code>ElasticSearch</code> æŸ¥è¯¢è¯¾ç¨‹åª’èµ„ä¿¡æ¯ï¼Ÿ</p>
<p>å‡ºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œå…¬å¼€æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯ä»æœç´¢æœåŠ¡æŸ¥è¯¢ï¼Œåˆ†æ‘Š <code>mysql</code> æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚</p>
<p>ä»€ä¹ˆæ—¶å€™å°†è¯¾ç¨‹åª’èµ„ä¿¡æ¯å­˜å‚¨åˆ° <code>ElasticSearch</code> ä¸­ï¼Ÿ</p>
<p>è¯¾ç¨‹åª’èµ„ä¿¡æ¯æ˜¯åœ¨è¯¾ç¨‹å‘å¸ƒçš„æ—¶å€™å­˜å…¥ <code>ElasticSearch</code>ï¼Œå› ä¸ºè¯¾ç¨‹å‘å¸ƒåè¯¾ç¨‹ä¿¡æ¯å°†åŸºæœ¬ä¸å†ä¿®æ”¹ã€‚</p>
<h2 id="2-è¯¾ç¨‹å‘å¸ƒï¼šå‚¨å­˜åª’èµ„ä¿¡æ¯"><a href="#2-è¯¾ç¨‹å‘å¸ƒï¼šå‚¨å­˜åª’èµ„ä¿¡æ¯" class="headerlink" title="2. è¯¾ç¨‹å‘å¸ƒï¼šå‚¨å­˜åª’èµ„ä¿¡æ¯"></a>2. è¯¾ç¨‹å‘å¸ƒï¼šå‚¨å­˜åª’èµ„ä¿¡æ¯</h2><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>è¯¾ç¨‹åª’èµ„ä¿¡æ¯æ˜¯åœ¨è¯¾ç¨‹å‘å¸ƒçš„æ—¶å€™å­˜å…¥ <code>ElasticSearch</code> ç´¢å¼•åº“ï¼Œå› ä¸ºè¯¾ç¨‹å‘å¸ƒåè¯¾ç¨‹ä¿¡æ¯å°†åŸºæœ¬ä¸å†ä¿®æ”¹ï¼Œå…·ä½“çš„ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ã€‚</p>
<p><strong>1ã€è¯¾ç¨‹å‘å¸ƒï¼Œå‘è¯¾ç¨‹åª’èµ„ä¿¡æ¯è¡¨å†™å…¥æ•°æ®ã€‚</strong></p>
<p>1ï¼‰æ ¹æ®è¯¾ç¨‹ <code>id</code> åˆ é™¤ <code>teachplanMediaPub</code> ä¸­çš„æ•°æ®</p>
<p>2ï¼‰æ ¹æ®è¯¾ç¨‹ <code>id</code> æŸ¥è¯¢ <code>teachplanMedia</code> æ•°æ®</p>
<p>3ï¼‰å°†æŸ¥è¯¢åˆ°çš„ <code>teachplanMedia</code> æ•°æ®æ’å…¥åˆ° <code>teachplanMediaPub</code> ä¸­</p>
<p><strong>2ã€Logstash å®šæ—¶æ‰«æè¯¾ç¨‹åª’èµ„ä¿¡æ¯è¡¨ï¼Œå¹¶å°†è¯¾ç¨‹åª’èµ„ä¿¡æ¯å†™å…¥ç´¢å¼•åº“ã€‚</strong></p>
<h3 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h3><p>åœ¨ <code>xc_course</code> æ•°æ®åº“åˆ›å»ºè¯¾ç¨‹è®¡åˆ’åª’èµ„å‘å¸ƒè¡¨ï¼š</p>
<div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-string">`teachplan_media_pub`</span> (
    <span class="hljs-string">`teachplan_id`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'è¯¾ç¨‹è®¡åˆ’id'</span>,
    <span class="hljs-string">`media_id`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'åª’èµ„æ–‡ä»¶id'</span>,
    <span class="hljs-string">`media_fileoriginalname`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'åª’èµ„æ–‡ä»¶çš„åŸå§‹åç§°'</span>,
    <span class="hljs-string">`media_url`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'åª’èµ„æ–‡ä»¶è®¿é—®åœ°å€'</span>,
    <span class="hljs-string">`courseid`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">COMMENT</span> <span class="hljs-string">'è¯¾ç¨‹Id'</span>,
    <span class="hljs-string">`timestamp`</span> <span class="hljs-built_in">timestamp</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">COMMENT</span>
    <span class="hljs-string">'logstashä½¿ç”¨'</span>,
    PRIMARY <span class="hljs-keyword">KEY</span> (<span class="hljs-string">`teachplan_id`</span>)
) <span class="hljs-keyword">ENGINE</span>=<span class="hljs-keyword">InnoDB</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">CHARSET</span>=utf8</code></pre></div>

<p>æ•°æ®æ¨¡å‹ç±»å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.course;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.ToString;
<span class="hljs-keyword">import</span> org.hibernate.annotations.GenericGenerator;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.io.Serializable;
<span class="hljs-keyword">import</span> java.util.Date;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"teachplan_media_pub"</span>)
<span class="hljs-meta">@GenericGenerator</span>(name = <span class="hljs-string">"jpa-assigned"</span>, strategy = <span class="hljs-string">"assigned"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TeachplanMediaPub</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">916357110051689485L</span>;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>(generator = <span class="hljs-string">"jpa-assigned"</span>)
    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"teachplan_id"</span>)
    <span class="hljs-keyword">private</span> String teachplanId;
    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"media_id"</span>)
    <span class="hljs-keyword">private</span> String mediaId;
    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"media_fileoriginalname"</span>)
    <span class="hljs-keyword">private</span> String mediaFileOriginalName;
    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"media_url"</span>)
    <span class="hljs-keyword">private</span> String mediaUrl;
    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"courseid"</span>)
    <span class="hljs-keyword">private</span> String courseId;
    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"timestamp"</span>)
    <span class="hljs-keyword">private</span> Date timestamp;<span class="hljs-comment">//æ—¶é—´æˆ³</span>
&#125;</code></pre></div>

<h3 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h3><p>åˆ›å»º <code>TeachplanMediaPub</code> è¡¨çš„ <code>Dao</code>ï¼Œå‘ <code>TeachplanMediaPub</code> å­˜å‚¨ä¿¡æ¯é‡‡ç”¨å…ˆåˆ é™¤è¯¥è¯¾ç¨‹çš„åª’èµ„ä¿¡æ¯ï¼Œå†æ·»åŠ è¯¥è¯¾ç¨‹çš„åª’èµ„ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™é‡Œå®šä¹‰æ ¹æ®è¯¾ç¨‹ <code>id</code> åˆ é™¤è¯¾ç¨‹è®¡åˆ’åª’èµ„æ–¹æ³•ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TeachplanMediaPubRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">TeachplanMediaPub</span>, <span class="hljs-title">String</span>&gt; </span>&#123;
    <span class="hljs-comment">//æ ¹æ®è¯¾ç¨‹idåˆ é™¤è¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯</span>
    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">deleteByCourseId</span><span class="hljs-params">(String courseId)</span></span>;
&#125;</code></pre></div>

<p>ä»TeachplanMediaæŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä»TeachplanMediaæŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TeachplanMediaRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">TeachplanMedia</span>, <span class="hljs-title">String</span>&gt; </span>&#123;
    <span class="hljs-function">List&lt;TeachplanMedia&gt; <span class="hljs-title">findByCourseId</span><span class="hljs-params">(String courseId)</span></span>;
&#125;</code></pre></div>

<h3 id="Service-1"><a href="#Service-1" class="headerlink" title="Service"></a>Service</h3><p>ç¼–å†™ä¿å­˜è¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯æ–¹æ³•ï¼Œå¹¶åœ¨è¯¾ç¨‹å‘å¸ƒæ—¶è°ƒç”¨æ­¤æ–¹æ³•ã€‚</p>
<p>1ã€ä¿å­˜è¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯æ–¹æ³•</p>
<p>æœ¬æ–¹æ³•é‡‡ç”¨å…ˆåˆ é™¤è¯¥è¯¾ç¨‹çš„åª’èµ„ä¿¡æ¯ï¼Œå†æ·»åŠ è¯¥è¯¾ç¨‹çš„åª’èµ„ä¿¡æ¯ï¼Œåœ¨ <code>CourseService</code> ä¸‹å®šä¹‰è¯¥æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä¿å­˜è¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveTeachplanMediaPub</span><span class="hljs-params">(String courseId)</span></span>&#123;
    <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹åª’èµ„ä¿¡æ¯</span>
    List&lt;TeachplanMedia&gt; byCourseId = teachplanMediaRepository.findByCourseId(courseId);
    <span class="hljs-keyword">if</span>(byCourseId == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span>;  <span class="hljs-comment">//æ²¡æœ‰æŸ¥è¯¢åˆ°åª’èµ„æ•°æ®åˆ™ç›´æ¥ç»“æŸè¯¥æ–¹æ³•</span>

    <span class="hljs-comment">//å°†è¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯å‚¨å­˜åˆ°å¾…ç´¢å¼•è¡¨</span>

    <span class="hljs-comment">//åˆ é™¤åŸæœ‰çš„ç´¢å¼•ä¿¡æ¯</span>
    teachplanMediaPubRepository.deleteByCourseId(courseId);
    <span class="hljs-comment">//ä¸€ä¸ªè¯¾ç¨‹å¯èƒ½ä¼šæœ‰å¤šä¸ªåª’èµ„ä¿¡æ¯,éå†å¹¶ä½¿ç”¨listè¿›è¡Œå‚¨å­˜</span>
    List&lt;TeachplanMediaPub&gt; teachplanMediaPubList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
    <span class="hljs-keyword">for</span> (TeachplanMedia teachplanMedia: byCourseId) &#123;
        TeachplanMediaPub teachplanMediaPub = <span class="hljs-keyword">new</span> TeachplanMediaPub();
        BeanUtils.copyProperties(teachplanMedia, teachplanMediaPub);
        teachplanMediaPubList.add(teachplanMediaPub);
    &#125;
    <span class="hljs-comment">//ä¿å­˜æ‰€æœ‰ä¿¡æ¯</span>
    teachplanMediaPubRepository.saveAll(teachplanMediaPubList);
&#125;</code></pre></div>

<p>2ã€è¯¾ç¨‹å‘å¸ƒæ—¶è°ƒç”¨æ­¤æ–¹æ³•</p>
<p>ä¿®æ”¹è¯¾ç¨‹å‘å¸ƒçš„ <code>coursePublish</code> æ–¹æ³•ï¼š</p>
<div class="hljs"><pre><code class="hljs java">....
<span class="hljs-comment">//ä¿å­˜è¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯åˆ°å¾…ç´¢å¼•è¡¨</span>
saveTeachplanMediaPub(courseId);
<span class="hljs-comment">//é¡µé¢url</span>
String pageUrl = cmsPostPageResult.getPageUrl();
<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CoursePublishResult(CommonCode.SUCCESS,pageUrl);
.....</code></pre></div>

<h3 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æµ‹è¯•è¯¾ç¨‹å‘å¸ƒåæ˜¯å¦æˆåŠŸå°†è¯¾ç¨‹åª’èµ„ä¿¡æ¯å­˜å‚¨åˆ° <code>teachplan_media_pub</code> ä¸­ï¼Œæµ‹è¯•æµç¨‹å¦‚ä¸‹ï¼š</p>
<p>1ã€æŒ‡å®šä¸€ä¸ªè¯¾ç¨‹</p>
<p>2ã€ä¸ºè¯¾ç¨‹è®¡åˆ’æ·»åŠ è¯¾ç¨‹åª’èµ„</p>
<p>3ã€æ‰§è¡Œè¯¾ç¨‹å‘å¸ƒ</p>
<p>4ã€è§‚å¯Ÿè¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯æ˜¯å¦å­˜å‚¨è‡³ <code>teachplan_media_pub</code> ä¸­</p>
<p>æ³¨æ„ï¼šç”±äºæ­¤æµ‹è¯•ä»…ç”¨äºæµ‹è¯•å‘å¸ƒè¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯çš„åŠŸèƒ½ï¼Œå¯æš‚æ—¶å°† <code>cms</code>é¡µé¢å‘å¸ƒçš„åŠŸèƒ½æš‚æ—¶å±è”½ï¼Œæé«˜æµ‹è¯•æ•ˆç‡ã€‚</p>
<p>æµ‹è¯•ç»“æœå¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image7" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image7.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-Logstashï¼šæ‰«æè¯¾ç¨‹è®¡åˆ’åª’èµ„"><a href="#3-Logstashï¼šæ‰«æè¯¾ç¨‹è®¡åˆ’åª’èµ„" class="headerlink" title="3. Logstashï¼šæ‰«æè¯¾ç¨‹è®¡åˆ’åª’èµ„"></a>3. Logstashï¼šæ‰«æè¯¾ç¨‹è®¡åˆ’åª’èµ„</h2><p><code>Logstash</code> å®šæ—¶æ‰«æè¯¾ç¨‹åª’èµ„ä¿¡æ¯è¡¨ï¼Œå¹¶å°†è¯¾ç¨‹åª’èµ„ä¿¡æ¯å†™å…¥ç´¢å¼•åº“ã€‚</p>
<h3 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h3><p>1ã€åˆ›å»º <code>xc_course_media</code> ç´¢å¼•</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image8" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image8.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>2ã€å¹¶å‘æ­¤ç´¢å¼•åˆ›å»ºå¦‚ä¸‹æ˜ å°„</p>
<p>POST: <a href="http://localhost:9200/xc_course_media/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course_media/doc/_mapping</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"properties"</span> : &#123;
        <span class="hljs-attr">"courseid"</span> : &#123;
            <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"teachplan_id"</span> : &#123;
            <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"media_id"</span> : &#123;
            <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"media_url"</span> : &#123;
            <span class="hljs-attr">"index"</span> : <span class="hljs-literal">false</span>,
            <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>
        &#125;,
        <span class="hljs-attr">"media_fileoriginalname"</span> : &#123;
            <span class="hljs-attr">"index"</span> : <span class="hljs-literal">false</span>,
            <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<p>ç´¢å¼•åˆ›å»ºæˆåŠŸ</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image9" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image9.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="åˆ›å»ºæ¨¡æ¿æ–‡ä»¶"><a href="#åˆ›å»ºæ¨¡æ¿æ–‡ä»¶" class="headerlink" title="åˆ›å»ºæ¨¡æ¿æ–‡ä»¶"></a>åˆ›å»ºæ¨¡æ¿æ–‡ä»¶</h3><p>åœ¨ <code>logstach</code> çš„ <code>config</code> ç›®å½•æ–‡ä»¶ <code>xc_course_media_template.json</code></p>
<p>æ–‡ä»¶è·¯å¾„ä¸º <code>%ES_ROOT_DIR%/logstash6.8.8/config/xc_course_media_template.json</code></p>
<blockquote>
<p>%ES_ROOT_DIR% ä¸º ElasticSearch å’Œ logstash çš„å®‰è£…ç›®å½•</p>
</blockquote>
<p>å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"mappings"</span> : &#123;
        <span class="hljs-attr">"doc"</span> : &#123;
            <span class="hljs-attr">"properties"</span> : &#123;
                <span class="hljs-attr">"courseid"</span> : &#123;
                    <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
                &#125;,
                <span class="hljs-attr">"teachplan_id"</span> : &#123;
                    <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
                &#125;,
                <span class="hljs-attr">"media_id"</span> : &#123;
                    <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
                &#125;,
                <span class="hljs-attr">"media_url"</span> : &#123;
                    <span class="hljs-attr">"index"</span> : <span class="hljs-literal">false</span>,
                    <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>
                &#125;,
                <span class="hljs-attr">"media_fileoriginalname"</span> : &#123;
                    <span class="hljs-attr">"index"</span> : <span class="hljs-literal">false</span>,
                    <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>
                &#125;
            &#125;
        &#125;,
        <span class="hljs-attr">"template"</span> : <span class="hljs-string">"xc_course_media"</span>
    &#125;
&#125;</code></pre></div>

<h3 id="é…ç½®-mysql-conf"><a href="#é…ç½®-mysql-conf" class="headerlink" title="é…ç½® mysql.conf"></a>é…ç½® mysql.conf</h3><p>åœ¨logstashçš„ <code>config</code> ç›®å½•ä¸‹é…ç½® <code>mysql_course_media.conf</code> æ–‡ä»¶ä¾› <code>logstash</code> ä½¿ç”¨ï¼Œ<code>logstash</code> ä¼šæ ¹æ®<br><code>mysql_course_media.conf</code> æ–‡ä»¶çš„é…ç½®çš„åœ°å€ä» <code>MySQL</code> ä¸­è¯»å–æ•°æ®å‘ <code>ES</code> ä¸­å†™å…¥ç´¢å¼•ã€‚</p>
<p>å‚è€ƒ<a href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-jdbc.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/current/plugins-inputs-jdbc.html</a></p>
<p>é…ç½®è¾“å…¥æ•°æ®æºå’Œè¾“å‡ºæ•°æ®æºã€‚</p>
<div class="hljs"><pre><code class="hljs json">input &#123;
    stdin &#123;&#125; 
	jdbc &#123;
		jdbc_connection_string =&gt; "jdbc:mysql://localhost:3306/xc_course?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC"
        # æ•°æ®åº“ä¿¡æ¯
        jdbc_user =&gt; "root"
        jdbc_password =&gt; "123123"
        # MYSQL é©±åŠ¨åœ°å€,ä¿®æ”¹ä¸ºmavenä»“åº“å¯¹åº”çš„ä½ç½®
        jdbc_driver_library =&gt; "D:/soft/apache-maven-3.5.4/repository/mysql/mysql-connector-java/5.1.40/mysql-connector-java-5.1.40.jar"
		# the name of the driver class for mysql
		jdbc_driver_class =&gt; "com.mysql.jdbc.Driver"
		jdbc_paging_enabled =&gt; "true"
		jdbc_page_size =&gt; "50000"
		#è¦æ‰§è¡Œçš„sqlæ–‡ä»¶
		#statement_filepath =&gt; "/conf/course.sql"
		statement =&gt; "select * from teachplan_media_pub where timestamp &gt; date_add(:sql_last_value,INTERVAL 8 HOUR)"
		#å®šæ—¶é…ç½®
		schedule =&gt; "* * * * *"
		record_last_run =&gt; true
		last_run_metadata_path =&gt; "D:/soft/elasticsearch/logstash-6.8.8/config/xc_course_media_metadata"
	&#125;
&#125; 
output &#123;
    elasticsearch &#123;
		#ESçš„ipåœ°å€å’Œç«¯å£
		hosts =&gt; "localhost:9200"
		#hosts =&gt; ["localhost:9200","localhost:9202","localhost:9203"]
		#ESç´¢å¼•åº“åç§°
		index =&gt; "xc_course_media"
		document_id =&gt; "%&#123;teachplan_id&#125;"
		document_type =&gt; "doc"
		template =&gt; "D:/soft/elasticsearch/logstash-6.8.8/config/xc_course_media_template.json"
		template_name =&gt;"xc_course_media"
		template_overwrite =&gt;"true"
	&#125; 
	stdout &#123;
		#æ—¥å¿—è¾“å‡º
		codec =&gt; json_lines
	&#125;
&#125;</code></pre></div>

<h3 id="å¯åŠ¨-logstash-bat"><a href="#å¯åŠ¨-logstash-bat" class="headerlink" title="å¯åŠ¨ logstash.bat"></a>å¯åŠ¨ logstash.bat</h3><p>å¯åŠ¨ <code>logstash.bat</code> é‡‡é›† <code>teachplan_media_pub</code> ä¸­çš„æ•°æ®ï¼Œå‘ <code>ES</code> å†™å…¥ç´¢å¼•ã€‚</p>
<div class="hljs"><pre><code class="hljs c">logstash.bat -f ../<span class="hljs-built_in">config</span>/mysql_course_media.conf</code></pre></div>

<p>è¯¾ç¨‹å‘å¸ƒæˆåŠŸåï¼ŒLogstash ä¼šè‡ªåŠ¨å‚åŠ  <code>teachplan_media_pub</code> è¡¨ä¸­æ–°å¢çš„æ•°æ®ï¼Œæ•ˆæœå¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image10" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image10.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image11" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image11.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="Logstashå¤šå®ä¾‹è¿è¡Œ"><a href="#Logstashå¤šå®ä¾‹è¿è¡Œ" class="headerlink" title="Logstashå¤šå®ä¾‹è¿è¡Œ"></a>Logstashå¤šå®ä¾‹è¿è¡Œ</h3><p>ç”±äºä¹‹å‰æˆ‘ä»¬è¿˜å¯åŠ¨äº†ä¸€ä¸ª <code>Logstash</code> å¯¹è¯¾ç¨‹çš„å‘å¸ƒä¿¡æ¯è¿›è¡Œé‡‡é›†ï¼Œæ‰€ä»¥å¦‚æœæƒ³ä¸¤ä¸ª <code>logstash</code> å®ä¾‹åŒæ—¶è¿è¡Œï¼Œå› ä¸ºæ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ª.lockæ–‡ä»¶ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨åŒä¸€ä¸ªç›®å½•æ¥å­˜æ”¾æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>--path.data=</code> ä¸ºæ¯ä¸ªå®ä¾‹æŒ‡å®šå•ç‹¬çš„æ•°æ®ç›®å½•ï¼Œå…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>è¯¥é…ç½®æ˜¯åœ¨windowsä¸‹è¿›è¡Œçš„</p>
</blockquote>
<p><strong>è¯¾ç¨‹å‘å¸ƒå®ä¾‹</strong></p>
<p><code>logstash_start_course_pub.bat</code></p>
<div class="hljs"><pre><code class="hljs cmd">@<span class="hljs-built_in">title</span> logstash <span class="hljs-keyword">in</span> course_pub
logstash.bat -f ..\config\mysql.conf --<span class="hljs-built_in">path</span>.data=../data/course_pub</code></pre></div>

<p><strong>è¯¾ç¨‹è®¡åˆ’åª’ä½“å‘å¸ƒå®ä¾‹</strong></p>
<p><code>logstash_start_teachplan_media.bat</code></p>
<div class="hljs"><pre><code class="hljs cmd">@<span class="hljs-built_in">title</span> logstash i n teachplan_media_pub
logstash.bat -f ../config/mysql_course_media.conf --<span class="hljs-built_in">path</span>.data=../data/teachplan_media/</code></pre></div>

<p>åŒæ—¶è¿è¡Œæ•ˆæœå¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image12" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image12.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="4-æœç´ æœåŠ¡ï¼šæŸ¥è¯¢è¯¾ç¨‹åª’èµ„æ¥å£"><a href="#4-æœç´ æœåŠ¡ï¼šæŸ¥è¯¢è¯¾ç¨‹åª’èµ„æ¥å£" class="headerlink" title="4. æœç´ æœåŠ¡ï¼šæŸ¥è¯¢è¯¾ç¨‹åª’èµ„æ¥å£"></a>4. æœç´ æœåŠ¡ï¼šæŸ¥è¯¢è¯¾ç¨‹åª’èµ„æ¥å£</h2><h3 id="éœ€æ±‚åˆ†æ-1"><a href="#éœ€æ±‚åˆ†æ-1" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p><code>æœç´¢æœåŠ¡</code> æä¾›æŸ¥è¯¢è¯¾ç¨‹åª’èµ„æ¥å£ï¼Œæ­¤æ¥å£ä¾›å­¦ä¹ æœåŠ¡è°ƒç”¨ã€‚</p>
<h3 id="Apiæ¥å£å®šä¹‰"><a href="#Apiæ¥å£å®šä¹‰" class="headerlink" title="Apiæ¥å£å®šä¹‰"></a>Apiæ¥å£å®šä¹‰</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æ ¹æ®è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢åª’èµ„ä¿¡æ¯"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanMediaPub <span class="hljs-title">getmedia</span><span class="hljs-params">(String teachplanId)</span></span>;</code></pre></div>

<h3 id="Service-2"><a href="#Service-2" class="headerlink" title="Service"></a>Service</h3><p>1ã€é…ç½®è¯¾ç¨‹è®¡åˆ’åª’èµ„ç´¢å¼•åº“ç­‰ä¿¡æ¯</p>
<p>åœ¨ <code>application.yml</code> ä¸­é…ç½®</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">xuecheng:</span>
  <span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">hostlist:</span> <span class="hljs-string">$&#123;eshostlist:127.0.0.1:9200&#125;</span> <span class="hljs-comment">#å¤šä¸ªç»“ç‚¹ä¸­é—´ç”¨é€—å·åˆ†éš”</span>
    <span class="hljs-attr">course:</span>
      <span class="hljs-attr">index:</span> <span class="hljs-string">xc_course</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">doc</span>
      <span class="hljs-attr">source_field:</span> <span class="hljs-string">id,name,grade,mt,st,charge,valid,pic,qq,price,price_old,status,studymodel,teachmode,expires,pub_time,start_time,end_time</span>
    <span class="hljs-attr">media:</span>
      <span class="hljs-attr">index:</span> <span class="hljs-string">xc_course_media</span>
      <span class="hljs-attr">type:</span> <span class="hljs-string">doc</span>
      <span class="hljs-attr">source_field:</span> <span class="hljs-string">courseid,media_id,media_url,teachplan_id,media_fileoriginalname</span></code></pre></div>

<p>2ã€service æ–¹æ³•å¼€å‘</p>
<p>åœ¨ <code>è¯¾ç¨‹æœç´¢æœåŠ¡</code> ä¸­å®šä¹‰è¯¾ç¨‹åª’èµ„æŸ¥è¯¢æ¥å£ï¼Œä¸ºäº†é€‚åº”åç»­éœ€æ±‚ï¼Œ<code>service</code> å‚æ•°å®šä¹‰ä¸ºæ•°ç»„ï¼Œå¯ä¸€æ¬¡æŸ¥è¯¢å¤šä¸ªè¯¾ç¨‹è®¡åˆ’çš„åª’èµ„ä¿¡æ¯ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">    * æ ¹æ®ä¸€ä¸ªæˆ–è€…å¤šä¸ªè¯¾ç¨‹è®¡åˆ’idæŸ¥è¯¢åª’èµ„ä¿¡æ¯</span>
<span class="hljs-comment">    * <span class="hljs-doctag">@param</span> teachplanIds è¯¾ç¨‹id</span>
<span class="hljs-comment">    * <span class="hljs-doctag">@return</span> QueryResponseResult</span>
<span class="hljs-comment">    */</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult&lt;TeachplanMediaPub&gt; <span class="hljs-title">getmedia</span><span class="hljs-params">(String [] teachplanIds)</span></span>&#123;
       <span class="hljs-comment">//è®¾ç½®ç´¢å¼•</span>
       SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(media_index);

       <span class="hljs-comment">//è®¾ç½®ç±»å‹</span>
       searchRequest.types(media_type);

       <span class="hljs-comment">//åˆ›å»ºæœç´¢æºå¯¹è±¡</span>
       SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();

       <span class="hljs-comment">//æºå­—æ®µè¿‡æ»¤</span>
       String[] media_index_arr = media_field.split(<span class="hljs-string">","</span>);
       searchSourceBuilder.fetchSource(media_index_arr, <span class="hljs-keyword">new</span> String[]&#123;&#125;);

       <span class="hljs-comment">//æŸ¥è¯¢æ¡ä»¶,æ ¹æ®è¯¾ç¨‹è®¡åˆ’idæŸ¥è¯¢(å¯ä»¥ä¼ å…¥å¤šä¸ªè¯¾ç¨‹è®¡åˆ’id)</span>
       searchSourceBuilder.query(QueryBuilders.termsQuery(<span class="hljs-string">"teachplan_id"</span>, teachplanIds));

       searchRequest.source(searchSourceBuilder);
       SearchResponse searchResponse = <span class="hljs-keyword">null</span>;
       <span class="hljs-keyword">try</span> &#123;
           searchResponse = restHighLevelClient.search(searchRequest);
       &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
           e.printStackTrace();
       &#125;
       <span class="hljs-comment">//è·å–ç»“æœ</span>
       SearchHits hits = searchResponse.getHits();
       <span class="hljs-keyword">long</span> totalHits = hits.getTotalHits();
       SearchHit[] searchHits = hits.getHits();

       <span class="hljs-comment">//æ•°æ®åˆ—è¡¨</span>
       List&lt;TeachplanMediaPub&gt; teachplanMediaPubList = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();

       <span class="hljs-keyword">for</span>(SearchHit hit:searchHits)&#123;
           TeachplanMediaPub teachplanMediaPub =<span class="hljs-keyword">new</span> TeachplanMediaPub();
           Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();
           <span class="hljs-comment">//å–å‡ºè¯¾ç¨‹è®¡åˆ’åª’èµ„ä¿¡æ¯</span>
           String courseid = (String) sourceAsMap.get(<span class="hljs-string">"courseid"</span>);
           String media_id = (String) sourceAsMap.get(<span class="hljs-string">"media_id"</span>);
           String media_url = (String) sourceAsMap.get(<span class="hljs-string">"media_url"</span>);
           String teachplan_id = (String) sourceAsMap.get(<span class="hljs-string">"teachplan_id"</span>);
           String media_fileoriginalname = (String) sourceAsMap.get(<span class="hljs-string">"media_fileoriginalname"</span>);
           teachplanMediaPub.setCourseId(courseid);
           teachplanMediaPub.setMediaUrl(media_url);
           teachplanMediaPub.setMediaFileOriginalName(media_fileoriginalname);
           teachplanMediaPub.setMediaId(media_id);
           teachplanMediaPub.setTeachplanId(teachplan_id);
           <span class="hljs-comment">//å°†å¯¹è±¡åŠ å…¥åˆ°åˆ—è¡¨ä¸­</span>
           teachplanMediaPubList.add(teachplanMediaPub);
       &#125;

       <span class="hljs-comment">//æ„å»ºè¿”å›è¯¾ç¨‹åª’èµ„ä¿¡æ¯å¯¹è±¡</span>
       QueryResult&lt;TeachplanMediaPub&gt; queryResult = <span class="hljs-keyword">new</span> QueryResult&lt;&gt;();
       queryResult.setList(teachplanMediaPubList);
       queryResult.setTotal(totalHits);
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult&lt;TeachplanMediaPub&gt;(CommonCode.SUCCESS,queryResult);
   &#125;</code></pre></div>

<h3 id="Controller-1"><a href="#Controller-1" class="headerlink" title="Controller"></a>Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æ ¹æ®è¯¾ç¨‹è®¡åˆ’idæœç´¢å‘å¸ƒåçš„åª’èµ„ä¿¡æ¯</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> teachplanId</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
<span class="hljs-meta">@GetMapping</span>(value=<span class="hljs-string">"/getmedia/&#123;teachplanId&#125;"</span>)
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanMediaPub <span class="hljs-title">getmedia</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"teachplanId"</span>)</span> String teachplanId) </span>&#123;
    <span class="hljs-comment">//ä¸ºäº†serviceçš„æ‹“å±•æ€§,æ‰€ä»¥æˆ‘ä»¬serviceæ¥æ”¶çš„æ˜¯æ•°ç»„ä½œä¸ºå‚æ•°,ä»¥ä¾¿åç»­å¼€å‘æŸ¥è¯¢å¤šä¸ªIDçš„æ¥å£</span>
    String[] teachplanIds = <span class="hljs-keyword">new</span> String[]&#123;teachplanId&#125;;
    <span class="hljs-comment">//é€šè¿‡serviceæŸ¥è¯¢ESè·å–è¯¾ç¨‹åª’èµ„ä¿¡æ¯</span>
    QueryResponseResult&lt;TeachplanMediaPub&gt; mediaPubQueryResponseResult = esCourseService.getmedia(teachplanIds);
    QueryResult&lt;TeachplanMediaPub&gt; queryResult = mediaPubQueryResponseResult.getQueryResult();
    <span class="hljs-keyword">if</span>(queryResult!=<span class="hljs-keyword">null</span>&amp;&amp; queryResult.getList()!=<span class="hljs-keyword">null</span>
       &amp;&amp; queryResult.getList().size()&gt;<span class="hljs-number">0</span>)&#123;
        <span class="hljs-comment">//è¿”å›è¯¾ç¨‹è®¡åˆ’å¯¹åº”è¯¾ç¨‹åª’èµ„</span>
        <span class="hljs-keyword">return</span> queryResult.getList().get(<span class="hljs-number">0</span>);
    &#125; <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> TeachplanMediaPub();
&#125;</code></pre></div>

<h3 id="æµ‹è¯•-3"><a href="#æµ‹è¯•-3" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ä½¿ç”¨ <code>swagger-ui</code> å’Œ <code>postman</code> æµ‹è¯•è¯¾ç¨‹åª’èµ„æŸ¥è¯¢æ¥å£ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image13" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image13.png" srcset="/img/loading.gif" alt="img"></a></p>
<h1 id="ä¸‰ã€åœ¨çº¿å­¦ä¹ ï¼šæ¥å£å¼€å‘"><a href="#ä¸‰ã€åœ¨çº¿å­¦ä¹ ï¼šæ¥å£å¼€å‘" class="headerlink" title="ä¸‰ã€åœ¨çº¿å­¦ä¹ ï¼šæ¥å£å¼€å‘"></a>ä¸‰ã€åœ¨çº¿å­¦ä¹ ï¼šæ¥å£å¼€å‘</h1><h2 id="1-éœ€æ±‚åˆ†æ-2"><a href="#1-éœ€æ±‚åˆ†æ-2" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>æ ¹æ®ä¸‹è¾¹çš„ä¸šåŠ¡æµç¨‹ï¼Œæœ¬ç« èŠ‚å®Œæˆå‰ç«¯å­¦ä¹ é¡µé¢è¯·æ±‚å­¦ä¹ æœåŠ¡è·å–è¯¾ç¨‹è§†é¢‘åœ°å€ï¼Œå¹¶è‡ªåŠ¨æ’­æ”¾è§†é¢‘ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image14" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image14.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="2-æ­å»ºå¼€å‘ç¯å¢ƒ"><a href="#2-æ­å»ºå¼€å‘ç¯å¢ƒ" class="headerlink" title="2. æ­å»ºå¼€å‘ç¯å¢ƒ"></a>2. æ­å»ºå¼€å‘ç¯å¢ƒ</h2><p>1ã€åˆ›å»ºæ•°æ®åº“</p>
<p>åˆ›å»º <code>xc_learning</code> æ•°æ®åº“ï¼Œå­¦ä¹ æ•°æ®åº“å°†è®°å½•å­¦ç”Ÿçš„é€‰è¯¾ä¿¡æ¯ã€å­¦ä¹ ä¿¡æ¯ã€‚</p>
<p>å¯¼å…¥ï¼š<code>èµ„æ–™/xc_learning.sql</code></p>
<p>2ã€åˆ›å»ºå­¦ä¹ æœåŠ¡å·¥ç¨‹</p>
<p>å‚è€ƒè¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹ç»“æ„ï¼Œåˆ›å»ºå­¦ä¹ æœåŠ¡å·¥ç¨‹ï¼š</p>
<p>å¯¼å…¥ï¼š<code>èµ„æ–™/xc-service-learning.zip</code></p>
<p>é¡¹ç›®å·¥ç¨‹ç»“æ„å¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image15" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image15.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-Apiæ¥å£"><a href="#3-Apiæ¥å£" class="headerlink" title="3. Apiæ¥å£"></a>3. Apiæ¥å£</h2><p>æ­¤ <code>api</code> æ¥å£æ˜¯è¯¾ç¨‹å­¦ä¹ é¡µé¢è¯·æ±‚å­¦ä¹ æœåŠ¡è·å–è¯¾ç¨‹å­¦ä¹ åœ°å€ã€‚</p>
<p>å®šä¹‰è¿”å›å€¼ç±»å‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.learning.response;

<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> lombok.ToString;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetMediaResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GetMediaResult</span><span class="hljs-params">(ResultCode resultCode, String fileUrl)</span> </span>&#123;
        <span class="hljs-keyword">super</span>(resultCode);
        <span class="hljs-keyword">this</span>.fileUrl = fileUrl;
    &#125;
    <span class="hljs-comment">//åª’èµ„æ–‡ä»¶æ’­æ”¾åœ°å€</span>
    <span class="hljs-keyword">private</span> String fileUrl;
&#125;</code></pre></div>

<p>å®šä¹‰æ¥å£ï¼Œå­¦ä¹ æœåŠ¡æ ¹æ®ä¼ å…¥è¯¾ç¨‹ <code>ID</code>ã€ç« èŠ‚ <code>Id</code>(è¯¾ç¨‹è®¡åˆ’ <code>ID</code>)æ¥å–å­¦ä¹ åœ°å€ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Api</span>(value = <span class="hljs-string">"å½•æ’­è¯¾ç¨‹å­¦ä¹ ç®¡ç†"</span>,description = <span class="hljs-string">"å½•æ’­è¯¾ç¨‹å­¦ä¹ ç®¡ç†"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseLearningControllerApi</span> </span>&#123;
    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è·å–è¯¾ç¨‹å­¦ä¹ åœ°å€"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> GetMediaResult <span class="hljs-title">getMediaPlayUrl</span><span class="hljs-params">(String courseId,String teachplanId)</span></span>;
&#125;</code></pre></div>

<h2 id="4-æœåŠ¡ç«¯å¼€å‘"><a href="#4-æœåŠ¡ç«¯å¼€å‘" class="headerlink" title="4. æœåŠ¡ç«¯å¼€å‘"></a>4. æœåŠ¡ç«¯å¼€å‘</h2><h3 id="éœ€æ±‚åˆ†æ-2"><a href="#éœ€æ±‚åˆ†æ-2" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>å­¦ä¹ æœåŠ¡æ ¹æ®ä¼ å…¥è¯¾ç¨‹IDã€ç« èŠ‚Id(è¯¾ç¨‹è®¡åˆ’ID)è¯·æ±‚æœç´¢æœåŠ¡è·å–å­¦ä¹ åœ°å€ã€‚</p>
<h3 id="æœç´¢æœåŠ¡æ³¨å†ŒEureka"><a href="#æœç´¢æœåŠ¡æ³¨å†ŒEureka" class="headerlink" title="æœç´¢æœåŠ¡æ³¨å†ŒEureka"></a>æœç´¢æœåŠ¡æ³¨å†ŒEureka</h3><p>å­¦ä¹ æœåŠ¡è¦è°ƒç”¨æœç´¢æœåŠ¡æŸ¥è¯¢è¯¾ç¨‹åª’èµ„ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦å°†æœç´¢æœåŠ¡æ³¨å†Œåˆ° <code>eureka</code> ä¸­ã€‚</p>
<p>1ã€æŸ¥çœ‹æœåŠ¡åç§°æ˜¯å¦ä¸º <code>xc-service-search</code></p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-comment"># æ³¨æ„ä¿®æ”¹application.xmlä¸­çš„æœåŠ¡åç§°ï¼š</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
	<span class="hljs-attr">name:</span> <span class="hljs-string">xcâ€serviceâ€search</span></code></pre></div>

<p>2ã€é…ç½®æœç´¢æœåŠ¡çš„é…ç½®æ–‡ä»¶ <code>application.yml</code>ï¼ŒåŠ å…¥ <code>Eureka</code> é…ç½® å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">eureka:</span>
  <span class="hljs-attr">client:</span>
    <span class="hljs-attr">registerWithEureka:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡æ³¨å†Œå¼€å…³</span>
    <span class="hljs-attr">fetchRegistry:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">#æœåŠ¡å‘ç°å¼€å…³</span>
    <span class="hljs-attr">serviceUrl:</span> <span class="hljs-comment">#Eurekaå®¢æˆ·ç«¯ä¸EurekaæœåŠ¡ç«¯è¿›è¡Œäº¤äº’çš„åœ°å€ï¼Œå¤šä¸ªä¸­é—´ç”¨é€—å·åˆ†éš”</span>
      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">$&#123;EUREKA_SERVER:http://localhost:50101/eureka/,http://localhost:50102/eureka/&#125;</span>
  <span class="hljs-attr">instance:</span>
    <span class="hljs-attr">prefer-ip-address:</span>  <span class="hljs-literal">true</span>  <span class="hljs-comment">#å°†è‡ªå·±çš„ipåœ°å€æ³¨å†Œåˆ°EurekaæœåŠ¡ä¸­</span>
    <span class="hljs-attr">ip-address:</span> <span class="hljs-string">$&#123;IP_ADDRESS:127.0.0.1&#125;</span>
    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.application.name&#125;:$&#123;server.port&#125;</span> <span class="hljs-comment">#æŒ‡å®šå®ä¾‹id</span>
<span class="hljs-attr">ribbon:</span>
  <span class="hljs-attr">MaxAutoRetries:</span> <span class="hljs-number">2</span> <span class="hljs-comment">#æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œå½“Eurekaä¸­å¯ä»¥æ‰¾åˆ°æœåŠ¡ï¼Œä½†æ˜¯æœåŠ¡è¿ä¸ä¸Šæ—¶å°†ä¼šé‡è¯•ï¼Œå¦‚æœeurekaä¸­æ‰¾ä¸åˆ°æœåŠ¡åˆ™ç›´æ¥èµ°æ–­è·¯å™¨</span>
  <span class="hljs-attr">MaxAutoRetriesNextServer:</span> <span class="hljs-number">3</span> <span class="hljs-comment">#åˆ‡æ¢å®ä¾‹çš„é‡è¯•æ¬¡æ•°</span>
  <span class="hljs-attr">OkToRetryOnAllOperations:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment">#å¯¹æ‰€æœ‰æ“ä½œè¯·æ±‚éƒ½è¿›è¡Œé‡è¯•ï¼Œå¦‚æœæ˜¯getåˆ™å¯ä»¥ï¼Œå¦‚æœæ˜¯postï¼Œputç­‰æ“ä½œæ²¡æœ‰å®ç°å¹‚ç­‰çš„æƒ…å†µä¸‹æ˜¯å¾ˆå±é™©çš„,æ‰€ä»¥è®¾ç½®ä¸ºfalse</span>
  <span class="hljs-attr">ConnectTimeout:</span> <span class="hljs-number">5000</span>  <span class="hljs-comment">#è¯·æ±‚è¿æ¥çš„è¶…æ—¶æ—¶é—´</span>
  <span class="hljs-attr">ReadTimeout:</span> <span class="hljs-number">6000</span> <span class="hljs-comment">#è¯·æ±‚å¤„ç†çš„è¶…æ—¶æ—¶é—´</span></code></pre></div>

<p>3ã€æ·»åŠ  <code>eureka</code> ä¾èµ–</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springâ€cloudâ€starterâ€netflixâ€eurekaâ€client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p>4ã€ä¿®æ”¹å¯åŠ¨ç±»ï¼Œåœ¨classä¸Šæ·»åŠ å¦‚ä¸‹æ³¨è§£ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@EnableDiscoveryClient</span></code></pre></div>

<h3 id="æœç´¢æœåŠ¡å®¢æˆ·ç«¯"><a href="#æœç´¢æœåŠ¡å®¢æˆ·ç«¯" class="headerlink" title="æœç´¢æœåŠ¡å®¢æˆ·ç«¯"></a>æœç´¢æœåŠ¡å®¢æˆ·ç«¯</h3><p>åœ¨ <code>å­¦ä¹ æœåŠ¡</code> åˆ›å»ºæœç´¢æœåŠ¡çš„å®¢æˆ·ç«¯æ¥å£ï¼Œæ­¤æ¥å£ä¼šç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨æœç´¢æœåŠ¡ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.learning.client;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.TeachplanMediaPub;
<span class="hljs-keyword">import</span> org.springframework.cloud.openfeign.FeignClient;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PathVariable;

<span class="hljs-meta">@FeignClient</span>(value = <span class="hljs-string">"xcâ€serviceâ€search"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseSearchClient</span> </span>&#123;
    <span class="hljs-meta">@GetMapping</span>(value=<span class="hljs-string">"/getmedia/&#123;teachplanId&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanMediaPub <span class="hljs-title">getmedia</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"teachplanId"</span>)</span> String teachplanId)</span>;
&#125;</code></pre></div>

<h3 id="è‡ªå®šä¹‰é”™è¯¯ä»£ç "><a href="#è‡ªå®šä¹‰é”™è¯¯ä»£ç " class="headerlink" title="è‡ªå®šä¹‰é”™è¯¯ä»£ç "></a>è‡ªå®šä¹‰é”™è¯¯ä»£ç </h3><p>æˆ‘ä»¬åœ¨ <code>com.xuecheng.framework.domain.learning.response</code> åŒ…ä¸‹è‡ªå®šä¹‰ä¸€ä¸ªé”™è¯¯æ¶ˆæ¯æ¨¡å‹</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.learning.response;

<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;
<span class="hljs-keyword">import</span> lombok.ToString;

<span class="hljs-meta">@ToString</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> LearningCode implements ResultCode &#123;
    LEARNING_GET_MEDIA_ERROR(<span class="hljs-keyword">false</span>,<span class="hljs-number">23001</span>,<span class="hljs-string">"å­¦ä¹ ä¸­å¿ƒè·å–åª’èµ„ä¿¡æ¯é”™è¯¯ï¼"</span>);

    <span class="hljs-comment">//æ“ä½œä»£ç </span>
    <span class="hljs-keyword">boolean</span> success;
    <span class="hljs-comment">//æ“ä½œä»£ç </span>
    <span class="hljs-keyword">int</span> code;
    <span class="hljs-comment">//æç¤ºä¿¡æ¯</span>
    String message;
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">LearningCode</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> success, <span class="hljs-keyword">int</span> code, String message)</span></span>&#123;
        <span class="hljs-keyword">this</span>.success = success;
        <span class="hljs-keyword">this</span>.code = code;
        <span class="hljs-keyword">this</span>.message = message;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">success</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> success;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">code</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> code;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">message</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> message;
    &#125;
&#125;</code></pre></div>

<p>è¯¥æ¶ˆæ¯æ¨¡å‹åŸºäº <code>ResultCode</code> æ¥å®ç°ï¼Œä»£ç å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.model.response;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * Created by mrt on 2018/3/5.</span>
<span class="hljs-comment"> * 10000-- é€šç”¨é”™è¯¯ä»£ç </span>
<span class="hljs-comment"> * 22000-- åª’èµ„é”™è¯¯ä»£ç </span>
<span class="hljs-comment"> * 23000-- ç”¨æˆ·ä¸­å¿ƒé”™è¯¯ä»£ç </span>
<span class="hljs-comment"> * 24000-- cmsé”™è¯¯ä»£ç </span>
<span class="hljs-comment"> * 25000-- æ–‡ä»¶ç³»ç»Ÿ</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ResultCode</span> </span>&#123;
    <span class="hljs-comment">//æ“ä½œæ˜¯å¦æˆåŠŸ,trueä¸ºæˆåŠŸï¼Œfalseæ“ä½œå¤±è´¥</span>
    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">success</span><span class="hljs-params">()</span></span>;
    <span class="hljs-comment">//æ“ä½œä»£ç </span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">code</span><span class="hljs-params">()</span></span>;
    <span class="hljs-comment">//æç¤ºä¿¡æ¯</span>
    <span class="hljs-function">String <span class="hljs-title">message</span><span class="hljs-params">()</span></span>;</code></pre></div>

<p>ä» <code>ResultCode</code> ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬çº¦å®šäº†ç”¨æˆ·ä¸­å¿ƒçš„é”™è¯¯ä»£ç ä½¿ç”¨ <code>23000</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å®šä¹‰çš„ä¸€äº›é”™è¯¯ä¿¡æ¯çš„ä»£ç å°±ä» 23000 å¼€å§‹è®¡æ•°ã€‚</p>
<h3 id="Service-3"><a href="#Service-3" class="headerlink" title="Service"></a>Service</h3><p>åœ¨å­¦ä¹ æœåŠ¡ä¸­å®šä¹‰ <code>service</code> æ–¹æ³•ï¼Œæ­¤æ–¹æ³•è¿œç¨‹è¯·æ±‚è¯¾ç¨‹ç®¡ç†æœåŠ¡ã€åª’èµ„ç®¡ç†æœåŠ¡è·å–è¯¾ç¨‹å­¦ä¹ åœ°å€ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.learning.service.impl;

<span class="hljs-keyword">import</span> com.netflix.discovery.converters.Auto;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.TeachplanMediaPub;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.learning.response.GetMediaResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;
<span class="hljs-keyword">import</span> com.xuecheng.learning.client.CourseSearchClient;
<span class="hljs-keyword">import</span> com.xuecheng.learning.service.LearningService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;


<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LearningServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">LearningService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    CourseSearchClient courseSearchClient;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * è¿œç¨‹è°ƒç”¨æœç´¢æœåŠ¡è·å–å·²å‘å¸ƒåª’ä½“ä¿¡æ¯ä¸­çš„url</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseId è¯¾ç¨‹id</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> teachplanId  åª’ä½“ä¿¡æ¯id</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> GetMediaResult <span class="hljs-title">getMediaPlayUrl</span><span class="hljs-params">(String courseId, String teachplanId)</span> </span>&#123;
        <span class="hljs-comment">//æ ¡éªŒå­¦ç”Ÿæƒé™,æ˜¯å¦å·²ä»˜è´¹ç­‰</span>


        <span class="hljs-comment">//è¿œç¨‹è°ƒç”¨æœç´¢æœåŠ¡è¿›è¡ŒæŸ¥è¯¢åª’ä½“ä¿¡æ¯</span>
        TeachplanMediaPub mediaPub = courseSearchClient.getmedia(teachplanId);
        <span class="hljs-keyword">if</span>(mediaPub == <span class="hljs-keyword">null</span>) ExceptionCast.cast(CommonCode.FAIL);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GetMediaResult(CommonCode.SUCCESS, mediaPub.getMediaUrl());
    &#125;
&#125;</code></pre></div>

<h3 id="Controller-2"><a href="#Controller-2" class="headerlink" title="Controller"></a>Controller</h3><p>è°ƒç”¨ <code>service</code> æ ¹æ®è¯¾ç¨‹è®¡åˆ’ <code>id</code> æŸ¥è¯¢è§†é¢‘æ’­æ”¾åœ°å€ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/learning/course"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseLearningController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CourseLearningControllerApi</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    LearningService learningService;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/getmedia/&#123;courseId&#125;/&#123;teachplanId&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> GetMediaResult <span class="hljs-title">getMediaPlayUrl</span><span class="hljs-params">(@PathVariable String courseId, @PathVariable String teachplanId)</span> </span>&#123;
        <span class="hljs-comment">//è·å–è¯¾ç¨‹å­¦ä¹ åœ°å€</span>
        <span class="hljs-keyword">return</span> learningService.getMedia(courseId, teachplanId);
    &#125;
&#125;</code></pre></div>

<h3 id="æµ‹è¯•-4"><a href="#æµ‹è¯•-4" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>ä½¿ç”¨ <code>swagger-ui</code> æˆ–<code>postman</code> æµ‹è¯•å­¦ä¹ æœåŠ¡æŸ¥è¯¢è¯¾ç¨‹è§†é¢‘åœ°å€æ¥å£ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image16" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image16.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="5-å‰ç«¯å¼€å‘"><a href="#5-å‰ç«¯å¼€å‘" class="headerlink" title="5. å‰ç«¯å¼€å‘"></a>5. å‰ç«¯å¼€å‘</h2><h3 id="éœ€æ±‚åˆ†æ-3"><a href="#éœ€æ±‚åˆ†æ-3" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>éœ€è¦åœ¨å­¦ä¹ ä¸­å¿ƒå‰ç«¯é¡µé¢éœ€è¦å®Œæˆå¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<p>1ã€è¿›å…¥è¯¾ç¨‹å­¦ä¹ é¡µé¢éœ€è¦å¸¦ä¸Š <code>è¯¾ç¨‹ Id</code>å‚æ•°åŠè¯¾ç¨‹è®¡åˆ’Idçš„å‚æ•°ï¼Œå…¶ä¸­ <code>è¯¾ç¨‹ Id</code> å‚æ•°å¿…å¸¦ï¼Œ<code>è¯¾ç¨‹è®¡åˆ’ Id</code> å¯ä»¥ä¸ºç©ºã€‚</p>
<p>2ã€è¿›å…¥é¡µé¢æ ¹æ® <code>è¯¾ç¨‹ Id</code> å–å‡ºè¯¥è¯¾ç¨‹çš„è¯¾ç¨‹è®¡åˆ’æ˜¾ç¤ºåœ¨å³ä¾§ã€‚</p>
<p>3ã€è¿›å…¥é¡µé¢ååˆ¤æ–­å¦‚æœè¯·æ±‚å‚æ•°ä¸­æœ‰<code>è¯¾ç¨‹è®¡åˆ’ Id</code> åˆ™æ’­æ”¾è¯¥ç« èŠ‚çš„è§†é¢‘ã€‚</p>
<p>4ã€è¿›å…¥é¡µé¢ååˆ¤æ–­å¦‚æœ <code>è¯¾ç¨‹è®¡åˆ’id</code> ä¸º0åˆ™éœ€è¦å–å‡ºæœ¬è¯¾ç¨‹ç¬¬ä¸€ä¸ª <code>è¯¾ç¨‹è®¡åˆ’çš„Id</code>ï¼Œå¹¶æ’­æ”¾ç¬¬ä¸€ä¸ªè¯¾ç¨‹è®¡åˆ’çš„è§†é¢‘ã€‚</p>
<p>è¿›å…¥åˆ°æ¨¡å— <code>xc-ui-pc-leanring/src/module/course</code></p>
<h3 id="apiæ–¹æ³•"><a href="#apiæ–¹æ³•" class="headerlink" title="apiæ–¹æ³•"></a>apiæ–¹æ³•</h3><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">let</span> sysConfig = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@/../config/sysConfig'</span>)
<span class="hljs-keyword">let</span> apiUrl = sysConfig.xcApiUrlPre;
<span class="hljs-comment">/*è·å–æ’­æ”¾åœ°å€*/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> get_media = <span class="hljs-function">(<span class="hljs-params">courseId,chapter</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">return</span> http.requestGet(apiUrl+<span class="hljs-string">'/api/learning/course/getmedia/'</span>+courseId+<span class="hljs-string">'/'</span>+chapter);
&#125;</code></pre></div>

<h3 id="é…ç½®ä»£ç†"><a href="#é…ç½®ä»£ç†" class="headerlink" title="é…ç½®ä»£ç†"></a>é…ç½®ä»£ç†</h3><p>åœ¨ <code>Nginx</code> ä¸­çš„ <code>ucenter.xuecheng.com</code> è™šæ‹Ÿä¸»æœºä¸­é…ç½® <code>/api/learning/</code> çš„è·¯å¾„è½¬å‘ï¼Œæ­¤<code>url</code> è¯·è½¬å‘åˆ°å­¦ä¹ æœåŠ¡ã€‚</p>
<div class="hljs"><pre><code class="hljs conf">#å­¦ä¹ æœåŠ¡
upstream learning_server_pool&#123;
    server 127.0.0.1:40600 weight&#x3D;10;
&#125;

#å­¦æˆç½‘ç”¨æˆ·ä¸­å¿ƒ
server &#123;
    listen 80;
    server_name ucenter.xuecheng.com;
    #ä¸ªäººä¸­å¿ƒ
    location &#x2F; &#123;
        proxy_pass http:&#x2F;&#x2F;ucenter_server_pool;
    &#125;
    #åç«¯æœç´¢æœåŠ¡
    location &#x2F;openapi&#x2F;search&#x2F; &#123;
        proxy_pass http:&#x2F;&#x2F;search_server_pool&#x2F;search&#x2F;; 
    &#125;
    #å­¦ä¹ æœåŠ¡
    location ^~ &#x2F;api&#x2F;learning&#x2F; &#123;
        proxy_pass http:&#x2F;&#x2F;learning_server_pool&#x2F;learning&#x2F;;
    &#125;
&#125;</code></pre></div>

<h3 id="è§†é¢‘æ’­æ”¾é¡µé¢"><a href="#è§†é¢‘æ’­æ”¾é¡µé¢" class="headerlink" title="è§†é¢‘æ’­æ”¾é¡µé¢"></a>è§†é¢‘æ’­æ”¾é¡µé¢</h3><p>1ã€å¦‚æœä¼ å…¥çš„è¯¾ç¨‹è®¡åˆ’idä¸º0åˆ™å–å‡ºç¬¬ä¸€ä¸ªè¯¾ç¨‹è®¡åˆ’id</p>
<p>åœ¨ <code>created</code> é’©å­æ–¹æ³•ä¸­å®Œæˆ</p>
<div class="hljs"><pre><code class="hljs js">created()&#123;
    <span class="hljs-comment">//å½“å‰è¯·æ±‚çš„url</span>
    <span class="hljs-keyword">this</span>.url = <span class="hljs-built_in">window</span>.location
    <span class="hljs-comment">//è¯¾ç¨‹id</span>
    <span class="hljs-keyword">this</span>.courseId = <span class="hljs-keyword">this</span>.$route.params.courseId
    <span class="hljs-comment">//ç« èŠ‚id</span>
    <span class="hljs-keyword">this</span>.chapter = <span class="hljs-keyword">this</span>.$route.params.chapter
    <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span>
    systemApi.course_view(<span class="hljs-keyword">this</span>.courseId).then(<span class="hljs-function">(<span class="hljs-params">view_course</span>)=&gt;</span>&#123;
        <span class="hljs-keyword">if</span>(!view_course || !view_course[<span class="hljs-keyword">this</span>.courseId])&#123;
            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"è·å–è¯¾ç¨‹ä¿¡æ¯å¤±è´¥ï¼Œè¯·é‡æ–°è¿›å…¥æ­¤é¡µé¢ï¼"</span>)
            <span class="hljs-keyword">return</span> ;
        &#125;
        <span class="hljs-keyword">let</span> courseInfo = view_course[<span class="hljs-keyword">this</span>.courseId]
        <span class="hljs-built_in">console</span>.log(courseInfo)
        <span class="hljs-keyword">this</span>.coursename = courseInfo.name
        <span class="hljs-keyword">if</span>(courseInfo.teachplan)&#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"å‡†å¤‡å¼€å§‹æ’­æ”¾è§†é¢‘"</span>)
            <span class="hljs-keyword">let</span> teachplan = <span class="hljs-built_in">JSON</span>.parse(courseInfo.teachplan);
            <span class="hljs-keyword">this</span>.teachplanList = teachplan.children;
            <span class="hljs-comment">//å¼€å§‹å­¦ä¹ </span>
            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.chapter == <span class="hljs-string">"0"</span> || !<span class="hljs-keyword">this</span>.chapter)&#123;
                <span class="hljs-comment">//å–å‡ºç¬¬ä¸€ä¸ªæ•™å­¦è®¡åˆ’</span>
                <span class="hljs-keyword">this</span>.chapter = <span class="hljs-keyword">this</span>.getFirstTeachplan();
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"ç¬¬ä¸€ä¸ªæ•™å­¦è®¡åˆ’idä¸º "</span>,<span class="hljs-keyword">this</span>.chapter);
                <span class="hljs-keyword">this</span>.study(<span class="hljs-keyword">this</span>.chapter);
            &#125;<span class="hljs-keyword">else</span>&#123;
                <span class="hljs-keyword">this</span>.study(<span class="hljs-keyword">this</span>.chapter);
            &#125;

        &#125;
    &#125;)
&#125;,</code></pre></div>

<p>å–å‡ºç¬¬ä¸€ä¸ªç« èŠ‚ <code>id</code>ï¼Œç”¨æˆ·æœªè¾“å…¥è¯¾ç¨‹è®¡åˆ’ <code>id</code> æˆ–è€…è¾“å…¥ä¸º <code>0</code> æ—¶ï¼Œæ’­æ”¾ç¬¬ä¸€ä¸ªã€‚</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//å–å‡ºç¬¬ä¸€ä¸ªç« èŠ‚</span>
getFirstTeachplan()&#123;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-keyword">this</span>.teachplanList.length;i++)&#123;
        <span class="hljs-keyword">let</span> firstTeachplan = <span class="hljs-keyword">this</span>.teachplanList[i];
		<span class="hljs-comment">//å¦‚æœå½“å‰childrenå­˜åœ¨ï¼Œåˆ™å–å‡ºç¬¬ä¸€ä¸ªè¿”å›</span>
        <span class="hljs-keyword">if</span>(firstTeachplan.children &amp;&amp; firstTeachplan.children.length&gt;<span class="hljs-number">0</span>)&#123;
            <span class="hljs-keyword">let</span> secondTeachplan = firstTeachplan.children[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">return</span> secondTeachplan.id;
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> ;
&#125;,</code></pre></div>

<p>å¼€å§‹å­¦ä¹ ï¼š</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//å¼€å§‹å­¦ä¹ </span>
study(chapter)&#123;
    <span class="hljs-comment">// è·å–æ’­æ”¾åœ°å€</span>
    courseApi.get_media(<span class="hljs-keyword">this</span>.courseId,chapter).then(<span class="hljs-function">(<span class="hljs-params">res</span>)=&gt;</span>&#123;
        <span class="hljs-keyword">if</span>(res.success)&#123;
            <span class="hljs-keyword">let</span> fileUrl = sysConfig.videoUrl + res.fileUrl
            <span class="hljs-comment">//æ’­æ”¾è§†é¢‘</span>
            <span class="hljs-keyword">this</span>.playvideo(fileUrl)
        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(res.message)&#123;
            <span class="hljs-keyword">this</span>.$message.error(res.message)
        &#125;<span class="hljs-keyword">else</span>&#123;
            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"æ’­æ”¾è§†é¢‘å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•"</span>)
        &#125;
    &#125;).catch(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;
        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">"æ’­æ”¾è§†é¢‘å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•"</span>)
    &#125;);
&#125;,</code></pre></div>

<p>2ã€ç‚¹å‡»å³ä¾§è¯¾ç¨‹ç« èŠ‚åˆ‡æ¢æ’­æ”¾</p>
<p>åœ¨åŸæœ‰ä»£ç åŸºç¡€ä¸Šæ·»åŠ  <code>click</code> äº‹ä»¶ï¼Œç‚¹å‡»è°ƒç”¨å¼€å§‹å­¦ä¹ æ–¹æ³•ï¼ˆ<code>study</code>ï¼‰ã€‚</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">if</span>=<span class="hljs-string">"teachplan_first.children!=null"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">for</span>=<span class="hljs-string">"(teachplan_second, index) in</span></span>
<span class="hljs-tag"><span class="hljs-string">teachplan_first.children"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">i</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glyphicon glyphiconâ€check"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">i</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">"url"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"study(teachplan_second.id)"</span>&gt;</span>
&#123;&#123;teachplan_second.pname&#125;&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></code></pre></div>

<p>3ã€åœ°å€æ è·¯ç”±urlå˜æ›´</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ç”¨æˆ·ç‚¹å‡»è¯¾ç¨‹ç« èŠ‚åˆ‡æ¢æ’­æ”¾æ—¶ï¼Œåœ°å€æ çš„ <code>url</code> ä¹Ÿåº”è¯¥åŒæ­¥æ”¹å˜ä¸ºå½“å‰æ‰€é€‰æ‹©çš„è¯¾ç¨‹è®¡åˆ’ <code>id</code></p>
<p>4ã€åœ¨çº¿å­¦ä¹ æŒ‰é’®</p>
<p>å°† <code>learnstatus</code> é»˜è®¤æ›´æ”¹ä¸º <code>1</code>ï¼Œè¿™æ ·å°±èƒ½æ˜¾ç¤ºå‡ºé©¬ä¸Šå­¦ä¹ çš„æŒ‰é’®ï¼Œæ–¹ä¾¿æˆ‘ä»¬åç»­çš„é›†æˆæµ‹è¯•ã€‚</p>
<p>æ–‡ä»¶è·¯å¾„ä¸º <code>xc-ui-pc-static-portal/include/course_detail_dynamic.html</code> éƒ¨åˆ†ä»£ç å—å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs js">&lt;script&gt;

   <span class="hljs-keyword">var</span> body= <span class="hljs-keyword">new</span> Vue(&#123;   <span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªVueçš„å®ä¾‹</span>
        el: <span class="hljs-string">"#body"</span>, <span class="hljs-comment">//æŒ‚è½½ç‚¹æ˜¯id="app"çš„åœ°æ–¹</span>

        data: &#123;
            editLoading: <span class="hljs-literal">false</span>,
            title:<span class="hljs-string">'æµ‹è¯•'</span>,
            courseId:<span class="hljs-string">''</span>,
            charge:<span class="hljs-string">''</span>,<span class="hljs-comment">//203001å…è´¹,203002æ”¶è´¹</span>
            learnstatus: <span class="hljs-number">1</span> ,<span class="hljs-comment">//è¯¾ç¨‹çŠ¶æ€ï¼Œ1ï¼šé©¬ä¸Šå­¦ä¹ ï¼Œ2ï¼šç«‹å³æŠ¥åã€3ï¼šç«‹å³è´­ä¹°</span>
            course:&#123;&#125;,
            companyId:<span class="hljs-string">'template'</span>,
            company_stat:[],
            course_stat:&#123;<span class="hljs-string">"s601001"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"s601002"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"s601003"</span>:<span class="hljs-string">""</span>&#125;


        &#125;,</code></pre></div>

<h3 id="ç®€å•çš„æµ‹è¯•"><a href="#ç®€å•çš„æµ‹è¯•" class="headerlink" title="ç®€å•çš„æµ‹è¯•"></a>ç®€å•çš„æµ‹è¯•</h3><p>è®¿é—®åœ¨çº¿å­¦ä¹ é¡µé¢ï¼š<code>http://ucenter.xuecheng.com/#/learning/è¯¾ç¨‹id/è¯¾ç¨‹è®¡åˆ’id</code></p>
<p>é€šè¿‡ <code>url</code> ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š<code>è¯¾ç¨‹id</code> å’Œ <code>è¯¾ç¨‹è®¡åˆ’id</code></p>
<p>å¦‚æœæ²¡æœ‰è¯¾ç¨‹è®¡åˆ’åˆ™ä¼ å…¥0</p>
<p>æµ‹è¯•é¡¹ç›®å¦‚ä¸‹ï¼š</p>
<p>1ã€ä¼ å…¥æ­£ç¡®çš„è¯¾ç¨‹idã€è¯¾ç¨‹è®¡åˆ’idï¼Œè‡ªåŠ¨æ’­æ”¾æœ¬ç« èŠ‚çš„è§†é¢‘</p>
<p>2ã€ä¼ å…¥æ­£ç¡®çš„è¯¾ç¨‹idã€è¯¾ç¨‹è®¡åˆ’idä¼ å…¥0ï¼Œè‡ªåŠ¨æ’­æ”¾ç¬¬ä¸€ä¸ªè§†é¢‘</p>
<p>3ã€ä¼ å…¥é”™è¯¯çš„è¯¾ç¨‹id æˆ– è¯¾ç¨‹è®¡åˆ’idï¼Œæç¤ºé”™è¯¯ä¿¡æ¯ã€‚</p>
<p>4ã€é€šè¿‡å³ä¾§ç« èŠ‚ç›®å½•åˆ‡æ¢ç« èŠ‚åŠæ’­æ”¾è§†é¢‘ã€‚</p>
<p>è®¿é—®ï¼š <a href="http://ucenter.xuecheng.com/#/learning/4028e58161bcf7f40161bcf8b77c0000/4028e58161bd18ea0161bd1f73190008" target="_blank" rel="noopener">http://ucenter.xuecheng.com/#/learning/4028e58161bcf7f40161bcf8b77c0000/4028e58161bd18ea0161bd1f73190008</a></p>
<p>ä¼ å…¥æ­£ç¡®çš„è¯¾ç¨‹idã€è¯¾ç¨‹è®¡åˆ’idï¼Œè‡ªåŠ¨æ’­æ”¾æœ¬ç« èŠ‚çš„è§†é¢‘</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image17" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image17.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¼ å…¥æ­£ç¡®çš„è¯¾ç¨‹idã€è¯¾ç¨‹è®¡åˆ’idä¼ å…¥0ï¼Œè‡ªåŠ¨æ’­æ”¾ç¬¬ä¸€ä¸ªè§†é¢‘</p>
<p>è®¿é—® <a href="http://ucenter.xuecheng.com/#/learning/4028e58161bcf7f40161bcf8b77c0000/0" target="_blank" rel="noopener">http://ucenter.xuecheng.com/#/learning/4028e58161bcf7f40161bcf8b77c0000/0</a></p>
<p>è¯†åˆ«å‡ºç¬¬ä¸€ä¸ªè¯¾ç¨‹è®¡åˆ’çš„ <code>id</code></p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image18" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image18.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„ <code>chapter</code> å‚æ•°æ˜¯æˆ‘è‡ªå·±åœ¨ <code>study</code> å‡½æ•°é‡ŒåŠ ä¸Šå»çš„ï¼Œå¯ä»¥å¿½ç•¥ã€‚</p>
<p>ä¼ å…¥é”™è¯¯çš„è¯¾ç¨‹idæˆ–è¯¾ç¨‹è®¡åˆ’idï¼Œæç¤ºé”™è¯¯ä¿¡æ¯ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image19" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image19.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>é€šè¿‡å³ä¾§ç« èŠ‚ç›®å½•åˆ‡æ¢ç« èŠ‚åŠæ’­æ”¾è§†é¢‘ã€‚</p>
<p>ç‚¹å‡»ç« èŠ‚å³å¯æ’­æ”¾ï¼Œä½†æ˜¯ç‚¹å‡»åˆ¶å®šç« èŠ‚å <code>url</code> æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œè¿™ä¸ªé—®é¢˜æš‚æ—¶è¿˜æ²¡æœ‰è§£å†³ï¼Œå…³æ³¨ç¬”è®°åé¢çš„å†…å®¹ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image20" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image20.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="å®Œæ•´çš„æµ‹è¯•"><a href="#å®Œæ•´çš„æµ‹è¯•" class="headerlink" title="å®Œæ•´çš„æµ‹è¯•"></a>å®Œæ•´çš„æµ‹è¯•</h3><p>å‡†å¤‡å·¥ä½œ</p>
<ul>
<li>å¯åŠ¨ <code>RabbitMQ</code>ï¼Œå¯åŠ¨ <code>Logstash</code>ã€<code>ElasticSearch</code></li>
<li>å»ºè®®æŠŠæ‰€æœ‰åç«¯æœåŠ¡éƒ½å¼€èµ·æ¥</li>
<li>å¯åŠ¨ å‰ç«¯é™æ€é—¨æˆ·ã€å¯åŠ¨ <code>nginx</code> ã€å¯åŠ¨è¯¾ç¨‹ç®¡ç†å‰ç«¯</li>
</ul>
<p>æˆ‘ä»¬æ•´ç†ä¸€ä¸‹æµ‹è¯•çš„æµç¨‹</p>
<ol>
<li>ä¸Šä¼ ä¸¤ä¸ªåª’èµ„è§†é¢‘æ–‡ä»¶ï¼Œç”¨äºæµ‹è¯•</li>
<li>è¿›å…¥åˆ°è¯¾ç¨‹ç®¡ç†ï¼Œä¸ºè¯¾ç¨‹è®¡åˆ’é€‰æ‹©åª’èµ„ä¿¡æ¯</li>
<li>å‘å¸ƒè¯¾ç¨‹ï¼Œç­‰å¾… <code>logstash</code> å°†æ•°æ®é‡‡é›†åˆ° <code>ElasticSearch</code> çš„ç´¢å¼•åº“ä¸­</li>
<li>è¿›å…¥å­¦æˆç½‘ä¸»é¡µï¼Œç‚¹å‡»è¯¾ç¨‹ï¼Œè¿›å…¥åˆ°æœç´¢é—¨æˆ·é¡µé¢</li>
<li>æœç´¢è¯¾ç¨‹ï¼Œè¿›å…¥åˆ°è¯¾ç¨‹è¯¦æƒ…é¡µé¢</li>
<li>ç‚¹å‡»å¼€å§‹å­¦ä¹ ï¼Œè¿›å…¥åˆ°è¯¾ç¨‹å­¦ä¹ é¡µé¢ï¼Œé€‰æ‹©è¯¾ç¨‹è®¡åˆ’ä¸­çš„ä¸€ä¸ªç« èŠ‚è¿›è¡Œå­¦ä¹ ã€‚</li>
</ol>
<h4 id="1ã€ä¸Šä¼ æ–‡ä»¶"><a href="#1ã€ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="1ã€ä¸Šä¼ æ–‡ä»¶"></a>1ã€ä¸Šä¼ æ–‡ä»¶</h4><p>é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰å¼€å‘çš„åª’èµ„ç®¡ç†æ¨¡å—ï¼Œä¸Šä¼ ä¸¤ä¸ªè§†é¢‘æ–‡ä»¶ç”¨äºæµ‹è¯•ã€‚</p>
<p>ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ æˆåŠŸ</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image21" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image21.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="ä¸€äº›é—®é¢˜"><a href="#ä¸€äº›é—®é¢˜" class="headerlink" title="ä¸€äº›é—®é¢˜"></a>ä¸€äº›é—®é¢˜</h5><p>åœ¨ä¸Šä¼ ç¬¬äºŒä¸ªæ–‡ä»¶æ—¶ï¼Œå‘ç”Ÿäº†é”™è¯¯ï¼Œæˆ‘ä»¬æ¥æ£€æŸ¥ä¸€ä¸‹é—®é¢˜å‡ºåœ¨äº†å“ªé‡Œ</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image22" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image22.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>åœ¨åª’ä½“æœåŠ¡çš„æ§åˆ¶å°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ <code>mergeChunks</code> æ–¹æ³•åœ¨æ ¡éªŒæ–‡ä»¶ <code>md5</code> æ—¶å€™æŠ›å‡ºäº†å¼‚å¸¸</p>
<p>æˆ‘ä»¬åœ¨ <code>MD5</code> æ ¡éªŒè¿™é‡Œæ‰“ä¸ªæ–­ç‚¹ï¼Œé‡æ–°ä¸Šä¼ æ–‡ä»¶ï¼Œåˆ†æä¸€ä¸‹é—®é¢˜æ‰€åœ¨ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image23" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image23.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å•æ­¥è°ƒè¯•åå‘ç°ï¼Œåˆå¹¶æ–‡ä»¶åçš„MD5å€¼ä¸ç”¨æˆ·ä¸Šä¼ çš„æºæ–‡ä»¶å€¼ä¸ç›¸ç­‰</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image24" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image24.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="æ–¹æ¡ˆ1ï¼šåˆ é™¤æœ¬åœ°åˆ†å—æ–‡ä»¶é‡æ–°å°è¯•ä¸Šä¼ "><a href="#æ–¹æ¡ˆ1ï¼šåˆ é™¤æœ¬åœ°åˆ†å—æ–‡ä»¶é‡æ–°å°è¯•ä¸Šä¼ " class="headerlink" title="æ–¹æ¡ˆ1ï¼šåˆ é™¤æœ¬åœ°åˆ†å—æ–‡ä»¶é‡æ–°å°è¯•ä¸Šä¼ "></a><del>æ–¹æ¡ˆ1ï¼šåˆ é™¤æœ¬åœ°åˆ†å—æ–‡ä»¶é‡æ–°å°è¯•ä¸Šä¼ </del></h5><p>è€ƒè™‘åˆ°å¯èƒ½æ˜¯åœ¨ç”¨æˆ·ä¸Šä¼ å®Œ è§†é¢‘çš„åˆ†å—æ–‡ä»¶æ—¶å‘ç”Ÿäº†ä¸€äº›é—®é¢˜ï¼Œå¯¼è‡´åˆå¹¶æ–‡ä»¶åä¸æºæ–‡ä»¶çš„å¤§å°ä¸ç­‰ï¼Œå¯¼è‡´MD5ä¹Ÿä¸ç›¸åŒï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠè¿™ä¸ªè§†é¢‘ä¸Šä¼ åˆ°æœ¬åœ°çš„æ–‡ä»¶å…¨éƒ¨åˆ é™¤ï¼Œåœ¨åª’èµ„ä¸Šä¼ é¡µé¢é‡æ–°ä¸Šä¼ æ–‡ä»¶ã€‚</p>
<p>å¯¹æ¯”æ‰€æœ‰åˆ†å—æ–‡ä»¶çš„å­—èŠ‚å¤§å°å’Œæœ¬åœ°æºæ–‡ä»¶çš„å¤§å°ï¼Œå®Œå…¨æ˜¯ç›¸ç­‰çš„</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image25" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image25.png" srcset="/img/loading.gif" alt="img"></a></p>
<blockquote>
<p>åˆ é™¤æ‰€æœ‰æ–‡ä»¶åé‡æ–°ä¸Šä¼ ï¼Œmd5å€¼è¿˜æ˜¯ä¸ç­‰ï¼Œè€ƒè™‘ä»è°ƒè¯•ä¸€ä¸‹æ–‡ä»¶åˆå¹¶çš„ä»£ç ã€‚</p>
</blockquote>
<h5 id="æ–¹æ¡ˆ2ï¼šæ£€æŸ¥å‰ç«¯æäº¤çš„MD5å€¼æ˜¯å¦æ­£ç¡®"><a href="#æ–¹æ¡ˆ2ï¼šæ£€æŸ¥å‰ç«¯æäº¤çš„MD5å€¼æ˜¯å¦æ­£ç¡®" class="headerlink" title="æ–¹æ¡ˆ2ï¼šæ£€æŸ¥å‰ç«¯æäº¤çš„MD5å€¼æ˜¯å¦æ­£ç¡®"></a>æ–¹æ¡ˆ2ï¼šæ£€æŸ¥å‰ç«¯æäº¤çš„MD5å€¼æ˜¯å¦æ­£ç¡®</h5><p>åœ¨æŸ¥é˜…æ˜¯å¦æœ‰å…¶ä»–çš„MD5å€¼è·å–æ–¹æ¡ˆæ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªä½¿ç”¨ <code>windows</code> æœ¬åœ°å‘½ä»¤è·å–æ–‡ä»¶MD5å€¼çš„æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs angelscript">certutil -hashfile .\<span class="hljs-number">19</span>-åœ¨çº¿å­¦ä¹ æ¥å£-é›†æˆæµ‹è¯•.avi md5</code></pre></div>

<p>æƒŠå¥‡çš„å‘ç°ï¼ŒTMçš„åŸæ¥æ˜¯å‰ç«¯é‚£è¾¹è½¬æ¢çš„MD5å€¼ä¸æ­£ç¡®ï¼Œåç«¯è¿™è¾¹æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image26" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image26.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä»å‰é¢çš„å›¾å¯ä»¥çœ‹å‡ºï¼Œæœ¬åœ°å’Œåç«¯è½¬æ¢çš„éƒ½æ˜¯ä»¥ä¸€ä¸ª <code>f6f0</code> å¼€å¤´çš„MD5å€¼</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image27" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image27.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>é‚£ä¹ˆé—®é¢˜å°±å‡ºç°åœ¨å‰ç«¯äº†ï¼Œè¿˜éœ€è¦èŠ±ä¸€äº›æ—¶é—´å»åˆ†æä¸€ä¸‹ï¼Œè¿™é‡Œæš‚æ—¶å°±å…ˆå‘Šä¸€æ®µè½ï¼Œå› ä¸ºä¸Šä¼ äº†å‡ ä¸ªæ–‡ä»¶æµ‹è¯•ä¸­åªæœ‰è¿™ä¸€ä¸ªæ–‡ä»¶å‡ºç°äº†é—®é¢˜ã€‚</p>
<h4 id="2ã€ä¸ºè¯¾ç¨‹è®¡åˆ’é€‰æ‹©åª’èµ„ä¿¡æ¯"><a href="#2ã€ä¸ºè¯¾ç¨‹è®¡åˆ’é€‰æ‹©åª’èµ„ä¿¡æ¯" class="headerlink" title="2ã€ä¸ºè¯¾ç¨‹è®¡åˆ’é€‰æ‹©åª’èµ„ä¿¡æ¯"></a>2ã€ä¸ºè¯¾ç¨‹è®¡åˆ’é€‰æ‹©åª’èµ„ä¿¡æ¯</h4><p>è¿›å…¥åˆ°ä¸€ä¸ªè¯¾ç¨‹çš„ç®¡ç†é¡µé¢</p>
<p><a href="http://localhost:12000/#/course/manage/baseinfo/4028e58161bcf7f40161bcf8b77c0000" target="_blank" rel="noopener">http://localhost:12000/#/course/manage/baseinfo/4028e58161bcf7f40161bcf8b77c0000</a></p>
<p>å°†åˆšæ‰æˆ‘ä»¬ä¸Šä¼ çš„åª’èµ„æ–‡ä»¶çš„ä¿¡æ¯å’Œè¯¾ç¨‹è®¡åˆ’ç»‘å®š</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image28" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image28.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>é€‰æ‹©æ•ˆæœå¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image29" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image29.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>2ã€å‘å¸ƒè¯¾ç¨‹ï¼Œç­‰å¾… <code>logstash</code> ä» <code>course_pub</code> ä»¥åŠ <code>teachplan_media_pub</code> è¡¨ä¸­é‡‡é›†æ•°æ®åˆ° <code>ElasticSearch</code> å½“ä¸­</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image30" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image30.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å‘å¸ƒæˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥ä» <code>teachplan_media_pub</code> è¡¨ä¸­çœ‹åˆ°åˆšæ‰æˆ‘ä»¬å‘å¸ƒçš„åª’èµ„ä¿¡æ¯</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image31" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image31.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å†è§‚å¯Ÿ Logstash çš„æ§åˆ¶å°ï¼Œå‘ç°ä¸¤ä¸ª Logstash çš„å®ä¾‹éƒ½å¯¹æ›´æ–°çš„è¯¾ç¨‹å‘å¸ƒä¿¡æ¯è¿›è¡Œäº†é‡‡é›†</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image32" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image32.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="3ã€å‰ç«¯é—¨æˆ·æµ‹è¯•"><a href="#3ã€å‰ç«¯é—¨æˆ·æµ‹è¯•" class="headerlink" title="3ã€å‰ç«¯é—¨æˆ·æµ‹è¯•"></a>3ã€å‰ç«¯é—¨æˆ·æµ‹è¯•</h4><p>æ‰“å¼€æˆ‘ä»¬çš„é—¨æˆ·ä¸»ç«™ <code>http://www.xuecheng.com/</code></p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image33" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image33.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç‚¹å‡»å¯¼èˆªæ çš„è¯¾ç¨‹ï¼Œè¿›å…¥åˆ°æˆ‘ä»¬çš„æœç´¢é—¨æˆ·é¡µé¢</p>
<blockquote>
<p>å¦‚æœæ— æ³•è¿›å…¥åˆ°æœç´¢é—¨æˆ·ï¼Œè¯·æ£€æŸ¥ä½ çš„ xc-ui-pc-portal å‰ç«¯å·¥ç¨‹æ˜¯å¦å·²ç»å¯åŠ¨</p>
</blockquote>
<p>è¿›å…¥åˆ°æœç´¢é—¨æˆ·åï¼Œå¯ä»¥çœ‹åˆ°ä¸€äº›åˆå§‹åŒ–æ—¶æœç´¢çš„è¯¾ç¨‹æ•°æ®ï¼Œé»˜è®¤æ˜¯æœç´¢ç¬¬ä¸€é¡µçš„æ•°æ®ï¼Œæ¯é¡µ2ä¸ªè¯¾ç¨‹ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image34" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image34.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æˆ‘ä»¬å¯ä»¥æµ‹è¯•æœç´¢ä¸€ä¸‹å‰é¢æˆ‘ä»¬é€‰æ‹©åª’èµ„ä¿¡æ¯æ—¶æ‰€ç”¨çš„è¯¾ç¨‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image35" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image35.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç‚¹å‡»è¯¾ç¨‹ï¼Œè¿›å…¥åˆ°è¯¾ç¨‹è¯¦æƒ…é¡µé¢ï¼Œç„¶åå†ç‚¹å‡»å¼€å§‹å­¦ä¹ ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image36" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image36.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç‚¹å‡»é©¬ä¸Šå­¦ä¹ åï¼Œä¼šè¿›å…¥åˆ°è¯¥è¯¾ç¨‹çš„åœ¨çº¿å­¦ä¹ é¡µé¢ï¼Œé»˜è®¤è‡ªåŠ¨æ’­æ”¾æˆ‘ä»¬ç¬¬ä¸€ä¸ªè¯¾ç¨‹è®¡åˆ’ä¸­çš„è§†é¢‘ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image37" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image37.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨å³ä¾§çš„ç›®å½•ä¸­é€‰æ‹©ç¬¬äºŒä¸ªè¯¾ç¨‹è®¡åˆ’ï¼Œä¼šè‡ªåŠ¨æ’­æ”¾æ‰€é€‰çš„è¯¾ç¨‹è®¡åˆ’æ‰€å¯¹åº”çš„åª’èµ„è§†é¢‘æ’­æ”¾åœ°å€ï¼Œè¯¥ æ’­æ”¾åœ°å€æ­£æ˜¯æˆ‘ä»¬åˆšæ‰é€šè¿‡ <code>Logstash</code> è‡ªåŠ¨é‡‡é›†åˆ° <code>ElasticSearch</code> çš„ç´¢å¼•ä¿¡æ¯ï¼Œæ•ˆæœå›¾å¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_15/image38" target="_blank" rel="noopener"><img src="/2020/08/23/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday15/image38.png" srcset="/img/loading.gif" alt="img"></a></p>
<h1 id="å››ã€å¾…å®Œå–„çš„ä¸€äº›åŠŸèƒ½"><a href="#å››ã€å¾…å®Œå–„çš„ä¸€äº›åŠŸèƒ½" class="headerlink" title="å››ã€å¾…å®Œå–„çš„ä¸€äº›åŠŸèƒ½"></a>å››ã€å¾…å®Œå–„çš„ä¸€äº›åŠŸèƒ½</h1><ul>
<li>è¯¾ç¨‹å‘å¸ƒå‰ï¼Œæ ¡éªŒè¯¾ç¨‹è®¡åˆ’é‡Œé¢æ˜¯å¦åŒ…å«äºŒçº§è¯¾ç¨‹è®¡åˆ’</li>
<li>è¯¾ç¨‹å‘å¸ƒå‰ï¼Œæ ¡éªŒè¯¾ç¨‹è®¡åˆ’ä¿¡æ¯é‡Œé¢æ˜¯å¦å…¨éƒ¨åŒ…å«åª’èµ„ä¿¡æ¯</li>
<li>åˆ é™¤åª’èµ„ä¿¡æ¯ï¼Œå¹¶ä¸”åŒæ­¥åˆ é™¤ESä¸­çš„ç´¢å¼•</li>
<li>åœ¨è·å–è¯¥è¯¾ç¨‹çš„æ’­æ”¾åœ°å€æ—¶æ ¡éªŒç”¨æˆ·çš„åˆæ³•ã€</li>
<li>åœ¨çº¿å­¦ä¹ é¡µé¢ï¼Œç‚¹å‡»å³ä¾§ç›®å½•ä¸­çš„è¯¾ç¨‹è®¡åˆ’åŒæ—¶æ”¹å˜urlä¸­çš„è¯¾ç¨‹è®¡åˆ’åœ°å€</li>
<li>è§†é¢‘æ–‡ä»¶ <code>19-åœ¨çº¿å­¦ä¹ æ¥å£-é›†æˆæµ‹è¯•.avi</code> å‰ç«¯ä¸Šä¼ æ—¶æäº¤çš„MD5å€¼ä¸æ­£ç¡®</li>
</ul>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">å­¦æˆåœ¨çº¿</a>
                    
                  </div>
                
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/24/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday16/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day16ï¼šåŸºäºSpring Security Oauth2å¼€å‘è®¤è¯æœåŠ¡</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/21/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday14/">
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day14ï¼šåª’èµ„ç®¡ç†</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

ä»£ç å—js ç”¨ä¸åˆ°ï¼Œfulidè‡ªå¸¦æœ‰ï¼Œæ·»åŠ cssæ ·å¼å³å¯å®ç°
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®å­—</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å‹‰å¼ºè¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">äº¬ICPè¯123456å·</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>äº¬å…¬ç½‘å®‰å¤‡12345678å·</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "å­¦æˆåœ¨çº¿day15ï¼šåª’èµ„ç®¡ç†ç³»ç»Ÿé›†æˆ&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
