<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>å­¦æˆåœ¨çº¿day05ï¼šæ¶ˆæ¯ä¸­é—´ä»¶RabbitMQ - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ç§äººåšå®¢</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äºæˆ‘
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-11 13:33">
      2020-08-11
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.2k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      109
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p>
</blockquote>
<p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day05</code> çš„å†…å®¹</p>
<ul>
<li><code>RabbitMQ</code> çš„åŸºæœ¬åº”ç”¨åœºæ™¯</li>
<li>ä½¿ç”¨åŸç”Ÿ<code>RabbitMQ</code> åº“æ„å»ºç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å‹</li>
<li>æ•´åˆ <code>Springboot</code> å®ç° <code>RabbitMQ</code> ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ¨¡å‹</li>
</ul>
<h1 id="ä¸€ã€éœ€æ±‚åˆ†æ"><a href="#ä¸€ã€éœ€æ±‚åˆ†æ" class="headerlink" title="ä¸€ã€éœ€æ±‚åˆ†æ"></a>ä¸€ã€éœ€æ±‚åˆ†æ</h1><p><a href="https://qnoss.codeyee.com/20200704_5/image1" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image1.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>ä¸šåŠ¡æµç¨‹å¦‚ä¸‹ï¼š</strong></p>
<p>1ã€ç®¡ç†å‘˜è¿›å…¥ç®¡ç†ç•Œé¢ç‚¹å‡» â€œé¡µé¢å‘å¸ƒâ€ï¼Œå‰ç«¯è¯·æ±‚ <code>cms</code> é¡µé¢å‘å¸ƒæ¥å£ã€‚</p>
<p>2ã€cms é¡µé¢å‘å¸ƒæ¥å£æ‰§è¡Œé¡µé¢é™æ€åŒ–ï¼Œå¹¶å°†é™æ€åŒ–é¡µé¢(<code>html</code>æ–‡ä»¶)å­˜å‚¨è‡³<code>GridFS</code>ä¸­ã€‚</p>
<p>3ã€é™æ€åŒ–æˆåŠŸåï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€é¡µé¢å‘å¸ƒçš„æ¶ˆæ¯ã€‚é¡µé¢å‘å¸ƒçš„æœ€ç»ˆç›®æ ‡æ˜¯å°†é¡µé¢å‘å¸ƒåˆ°<strong>æœåŠ¡å™¨</strong>ã€‚é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å°†é¡µé¢å‘å¸ƒçš„æ¶ˆæ¯å‘é€ç»™å„ä¸ªæœåŠ¡å™¨ã€‚</p>
<p>4ã€æ¶ˆæ¯é˜Ÿåˆ—è´Ÿè´£å°†æ¶ˆæ¯å‘é€ç»™å„å„æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ <strong>Cms Client (Cmså®¢æˆ·ç«¯)</strong>ã€‚åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½² <strong>Cms Client(Cmså®¢æˆ·ç«¯)</strong>ï¼Œå®¢æˆ·ç«¯æ¥æ”¶æ¶ˆæ¯é˜Ÿåˆ—çš„é€šçŸ¥ã€‚</p>
<p>5ã€æ¯ä¸ªæ¥æ”¶åˆ°é¡µé¢å‘å¸ƒæ¶ˆæ¯çš„ <code>Cms Client</code> ä» <code>GridFS</code> è·å– <code>Html</code> é¡µé¢æ–‡ä»¶ï¼Œå¹¶å°† <code>Html</code> æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨ã€‚<code>CmsClient</code> æ ¹æ®é¡µé¢å‘å¸ƒæ¶ˆæ¯çš„å†…å®¹è¯·æ±‚ <code>GridFS</code> è·å–é¡µé¢æ–‡ä»¶ï¼Œå­˜å‚¨åœ¨æœ¬åœ°æœåŠ¡å™¨ ã€‚</p>
<h1 id="äºŒã€åˆè¯†RabbitMQ"><a href="#äºŒã€åˆè¯†RabbitMQ" class="headerlink" title="äºŒã€åˆè¯†RabbitMQ"></a>äºŒã€åˆè¯†RabbitMQ</h1><p>è¦å®ç°ä¸Šè¾¹é¡µé¢å‘å¸ƒçš„åŠŸèƒ½ï¼Œæœ‰ä¸€ä¸ªé‡è¦çš„ç¯èŠ‚å°±æ˜¯ç”±æ¶ˆæ¯é˜Ÿåˆ—å°†é¡µé¢å‘å¸ƒçš„æ¶ˆæ¯é€šçŸ¥ç»™å„å„æœåŠ¡å™¨ã€‚</p>
<p>æœ¬èŠ‚çš„æ•™å­¦ç›®æ ‡æ˜¯å¯¹MQçš„ç ”ç©¶ï¼š</p>
<p>1ã€ç†è§£MQçš„åº”ç”¨åœºæ™¯</p>
<p>2ã€ç†è§£MQå¸¸ç”¨çš„å·¥ä½œæ¨¡å¼</p>
<h2 id="1-ç®€å•çš„ä»‹ç»"><a href="#1-ç®€å•çš„ä»‹ç»" class="headerlink" title="1.ç®€å•çš„ä»‹ç»"></a>1.ç®€å•çš„ä»‹ç»</h2><h3 id="RabbitMQ-ç®€ä»‹"><a href="#RabbitMQ-ç®€ä»‹" class="headerlink" title="RabbitMQ ç®€ä»‹"></a>RabbitMQ ç®€ä»‹</h3><p>MQå…¨ç§°ä¸º Message Queueï¼Œå³æ¶ˆæ¯é˜Ÿåˆ—ï¼Œ <code>RabbitMQ</code>æ˜¯ç”± <code>erlang</code> è¯­è¨€å¼€å‘ï¼ŒåŸºäº<strong>AMQPï¼ˆAdvanced Message Queue é«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼‰</strong>åè®®å®ç°çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒæ˜¯ä¸€ç§åº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡æ–¹æ³•ï¼Œæ¶ˆæ¯é˜Ÿåˆ—åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘ä¸­åº”ç”¨éå¸¸å¹¿æ³›ã€‚</p>
<p>RabbitMQå®˜æ–¹åœ°å€ï¼š<a href="http://www.rabbitmq.com/" target="_blank" rel="noopener">http://www.rabbitmq.com/</a></p>
<p>å¼€å‘ä¸­æ¶ˆæ¯é˜Ÿåˆ—é€šå¸¸æœ‰å¦‚ä¸‹åº”ç”¨åœºæ™¯ï¼š</p>
<ul>
<li><p><strong>ä»»åŠ¡å¼‚æ­¥å¤„ç†</strong></p>
<p>å°†ä¸éœ€è¦åŒæ­¥å¤„ç†çš„å¹¶ä¸”è€—æ—¶é•¿çš„æ“ä½œç”±æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥æ¶ˆæ¯æ¥æ”¶æ–¹è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚æé«˜äº†åº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´ã€‚</p>
</li>
<li><p><strong>åº”ç”¨ç¨‹åºè§£è€¦åˆ</strong></p>
<p>MQç›¸å½“äºä¸€ä¸ªä¸­ä»‹ï¼Œç”Ÿäº§æ–¹é€šè¿‡MQä¸æ¶ˆè´¹æ–¹äº¤äº’ï¼Œå®ƒå°†åº”ç”¨ç¨‹åºè¿›è¡Œè§£è€¦åˆã€‚</p>
</li>
<li><p><strong>å¸‚åœºä¸Šè¿˜æœ‰å“ªäº›æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ</strong><br>ActiveMQï¼ŒRabbitMQï¼ŒZeroMQï¼ŒKafkaï¼ŒMetaMQï¼ŒRocketMQã€Redisã€‚</p>
</li>
<li><p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨RabbitMQå‘¢ï¼Ÿ</strong></p>
<p>1ã€ä½¿å¾—ç®€å•ï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚<br>2ã€åŸºäº <code>AMQP</code> åè®®ã€‚<br>3ã€ç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å®Œå–„ã€‚<br>4ã€é«˜å¹¶å‘æ€§èƒ½å¥½ï¼Œè¿™ä¸»è¦å¾—ç›Šäº <code>Erlang</code> è¯­è¨€ã€‚<br>5ã€Spring Boot é»˜è®¤å·²é›†æˆ <code>RabbitMQ</code></p>
</li>
</ul>
<h3 id="å…¶å®ƒç›¸å…³çŸ¥è¯†"><a href="#å…¶å®ƒç›¸å…³çŸ¥è¯†" class="headerlink" title="å…¶å®ƒç›¸å…³çŸ¥è¯†"></a>å…¶å®ƒç›¸å…³çŸ¥è¯†</h3><p>AMQPæ˜¯ä»€ä¹ˆ ï¼Ÿ</p>
<p><code>AMQP</code> æ˜¯ä¸€å¥—å…¬å¼€çš„æ¶ˆæ¯é˜Ÿåˆ—åè®®ï¼Œæœ€æ—©åœ¨2003å¹´è¢«æå‡ºï¼Œå®ƒæ—¨åœ¨ä»åè®®å±‚å®šä¹‰æ¶ˆæ¯é€šä¿¡æ•°æ®çš„æ ‡å‡†æ ¼å¼ï¼Œä¸ºçš„å°±æ˜¯è§£å†³ <code>MQ</code> å¸‚åœºä¸Šåè®®ä¸ç»Ÿä¸€çš„é—®é¢˜ã€‚<code>RabbitMQ</code> å°±æ˜¯éµå¾ª <code>AMQP</code> æ ‡å‡†åè®®å¼€å‘çš„MQæœåŠ¡ã€‚</p>
<p>JMSæ˜¯ä»€ä¹ˆ ï¼Ÿ</p>
<p><code>JMS</code>æ˜¯ <code>java</code> æä¾›çš„ä¸€å¥—æ¶ˆæ¯æœåŠ¡APIæ ‡å‡†ï¼Œå…¶ç›®çš„æ˜¯ä¸ºæ‰€æœ‰çš„ <code>java</code> åº”ç”¨ç¨‹åºæä¾›ç»Ÿä¸€çš„æ¶ˆæ¯é€šä¿¡çš„æ ‡å‡†ï¼Œç±»ä¼¼ <code>java</code> çš„ <code>jdbc</code>ï¼Œåªè¦éµå¾ª <code>jms</code> æ ‡å‡†çš„åº”ç”¨ç¨‹åºä¹‹é—´éƒ½å¯ä»¥è¿›è¡Œæ¶ˆæ¯é€šä¿¡ã€‚å®ƒå’Œ <code>AMQP</code> æœ‰ä»€ä¹ˆ ä¸åŒï¼Œ<code>jms</code> æ˜¯javaè¯­è¨€ä¸“å±çš„æ¶ˆæ¯æœåŠ¡æ ‡å‡†ï¼Œå®ƒæ˜¯åœ¨apiå±‚å®šä¹‰æ ‡å‡†ï¼Œå¹¶ä¸”åªèƒ½ç”¨äº <code>java</code> åº”ç”¨ï¼›è€Œ <code>AMQP</code> æ˜¯åœ¨åè®®å±‚å®šä¹‰çš„æ ‡å‡†ï¼Œæ˜¯è·¨è¯­è¨€çš„ ã€‚</p>
<h2 id="2-å¿«é€Ÿå…¥é—¨"><a href="#2-å¿«é€Ÿå…¥é—¨" class="headerlink" title="2. å¿«é€Ÿå…¥é—¨"></a>2. å¿«é€Ÿå…¥é—¨</h2><h3 id="RabbitMQ-çš„å·¥ä½œåŸç†"><a href="#RabbitMQ-çš„å·¥ä½œåŸç†" class="headerlink" title="RabbitMQ çš„å·¥ä½œåŸç†"></a>RabbitMQ çš„å·¥ä½œåŸç†</h3><p>ä¸‹å›¾æ˜¯ <code>RabbitMQ</code> çš„åŸºæœ¬ç»“æ„</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image2" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image2.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç»„æˆéƒ¨åˆ†è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>Broker</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡è¿›ç¨‹ï¼Œæ­¤è¿›ç¨‹åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼š<code>Exchange</code> å’Œ <code>Queue</code>ã€‚</li>
<li><strong>Exchange</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—äº¤æ¢æœºï¼ŒæŒ‰ä¸€å®šçš„è§„åˆ™å°†æ¶ˆæ¯è·¯ç”±è½¬å‘åˆ°æŸä¸ªé˜Ÿåˆ—ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œè¿‡æ»¤ã€‚</li>
<li><strong>Queue</strong>ï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‚¨å­˜æ¶ˆæ¯çš„é˜Ÿåˆ—ï¼Œæ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—å¹¶è½¬å‘ç»™æŒ‡å®šçš„æ¶ˆè´¹æ–¹ã€‚</li>
<li><strong>Producer</strong>ï¼šæ¶ˆæ¯ç”Ÿäº§è€…ï¼Œå³ç”Ÿäº§æ–¹å®¢æˆ·ç«¯ï¼Œç”Ÿäº§æ–¹å®¢æˆ·ç«¯å°†æ¶ˆæ¯å‘é€åˆ° <code>MQ</code> ã€‚</li>
<li><strong>Consumer</strong>ï¼šæ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œå³æ¶ˆè´¹æ–¹å®¢æˆ·ç«¯ï¼Œæ¥æ”¶ <code>MQ</code> è½¬å‘çš„æ¶ˆæ¯ã€‚</li>
</ul>
<p>æ¶ˆæ¯ <strong>å‘å¸ƒ</strong> ä¸ <strong>æ¥æ”¶</strong> æµç¨‹ï¼š</p>
<p>â€”â€“å‘é€æ¶ˆæ¯â€”â€“</p>
<p>1ã€ç”Ÿäº§è€…å’Œ <code>Broker</code> å»ºç«‹TCPè¿æ¥ã€‚</p>
<p>2ã€ç”Ÿäº§è€…å’Œ <code>Broker</code> å»ºç«‹é€šé“ã€‚</p>
<p>3ã€ç”Ÿäº§è€…é€šè¿‡é€šé“æ¶ˆæ¯å‘é€ç»™ <code>Broker</code> ï¼Œç”± <code>Exchange</code> å°†æ¶ˆæ¯è¿›è¡Œè½¬å‘ã€‚</p>
<p>4ã€<code>Exchange</code>å°†æ¶ˆæ¯è½¬å‘åˆ°æŒ‡å®šçš„ <code>Queue</code>ï¼ˆé˜Ÿåˆ—ï¼‰</p>
<p>â€”-æ¥æ”¶æ¶ˆæ¯â€”â€“</p>
<p>1ã€æ¶ˆè´¹è€…å’Œ <code>Broker</code> å»ºç«‹TCPè¿æ¥</p>
<p>2ã€æ¶ˆè´¹è€…å’Œ <code>Broker</code> å»ºç«‹é€šé“</p>
<p>3ã€æ¶ˆè´¹è€…ç›‘å¬æŒ‡å®šçš„ <code>Queue</code>ï¼ˆé˜Ÿåˆ—ï¼‰</p>
<p>4ã€å½“æœ‰æ¶ˆæ¯åˆ°è¾¾ <code>Queue</code> æ—¶ <code>Broker</code> é»˜è®¤å°†æ¶ˆæ¯æ¨é€ç»™æ¶ˆè´¹è€…ã€‚</p>
<p>5ã€æ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚</p>
<h3 id="å®‰è£…-RabbitMQ"><a href="#å®‰è£…-RabbitMQ" class="headerlink" title="å®‰è£… RabbitMQ"></a>å®‰è£… RabbitMQ</h3><h4 id="1ã€ä¸‹è½½å¹¶å®‰è£…"><a href="#1ã€ä¸‹è½½å¹¶å®‰è£…" class="headerlink" title="1ã€ä¸‹è½½å¹¶å®‰è£…"></a>1ã€ä¸‹è½½å¹¶å®‰è£…</h4><p>RabbitMQç”± <code>Erlang</code> è¯­è¨€å¼€å‘ï¼Œ<code>Erlang</code> è¯­è¨€ç”¨äºå¹¶å‘åŠåˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼€å‘ï¼Œåœ¨ç”µä¿¡é¢†åŸŸåº”ç”¨å¹¿æ³›ï¼ŒOTPï¼ˆOpenTelecom Platformï¼‰ä½œä¸º <code>Erlang</code> è¯­è¨€çš„ä¸€éƒ¨åˆ†ï¼ŒåŒ…å«äº†å¾ˆå¤šåŸºäº <code>Erlang</code> å¼€å‘çš„ä¸­é—´ä»¶åŠå·¥å…·åº“ï¼Œå®‰è£… <code>RabbitMQ</code> éœ€è¦å®‰è£… Erlang/OTPï¼Œå¹¶ä¿æŒç‰ˆæœ¬åŒ¹é…ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image3" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image3.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æœ¬é¡¹ç›®ä½¿ç”¨ <code>Erlang/OTP 20.3</code> ç‰ˆæœ¬å’Œ <code>RabbitMQ3.7.3</code> ç‰ˆæœ¬ã€‚</p>
<p>å®˜ç½‘ <code>RabbitMQ</code> çš„ä¸‹è½½åœ°å€ï¼š<a href="http://www.rabbitmq.com/download.html" target="_blank" rel="noopener">http://www.rabbitmq.com/download.html</a></p>
<h5 id="ä¸‹è½½erlang"><a href="#ä¸‹è½½erlang" class="headerlink" title="ä¸‹è½½erlang"></a>ä¸‹è½½erlang</h5><p>åœ°å€å¦‚ä¸‹ï¼š<a href="http://erlang.org/download/otp_win64_20.3.exe" target="_blank" rel="noopener">http://erlang.org/download/otp_win64_20.3.exe</a></p>
<p>erlangå®‰è£…å®Œæˆéœ€è¦é…ç½®erlangç¯å¢ƒå˜é‡ï¼š ERLANG_HOME=D:\Program Files\erl9.3 åœ¨pathä¸­æ·»<br>åŠ %ERLANG_HOME%\bin;</p>
<h5 id="å®‰è£…RabbitMQ"><a href="#å®‰è£…RabbitMQ" class="headerlink" title="å®‰è£…RabbitMQ"></a>å®‰è£…RabbitMQ</h5><p>ä¸‹è½½åœ°å€ <a href="https://github.com/rabbitmq/rabbitmq-server/releases/tag/v3.7.3" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-server/releases/tag/v3.7.3</a></p>
<p>è¿™é‡Œè¦æ³¨æ„ rabbitMQçš„å®‰è£…è·¯å¾„</p>
<h4 id="2ã€å¯åŠ¨"><a href="#2ã€å¯åŠ¨" class="headerlink" title="2ã€å¯åŠ¨"></a>2ã€å¯åŠ¨</h4><p>å®‰è£…æˆåŠŸåä¼šè‡ªåŠ¨åˆ›å»ºRabbitMQæœåŠ¡å¹¶ä¸”å¯åŠ¨ã€‚</p>
<ol>
<li><p>åœ¨ç³»ç»Ÿpathå˜é‡ä¸­æ·»åŠ  <code>rabbitMQ</code> çš„ç¯å¢ƒå˜é‡ï¼š<code>D:\[rabbitMQçš„å®‰è£…è·¯å¾„]\sbin;</code></p>
</li>
<li><p>æ·»åŠ ç¯å¢ƒå˜é‡åï¼ŒæŒ‰ä¸‹ <code>Win + X</code> ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œpowershell æˆ–è€… cmd</p>
</li>
<li><p>è¿è¡Œ <code>rabbitmq-plugins.bat enable rabbitmq_management</code> å‘½ä»¤</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image4" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image4.png" srcset="/img/loading.gif" alt="å®‰è£…è¿‡ç¨‹"></a></p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image4" target="_blank" rel="noopener">å®‰è£…è¿‡ç¨‹</a></p>
<p>â€‹</p>
</li>
<li><p>è¿è¡Œ <code>rabbitmq-service.bat stop</code> å’Œ <code>rabbitmq-service.bat start</code> é‡å¯ rabbitMQ</p>
</li>
<li><p>å¯åŠ¨æˆåŠŸï¼Œè®¿é—® <a href="http://localhost:15672/" target="_blank" rel="noopener">http://localhost:15672</a> ç™»å½•Rabbit MQï¼Œåˆå§‹è´¦å·å¯†ç ä¸º guest/guest</p>
</li>
</ol>
<h4 id="3ã€æ³¨æ„äº‹é¡¹"><a href="#3ã€æ³¨æ„äº‹é¡¹" class="headerlink" title="3ã€æ³¨æ„äº‹é¡¹"></a>3ã€æ³¨æ„äº‹é¡¹</h4><p>1ã€å®‰è£… <code>erlang</code> å’Œ <code>rabbitMQ</code> ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œã€‚</p>
<p>2ã€å½“å¸è½½é‡æ–°å®‰è£…æ—¶ä¼šå‡ºç° <code>RabbitMQ</code> æœåŠ¡æ³¨å†Œå¤±è´¥ï¼Œæ­¤æ—¶éœ€è¦è¿›å…¥æ³¨å†Œè¡¨æ¸…ç† <code>erlang</code><br>æœç´¢RabbitMQã€ErlSrvï¼Œå°†å¯¹åº”çš„é¡¹å…¨éƒ¨åˆ é™¤ã€‚</p>
<h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><p><a href="https://qnoss.codeyee.com/20200704_5/image5" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image5.png" srcset="/img/loading.gif" alt="å·¥ä½œæ¨¡å¼"></a></p>
<p>ä»¥ä¸‹è¿‡ç¨‹æˆ‘ä»¬å‚è€ƒå®˜æ–¹æ•™ç¨‹(<a href="http://www.rabbitmq.com/getstarted.html" target="_blank" rel="noopener">http://www.rabbitmq.com/getstarted.html</a>)æµ‹è¯•hello world:</p>
<h4 id="1ã€æ­å»ºç¯å¢ƒ"><a href="#1ã€æ­å»ºç¯å¢ƒ" class="headerlink" title="1ã€æ­å»ºç¯å¢ƒ"></a>1ã€æ­å»ºç¯å¢ƒ</h4><h5 id="java-client"><a href="#java-client" class="headerlink" title="java client"></a>java client</h5><p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½å±äºå®¢æˆ·ç«¯ï¼ŒrabbitMQçš„javaå®¢æˆ·ç«¯å¦‚ä¸‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image6" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image6.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æˆ‘ä»¬å…ˆç”¨ <code>rabbitMQ</code> å®˜æ–¹æä¾›çš„ <code>java client</code> æµ‹è¯•ï¼Œç›®çš„æ˜¯å¯¹ <code>RabbitMQ</code> çš„äº¤äº’è¿‡ç¨‹æœ‰ä¸ªæ¸…æ™°çš„è®¤è¯†ã€‚</p>
<p>å‚è€ƒ ï¼š<a href="https://github.com/rabbitmq/rabbitmq-java-client/" target="_blank" rel="noopener">https://github.com/rabbitmq/rabbitmq-java-client/</a></p>
<h5 id="åˆ›å»ºmavenå·¥ç¨‹"><a href="#åˆ›å»ºmavenå·¥ç¨‹" class="headerlink" title="åˆ›å»ºmavenå·¥ç¨‹"></a>åˆ›å»ºmavenå·¥ç¨‹</h5><p>åˆ›å»ºç”Ÿäº§è€…å·¥ç¨‹å’Œæ¶ˆè´¹è€…å·¥ç¨‹ï¼Œåˆ†åˆ«åŠ å…¥<code>RabbitMQ java client</code>çš„ä¾èµ–ã€‚</p>
<p>test-rabbitmq-producerï¼šç”Ÿäº§è€…å·¥ç¨‹</p>
<p>test-rabbitmq-consumerï¼šæ¶ˆè´¹è€…å·¥ç¨‹</p>
<p><strong>ä¾èµ–é…ç½®å¦‚ä¸‹ï¼š</strong></p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.rabbitmq<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>amqp-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-comment">&lt;!--æ­¤ç‰ˆæœ¬ä¸spring boot 1.5.9ç‰ˆæœ¬åŒ¹é…--&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div>

<p><a href="https://qnoss.codeyee.com/20200704_5/image7" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image7.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="2ã€ç”Ÿäº§è€…"><a href="#2ã€ç”Ÿäº§è€…" class="headerlink" title="2ã€ç”Ÿäº§è€…"></a>2ã€ç”Ÿäº§è€…</h4><p>åœ¨ç”Ÿäº§è€…å·¥ç¨‹ä¸‹çš„å•å…ƒæµ‹è¯•å†…åˆ›å»ºæµ‹è¯•ç±»å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;
<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;
<span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer01</span> </span>&#123;
    <span class="hljs-comment">//é˜Ÿåˆ—åç§°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE = <span class="hljs-string">"helloworld2"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;
        Connection connection = <span class="hljs-keyword">null</span>;
        Channel channel = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-comment">//æ„å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½®ä¸€äº›åŸºæœ¬çš„é“¾æ¥ä¿¡æ¯</span>
            ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();

            factory.setHost(<span class="hljs-string">"localhost"</span>);
            factory.setPort(<span class="hljs-number">5672</span>);
            factory.setUsername(<span class="hljs-string">"guest"</span>);
            factory.setPassword(<span class="hljs-string">"guest"</span>);
            <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>
            factory.setVirtualHost(<span class="hljs-string">"/"</span>);

            <span class="hljs-comment">//åˆ›å»ºä¸RabbitMQæœåŠ¡çš„TCPè¿æ¥</span>
            connection = factory.newConnection();

            <span class="hljs-comment">//åˆ›å»ºä¸Exchangeçš„é€šé“ï¼Œæ¯ä¸ªè¿æ¥å¯ä»¥åˆ›å»ºå¤šä¸ªé€šé“ï¼Œæ¯ä¸ªé€šé“ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡</span>
            channel = connection.createChannel();

            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * å£°æ˜é˜Ÿåˆ—ï¼Œå¦‚æœRabbitä¸­æ²¡æœ‰æ­¤é˜Ÿåˆ—ï¼Œå°†è‡ªåŠ¨åˆ›å»º</span>
<span class="hljs-comment">             * String queue, boolean durable, boolean exclusive, boolean autoDelete,Map&lt;String, Object&gt; arguments</span>
<span class="hljs-comment">             *</span>
<span class="hljs-comment">             * param1:é˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">             * param2:æ˜¯å¦æŒä¹…åŒ–</span>
<span class="hljs-comment">             * param3:é˜Ÿåˆ—æ˜¯å¦ç‹¬å æ­¤è¿æ¥</span>
<span class="hljs-comment">             * param4:é˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—</span>
<span class="hljs-comment">             * param5:é˜Ÿåˆ—å‚æ•°</span>
<span class="hljs-comment">             */</span>
            channel.queueDeclare(QUEUE,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);
            String message = <span class="hljs-string">"hello world å°æ˜"</span> + System.currentTimeMillis();

            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span>
<span class="hljs-comment">             æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span>
<span class="hljs-comment">             * param1ï¼šExchangeçš„åç§°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä½¿ç”¨Default Exchange</span>
<span class="hljs-comment">             * param2:routingKey,æ¶ˆæ¯çš„è·¯ç”±Keyï¼Œæ˜¯ç”¨äºExchangeï¼ˆäº¤æ¢æœºï¼‰å°†æ¶ˆæ¯è½¬å‘åˆ°æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—</span>
<span class="hljs-comment">             * param3:æ¶ˆæ¯åŒ…å«çš„å±æ€§</span>
<span class="hljs-comment">             * param4ï¼šæ¶ˆæ¯ä½“</span>
<span class="hljs-comment">             * è¿™é‡Œæ²¡æœ‰æŒ‡å®šäº¤æ¢æœºï¼Œæ¶ˆæ¯å°†å‘é€ç»™é»˜è®¤äº¤æ¢æœºï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¹Ÿä¼šç»‘å®šé‚£ä¸ªé»˜è®¤çš„äº¤æ¢æœºï¼Œä½†æ˜¯ä¸èƒ½æ˜¾ç¤ºç»‘å®šæˆ–è§£é™¤ç»‘å®š</span>
<span class="hljs-comment">             * é»˜è®¤çš„äº¤æ¢æœºï¼ŒroutingKeyç­‰äºé˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">             */</span>
            channel.basicPublish(<span class="hljs-string">""</span>,QUEUE,<span class="hljs-keyword">null</span>,message.getBytes());
            System.out.println(<span class="hljs-string">"Send Message is: ' "</span> + message + <span class="hljs-string">" '"</span>);

        &#125;<span class="hljs-keyword">catch</span> ( Exception ex)&#123;
            ex.printStackTrace();
        &#125;<span class="hljs-keyword">finally</span> &#123;
            <span class="hljs-comment">//å…ˆå…³é—­é€šé“ï¼Œå†å…³é—­è¿æ¥</span>
            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;
                channel.close();
            &#125;
            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;
                connection.close();
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div>

<p>è¿è¡Œç”Ÿäº§è€…åï¼Œ<code>RabbitMQ</code> åå°ä¼šæ¥æ”¶åˆ°ä¸€æ¡ç­‰å¾…æ¶ˆè´¹çš„æ¶ˆæ¯</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image8" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image8.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="3ã€æ¶ˆè´¹è€…"><a href="#3ã€æ¶ˆè´¹è€…" class="headerlink" title="3ã€æ¶ˆè´¹è€…"></a>3ã€æ¶ˆè´¹è€…</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.rabbitmq.client.*;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer01</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE = <span class="hljs-string">"helloworld2"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;
        ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
        factory.setHost(<span class="hljs-string">"localhost"</span>);
        factory.setPort(<span class="hljs-number">5672</span>);
        factory.setUsername(<span class="hljs-string">"guest"</span>);
        factory.setPassword(<span class="hljs-string">"guest"</span>);
        <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>
        factory.setVirtualHost(<span class="hljs-string">"/"</span>);

        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span>
        <span class="hljs-comment">/** å‚æ•°ï¼šString queue, boolean durable, boolean exclusive, boolean autoDelete,</span>
<span class="hljs-comment">         Map&lt;String, Object&gt; arguments</span>
<span class="hljs-comment">         * å‚æ•°æ˜ç»†ï¼š</span>
<span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">         * 2ã€durable æ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ï¼Œmqé‡å¯åé˜Ÿåˆ—è¿˜åœ¨</span>
<span class="hljs-comment">         * 3ã€exclusive æ˜¯å¦ç‹¬å è¿æ¥ï¼Œé˜Ÿåˆ—åªå…è®¸åœ¨è¯¥è¿æ¥ä¸­è®¿é—®ï¼Œå¦‚æœconnectionè¿æ¥å…³é—­ï¼Œé˜Ÿåˆ—åˆ™è‡ªåŠ¨åˆ é™¤,å¯ç”¨äºä¸´æ—¶é˜Ÿåˆ—çš„åˆ›å»º</span>
<span class="hljs-comment">         * 4ã€autoDelete è‡ªåŠ¨åˆ é™¤ï¼Œé˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—ï¼Œå¦‚æœå°†æ­¤å‚æ•°å’Œexclusiveå…±åŒä¸ºtrueï¼Œå°±å¯ä»¥å®ç°ä¸´æ—¶é˜Ÿåˆ—</span>
<span class="hljs-comment">         * 5ã€argmuacntsï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—æ‰©å±•å‚æ•°ï¼Œæ¯”å¦‚ï¼šå¯è®¾ç½®å­˜æ´»çš„æ—¶é—´</span>
<span class="hljs-comment">         */</span>
        channel.queueDeclare(QUEUE, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);

        <span class="hljs-comment">//å®šä¹‰æ¶ˆè´¹æ–¹æ³•</span>
        DefaultConsumer defaultConsumer = <span class="hljs-keyword">new</span> DefaultConsumer(channel) &#123;
            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * æ¶ˆè´¹è€…æ¥æ”¶æ¶ˆæ¯è°ƒç”¨æ­¤æ–¹æ³•</span>
<span class="hljs-comment">             * <span class="hljs-doctag">@param</span> consumerTag æ¶ˆè´¹è€…çš„æ ‡ç­¾ï¼Œåœ¨channel.basicConsume()å»æŒ‡å®š</span>
<span class="hljs-comment">             * <span class="hljs-doctag">@param</span> envelope æ¶ˆæ¯åŒ…çš„å†…å®¹ï¼Œå¯ä»ä¸­è·å–æ¶ˆæ¯idï¼Œæ¶ˆæ¯routingkeyï¼Œäº¤æ¢æœºï¼Œæ¶ˆæ¯å’Œé‡ä¼ æ ‡å¿—</span>
<span class="hljs-comment">            (æ”¶åˆ°æ¶ˆæ¯å¤±è´¥åæ˜¯å¦éœ€è¦é‡æ–°å‘é€)</span>
<span class="hljs-comment">             * <span class="hljs-doctag">@param</span> properties æ¶ˆæ¯å±æ€§</span>
<span class="hljs-comment">             * <span class="hljs-doctag">@param</span> body æ¶ˆæ¯å†…å®¹</span>
<span class="hljs-comment">             * <span class="hljs-doctag">@throws</span> IOException</span>
<span class="hljs-comment">            1ã€å‘é€ç«¯æ“ä½œæµç¨‹</span>
<span class="hljs-comment">            1ï¼‰åˆ›å»ºè¿æ¥</span>
<span class="hljs-comment">            2ï¼‰åˆ›å»ºé€šé“</span>
<span class="hljs-comment">            3ï¼‰å£°æ˜é˜Ÿåˆ—</span>
<span class="hljs-comment">            4ï¼‰å‘é€æ¶ˆæ¯</span>
<span class="hljs-comment">            2ã€æ¥æ”¶ç«¯</span>
<span class="hljs-comment">            1ï¼‰åˆ›å»ºè¿æ¥</span>
<span class="hljs-comment">            2ï¼‰åˆ›å»ºé€šé“</span>
<span class="hljs-comment">            3ï¼‰å£°æ˜é˜Ÿåˆ—</span>
<span class="hljs-comment">            4ï¼‰ç›‘å¬é˜Ÿåˆ—</span>
<span class="hljs-comment">            5ï¼‰æ¥æ”¶æ¶ˆæ¯</span>
<span class="hljs-comment">             */</span>
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleDelivery</span><span class="hljs-params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="hljs-keyword">byte</span>[] body)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
                <span class="hljs-comment">//äº¤æ¢æœº</span>
                String exchange = envelope.getExchange();
                <span class="hljs-comment">//è·¯ç”±key</span>
                String routingKey = envelope.getRoutingKey();
                <span class="hljs-comment">//æ¶ˆæ¯id</span>
                <span class="hljs-keyword">long</span> deliveryTag = envelope.getDeliveryTag();
                <span class="hljs-comment">//æ¶ˆæ¯å†…å®¹</span>
                String msg = <span class="hljs-keyword">new</span> String(body, <span class="hljs-string">"utf-8"</span>);
                System.out.println(<span class="hljs-string">"receive message.."</span> + msg);
            &#125;
        &#125;;

        <span class="hljs-comment">/**</span>
<span class="hljs-comment">         * ç›‘å¬é˜Ÿåˆ—String queue, boolean autoAck,Consumer callback</span>
<span class="hljs-comment">         * å‚æ•°æ˜ç»†</span>
<span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">         * 2ã€autoAck æ˜¯å¦è‡ªåŠ¨å›å¤ï¼Œè®¾ç½®ä¸ºtrueä¸ºè¡¨ç¤ºæ¶ˆæ¯æ¥æ”¶åˆ°è‡ªåŠ¨å‘mqå›å¤æ¥æ”¶åˆ°äº†ï¼Œmqæ¥æ”¶åˆ°å›å¤ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œè®¾ç½®ä¸ºfalseåˆ™éœ€è¦æ‰‹åŠ¨å›å¤</span>
<span class="hljs-comment">         * 3ã€callback æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³•ï¼Œæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åè°ƒç”¨æ­¤æ–¹æ³•</span>
<span class="hljs-comment">         */</span>
        channel.basicConsume(QUEUE, <span class="hljs-keyword">true</span>, defaultConsumer);
    &#125;
&#125;</code></pre></div>

<h4 id="4ã€æ¶ˆæ¯æ¥æ”¶æµ‹è¯•"><a href="#4ã€æ¶ˆæ¯æ¥æ”¶æµ‹è¯•" class="headerlink" title="4ã€æ¶ˆæ¯æ¥æ”¶æµ‹è¯•"></a>4ã€æ¶ˆæ¯æ¥æ”¶æµ‹è¯•</h4><p><a href="https://qnoss.codeyee.com/20200704_5/image9" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image9.gif" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-å·¥ä½œæ¨¡å¼"><a href="#3-å·¥ä½œæ¨¡å¼" class="headerlink" title="3. å·¥ä½œæ¨¡å¼"></a>3. å·¥ä½œæ¨¡å¼</h2><p><code>RabbitMQ</code> æœ‰ä»¥ä¸‹å‡ ç§å·¥ä½œæ¨¡å¼ ï¼š</p>
<p>1ã€Work queuesï¼Œå·¥ä½œé˜Ÿåˆ—æ¨¡å¼</p>
<p>2ã€Publish/Subscribeï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼</p>
<p>3ã€Routingï¼Œè·¯ç”±æ¨¡å¼</p>
<p>4ã€Topicsï¼Œé€šé…ç¬¦æ¨¡å¼</p>
<p>5ã€Headerï¼Œheaderæ¨¡å¼</p>
<p>6ã€RPC ï¼Œrpcæ¨¡å¼</p>
<h3 id="Work-queues-æ¨¡å¼"><a href="#Work-queues-æ¨¡å¼" class="headerlink" title="Work queues æ¨¡å¼"></a>Work queues æ¨¡å¼</h3><p><code>work queues</code> å·¥ä½œæ¨¡å¼ï¼Œä¸å…¥é—¨ç¨‹åºç›¸æ¯”ï¼Œå¤šäº†ä¸€ä¸ªæ¶ˆè´¹ç«¯ï¼Œä¸¤ä¸ªæ¶ˆè´¹ç«¯å…±åŒæ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</p>
<p>åº”ç”¨åœºæ™¯ï¼šå¯¹äº <strong>ä»»åŠ¡è¿‡é‡</strong> æˆ– <strong>ä»»åŠ¡è¾ƒå¤š</strong> æƒ…å†µä½¿ç”¨å·¥ä½œé˜Ÿåˆ—å¯ä»¥æé«˜ä»»åŠ¡å¤„ç†çš„é€Ÿåº¦ ã€‚</p>
<p><strong>æµ‹è¯•ï¼š</strong></p>
<p>1ã€ä½¿ç”¨å…¥é—¨ç¨‹åºï¼Œå¯åŠ¨å¤šä¸ªæ¶ˆè´¹è€…ã€‚</p>
<p>2ã€ç”Ÿäº§è€…å‘é€å¤šä¸ªæ¶ˆæ¯ã€‚</p>
<p><strong>æµ‹è¯•ç»“æœï¼š</strong></p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image10" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image10.gif" srcset="/img/loading.gif" alt="img"></a></p>
<p>1ã€ä¸€æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ”¶ï¼›</p>
<p>2ã€<code>rabbit</code> é‡‡ç”¨ <strong>è½®è¯¢</strong> çš„æ–¹å¼å°†æ¶ˆæ¯æ˜¯å¹³å‡å‘é€ç»™æ¶ˆè´¹è€…çš„ï¼›</p>
<p>3ã€æ¶ˆè´¹è€…åœ¨å¤„ç†å®ŒæŸæ¡æ¶ˆæ¯åï¼Œæ‰ä¼šæ”¶åˆ°ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚</p>
<h3 id="Publish-Subscribe-æ¨¡å¼"><a href="#Publish-Subscribe-æ¨¡å¼" class="headerlink" title="Publish/Subscribe æ¨¡å¼"></a>Publish/Subscribe æ¨¡å¼</h3><h4 id="1ã€å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#1ã€å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="1ã€å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>1ã€å‘å¸ƒè®¢é˜…æ¨¡å¼</h4><p><a href="https://qnoss.codeyee.com/20200704_5/image11" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image11.png" srcset="/img/loading.gif" alt="å‘å¸ƒè®¢é˜…æ¨¡å¼"></a></p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image11" target="_blank" rel="noopener"></a></p>
<p>1ã€æ¯ä¸ªæ¶ˆè´¹è€…ç›‘å¬è‡ªå·±çš„é˜Ÿåˆ—ã€‚</p>
<p>2ã€ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™ <code>broker</code>ï¼Œç”±äº¤æ¢æœºå°†æ¶ˆæ¯è½¬å‘åˆ°ç»‘å®šæ­¤äº¤æ¢æœºçš„æ¯ä¸ªé˜Ÿåˆ—ï¼Œæ¯ä¸ªç»‘å®šäº¤æ¢æœºçš„é˜Ÿåˆ—éƒ½å°†æ¥æ”¶åˆ°æ¶ˆæ¯ ã€‚</p>
<h4 id="2ã€ä»£ç "><a href="#2ã€ä»£ç " class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><p>æ¡ˆä¾‹ï¼š</p>
<p>ç”¨æˆ·é€šçŸ¥ï¼Œå½“ç”¨æˆ·å……å€¼æˆåŠŸæˆ–è½¬è´¦å®Œæˆç³»ç»Ÿé€šçŸ¥ç”¨æˆ·ï¼Œé€šçŸ¥æ–¹å¼æœ‰çŸ­ä¿¡ã€é‚®ä»¶å¤šç§æ–¹æ³• ã€‚</p>
<h5 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h5><p>å£°æ˜ <code>Exchange_fanout_inform</code> äº¤æ¢æœºã€‚</p>
<p>å£°æ˜ä¸¤ä¸ªé˜Ÿåˆ—å¹¶ä¸”ç»‘å®šåˆ°æ­¤äº¤æ¢æœºï¼Œç»‘å®šæ—¶ä¸éœ€è¦æŒ‡å®š <code>routingkey</code></p>
<p>å‘é€æ¶ˆæ¯æ—¶ä¸éœ€è¦æŒ‡å®š <code>routingkey</code></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> rabbitmq;

<span class="hljs-keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;
<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;
<span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;
<span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer02_publish</span> </span>&#123;
    <span class="hljs-comment">//é˜Ÿåˆ—åç§°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="hljs-string">"queue_inform_email"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_SMS = <span class="hljs-string">"queue_inform_sms"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_FANOUT_INFORM = <span class="hljs-string">"exchange_fanout_inform"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;
        Connection connection = <span class="hljs-keyword">null</span>;
        Channel channel = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-comment">//æ„å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½®ä¸€äº›åŸºæœ¬çš„é“¾æ¥ä¿¡æ¯</span>
            ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
            factory.setHost(<span class="hljs-string">"localhost"</span>);
            factory.setPort(<span class="hljs-number">5672</span>);
            factory.setUsername(<span class="hljs-string">"guest"</span>);
            factory.setPassword(<span class="hljs-string">"guest"</span>);
            <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>
            factory.setVirtualHost(<span class="hljs-string">"/"</span>);

            <span class="hljs-comment">//åˆ›å»ºä¸RabbitMQæœåŠ¡çš„TCPè¿æ¥</span>
            connection = factory.newConnection();

            <span class="hljs-comment">//åˆ›å»ºä¸Exchangeçš„é€šé“ï¼Œæ¯ä¸ªè¿æ¥å¯ä»¥åˆ›å»ºå¤šä¸ªé€šé“ï¼Œæ¯ä¸ªé€šé“ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡</span>
            channel = connection.createChannel();
            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * å£°æ˜äº¤æ¢æœº</span>
<span class="hljs-comment">             * 1ã€äº¤æ¢æœºåç§°</span>
<span class="hljs-comment">             * 2ã€äº¤æ¢æœºç±»å‹ï¼šfanoutã€topicã€directã€headers</span>
<span class="hljs-comment">             */</span>
            channel.exchangeDeclare(EXCHANGE_FANOUT_INFORM, BuiltinExchangeType.FANOUT);

            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * å£°æ˜é˜Ÿåˆ—ï¼Œå¦‚æœRabbitä¸­æ²¡æœ‰æ­¤é˜Ÿåˆ—ï¼Œå°†è‡ªåŠ¨åˆ›å»º</span>
<span class="hljs-comment">             * String queue, boolean durable, boolean exclusive, boolean autoDelete,Map&lt;String, Object&gt; arguments</span>
<span class="hljs-comment">             *</span>
<span class="hljs-comment">             * param1:é˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">             * param2:æ˜¯å¦æŒä¹…åŒ–</span>
<span class="hljs-comment">             * param3:é˜Ÿåˆ—æ˜¯å¦ç‹¬å æ­¤è¿æ¥</span>
<span class="hljs-comment">             * param4:é˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—</span>
<span class="hljs-comment">             * param5:é˜Ÿåˆ—å‚æ•°</span>
<span class="hljs-comment">             */</span>
            channel.queueDeclare(QUEUE_INFORM_EMAIL,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);
            channel.queueDeclare(QUEUE_INFORM_SMS,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);

            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * å°†äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®š</span>
<span class="hljs-comment">             */</span>
            channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_FANOUT_INFORM,<span class="hljs-string">""</span>);
            channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_FANOUT_INFORM,<span class="hljs-string">""</span>);

            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;
                String message = <span class="hljs-string">"inform to user "</span> + i;
                <span class="hljs-comment">/**</span>
<span class="hljs-comment">                 * æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span>
<span class="hljs-comment">                 æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span>
<span class="hljs-comment">                 * param1ï¼šExchangeçš„åç§°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä½¿ç”¨Default Exchange</span>
<span class="hljs-comment">                 * param2:routingKey,æ¶ˆæ¯çš„è·¯ç”±Keyï¼Œæ˜¯ç”¨äºExchangeï¼ˆäº¤æ¢æœºï¼‰å°†æ¶ˆæ¯è½¬å‘åˆ°æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—</span>
<span class="hljs-comment">                 * param3:æ¶ˆæ¯åŒ…å«çš„å±æ€§</span>
<span class="hljs-comment">                 * param4ï¼šæ¶ˆæ¯ä½“</span>
<span class="hljs-comment">                 * è¿™é‡Œæ²¡æœ‰æŒ‡å®šäº¤æ¢æœºï¼Œæ¶ˆæ¯å°†å‘é€ç»™é»˜è®¤äº¤æ¢æœºï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¹Ÿä¼šç»‘å®šé‚£ä¸ªé»˜è®¤çš„äº¤æ¢æœºï¼Œä½†æ˜¯ä¸èƒ½æ˜¾ç¤ºç»‘å®šæˆ–è§£é™¤ç»‘å®š</span>
<span class="hljs-comment">                 * é»˜è®¤çš„äº¤æ¢æœºï¼ŒroutingKeyç­‰äºé˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">                 */</span>
                channel.basicPublish(EXCHANGE_FANOUT_INFORM,<span class="hljs-string">""</span>,<span class="hljs-keyword">null</span>,message.getBytes());
                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);
            &#125;


        &#125;<span class="hljs-keyword">catch</span> ( Exception ex)&#123;
            ex.printStackTrace();
        &#125;<span class="hljs-keyword">finally</span> &#123;
            <span class="hljs-comment">//å…³é—­é€šé“å’Œè¿æ¥</span>
            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;
                channel.close();
            &#125;
            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;
                connection.close();
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div>

<h5 id="é‚®ä»¶æ¶ˆè´¹è€…"><a href="#é‚®ä»¶æ¶ˆè´¹è€…" class="headerlink" title="é‚®ä»¶æ¶ˆè´¹è€…"></a>é‚®ä»¶æ¶ˆè´¹è€…</h5><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> rabbitmq;

<span class="hljs-keyword">import</span> com.rabbitmq.client.*;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer02_subscribe_email</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="hljs-string">"queue_inform_email"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_FANOUT_INFORM = <span class="hljs-string">"exchange_fanout_inform"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;
        ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
        factory.setHost(<span class="hljs-string">"localhost"</span>);
        factory.setPort(<span class="hljs-number">5672</span>);
        factory.setUsername(<span class="hljs-string">"guest"</span>);
        factory.setPassword(<span class="hljs-string">"guest"</span>);
        <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>
        factory.setVirtualHost(<span class="hljs-string">"/"</span>);

        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span>
        <span class="hljs-comment">/** å‚æ•°ï¼šString queue, boolean durable, boolean exclusive, boolean autoDelete,</span>
<span class="hljs-comment">         Map&lt;String, Object&gt; arguments</span>
<span class="hljs-comment">         * å‚æ•°æ˜ç»†ï¼š</span>
<span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">         * 2ã€durable æ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ï¼Œmqé‡å¯åé˜Ÿåˆ—è¿˜åœ¨</span>
<span class="hljs-comment">         * 3ã€exclusive æ˜¯å¦ç‹¬å è¿æ¥ï¼Œé˜Ÿåˆ—åªå…è®¸åœ¨è¯¥è¿æ¥ä¸­è®¿é—®ï¼Œå¦‚æœconnectionè¿æ¥å…³é—­ï¼Œé˜Ÿåˆ—åˆ™è‡ªåŠ¨åˆ é™¤,å¯ç”¨äºä¸´æ—¶é˜Ÿåˆ—çš„åˆ›å»º</span>
<span class="hljs-comment">         * 4ã€autoDelete è‡ªåŠ¨åˆ é™¤ï¼Œé˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—ï¼Œå¦‚æœå°†æ­¤å‚æ•°å’Œexclusiveå…±åŒä¸ºtrueï¼Œå°±å¯ä»¥å®ç°ä¸´æ—¶é˜Ÿåˆ—</span>
<span class="hljs-comment">         * 5ã€argmuacntsï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—æ‰©å±•å‚æ•°ï¼Œæ¯”å¦‚ï¼šå¯è®¾ç½®å­˜æ´»çš„æ—¶é—´</span>
<span class="hljs-comment">         */</span>
        channel.queueDeclare(QUEUE_INFORM_EMAIL, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);

        <span class="hljs-comment">/**</span>
<span class="hljs-comment">         * å£°æ˜äº¤æ¢æœº</span>
<span class="hljs-comment">         */</span>
        channel.exchangeDeclare(EXCHANGE_FANOUT_INFORM,BuiltinExchangeType.FANOUT);

        <span class="hljs-comment">/**</span>
<span class="hljs-comment">         * ç»‘å®šäº¤æ¢æœº</span>
<span class="hljs-comment">         */</span>
        channel.queueBind(QUEUE_INFORM_EMAIL, EXCHANGE_FANOUT_INFORM,<span class="hljs-string">""</span>);

        <span class="hljs-comment">//å®šä¹‰æ¶ˆè´¹æ–¹æ³•</span>
        DefaultConsumer defaultConsumer = <span class="hljs-keyword">new</span> DefaultConsumer(channel) &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleDelivery</span><span class="hljs-params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="hljs-keyword">byte</span>[] body)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
                <span class="hljs-comment">//äº¤æ¢æœº</span>
                String exchange = envelope.getExchange();
                <span class="hljs-comment">//è·¯ç”±key</span>
                String routingKey = envelope.getRoutingKey();
                <span class="hljs-comment">//æ¶ˆæ¯id</span>
                <span class="hljs-keyword">long</span> deliveryTag = envelope.getDeliveryTag();
                <span class="hljs-comment">//æ¶ˆæ¯å†…å®¹</span>
                String msg = <span class="hljs-keyword">new</span> String(body, <span class="hljs-string">"utf-8"</span>);
                System.out.println(<span class="hljs-string">"receive message.."</span> + msg);
            &#125;
        &#125;;

        <span class="hljs-comment">/**</span>
<span class="hljs-comment">         * ç›‘å¬é˜Ÿåˆ—String queue, boolean autoAck,Consumer callback</span>
<span class="hljs-comment">         * å‚æ•°æ˜ç»†</span>
<span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">         * 2ã€autoAck æ˜¯å¦è‡ªåŠ¨å›å¤ï¼Œè®¾ç½®ä¸ºtrueä¸ºè¡¨ç¤ºæ¶ˆæ¯æ¥æ”¶åˆ°è‡ªåŠ¨å‘mqå›å¤æ¥æ”¶åˆ°äº†ï¼Œmqæ¥æ”¶åˆ°å›å¤ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œè®¾ç½®ä¸ºfalseåˆ™éœ€è¦æ‰‹åŠ¨å›å¤</span>
<span class="hljs-comment">         * 3ã€callback æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³•ï¼Œæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åè°ƒç”¨æ­¤æ–¹æ³•</span>
<span class="hljs-comment">         */</span>
        channel.basicConsume(QUEUE_INFORM_EMAIL, <span class="hljs-keyword">true</span>, defaultConsumer);
    &#125;
&#125;</code></pre></div>

<h5 id="çŸ­ä¿¡æ¶ˆè´¹è€…"><a href="#çŸ­ä¿¡æ¶ˆè´¹è€…" class="headerlink" title="çŸ­ä¿¡æ¶ˆè´¹è€…"></a>çŸ­ä¿¡æ¶ˆè´¹è€…</h5><p>å‚è€ƒä¸Šè¾¹çš„é‚®ä»¶å‘é€æ¶ˆè´¹è€…ä»£ç ï¼Œä¿®æ”¹é˜Ÿåˆ—åç§°å³å¯</p>
<h4 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h4><p><a href="https://qnoss.codeyee.com/20200704_5/image12" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image12.gif" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="4ã€æ€è€ƒ"><a href="#4ã€æ€è€ƒ" class="headerlink" title="4ã€æ€è€ƒ"></a>4ã€æ€è€ƒ</h4><ol>
<li><p><strong>publish/subscribeä¸work queuesæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</strong></p>
<p><strong>åŒºåˆ«ï¼š</strong><br>1ï¼‰<code>work queues</code> ä¸ç”¨å®šä¹‰äº¤æ¢æœºï¼Œè€Œ <code>publish/subscribe</code> éœ€è¦å®šä¹‰äº¤æ¢æœºã€‚</p>
<p>2ï¼‰<code>publish/subscribe</code> çš„ç”Ÿäº§æ–¹æ˜¯é¢å‘äº¤æ¢æœºå‘é€æ¶ˆæ¯ï¼Œ<code>work queues</code> çš„ç”Ÿäº§æ–¹æ˜¯é¢å‘é˜Ÿåˆ—</p>
<p>å‘é€æ¶ˆæ¯(åº•å±‚ä½¿ç”¨é»˜è®¤äº¤æ¢æœº)ã€‚</p>
<p>3ï¼‰<code>publish/subscribe</code> éœ€è¦è®¾ç½®é˜Ÿåˆ—å’Œäº¤æ¢æœºçš„ç»‘å®šï¼Œ<code>work queues</code> ä¸éœ€è¦è®¾ç½®ï¼Œå®è´¨ä¸Š<code>work queues</code> ä¼šå°†é˜Ÿåˆ—ç»‘å®šåˆ°é»˜è®¤çš„äº¤æ¢æœº ã€‚</p>
<p><strong>ç›¸åŒç‚¹ï¼š</strong></p>
<p>æ‰€ä»¥ä¸¤è€…å®ç°çš„å‘å¸ƒ/è®¢é˜…çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå¤šä¸ªæ¶ˆè´¹ç«¯ç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—ä¸ä¼šé‡å¤æ¶ˆè´¹æ¶ˆæ¯ã€‚</p>
</li>
<li><p><strong>å®è´¨å·¥ä½œç”¨ä»€ä¹ˆ publish/subscribe è¿˜æ˜¯ work queues</strong></p>
<p>å»ºè®®ä½¿ç”¨ <code>publish/subscribe</code>ï¼Œå‘å¸ƒè®¢é˜…æ¨¡å¼æ¯”å·¥ä½œé˜Ÿåˆ—æ¨¡å¼æ›´å¼ºå¤§ï¼Œå¹¶ä¸”å‘å¸ƒè®¢é˜…æ¨¡å¼å¯ä»¥æŒ‡å®šè‡ªå·±ä¸“ç”¨çš„äº¤æ¢æœºã€‚</p>
</li>
</ol>
<h3 id="Routing-æ¨¡å¼"><a href="#Routing-æ¨¡å¼" class="headerlink" title="Routing æ¨¡å¼"></a>Routing æ¨¡å¼</h3><h4 id="1ã€è·¯ç”±æ¨¡å¼"><a href="#1ã€è·¯ç”±æ¨¡å¼" class="headerlink" title="1ã€è·¯ç”±æ¨¡å¼"></a>1ã€è·¯ç”±æ¨¡å¼</h4><p><a href="https://qnoss.codeyee.com/20200704_5/image13" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image13.png" srcset="/img/loading.gif" alt=" "></a></p>
<p>1ã€æ¯ä¸ªæ¶ˆè´¹è€…ç›‘å¬è‡ªå·±çš„é˜Ÿåˆ—ï¼Œå¹¶ä¸”è®¾ç½® <code>routingkey</code>ã€‚</p>
<p>2ã€ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™äº¤æ¢æœºï¼Œç”±äº¤æ¢æœºæ ¹æ® <code>routingkey</code> æ¥è½¬å‘æ¶ˆæ¯åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚</p>
<h4 id="2ã€ä»£ç -1"><a href="#2ã€ä»£ç -1" class="headerlink" title="2ã€ä»£ç "></a>2ã€ä»£ç </h4><h5 id="ç”Ÿäº§è€…-1"><a href="#ç”Ÿäº§è€…-1" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h5><p>è·¯ç”±æ¨¡å¼çš„ç”Ÿäº§è€…ä»£ç åŸºäº <strong>å‘å¸ƒè®¢é˜…æ¨¡å¼</strong> çš„ä»£ç ï¼Œåœ¨è¿™åŸºç¡€ä¸Šå¢åŠ ä»¥ä¸‹å‡ ç‚¹</p>
<ul>
<li>å¢åŠ  <code>routing key</code> ä»¥åŠ ä¿®æ”¹äº¤æ¢æœºçš„æ¨¡å¼</li>
<li>ä¸ºæ¯ä¸ªé˜Ÿåˆ—ç»‘å®š <code>routing key</code></li>
<li>åœ¨ä¸‹é¢çš„ä»£ç å½“ä¸­ï¼Œæˆ‘ä¸º <code>CMS</code> å’Œ <code>EMAIL</code> çš„é˜Ÿåˆ—åˆ†åˆ«ç»‘å®šäº†ä¸€ä¸ªå•ç‹¬çš„ <code>routing key</code>ï¼Œå†ç»‘å®šäº†ä¸€ä¸ª å…±æœ‰çš„åä¸º <code>ALL</code> çš„keyï¼Œä»¥ä¾¿æµ‹è¯• <code>routing</code> æ¨¡å¼çš„ç‰¹æ€§</li>
</ul>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> rabbitmq;

<span class="hljs-keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;
<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;
<span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;
<span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer03_routing</span> </span>&#123;
    <span class="hljs-comment">//é˜Ÿåˆ—åç§°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="hljs-string">"queue_inform_email"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_SMS = <span class="hljs-string">"queue_inform_sms"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_ROUTING_INFORM = <span class="hljs-string">"exchange_routing_inform"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTINGKEY_INFORM_EMAIL = <span class="hljs-string">"inform_email"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTINGKEY_INFORM_SMS = <span class="hljs-string">"inform_sms"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;
        Connection connection = <span class="hljs-keyword">null</span>;
        Channel channel = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-comment">//æ„å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½®ä¸€äº›åŸºæœ¬çš„é“¾æ¥ä¿¡æ¯</span>
            ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
            factory.setHost(<span class="hljs-string">"localhost"</span>);
            factory.setPort(<span class="hljs-number">5672</span>);
            factory.setUsername(<span class="hljs-string">"guest"</span>);
            factory.setPassword(<span class="hljs-string">"guest"</span>);
            <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>
            factory.setVirtualHost(<span class="hljs-string">"/"</span>);

            <span class="hljs-comment">//åˆ›å»ºä¸RabbitMQæœåŠ¡çš„TCPè¿æ¥</span>
            connection = factory.newConnection();

            <span class="hljs-comment">//åˆ›å»ºä¸Exchangeçš„é€šé“ï¼Œæ¯ä¸ªè¿æ¥å¯ä»¥åˆ›å»ºå¤šä¸ªé€šé“ï¼Œæ¯ä¸ªé€šé“ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡</span>
            channel = connection.createChannel();
            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * å£°æ˜äº¤æ¢æœº</span>
<span class="hljs-comment">             * 1ã€äº¤æ¢æœºåç§°</span>
<span class="hljs-comment">             * 2ã€äº¤æ¢æœºç±»å‹ï¼šfanoutã€topicã€directã€headers</span>
<span class="hljs-comment">             */</span>
            channel.exchangeDeclare(EXCHANGE_ROUTING_INFORM, BuiltinExchangeType.DIRECT);

            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * å£°æ˜é˜Ÿåˆ—ï¼Œå¦‚æœRabbitä¸­æ²¡æœ‰æ­¤é˜Ÿåˆ—ï¼Œå°†è‡ªåŠ¨åˆ›å»º</span>
<span class="hljs-comment">             * String queue, boolean durable, boolean exclusive, boolean autoDelete,Map&lt;String, Object&gt; arguments</span>
<span class="hljs-comment">             *</span>
<span class="hljs-comment">             * param1:é˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">             * param2:æ˜¯å¦æŒä¹…åŒ–</span>
<span class="hljs-comment">             * param3:é˜Ÿåˆ—æ˜¯å¦ç‹¬å æ­¤è¿æ¥</span>
<span class="hljs-comment">             * param4:é˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—</span>
<span class="hljs-comment">             * param5:é˜Ÿåˆ—å‚æ•°</span>
<span class="hljs-comment">             */</span>
            channel.queueDeclare(QUEUE_INFORM_EMAIL,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);
            channel.queueDeclare(QUEUE_INFORM_SMS,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);

            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * å°†äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®š</span>
<span class="hljs-comment">             */</span>
            channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_ROUTING_INFORM,ROUTINGKEY_INFORM_SMS);
            channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_ROUTING_INFORM,ROUTINGKEY_INFORM_EMAIL);

            <span class="hljs-comment">//ä¸¤ä¸ªé˜Ÿåˆ—éƒ½ç»‘å®šä¸€ä¸ªALLçš„KEY</span>
            channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_ROUTING_INFORM,<span class="hljs-string">"ALL"</span>);
            channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_ROUTING_INFORM,<span class="hljs-string">"ALL"</span>);

            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯åˆ°EMAIL</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;
                String message = <span class="hljs-string">"inform to email "</span> + i;
                <span class="hljs-comment">/**</span>
<span class="hljs-comment">                 * æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span>
<span class="hljs-comment">                 æ¶ˆæ¯å‘å¸ƒæ–¹æ³•</span>
<span class="hljs-comment">                 * param1ï¼šExchangeçš„åç§°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™ä½¿ç”¨Default Exchange</span>
<span class="hljs-comment">                 * param2:routingKey,æ¶ˆæ¯çš„è·¯ç”±Keyï¼Œæ˜¯ç”¨äºExchangeï¼ˆäº¤æ¢æœºï¼‰å°†æ¶ˆæ¯è½¬å‘åˆ°æŒ‡å®šçš„æ¶ˆæ¯é˜Ÿåˆ—</span>
<span class="hljs-comment">                 * param3:æ¶ˆæ¯åŒ…å«çš„å±æ€§</span>
<span class="hljs-comment">                 * param4ï¼šæ¶ˆæ¯ä½“</span>
<span class="hljs-comment">                 * è¿™é‡Œæ²¡æœ‰æŒ‡å®šäº¤æ¢æœºï¼Œæ¶ˆæ¯å°†å‘é€ç»™é»˜è®¤äº¤æ¢æœºï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¹Ÿä¼šç»‘å®šé‚£ä¸ªé»˜è®¤çš„äº¤æ¢æœºï¼Œä½†æ˜¯ä¸èƒ½æ˜¾ç¤ºç»‘å®šæˆ–è§£é™¤ç»‘å®š</span>
<span class="hljs-comment">                 * é»˜è®¤çš„äº¤æ¢æœºï¼ŒroutingKeyç­‰äºé˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">                 */</span>
                channel.basicPublish(EXCHANGE_ROUTING_INFORM,ROUTINGKEY_INFORM_EMAIL,<span class="hljs-keyword">null</span>,message.getBytes());
                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);
            &#125;
            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯SMS</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;
                String message = <span class="hljs-string">"inform to sms "</span> + i;
                channel.basicPublish(EXCHANGE_ROUTING_INFORM,ROUTINGKEY_INFORM_SMS,<span class="hljs-keyword">null</span>,message.getBytes());
                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);
            &#125;

            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯ALL</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;
                String message = <span class="hljs-string">"inform to all user "</span> + i;
                channel.basicPublish(EXCHANGE_ROUTING_INFORM,<span class="hljs-string">"ALL"</span>,<span class="hljs-keyword">null</span>,message.getBytes());
                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);
            &#125;


        &#125;<span class="hljs-keyword">catch</span> ( Exception ex)&#123;
            ex.printStackTrace();
        &#125;<span class="hljs-keyword">finally</span> &#123;
            <span class="hljs-comment">//å…³é—­é€šé“å’Œè¿æ¥</span>
            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;
                channel.close();
            &#125;
            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;
                connection.close();
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div>

<p>å•ç‹¬è¿è¡Œç”Ÿäº§è€…åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ rabbitMQ åå°çš„ <code>EXCHANGES</code> æ ä¸­çœ‹åˆ°ï¼Œå»ºç«‹äº†4ä¸ªé˜Ÿåˆ—å¯¹åº” <code>routing key</code> çš„é€šè®¯è¿æ¥</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image14" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image14.png" srcset="/img/loading.gif" alt="img"></a></p>
<h5 id="çŸ­ä¿¡æ¶ˆè´¹è€…-1"><a href="#çŸ­ä¿¡æ¶ˆè´¹è€…-1" class="headerlink" title="çŸ­ä¿¡æ¶ˆè´¹è€…"></a>çŸ­ä¿¡æ¶ˆè´¹è€…</h5><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> rabbitmq;

<span class="hljs-keyword">import</span> com.rabbitmq.client.*;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Consumer03_routing_sms</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_SMS = <span class="hljs-string">"queue_inform_sms"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_ROUTING_INFORM = <span class="hljs-string">"exchange_routing_inform"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTINGKEY_INFORM_SMS = <span class="hljs-string">"inform_sms"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;
        ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
        factory.setHost(<span class="hljs-string">"localhost"</span>);
        factory.setPort(<span class="hljs-number">5672</span>);
        factory.setUsername(<span class="hljs-string">"guest"</span>);
        factory.setPassword(<span class="hljs-string">"guest"</span>);
        <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>
        factory.setVirtualHost(<span class="hljs-string">"/"</span>);

        Connection connection = factory.newConnection();
        Channel channel = connection.createChannel();

        <span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span>
        <span class="hljs-comment">/** å‚æ•°ï¼šString queue, boolean durable, boolean exclusive, boolean autoDelete,</span>
<span class="hljs-comment">         Map&lt;String, Object&gt; arguments</span>
<span class="hljs-comment">         * å‚æ•°æ˜ç»†ï¼š</span>
<span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">         * 2ã€durable æ˜¯å¦æŒä¹…åŒ–ï¼Œå¦‚æœæŒä¹…åŒ–ï¼Œmqé‡å¯åé˜Ÿåˆ—è¿˜åœ¨</span>
<span class="hljs-comment">         * 3ã€exclusive æ˜¯å¦ç‹¬å è¿æ¥ï¼Œé˜Ÿåˆ—åªå…è®¸åœ¨è¯¥è¿æ¥ä¸­è®¿é—®ï¼Œå¦‚æœconnectionè¿æ¥å…³é—­ï¼Œé˜Ÿåˆ—åˆ™è‡ªåŠ¨åˆ é™¤,å¯ç”¨äºä¸´æ—¶é˜Ÿåˆ—çš„åˆ›å»º</span>
<span class="hljs-comment">         * 4ã€autoDelete è‡ªåŠ¨åˆ é™¤ï¼Œé˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—ï¼Œå¦‚æœå°†æ­¤å‚æ•°å’Œexclusiveå…±åŒä¸ºtrueï¼Œå°±å¯ä»¥å®ç°ä¸´æ—¶é˜Ÿåˆ—</span>
<span class="hljs-comment">         * 5ã€argmuacntsï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªé˜Ÿåˆ—æ‰©å±•å‚æ•°ï¼Œæ¯”å¦‚ï¼šå¯è®¾ç½®å­˜æ´»çš„æ—¶é—´</span>
<span class="hljs-comment">         */</span>
        channel.queueDeclare(QUEUE_INFORM_SMS, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);

        <span class="hljs-comment">/**</span>
<span class="hljs-comment">         * å£°æ˜äº¤æ¢æœº</span>
<span class="hljs-comment">         */</span>
        channel.exchangeDeclare(EXCHANGE_ROUTING_INFORM,BuiltinExchangeType.DIRECT);

        <span class="hljs-comment">/**</span>
<span class="hljs-comment">         * ç»‘å®šäº¤æ¢æœº</span>
<span class="hljs-comment">         */</span>
        channel.queueBind(QUEUE_INFORM_SMS, EXCHANGE_ROUTING_INFORM,ROUTINGKEY_INFORM_SMS);
        channel.queueBind(QUEUE_INFORM_SMS, EXCHANGE_ROUTING_INFORM,<span class="hljs-string">"ALL"</span>); <span class="hljs-comment">//ç»‘å®šä¸€ä¸ªå…¬æœ‰çš„key,ç”¨äºæ¥æ”¶å…¬å…±çš„key</span>

        <span class="hljs-comment">//å®šä¹‰æ¶ˆè´¹æ–¹æ³•</span>
        DefaultConsumer defaultConsumer = <span class="hljs-keyword">new</span> DefaultConsumer(channel) &#123;
            <span class="hljs-meta">@Override</span>
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleDelivery</span><span class="hljs-params">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class="hljs-keyword">byte</span>[] body)</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
                <span class="hljs-comment">//äº¤æ¢æœº</span>
                String exchange = envelope.getExchange();
                <span class="hljs-comment">//è·¯ç”±key</span>
                String routingKey = envelope.getRoutingKey();
                <span class="hljs-comment">//æ¶ˆæ¯id</span>
                <span class="hljs-keyword">long</span> deliveryTag = envelope.getDeliveryTag();
                <span class="hljs-comment">//æ¶ˆæ¯å†…å®¹</span>
                String msg = <span class="hljs-keyword">new</span> String(body, <span class="hljs-string">"utf-8"</span>);
                System.out.println(<span class="hljs-string">"receive message.."</span> + msg);
            &#125;
        &#125;;

        <span class="hljs-comment">/**</span>
<span class="hljs-comment">         * ç›‘å¬é˜Ÿåˆ—String queue, boolean autoAck,Consumer callback</span>
<span class="hljs-comment">         * å‚æ•°æ˜ç»†</span>
<span class="hljs-comment">         * 1ã€queue é˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">         * 2ã€autoAck æ˜¯å¦è‡ªåŠ¨å›å¤ï¼Œè®¾ç½®ä¸ºtrueä¸ºè¡¨ç¤ºæ¶ˆæ¯æ¥æ”¶åˆ°è‡ªåŠ¨å‘mqå›å¤æ¥æ”¶åˆ°äº†ï¼Œmqæ¥æ”¶åˆ°å›å¤ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œè®¾ç½®ä¸ºfalseåˆ™éœ€è¦æ‰‹åŠ¨å›å¤</span>
<span class="hljs-comment">         * 3ã€callback æ¶ˆè´¹æ¶ˆæ¯çš„æ–¹æ³•ï¼Œæ¶ˆè´¹è€…æ¥æ”¶åˆ°æ¶ˆæ¯åè°ƒç”¨æ­¤æ–¹æ³•</span>
<span class="hljs-comment">         */</span>
        channel.basicConsume(QUEUE_INFORM_SMS, <span class="hljs-keyword">true</span>, defaultConsumer);
    &#125;
&#125;</code></pre></div>

<p>è¿™é‡Œè¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºçš„ä»£ç ä¸­ï¼Œé™¤äº†ç»‘å®šçŸ­ä¿¡çš„key æˆ‘è¿˜å•ç‹¬ç»‘å®šäº†ä¸€ä¸ª ALL çš„keyï¼Œç”¨äºæ¥æ”¶å…¨å±€çš„æ¶ˆæ¯ï¼Œä»£ç å—å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs java">channel.queueBind(QUEUE_INFORM_SMS, EXCHANGE_ROUTING_INFORM,<span class="hljs-string">"ALL"</span>); <span class="hljs-comment">//ç»‘å®šä¸€ä¸ªå…¬æœ‰çš„key,ç”¨äºæ¥æ”¶å…¬å…±çš„key</span></code></pre></div>

<h5 id="é‚®ä»¶æ¶ˆè´¹è€…-1"><a href="#é‚®ä»¶æ¶ˆè´¹è€…-1" class="headerlink" title="é‚®ä»¶æ¶ˆè´¹è€…"></a>é‚®ä»¶æ¶ˆè´¹è€…</h5><p>å…·ä½“ä»£ç å‚è€ƒçŸ­ä¿¡æ¶ˆè´¹è€…çš„ä»£ç </p>
<h4 id="3ã€æµ‹è¯•-1"><a href="#3ã€æµ‹è¯•-1" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h4><p>é¢„æœŸç»“æœï¼šç”Ÿäº§è€…åˆ†åˆ«å‘é€5æ¡æ¶ˆæ¯åˆ° <strong>SMSæ¶ˆè´¹è€…</strong> å’Œ <strong>EMAIL æ¶ˆè´¹è€…</strong>ï¼Œä»¥åŠå‘é€5æ¡æ¶ˆæ¯ç»™<strong>å…¨éƒ¨æ¶ˆè´¹è€…</strong>ã€‚</p>
<p><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image15.gif" srcset="/img/loading.gif" alt="img"></p>
<h4 id="4ã€æ€è€ƒ-1"><a href="#4ã€æ€è€ƒ-1" class="headerlink" title="4ã€æ€è€ƒ"></a>4ã€æ€è€ƒ</h4><p>1ã€Routingæ¨¡å¼ å’Œ Publish/subscibeæœ‰å•¥åŒºåˆ«ï¼Ÿ</p>
<p>Routingæ¨¡å¼è¦æ±‚é˜Ÿåˆ—åœ¨ç»‘å®šäº¤æ¢æœºæ—¶è¦æŒ‡å®š<code>routingkey</code>ï¼Œæ¶ˆæ¯ä¼šè½¬å‘åˆ°ç¬¦åˆ <code>routingkey</code> çš„é˜Ÿåˆ—ã€‚</p>
<h3 id="Topics-æ¨¡å¼"><a href="#Topics-æ¨¡å¼" class="headerlink" title="Topics æ¨¡å¼"></a>Topics æ¨¡å¼</h3><h4 id="4-1ã€é€šé…ç¬¦æ¨¡å¼ï¼ˆTopicsï¼‰"><a href="#4-1ã€é€šé…ç¬¦æ¨¡å¼ï¼ˆTopicsï¼‰" class="headerlink" title="4-1ã€é€šé…ç¬¦æ¨¡å¼ï¼ˆTopicsï¼‰"></a>4-1ã€é€šé…ç¬¦æ¨¡å¼ï¼ˆTopicsï¼‰</h4><p><a href="https://qnoss.codeyee.com/20200704_5/image16" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image16.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>é€šé…ç¬¦è·¯ç”±æ¨¡å¼ï¼š</p>
<p>1ã€æ¯ä¸ªæ¶ˆè´¹è€…ç›‘å¬è‡ªå·±çš„é˜Ÿåˆ—ï¼Œå¹¶ä¸”è®¾ç½®å¸¦ <strong>é€šé…ç¬¦</strong> çš„ <code>routingkey</code>ã€‚</p>
<p>2ã€ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘ç»™ <code>broker</code>ï¼Œç”±äº¤æ¢æœºæ ¹æ® <code>routingkey</code> æ¥è½¬å‘æ¶ˆæ¯åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚</p>
<h4 id="4-2ã€ä»£ç "><a href="#4-2ã€ä»£ç " class="headerlink" title="4-2ã€ä»£ç "></a>4-2ã€ä»£ç </h4><p>æ ¹æ®ç”¨æˆ·çš„é€šçŸ¥è®¾ç½®å»é€šçŸ¥ç”¨æˆ·ï¼Œè®¾ç½®æ¥æ”¶ <code>Email</code> çš„ç”¨æˆ·åªæ¥æ”¶ <code>Email</code>ï¼Œè®¾ç½®æ¥æ”¶ <code>sms</code> çš„ç”¨æˆ·åªæ¥æ”¶ <code>sms</code> ï¼Œè®¾ç½®ä¸¤ç§é€šçŸ¥ç±»å‹éƒ½æ¥æ”¶çš„åˆ™ä¸¤ç§é€šçŸ¥éƒ½æœ‰æ•ˆ</p>
<h5 id="ç”Ÿäº§è€…-2"><a href="#ç”Ÿäº§è€…-2" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h5><p>å£°æ˜äº¤æ¢æœºï¼ŒæŒ‡å®štopicç±»å‹ï¼š</p>
<p>æ ¸å¿ƒä»£ç </p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">* å£°æ˜äº¤æ¢æœº</span>
<span class="hljs-comment">* param1ï¼šäº¤æ¢æœºåç§°</span>
<span class="hljs-comment">* param2:äº¤æ¢æœºç±»å‹ å››ç§äº¤æ¢æœºç±»å‹ï¼šdirectã€fanoutã€topicã€headers</span>
<span class="hljs-comment">*/</span>
channel.exchangeDeclare(EXCHANGE_TOPICS_INFORM, BuiltinExchangeType.TOPIC);
<span class="hljs-comment">//Emailé€šçŸ¥</span>
channel.basicPublish(EXCHANGE_TOPICS_INFORM, <span class="hljs-string">"inform.email"</span>, <span class="hljs-keyword">null</span>, message.getBytes());
<span class="hljs-comment">//smsé€šçŸ¥</span>
channel.basicPublish(EXCHANGE_TOPICS_INFORM, <span class="hljs-string">"inform.sms"</span>, <span class="hljs-keyword">null</span>, message.getBytes());
<span class="hljs-comment">//ä¸¤ç§éƒ½é€šçŸ¥</span>
channel.basicPublish(EXCHANGE_TOPICS_INFORM, <span class="hljs-string">"inform.sms.email"</span>, <span class="hljs-keyword">null</span>, message.getBytes());</code></pre></div>

<p>å…¨éƒ¨ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> rabbitmq;

<span class="hljs-keyword">import</span> com.rabbitmq.client.BuiltinExchangeType;
<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;
<span class="hljs-keyword">import</span> com.rabbitmq.client.Connection;
<span class="hljs-keyword">import</span> com.rabbitmq.client.ConnectionFactory;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeoutException;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Producer04_topcis</span> </span>&#123;
    <span class="hljs-comment">//é˜Ÿåˆ—åç§°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="hljs-string">"queue_inform_email"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_SMS = <span class="hljs-string">"queue_inform_sms"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_TOPICS_INFORM = <span class="hljs-string">"exchange_topics_inform"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTINGKEY_INFORM_EMAIL = <span class="hljs-string">"inform.#.email.#"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String ROUTINGKEY_INFORM_SMS = <span class="hljs-string">"inform.#.sms.#"</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException, TimeoutException </span>&#123;
        Connection connection = <span class="hljs-keyword">null</span>;
        Channel channel = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-comment">//æ„å»ºè¿æ¥å·¥å‚ï¼Œå¹¶è®¾ç½®ä¸€äº›åŸºæœ¬çš„é“¾æ¥ä¿¡æ¯</span>
            ConnectionFactory factory = <span class="hljs-keyword">new</span> ConnectionFactory();
            factory.setHost(<span class="hljs-string">"localhost"</span>);
            factory.setPort(<span class="hljs-number">5672</span>);
            factory.setUsername(<span class="hljs-string">"guest"</span>);
            factory.setPassword(<span class="hljs-string">"guest"</span>);
            <span class="hljs-comment">//rabbitMQé»˜è®¤çš„è™šæ‹Ÿæœºåç§°ä¸ºâ€œ/â€ï¼Œè™šæ‹Ÿæœºç›¸å½“äºä¸€ä¸ªç‹¬ç«‹çš„mqæœåŠ¡</span>
            factory.setVirtualHost(<span class="hljs-string">"/"</span>);

            <span class="hljs-comment">//åˆ›å»ºä¸RabbitMQæœåŠ¡çš„TCPè¿æ¥</span>
            connection = factory.newConnection();

            <span class="hljs-comment">//åˆ›å»ºä¸Exchangeçš„é€šé“ï¼Œæ¯ä¸ªè¿æ¥å¯ä»¥åˆ›å»ºå¤šä¸ªé€šé“ï¼Œæ¯ä¸ªé€šé“ä»£è¡¨ä¸€ä¸ªä¼šè¯ä»»åŠ¡</span>
            channel = connection.createChannel();

            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * å£°æ˜äº¤æ¢æœº</span>
<span class="hljs-comment">             * 1ã€äº¤æ¢æœºåç§°</span>
<span class="hljs-comment">             * 2ã€äº¤æ¢æœºç±»å‹ï¼šfanoutã€topicã€directã€headers</span>
<span class="hljs-comment">             */</span>
            channel.exchangeDeclare(EXCHANGE_TOPICS_INFORM, BuiltinExchangeType.TOPIC);

            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * å£°æ˜é˜Ÿåˆ—ï¼Œå¦‚æœRabbitä¸­æ²¡æœ‰æ­¤é˜Ÿåˆ—ï¼Œå°†è‡ªåŠ¨åˆ›å»º</span>
<span class="hljs-comment">             * String queue, boolean durable, boolean exclusive, boolean autoDelete,Map&lt;String, Object&gt; arguments</span>
<span class="hljs-comment">             *</span>
<span class="hljs-comment">             * param1:é˜Ÿåˆ—åç§°</span>
<span class="hljs-comment">             * param2:æ˜¯å¦æŒä¹…åŒ–</span>
<span class="hljs-comment">             * param3:é˜Ÿåˆ—æ˜¯å¦ç‹¬å æ­¤è¿æ¥</span>
<span class="hljs-comment">             * param4:é˜Ÿåˆ—ä¸å†ä½¿ç”¨æ—¶æ˜¯å¦è‡ªåŠ¨åˆ é™¤æ­¤é˜Ÿåˆ—</span>
<span class="hljs-comment">             * param5:é˜Ÿåˆ—å‚æ•°</span>
<span class="hljs-comment">             */</span>
            channel.queueDeclare(QUEUE_INFORM_EMAIL,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);
            channel.queueDeclare(QUEUE_INFORM_SMS,<span class="hljs-keyword">true</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">false</span>,<span class="hljs-keyword">null</span>);

            <span class="hljs-comment">/**</span>
<span class="hljs-comment">             * å°†äº¤æ¢æœºå’Œé˜Ÿåˆ—è¿›è¡Œç»‘å®š</span>
<span class="hljs-comment">             */</span>
            channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_TOPICS_INFORM,ROUTINGKEY_INFORM_SMS);
            channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_TOPICS_INFORM,ROUTINGKEY_INFORM_EMAIL);

            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯åˆ°EMAIL</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;
                String message = <span class="hljs-string">"inform to email "</span> + i;
                channel.basicPublish(EXCHANGE_TOPICS_INFORM,<span class="hljs-string">"inform.email"</span>,<span class="hljs-keyword">null</span>,message.getBytes());
                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);
            &#125;

            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯SMS</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;
                String message = <span class="hljs-string">"inform to sms "</span> + i;
                channel.basicPublish(EXCHANGE_TOPICS_INFORM,<span class="hljs-string">"inform.sms"</span>,<span class="hljs-keyword">null</span>,message.getBytes());
                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);
            &#125;

            <span class="hljs-comment">//å‘å¸ƒæ¶ˆæ¯åˆ°cmså’Œemail</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span> ; i++) &#123;
                String message = <span class="hljs-string">"inform to sms and email "</span> + i;
                channel.basicPublish(EXCHANGE_TOPICS_INFORM,<span class="hljs-string">"inform.sms.email"</span>,<span class="hljs-keyword">null</span>,message.getBytes());
                System.out.println(<span class="hljs-string">"Send Message is: "</span> + message);
            &#125;


        &#125;<span class="hljs-keyword">catch</span> ( Exception ex)&#123;
            ex.printStackTrace();
        &#125;<span class="hljs-keyword">finally</span> &#123;
            <span class="hljs-comment">//å…³é—­é€šé“å’Œè¿æ¥</span>
            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;
                channel.close();
            &#125;
            <span class="hljs-keyword">if</span>(channel != <span class="hljs-keyword">null</span>)&#123;
                connection.close();
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div>

<h5 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h5><p>é˜Ÿåˆ—ç»‘å®šäº¤æ¢æœºæŒ‡å®šé€šé…ç¬¦ <code>routing key</code></p>
<p>ç»Ÿé…ç¬¦è§„åˆ™ï¼šä¸­é—´ä»¥â€œ.â€åˆ†éš”ã€‚ç¬¦å·#å¯ä»¥åŒ¹é…å¤šä¸ªè¯ï¼Œç¬¦å·*å¯ä»¥åŒ¹é…ä¸€ä¸ªè¯è¯­ã€‚</p>
<p>æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼Œå…·ä½“ä»£ç å‚è€ƒ <code>routing</code> æ¨¡å¼çš„æ¶ˆè´¹è€…</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//å£°æ˜é˜Ÿåˆ—</span>
channel.queueDeclare(QUEUE_INFORM_EMAIL, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);
channel.queueDeclare(QUEUE_INFORM_SMS, <span class="hljs-keyword">true</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">false</span>, <span class="hljs-keyword">null</span>);
<span class="hljs-comment">//å£°æ˜äº¤æ¢æœº</span>
channel.exchangeDeclare(EXCHANGE_TOPICS_INFORM, BuiltinExchangeType.TOPIC);
<span class="hljs-comment">//ç»‘å®šemailé€šçŸ¥é˜Ÿåˆ—</span>
channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_TOPICS_INFORM,<span class="hljs-string">"inform.#.email.#"</span>);
<span class="hljs-comment">//ç»‘å®šsmsé€šçŸ¥é˜Ÿåˆ—</span>
channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_TOPICS_INFORM,<span class="hljs-string">"inform.#.sms.#"</span>);</code></pre></div>

<h4 id="4-3ã€æµ‹è¯•"><a href="#4-3ã€æµ‹è¯•" class="headerlink" title="4-3ã€æµ‹è¯•"></a>4-3ã€æµ‹è¯•</h4><p>åœ¨ç”Ÿäº§è€…ç«¯åˆ†åˆ«å‘ inform.emailã€inform.smsã€inform.sms.email è¿™ä¸‰ä¸ªé€šé…ç¬¦å‘é€äº†æ¶ˆæ¯</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image17" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image17.png" srcset="/img/loading.gif" alt="rabbitMQä¸Šçš„äº¤æ¢çŠ¶æ€"></a></p>
<p>é¢„æœŸç»“æœï¼šemså’Œemailæ¶ˆè´¹è€…åˆ†åˆ«æ¥æ”¶åˆ° <code>sms</code> å’Œ <code>email</code> ä¿¡æ¯å’Œ <code>sms and email</code> ä¿¡æ¯</p>
<p><strong>æ‰§è¡Œç”Ÿäº§è€…</strong></p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image18" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image18.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>æŸ¥çœ‹æ‰§è¡Œæ¶ˆè´¹è€…ç«¯</strong></p>
<p>smsæ¶ˆè´¹è€…</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image19" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image19.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>emailæ¶ˆè´¹è€…</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image20" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image20.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="4-4ã€æ€è€ƒ"><a href="#4-4ã€æ€è€ƒ" class="headerlink" title="4-4ã€æ€è€ƒ"></a>4-4ã€æ€è€ƒ</h4><p>1ã€æœ¬æ¡ˆä¾‹çš„éœ€æ±‚ä½¿ç”¨ <code>routing</code> æ¨¡å¼æ˜¯å¦èƒ½å®ç°ï¼Ÿ</p>
<p>ä½¿ç”¨ <code>routing</code> æ¨¡å¼ä¹Ÿå¯ä»¥å®ç°æœ¬æ¡ˆä¾‹ï¼Œå…±è®¾ç½®ä¸‰ä¸ª <code>routing key</code> ï¼Œåˆ†åˆ«æ˜¯ emailã€smsã€all è¿™ä¸‰ä¸ªï¼Œemail é˜Ÿåˆ—ç»‘å®š <code>email</code> å’Œ <code>all</code> ï¼Œsms é˜Ÿåˆ—ç»‘å®š sms å’Œ allï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ä¸Šè¿°çš„æ¡ˆä¾‹ï¼Œä½†æ˜¯å®ç°è¿‡ç¨‹æ¯” <code>topics</code> å¤æ‚ã€‚</p>
<p>Topics æ¨¡å¼æ›´å¼ºå¤§ï¼Œå®ƒå¯ä»¥å®ç° <code>Routing</code> ã€<code>publish/subscirbe</code> æ¨¡å¼çš„åŠŸèƒ½ã€‚</p>
<h3 id="Header-æ¨¡å¼"><a href="#Header-æ¨¡å¼" class="headerlink" title="Header æ¨¡å¼"></a>Header æ¨¡å¼</h3><p><code>header</code> æ¨¡å¼ä¸ <code>routing</code> ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œ<code>header</code> æ¨¡å¼å–æ¶ˆ <code>routing key</code>ï¼Œä½¿ç”¨ <code>header</code>ä¸­çš„ <code>key/value</code>ï¼ˆé”®å€¼å¯¹ï¼‰åŒ¹é…<br>é˜Ÿåˆ—ã€‚</p>
<h4 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a><strong>æ¡ˆä¾‹</strong></h4><p>æ ¹æ®ç”¨çš„é€šçŸ¥è®¾ç½®å»é€šçŸ¥ç”¨æˆ·ï¼Œè®¾ç½®æ¥æ”¶ <code>Email</code> çš„ç”¨æˆ·åªæ¥æ”¶<code>Email</code>ï¼Œè®¾ç½®æ¥æ”¶ <code>sms</code> çš„ç”¨æˆ·åªæ¥æ”¶ <code>sms</code>ï¼Œè®¾ç½®ä¸¤ç§é€šçŸ¥ç±»å‹éƒ½æ¥æ”¶çš„åˆ™ä¸¤ç§é€šçŸ¥éƒ½æœ‰æ•ˆã€‚</p>
<h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><p>ç”Ÿäº§è€…</p>
<p>é˜Ÿåˆ—ä¸äº¤æ¢æœºç»‘å®šçš„ä»£ç ä¸ä¹‹å‰ä¸åŒï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java">Map&lt;String, Object&gt; headers_email = <span class="hljs-keyword">new</span> Hashtable&lt;String, Object&gt;();
headers_email.put(<span class="hljs-string">"inform_type"</span>, <span class="hljs-string">"email"</span>);
Map&lt;String, Object&gt; headers_sms = <span class="hljs-keyword">new</span> Hashtable&lt;String, Object&gt;();
headers_sms.put(<span class="hljs-string">"inform_type"</span>, <span class="hljs-string">"sms"</span>);
channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_HEADERS_INFORM,<span class="hljs-string">""</span>,headers_email);
channel.queueBind(QUEUE_INFORM_SMS,EXCHANGE_HEADERS_INFORM,<span class="hljs-string">""</span>,headers_sms);</code></pre></div>

<p>å‘å¸ƒæ¶ˆæ¯æ ¸å¿ƒä»£ç :</p>
<div class="hljs"><pre><code class="hljs java">String message = <span class="hljs-string">"email inform to user"</span>+i;
Map&lt;String,Object&gt; headers = <span class="hljs-keyword">new</span> Hashtable&lt;String, Object&gt;();
headers.put(<span class="hljs-string">"inform_type"</span>, <span class="hljs-string">"email"</span>);<span class="hljs-comment">//åŒ¹é…emailé€šçŸ¥æ¶ˆè´¹è€…ç»‘å®šçš„header</span>
<span class="hljs-comment">//headers.put("inform_type", "sms");//åŒ¹é…smsé€šçŸ¥æ¶ˆè´¹è€…ç»‘å®šçš„header</span>
AMQP.BasicProperties.Builder properties = <span class="hljs-keyword">new</span> AMQP.BasicProperties.Builder();
properties.headers(headers);
<span class="hljs-comment">//Emailé€šçŸ¥</span>
channel.basicPublish(EXCHANGE_HEADERS_INFORM, <span class="hljs-string">""</span>, properties.build(), message.getBytes());</code></pre></div>

<h4 id="é‚®æ¶ˆè´¹è€…"><a href="#é‚®æ¶ˆè´¹è€…" class="headerlink" title="é‚®æ¶ˆè´¹è€…"></a>é‚®æ¶ˆè´¹è€…</h4><p>email æ¶ˆè´¹è€…æ ¸å¿ƒä»£ç </p>
<div class="hljs"><pre><code class="hljs java">channel.exchangeDeclare(EXCHANGE_HEADERS_INFORM, BuiltinExchangeType.HEADERS);
Map&lt;String, Object&gt; headers_email = <span class="hljs-keyword">new</span> Hashtable&lt;String, Object&gt;();
headers_email.put(<span class="hljs-string">"inform_email"</span>, <span class="hljs-string">"email"</span>);
<span class="hljs-comment">//äº¤æ¢æœºå’Œé˜Ÿåˆ—ç»‘å®š</span>
channel.queueBind(QUEUE_INFORM_EMAIL,EXCHANGE_HEADERS_INFORM,<span class="hljs-string">""</span>,headers_email);
<span class="hljs-comment">//æŒ‡å®šæ¶ˆè´¹é˜Ÿåˆ—</span>
channel.basicConsume(QUEUE_INFORM_EMAIL, <span class="hljs-keyword">true</span>, consumer);</code></pre></div>

<p>æµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image21" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image21.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="RPCæ¨¡å¼"><a href="#RPCæ¨¡å¼" class="headerlink" title="RPCæ¨¡å¼"></a>RPCæ¨¡å¼</h3><p><a href="https://qnoss.codeyee.com/20200704_5/image22" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image22.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>RPCå³å®¢æˆ·ç«¯è¿œç¨‹è°ƒç”¨æœåŠ¡ç«¯çš„æ–¹æ³• ï¼Œä½¿ç”¨ <code>MQ</code> å¯ä»¥å®ç° <code>RPC</code> çš„å¼‚æ­¥è°ƒç”¨ï¼ŒåŸºäº <code>Direct</code> äº¤æ¢æœºå®ç°ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p>1ã€å®¢æˆ·ç«¯å³æ˜¯ç”Ÿäº§è€…å°±æ˜¯æ¶ˆè´¹è€…ï¼Œå‘ <code>RPC</code> è¯·æ±‚é˜Ÿåˆ—å‘é€ <code>RPC</code> è°ƒç”¨æ¶ˆæ¯ï¼ŒåŒæ—¶ç›‘å¬ <code>RPC</code> å“åº”é˜Ÿåˆ—ã€‚</p>
<p>2ã€æœåŠ¡ç«¯ç›‘å¬ <code>RPC</code> è¯·æ±‚é˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œæ”¶åˆ°æ¶ˆæ¯åæ‰§è¡ŒæœåŠ¡ç«¯çš„æ–¹æ³•ï¼Œå¾—åˆ°æ–¹æ³•è¿”å›çš„ç»“æœ</p>
<p>3ã€æœåŠ¡ç«¯å°† <code>RPC</code> æ–¹æ³• çš„ç»“æœå‘é€åˆ° <code>RPC</code> å“åº”é˜Ÿåˆ—</p>
<p>4ã€å®¢æˆ·ç«¯ï¼ˆ<strong>RPCè°ƒç”¨æ–¹</strong>ï¼‰ç›‘å¬<code>RPC</code>å“åº”é˜Ÿåˆ—ï¼Œæ¥æ”¶åˆ° <code>RPC</code> è°ƒç”¨ç»“æœã€‚</p>
<h2 id="4-Spring-Bootæ•´åˆRibbitMQ"><a href="#4-Spring-Bootæ•´åˆRibbitMQ" class="headerlink" title="4. Spring Bootæ•´åˆRibbitMQ"></a>4. Spring Bootæ•´åˆRibbitMQ</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>æˆ‘ä»¬é€‰æ‹©åŸºäºSpring-Rabbitå»æ“ä½œ<code>RabbitMQ</code></p>
<p>æºä»£ç åœ°å€ï¼š<a href="https://github.com/spring-projects/spring-amqp" target="_blank" rel="noopener">https://github.com/spring-projects/spring-amqp</a></p>
<p>åœ¨æˆ‘ä»¬ä¹‹å‰åˆ›å»ºå¾—ç”Ÿäº§è€…æ¨¡å—ä¸­è¿›è¡Œæ„å»ºï¼Œæ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼Œæ³¨é‡Šæ‰ä¹‹å‰åŸç”Ÿçš„ <code>rabbitmq</code> ä¾èµ–</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!--åŸç”ŸrabbitMQ--&gt;</span>
    <span class="hljs-comment">&lt;!--&lt;dependency&gt;--&gt;</span>
    <span class="hljs-comment">&lt;!--&lt;groupId&gt;com.rabbitmq&lt;/groupId&gt;--&gt;</span>
    <span class="hljs-comment">&lt;!--&lt;artifactId&gt;amqp-client&lt;/artifactId&gt;--&gt;</span>
    <span class="hljs-comment">&lt;!--&lt;version&gt;4.0.3&lt;/version&gt;&amp;lt;!&amp;ndash;æ­¤ç‰ˆæœ¬ä¸spring boot 1.5.9ç‰ˆæœ¬åŒ¹é…&amp;ndash;&amp;gt;--&gt;</span>
    <span class="hljs-comment">&lt;!--&lt;/dependency&gt;--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-comment">&lt;!--Springbootæ•´åˆrabbitMQå¯åŠ¨å™¨--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span></code></pre></div>

<h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>1ã€é…ç½®application.yml</p>
<p>é…ç½®è¿æ¥ <code>rabbitmq</code> çš„å‚æ•°</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">44000</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">test-rabbitmq-producer</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">virtualHost:</span> <span class="hljs-string">/</span></code></pre></div>

<p>åˆ›å»º Springbootå¯åŠ¨ç¨‹åº</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.rabbitmq;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestRabbitmqApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(TestRabbitmqApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;
    &#125;
&#125;</code></pre></div>

<h3 id="ç”Ÿäº§ç«¯"><a href="#ç”Ÿäº§ç«¯" class="headerlink" title="ç”Ÿäº§ç«¯"></a>ç”Ÿäº§ç«¯</h3><p>æ„å»º <code>RabbitmqConfig</code> ï¼Œç”¨äºé…ç½®äº¤æ¢æœºä»¥åŠç»‘å®šé˜Ÿåˆ—</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.rabbitmq.config;

<span class="hljs-keyword">import</span> org.springframework.amqp.core.*;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitmqConfig</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_EMAIL = <span class="hljs-string">"queue_inform_email"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_INFORM_SMS = <span class="hljs-string">"queue_inform_sms"</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EXCHANGE_TOPICS_INFORM = <span class="hljs-string">"exchange_topics_inform"</span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * äº¤æ¢æœºé…ç½®</span>
<span class="hljs-comment">     * ExchangeBuilderæä¾›äº†fanoutã€directã€topicã€headeräº¤æ¢æœºç±»å‹çš„é…ç½®</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Bean</span>(EXCHANGE_TOPICS_INFORM)
    <span class="hljs-function"><span class="hljs-keyword">public</span> Exchange <span class="hljs-title">EXCHANGE_TOPICS_INFORM</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-comment">//DURABLE(true) æŒä¹…åŒ–ï¼Œæ¶ˆæ¯é˜Ÿåˆ—é‡å¯åäº¤æ¢æœºä»ç„¶å­˜åœ¨</span>
        <span class="hljs-keyword">return</span> ExchangeBuilder.topicExchange(EXCHANGE_TOPICS_INFORM).durable(<span class="hljs-keyword">true</span>).build();
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * å£°æ˜é˜Ÿåˆ—</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Bean</span>(QUEUE_INFORM_SMS)
    <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">QUEUE_INFORM_SMS</span><span class="hljs-params">()</span></span>&#123;
        Queue queue = <span class="hljs-keyword">new</span> Queue(QUEUE_INFORM_SMS);
        <span class="hljs-keyword">return</span> queue;
    &#125;

    <span class="hljs-meta">@Bean</span>(QUEUE_INFORM_EMAIL)
    <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">QUEUE_INFORM_EMAIL</span><span class="hljs-params">()</span></span>&#123;
        Queue queue = <span class="hljs-keyword">new</span> Queue(QUEUE_INFORM_EMAIL);
        <span class="hljs-keyword">return</span> queue;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> queue æŒ‡å®šé˜Ÿåˆ—</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> exchange æŒ‡å®šäº¤æ¢æœº</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">BINDING_QUEUE_INFORM_SMS</span><span class="hljs-params">(@Qualifier(QUEUE_INFORM_SMS)</span> Queue queue,</span>
<span class="hljs-function">                                            @<span class="hljs-title">Qualifier</span><span class="hljs-params">(EXCHANGE_TOPICS_INFORM)</span> Exchange exchange)</span>&#123;
        <span class="hljs-keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(<span class="hljs-string">"inform.#.sms.#"</span>).noargs();
    &#125;
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">BINDING_QUEUE_INFORM_EMAIL</span><span class="hljs-params">(@Qualifier(QUEUE_INFORM_EMAIL)</span> Queue queue,</span>
<span class="hljs-function">                                            @<span class="hljs-title">Qualifier</span><span class="hljs-params">(EXCHANGE_TOPICS_INFORM)</span> Exchange exchange)</span>&#123;
        <span class="hljs-keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(<span class="hljs-string">"inform.#.email.#"</span>).noargs();
    &#125;
&#125;</code></pre></div>

<p>è¿è¡Œæµ‹è¯•ï¼ŒæˆåŠŸç”Ÿæˆ5æ¡æ¶ˆæ¯åˆ°rabbitmq</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image23" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image23.png" srcset="/img/loading.gif" alt="img"></a></p>
<blockquote>
<p>è¿è¡Œç”Ÿäº§ç«¯å‰åˆ é™¤åŸæœ‰çš„äº¤æ¢æœº</p>
</blockquote>
<h3 id="æ¶ˆè´¹ç«¯"><a href="#æ¶ˆè´¹ç«¯" class="headerlink" title="æ¶ˆè´¹ç«¯"></a>æ¶ˆè´¹ç«¯</h3><p>å‡†å¤‡å·¥ä½œ</p>
<ol>
<li>é…ç½® <strong>4.1</strong> ç»™å‡ºçš„ä¾èµ–åŒ…</li>
<li>å¤åˆ¶ ç”Ÿäº§è€…ç«¯çš„ <code>RabbitmqConfig.java</code></li>
<li>åˆ›å»ºæ¶ˆè´¹ç«¯ <code>Springboot</code> å¯åŠ¨ç¨‹åº</li>
</ol>
<p>ç›®å½•ç»“æ„å¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image24" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image24.png" srcset="/img/loading.gif" alt="æ¶ˆè´¹ç«¯ç›®å½•ç»“æ„"></a></p>
<p>é…ç½® <code>ReceiveHandler.java</code>ï¼Œç›‘å¬ rabbitMQ çš„æ¶ˆæ¯</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.test.rabbitmq.mq;

<span class="hljs-keyword">import</span> com.xuecheng.test.rabbitmq.config.RabbitmqConfig;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.amqp.RabbitProperties;
<span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ReceiveHandler</span> </span>&#123;

    <span class="hljs-comment">//ç›‘å¬emailé˜Ÿåˆ—</span>
    <span class="hljs-meta">@RabbitListener</span>(queues = &#123;RabbitmqConfig.QUEUE_INFORM_EMAIL&#125;)
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">receive_email</span><span class="hljs-params">(String msg, Message message, Channel channel)</span></span>&#123;
        System.out.println(<span class="hljs-string">"receive: "</span>+msg);
    &#125;

    <span class="hljs-comment">//ç›‘å¬smsé˜Ÿåˆ—</span>
    <span class="hljs-meta">@RabbitListener</span>(queues = &#123;RabbitmqConfig.QUEUE_INFORM_SMS&#125;)
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">receive_sms</span><span class="hljs-params">(String msg, Message message,Channel channel)</span></span>&#123;
        System.out.println(<span class="hljs-string">"receive: "</span>+msg);
    &#125;

&#125;</code></pre></div>

<p>å¯åŠ¨æ¶ˆè´¹è€…æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°åˆšæ‰æˆ‘ä»¬è¿è¡Œç”Ÿäº§è€…æ‰€ç”Ÿäº§çš„æ¶ˆæ¯ï¼Œå¦‚ä¸‹å›¾</p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image25" target="_blank" rel="noopener"><img src="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/image25.png" srcset="/img/loading.gif" alt="æ¶ˆè´¹è€…ç«¯æ¥æ”¶åˆ°æ¶ˆæ¯"></a></p>
<p><a href="https://qnoss.codeyee.com/20200704_5/image25" target="_blank" rel="noopener"></a></p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">å­¦æˆåœ¨çº¿</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/RabbitMQ/">RabbitMQ</a>
                    
                      <a class="hover-with-bg" href="/tags/SpringBoot%E6%95%B4%E5%90%88RabbitMQ/">SpringBootæ•´åˆRabbitMQ</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day06ï¼šé¡µé¢å‘å¸ƒã€è¯¾ç¨‹ç®¡ç†</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/">
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day04ï¼šé¡µé¢é™æ€åŒ–</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

ä»£ç å—js ç”¨ä¸åˆ°ï¼Œfulidè‡ªå¸¦æœ‰ï¼Œæ·»åŠ cssæ ·å¼å³å¯å®ç°
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®å­—</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å‹‰å¼ºè¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">äº¬ICPè¯123456å·</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>äº¬å…¬ç½‘å®‰å¤‡12345678å·</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "å­¦æˆåœ¨çº¿day05ï¼šæ¶ˆæ¯ä¸­é—´ä»¶RabbitMQ&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
