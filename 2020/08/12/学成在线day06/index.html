<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>å­¦æˆåœ¨çº¿day06 - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ç§äººåšå®¢</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äºæˆ‘
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-12 15:31">
      2020-08-12
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      8.5k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      124
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p>
</blockquote>
<p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day06</code> çš„å†…å®¹</p>
<ul>
<li><p>ä½¿ç”¨ <code>Spring boot</code> é›†æˆ <code>RabbitMQ</code> å’Œ <code>GridFS</code> å®ç°åŸºäºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹çš„é¡µé¢é™æ€åŒ–å‘å¸ƒçš„æµç¨‹ã€‚</p>
<p>åœ¨æœ¬ç« èŠ‚çš„çŸ¥è¯†ç‚¹ä¸­ï¼Œå†æ¬¡å¤ä¹ äº†åŸºäº <code>GridFS</code> å’Œ <code>RabbitMQ</code> çš„åˆ†å¸ƒå¼é™æ€é¡µé¢å‘å¸ƒçš„çŸ¥è¯†ç‚¹ï¼Œæ·±åŒ–äº†è®°å¿†ã€‚</p>
<p>â€‹</p>
</li>
<li><p>ä½¿ç”¨ä¸‰çº§èœå•å®ç°è¯¾ç¨‹è®¡åˆ’çš„æŸ¥è¯¢å’Œæ·»åŠ </p>
<p>è¿™é‡Œçš„æŠ€æœ¯ç‚¹ä¸æ˜¯å¾ˆå¤šï¼Œç”¨åˆ°äº† <code>Mysql</code> çš„è¡¨å†…è‡ªè¿æ¥æŸ¥è¯¢ï¼Œä»¥åŠåœ¨æ·»åŠ è¯¾ç¨‹çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€äº›æ„å¤–æƒ…å†µçš„å‘ç”Ÿï¼Œä¾‹å¦‚å†æ·»åŠ è¯¾ç¨‹æ—¶ï¼Œå¦‚æœè¯¥è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹ï¼ˆä¸€çº§èœå•ï¼‰ä¸å­˜åœ¨ï¼Œåˆ™éœ€è¦ä¸ºè¯¥è¯¾ç¨‹æ·»åŠ ä¸€ä¸ªæ ¹èŠ‚ç‚¹åå†è¿›è¡Œè¯¥äºŒçº§èŠ‚ç‚¹çš„æ·»åŠ ã€‚</p>
</li>
</ul>
<h1 id="ä¸€ã€é¡µé¢å‘å¸ƒ"><a href="#ä¸€ã€é¡µé¢å‘å¸ƒ" class="headerlink" title="ä¸€ã€é¡µé¢å‘å¸ƒ"></a>ä¸€ã€é¡µé¢å‘å¸ƒ</h1><h2 id="1-æŠ€æœ¯æ–¹æ¡ˆ"><a href="#1-æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="1. æŠ€æœ¯æ–¹æ¡ˆ"></a>1. æŠ€æœ¯æ–¹æ¡ˆ</h2><p>æœ¬é¡¹ç›®ä½¿ç”¨MQå®ç°é¡µé¢å‘å¸ƒçš„æŠ€æœ¯æ–¹æ¡ˆå¦‚ä¸‹:</p>
<p><img src="https://qnoss.codeyee.com/20200706_Ng==/image1.png" srcset="/img/loading.gif" alt="å­¦æˆåœ¨çº¿day06/image1.png)"></p>
<p>*<em>æŠ€æœ¯æ–¹æ¡ˆè¯´æ˜ *</em></p>
<p>1ã€å¹³å°åŒ…æ‹¬å¤šä¸ªç«™ç‚¹ï¼Œé¡µé¢å½’å±ä¸åŒçš„ç«™ç‚¹ã€‚</p>
<p>2ã€å‘å¸ƒä¸€ä¸ªé¡µé¢åº”å°†è¯¥é¡µé¢å‘å¸ƒåˆ°æ‰€å±ç«™ç‚¹çš„æœåŠ¡å™¨ä¸Šã€‚</p>
<p>3ã€æ¯ä¸ªç«™ç‚¹æœåŠ¡éƒ¨ç½² <code>cms client</code> ç¨‹åºï¼Œå¹¶ä¸äº¤æ¢æœºç»‘å®šï¼Œç»‘å®šæ—¶æŒ‡å®šç«™ç‚¹Idä¸ºroutingKeyã€‚</p>
<p>æŒ‡å®šç«™ç‚¹idä¸º <code>routingKey</code> å°±å¯ä»¥å®ç° <code>cms client</code> åªèƒ½æ¥æ”¶åˆ°æ‰€å±ç«™ç‚¹çš„é¡µé¢å‘å¸ƒæ¶ˆæ¯ã€‚</p>
<p>4ã€é¡µé¢å‘å¸ƒç¨‹åºå‘MQå‘å¸ƒæ¶ˆæ¯æ—¶æŒ‡å®šé¡µé¢æ‰€å±ç«™ç‚¹ <code>Id</code> ä¸º <code>routingKey</code>ï¼Œå°†è¯¥é¡µé¢å‘å¸ƒåˆ°å®ƒæ‰€åœ¨æœåŠ¡å™¨ä¸Šçš„<code>cms client</code>ã€‚</p>
<p><strong>è·¯ç”±æ¨¡å¼åˆ†æå¦‚ä¸‹</strong></p>
<p>å‘å¸ƒä¸€ä¸ªé¡µé¢ï¼Œéœ€å‘å¸ƒåˆ°è¯¥é¡µé¢æ‰€å±çš„æ¯ä¸ªç«™ç‚¹æœåŠ¡å™¨ï¼Œå…¶å®ƒç«™ç‚¹æœåŠ¡å™¨ä¸å‘å¸ƒã€‚</p>
<p>æ¯”å¦‚ å‘å¸ƒä¸€ä¸ªé—¨æˆ·çš„é¡µé¢ï¼Œéœ€è¦å‘å¸ƒåˆ°æ¯ä¸ªé—¨æˆ·æœåŠ¡å™¨ä¸Šï¼Œè€Œç”¨æˆ·ä¸­å¿ƒæœåŠ¡å™¨åˆ™ä¸éœ€è¦å‘å¸ƒã€‚</p>
<p>æ‰€ä»¥æœ¬é¡¹ç›®é‡‡ç”¨ <code>routing</code> æ¨¡å¼ï¼Œç”¨ç«™ç‚¹ <code>id</code> ä½œä¸º <code>routingKey</code>ï¼Œè¿™æ ·å°±å¯ä»¥åŒ¹é…é¡µé¢åªå‘å¸ƒåˆ°æ‰€å±çš„ç«™ç‚¹æœåŠ¡å™¨ä¸Šã€‚</p>
<p><strong>é¡µé¢å‘å¸ƒæµç¨‹å›¾å¦‚ä¸‹</strong></p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image2.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image2.png" srcset="/img/loading.gif" alt="image-20200401211714847"></a></p>
<p>1ã€å‰ç«¯è¯·æ±‚ <code>cms</code> æ‰§è¡Œé¡µé¢å‘å¸ƒã€‚</p>
<p>2ã€<code>cms</code> æ‰§è¡Œé™æ€åŒ–ç¨‹åºç”Ÿæˆ <code>html</code>æ–‡ä»¶ã€‚</p>
<p>3ã€<code>cms</code> å°† <code>html</code> æ–‡ä»¶å­˜å‚¨åˆ° <code>GridFS</code> ä¸­ã€‚</p>
<p>4ã€<code>cms</code> å‘ <code>MQ</code> å‘é€é¡µé¢å‘å¸ƒæ¶ˆæ¯</p>
<p>5ã€<code>MQ</code> å°†é¡µé¢å‘å¸ƒæ¶ˆæ¯é€šçŸ¥ç»™ <code>Cms Client</code></p>
<p>6ã€<code>Cms Client</code> ä» <code>GridFS</code> ä¸­ä¸‹è½½ <code>html</code> æ–‡ä»¶</p>
<p>7ã€<code>Cms Client</code> å°† <code>html</code> ä¿å­˜åˆ°æ‰€åœ¨æœåŠ¡å™¨æŒ‡å®šç›®å½•</p>
<h2 id="2-é¡µé¢å‘å¸ƒæ¶ˆè´¹æ–¹"><a href="#2-é¡µé¢å‘å¸ƒæ¶ˆè´¹æ–¹" class="headerlink" title="2. é¡µé¢å‘å¸ƒæ¶ˆè´¹æ–¹"></a>2. é¡µé¢å‘å¸ƒæ¶ˆè´¹æ–¹</h2><h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>åŠŸèƒ½åˆ†æ</p>
<p>åˆ›å»º <code>Cms Client</code> å·¥ç¨‹ä½œä¸ºé¡µé¢å‘å¸ƒæ¶ˆè´¹æ–¹ï¼Œå°† <code>Cms Client</code> éƒ¨ç½²åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå®ƒè´Ÿè´£æ¥æ”¶åˆ°é¡µé¢å‘å¸ƒ çš„æ¶ˆæ¯åä» <code>GridFS</code> ä¸­ä¸‹è½½æ–‡ä»¶åœ¨æœ¬åœ°ä¿å­˜ã€‚</p>
<p>éœ€æ±‚å¦‚ä¸‹</p>
<p>1ã€å°† <code>cms Client</code> éƒ¨ç½²åœ¨æœåŠ¡å™¨ï¼Œé…ç½®é˜Ÿåˆ—åç§°å’Œç«™ç‚¹ <code>ID</code>ã€‚</p>
<p>2ã€<code>cms Client</code> è¿æ¥ <code>RabbitMQ</code> å¹¶ç›‘å¬å„è‡ªçš„â€œé¡µé¢å‘å¸ƒé˜Ÿåˆ—â€</p>
<p>3ã€<code>cms Client</code> æ¥æ”¶é¡µé¢å‘å¸ƒé˜Ÿåˆ—çš„æ¶ˆæ¯</p>
<p>4ã€æ ¹æ®æ¶ˆæ¯ä¸­çš„é¡µé¢ <code>id</code> ä» <code>mongodb</code> æ•°æ®åº“ä¸‹è½½é¡µé¢åˆ°æœ¬åœ°</p>
<h3 id="åˆ›å»ºCms-Clientå·¥ç¨‹"><a href="#åˆ›å»ºCms-Clientå·¥ç¨‹" class="headerlink" title="åˆ›å»ºCms Clientå·¥ç¨‹"></a>åˆ›å»ºCms Clientå·¥ç¨‹</h3><h4 id="1ã€POMé…ç½®"><a href="#1ã€POMé…ç½®" class="headerlink" title="1ã€POMé…ç½®"></a>1ã€POMé…ç½®</h4><div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span>
<span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span>
<span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../xc-framework-parent/pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-manage-cms-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>

    <span class="hljs-comment">&lt;!--é¡¹ç›®ä¾èµ–--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-model<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div>

<h4 id="2ã€é…ç½®æ–‡ä»¶"><a href="#2ã€é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€é…ç½®æ–‡ä»¶"></a>2ã€é…ç½®æ–‡ä»¶</h4><p>åœ¨<code>resources</code>ä¸‹é…ç½® <code>application.yml</code>ã€‚</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">31000</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">xc-service-manage-cms-client</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">mongodb:</span>
      <span class="hljs-attr">uri:</span> <span class="hljs-string">mongodb://root:123123@localhost:27017</span>
      <span class="hljs-attr">database:</span> <span class="hljs-string">xc_cms</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span>
  <span class="hljs-attr">freemarker:</span>
    <span class="hljs-attr">cache:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#å…³é—­æ¨¡æ¿ç¼“å­˜ï¼Œæ–¹ä¾¿æµ‹è¯•</span>
    <span class="hljs-attr">settings:</span>
      <span class="hljs-attr">template_update_delay:</span> <span class="hljs-number">0</span>
<span class="hljs-attr">xuecheng:</span>
  <span class="hljs-attr">mq:</span>
  <span class="hljs-comment">#cmså®¢æˆ·ç«¯ç›‘æ§çš„é˜Ÿåˆ—åç§°ï¼ˆä¸åŒçš„å®¢æˆ·ç«¯ç›‘æ§çš„é˜Ÿåˆ—ä¸èƒ½é‡å¤ï¼‰</span>
    <span class="hljs-attr">queue:</span> <span class="hljs-string">queue_cms_postpage_01</span>
    <span class="hljs-attr">routingKey:</span> <span class="hljs-string">5a751fab6abb5044e0d19ea1</span> <span class="hljs-comment">#æ­¤routingKeyä¸ºé—¨æˆ·ç«™ç‚¹ID3</span></code></pre></div>

<p>è¯´æ˜ åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®é˜Ÿåˆ—çš„åç§°ï¼Œæ¯ä¸ª cms clientåœ¨éƒ¨ç½²æ—¶æ³¨æ„é˜Ÿåˆ—åç§°ä¸è¦é‡å¤</p>
<h4 id="3ã€å¯åŠ¨ç±»"><a href="#3ã€å¯åŠ¨ç±»" class="headerlink" title="3ã€å¯åŠ¨ç±»"></a>3ã€å¯åŠ¨ç±»</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms_client;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)<span class="hljs-comment">//æ‰«æcommonä¸‹çš„æ‰€æœ‰ç±»</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.manage_cms_client"</span>&#125;)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCmsClientApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(ManageCmsClientApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;
    &#125;
&#125;</code></pre></div>

<h3 id="RabbitmqConfig-é…ç½®ç±»"><a href="#RabbitmqConfig-é…ç½®ç±»" class="headerlink" title="RabbitmqConfig é…ç½®ç±»"></a>RabbitmqConfig é…ç½®ç±»</h3><p>æ¶ˆæ¯é˜Ÿåˆ—è®¾ç½®å¦‚ä¸‹</p>
<p>1ã€åˆ›å»º <code>ex_cms_postpage</code> äº¤æ¢æœº</p>
<p>2ã€æ¯ä¸ª <code>Cms Client</code> åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ä¸äº¤æ¢æœºç»‘å®š</p>
<p>3ã€æ¯ä¸ª <code>Cms Client</code> ç¨‹åºé…ç½®é˜Ÿåˆ—åç§°å’Œ <code>routingKey</code>ï¼Œå°†ç«™ç‚¹IDä½œä¸º<code>routingKey</code>ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms_client.config;

<span class="hljs-keyword">import</span> org.springframework.amqp.core.*;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitmqConfig</span> </span>&#123;
    <span class="hljs-comment">//é˜Ÿåˆ—beançš„åç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String QUEUE_CMS_POSTPAGE = <span class="hljs-string">"queue_cms_postpage"</span>;
    <span class="hljs-comment">//äº¤æ¢æœºçš„åç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EX_ROUTING_CMS_POSTPAGE = <span class="hljs-string">"ex_routing_cms_postpage"</span>;

    <span class="hljs-comment">//é˜Ÿåˆ—çš„åç§°</span>
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.mq.queue&#125;"</span>)
    <span class="hljs-keyword">public</span> String queue_cms_postpage_name;
    <span class="hljs-comment">//ç«™ç‚¹idä½œä¸ºrouting key</span>
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.mq.routingKey&#125;"</span>)
    <span class="hljs-keyword">public</span> String routingKey;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * é…ç½®directäº¤æ¢æœº</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Bean</span>(EX_ROUTING_CMS_POSTPAGE)
    <span class="hljs-function"><span class="hljs-keyword">public</span> Exchange <span class="hljs-title">EXCHANGE_DIRECT_INFORM</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(EX_ROUTING_CMS_POSTPAGE).durable(<span class="hljs-keyword">true</span>).build();
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * å£°æ˜é˜Ÿåˆ—</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Bean</span>(QUEUE_CMS_POSTPAGE)
    <span class="hljs-function"><span class="hljs-keyword">public</span> Queue <span class="hljs-title">QUEUE_CMS_POSTPAGE</span><span class="hljs-params">()</span></span>&#123;
        Queue queue = <span class="hljs-keyword">new</span> Queue(queue_cms_postpage_name);
        <span class="hljs-keyword">return</span> queue;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> queue</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> exchange</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Binding <span class="hljs-title">BINDING_QUEUE_INFORM_SMS</span><span class="hljs-params">(@Qualifier(QUEUE_CMS_POSTPAGE)</span> Queue queue,</span>
<span class="hljs-function">                                            @<span class="hljs-title">Qualifier</span><span class="hljs-params">(EX_ROUTING_CMS_POSTPAGE)</span> Exchange exchange)</span>&#123;
        <span class="hljs-keyword">return</span> BindingBuilder.bind(queue).to(exchange).with(routingKey).noargs();
    &#125;


&#125;</code></pre></div>

<p>é…ç½® MongoConfig</p>
<blockquote>
<p>åç»­çš„ä»£ç ä¸­éœ€è¦å°†GridFSBucketæ³¨å…¥æˆbean</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms_client.config;


<span class="hljs-keyword">import</span> com.mongodb.MongoClient;
<span class="hljs-keyword">import</span> com.mongodb.client.MongoDatabase;
<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSBucket;
<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSBuckets;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MongoConfig</span> </span>&#123;
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;spring.data.mongodb.database&#125;"</span>)
    String db;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> GridFSBucket <span class="hljs-title">getGridFSBucket</span><span class="hljs-params">(MongoClient mongoClient)</span></span>&#123;
        MongoDatabase database = mongoClient.getDatabase(db);
        GridFSBucket gridFSBucket = GridFSBuckets.create(database);
        <span class="hljs-keyword">return</span> gridFSBucket;
    &#125;
&#125;</code></pre></div>

<h3 id="å®šä¹‰æ¶ˆæ¯æ ¼å¼"><a href="#å®šä¹‰æ¶ˆæ¯æ ¼å¼" class="headerlink" title="å®šä¹‰æ¶ˆæ¯æ ¼å¼"></a>å®šä¹‰æ¶ˆæ¯æ ¼å¼</h3><p>æ¶ˆæ¯å†…å®¹é‡‡ç”¨ <code>json</code> æ ¼å¼å­˜å‚¨æ•°æ®ï¼Œå¦‚ä¸‹</p>
<p>é¡µé¢id å‘å¸ƒé¡µé¢çš„id</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"pageId"</span>:<span class="hljs-string">""</span>
&#125;</code></pre></div>

<h3 id="PageDao"><a href="#PageDao" class="headerlink" title="PageDao"></a>PageDao</h3><p>1ã€ä½¿ç”¨ <code>CmsPageRepository</code> æŸ¥è¯¢é¡µé¢ä¿¡æ¯</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsPage</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div>

<p>2ã€ä½¿ç”¨ <code>CmsSiteRepository</code> æŸ¥è¯¢ç«™ç‚¹ä¿¡æ¯ï¼Œä¸»è¦è·å–ç«™ç‚¹ç‰©ç†è·¯å¾„</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsSiteRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsSite</span>,<span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div>

<h3 id="PageService"><a href="#PageService" class="headerlink" title="PageService"></a>PageService</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms_client.service;

<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSBucket;

<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSDownloadStream;
<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.model.GridFSFile;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsSite;
<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CmsCode;
<span class="hljs-keyword">import</span> com.xuecheng.manage_cms_client.dao.CmsPageRepository;
<span class="hljs-keyword">import</span> com.xuecheng.manage_cms_client.dao.CmsSiteRepository;
<span class="hljs-keyword">import</span> org.apache.commons.io.IOUtils;
<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.query.Criteria;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.query.Query;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsResource;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> javax.annotation.Resource;
<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.io.FileOutputStream;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.util.Optional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageService</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    CmsPageRepository cmsPageRepository;

    <span class="hljs-meta">@Autowired</span>
    CmsSiteRepository cmsSiteRepository;

    <span class="hljs-meta">@Autowired</span>
    GridFsTemplate gridFsTemplate;

    <span class="hljs-meta">@Autowired</span>
    GridFSBucket gridFSBucket;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * å°†é¡µé¢htmlä¿å­˜åˆ°é¡µé¢ç‰©ç†è·¯å¾„</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageId</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">savePageToServerPath</span><span class="hljs-params">(String pageId)</span></span>&#123;
        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(pageId);
        <span class="hljs-comment">//é¡µé¢ä¸å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸</span>
        <span class="hljs-keyword">if</span>(!optional.isPresent())&#123;
            ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);
        &#125;

        CmsPage cmsPage = optional.get();
        CmsSite cmsSite = <span class="hljs-keyword">this</span>.getCmsSiteById(cmsPage.getSiteId());
        <span class="hljs-keyword">if</span>(cmsSite == <span class="hljs-keyword">null</span>)&#123;
            ExceptionCast.cast(CmsCode.CMS_SIZE_NOT_EXISTS);
        &#125;

        <span class="hljs-comment">//åŸè®²ä¹‰å’Œè§†é¢‘ä¸­ä½¿ç”¨çš„æ˜¯sizePathysicaiPath,ä½†æ˜¯SizePageä¸­æ²¡æœ‰è¿™ä¸ªå­—æ®µï¼Œä½¿ç”¨PageCmsä¸­çš„PathysicaiPathä»£æ›¿</span>
        String pagePath = cmsPage.getPagePhysicalPath() + cmsPage.getPageWebPath() + cmsPage.getPageName();

        <span class="hljs-comment">//è·å–é¡µé¢æ–‡ä»¶id</span>
        String htmlFileId = cmsPage.getHtmlFileId();
        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(htmlFileId))&#123;
            ExceptionCast.cast(CmsCode.CMS_PAGE_FILEID_NOT_EXISTS);
        &#125;
        <span class="hljs-comment">//è·å–æ–‡ä»¶æµ</span>
        InputStream inputStream = <span class="hljs-keyword">this</span>.getFileInputStreamFileById(htmlFileId);
        <span class="hljs-keyword">if</span>(inputStream == <span class="hljs-keyword">null</span>)&#123;
            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_HTML_IS_NULL);
        &#125;

        FileOutputStream fileOutputStream = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> &#123;
            fileOutputStream = <span class="hljs-keyword">new</span> FileOutputStream(<span class="hljs-keyword">new</span> File(pagePath));
            <span class="hljs-comment">//å°†æ–‡ä»¶ä¿å­˜è‡³ç‰©ç†è·¯å¾„</span>
            IOUtils.copy(inputStream,fileOutputStream);
        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;
            e.printStackTrace();
        &#125;<span class="hljs-keyword">finally</span> &#123;
            <span class="hljs-comment">//å…³é—­æµ</span>
            <span class="hljs-keyword">try</span> &#123;
                inputStream.close();
            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
                e.printStackTrace();
            &#125; <span class="hljs-keyword">try</span> &#123;
                fileOutputStream.close();
            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
    &#125;

    <span class="hljs-comment">//æ ¹æ®æ–‡ä»¶idè·å–æ–‡ä»¶çš„gridFSè¾“å…¥æµ</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> InputStream <span class="hljs-title">getFileInputStreamFileById</span><span class="hljs-params">(String fileId)</span></span>&#123;
        GridFSFile gridFSFile = gridFsTemplate.findOne(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(fileId)));
        <span class="hljs-comment">//è·å–gridFsä¸‹è½½æµ</span>
        GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(gridFSFile.getObjectId());
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-comment">//è·å–æ–‡ä»¶è¾“å…¥æµ</span>
            GridFsResource gridFsResource = <span class="hljs-keyword">new</span> GridFsResource(gridFSFile, gridFSDownloadStream);
            <span class="hljs-keyword">return</span> gridFsResource.getInputStream();
        &#125;<span class="hljs-keyword">catch</span> (IOException e)&#123;
            e.printStackTrace();
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;

    <span class="hljs-comment">//æ ¹æ®ç«™ç‚¹idå¾—åˆ°ç«™ç‚¹ä¿¡æ¯</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> CmsSite <span class="hljs-title">getCmsSiteById</span><span class="hljs-params">(String siteId)</span></span>&#123;
        Optional&lt;CmsSite&gt; optional = cmsSiteRepository.findById(siteId);
        <span class="hljs-keyword">if</span>(!optional.isPresent())&#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        &#125;
        CmsSite cmsSite = optional.get();
        <span class="hljs-keyword">return</span> cmsSite;
    &#125;
&#125;</code></pre></div>

<h3 id="ConsumerPostPage"><a href="#ConsumerPostPage" class="headerlink" title="ConsumerPostPage"></a>ConsumerPostPage</h3><p>åœ¨ <code>cms client</code> å·¥ç¨‹çš„ <code>mq</code> åŒ…ä¸‹åˆ›å»º <code>ConsumerPostPage</code> ç±»ï¼Œ<code>ConsumerPostPage</code> ä½œä¸ºå‘å¸ƒé¡µé¢çš„æ¶ˆè´¹å®¢æˆ·ç«¯ï¼Œç›‘å¬é¡µé¢å‘å¸ƒé˜Ÿåˆ—çš„æ¶ˆæ¯ï¼Œæ”¶åˆ°æ¶ˆæ¯åä» <code>mongodb</code> ä¸‹è½½æ–‡ä»¶ï¼Œä¿å­˜åœ¨æœ¬åœ°ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms_client.mq;


<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;
<span class="hljs-keyword">import</span> com.xuecheng.manage_cms_client.dao.CmsPageRepository;
<span class="hljs-keyword">import</span> com.xuecheng.manage_cms_client.service.PageService;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.Optional;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ConsumerPostPage</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ConsumerPostPage<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-meta">@Autowired</span>
    CmsPageRepository cmsPageRepository;
    <span class="hljs-meta">@Autowired</span>
    PageService pageService;

    <span class="hljs-meta">@RabbitListener</span>(queues = &#123;<span class="hljs-string">"$&#123;xuecheng.mq.queue&#125;"</span>&#125;) <span class="hljs-comment">//ç›‘å¬é˜Ÿåˆ—</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postPage</span><span class="hljs-params">(String msg)</span></span>&#123;
        <span class="hljs-comment">//è§£ææ¶ˆæ¯</span>
        Map map = JSON.parseObject(msg, Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
        LOGGER.info(<span class="hljs-string">"receive cms post page:&#123;&#125;"</span>, msg.toString());
        <span class="hljs-comment">//å–å‡ºé¡µé¢id</span>
        String pageId = (String) map.get(<span class="hljs-string">"pageId"</span>);

        <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>
        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(pageId);
        <span class="hljs-keyword">if</span>(!optional.isPresent())&#123;
            LOGGER.error(<span class="hljs-string">"receive cms post page,cmsPage is null: &#123;&#125;"</span>,msg.toString());
        &#125;

        <span class="hljs-comment">//å°†é¡µé¢ä¿å­˜åˆ°æœåŠ¡å™¨ç‰©ç†è·¯å¾„</span>
        pageService.savePageToServerPath(pageId);
    &#125;
&#125;</code></pre></div>

<h2 id="3-é¡µé¢å‘å¸ƒç”Ÿäº§æ–¹"><a href="#3-é¡µé¢å‘å¸ƒç”Ÿäº§æ–¹" class="headerlink" title="3. é¡µé¢å‘å¸ƒç”Ÿäº§æ–¹"></a>3. é¡µé¢å‘å¸ƒç”Ÿäº§æ–¹</h2><h3 id="éœ€æ±‚åˆ†æ-1"><a href="#éœ€æ±‚åˆ†æ-1" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>ç®¡ç†å‘˜é€šè¿‡ <code>cms</code> ç³»ç»Ÿå‘å¸ƒ â€œ<strong>é¡µé¢å‘å¸ƒ</strong>â€ çš„æ¶ˆè´¹ï¼Œ<code>cms</code> ç³»ç»Ÿä½œä¸ºé¡µé¢å‘å¸ƒçš„ç”Ÿäº§æ–¹ã€‚<br>éœ€æ±‚å¦‚ä¸‹</p>
<p>1ã€ç®¡ç†å‘˜è¿›å…¥ç®¡ç†ç•Œé¢ç‚¹å‡»â€œé¡µé¢å‘å¸ƒâ€ï¼Œå‰ç«¯è¯·æ±‚cmsé¡µé¢å‘å¸ƒæ¥å£ã€‚</p>
<p>2ã€cmsé¡µé¢å‘å¸ƒæ¥å£æ‰§è¡Œé¡µé¢é™æ€åŒ–ï¼Œå¹¶å°†é™æ€åŒ–é¡µé¢å­˜å‚¨è‡³GridFSä¸­ã€‚</p>
<p>3ã€é™æ€åŒ–æˆåŠŸåï¼Œå‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€é¡µé¢å‘å¸ƒçš„æ¶ˆæ¯ã€‚</p>
<p> 1ï¼‰ è·å–é¡µé¢çš„ä¿¡æ¯åŠé¡µé¢æ‰€å±ç«™ç‚¹IDã€‚</p>
<p> 2ï¼‰ è®¾ç½®æ¶ˆæ¯å†…å®¹ä¸ºé¡µé¢IDã€‚ï¼ˆé‡‡ç”¨jsonæ ¼å¼ï¼Œæ–¹ä¾¿æ—¥åæ‰©å±•ï¼‰</p>
<p> 3ï¼‰ å‘é€æ¶ˆæ¯ç»™ <code>ex_cms_postpage</code> äº¤æ¢æœºï¼Œå¹¶å°†ç«™ç‚¹IDä½œä¸º <code>routingKey</code>ã€‚</p>
<h3 id="RabbitMQé…ç½®"><a href="#RabbitMQé…ç½®" class="headerlink" title="RabbitMQé…ç½®"></a>RabbitMQé…ç½®</h3><p>1ã€é…ç½® <code>Rabbitmq</code> çš„è¿æ¥å‚æ•°</p>
<p>åœ¨ <code>application.yml</code> æ·»åŠ å¦‚ä¸‹é…ç½®</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">virtualHost:</span> <span class="hljs-string">/</span></code></pre></div>

<p>2ã€åœ¨ <code>pom.xml</code> æ·»åŠ ä¾èµ–</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springâ€bootâ€starterâ€amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<p>3ã€<code>RabbitMQConfig</code> é…ç½®</p>
<p>ç”±äº <code>cms</code> ä½œä¸ºé¡µé¢å‘å¸ƒæ–¹è¦é¢å¯¹å¾ˆå¤šä¸åŒç«™ç‚¹çš„æœåŠ¡å™¨ï¼Œé¢å¯¹å¾ˆå¤šé¡µé¢å‘å¸ƒé˜Ÿåˆ—ï¼Œæ‰€ä»¥è¿™é‡Œä¸å†é…ç½®é˜Ÿåˆ—ï¼Œåªéœ€è¦é…ç½®äº¤æ¢æœºåç§°å³å¯ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.config;

<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.Exchange;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.ExchangeBuilder;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RabbitmqConfig</span> </span>&#123;
    <span class="hljs-comment">//äº¤æ¢æœºçš„åç§°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String EX_ROUTING_CMS_POSTPAGE=<span class="hljs-string">"ex_routing_cms_postpage"</span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * äº¤æ¢é…ç½®ä½¿ç”¨directç±»å‹</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Bean</span>(EX_ROUTING_CMS_POSTPAGE)
    <span class="hljs-function"><span class="hljs-keyword">public</span> Exchange <span class="hljs-title">EXCHANGE_TOPICS_INFORM</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> ExchangeBuilder.directExchange(EX_ROUTING_CMS_POSTPAGE).durable(<span class="hljs-keyword">true</span>).build();
    &#125;
&#125;</code></pre></div>

<h3 id="Api-æ¥å£"><a href="#Api-æ¥å£" class="headerlink" title="Api æ¥å£"></a>Api æ¥å£</h3><p>åœ¨apiå·¥ç¨‹å®šä¹‰é¡µé¢å‘å¸ƒæ¥å£</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"å‘å¸ƒé¡µé¢"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">post</span><span class="hljs-params">(String pageId)</span></span>;</code></pre></div>

<h3 id="PageService-1"><a href="#PageService-1" class="headerlink" title="PageService"></a>PageService</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.service;

<span class="hljs-keyword">import</span> com.alibaba.fastjson.JSON;
<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSBucket;
<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.GridFSDownloadStream;
<span class="hljs-keyword">import</span> com.mongodb.client.gridfs.model.GridFSFile;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsTemplate;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.request.QueryPageRequest;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.response.CmsPageResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.*;
<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.config.RabbitmqConfig;
<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.dao.CmsPageRepository;
<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.dao.CmsTemplateRepository;
<span class="hljs-keyword">import</span> freemarker.cache.StringTemplateLoader;
<span class="hljs-keyword">import</span> freemarker.template.Configuration;
<span class="hljs-keyword">import</span> freemarker.template.Template;
<span class="hljs-keyword">import</span> freemarker.template.TemplateException;
<span class="hljs-keyword">import</span> io.netty.util.internal.StringUtil;
<span class="hljs-keyword">import</span> org.apache.commons.io.IOUtils;
<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;
<span class="hljs-keyword">import</span> org.bson.types.ObjectId;
<span class="hljs-keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.data.domain.*;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.query.Criteria;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.core.query.Query;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsResource;
<span class="hljs-keyword">import</span> org.springframework.data.mongodb.gridfs.GridFsTemplate;
<span class="hljs-keyword">import</span> org.springframework.http.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.ui.freemarker.FreeMarkerTemplateUtils;
<span class="hljs-keyword">import</span> org.springframework.web.client.RestTemplate;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.io.InputStream;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.Optional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    CmsPageRepository cmsPageRepository;

    <span class="hljs-meta">@Autowired</span>
    RestTemplate restTemplate;

    <span class="hljs-meta">@Autowired</span>
    CmsTemplateRepository templateRepository;

    <span class="hljs-meta">@Autowired</span>
    GridFsTemplate gridFsTemplate;

    <span class="hljs-meta">@Autowired</span>
    GridFSBucket gridFSBucket;

    <span class="hljs-meta">@Autowired</span>
    RabbitTemplate rabbitTemplate;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * é¡µé¢å‘å¸ƒ</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageId</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">postPage</span><span class="hljs-params">(String pageId)</span> </span>&#123;
        <span class="hljs-comment">//æ‰§è¡Œé™æ€åŒ–</span>
        String pageHtml = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> &#123;
            pageHtml = <span class="hljs-keyword">this</span>.getPageHtml(pageId);
        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
            e.printStackTrace();
        &#125; <span class="hljs-keyword">catch</span> (TemplateException e) &#123;
            e.printStackTrace();
        &#125;
        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(pageHtml))&#123;
            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_HTML_IS_NULL);
        &#125;

        <span class="hljs-comment">//ä¿å­˜é™æ€åŒ–æ–‡ä»¶</span>
        CmsPage cmsPage = <span class="hljs-keyword">this</span>.saveHtml(pageId, pageHtml);
        <span class="hljs-comment">//å‘é€æ¶ˆæ¯</span>
        <span class="hljs-keyword">this</span>.sendPostPage(pageId);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);
    &#125;

    <span class="hljs-comment">//å‘é€é¡µé¢å‘å¸ƒæ¶ˆæ¯</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sendPostPage</span><span class="hljs-params">(String pageId)</span></span>&#123;
        CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.cmsPageQueryById(pageId);
        CmsPage cmsPage = cmsPageResult.getCmsPage();
        <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;
            ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);
        &#125;
        Map&lt;String, String&gt; msgMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
        msgMap.put(<span class="hljs-string">"pageId"</span>,pageId);
        <span class="hljs-comment">//æ¶ˆæ¯å†…å®¹</span>
        String msg = JSON.toJSONString(msgMap);
        <span class="hljs-comment">//è·å–ç«™ç‚¹idä½œä¸ºrouting key</span>
        String siteId = cmsPage.getSiteId();
        <span class="hljs-comment">//å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šäº¤æ¢æœºã€routingKeyã€ä»¥åŠè¦å‘é€çš„æ¶ˆæ¯</span>
        rabbitTemplate.convertAndSend(RabbitmqConfig.EX_ROUTING_CMS_POSTPAGE,siteId,msg);
    &#125;

    <span class="hljs-comment">//ä¿å­˜é™æ€åŒ–é¡µé¢å†…å®¹</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> CmsPage <span class="hljs-title">saveHtml</span><span class="hljs-params">(String pageId,String content)</span></span>&#123;
        <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢æ˜¯å¦å­˜åœ¨</span>
        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(pageId);
        <span class="hljs-keyword">if</span>(!optional.isPresent())&#123;
            ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);
        &#125;

        CmsPage cmsPage = optional.get();
        <span class="hljs-comment">//å‚¨å­˜ä¹‹å‰å…ˆåˆ é™¤</span>
        String htmlFileId = cmsPage.getHtmlFileId();
        <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(htmlFileId))&#123;
            gridFsTemplate.delete(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(htmlFileId)));
        &#125;
        <span class="hljs-comment">//ä¿å­˜htmlæ–‡ä»¶åˆ°GridFS</span>
        <span class="hljs-keyword">try</span> &#123;
            InputStream inputStream = IOUtils.toInputStream(content,<span class="hljs-string">"utf-8"</span>);
            ObjectId objectId = gridFsTemplate.store(inputStream, cmsPage.getPageName());
            <span class="hljs-comment">//æ–‡ä»¶id</span>
            String fileId = objectId.toString();
            <span class="hljs-comment">//å°†æ–‡ä»¶idå‚¨å­˜åˆ°cmspageä¸­</span>
            cmsPage.setHtmlFileId(fileId);
            cmsPageRepository.save(cmsPage);
        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
            e.printStackTrace();
        &#125;

        <span class="hljs-keyword">return</span> cmsPage;
    &#125;


    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * é¡µé¢é™æ€åŒ–</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageId</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> TemplateException</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPageHtml</span><span class="hljs-params">(String pageId)</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;
        <span class="hljs-comment">//è·å–é¡µé¢æ¨¡å‹æ•°æ®</span>
        Map modelByPageId = <span class="hljs-keyword">this</span>.getModelByPageId(pageId);
        <span class="hljs-keyword">if</span>(modelByPageId == <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-comment">//è·å–é¡µé¢æ¨¡å‹æ•°æ®ä¸ºç©º</span>
            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_DATA_IS_NULL);
        &#125;
        <span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿</span>
        String templateContent = getTemplateByPageId(pageId);
        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(templateContent))&#123;
            <span class="hljs-comment">//é¡µé¢æ¨¡æ¿ä¸ºç©º</span>
            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_TEMPLATE_IS_NULL);
        &#125;
        <span class="hljs-comment">//æ„å»ºé¡µé¢é™æ€åŒ–æ•°æ®</span>
        String html = generateHtml(templateContent, modelByPageId);
        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(html))&#123;
            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_HTML_IS_NULL);
        &#125;
        <span class="hljs-keyword">return</span> html;
    &#125;

    <span class="hljs-comment">//æ„å»ºé™æ€åŒ–é¡µé¢æ•°æ®</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">generateHtml</span><span class="hljs-params">(String template,Map model)</span> <span class="hljs-keyword">throws</span> IOException, TemplateException </span>&#123;
        <span class="hljs-comment">//ç”Ÿæˆé…ç½®ç±»</span>
        Configuration configuration = <span class="hljs-keyword">new</span> Configuration(Configuration.getVersion());
        <span class="hljs-comment">//æ¨¡æ¿åŠ è½½å™¨</span>
        StringTemplateLoader stringTemplateLoader = <span class="hljs-keyword">new</span> StringTemplateLoader();
        stringTemplateLoader.putTemplate(<span class="hljs-string">"template"</span>,template);
        <span class="hljs-comment">//é…ç½®æ¨¡æ¿åŠ è½½å™¨</span>
        configuration.setTemplateLoader(stringTemplateLoader);

        <span class="hljs-comment">//è·å–æ¨¡æ¿</span>
        Template template1 = configuration.getTemplate(<span class="hljs-string">"template"</span>);
        String html = FreeMarkerTemplateUtils.processTemplateIntoString(template1, model);
        <span class="hljs-keyword">return</span> html;
    &#125;

    <span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿æ–‡ä»¶æ•°æ®</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getTemplateByPageId</span><span class="hljs-params">(String pageId)</span></span>&#123;
        <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>
        CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.cmsPageQueryById(pageId);
        CmsPage cmsPage = cmsPageResult.getCmsPage();
        <span class="hljs-comment">//é¡µé¢ä¸å­˜åœ¨</span>
        <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;
            ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);
        &#125;
        <span class="hljs-comment">//è·å–é¡µé¢æ¨¡æ¿æ•°æ®</span>
        String templateId = cmsPage.getTemplateId();
        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(templateId))&#123;
            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_TEMPLATE_IS_NULL);
        &#125;
        Optional&lt;CmsTemplate&gt; optional = templateRepository.findById(templateId);
        <span class="hljs-keyword">if</span>(optional.isPresent())&#123;
            CmsTemplate cmsTemplate = optional.get();
            <span class="hljs-comment">//è·å–æ¨¡æ¿æ–‡ä»¶id</span>
            String templateFileId = cmsTemplate.getTemplateFileId();
            <span class="hljs-comment">//å–å‡ºæ¨¡æ¿æ–‡ä»¶å†…å®¹</span>
            GridFSFile gridFSFile = gridFsTemplate.findOne(Query.query(Criteria.where(<span class="hljs-string">"_id"</span>).is(templateFileId)));
            <span class="hljs-comment">//æ‰“å¼€ä¸‹è½½æµå¯¹è±¡</span>
            GridFSDownloadStream gridFSDownloadStream = gridFSBucket.openDownloadStream(gridFSFile.getObjectId());
            <span class="hljs-comment">//åˆ›å»ºGridResource</span>
            GridFsResource gridFsResource = <span class="hljs-keyword">new</span> GridFsResource(gridFSFile, gridFSDownloadStream);

            <span class="hljs-keyword">try</span> &#123;
                String content = IOUtils.toString(gridFsResource.getInputStream(), <span class="hljs-string">"utf-8"</span>);
                <span class="hljs-keyword">return</span> content;
            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;

    <span class="hljs-comment">//ä»dataUrlä¸­è·å–é¡µé¢æ¨¡å‹æ•°æ®</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> Map <span class="hljs-title">getModelByPageId</span><span class="hljs-params">(String pageId)</span></span>&#123;
        <span class="hljs-comment">//æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>
        CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.cmsPageQueryById(pageId);
        CmsPage cmsPage = cmsPageResult.getCmsPage();
        <span class="hljs-comment">//é¡µé¢ä¸å­˜åœ¨</span>
        <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;
            ExceptionCast.cast(CmsCode.CMS_PAGE_NOT_EXISTS);
        &#125;
        <span class="hljs-comment">//å–å‡ºdataUrl</span>
        String dataUrl = cmsPage.getDataUrl();
        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(dataUrl))&#123;
            ExceptionCast.cast(CmsCode.CMS_GENRATEHTML_DATAURL_IS_NULL);
        &#125;
        <span class="hljs-comment">//å‘é€è¯·æ±‚è·å–æ¨¡å‹æ•°æ®</span>
        ResponseEntity&lt;Map&gt; forEntity = restTemplate.getForEntity(dataUrl,Map<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;
        Map body = forEntity.getBody();
        <span class="hljs-keyword">return</span> body;
    &#125;


    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * åˆ†é¡µæŸ¥è¯¢ã€é¡µé¢CURL éƒ¨åˆ†ä»£ç ç•¥è¿‡ï¼Œéœ€è¦è¯·å‚è€ƒå‰é¢çš„ç« èŠ‚</span>
<span class="hljs-comment">     */</span>

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æ ¹æ®idè·å–é¡µé¢æ•°æ®</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">cmsPageQueryById</span><span class="hljs-params">(String id)</span> </span>&#123;
        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(id);
        <span class="hljs-keyword">if</span> (optional.isPresent()) &#123;
            CmsPage cmsPage = optional.get();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS, cmsPage);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL, <span class="hljs-keyword">null</span>);
    &#125;

&#125;</code></pre></div>

<h2 id="4-é¡µé¢å‘å¸ƒå‰ç«¯"><a href="#4-é¡µé¢å‘å¸ƒå‰ç«¯" class="headerlink" title="4. é¡µé¢å‘å¸ƒå‰ç«¯"></a>4. é¡µé¢å‘å¸ƒå‰ç«¯</h2><p>ç”¨æˆ·æ“ä½œæµç¨‹</p>
<p>1ã€ç”¨æˆ·è¿›å…¥ <code>cms</code> é¡µé¢åˆ—è¡¨ã€‚</p>
<p>2ã€ç‚¹å‡» â€œ<strong>å‘å¸ƒ</strong>â€ è¯·æ±‚æœåŠ¡ç«¯æ¥å£ï¼Œå‘å¸ƒé¡µé¢ã€‚</p>
<p>3ã€æç¤º â€œ<strong>å‘å¸ƒæˆåŠŸ</strong>â€ï¼Œæˆ–å‘å¸ƒå¤±è´¥ã€‚</p>
<h3 id="APIæ–¹æ³•"><a href="#APIæ–¹æ³•" class="headerlink" title="APIæ–¹æ³•"></a>APIæ–¹æ³•</h3><p>åœ¨ cmså‰ç«¯æ·»åŠ  apiæ–¹æ³•ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/*å‘å¸ƒé¡µé¢*/</span>
export <span class="hljs-keyword">const</span> page_postPage= id =&gt; &#123;
  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/cms/page/postPage/'</span>+id)
&#125;</code></pre></div>

<h3 id="é¡µé¢å¼€å‘"><a href="#é¡µé¢å¼€å‘" class="headerlink" title="é¡µé¢å¼€å‘"></a>é¡µé¢å¼€å‘</h3><p>ä¿®æ”¹ page_list.vueï¼Œæ·»åŠ å‘å¸ƒæŒ‰é’®</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€tableâ€column</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"å‘å¸ƒ"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"80"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">slot</span>â€<span class="hljs-attr">scope</span>=<span class="hljs-string">"scope"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span></span>
<span class="hljs-tag">      <span class="hljs-attr">size</span>=<span class="hljs-string">"small"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">plain</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"postPage(scope.row.pageId)"</span>&gt;</span>å‘å¸ƒ
    <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€tableâ€column</span>&gt;</span></code></pre></div>

<p>æ·»åŠ é¡µé¢å‘å¸ƒäº‹ä»¶</p>
<div class="hljs"><pre><code class="hljs js">postPage (id) &#123;
  <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤å‘å¸ƒè¯¥é¡µé¢å—?'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;
  &#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    cmsApi.page_postPage(id).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
      <span class="hljs-keyword">if</span>(res.success)&#123;
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'å‘å¸ƒé¡µé¢id='</span>+id);
        <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">'å‘å¸ƒæˆåŠŸï¼Œè¯·ç¨åæŸ¥çœ‹ç»“æœ'</span>);
      &#125;<span class="hljs-keyword">else</span>&#123;
        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'å‘å¸ƒå¤±è´¥'</span>);
      &#125;
    &#125;);
  &#125;).catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
  &#125;);
&#125;,</code></pre></div>

<h2 id="5-æµ‹è¯•"><a href="#5-æµ‹è¯•" class="headerlink" title="5. æµ‹è¯•"></a>5. æµ‹è¯•</h2><p>è¿™é‡Œæµ‹è¯•è½®æ’­å›¾é¡µé¢ä¿®æ”¹ã€å‘å¸ƒçš„æµç¨‹</p>
<p>1ã€ä¿®æ”¹è½®æ’­å›¾é¡µé¢æ¨¡æ¿æˆ–ä¿®æ”¹è½®æ’­å›¾åœ°å€</p>
<p>æ³¨æ„ å…ˆä¿®æ”¹é¡µé¢åŸå‹ï¼Œé¡µé¢åŸå‹è°ƒè¯•æ­£å¸¸åå†ä¿®æ”¹é¡µé¢æ¨¡æ¿ã€‚</p>
<p>2ã€æ‰§è¡Œé¡µé¢é¢„è§ˆ</p>
<p>3ã€æ‰§è¡Œé¡µé¢å‘å¸ƒï¼ŒæŸ¥çœ‹é¡µé¢æ˜¯å¦å†™åˆ°ç½‘ç«™ç›®å½•</p>
<p>4ã€åˆ·æ–°é—¨æˆ·é¦–é¡µå¹¶è§‚å¯Ÿè½®æ’­å›¾æ˜¯å¦å˜åŒ–ã€‚</p>
<h2 id="6-æ€è€ƒ"><a href="#6-æ€è€ƒ" class="headerlink" title="6. æ€è€ƒ"></a>6. æ€è€ƒ</h2><p>1ã€å¦‚æœå‘å¸ƒåˆ°æœåŠ¡å™¨çš„é¡µé¢å†…å®¹ä¸æ­£ç¡®æ€ä¹ˆåŠï¼Ÿ</p>
<p>2ã€ä¸€ä¸ªé¡µé¢éœ€è¦å‘å¸ƒå¾ˆå¤šæœåŠ¡å™¨ï¼Œç‚¹å‡»â€œå‘å¸ƒâ€åå¦‚ä½•çŸ¥é“è¯¦ç»†çš„å‘å¸ƒç»“æœï¼Ÿ</p>
<p>3ã€ä¸€ä¸ªé¡µé¢å‘å¸ƒåˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæœåŠ¡å™¨å‘å¸ƒå¤±è´¥æ—¶æ€ä¹ˆåŠï¼Ÿ</p>
<h1 id="äºŒã€è¯¾ç¨‹ç®¡ç†"><a href="#äºŒã€è¯¾ç¨‹ç®¡ç†" class="headerlink" title="äºŒã€è¯¾ç¨‹ç®¡ç†"></a>äºŒã€è¯¾ç¨‹ç®¡ç†</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åœ¨çº¿æ•™è‚²å¹³å°çš„è¯¾ç¨‹ä¿¡æ¯ç›¸å½“äºç”µå•†å¹³å°çš„å•†å“ã€‚è¯¾ç¨‹ç®¡ç†æ˜¯åå°ç®¡ç†åŠŸèƒ½ä¸­æœ€é‡è¦çš„æ¨¡å—ã€‚æœ¬é¡¹ç›®ä¸ºæ•™å­¦æœºæ„æä¾›è¯¾ç¨‹ç®¡ç†åŠŸèƒ½ï¼Œæ•™å­¦æœºæ„å¯ä»¥æ·»åŠ å±äºè‡ªå·±çš„è¯¾ç¨‹ï¼Œä¾›å­¦ç”Ÿåœ¨çº¿å­¦ä¹ ã€‚</p>
<p><strong>è¯¾ç¨‹ç®¡ç†åŒ…æ‹¬å¦‚ä¸‹åŠŸèƒ½éœ€æ±‚</strong></p>
<p>1ã€åˆ†ç±»ç®¡ç†<br>2ã€æ–°å¢è¯¾ç¨‹<br>3ã€ä¿®æ”¹è¯¾ç¨‹<br>4ã€é¢„è§ˆè¯¾ç¨‹<br>5ã€å‘å¸ƒè¯¾ç¨‹</p>
<p><strong>ç”¨æˆ·çš„æ“ä½œæµç¨‹å¦‚ä¸‹</strong></p>
<p><strong>1ã€è¿›å…¥æˆ‘çš„è¯¾ç¨‹</strong></p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image3.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image3.png" srcset="/img/loading.gif" alt="image-20200401214528987"></a></p>
<p><strong>2ã€ç‚¹å‡»â€œæ·»åŠ è¯¾ç¨‹â€ï¼Œè¿›å…¥æ·»åŠ è¯¾ç¨‹ç•Œé¢</strong></p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image4.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image4.png" srcset="/img/loading.gif" alt="image-20200401214540896"></a></p>
<p><strong>3ã€è¾“å…¥è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯ï¼Œç‚¹å‡»æäº¤</strong></p>
<p><strong>4ã€è¯¾ç¨‹åŸºæœ¬ä¿¡æ¯æäº¤æˆåŠŸï¼Œè‡ªåŠ¨è¿›å…¥â€œç®¡ç†è¯¾ç¨‹â€ç•Œé¢ï¼Œç‚¹å‡»â€œç®¡ç†è¯¾ç¨‹â€ä¹Ÿå¯ä»¥è¿›å…¥â€œç®¡ç†è¯¾ç¨‹â€ç•Œé¢</strong></p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image5.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image5.png" srcset="/img/loading.gif" alt="image-20200401214605318"></a></p>
<p><strong>5ã€ç¼–è¾‘å›¾ç‰‡ä¸Šä¼ è¯¾ç¨‹å›¾ç‰‡ã€‚</strong></p>
<p><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image6.png" srcset="/img/loading.gif" alt="image-20200401214657046"></p>
<p><strong>6ã€ç¼–è¾‘è¯¾ç¨‹è¥é”€ä¿¡æ¯</strong></p>
<p>è¥é”€ä¿¡æ¯ä¸»è¦æ˜¯è®¾ç½®è¯¾ç¨‹çš„æ”¶è´¹æ–¹å¼åŠä»·æ ¼ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image7.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image7.png" srcset="/img/loading.gif" alt="image-20200401214707765"></a></p>
<p><strong>7ã€ç¼–è¾‘è¯¾ç¨‹è®¡åˆ’</strong></p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image8.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image8.png" srcset="/img/loading.gif" alt="image-20200401214718496"></a></p>
<h2 id="2-æ•™å­¦æ–¹æ³•"><a href="#2-æ•™å­¦æ–¹æ³•" class="headerlink" title="2. æ•™å­¦æ–¹æ³•"></a>2. æ•™å­¦æ–¹æ³•</h2><p>æœ¬æ¨¡å—å¯¹è¯¾ç¨‹ä¿¡æ¯ç®¡ç†åŠŸèƒ½çš„æ•™å­¦æ–¹æ³•é‡‡ç”¨å®æˆ˜æ•™å­¦æ–¹æ³•ï¼Œæ—¨åœ¨é€šè¿‡å®æˆ˜æé«˜æ¥å£ç¼–å†™çš„èƒ½åŠ›ï¼Œå…·ä½“æ•™å­¦æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<p>1ã€å‰åç«¯å·¥ç¨‹å¯¼å…¥</p>
<p>æ•™å­¦ç®¡ç†å‰ç«¯å·¥ç¨‹é‡‡ç”¨ä¸ç³»ç»Ÿç®¡ç†å·¥ç¨‹ç›¸åŒçš„æŠ€æœ¯ï¼Œç›´æ¥å¯¼å…¥ååœ¨æ­¤åŸºç¡€ä¸Šå¼€å‘ã€‚<br>è¯¾ç¨‹ç®¡ç†æœåŠ¡ç«¯å·¥ç¨‹é‡‡ç”¨Spring BootæŠ€æœ¯æ„å»ºï¼ŒæŠ€æœ¯å±‚æŠ€æœ¯ä½¿ç”¨Spring data Jpaï¼ˆä¸Spring data Mongodbç±»<br>ä¼¼ï¼‰ã€Mybatisï¼Œç›´æ¥å¯¼å…¥ååœ¨æ­¤åŸºç¡€ä¸Šå¼€å‘ã€‚</p>
<p>2ã€è¯¾ç¨‹è®¡åˆ’åŠŸèƒ½</p>
<p>è¯¾ç¨‹è®¡åˆ’åŠŸèƒ½é‡‡ç”¨å…¨ç¨‹æ•™å­¦ã€‚</p>
<p>3ã€æˆ‘çš„è¯¾ç¨‹ã€æ–°å¢è¯¾ç¨‹ã€ä¿®æ”¹è¯¾ç¨‹ã€è¯¾ç¨‹è¥é”€</p>
<p>æˆ‘çš„è¯¾ç¨‹ã€æ–°å¢è¯¾ç¨‹ã€ä¿®æ”¹è¯¾ç¨‹ã€è¯¾ç¨‹è¥é”€å››ä¸ªåŠŸèƒ½é‡‡ç”¨å®æˆ˜æ–¹å¼ï¼Œè¯¾å ‚ä¸Šä¼šè®²è§£æ¯ä¸ªåŠŸèƒ½çš„éœ€æ±‚åŠæŠ€æœ¯ç‚¹ï¼Œè®²è§£å®Œæˆå­¦ç”Ÿå¼€å§‹å®æˆ˜ï¼Œç”±å¯¼å¸ˆè¿›è¡ŒæŠ€æœ¯æŒ‡å¯¼ã€‚</p>
<p>4ã€å‚è€ƒæ–‡æ¡£</p>
<p>å®æˆ˜ç»“æŸæä¾›æ¯ä¸ªåŠŸèƒ½çš„å¼€å‘æ–‡æ¡£ï¼Œå­¦ç”Ÿå‚è€ƒæ–‡æ¡£å¹¶ä¿®æ­£åŠŸèƒ½ç¼ºé™·ã€‚</p>
<h2 id="3-ç¯å¢ƒæ­å»º"><a href="#3-ç¯å¢ƒæ­å»º" class="headerlink" title="3. ç¯å¢ƒæ­å»º"></a>3. ç¯å¢ƒæ­å»º</h2><h3 id="1ã€æ­å»ºæ•°æ®åº“ç¯å¢ƒ"><a href="#1ã€æ­å»ºæ•°æ®åº“ç¯å¢ƒ" class="headerlink" title="1ã€æ­å»ºæ•°æ®åº“ç¯å¢ƒ"></a>1ã€æ­å»ºæ•°æ®åº“ç¯å¢ƒ</h3><ol>
<li><strong>åˆ›å»ºæ•°æ®åº“</strong></li>
</ol>
<p>è¯¾ç¨‹ç®¡ç†ä½¿ç”¨ <code>MySQL</code> æ•°æ®åº“ï¼Œåˆ›å»ºè¯¾ç¨‹ç®¡ç†æ•°æ®åº“ï¼š<code>xc_course</code>ã€‚</p>
<p>å¯¼å…¥ <code>xc_course.sql</code> è„šæœ¬</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image9.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image9.png" srcset="/img/loading.gif" alt="image-20200401215113957"></a></p>
<ol>
<li><strong>æ•°æ®è¡¨ä»‹ç»</strong></li>
</ol>
<p>è¯¾ç¨‹ä¿¡æ¯å†…å®¹ç¹å¤šï¼Œå°†è¯¾ç¨‹ä¿¡æ¯åˆ†ç±»ä¿å­˜åœ¨å¦‚ä¸‹è¡¨ä¸­ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image10.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image10.png" srcset="/img/loading.gif" alt="image-20200401215204860"></a></p>
<p>åˆ†ç±»å‚¨å­˜æ—¢å¯ä»¥æé«˜è§£è€¦åˆåº¦ï¼Œä¹Ÿå¯ä»¥ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</p>
<p>æ•°æ®è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image11.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image11.png" srcset="/img/loading.gif" alt="image-20200401215300618"></a></p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image12.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image12.png" srcset="/img/loading.gif" alt="image-20200401215305777"></a></p>
<p><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image13.png" srcset="/img/loading.gif" alt="image-20200401215310490"></p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image14.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image14.png" srcset="/img/loading.gif" alt="image-20200401215313716"></a></p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image15.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image15.png" srcset="/img/loading.gif" alt="image-20200401215316397"></a></p>
<h3 id="2ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹"><a href="#2ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹" class="headerlink" title="2ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹"></a>2ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†æœåŠ¡å·¥ç¨‹</h3><p>1ï¼‰æŒä¹…å±‚æŠ€æœ¯ä»‹ç»ï¼š</p>
<p>è¯¾ç¨‹ç®¡ç†æœåŠ¡ä½¿ç”¨MySQLæ•°æ®åº“å­˜å‚¨è¯¾ç¨‹ä¿¡æ¯ï¼ŒæŒä¹…å±‚æŠ€æœ¯å¦‚ä¸‹ï¼š</p>
<p>1ã€spring data jpaï¼šç”¨äºè¡¨çš„åŸºæœ¬CRUDã€‚</p>
<p>2ã€mybatisï¼šç”¨äºå¤æ‚çš„æŸ¥è¯¢æ“ä½œã€‚</p>
<p>3ã€druidï¼šä½¿ç”¨é˜¿é‡Œå·´å·´æä¾›çš„spring boot æ•´åˆdruidåŒ…druid-spring-boot-starterç®¡ç†è¿æ¥æ± ã€‚</p>
<blockquote>
<p>druid-spring-boot-starteråœ°å€ï¼š<a href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter" target="_blank" rel="noopener">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p>
</blockquote>
<p><strong>ä¸ºä»€ä¹ˆæŒä¹…å±‚ç”¨åˆ°äº† JPA è¿˜è¦ç”¨ Mybatis ï¼Ÿ</strong></p>
<p>å› ä¸º JPA æ˜¯é¢å‘å¯¹è±¡è¿›è¡Œå¼€å‘çš„ï¼Œå¯¹äºä¸€äº›å¤æ‚çš„sqlæ“ä½œï¼Œä¼˜åŒ–èµ·æ¥ä¼šæ¯”è¾ƒéº»çƒ¦ï¼š</p>
<p>è€Œ Mybatis æ˜¯é¢å‘sqlçš„ï¼Œå¯¹ä¸€äº›å¤æ‚çš„å¤šè¡¨æ“ä½œæ¯”è¾ƒå‹å¥½ã€‚</p>
<p>å¯¼å…¥èµ„æ–™ä¸‹çš„ â€œxc-service-manage-course.zipâ€ã€‚</p>
<h3 id="3ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†å‰ç«¯å·¥ç¨‹"><a href="#3ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†å‰ç«¯å·¥ç¨‹" class="headerlink" title="3ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†å‰ç«¯å·¥ç¨‹"></a>3ã€å¯¼å…¥è¯¾ç¨‹ç®¡ç†å‰ç«¯å·¥ç¨‹</h3><p>è¯¾ç¨‹ç®¡ç†å±äºæ•™å­¦ç®¡ç†å­ç³»ç»Ÿçš„åŠŸèƒ½ï¼Œä½¿ç”¨ç”¨æˆ·ä¸ºæ•™å­¦æœºæ„çš„ç®¡ç†äººå‘˜å’Œè€å¸ˆï¼Œä¸ºä¿è¯ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ï¼Œå•ç‹¬åˆ›å»ºä¸€ä¸ªæ•™å­¦ç®¡ç†å‰ç«¯å·¥ç¨‹ã€‚ æ•™å­¦ç®¡ç†å‰ç«¯å·¥ç¨‹ä¸ç³»ç»Ÿç®¡ç†å‰ç«¯çš„å·¥ç¨‹ç»“æ„ä¸€æ ·ï¼Œä¹Ÿé‡‡ç”¨ <code>vue.js</code> æ¡†æ¶æ¥å®ç°ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image16.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image16.png" srcset="/img/loading.gif" alt="image-20200401215549740"></a></p>
<p>ä»è¯¾ç¨‹èµ„æ–™ç›®å½•æ‹·è´ <code>xc-ui-pc-teach.zip</code> åˆ°å·¥ç¨‹ï¼Œä½¿ç”¨ <code>webstorm</code> æ‰“å¼€ï¼Œå¯åŠ¨å·¥ç¨‹</p>
<p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image17.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image17.png" srcset="/img/loading.gif" alt="image-20200401215618671"></a></p>
<h1 id="ä¸‰ã€è¯¾ç¨‹è®¡åˆ’"><a href="#ä¸‰ã€è¯¾ç¨‹è®¡åˆ’" class="headerlink" title="ä¸‰ã€è¯¾ç¨‹è®¡åˆ’"></a>ä¸‰ã€è¯¾ç¨‹è®¡åˆ’</h1><h2 id="1-éœ€æ±‚åˆ†æ-1"><a href="#1-éœ€æ±‚åˆ†æ-1" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>ä»€ä¹ˆæ˜¯è¯¾ç¨‹è®¡åˆ’ï¼Ÿ</p>
<p>è¯¾ç¨‹è®¡åˆ’å®šä¹‰äº†è¯¾ç¨‹çš„ç« èŠ‚å†…å®¹ï¼Œå­¦ç”Ÿé€šè¿‡è¯¾ç¨‹è®¡åˆ’è¿›è¡Œåœ¨çº¿å­¦ä¹ ï¼Œä¸‹å›¾ä¸­å³ä¾§æ˜¾ç¤ºçš„å°±æ˜¯è¯¾ç¨‹è®¡åˆ’ã€‚</p>
<p>è¯¾ç¨‹è®¡åˆ’åŒ…æ‹¬ä¸¤çº§ï¼Œç¬¬ä¸€çº§æ˜¯è¯¾ç¨‹çš„å¤§ç« èŠ‚ã€ç¬¬äºŒçº§æ˜¯å¤§ç« èŠ‚ä¸‹å±çš„å°ç« èŠ‚ï¼Œæ¯ä¸ªå°ç« èŠ‚é€šå¸¸æ˜¯ä¸€æ®µè§†é¢‘ï¼Œå­¦ç”Ÿç‚¹å‡»å°ç« èŠ‚åœ¨çº¿å­¦ä¹ ã€‚</p>
<p>æ•™å­¦ç®¡ç†äººå‘˜å¯¹è¯¾ç¨‹è®¡åˆ’å¦‚ä½•ç®¡ç†ï¼Ÿ</p>
<p>åŠŸèƒ½åŒ…æ‹¬ï¼šæ·»åŠ è¯¾ç¨‹è®¡åˆ’ã€åˆ é™¤è¯¾ç¨‹è®¡åˆ’ã€ä¿®æ”¹è¯¾ç¨‹è®¡åˆ’ç­‰ã€‚ä¾‹å¦‚ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image18.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image18.png" srcset="/img/loading.gif" alt="image-20200401215716660"></a></p>
<h2 id="2-è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢"><a href="#2-è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢" class="headerlink" title="2. è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢"></a>2. è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢</h2><p>è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢æ˜¯å°†æŸä¸ªè¯¾ç¨‹çš„è¯¾ç¨‹è®¡åˆ’å†…å®¹å®Œæ•´çš„æ˜¾ç¤ºå‡ºæ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image19.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image19.png" srcset="/img/loading.gif" alt="image-20200401215738194"></a></p>
<p>å·¦ä¾§æ˜¾ç¤ºçš„å°±æ˜¯è¯¾ç¨‹è®¡åˆ’ï¼Œè¯¾ç¨‹è®¡åˆ’æ˜¯ä¸€ä¸ªæ ‘å‹ç»“æ„ï¼Œæ–¹ä¾¿æ‰©å±•è¯¾ç¨‹è®¡åˆ’çš„çº§åˆ«ã€‚</p>
<p>åœ¨ä¸Šè¾¹é¡µé¢ä¸­ï¼Œç‚¹å‡»â€œæ·»åŠ è¯¾ç¨‹è®¡åˆ’â€å³å¯å¯¹è¯¾ç¨‹è®¡åˆ’è¿›è¡Œæ·»åŠ æ“ä½œã€‚</p>
<p>ç‚¹å‡»ä¿®æ”¹å¯å¯¹æŸä¸ªç« èŠ‚å†…å®¹è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>ç‚¹å‡»åˆ é™¤å¯åˆ é™¤æŸä¸ªç« èŠ‚ã€‚</p>
<h3 id="é¡µé¢åŸå‹"><a href="#é¡µé¢åŸå‹" class="headerlink" title="é¡µé¢åŸå‹"></a>é¡µé¢åŸå‹</h3><h4 id="treeç»„ä»¶ä»‹ç»"><a href="#treeç»„ä»¶ä»‹ç»" class="headerlink" title="treeç»„ä»¶ä»‹ç»"></a>treeç»„ä»¶ä»‹ç»</h4><p>æœ¬åŠŸèƒ½ä½¿ç”¨ <code>element-ui</code> çš„ <code>tree</code> ç»„ä»¶æ¥å®Œæˆ</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image20.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image20.png" srcset="/img/loading.gif" alt="image-20200401215821019"></a></p>
<p>åœ¨ <code>course_plan.vue</code> æ–‡ä»¶ä¸­æ·»åŠ  <code>tree</code> ç»„ä»¶çš„ä»£ç ï¼Œè¿›è¡Œæµ‹è¯•ï¼š</p>
<p>1ã€ç»„ä»¶æ ‡ç­¾</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€tree</span></span>
<span class="hljs-tag">      <span class="hljs-attr">:data</span>=<span class="hljs-string">"data"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">show</span>â€<span class="hljs-attr">checkbox</span></span>
<span class="hljs-tag">      <span class="hljs-attr">node</span>â€<span class="hljs-attr">key</span>=<span class="hljs-string">"id"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">default</span>â€<span class="hljs-attr">expand</span>â€<span class="hljs-attr">all</span></span>
<span class="hljs-tag">      <span class="hljs-attr">:expand</span>â€<span class="hljs-attr">on</span>â€<span class="hljs-attr">click</span>â€<span class="hljs-attr">node</span>=<span class="hljs-string">"false"</span></span>
<span class="hljs-tag">      <span class="hljs-attr">:render</span>â€<span class="hljs-attr">content</span>=<span class="hljs-string">"renderContent"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€tree</span>&gt;</span></code></pre></div>

<p>2ã€æ•°æ®å¯¹è±¡</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">let</span> id = <span class="hljs-number">1000</span>;
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;
    data() &#123;
      <span class="hljs-keyword">return</span> &#123;
        data : [&#123;
          id: <span class="hljs-number">1</span>,
          label: <span class="hljs-string">'ä¸€çº§ 1'</span>,
          children: [&#123;
            id: <span class="hljs-number">4</span>,
            label: <span class="hljs-string">'äºŒçº§ 1â€1'</span>,
            children: [&#123;
              id: <span class="hljs-number">9</span>,
              label: <span class="hljs-string">'ä¸‰çº§ 1â€1â€1'</span>
            &#125;, &#123;
              id: <span class="hljs-number">10</span>,
              label: <span class="hljs-string">'ä¸‰çº§ 1â€1â€2'</span>
            &#125;]
          &#125;]
        &#125;]
      &#125;
     &#125;
 &#125;</code></pre></div>

<h4 id="webstorm-é…ç½®JSX"><a href="#webstorm-é…ç½®JSX" class="headerlink" title="webstorm é…ç½®JSX"></a>webstorm é…ç½®JSX</h4><p>æœ¬ç»„ä»¶ç”¨åˆ°äº†JSXè¯­æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image21.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image21.png" srcset="/img/loading.gif" alt="image-20200401215955630"></a></p>
<p><code>JSX</code> æ˜¯ <code>Javascript</code> å’Œ <code>XML</code> ç»“åˆçš„ä¸€ç§æ ¼å¼ï¼Œå®ƒæ˜¯ <code>React</code> çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œ<code>JSX</code>å’Œ<code>XML</code> è¯­æ³•ç±»ä¼¼ï¼Œå¯ä»¥å®šä¹‰å±æ€§ä»¥åŠå­å…ƒç´ ã€‚å”¯ä¸€ç‰¹æ®Šçš„æ˜¯å¯ä»¥ç”¨å¤§æ‹¬å·æ¥åŠ å…¥<code>JavaScript</code> è¡¨è¾¾å¼ã€‚é‡åˆ° <code>HTML</code> æ ‡ç­¾ï¼ˆä»¥ &lt; å¼€å¤´ï¼‰ï¼Œå°±ç”¨ <code>HTML</code> è§„åˆ™è§£æï¼›<br>é‡åˆ°ä»£ç å—ï¼ˆä»¥ { å¼€å¤´ï¼‰ï¼Œå°±ç”¨ <code>JavaScript</code> è§„åˆ™è§£æã€‚</p>
<p>ä¸‹é¢æ˜¯å®˜æ–¹çš„ä¸€ä¸ªä¾‹å­ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image22.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/C:%5CUsers%5CMI%5CDesktop%5CHexo%5Csource_posts%5C%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06%5Cimage22.png" srcset="/img/loading.gif" alt="image-20200401220038034"></a></p>
<p>è®¾ç½®æ–¹æ³• å¦‚ä¸‹ï¼š</p>
<p>1 ã€Javascript version é€‰æ‹© React JSX ï¼ˆå¦‚æœæ²¡æœ‰å°±é€‰æ‹©JSX Harmonyï¼‰</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image23.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image23.png" srcset="/img/loading.gif" alt="image-20200401220056325"></a></p>
<p>2ã€HTML ç±»å‹æ–‡ä»¶ä¸­å¢åŠ vue</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image24.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image24.png" srcset="/img/loading.gif" alt="image-20200401220104955"></a></p>
<p>preferences -&gt; Editor -&gt; File Types ä¸­æ‰¾åˆ°ä¸Šè¾¹æ¡†ä¸­HTML åœ¨ä¸‹è¾¹åŠ ä¸€ä¸ª *.vue</p>
<p>å¦‚æœå·²ç»åœ¨ vue template ä¸­å·²å­˜åœ¨.vue åˆ™æŠŠå®ƒæ”¹ä¸º.vue2(å› ä¸ºè¦åœ¨Htmlä¸­æ·»åŠ .vue)</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image25.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image25.png" srcset="/img/loading.gif" alt="image-20200401220120452"></a></p>
<h3 id="APIæ¥å£"><a href="#APIæ¥å£" class="headerlink" title="APIæ¥å£"></a>APIæ¥å£</h3><h4 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h4><p>1ã€è¡¨ç»“æ„</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image26.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image26.png" srcset="/img/loading.gif" alt="image-20200401220143626"></a></p>
<p>2ã€æ¨¡å‹ç±»</p>
<p>è¯¾ç¨‹è®¡åˆ’ä¸ºæ ‘å‹ç»“æ„ï¼Œç”±æ ‘æ ¹ï¼ˆè¯¾ç¨‹ï¼‰å’Œæ ‘æï¼ˆç« èŠ‚ï¼‰ç»„æˆï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡æ—¶å°†è¯¾ç¨‹è®¡åˆ’è®¾ç½®ä¸ºæ ‘å‹ç»“æ„ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"teachplan"</span>)
<span class="hljs-meta">@GenericGenerator</span>(name = <span class="hljs-string">"jpaâ€uuid"</span>, strategy = <span class="hljs-string">"uuid"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Teachplan</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = â€<span class="hljs-number">916357110051689485L</span>;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>(generator = <span class="hljs-string">"jpaâ€uuid"</span>)
    <span class="hljs-meta">@Column</span>(length = <span class="hljs-number">32</span>)
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String pname;
    <span class="hljs-keyword">private</span> String parentid;
    <span class="hljs-keyword">private</span> String grade;
    <span class="hljs-keyword">private</span> String ptype;
    <span class="hljs-keyword">private</span> String description;
    <span class="hljs-keyword">private</span> String courseid;
    <span class="hljs-keyword">private</span> String status;
    <span class="hljs-keyword">private</span> Integer orderby;
    <span class="hljs-keyword">private</span> Double timelength;
    <span class="hljs-keyword">private</span> String trylearn;
&#125;</code></pre></div>

<h4 id="è‡ªå®šä¹‰æ¨¡å‹ç±»"><a href="#è‡ªå®šä¹‰æ¨¡å‹ç±»" class="headerlink" title="è‡ªå®šä¹‰æ¨¡å‹ç±»"></a>è‡ªå®šä¹‰æ¨¡å‹ç±»</h4><p>å‰ç«¯é¡µé¢éœ€è¦æ ‘å‹ç»“æ„çš„æ•°æ®æ¥å±•ç¤ºTreeç»„ä»¶ï¼Œå¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs js">[&#123;
      id: <span class="hljs-number">1</span>,
      label: <span class="hljs-string">'ä¸€çº§ 1'</span>,
      children: [&#123;
        id: <span class="hljs-number">4</span>,
        label: <span class="hljs-string">'äºŒçº§ 1â€1'</span>
       &#125;]
     &#125;]</code></pre></div>

<p>è‡ªå®šä¹‰è¯¾ç¨‹è®¡åˆ’ç»“ç‚¹ç±»å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TeachplanNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Teachplan</span> </span>&#123;
    List&lt;TeachplanNode&gt; children;
&#125;</code></pre></div>

<h4 id="æ¥å£å®šä¹‰"><a href="#æ¥å£å®šä¹‰" class="headerlink" title="æ¥å£å®šä¹‰"></a>æ¥å£å®šä¹‰</h4><p>æ ¹æ®è¯¾ç¨‹idæŸ¥è¯¢è¯¾ç¨‹çš„è®¡åˆ’æ¥å£å¦‚ä¸‹ï¼Œåœ¨apiå·¥ç¨‹åˆ›å»º <code>course</code> åŒ…ï¼Œåˆ›å»º<code>CourseControllerApi</code> æ¥å£ç±»å¹¶å®šä¹‰æ¥å£æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CourseControllerApi</span> </span>&#123;
    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">findTeachplanList</span><span class="hljs-params">(String courseId)</span></span>;
&#125;</code></pre></div>

<h3 id="è¯¾ç¨‹ç®¡ç†æœåŠ¡"><a href="#è¯¾ç¨‹ç®¡ç†æœåŠ¡" class="headerlink" title="è¯¾ç¨‹ç®¡ç†æœåŠ¡"></a>è¯¾ç¨‹ç®¡ç†æœåŠ¡</h3><h4 id="SQLè¯­å¥"><a href="#SQLè¯­å¥" class="headerlink" title="SQLè¯­å¥"></a>SQLè¯­å¥</h4><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span>
  a.id one_id,
  a.pname one_pname,
  b.id two_id,
  b.pname two_pname,
  c.id three_id,
  c.pname three_pname
<span class="hljs-keyword">FROM</span>
  teachplan a
  <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> teachplan b
    <span class="hljs-keyword">ON</span> a.id = b.parentid
  <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> teachplan c
    <span class="hljs-keyword">ON</span> b.id = c.parentid
<span class="hljs-keyword">WHERE</span> a.parentid = <span class="hljs-string">'0'</span>
  <span class="hljs-keyword">AND</span> a.courseid = <span class="hljs-string">'402885816243d2dd016243f24c030002'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> a.orderby,
  b.orderby,
  c.orderby</code></pre></div>

<h4 id="DAO"><a href="#DAO" class="headerlink" title="DAO"></a>DAO</h4><ol>
<li>mapperæ¥å£</li>
</ol>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Mapper</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TeachplanMapper</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">selectList</span><span class="hljs-params">(String courseId)</span></span>;
&#125;</code></pre></div>

<p>2ï¼‰mapperæ˜ å°„æ–‡ä»¶</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span> &gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.xuecheng.manage_course.dao.TeachplanMapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"teachplanMap"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.ext.TeachplanNode"</span>&gt;</span>
        <span class="hljs-comment">&lt;!--ä¸€çº§èŠ‚ç‚¹--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_id"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"pname"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"one_pname"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"children"</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.ext.TeachplanNode"</span>&gt;</span>
            <span class="hljs-comment">&lt;!--äºŒçº§èŠ‚ç‚¹--&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_id"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"pname"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"two_pname"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"children"</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">"com.xuecheng.framework.domain.course.ext.TeachplanNode"</span>&gt;</span>
                <span class="hljs-comment">&lt;!--ä¸‰çº§èŠ‚ç‚¹--&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_id"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"pname"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"three_pname"</span>/&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span>

    <span class="hljs-comment">&lt;!--ä¸‰çº§èœå•æŸ¥è¯¢--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectList"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"teachplanMap"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"java.lang.String"</span>&gt;</span>
        SELECT
            a.id one_id,
            a.pname one_pname,
            a.courseid one_course,
            b.id two_id,
            b.pname two_pname,
            c.id three_id,
            c.pname three_pname
        FROM
            teachplan a
        LEFT JOIN teachplan b
            ON b.parentid = a.id
        LEFT JOIN teachplan c
            ON c.parentid = b.id
        WHERE
            a.parentid = '0'
        <span class="hljs-comment">&lt;!--åˆ¤æ–­å‚æ•°ä¸ä¸ºç©ºæ—¶æ‰è¿›è¡Œå‚æ•°çš„åŒ¹é…--&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">"_parameter!=null and _parameter!=''"</span>&gt;</span>
            and a.courseid = #&#123;courseId&#125;
        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span>
        ORDER BY a.orderby,
            b.orderby,
            c.orderby
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span></code></pre></div>

<p>è¯´æ˜ï¼šé’ˆå¯¹è¾“å…¥å‚æ•°ä¸ºç®€å•ç±»å‹ #{}ä¸­å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œåˆ¤æ–­å‚æ•°æ˜¯å¦ä¸ºç©ºè¦ç”¨ _parameterï¼ˆå®ƒå±äº<code>mybatis</code>çš„å†…ç½®å‚æ•°ï¼‰</p>
<h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseService</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    TeachplanMapper teachplanMapper;
    <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">findTeachplanList</span><span class="hljs-params">(String courseId)</span></span>&#123;
        TeachplanNode teachplanNode = teachplanMapper.selectList(courseId);
        <span class="hljs-keyword">return</span> teachplanNode;
    &#125;
&#125;</code></pre></div>

<h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/course"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CourseControllerApi</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    CourseService courseService;
    <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/teachplan/list/&#123;courseId&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">findTeachplanList</span><span class="hljs-params">(String courseId)</span> </span>&#123;
        <span class="hljs-keyword">return</span> courseService.findTeachplanList(courseId);
    &#125;
&#125;</code></pre></div>

<h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>ä½¿ç”¨postmanæˆ–swagger-uiæµ‹è¯•æŸ¥è¯¢æ¥å£ã€‚</p>
<p>Get è¯·æ±‚ï¼š<a href="http://localhost:31200/course/teachplan/list/402885816243d2dd016243f24c030002" target="_blank" rel="noopener">http://localhost:31200/course/teachplan/list/402885816243d2dd016243f24c030002</a></p>
<h3 id="å‰ç«¯é¡µé¢"><a href="#å‰ç«¯é¡µé¢" class="headerlink" title="å‰ç«¯é¡µé¢"></a>å‰ç«¯é¡µé¢</h3><h4 id="APIæ–¹æ³•-1"><a href="#APIæ–¹æ³•-1" class="headerlink" title="APIæ–¹æ³•"></a>APIæ–¹æ³•</h4><p>å®šä¹‰è¯¾ç¨‹è®¡åˆ’æŸ¥è¯¢çš„apiæ–¹æ³•ï¼š</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/*æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’*/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> findTeachplanList = <span class="hljs-function"><span class="hljs-params">courseid</span> =&gt;</span> &#123;
  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl+<span class="hljs-string">'/course/teachplan/list/'</span>+courseid)
&#125;</code></pre></div>

<h4 id="Apiè°ƒç”¨"><a href="#Apiè°ƒç”¨" class="headerlink" title="Apiè°ƒç”¨"></a>Apiè°ƒç”¨</h4><ol>
<li>åœ¨ <code>mounted</code> é’©å­æ–¹æ³• ä¸­æŸ¥è¯¢ è¯¾ç¨‹è®¡åˆ’<br>å®šä¹‰æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’çš„æ–¹æ³•ï¼Œèµ‹å€¼ç»™æ•°æ®å¯¹è±¡ <code>teachplanList</code></li>
</ol>
<div class="hljs"><pre><code class="hljs js">findTeachplan()&#123;
    courseApi.findTeachplanList(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span>&#123;
    <span class="hljs-keyword">this</span>.teachplanList = [];<span class="hljs-comment">//æ¸…ç©ºæ ‘</span>
    <span class="hljs-keyword">if</span>(res.children)&#123;
    <span class="hljs-keyword">this</span>.teachplanList = res.children;
    &#125;
&#125;);
&#125;</code></pre></div>

<p>2ï¼‰åœ¨mountedé’©å­ä¸­æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’</p>
<div class="hljs"><pre><code class="hljs js">mounted()&#123; 
  <span class="hljs-comment">//è¯¾ç¨‹id</span>
  <span class="hljs-keyword">this</span>.courseid = <span class="hljs-keyword">this</span>.$route.params.courseid;
  <span class="hljs-comment">//è¯¾ç¨‹è®¡åˆ’</span>
  <span class="hljs-keyword">this</span>.findTeachplan();
&#125;</code></pre></div>

<p>3ï¼‰ä¿®æ”¹æ ‘ç»“ç‚¹çš„æ ‡ç­¾å±æ€§</p>
<p>è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯ä¸­ <code>pname</code> ä¸ºç»“ç‚¹çš„åç§°ï¼Œéœ€è¦ä¿®æ”¹æ ‘ç»“ç‚¹çš„æ ‡ç­¾å±æ€§æ–¹å¯æ­£å¸¸æ˜¾ç¤ºè¯¾ç¨‹è®¡åˆ’åç§°ï¼Œå¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs js">defaultProps: &#123; 
  children: <span class="hljs-string">'children'</span>,
  label: <span class="hljs-string">'pname'</span>
&#125;</code></pre></div>

<h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p><a href="https://qnoss.codeyee.com/20200706_Ng==/image27.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image27.png" srcset="/img/loading.gif" alt="image-20200401221133565"></a></p>
<h2 id="3-æ·»åŠ è¯¾ç¨‹è®¡åˆ’"><a href="#3-æ·»åŠ è¯¾ç¨‹è®¡åˆ’" class="headerlink" title="3. æ·»åŠ è¯¾ç¨‹è®¡åˆ’"></a>3. æ·»åŠ è¯¾ç¨‹è®¡åˆ’</h2><h3 id="éœ€æ±‚åˆ†æ-2"><a href="#éœ€æ±‚åˆ†æ-2" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><p>ç”¨æˆ·æ“ä½œæµç¨‹</p>
<p>1 ã€è¿›å…¥è¯¾ç¨‹è®¡åˆ’é¡µé¢ï¼Œç‚¹å‡»â€œæ·»åŠ è¯¾ç¨‹è®¡åˆ’â€</p>
<p>2ã€æ‰“å¼€æ·»åŠ è¯¾ç¨‹è®¡åˆ’é¡µé¢ï¼Œè¾“å…¥è¯¾ç¨‹è®¡åˆ’ä¿¡æ¯</p>
<p><a href="https://qnoss.codeyee.com/20200706_Ng==/image28.png" target="_blank" rel="noopener"><img src="/2020/08/12/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday06/image28.png" srcset="/img/loading.gif" alt="image-20200401221202889"></a></p>
<p><strong>ä¸Šçº§ç»“ç‚¹è¯´æ˜</strong>ï¼š</p>
<p>å¦‚æœä¸é€‰æ‹©ä¸Šçº§èŠ‚ç‚¹çš„è¯ï¼Œè¡¨ç¤ºå½“å‰æ·»åŠ çš„è¯¾ç¨‹è®¡åˆ’çš„çˆ¶èŠ‚ç‚¹ä½œä¸ºè¯¥è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ·»åŠ çš„æ˜¯äºŒçº§èœå•ï¼Œå¦‚æœé€‰æ‹©äº†ä¸Šçº§èŠ‚ç‚¹ï¼Œè¡¨ç¤ºæ·»åŠ çš„æ˜¯ä¸‰çº§èœå•ï¼Œå¦‚æœæ·»åŠ è¯¥è¯¾ç¨‹æ—¶ï¼Œåœ¨è¯¾ç¨‹è®¡åˆ’ä¸­æ²¡æœ‰è¯¥è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹æ—¶ï¼Œè¦è‡ªåŠ¨å°†è¯¥è¯¾ç¨‹è®¾ç½®ä¸ºæ ¹èŠ‚ç‚¹ã€‚</p>
<h4 id="é¡µé¢åŸå‹è¯´æ˜"><a href="#é¡µé¢åŸå‹è¯´æ˜" class="headerlink" title="é¡µé¢åŸå‹è¯´æ˜"></a>é¡µé¢åŸå‹è¯´æ˜</h4><p>æ·»åŠ è¯¾ç¨‹è®¡åˆ’é‡‡ç”¨å¼¹å‡ºçª—å£ç»„ä»¶Dialogã€‚</p>
<p>1ã€è§†å›¾éƒ¨åˆ†</p>
<p>åœ¨course_plan.vueé¡µé¢æ·»åŠ æ·»åŠ è¯¾ç¨‹è®¡åˆ’çš„å¼¹å‡ºçª—å£ä»£ç ï¼š</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">elâ€dialog</span> <span class="hljs-attr">title</span>=<span class="hljs-string">" æ·»åŠ è¯¾ç¨‹è®¡åˆ’"</span> <span class="hljs-attr">:visible.sync</span>=<span class="hljs-string">"teachplayFormVisible"</span> &gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">elâ€form</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"teachplayForm"</span>  <span class="hljs-attr">:model</span>=<span class="hljs-string">"teachplanActive"</span> <span class="hljs-attr">label</span>â€<span class="hljs-attr">width</span>=<span class="hljs-string">"140px"</span></span>
<span class="hljs-tag"><span class="hljs-attr">style</span>=<span class="hljs-string">"width:600px;"</span> <span class="hljs-attr">:rules</span>=<span class="hljs-string">"teachplanRules"</span> &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"ä¸Šçº§ç»“ç‚¹"</span> &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€select</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.parentid"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"ä¸å¡«è¡¨ç¤ºæ ¹ç»“ç‚¹"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">elâ€option</span></span>
<span class="hljs-tag">              <span class="hljs-attr">v</span>â€<span class="hljs-attr">for</span>=<span class="hljs-string">"item in teachplanList"</span></span>
<span class="hljs-tag">              <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span></span>
<span class="hljs-tag">              <span class="hljs-attr">:label</span>=<span class="hljs-string">"item.pname"</span></span>
<span class="hljs-tag">              <span class="hljs-attr">:value</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€option</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€select</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"ç« èŠ‚/è¯¾æ—¶åç§°"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"pname"</span>&gt;</span>
                  <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.pname"</span> <span class="hljs-attr">auto</span>â€<span class="hljs-attr">complete</span>=<span class="hljs-string">"off"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span> 
        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"è¯¾ç¨‹ç±»å‹"</span> &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radioâ€group</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.ptype"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">'1'</span>&gt;</span>è§†é¢‘<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radio</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">'2'</span>&gt;</span>æ–‡æ¡£<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radio</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radioâ€group</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"å­¦ä¹ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰  è¯·è¾“å…¥æ•°å­—"</span> &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"number"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.timelength"</span> <span class="hljs-attr">auto</span>â€<span class="hljs-attr">complete</span>=<span class="hljs-string">"off"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€</span></span>
<span class="hljs-tag"><span class="hljs-attr">input</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"æ’åºå­—æ®µ"</span> &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.orderby"</span> <span class="hljs-attr">auto</span>â€<span class="hljs-attr">complete</span>=<span class="hljs-string">"off"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"ç« èŠ‚/è¯¾æ—¶ä»‹ç»"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"description"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"textarea"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.description"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">elâ€input</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"çŠ¶æ€"</span> <span class="hljs-attr">prop</span>=<span class="hljs-string">"status"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radioâ€group</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">model</span>=<span class="hljs-string">"teachplanActive.status"</span> &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"0"</span> &gt;</span>æœªå‘å¸ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radio</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">elâ€radio</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"radio"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">'1'</span>&gt;</span>å·²å‘å¸ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radio</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€radioâ€group</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">elâ€formâ€item</span>  &gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">on:click</span>=<span class="hljs-string">"addTeachplan"</span>&gt;</span>æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">elâ€button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">v</span>â€<span class="hljs-attr">on:click</span>=<span class="hljs-string">"resetForm"</span>&gt;</span>é‡ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">elâ€button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€formâ€item</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">elâ€dialog</span>&gt;</span></code></pre></div>

<p>2ã€æ•°æ®æ¨¡å‹</p>
<p>åœ¨æ•°æ®æ¨¡å‹ä¸­æ·»åŠ å¦‚ä¸‹å˜é‡ï¼š</p>
<div class="hljs"><pre><code class="hljs js">teachplayFormVisible:<span class="hljs-literal">false</span>,
teachplanRules: &#123;
        pname: [
            &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥è¯¾ç¨‹è®¡åˆ’åç§°'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
        ],
            status: [
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·é€‰æ‹©çŠ¶æ€'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ]
&#125;,
teachplanActive:&#123;&#125;,</code></pre></div>

<p>3ã€ æ·»åŠ æŒ‰é’®</p>
<p>é€šè¿‡å˜é‡ <code>teachplayFormVisible</code> æ§åˆ¶å¼¹å‡ºçª—å£æ˜¯å¦æ˜¾ç¤ºã€‚</p>
<div class="hljs"><pre><code class="hljs vue">&lt;elâ€button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;teachplayFormVisible &#x3D; true&quot;&gt; æ·»åŠ è¯¾ç¨‹è®¡åˆ’&lt;&#x2F;elâ€button&gt;</code></pre></div>

<p>4ã€å®šä¹‰è¡¨å•æäº¤æ–¹æ³•å’Œé‡ç½®æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">// æäº¤è¯¾ç¨‹è®¡åˆ’</span>
addTeachplan()&#123;
    alert()
&#125;,
<span class="hljs-comment">//é‡ç½®è¡¨å•</span>
resetForm()&#123;
  <span class="hljs-keyword">this</span>.teachplanActive = &#123;&#125;
&#125;,</code></pre></div>

<h3 id="APIæ¥å£-1"><a href="#APIæ¥å£-1" class="headerlink" title="APIæ¥å£"></a>APIæ¥å£</h3><p>1ï¼‰æ·»åŠ è¯¾ç¨‹è®¡åˆ’</p>
<div class="hljs"><pre><code class="hljs java">ApiOperation(<span class="hljs-string">"æ·»åŠ è¯¾ç¨‹è®¡åˆ’"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">addTeachplan</span><span class="hljs-params">(Teachplan teachplan)</span></span>;</code></pre></div>

<h3 id="è¯¾ç¨‹ç®¡ç†æœåŠ¡-1"><a href="#è¯¾ç¨‹ç®¡ç†æœåŠ¡-1" class="headerlink" title="è¯¾ç¨‹ç®¡ç†æœåŠ¡"></a>è¯¾ç¨‹ç®¡ç†æœåŠ¡</h3><h4 id="DAOå±‚"><a href="#DAOå±‚" class="headerlink" title="DAOå±‚"></a>DAOå±‚</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">TeachplanRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">Teachplan</span>, <span class="hljs-title">String</span>&gt; </span>&#123; 
   <span class="hljs-comment">//å®šä¹‰æ–¹æ³•æ ¹æ®è¯¾ç¨‹idå’Œçˆ¶ç»“ç‚¹idæŸ¥è¯¢å‡ºç»“ç‚¹åˆ—è¡¨ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹æ³•å®ç°æŸ¥è¯¢æ ¹ç»“ç‚¹</span>
   <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Teachplan&gt; <span class="hljs-title">findByCourseidAndParentid</span><span class="hljs-params">(String courseId,String parentId)</span></span>;
&#125;</code></pre></div>

<h4 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_course.service;

<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CourseBase;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.Teachplan;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.ext.TeachplanNode;
<span class="hljs-keyword">import</span> com.xuecheng.framework.exception.ExceptionCast;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.manage_course.dao.CourseBaseRepository;
<span class="hljs-keyword">import</span> com.xuecheng.manage_course.dao.TeachplanMapper;
<span class="hljs-keyword">import</span> com.xuecheng.manage_course.dao.TeachplanRepository;
<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;
<span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Optional;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseService</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    TeachplanMapper teachplanMapper;
    <span class="hljs-meta">@Autowired</span>
    CourseBaseRepository courseBaseRepository;
    <span class="hljs-meta">@Autowired</span>
    TeachplanRepository teachplanRepository;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æ·»åŠ è¯¾ç¨‹è®¡åˆ’</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> teachplan</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Transactional</span>  <span class="hljs-comment">//å¢åˆ æ”¹æ“ä½œéƒ½éœ€è¦åŠ springäº‹åŠ¡</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">addTeachplan</span><span class="hljs-params">(Teachplan teachplan)</span> </span>&#123;
        <span class="hljs-comment">//æ ¡éªŒè¯¾ç¨‹idå’Œè¯¾ç¨‹è®¡åˆ’åç§°</span>
        <span class="hljs-keyword">if</span>(teachplan == <span class="hljs-keyword">null</span>|| StringUtils.isEmpty(teachplan.getCourseid()) || StringUtils.isEmpty(teachplan.getPname()))&#123;
            ExceptionCast.cast(CommonCode.INVALID_PARAM);
        &#125;

        <span class="hljs-comment">//å–å‡ºè¯¾ç¨‹id</span>
        String courseId = teachplan.getCourseid();
        <span class="hljs-comment">//å–å‡ºçˆ¶èŠ‚ç‚¹id</span>
        String parentId = teachplan.getParentid();
        String newTeachplanGrade = <span class="hljs-string">"3"</span>;  <span class="hljs-comment">//è®¾ç½®æ–°èŠ‚ç‚¹çš„èœå•ç­‰çº§</span>

        <span class="hljs-comment">// å¦‚æœç”¨æˆ·æœªåœ¨æ·»åŠ æ—¶å€™æœªé€‰æ‹©æ ¹èŠ‚ç‚¹,è¡¨ç¤ºéœ€è¦æ·»åŠ çš„æ˜¯ä¸€ä¸ªäºŒçº§èœå•ï¼Œå¹¶ä¸”é»˜è®¤æ·»åŠ åˆ°å½“å‰è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹ä¸‹</span>
        <span class="hljs-keyword">if</span>(StringUtils.isEmpty(parentId))&#123;
            newTeachplanGrade = <span class="hljs-string">"2"</span>;
            <span class="hljs-comment">//æ ¹æ®è¯¾ç¨‹idå–æ ¹èŠ‚ç‚¹çš„id</span>
            parentId = <span class="hljs-keyword">this</span>.getTeachplanRoot(courseId);
            <span class="hljs-keyword">if</span>(StringUtils.isEmpty(parentId))&#123;
                ExceptionCast.cast(CommonCode.INVALID_PARAM);
            &#125;
        &#125;

        <span class="hljs-comment">//åˆ›å»ºæ–°èŠ‚ç‚¹</span>
        Teachplan teachplanNew = <span class="hljs-keyword">new</span> Teachplan();
        <span class="hljs-comment">//å°†ä¼ å…¥çš„èŠ‚ç‚¹ä¿¡æ¯èµ‹å€¼åˆ°æ–°èŠ‚ç‚¹å†…</span>
        BeanUtils.copyProperties(teachplan,teachplanNew);
        teachplanNew.setParentid(parentId);
        teachplanNew.setCourseid(courseId);

        <span class="hljs-comment">/* è®¾ç½®æ–°èŠ‚ç‚¹çš„çº§åˆ«</span>
<span class="hljs-comment">            æ–¹æ³•1ï¼šæ ¹æ®çˆ¶èŠ‚ç‚¹çš„çº§åˆ«è¿›è¡Œè®¾ç½®ï¼Œçˆ¶èŠ‚ç‚¹çº§åˆ«ä¸º1ï¼Œå½“å‰åˆ™ä¸º2ï¼Œä¸º2åˆ™å½“å‰ä¸º3</span>
<span class="hljs-comment">            æ–¹æ³•2ï¼šåœ¨åˆ¤æ–­å‰ç«¯ä¼ å…¥çš„çˆ¶èŠ‚ç‚¹æ˜¯å¦ä¸ºç©ºæ—¶è¿›è¡Œè®¾ç½®ï¼Œå¦‚æœä¸ºç©ºï¼Œè¡¨ç¤ºéœ€æ±‚ä¸ºæ·»åŠ äºŒçº§èŠ‚ç‚¹ï¼Œè®¾ç½®2</span>
<span class="hljs-comment">                  å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºè¦æ·»åŠ çš„æ˜¯ä¸‰çº§èŠ‚ç‚¹ï¼Œè®¾ç½®ä¸º3ï¼Œä¸æ–¹æ³•1ç›¸æ¯”å¯ä»¥å‡å°‘ä¸€æ¬¡æŸ¥è¯¢ã€‚</span>
<span class="hljs-comment">         */</span>
        teachplanNew.setGrade(newTeachplanGrade); <span class="hljs-comment">//èŠ‚ç‚¹çº§åˆ«ï¼Œæ ¹æ®çˆ¶èŠ‚ç‚¹çš„çº§åˆ«è¿›è¡Œè®¾ç½®</span>
        teachplanRepository.save(teachplanNew);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);
    &#125;

    <span class="hljs-comment">//æ ¹æ®è¯¾ç¨‹idè·å–è¯¾ç¨‹æ ¹èŠ‚ç‚¹idï¼Œå¦‚æœæ ¹èŠ‚ç‚¹ä¸å­˜åœ¨ åˆ™åˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå¹¶ä½œä¸ºè¯¥è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> String <span class="hljs-title">getTeachplanRoot</span><span class="hljs-params">(String courseId)</span></span>&#123;
        <span class="hljs-comment">//æ ¡éªŒè¯¾ç¨‹id</span>
        Optional&lt;CourseBase&gt; optional = courseBaseRepository.findById(courseId);
        <span class="hljs-keyword">if</span>(!optional.isPresent())&#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        &#125;
        CourseBase courseBase = optional.get();
        <span class="hljs-comment">//å–å‡ºä¸€çº§æ ¹èŠ‚ç‚¹èœå•</span>
        List&lt;Teachplan&gt; teachplanList = teachplanRepository.findByCourseidAndParentid(courseId, <span class="hljs-string">"0"</span>);

        <span class="hljs-comment">//å¦‚æœæ ¹èŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”ä½œä¸ºè¯¥è¯¾ç¨‹çš„æ ¹èŠ‚ç‚¹</span>
        <span class="hljs-keyword">if</span>(teachplanList == <span class="hljs-keyword">null</span> || teachplanList.size() == <span class="hljs-number">0</span>)&#123;
            <span class="hljs-comment">//æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹</span>
            Teachplan teachplanNewRoot = <span class="hljs-keyword">new</span> Teachplan();
            teachplanNewRoot.setCourseid(courseId);
            teachplanNewRoot.setPname(courseBase.getName());
            teachplanNewRoot.setCourseid(courseId);
            teachplanNewRoot.setGrade(<span class="hljs-string">"1"</span>); <span class="hljs-comment">//1çº§èœå•</span>
            teachplanNewRoot.setStatus(<span class="hljs-string">"0"</span>); <span class="hljs-comment">//æœªå‘å¸ƒ</span>
            teachplanRepository.save(teachplanNewRoot);
            <span class="hljs-keyword">return</span> teachplanNewRoot.getId();
        &#125;
        Teachplan teachplan = teachplanList.get(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">return</span> teachplan.getId();
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æŸ¥è¯¢è¯¾ç¨‹è®¡åˆ’</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseId</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">findTeachplanList</span><span class="hljs-params">(String courseId)</span></span>&#123;
        TeachplanNode teachplanNode = teachplanMapper.selectList(courseId);
        <span class="hljs-keyword">return</span> teachplanNode;
    &#125;
&#125;</code></pre></div>

<h4 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_course.controller;

<span class="hljs-keyword">import</span> com.xuecheng.api.course.CourseControllerApi;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.Teachplan;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.ext.TeachplanNode;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.manage_course.service.CourseService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/course"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CourseController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CourseControllerApi</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    CourseService courseService;

    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/teachplan/list/&#123;courseId&#125;"</span>)
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> TeachplanNode <span class="hljs-title">findTeachplanList</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"courseId"</span>)</span> String courseId) </span>&#123;
        <span class="hljs-keyword">return</span> courseService.findTeachplanList(courseId);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/teachplan/add"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">addTeachplan</span><span class="hljs-params">(@RequestBody Teachplan teachplan)</span> </span>&#123;
        <span class="hljs-keyword">return</span> courseService.addTeachplan(teachplan);
    &#125;
&#125;</code></pre></div>

<h4 id="æµ‹è¯•-2"><a href="#æµ‹è¯•-2" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>å¤æ‚ä¸€äº›çš„ä¸šåŠ¡é€»è¾‘å»ºè®®å†™å®ŒæœåŠ¡ç«¯ä»£ç å°±è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p>
<p>ä½¿ç”¨<code>swagger-ui</code> æˆ–<code>postman</code>æµ‹è¯•ä¸Šè¾¹çš„è¯¾ç¨‹è®¡åˆ’æ·»åŠ æ¥å£ã€‚</p>
<h3 id="å‰ç«¯Apiè°ƒç”¨"><a href="#å‰ç«¯Apiè°ƒç”¨" class="headerlink" title="å‰ç«¯Apiè°ƒç”¨"></a>å‰ç«¯Apiè°ƒç”¨</h3><p>1ã€å®šä¹‰ apiæ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/* æ·»åŠ è¯¾ç¨‹è®¡åˆ’*/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> addTeachplan = <span class="hljs-function"><span class="hljs-params">teachplah</span> =&gt;</span> &#123;
  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/course/teachplan/add'</span>,teachplah)
&#125;</code></pre></div>

<p>2ã€è°ƒç”¨ api</p>
<div class="hljs"><pre><code class="hljs js">addTeachplan()&#123;
  <span class="hljs-keyword">this</span>.$refs.teachplayForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (valid) &#123;
      <span class="hljs-comment">//æ·»åŠ è¯¾ç¨‹è®¡åˆ’æ—¶å¸¦ä¸Šè¯¾ç¨‹id</span>
      <span class="hljs-keyword">this</span>.teachplanActive.courseid = <span class="hljs-keyword">this</span>.courseid;
      courseApi.addTeachplan(<span class="hljs-keyword">this</span>.teachplanActive).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span>(res.success)&#123;
          <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">'æäº¤æˆåŠŸ'</span>);
          <span class="hljs-comment">//æ¸…ç©ºè¡¨å•</span>
          <span class="hljs-keyword">this</span>.teachplanActive = &#123;&#125;
          <span class="hljs-comment">//åˆ·æ–°æ•´ä¸ªæ ‘</span>
          <span class="hljs-keyword">this</span>.findTeachplan();
          &#125;<span class="hljs-keyword">else</span>&#123;
          <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);
        &#125;
      &#125;);
    &#125;
  &#125;)
&#125;,</code></pre></div>

<h3 id="æµ‹è¯•-3"><a href="#æµ‹è¯•-3" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æµ‹è¯•æµç¨‹ï¼š</p>
<p>1ã€æ–°å»ºä¸€ä¸ªè¯¾ç¨‹</p>
<p>2ã€å‘æ–°å»ºè¯¾ç¨‹ä¸­æ·»åŠ è¯¾ç¨‹è®¡åˆ’</p>
<p> æ·»åŠ ä¸€çº§ç»“ç‚¹</p>
<p> æ·»åŠ äºŒçº§ç»“ç‚¹</p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">å­¦æˆåœ¨çº¿</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/GridFS/">GridFS</a>
                    
                      <a class="hover-with-bg" href="/tags/RabbitMQ/">RabbitMQ</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/13/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday07/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day07</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/11/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday05/">
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day05</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

ä»£ç å—js ç”¨ä¸åˆ°ï¼Œfulidè‡ªå¸¦æœ‰ï¼Œæ·»åŠ cssæ ·å¼å³å¯å®ç°
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®å­—</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å‹‰å¼ºè¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">äº¬ICPè¯123456å·</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>äº¬å…¬ç½‘å®‰å¤‡12345678å·</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "å­¦æˆåœ¨çº¿day06&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
