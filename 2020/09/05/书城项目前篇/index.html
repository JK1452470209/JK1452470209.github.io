<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>书城项目前篇 - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>私人博客</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于我
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-09-05 15:41">
      2020-09-05
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.8k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      104
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="书城项目"><a href="#书城项目" class="headerlink" title="书城项目"></a>书城项目</h1><blockquote>
<p>几个月前刚接触JavaWeb的项目，现在回过头来对所学知识进行总结</p>
</blockquote>
<h2 id="1-项目介绍"><a href="#1-项目介绍" class="headerlink" title="1.项目介绍"></a>1.项目介绍</h2><p>本项目是基于原生底层技术，核心技术点主要有：<br>Servlet程序、Filter过滤器、Listener监听器、jsp页面、EL表达式、JSTL标签库、jQuery框架、Cookie技术、Session会话、JSON使用、Ajax请求。<br>目标：、理解、会用。并为后期框架、框架的学习打下坚实的基础</p>
<h2 id="第一阶段–表单验证"><a href="#第一阶段–表单验证" class="headerlink" title="第一阶段–表单验证"></a>第一阶段–表单验证</h2><p>用于在用户登录和注册时使用的逻辑</p>
<p>验证用户名：必须由字母，数字下划线组成，并且长度为 5 到 12位验证密码：必须由字母，数字下划线组成，并且长度为 5 到 12 位</p>
<p>验证确认密码：和密码相同    </p>
<p>邮箱验证：<a href="mailto:xxxxx@xxx.com">xxxxx@xxx.com</a></p>
<p>验证码：现在只需要验证用户已输入。因为还没讲到服务器。验证码生成。</p>
<h3 id="1、新建一个模块"><a href="#1、新建一个模块" class="headerlink" title="1、新建一个模块"></a>1、新建一个模块</h3><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599307883227.png" srcset="/img/loading.gif" alt="59930788322"></p>
<h3 id="2、把书城的静态资源拷贝到-05-book-static-工程下："><a href="#2、把书城的静态资源拷贝到-05-book-static-工程下：" class="headerlink" title="2、把书城的静态资源拷贝到 05_book_static 工程下："></a>2、把书城的静态资源拷贝到 05_book_static 工程下：</h3><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599307915123.png" srcset="/img/loading.gif" alt="59930791512"></p>
<h3 id="3、验证实现如下："><a href="#3、验证实现如下：" class="headerlink" title="3、验证实现如下："></a>3、验证实现如下：</h3><div class="hljs"><pre><code class="hljs js">&lt;script type=<span class="hljs-string">"text/javascript"</span>&gt;	
				<span class="hljs-comment">//给注册绑定单击事件</span>
            $(<span class="hljs-string">"#sub_btn"</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
                <span class="hljs-comment">//验证用户名：必须由字母，数字下划线组成，并且长度为5到12位</span>
                <span class="hljs-comment">//1 获取用户名输入框里的内容</span>
                <span class="hljs-keyword">var</span> usernameTest = $(<span class="hljs-string">"#username"</span>).val();
                <span class="hljs-comment">//2 创建正则表达式对象</span>
                <span class="hljs-keyword">var</span> usernamePatt = <span class="hljs-regexp">/^\w&#123;5,12&#125;$/</span>;
                <span class="hljs-comment">//3 使用test方法验证</span>
                <span class="hljs-keyword">if</span> (!usernamePatt.test(usernameTest)) &#123;
                    <span class="hljs-comment">//4 提醒用户不合法</span>
                    $(<span class="hljs-string">"span.errorMsg"</span>).text(<span class="hljs-string">"用户名不合法!"</span>);

                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                &#125;

                <span class="hljs-comment">// 验证密码：必须由字母，数字下划线组成，并且长度为5到12位</span>
                <span class="hljs-comment">//1 获取用户名输入框里的内容</span>
                <span class="hljs-keyword">var</span> passwordText = $(<span class="hljs-string">"#password"</span>).val();
                <span class="hljs-comment">//2 创建正则表达式对象</span>
                <span class="hljs-keyword">var</span> passwordPatt = <span class="hljs-regexp">/^\w&#123;5,12&#125;$/</span>;
                <span class="hljs-comment">//3 使用test方法验证</span>
                <span class="hljs-keyword">if</span> (!passwordPatt.test(passwordText)) &#123;
                    <span class="hljs-comment">//4 提示用户结果</span>
                    $(<span class="hljs-string">"span.errorMsg"</span>).text(<span class="hljs-string">"密码不合法！"</span>);

                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                &#125;



                <span class="hljs-comment">//验证确认密码，和密码相同</span>
                <span class="hljs-comment">//1.获取确认密码内容</span>
                <span class="hljs-keyword">var</span> repwdText = $(<span class="hljs-string">"#repwd"</span>).val();
                <span class="hljs-comment">//2 和密码相比较</span>
                <span class="hljs-keyword">if</span> (repwdText.length != passwordText.length) &#123;
                    <span class="hljs-comment">//提示用户</span>
                    $(<span class="hljs-string">"span.errorMsg"</span>).text(<span class="hljs-string">"确认密码和密码不一致！"</span>);

                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                &#125;

                <span class="hljs-comment">//邮箱验证：xxxx@xxx.com</span>
                <span class="hljs-comment">//1.获取邮箱的内容</span>
                <span class="hljs-keyword">var</span> emailText = $(<span class="hljs-string">"#email"</span>).val();
                <span class="hljs-comment">//2.创建正则表达式</span>
                <span class="hljs-keyword">var</span> emailPatt = <span class="hljs-regexp">/^[a-z\d]+(\.[a-z\d]+)*@([\da-z](-[\da-z])?)+(\.&#123;1,2&#125;[a-z]+)+$/</span>;
                <span class="hljs-comment">//3.使用test方式验证是否合法</span>
                <span class="hljs-keyword">if</span> (!emailPatt.test(emailText)) &#123;
                    <span class="hljs-comment">//4.提示用户</span>
                    $(<span class="hljs-string">"span.errorMsg"</span>).text(<span class="hljs-string">"邮箱格式不合法！"</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                &#125;

                <span class="hljs-comment">//验证码</span>
                <span class="hljs-keyword">var</span> codeTest = $(<span class="hljs-string">"#code"</span>).val();

                <span class="hljs-comment">//去掉验证码前后空格</span>
                codeTest = $.trim(codeTest);

                <span class="hljs-keyword">if</span> (codeTest == <span class="hljs-literal">null</span> || codeTest == <span class="hljs-string">""</span>) &#123;
                    <span class="hljs-comment">//提示用户</span>
                    $(<span class="hljs-string">"span.errorMsg"</span>).text(<span class="hljs-string">"验证码不能为空！"</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                &#125;

                <span class="hljs-comment">//去掉错误信息</span>
                $(<span class="hljs-string">"span.errorMsg"</span>).text(<span class="hljs-string">""</span>);

            &#125;);


        &#125;);

    &lt;<span class="hljs-regexp">/script&gt;</span></code></pre></div>

<h2 id="第二阶段–用户注册和登陆"><a href="#第二阶段–用户注册和登陆" class="headerlink" title="第二阶段–用户注册和登陆"></a>第二阶段<strong>–用户注册和登陆</strong></h2><h3 id="1-JavaEE项目的三层架构"><a href="#1-JavaEE项目的三层架构" class="headerlink" title="1.JavaEE项目的三层架构"></a>1.JavaEE项目的三层架构</h3><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599308591538.png" srcset="/img/loading.gif" alt="59930859153"></p>
<p>分层的目的是为了解耦。解耦就是为了降低代码的耦合度。方便项目后期的维护和升级。</p>
<table>
<thead>
<tr>
<th align="left">web 层</th>
<th align="left">com.atguigu.web/servlet/controller</th>
<th align="left">Controller接口</th>
</tr>
</thead>
<tbody><tr>
<td align="left">service 层</td>
<td align="left">com.atguigu.service</td>
<td align="left">Service 接口包</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">com.atguigu.service.impl</td>
<td align="left">Service 接口实现类</td>
</tr>
<tr>
<td align="left">dao 持久层</td>
<td align="left">com.atguigu.dao</td>
<td align="left">Dao 接口包</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">com.atguigu.dao.impl</td>
<td align="left">Dao 接口实现类</td>
</tr>
<tr>
<td align="left">实体 bean 对象</td>
<td align="left">com.atguigu.pojo/entity/domain/bean</td>
<td align="left">JavaBean 类</td>
</tr>
<tr>
<td align="left">测试包</td>
<td align="left">com.atguigu.test/junit</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">工具类</td>
<td align="left">com.atguigu.utils</td>
<td align="left"></td>
</tr>
</tbody></table>
<p>搭建书城项目开发环境：</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599308925889.png" srcset="/img/loading.gif" alt="59930892588"></p>
<h4 id="1、先创建书城需要的数据库和表。"><a href="#1、先创建书城需要的数据库和表。" class="headerlink" title="1、先创建书城需要的数据库和表。"></a>1、先创建书城需要的数据库和表。</h4><div class="hljs"><pre><code class="hljs java">drop database <span class="hljs-keyword">if</span> exists book; create database book;
use book;

<span class="hljs-function">create table <span class="hljs-title">t_user</span><span class="hljs-params">(</span></span>
<span class="hljs-function"><span class="hljs-params">`id` <span class="hljs-keyword">int</span> primary key auto_increment, `username` varchar(<span class="hljs-number">20</span>)</span> not <span class="hljs-keyword">null</span> unique, `password` <span class="hljs-title">varchar</span><span class="hljs-params">(<span class="hljs-number">32</span>)</span> not <span class="hljs-keyword">null</span>,</span>
<span class="hljs-function">`email` <span class="hljs-title">varchar</span><span class="hljs-params">(<span class="hljs-number">200</span>)</span></span>
<span class="hljs-function">)</span>;

<span class="hljs-function">insert into <span class="hljs-title">t_user</span><span class="hljs-params">(`username`,`password`,`email`)</span> <span class="hljs-title">values</span><span class="hljs-params">(<span class="hljs-string">'admin'</span>,<span class="hljs-string">'admin'</span>,<span class="hljs-string">'admin@atguigu.com'</span>)</span></span>; select * from t_user;</code></pre></div>

<h4 id="2、编写数据库表对应的-JavaBean对象"><a href="#2、编写数据库表对应的-JavaBean对象" class="headerlink" title="2、编写数据库表对应的 JavaBean对象"></a>2、编写数据库表对应的 <code>JavaBean</code>对象</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-03  20:49</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;
    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> String username;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> String email;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">()</span> </span>&#123;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(Integer id, String username, String password, String email)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.id = id;
        <span class="hljs-keyword">this</span>.username = username;
        <span class="hljs-keyword">this</span>.password = password;
        <span class="hljs-keyword">this</span>.email = email;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-string">"User&#123;"</span> +
                <span class="hljs-string">"id="</span> + id +
                <span class="hljs-string">", username='"</span> + username + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", password='"</span> + password + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">", email='"</span> + email + <span class="hljs-string">'\''</span> +
                <span class="hljs-string">'&#125;'</span>;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> id;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.id = id;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> username;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.username = username;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> password;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.password = password;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getEmail</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> email;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setEmail</span><span class="hljs-params">(String email)</span> </span>&#123;
        <span class="hljs-keyword">this</span>.email = email;
    &#125;
&#125;</code></pre></div>

<h4 id="3、编写工具类-JdbcUtils"><a href="#3、编写工具类-JdbcUtils" class="headerlink" title="3、编写工具类 JdbcUtils"></a>3、编写工具类 JdbcUtils</h4><p>3.1、导入需要的jar 包（数据库和连接池需要）：</p>
<p>druid-1.1.9.jar</p>
<p>mysql-connector-java-5.1.7-bin.jar</p>
<p>以下是测试需要：</p>
<p>hamcrest-core-1.3.jar</p>
<p>junit-4.12.jar</p>
<p>3.2、在 src 源码目录下编写 jdbc.properties 属性配置文件</p>
<div class="hljs"><pre><code class="hljs properties"><span class="hljs-attr">username</span>=<span class="hljs-string">root</span>
<span class="hljs-attr">password</span>=<span class="hljs-string">123456</span>
<span class="hljs-attr">url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/book?characterEncoding=UTF-8</span>
<span class="hljs-attr">driverClassName</span>=<span class="hljs-string">com.mysql.jdbc.Driver</span>
<span class="hljs-attr">initialSize</span>=<span class="hljs-string">5</span>
<span class="hljs-attr">maxActive</span>=<span class="hljs-string">10</span></code></pre></div>

<p>3.3、编写jdbcUtils工具类：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcUtils</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> DruidDataSource dataSource;
    <span class="hljs-keyword">static</span> &#123;

        <span class="hljs-keyword">try</span> &#123;
            Properties properties = <span class="hljs-keyword">new</span> Properties();
            <span class="hljs-comment">//读取jdbc.properties属性配置文件</span>
            InputStream inputStream = JdbcUtils.class.getClassLoader().getResourceAsStream("jdbc.properties");
            <span class="hljs-comment">//从流中加载数据</span>
            properties.load(inputStream);
            <span class="hljs-comment">//创建 数据库连接池</span>
            dataSource = (DruidDataSource) DruidDataSourceFactory.createDataSource(properties);

            <span class="hljs-comment">//测试代码</span>
            <span class="hljs-comment">//System.out.println(dataSource.getConnection());</span>
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            e.printStackTrace();
        &#125;
    &#125;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title">getConnection</span><span class="hljs-params">()</span> </span>&#123;
        

       Connection conn = <span class="hljs-keyword">null</span>;

       <span class="hljs-keyword">try</span> &#123;
            conn = dataSource.getConnection();
        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;
            e.printStackTrace();
        &#125; <span class="hljs-keyword">finally</span> &#123;
        &#125;
        <span class="hljs-keyword">return</span> conn;
    &#125;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">close</span><span class="hljs-params">(Connection conn)</span> </span>&#123;
        <span class="hljs-keyword">if</span> (conn != <span class="hljs-keyword">null</span>) &#123;
            <span class="hljs-keyword">try</span> &#123;
                conn.close();
            &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;
                e.printStackTrace();
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div>

<p>3.4、JdbcUtils 测试</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JdbcUtilsTest</span> </span>&#123;

<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testJdbcUtils</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++)&#123;
        Connection connection = JdbcUtils.getConnection(); 
        System.out.println(connection); 				
        JdbcUtils.close(connection);
        &#125;
    &#125;

&#125;</code></pre></div>

<h4 id="4、编写BaseDao"><a href="#4、编写BaseDao" class="headerlink" title="4、编写BaseDao"></a>4、编写BaseDao</h4><p>4.1、导入 DBUtils 的 jar 包</p>
<p>​    commons-dbutils-1.3.jar</p>
<p>4.2、编写 BaseDao：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-03  21:17</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseDao</span> </span>&#123;

    <span class="hljs-comment">//使用DbUtils操作数据库</span>
    <span class="hljs-keyword">private</span> QueryRunner queryRunner = <span class="hljs-keyword">new</span> QueryRunner();

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * update()方法用来执行，Insert/Update/Delete语句</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 如果返回-1，说明执行失败 返回其他表示影响的行数</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">update</span><span class="hljs-params">(String sql,Object ...args)</span></span>&#123;
        Connection connection = JdbcUtils.getConnection();

        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">return</span> queryRunner.update(connection,sql,args);
        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;
            e.printStackTrace();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);
        &#125;

    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 查询返回一个javaBean的sql语句</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> type 返回的对象类型</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sql   执行的sql语句</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> args  sql对应的参数值</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt;   返回的类型的泛型</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">T  <span class="hljs-title">queryForOne</span><span class="hljs-params">(Class&lt;T&gt; type,String sql,Object ...args)</span></span>&#123;
        Connection connection = JdbcUtils.getConnection();
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">return</span> queryRunner.query(connection,sql,<span class="hljs-keyword">new</span> BeanHandler&lt;T&gt;(type),args);
        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;
            e.printStackTrace();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);
        &#125;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 查询返回多个javaBean的sql语句</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> type 返回的对象类型</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sql   执行的sql语句</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> args  sql对应的参数值</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> &lt;T&gt;   返回的类型的泛型</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; <span class="hljs-function">List&lt;T&gt; <span class="hljs-title">queryForList</span><span class="hljs-params">(Class&lt;T&gt; type,String sql,Object ...args)</span> </span>&#123;
        Connection connection = JdbcUtils.getConnection();
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">return</span> queryRunner.query(connection, sql, <span class="hljs-keyword">new</span> BeanListHandler&lt;T&gt;(type), args);
        &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;
            e.printStackTrace();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);
        &#125;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 执行返回一行一列的sql语句</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> sql   执行的sql语句</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> args  sql对应的参数值</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">queryForSingleValue</span><span class="hljs-params">(String sql,Object ...args)</span></span>&#123;
        Connection connection = JdbcUtils.getConnection();
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">return</span> queryRunner.query(connection,sql,<span class="hljs-keyword">new</span> ScalarHandler(),args);
        &#125; <span class="hljs-keyword">catch</span> (SQLException e)&#123;
            e.printStackTrace();
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> RuntimeException(e);
        &#125;
    &#125;


&#125;</code></pre></div>

<h4 id="5、编写-UserDao-和测试"><a href="#5、编写-UserDao-和测试" class="headerlink" title="5、编写 UserDao 和测试"></a>5、编写 UserDao 和测试</h4><p>​    UserDao 接口：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-03  21:34</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao</span> </span>&#123;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 更加用户名查询用户信息</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username  用户名</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span>  如果返回null，说明没有这个用户，反之亦然</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">queryUserByUsername</span><span class="hljs-params">(String username)</span></span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     *  根据用户名和密码查询用户信息</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> password</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span>  如果返回null，说明用户名或密码错误，反之亦然</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">queryUserByUsernameAndPassword</span><span class="hljs-params">(String username,String password)</span></span>;


    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 保存、添加用户信息</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> user 返回-1表示操作失败，其他是sql语句影响的行数</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">saveUser</span><span class="hljs-params">(User user)</span></span>;


&#125;</code></pre></div>

<p>UserDaoImpl 实现类：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-03  21:40</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserDao</span> </span>&#123;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">queryUserByUsername</span><span class="hljs-params">(String username)</span> </span>&#123;
        String sql = <span class="hljs-string">"select `id`,`username`,`password`,`email` from t_user where username = ?"</span>;
        <span class="hljs-keyword">return</span> queryForOne(User<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">sql</span>,<span class="hljs-title">username</span>)</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">queryUserByUsernameAndPassword</span><span class="hljs-params">(String username, String password)</span> </span>&#123;
        String sql = <span class="hljs-string">"select `id`,`username`,`password`,`email` from t_user where username = ? and password = ?"</span>;
        <span class="hljs-keyword">return</span> queryForOne(User<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">sql</span>,<span class="hljs-title">username</span>,<span class="hljs-title">password</span>)</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">saveUser</span><span class="hljs-params">(User user)</span> </span>&#123;
        String sql = <span class="hljs-string">"insert into t_user(`username`,`password`,`email`) values(?,?,?)"</span>;
        <span class="hljs-keyword">return</span> update(sql,user.getUsername(),user.getPassword(),user.getEmail());
    &#125;
&#125;</code></pre></div>

<p>UserDao 测试：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-03  21:49</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDaoImplTest</span> </span>&#123;
    UserDao userDao = <span class="hljs-keyword">new</span> UserDaoImpl();
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queryUserByUsername</span><span class="hljs-params">()</span> </span>&#123;

        <span class="hljs-keyword">if</span>(userDao.queryUserByUsername(<span class="hljs-string">"admin"</span>) == <span class="hljs-keyword">null</span>)&#123;
            System.out.println(<span class="hljs-string">"用户名可用！"</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            System.out.println(<span class="hljs-string">"用户名已存在！"</span>);
        &#125;
    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queryUserByUsernameAndPassword</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">if</span>(userDao.queryUserByUsernameAndPassword(<span class="hljs-string">"admin"</span>,<span class="hljs-string">"admin"</span>) == <span class="hljs-keyword">null</span>)&#123;
            System.out.println(<span class="hljs-string">"用户名或密码错误，登陆失败"</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            System.out.println(<span class="hljs-string">"查询成功"</span>);
        &#125;
    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">saveUser</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(userDao.saveUser(<span class="hljs-keyword">new</span> User(<span class="hljs-keyword">null</span>,<span class="hljs-string">"lin"</span>,<span class="hljs-string">"123456"</span>,<span class="hljs-string">"lin@qq.com"</span>)));
    &#125;
&#125;</code></pre></div>

<h4 id="6、编写-UserService-和测试"><a href="#6、编写-UserService-和测试" class="headerlink" title="6、编写 UserService 和测试"></a>6、编写 UserService 和测试</h4><p>UserService 接口：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-04  10:08</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserService</span> </span>&#123;
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 注册用户</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> user</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registUser</span><span class="hljs-params">(User user)</span></span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 登录</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> user</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 如果返回null，说明登录失败，返回有值，说明登录成功</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">login</span><span class="hljs-params">(User user)</span></span>;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 检查 用户名是否可用</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> username</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 返回true表示用户名已存在，返回false表示用户名可用</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">existUsername</span><span class="hljs-params">(String username)</span></span>;

&#125;</code></pre></div>

<p>UserServiceImpl实现类:</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-04  10:11</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;

    <span class="hljs-keyword">private</span> UserDao userdao = <span class="hljs-keyword">new</span> UserDaoImpl();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registUser</span><span class="hljs-params">(User user)</span> </span>&#123;
            userdao.saveUser(user);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">login</span><span class="hljs-params">(User user)</span> </span>&#123;
        <span class="hljs-keyword">return</span> userdao.queryUserByUsernameAndPassword(user.getUsername(),user.getPassword());
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">existUsername</span><span class="hljs-params">(String username)</span> </span>&#123;

        <span class="hljs-keyword">if</span> (userdao.queryUserByUsername(username) == <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-comment">//等于null，说明没查到，表示可用</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    &#125;

&#125;</code></pre></div>

<p>UserService 测试：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-04  10:15</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImplTest</span> </span>&#123;
    UserService userService = <span class="hljs-keyword">new</span> UserServiceImpl();

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registUser</span><span class="hljs-params">()</span> </span>&#123;
        userService.registUser(<span class="hljs-keyword">new</span> User(<span class="hljs-keyword">null</span>,<span class="hljs-string">"lin"</span>,<span class="hljs-string">"123456"</span>,<span class="hljs-string">"123@qq.com"</span>));
    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">login</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(userService.login(<span class="hljs-keyword">new</span> User(<span class="hljs-keyword">null</span>,<span class="hljs-string">"lin"</span>,<span class="hljs-string">"123456"</span>,<span class="hljs-string">"1"</span>)));
    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">existUsername</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">if</span> (userService.existUsername(<span class="hljs-string">"lin"</span>))&#123;
            System.out.println(<span class="hljs-string">"用户名已存在！"</span>);
        &#125;<span class="hljs-keyword">else</span> &#123;
            System.out.println(<span class="hljs-string">"用户名可用!"</span>);
        &#125;
    &#125;
&#125;</code></pre></div>

<h4 id="7、编写-web-层"><a href="#7、编写-web-层" class="headerlink" title="7、编写 web 层"></a>7、编写 web 层</h4><p>7.1、实现用户注册的功能</p>
<p>7.1.1、图解用户注册的流程：</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599310247998.png" srcset="/img/loading.gif" alt="59931024799"></p>
<p>7.1.2、修改 regist.html 和 regist_success.html 页面</p>
<p>1、添加 base 标签</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--写base 标签，永远固定相对路径跳转的结果--&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://localhost:8080/book/"</span>&gt;</span></code></pre></div>

<p>2、修改 base 标签对页面中所有相对路径的影响（浏览器 F12，哪个报红，改哪个）</p>
<div class="hljs"><pre><code class="hljs html">以下是几个修改的示例：
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"static/css/style.css"</span> &gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"static/script/jquery-1.7.2.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div>

<p>3、修改注册表单的提交地址和请求方式</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599310491584.png" srcset="/img/loading.gif" alt="59931049158"></p>
<p>7.1.3、编写 RegistServlet 程序</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-05  16:33</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RegistServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseServlet</span> </span>&#123;
    <span class="hljs-keyword">private</span> UserService userService = <span class="hljs-keyword">new</span> UserServiceImpl();
    
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 处理注册的功能</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">regist</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        


        <span class="hljs-comment">//1.获取请求的参数</span>
        String username = req.getParameter(<span class="hljs-string">"username"</span>);
        String password = req.getParameter(<span class="hljs-string">"password"</span>);
        String email = req.getParameter(<span class="hljs-string">"email"</span>);
        String code = req.getParameter(<span class="hljs-string">"code"</span>);


        User user = WebUtils.copyParmToBean(req.getParameterMap(), <span class="hljs-keyword">new</span> User());

        <span class="hljs-comment">// 2、检查 验证码是否正确 === 写死,要求验证码为:abcde</span>
		<span class="hljs-keyword">if</span> (<span class="hljs-string">"abcde"</span>.equalsIgnoreCase(code)) &#123;
 
		<span class="hljs-comment">//	3、检查用户名是否可用</span>
 
		<span class="hljs-keyword">if</span> (userService.existsUsername(username)) &#123;
			System.out.println(<span class="hljs-string">"用户名["</span> + username + <span class="hljs-string">"]已存在!"</span>);
			<span class="hljs-comment">// 跳回注册页面</span>
			req.getRequestDispatcher(<span class="hljs-string">"/pages/user/regist.html"</span>).forward(req, resp);
		&#125; <span class="hljs-keyword">else</span> &#123;
		<span class="hljs-comment">//可用</span>
 
		<span class="hljs-comment">// 调用Sservice 保存到数据库</span>
		userService.registUser(<span class="hljs-keyword">new</span> User(<span class="hljs-keyword">null</span>, username, password, email));
 
		<span class="hljs-comment">//	跳到注册成功页面 regist_success.html</span>
 
    	req.getRequestDispatcher(<span class="hljs-string">"/pages/user/regist_success.html"</span>).forward(req, resp);

    	&#125;
    &#125; <span class="hljs-keyword">else</span> &#123;
    	System.out.println(<span class="hljs-string">"验证码["</span> + code + <span class="hljs-string">"]错误"</span>);
        req.getRequestDispatcher(<span class="hljs-string">"/pages/user/regist.html"</span>).forward(req, resp);
    &#125;

&#125;</code></pre></div>

<p>7.2、用户登录功能的实现</p>
<p>7.2.1、图解用户登录</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599310896021.png" srcset="/img/loading.gif" alt="59931089602"></p>
<p>7.2.2、修改 login.html 页面和 login_success.html 页面</p>
<p>1、添加 base 标签</p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--写base 标签，永远固定相对路径跳转的结果--&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://localhost:8080/book/"</span>&gt;</span></code></pre></div>

<p>2、修改 base 标签对页面中所有相对路径的影响（浏览器 F12，哪个报红，改哪个）</p>
<p>3、修改 login.html 表单的提交地址和请求方式</p>
<p>2,3如上</p>
<p>7.2.3、LoginServlet 程序</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-05  16:33</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LoginServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseServlet</span> </span>&#123;
    <span class="hljs-keyword">private</span> UserService userService = <span class="hljs-keyword">new</span> UserServiceImpl();
    
    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 处理登录的功能</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">login</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        <span class="hljs-comment">//1.获取连接</span>
        String username = req.getParameter(<span class="hljs-string">"username"</span>);
        String password = req.getParameter(<span class="hljs-string">"password"</span>);

        <span class="hljs-comment">//调用userService.login登录处理业务</span>
        User loginUser = userService.login(<span class="hljs-keyword">new</span> User(<span class="hljs-keyword">null</span>, username, password, <span class="hljs-keyword">null</span>));

        <span class="hljs-keyword">if</span> (loginUser == <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-comment">//调回登录页面</span>
            req.getRequestDispatcher(<span class="hljs-string">"/pages/user/login.jsp"</span>).forward(req,resp);
        &#125;<span class="hljs-keyword">else</span> &#123;
            <span class="hljs-comment">//登录成功页面</span>
            <span class="hljs-comment">//System.out.println("登录成功");</span>
            req.getRequestDispatcher(<span class="hljs-string">"/pages/user/login_success.jsp"</span>).forward(req,resp);
        &#125;
    &#125;
&#125;</code></pre></div>

<h2 id="第三阶段–前后端整合"><a href="#第三阶段–前后端整合" class="headerlink" title="第三阶段–前后端整合"></a>第三阶段–前后端整合</h2><h3 id="1-页面-jsp-动态化"><a href="#1-页面-jsp-动态化" class="headerlink" title="1.页面 jsp 动态化"></a>1.页面 jsp 动态化</h3><p>1、在html 页面顶行添加page 指令。</p>
<p>2、修改文件后缀名为：.jsp</p>
<p>3、使用 IDEA 搜索替换.html 为.jsp(快捷键：Ctrl+Shift+R)</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599314147604.png" srcset="/img/loading.gif" alt="59931414760"></p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599314156656.png" srcset="/img/loading.gif" alt="59931415665"></p>
<h3 id="2-抽取页面中相同的内容"><a href="#2-抽取页面中相同的内容" class="headerlink" title="2.抽取页面中相同的内容"></a>2.抽取页面中相同的内容</h3><h4 id="1、head-中-css、jquery、base-标签"><a href="#1、head-中-css、jquery、base-标签" class="headerlink" title="1、head 中 css、jquery、base 标签"></a>1、head 中 css、jquery、base 标签</h4><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%</span></span>
<span class="hljs-tag"></span>
<span class="hljs-tag"><span class="hljs-attr">String</span> <span class="hljs-attr">basePath</span> = <span class="hljs-string">request.getScheme()</span> + "<span class="hljs-attr">:</span>//"</span>
<span class="hljs-tag">+ <span class="hljs-attr">request.getServerName</span>() + "<span class="hljs-attr">:</span>"</span>
<span class="hljs-tag">+ <span class="hljs-attr">request.getServerPort</span>()</span>
<span class="hljs-tag">+ <span class="hljs-attr">request.getContextPath</span>() + "/";</span>
<span class="hljs-tag">%&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%=basePath%</span>&gt;</span>
<span class="hljs-comment">&lt;!--写base 标签，永远固定相对路径跳转的结果--&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">base</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"&lt;%=basePath%&gt;"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"static/css/style.css"</span> &gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"static/script/jquery-1.7.2.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div>

<h4 id="2、每个页面的页脚"><a href="#2、每个页面的页脚" class="headerlink" title="2、每个页面的页脚"></a>2、每个页面的页脚</h4><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"bottom"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>
   		 尚硅谷书城.Copyright <span class="hljs-symbol">&amp;copy;</span>2015	
    <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>

<h4 id="3、登录成功后的菜单"><a href="#3、登录成功后的菜单" class="headerlink" title="3、登录成功后的菜单"></a>3、登录成功后的菜单</h4><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>欢迎<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"um_span"</span>&gt;</span>韩总<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>光临尚硅谷书城<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../order/order.jsp"</span>&gt;</span>我的订单<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../../index.jsp"</span>&gt;</span>注销<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-symbol">&amp;nbsp;</span><span class="hljs-symbol">&amp;nbsp;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../../index.jsp"</span>&gt;</span>返回<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>

<h4 id="4、manager-模块的菜单"><a href="#4、manager-模块的菜单" class="headerlink" title="4、manager 模块的菜单"></a>4、manager 模块的菜单</h4><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"book_manager.jsp"</span>&gt;</span>图书管理<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> 
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"order_manager.jsp"</span>&gt;</span>订单管理<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"../../index.jsp"</span>&gt;</span>返回商城<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>

<h3 id="3-登录，注册错误提示，及表单回显"><a href="#3-登录，注册错误提示，及表单回显" class="headerlink" title="3.登录，注册错误提示，及表单回显"></a>3.登录，注册错误提示，及表单回显</h3><p>以登录回显为示例：</p>
<p>Servlet 程序端需要添加回显信息到Request 域中</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599314424641.png" srcset="/img/loading.gif" alt="59931442464"></p>
<p>jsp 页面，需要输出回显信息</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599314441257.png" srcset="/img/loading.gif" alt="59931444125"></p>
<h3 id="4-BaseServlet的抽取"><a href="#4-BaseServlet的抽取" class="headerlink" title="4.BaseServlet的抽取"></a>4.BaseServlet的抽取</h3><p>在实际的项目开发中，一个模块，一般只使用一个 <code>Servlet</code> 程序。</p>
<p>代码优化一：代码优化：合并 LoginServlet 和 RegistServlet 程序为 UserServlet 程序</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599314517553.png" srcset="/img/loading.gif" alt="59931451755"></p>
<p>UserServlet 程序：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseServlet</span> </span>&#123;
    <span class="hljs-keyword">private</span> UserService userService = <span class="hljs-keyword">new</span> UserServiceImpl();


    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 处理登录的功能</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">login</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        <span class="hljs-comment">//1.获取连接</span>
        String username = req.getParameter(<span class="hljs-string">"username"</span>);
        String password = req.getParameter(<span class="hljs-string">"password"</span>);

        <span class="hljs-comment">//调用userService.login登录处理业务</span>
        User loginUser = userService.login(<span class="hljs-keyword">new</span> User(<span class="hljs-keyword">null</span>, username, password, <span class="hljs-keyword">null</span>));

        <span class="hljs-keyword">if</span> (loginUser == <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-comment">//调回登录页面</span>
            <span class="hljs-comment">//把错误信息，和回显的表单项信息，保存到Request域中</span>
            req.setAttribute(<span class="hljs-string">"msg"</span>,<span class="hljs-string">"用户名或密码错误！"</span>);
            req.setAttribute(<span class="hljs-string">"username"</span>,username);
            <span class="hljs-comment">//System.out.println("登录失败");</span>
            req.getRequestDispatcher(<span class="hljs-string">"/pages/user/login.jsp"</span>).forward(req,resp);
        &#125;<span class="hljs-keyword">else</span> &#123;
            <span class="hljs-comment">//登录成功页面</span>
            <span class="hljs-comment">//System.out.println("登录成功");</span>

            <span class="hljs-comment">//将登陆成功的信息保存报Session域</span>
            req.getSession().setAttribute(<span class="hljs-string">"user"</span>,loginUser);

            req.getRequestDispatcher(<span class="hljs-string">"/pages/user/login_success.jsp"</span>).forward(req,resp);
        &#125;
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 处理注册的功能</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> req</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> resp</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> ServletException</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">regist</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        <span class="hljs-comment">//获取Session中的验证码</span>
        String token = (String)req.getSession().getAttribute(KAPTCHA_SESSION_KEY);
        <span class="hljs-comment">//删除Session中的验证码</span>
        req.getSession().removeAttribute(KAPTCHA_SESSION_KEY);


        <span class="hljs-comment">//1.获取请求的参数</span>
        String username = req.getParameter(<span class="hljs-string">"username"</span>);
        String password = req.getParameter(<span class="hljs-string">"password"</span>);
        String email = req.getParameter(<span class="hljs-string">"email"</span>);
        String code = req.getParameter(<span class="hljs-string">"code"</span>);


        User user = WebUtils.copyParmToBean(req.getParameterMap(), <span class="hljs-keyword">new</span> User());

        <span class="hljs-comment">//2.检查 验证码是否正确 ==== 用谷歌验证码</span>
        <span class="hljs-keyword">if</span> (token != <span class="hljs-keyword">null</span> &amp;&amp; token.equalsIgnoreCase(code))&#123;

            <span class="hljs-comment">//3.检查 用户名是否可用</span>
            <span class="hljs-keyword">if</span> (userService.existUsername(username))&#123;
                <span class="hljs-comment">//不可用</span>
                System.out.println(<span class="hljs-string">"用户名["</span> + username + <span class="hljs-string">"]已存在！"</span>);
                <span class="hljs-comment">//把回显信息，保存到Request域中</span>
                req.setAttribute(<span class="hljs-string">"msg"</span>,<span class="hljs-string">"用户名已存在!"</span>);
                req.setAttribute(<span class="hljs-string">"username"</span>,username);
                req.setAttribute(<span class="hljs-string">"email"</span>,email);

                <span class="hljs-comment">//跳回注册页面</span>
                req.getRequestDispatcher(<span class="hljs-string">"/pages/user/regist.jsp"</span>).forward(req,resp);

            &#125;<span class="hljs-keyword">else</span>&#123;
                <span class="hljs-comment">//可用，调用Service保存到数据库</span>
                userService.registUser(<span class="hljs-keyword">new</span> User(<span class="hljs-keyword">null</span>,username,password,email));
                req.getRequestDispatcher(<span class="hljs-string">"/pages/user/regist_success.jsp"</span>).forward(req,resp);

            &#125;

        &#125;<span class="hljs-keyword">else</span> &#123;
            <span class="hljs-comment">//把回显信息，保存到Request域中</span>
            req.setAttribute(<span class="hljs-string">"msg"</span>,<span class="hljs-string">"验证码错误!"</span>);
            req.setAttribute(<span class="hljs-string">"username"</span>,username);
            req.setAttribute(<span class="hljs-string">"email"</span>,email);

            System.out.println(<span class="hljs-string">"验证码["</span> + code +<span class="hljs-string">"]错误"</span>);
            req.getRequestDispatcher(<span class="hljs-string">"/pages/user/regist.jsp"</span>).forward(req,resp);
        &#125;
    &#125;

        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException,IOException </span>&#123;
    String action = req.getParameter(<span class="hljs-string">"action"</span>); <span class="hljs-keyword">if</span> (<span class="hljs-string">"login"</span>.equals(action)) &#123;
   		 login(req, resp);

    	&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"regist"</span>.equals(action)) &#123;

    regist(req, resp);

    &#125;

&#125;</code></pre></div>

<p>还要给<br>login.jsp  添加隐藏域和修改请求地址</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599315410319.png" srcset="/img/loading.gif" alt="59931541031"></p>
<p>给 tegist.jsp 页面添加隐藏域 action，和修改请求地址</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599315429115.png" srcset="/img/loading.gif" alt="59931542911"></p>
<p><strong>优化代码二：使用反射优化大量</strong> <strong>else</strong> <strong>if</strong> <strong>代码：</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        req.setCharacterEncoding(<span class="hljs-string">"UTF-8"</span>);<span class="hljs-comment">//关键 解决post乱码问题</span>
        <span class="hljs-comment">//解决响应的中文乱码</span>
        resp.setContentType(<span class="hljs-string">"text/html; charset=UTF-8"</span>);
        String action = req.getParameter(<span class="hljs-string">"action"</span>);

        <span class="hljs-keyword">try</span> &#123;
            Method method = <span class="hljs-keyword">this</span>.getClass().getDeclaredMethod(action,HttpServletRequest<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">HttpServletResponse</span>.<span class="hljs-title">class</span>)</span>;

            method.invoke(<span class="hljs-keyword">this</span>,req,resp);
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            e.printStackTrace();
           
    &#125;</code></pre></div>

<p>代码优化三：抽取BaseServlet 程序。</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599315502225.png" srcset="/img/loading.gif" alt="59931550222"></p>
<p>BaseServlet 程序代码：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-05  18:01</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseServlet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">HttpServlet</span> </span>&#123;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doGet</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        doPost(req, resp);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">doPost</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        req.setCharacterEncoding(<span class="hljs-string">"UTF-8"</span>);<span class="hljs-comment">//关键 解决post乱码问题</span>
        <span class="hljs-comment">//解决响应的中文乱码</span>
        resp.setContentType(<span class="hljs-string">"text/html; charset=UTF-8"</span>);
        String action = req.getParameter(<span class="hljs-string">"action"</span>);

        <span class="hljs-keyword">try</span> &#123;
            Method method = <span class="hljs-keyword">this</span>.getClass().getDeclaredMethod(action,HttpServletRequest<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">HttpServletResponse</span>.<span class="hljs-title">class</span>)</span>;

            method.invoke(<span class="hljs-keyword">this</span>,req,resp);
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            e.printStackTrace();
          
    &#125;

    &#125;
&#125;</code></pre></div>

<p>修改 UserServlet 程序继承BaseServlet 程序。</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599315569499.png" srcset="/img/loading.gif" alt="59931556949"></p>
<h3 id="5-数据的封装和抽取-BeanUtils-的使用"><a href="#5-数据的封装和抽取-BeanUtils-的使用" class="headerlink" title="5.数据的封装和抽取 BeanUtils 的使用"></a>5.数据的封装和抽取 BeanUtils 的使用</h3><p>BeanUtils 工具类，它可以一次性的把所有请求的参数注入到 JavaBean 中。</p>
<p>BeanUtils 工具类，经常用于把 Map 中的值注入到 JavaBean 中，或者是对象属性值的拷贝操作。</p>
<p>BeanUtils 它不是 Jdk 的类。而是第三方的工具类。所以需要导包。</p>
<p>​    1、导入需要的 jar 包：commons-beanutils-1.8.0.jar commons-logging-1.1.1.jar</p>
<p>​    2、编写 WebUtils 工具类使用：</p>
<p>WebUtils 工具类：</p>
<div class="hljs"><pre><code class="hljs java">**
 * <span class="hljs-meta">@outhor</span> Mr.JK
 * <span class="hljs-meta">@create</span> <span class="hljs-number">2020</span>-<span class="hljs-number">04</span>-<span class="hljs-number">05</span>  <span class="hljs-number">19</span>:<span class="hljs-number">57</span>
 */
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebUtils</span> </span>&#123;
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">T  <span class="hljs-title">copyParmToBean</span><span class="hljs-params">(Map values, T bean)</span></span>&#123;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-comment">//使用第三方jar包，将数据封装到Bean对象</span>
            BeanUtils.populate(bean,values);

        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;
            e.printStackTrace();
        &#125;
        <span class="hljs-keyword">return</span> bean;
    &#125;
&#125;</code></pre></div>

<h2 id="第四阶段–修改回显"><a href="#第四阶段–修改回显" class="headerlink" title="第四阶段–修改回显"></a>第四阶段–修改回显</h2><p>以登录为示例：</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599315713421.png" srcset="/img/loading.gif" alt="59931571342"></p>
<h2 id="第五阶段–图书模块"><a href="#第五阶段–图书模块" class="headerlink" title="第五阶段–图书模块"></a>第五阶段–图书模块</h2><h3 id="MVC-概念"><a href="#MVC-概念" class="headerlink" title="MVC 概念"></a>MVC 概念</h3><p>MVC  全称：Model  模型、  View  视图、 Controller  控制器。</p>
<p>MVC  最早出现在 JavaEE 三层中的 Web 层，它可以有效的指导 Web 层的代码如何有效分离，单独工作。</p>
<p>View 视图：只负责数据和界面的显示，不接受任何与显示数据无关的代码，便于程序员和美工的分工合作——</p>
<p>JSP/HTML。</p>
<p>Controller控制器：只负责接收请求，调用业务层的代码处理请求，然后派发页面，是一个“调度者”的角色——Servlet。转到某个页面。或者是重定向到某个页面。</p>
<p>Model 模型：将与业务逻辑相关的数据封装为具体的 JavaBean 类，其中不掺杂任何与数据处理相关的代码——</p>
<p>JavaBean/domain/entity/pojo。</p>
<p><strong>MVC</strong> <strong>是一种思想</strong></p>
<p>MVC的理念是将软件代码拆分成为组件，单独开发，组合使用（目的还是为了降低耦合度）</p>
<p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599316317349.png" srcset="/img/loading.gif" alt="59931631734"></p>
<p><strong>MVC</strong> <strong>的作用还是为了降低耦合。让代码合理分层。方便后期升级和维护。</strong></p>
<h3 id="1、图书模块"><a href="#1、图书模块" class="headerlink" title="1、图书模块"></a>1、图书模块</h3><h4 id="1-1、编写图书模块的数据库表"><a href="#1-1、编写图书模块的数据库表" class="headerlink" title="1.1、编写图书模块的数据库表"></a>1.1、编写图书模块的数据库表</h4><div class="hljs"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> t_book(
    <span class="hljs-string">`id`</span> <span class="hljs-built_in">int</span> primary <span class="hljs-keyword">key</span> auto_increment, 
    <span class="hljs-string">`name`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>),
    <span class="hljs-string">`price`</span> <span class="hljs-built_in">decimal</span>(<span class="hljs-number">11</span>,<span class="hljs-number">2</span>), 
    <span class="hljs-string">`author`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>), <span class="hljs-string">`sales`</span> <span class="hljs-built_in">int</span>,
    <span class="hljs-string">`stock`</span> <span class="hljs-built_in">int</span>,
    <span class="hljs-string">`img_path`</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">200</span>)
);</code></pre></div>

<div class="hljs"><pre><code class="hljs sql"><span class="hljs-comment">## 插入初始化测试数据</span>
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'java 从入门到放弃'</span> , <span class="hljs-string">'国哥'</span> , <span class="hljs-number">80</span> , <span class="hljs-number">9999</span> , <span class="hljs-number">9</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'数据结构与算法'</span> , <span class="hljs-string">'严敏君'</span> , <span class="hljs-number">78.5</span> , <span class="hljs-number">6</span> , <span class="hljs-number">13</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'怎样拐跑别人的媳妇'</span> , <span class="hljs-string">'龙伍'</span> , <span class="hljs-number">68</span>, <span class="hljs-number">99999</span> , <span class="hljs-number">52</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'木虚肉盖饭'</span> , <span class="hljs-string">'小胖'</span> , <span class="hljs-number">16</span>, <span class="hljs-number">1000</span> , <span class="hljs-number">50</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'C++编程思想'</span> , <span class="hljs-string">'刚哥'</span> , <span class="hljs-number">45.5</span> , <span class="hljs-number">14</span> , <span class="hljs-number">95</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'蛋炒饭'</span> , <span class="hljs-string">'周星星'</span> , <span class="hljs-number">9.9</span>, <span class="hljs-number">12</span> , <span class="hljs-number">53</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'赌神'</span> , <span class="hljs-string">'龙伍'</span> , <span class="hljs-number">66.5</span>, <span class="hljs-number">125</span> , <span class="hljs-number">535</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'Java 编程思想'</span> , <span class="hljs-string">'阳哥'</span> , <span class="hljs-number">99.5</span> , <span class="hljs-number">47</span> , <span class="hljs-number">36</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'JavaScript 从入门到精通'</span> , <span class="hljs-string">'婷姐'</span> , <span class="hljs-number">9.9</span> , <span class="hljs-number">85</span> , <span class="hljs-number">95</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'cocos2d-x 游戏编程入门'</span> , <span class="hljs-string">'国哥'</span> , <span class="hljs-number">49</span>, <span class="hljs-number">52</span> , <span class="hljs-number">62</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'C 语言程序设计'</span> , <span class="hljs-string">'谭浩强'</span> , <span class="hljs-number">28</span> , <span class="hljs-number">52</span> , <span class="hljs-number">74</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'Lua 语言程序设计'</span> , <span class="hljs-string">'雷丰阳'</span> , <span class="hljs-number">51.5</span> , <span class="hljs-number">48</span> , <span class="hljs-number">82</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'西游记'</span> , <span class="hljs-string">'罗贯中'</span> , <span class="hljs-number">12</span>, <span class="hljs-number">19</span> , <span class="hljs-number">9999</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'水浒传'</span> , <span class="hljs-string">'华仔'</span> , <span class="hljs-number">33.05</span> , <span class="hljs-number">22</span> , <span class="hljs-number">88</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'操作系统原理'</span> , <span class="hljs-string">'刘优'</span> , <span class="hljs-number">133.05</span> , <span class="hljs-number">122</span> , <span class="hljs-number">188</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'数据结构 java 版'</span> , <span class="hljs-string">'封大神'</span> , <span class="hljs-number">173.15</span> , <span class="hljs-number">21</span> , <span class="hljs-number">81</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'UNIX 高级环境编程'</span> , <span class="hljs-string">'乐天'</span> , <span class="hljs-number">99.15</span> , <span class="hljs-number">210</span> , <span class="hljs-number">810</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'javaScript 高级编程'</span> , <span class="hljs-string">'国哥'</span> , <span class="hljs-number">69.15</span> , <span class="hljs-number">210</span> , <span class="hljs-number">810</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'大话设计模式'</span> , <span class="hljs-string">'国哥'</span> , <span class="hljs-number">89.15</span> , <span class="hljs-number">20</span> , <span class="hljs-number">10</span> , <span class="hljs-string">'static/img/default.jpg'</span>);

<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> t_book(<span class="hljs-string">`id`</span> , <span class="hljs-string">`name`</span> , <span class="hljs-string">`author`</span> , <span class="hljs-string">`price`</span> , <span class="hljs-string">`sales`</span> , <span class="hljs-string">`stock`</span> , <span class="hljs-string">`img_path`</span>) <span class="hljs-keyword">values</span>(<span class="hljs-literal">null</span> , <span class="hljs-string">'人月神话'</span> , <span class="hljs-string">'刚哥'</span> , <span class="hljs-number">88.15</span> , <span class="hljs-number">20</span> , <span class="hljs-number">80</span> , <span class="hljs-string">'static/img/default.jpg'</span>);


<span class="hljs-comment">## 查看表内容</span>
<span class="hljs-keyword">select</span> <span class="hljs-keyword">id</span>,<span class="hljs-keyword">name</span>,author,price,sales,stock,img_path <span class="hljs-keyword">from</span> t_book;</code></pre></div>

<h4 id="1-2、编写图书模块的-JavaBean"><a href="#1-2、编写图书模块的-JavaBean" class="headerlink" title="1.2、编写图书模块的 JavaBean"></a>1.2、编写图书模块的 JavaBean</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Book</span> </span>&#123; 
    <span class="hljs-keyword">private</span> Integer id; 
    <span class="hljs-keyword">private</span> String name; 
    <span class="hljs-keyword">private</span> String author;
	<span class="hljs-keyword">private</span> BigDecimal price; 
    <span class="hljs-keyword">private</span> Integer sales; 
    <span class="hljs-keyword">private</span> Integer stock;
	<span class="hljs-keyword">private</span> String imgPath = <span class="hljs-string">"static/img/default.jpg"</span>;
&#125;</code></pre></div>

<h4 id="1-3、编写图书模块的-Dao-和测试-Dao"><a href="#1-3、编写图书模块的-Dao-和测试-Dao" class="headerlink" title="1.3、编写图书模块的 Dao 和测试 Dao"></a>1.3、编写图书模块的 Dao 和测试 Dao</h4><p>Dao 接口</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-06  11:28</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookDao</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">addBook</span><span class="hljs-params">(Book book)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">deleteBookById</span><span class="hljs-params">(Integer id)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">updateBook</span><span class="hljs-params">(Book book)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Book <span class="hljs-title">queryBookById</span><span class="hljs-params">(Integer id)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title">queryBooks</span><span class="hljs-params">()</span></span>;
&#125;</code></pre></div>

<p>BookDaoImpl 实现类：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-06  11:31</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookDaoImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseDao</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BookDao</span> </span>&#123;
    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">addBook</span><span class="hljs-params">(Book book)</span> </span>&#123;
        String sql = <span class="hljs-string">"insert into t_book(`name`,`author`,`price`,`sales`,`stock`,`img_path`)values(?,?,?,?,?,?)"</span>;
        <span class="hljs-keyword">return</span> update(sql,book.getName(),book.getAuthor(),book.getPrice(),book.getSales(),book.getStock(),book.getImgPath());
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">deleteBookById</span><span class="hljs-params">(Integer id)</span> </span>&#123;
        String sql = <span class="hljs-string">"delete from t_book where id = ?"</span>;
        <span class="hljs-keyword">return</span> update(sql,id);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">updateBook</span><span class="hljs-params">(Book book)</span> </span>&#123;
        String sql = <span class="hljs-string">"update t_book set `name`=?,`author`=?,`price`=?,`sales`=?,`stock`=?,`img_path`=? where id = ?"</span>;
        <span class="hljs-keyword">return</span> update(sql,book.getName(),book.getAuthor(),book.getPrice(),book.getSales(),book.getStock(),book.getImgPath(),book.getId());

    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Book <span class="hljs-title">queryBookById</span><span class="hljs-params">(Integer id)</span> </span>&#123;
        String sql = <span class="hljs-string">"select `id` , `name` , `author` , `price` , `sales` , `stock` , `img_path` from t_book where id = ?"</span>;
        <span class="hljs-keyword">return</span> queryForOne(Book<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">sql</span>,<span class="hljs-title">id</span>)</span>;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title">queryBooks</span><span class="hljs-params">()</span> </span>&#123;
        String sql = <span class="hljs-string">"select `id` , `name` , `author` , `price` , `sales` , `stock` , `img_path` from t_book"</span>;

        <span class="hljs-keyword">return</span> queryForList(Book<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">sql</span>)</span>;
    &#125;
&#125;</code></pre></div>

<p>BookDao 的测试：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-06  11:42</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookDaoImplTest</span> </span>&#123;
    <span class="hljs-keyword">private</span> BookDao bookDao = <span class="hljs-keyword">new</span> BookDaoImpl();

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addBook</span><span class="hljs-params">()</span> </span>&#123;
        bookDao.addBook(<span class="hljs-keyword">new</span> Book(<span class="hljs-keyword">null</span>, <span class="hljs-string">"帅哥"</span>, <span class="hljs-string">"坤哥"</span>, <span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-number">999</span>), <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">null</span>));
    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteBookById</span><span class="hljs-params">()</span> </span>&#123;
        bookDao.deleteBookById(<span class="hljs-number">21</span>);
    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateBook</span><span class="hljs-params">()</span> </span>&#123;
        bookDao.updateBook(<span class="hljs-keyword">new</span> Book(<span class="hljs-number">21</span>, <span class="hljs-string">"帅哥秘籍"</span>, <span class="hljs-string">"坤哥"</span>, <span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-number">999</span>), <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">null</span>));

    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queryBookById</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(bookDao.queryBookById(<span class="hljs-number">21</span>));
    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queryBooks</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">for</span> (Book querybook : bookDao.queryBooks()) &#123;
            System.out.println(querybook);
        &#125;
    &#125;
&#125;</code></pre></div>

<h4 id="1-4、编写图书模块的-Service-和测试-Service"><a href="#1-4、编写图书模块的-Service-和测试-Service" class="headerlink" title="1.4、编写图书模块的 Service 和测试 Service"></a>1.4、编写图书模块的 Service 和测试 Service</h4><p>BookService 接口</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-06  13:09</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">BookService</span> </span>&#123;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addBook</span><span class="hljs-params">(Book book)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteBookById</span><span class="hljs-params">(Integer id)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateBook</span><span class="hljs-params">(Book book)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Book <span class="hljs-title">queryBookById</span><span class="hljs-params">(Integer id)</span></span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title">queryBooks</span><span class="hljs-params">()</span></span>;
&#125;</code></pre></div>

<p>BookServiceImpl 实现类：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-06  13:11</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BookService</span> </span>&#123;

    <span class="hljs-keyword">private</span> BookDao bookDao = <span class="hljs-keyword">new</span> BookDaoImpl();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addBook</span><span class="hljs-params">(Book book)</span> </span>&#123;
        bookDao.addBook(book);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteBookById</span><span class="hljs-params">(Integer id)</span> </span>&#123;
        bookDao.deleteBookById(id);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateBook</span><span class="hljs-params">(Book book)</span> </span>&#123;
        bookDao.updateBook(book);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Book <span class="hljs-title">queryBookById</span><span class="hljs-params">(Integer id)</span> </span>&#123;
        <span class="hljs-keyword">return</span> bookDao.queryBookById(id);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Book&gt; <span class="hljs-title">queryBooks</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> bookDao.queryBooks();
    &#125;
&#125;</code></pre></div>

<p>BookService 的测试:</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@outhor</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-04-06  13:37</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BookServiceImplTest</span> </span>&#123;
    <span class="hljs-keyword">private</span> BookService bookService = <span class="hljs-keyword">new</span> BookServiceImpl();

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addBook</span><span class="hljs-params">()</span> </span>&#123;
        bookService.addBook(<span class="hljs-keyword">new</span> Book(<span class="hljs-keyword">null</span>, <span class="hljs-string">"帅哥"</span>, <span class="hljs-string">"坤哥"</span>, <span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-number">999</span>), <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">null</span>));

    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteBookById</span><span class="hljs-params">()</span> </span>&#123;
        bookService.deleteBookById(<span class="hljs-number">27</span>);
    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateBook</span><span class="hljs-params">()</span> </span>&#123;
        bookService.updateBook(<span class="hljs-keyword">new</span> Book(<span class="hljs-number">21</span>, <span class="hljs-string">"帅哥秘籍"</span>, <span class="hljs-string">"坤哥"</span>, <span class="hljs-keyword">new</span> BigDecimal(<span class="hljs-number">999</span>), <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">null</span>));

    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queryBookById</span><span class="hljs-params">()</span> </span>&#123;
        System.out.println(bookService.queryBookById(<span class="hljs-number">27</span>));

    &#125;

    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">queryBooks</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">for</span> (Book querybook : bookService.queryBooks()) &#123;
            System.out.println(querybook);
        &#125;
    &#125;
&#125;</code></pre></div>

<h4 id="1-5、编写图书模块的-Web-层，和页面联调测试"><a href="#1-5、编写图书模块的-Web-层，和页面联调测试" class="headerlink" title="1.5、编写图书模块的 Web 层，和页面联调测试"></a>1.5、编写图书模块的 Web 层，和页面联调测试</h4><h5 id="1-5-1、图书列表功能的实现"><a href="#1-5-1、图书列表功能的实现" class="headerlink" title="1.5.1、图书列表功能的实现"></a>1.5.1、图书列表功能的实现</h5><h6 id="1、图解列表功能流程："><a href="#1、图解列表功能流程：" class="headerlink" title="1、图解列表功能流程："></a>1、图解列表功能流程：</h6><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599317751273.png" srcset="/img/loading.gif" alt="59931775127"></p>
<h6 id="2、BookServlet-程序中添加-list-方法"><a href="#2、BookServlet-程序中添加-list-方法" class="headerlink" title="2、BookServlet 程序中添加 list 方法"></a>2、BookServlet 程序中添加 list 方法</h6><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">list</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        <span class="hljs-comment">//1.通过BookServlet查询全部图书</span>
        List&lt;Book&gt; books = bookService.queryBooks();
        <span class="hljs-comment">//2.把全部图书保存到Request域中</span>
        req.setAttribute(<span class="hljs-string">"books"</span>,books);
        <span class="hljs-comment">//3.请求转发到/pages/manager/book_manager.jsp</span>
        req.getRequestDispatcher(<span class="hljs-string">"/pages/manager/book_manager.jsp"</span>).forward(req,resp);

    &#125;</code></pre></div>

<h6 id="3、修改【图书管理】请求地址"><a href="#3、修改【图书管理】请求地址" class="headerlink" title="3、修改【图书管理】请求地址"></a>3、修改【图书管理】请求地址</h6><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599317852680.png" srcset="/img/loading.gif" alt="59931785268"></p>
<h6 id="4、修改-pages-manager-book-manager-jsp-页面的数据遍历输出"><a href="#4、修改-pages-manager-book-manager-jsp-页面的数据遍历输出" class="headerlink" title="4、修改 pages/manager/book_manager.jsp 页面的数据遍历输出"></a>4、修改 pages/manager/book_manager.jsp 页面的数据遍历输出</h6><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">taglib</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">"c"</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>图书管理<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>

	
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"header"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo_img"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"../../static/img/logo.gif"</span> &gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"wel_word"</span>&gt;</span>图书管理系统<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">%--</span> 静态包含<span class="hljs-attr">manager</span>管理，模块的菜单<span class="hljs-attr">--</span>%&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">%@include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"/pages/common/manager_menu.jsp"</span>%&gt;</span>

	<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
	
	<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"main"</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>名称<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>价格<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>作者<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>销量<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>库存<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">"2"</span>&gt;</span>操作<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">c:forEach</span> <span class="hljs-attr">items</span>=<span class="hljs-string">"$&#123;requestScope.page.items&#125;"</span> <span class="hljs-attr">var</span>=<span class="hljs-string">"book"</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;book.name&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;book.price&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;book.author&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;book.sales&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>$&#123;book.stock&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"manager/bookServlet?action=getBook&amp;id=$&#123;book.id&#125;&amp;pageNo=$&#123;requestScope.page.pageNo&#125;"</span>&gt;</span>修改<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"deleteClass"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"manager/bookServlet?action=delete&amp;id=$&#123;book.id&#125;&amp;pageNo=$&#123;requestScope.page.pageNo&#125;"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">c:forEach</span>&gt;</span>

			
			<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"pages/manager/book_edit.jsp?pageNo=$&#123;requestScope.page.pageTotal&#125;"</span>&gt;</span>添加图书<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>	
		<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>

		<span class="hljs-tag">&lt;<span class="hljs-name">%--静态包含分页条--%</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">%@include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"/pages/common/page_nav.jsp"</span>%&gt;</span>

	<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>


	<span class="hljs-tag">&lt;<span class="hljs-name">%--</span>	静态包含页脚内容<span class="hljs-attr">--</span>%&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">%@include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"/pages/common/footer.jsp"</span>%&gt;</span>


<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>

<h5 id="1-5-2、前后台的简单介绍"><a href="#1-5-2、前后台的简单介绍" class="headerlink" title="1.5.2、前后台的简单介绍"></a>1.5.2、前后台的简单介绍</h5><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599318008451.png" srcset="/img/loading.gif" alt="59931800845"></p>
<h5 id="1-5-3、添加图书功能的实现"><a href="#1-5-3、添加图书功能的实现" class="headerlink" title="1.5.3、添加图书功能的实现"></a>1.5.3、添加图书功能的实现</h5><h6 id="1-5-3-1、添加图书流程细节："><a href="#1-5-3-1、添加图书流程细节：" class="headerlink" title="1.5.3.1、添加图书流程细节："></a>1.5.3.1、添加图书流程细节：</h6><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599318056145.png" srcset="/img/loading.gif" alt="59931805614"></p>
<h6 id="1-5-3-2、问题说明：表单重复提交："><a href="#1-5-3-2、问题说明：表单重复提交：" class="headerlink" title="1.5.3.2、问题说明：表单重复提交："></a>1.5.3.2、问题说明：表单重复提交：</h6><p>当用户提交完请求，浏览器会记录下最后一次请求的全部信息。当用户按下功能键 F5，就会发起浏览器记录的最后一次请求。</p>
<h6 id="1-5-3-3、BookServlet-程序中添加-add-方法"><a href="#1-5-3-3、BookServlet-程序中添加-add-方法" class="headerlink" title="1.5.3.3、BookServlet 程序中添加 add 方法"></a>1.5.3.3、BookServlet 程序中添加 add 方法</h6><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">add</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        <span class="hljs-keyword">int</span> pageNo = WebUtils.parseInt(req.getParameter(<span class="hljs-string">"pageNo"</span>),<span class="hljs-number">0</span>);
        pageNo+=<span class="hljs-number">1</span>;

        <span class="hljs-comment">//1.获取请求的参数==封装成为Book对象</span>
        Book book = WebUtils.copyParmToBean(req.getParameterMap(), <span class="hljs-keyword">new</span> Book());

        <span class="hljs-comment">//2.调用BookService.addBook()保存图书</span>
        bookService.addBook(book);

        <span class="hljs-comment">//3.跳出图书列表页面</span>
        <span class="hljs-comment">//  /manager/bookServlet?action=list</span>

        <span class="hljs-comment">//这里跳转要用重定向，不能用请求转发，会有bug，F5刷新，会一直添加</span>
        resp.sendRedirect(req.getContextPath() + <span class="hljs-string">"/manager/bookServlet?action=page&amp;pageNo="</span> + pageNo);

    &#125;</code></pre></div>

<h6 id="1-5-3-4、修改-book-edit-jsp-页面"><a href="#1-5-3-4、修改-book-edit-jsp-页面" class="headerlink" title="1.5.3.4、修改 book_edit.jsp 页面"></a>1.5.3.4、修改 book_edit.jsp 页面</h6><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">%@</span> <span class="hljs-attr">page</span> <span class="hljs-attr">contentType</span>=<span class="hljs-string">"text/html;charset=UTF-8"</span> <span class="hljs-attr">language</span>=<span class="hljs-string">"java"</span> %&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"cmn-hans"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>编辑图书<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>

	<span class="hljs-tag">&lt;<span class="hljs-name">%--</span>  静态包含<span class="hljs-attr">base</span>标签,<span class="hljs-attr">css</span>样式,<span class="hljs-attr">jQuery</span>文件 <span class="hljs-attr">--</span>%&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">%@include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"/pages/common/head.jsp"</span>%&gt;</span>

	<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/css"</span>&gt;</span>
	h1 &#123;
		text-align: center;
		margin-top: 200px;
	&#125;
	
	h1 a &#123;
<span class="css">		<span class="hljs-selector-tag">color</span><span class="hljs-selector-pseudo">:red</span>;</span>
	&#125;
	
	input &#123;
		text-align: center;
	&#125;
<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"header"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"logo_img"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"../../static/img/logo.gif"</span> &gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"wel_word"</span>&gt;</span>编辑图书<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>

			<span class="hljs-tag">&lt;<span class="hljs-name">%--</span> 静态包含<span class="hljs-attr">manager</span>管理，模块的菜单<span class="hljs-attr">--</span>%&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">%@include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"/pages/common/manager_menu.jsp"</span>%&gt;</span>

		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
		
		<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"main"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"manager/bookServlet"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> &gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pageNo"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;param.pageNo&#125;"</span> /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"action"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;empty param.id ? "</span><span class="hljs-attr">add</span>"<span class="hljs-attr">:</span>"<span class="hljs-attr">update</span>"&#125;" /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.id&#125;"</span> /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>名称<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>价格<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>作者<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>销量<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>库存<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">"2"</span>&gt;</span>操作<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
					<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>		
					<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.name&#125;"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"price"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.price&#125;"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"author"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.author&#125;"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sales"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.sales&#125;"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"stock"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.stock&#125;"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"提交"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
					<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>	
				<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
			
	
		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>


		<span class="hljs-tag">&lt;<span class="hljs-name">%--</span>	静态包含页脚内容<span class="hljs-attr">--</span>%&gt;</span>
		<span class="hljs-tag">&lt;<span class="hljs-name">%@include</span> <span class="hljs-attr">file</span>=<span class="hljs-string">"/pages/common/footer.jsp"</span>%&gt;</span>


<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre></div>

<h5 id="1-5-4、删除图书功能的实现"><a href="#1-5-4、删除图书功能的实现" class="headerlink" title="1.5.4、删除图书功能的实现"></a>1.5.4、删除图书功能的实现</h5><h6 id="1-5-4-1、图解删除流程："><a href="#1-5-4-1、图解删除流程：" class="headerlink" title="1.5.4.1、图解删除流程："></a>1.5.4.1、图解删除流程：</h6><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599318222162.png" srcset="/img/loading.gif" alt="59931822216"></p>
<h6 id="1-5-4-2、BookServlet-程序中的-delete-方法："><a href="#1-5-4-2、BookServlet-程序中的-delete-方法：" class="headerlink" title="1.5.4.2、BookServlet 程序中的 delete 方法："></a>1.5.4.2、BookServlet 程序中的 delete 方法：</h6><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        <span class="hljs-comment">//1.获取请求的参数id，图书编号</span>
        <span class="hljs-keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="hljs-string">"id"</span>),<span class="hljs-number">0</span>);

        <span class="hljs-comment">//2.调用bookServlet.deleteBookById();删除图书</span>
        bookService.deleteBookById(id);

        <span class="hljs-comment">//3.重定向回图书列表管理页面</span>
        resp.sendRedirect(req.getContextPath() + <span class="hljs-string">"/manager/bookServlet?action=page&amp;pageNo="</span> + req.getParameter(<span class="hljs-string">"pageNo"</span>));

    &#125;</code></pre></div>

<h6 id="1-5-4-3、给-WebUtils-工具类添加转换-int-类型的工具方法"><a href="#1-5-4-3、给-WebUtils-工具类添加转换-int-类型的工具方法" class="headerlink" title="1.5.4.3、给 WebUtils 工具类添加转换 int 类型的工具方法"></a>1.5.4.3、给 WebUtils 工具类添加转换 int 类型的工具方法</h6><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">     * 将字符串转换为int类型的</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> strInt</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@param</span> defaultValue</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">parseInt</span><span class="hljs-params">(String strInt,<span class="hljs-keyword">int</span> defaultValue)</span></span>&#123;
        <span class="hljs-keyword">if</span> (strInt == <span class="hljs-keyword">null</span>)&#123;<span class="hljs-comment">//前台客户端传参一定会是null,null转integer会报错</span>
            <span class="hljs-keyword">return</span> defaultValue;
        &#125;

        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">return</span> Integer.parseInt(strInt);
        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
            <span class="hljs-comment">//e.printStackTrace();</span>

        &#125;

        <span class="hljs-keyword">return</span> defaultValue;
    &#125;</code></pre></div>

<h6 id="1-5-4-4、修改删除的连接地址："><a href="#1-5-4-4、修改删除的连接地址：" class="headerlink" title="1.5.4.4、修改删除的连接地址："></a>1.5.4.4、修改删除的连接地址：</h6><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599318397681.png" srcset="/img/loading.gif" alt="59931839768"></p>
<h6 id="1-5-4-5、给删除添加确认提示操作："><a href="#1-5-4-5、给删除添加确认提示操作：" class="headerlink" title="1.5.4.5、给删除添加确认提示操作："></a>1.5.4.5、给删除添加确认提示操作：</h6><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span>
<span class="javascript">    $(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span>
<span class="actionscript">        <span class="hljs-comment">// 给删除的a 标签绑定单击事件，用于删除的确认提示操作</span></span>
<span class="javascript">        $(<span class="hljs-string">"a.deleteClass"</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span>
<span class="actionscript">        <span class="hljs-comment">// 在事件的function 函数中，有一个this 对象。这个this 对象，是当前正在响应事件的dom 对象。</span></span>
        /**
        * confirm 是确认提示框函数
        * 参数是它的提示内容
        * 它有两个按钮，一个确认，一个是取消。
<span class="actionscript">        * 返回<span class="hljs-literal">true</span> 表示点击了，确认，返回<span class="hljs-literal">false</span> 表示点击取消。</span>
        */
<span class="javascript">        <span class="hljs-keyword">return</span> confirm(<span class="hljs-string">"你确定要删除【"</span> + $(<span class="hljs-keyword">this</span>).parent().parent().find(<span class="hljs-string">"td:first"</span>).text() + <span class="hljs-string">"】?"</span>); 	</span>
<span class="actionscript">           <span class="hljs-comment">// return false// 阻止元素的默认行为===不提交请求</span></span>
        &#125;);
    &#125;);
<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></code></pre></div>

<h5 id="1-5-5、修改图书功能的实现"><a href="#1-5-5、修改图书功能的实现" class="headerlink" title="1.5.5、修改图书功能的实现"></a>1.5.5、修改图书功能的实现</h5><h6 id="1-5-5-1：图解修改图书细节："><a href="#1-5-5-1：图解修改图书细节：" class="headerlink" title="1.5.5.1：图解修改图书细节："></a>1.5.5.1：图解修改图书细节：</h6><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599318493594.png" srcset="/img/loading.gif" alt="59931849359"></p>
<h6 id="1-5-5-2、更新【修改】的请求地址："><a href="#1-5-5-2、更新【修改】的请求地址：" class="headerlink" title="1.5.5.2、更新【修改】的请求地址："></a>1.5.5.2、更新【修改】的请求地址：</h6><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599318557768.png" srcset="/img/loading.gif" alt="59931855776"></p>
<h6 id="1-5-5-3、BookServlet-程序中添加-getBook-方法："><a href="#1-5-5-3、BookServlet-程序中添加-getBook-方法：" class="headerlink" title="1.5.5.3、BookServlet 程序中添加 getBook 方法："></a>1.5.5.3、BookServlet 程序中添加 getBook 方法：</h6><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getBook</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        <span class="hljs-comment">//1.获取请求的参数图书编号</span>
        <span class="hljs-keyword">int</span> id = WebUtils.parseInt(req.getParameter(<span class="hljs-string">"id"</span>),<span class="hljs-number">0</span>);
        <span class="hljs-comment">//2.调用bookServlet.queryBookId查询图书编号</span>
        Book book = bookService.queryBookById(id);
        <span class="hljs-comment">//3.保存图书到Request域中</span>
        req.setAttribute(<span class="hljs-string">"book"</span>,book);
        <span class="hljs-comment">//4.请求转发到 pages/manager/book_edit.jsp页面</span>
        req.getRequestDispatcher(<span class="hljs-string">"/pages/manager/book_edit.jsp"</span>).forward(req,resp);

    &#125;</code></pre></div>

<h6 id="1-5-5-4、在-book-edit-jsp-页面中显示修改的数据"><a href="#1-5-5-4、在-book-edit-jsp-页面中显示修改的数据" class="headerlink" title="1.5.5.4、在 book_edit.jsp 页面中显示修改的数据"></a>1.5.5.4、在 book_edit.jsp 页面中显示修改的数据</h6><div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"main"</span>&gt;</span>
			<span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">"manager/bookServlet"</span> <span class="hljs-attr">method</span>=<span class="hljs-string">"post"</span> &gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pageNo"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;param.pageNo&#125;"</span> /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"action"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;empty param.id ? "</span><span class="hljs-attr">add</span>"<span class="hljs-attr">:</span>"<span class="hljs-attr">update</span>"&#125;" /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"hidden"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.id&#125;"</span> /&gt;</span>
				<span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
					<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>名称<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>价格<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>作者<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>销量<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>库存<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span> <span class="hljs-attr">colspan</span>=<span class="hljs-string">"2"</span>&gt;</span>操作<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
					<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>		
					<span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.name&#125;"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"price"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.price&#125;"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"author"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.author&#125;"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sales"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.sales&#125;"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"stock"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"$&#123;requestScope.book.stock&#125;"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
						<span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"提交"</span>/&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
					<span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>	
				<span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
			<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
			
	
		<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre></div>

<h6 id="1-5-5-5、在-BookServlet-程序中添加-update-方法："><a href="#1-5-5-5、在-BookServlet-程序中添加-update-方法：" class="headerlink" title="1.5.5.5、在 BookServlet 程序中添加 update 方法："></a>1.5.5.5、在 BookServlet 程序中添加 update 方法：</h6><div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="hljs-keyword">throws</span> ServletException, IOException </span>&#123;
        <span class="hljs-comment">//1.获取请求的参数==封装称为Book对象</span>
        Book book = WebUtils.copyParmToBean(req.getParameterMap(), <span class="hljs-keyword">new</span> Book());

        <span class="hljs-comment">//2.调用BookServlet.update</span>
        bookService.updateBook(book);

        <span class="hljs-comment">//3.重定向回图书列表管理页面</span>
        resp.sendRedirect(req.getContextPath() + <span class="hljs-string">"/manager/bookServlet?action=page&amp;pageNo="</span> + req.getParameter(<span class="hljs-string">"pageNo"</span>));

    &#125;</code></pre></div>

<h6 id="1-5-5-6、解决-book-edit-jsp页面，即要实现添加，又要实现修改操作"><a href="#1-5-5-6、解决-book-edit-jsp页面，即要实现添加，又要实现修改操作" class="headerlink" title="1.5.5.6、解决 book_edit.jsp页面，即要实现添加，又要实现修改操作"></a>1.5.5.6、解决 book_edit.jsp页面，即要实现添加，又要实现修改操作</h6><p><img src="/2020/09/05/%E4%B9%A6%E5%9F%8E%E9%A1%B9%E7%9B%AE%E5%89%8D%E7%AF%87/1599318761101.png" srcset="/img/loading.gif" alt="59931876110"></p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E9%A1%B9%E7%9B%AE%E7%AC%94%E8%AE%B0/">项目笔记</a>
                    
                  </div>
                
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/31/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF%E6%80%BB%E7%BB%93/">
                        <span class="hidden-mobile">学成在线：项目总结</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

代码块js 用不到，fulid自带有，添加css样式即可实现
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键字</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">载入天数...</span>
  <span id="times">载入时分秒...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//此处修改你的建站时间或者网站上线时间
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "本站勉强运行&nbsp"+dnum+"&nbsp天";
      document.getElementById("times").innerHTML = hnum + "&nbsp小时&nbsp" + mnum + "&nbsp分&nbsp" + snum + "&nbsp秒";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


    
  <!-- 备案信息 -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">京ICP证20000725号</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=20000725"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>京公网安备20000725号</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "书城项目前篇&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
