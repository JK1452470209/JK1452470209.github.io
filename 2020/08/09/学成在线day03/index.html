<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>å­¦æˆåœ¨çº¿day03ï¼šCMSé¡µé¢ç®¡ç†å¼€å‘ - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ç§äººåšå®¢</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äºæˆ‘
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-09 17:23">
      2020-08-09
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      9.2k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      135
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p>
</blockquote>
<p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day03</code> çš„å†…å®¹</p>
<ul>
<li>ä½¿ç”¨ <code>Spring data</code> æä¾›çš„ <code>PageRequest</code> æ¨¡å—è¿›è¡Œåˆ†é¡µæŸ¥è¯¢çš„åº”ç”¨</li>
<li>ä½¿ç”¨ <code>Spring data</code> æä¾› <code>MongoDB</code> çš„daoæ¥å£è¿›è¡Œå‰åç«¯è”è°ƒçš„ CRUD æ“ä½œ</li>
<li>åŸºäº <code>VUE.JS</code> çš„å‰ç«¯æ¨¡å—åŒ–å¼€å‘</li>
<li>ä½¿ç”¨ç»Ÿä¸€çš„å“åº”æ¨¡å‹ã€çŠ¶æ€ç è¿›è¡Œ <code>RESTful</code> é£æ ¼çš„APIå¼€å‘</li>
<li>ç†Ÿæ‚‰ä½¿ç”¨ <code>Swagger</code> è¿›è¡Œæ¥å£æ–‡æ¡£çš„ç”Ÿæˆä¸æµ‹è¯•</li>
<li>å¼‚å¸¸å¤„ç†ä»¥åŠå¦‚ä½•è‡ªå®šä¹‰å¼‚å¸¸ï¼Œæ ¹æ®ä¸åŒçš„å¼‚å¸¸è‡ªå®šä¹‰è¿”å›çš„æ¶ˆæ¯æ ¼å¼ã€‚</li>
</ul>
<h1 id="ä¸€ã€è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢"><a href="#ä¸€ã€è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="ä¸€ã€è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢"></a>ä¸€ã€è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>åœ¨é¡µé¢è¾“å…¥æŸ¥è¯¢æ¡ä»¶ï¼ŒæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„é¡µé¢ä¿¡æ¯ã€‚</p>
<p>æŸ¥è¯¢æ¡ä»¶å¦‚ä¸‹ï¼š</p>
<p>ç«™ç‚¹Idï¼šç²¾ç¡®åŒ¹é…</p>
<p>æ¨¡æ¿Idï¼šç²¾ç¡®åŒ¹é…</p>
<p>é¡µé¢åˆ«åï¼šæ¨¡ç³ŠåŒ¹é…</p>
<h2 id="2-æœåŠ¡ç«¯"><a href="#2-æœåŠ¡ç«¯" class="headerlink" title="2.æœåŠ¡ç«¯"></a>2.æœåŠ¡ç«¯</h2><h3 id="Daoå±‚"><a href="#Daoå±‚" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h3><p>ä½¿ç”¨ <code>CmsPageRepository</code> ä¸­çš„ <code>findAll(Example&lt;S&gt; var1, Pageable var2)</code> æ–¹æ³•å®ç°ï¼Œæ— éœ€å®šä¹‰ã€‚</p>
<h3 id="å•å…ƒæµ‹è¯•"><a href="#å•å…ƒæµ‹è¯•" class="headerlink" title="å•å…ƒæµ‹è¯•"></a>å•å…ƒæµ‹è¯•</h3><p>ä¸‹è¾¹æµ‹è¯•findAllæ–¹æ³•å®ç°è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢ï¼š</p>
<p>1ã€æŒ‡å®šç«™ç‚¹idã€æ¨¡æ¿idä½œä¸ºæŸ¥è¯¢æ¡ä»¶</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//è‡ªå®šä¹‰æ¡ä»¶æŸ¥è¯¢</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDiyFindAll</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-comment">//ç²¾ç¡®åŒ¹é…æ¡ä»¶å€¼</span>
    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();
    cmsPage.setSiteId(<span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>);
    cmsPage.setTemplateId(<span class="hljs-string">"5a925be7b00ffc4b3c1578b5"</span>);

    <span class="hljs-comment">//æ¡ä»¶åŒ¹é…å™¨,ç”¨äºæ¨¡ç³ŠåŒ¹é…</span>
    ExampleMatcher matching = ExampleMatcher.matching();

    <span class="hljs-comment">//æ¡ä»¶æŸ¥è¯¢å®ä¾‹</span>
    Example&lt;CmsPage&gt; example = Example.of(cmsPage, matching);

    <span class="hljs-comment">//åˆ†é¡µå‚æ•°</span>
    <span class="hljs-keyword">int</span> page = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> size = <span class="hljs-number">20</span>;
    Pageable pageable = PageRequest.of(page,size);

    <span class="hljs-comment">//è°ƒç”¨dao</span>
    Page&lt;CmsPage&gt; all = cmsPageRepository.findAll(example, pageable);
    List&lt;CmsPage&gt; content = all.getContent();
    System.out.println(content);
&#125;</code></pre></div>

<p>æŸ¥è¯¢ç»“æœ</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image1.png" srcset="/img/loading.gif" alt></p>
<p>åœ¨ä¸Šé¢çš„ä»£ç åŸºç¡€ä¸Šï¼Œå¢åŠ  <code>ExampleMatcher</code> å®ä¾‹çš„ä¸€äº›å±æ€§ä½œä¸ºæ¨¡ç³ŠæŸ¥è¯¢çš„å‚æ•°ï¼Œå¢åŠ çš„ä»£ç å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs java">cmsPage.setPageAliase(<span class="hljs-string">"è¯¦ç»†"</span>);
<span class="hljs-comment">//æ¡ä»¶åŒ¹é…å™¨,ç”¨äºæ¨¡ç³ŠåŒ¹é…</span>
ExampleMatcher matching = ExampleMatcher.matching()
       .withMatcher(<span class="hljs-string">"pageAliase"</span>,ExampleMatcher.GenericPropertyMatchers.contains());</code></pre></div>

<p><code>.withMatcher</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºè¦å°†å“ªä¸ªå­—æ®µè¿›è¡ŒåŒ¹é…ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯è¦ä½¿ç”¨çš„åŒ¹é…å™¨ï¼›</p>
<p><code>ExampleMatcher.GenericPropertyMatchers</code> æœ‰å¤šä¸ªåŒ¹é…å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨ <code>.contains()</code> è¿›è¡Œæ¨¡ç³ŠåŒ¹é…</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image2" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image2.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="Serviceå±‚"><a href="#Serviceå±‚" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
CmsPageRepository cmsPageRepository;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * åˆ†é¡µæŸ¥è¯¢</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page é¡µå·</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> size æ¯é¡µå¤§å°</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> queryPageRequest æŸ¥è¯¢æ¡ä»¶</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page,<span class="hljs-keyword">int</span> size,QueryPageRequest queryPageRequest)</span> </span>&#123;
    <span class="hljs-comment">//åˆ¤æ–­æ¡ä»¶å¯¹è±¡æ˜¯å¦ä¸ºç©º</span>
    <span class="hljs-keyword">if</span>(queryPageRequest == <span class="hljs-keyword">null</span>)&#123;
        queryPageRequest = <span class="hljs-keyword">new</span> QueryPageRequest();
    &#125;

    <span class="hljs-comment">//åŒ¹é…æ¡ä»¶å€¼</span>
    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();

    <span class="hljs-comment">//è®¾ç½®æ¡ä»¶å€¼</span>
    <span class="hljs-comment">//ç«™ç‚¹ID</span>
    <span class="hljs-keyword">if</span>(!StringUtil.isNullOrEmpty(queryPageRequest.getSiteId()))&#123;
        cmsPage.setSiteId(queryPageRequest.getSiteId());
    &#125;
    <span class="hljs-comment">//æ¨¡æ¿ID</span>
    <span class="hljs-keyword">if</span>(!StringUtil.isNullOrEmpty(queryPageRequest.getTemplateId()))&#123;
        cmsPage.setTemplateId(queryPageRequest.getTemplateId());
    &#125;

    <span class="hljs-comment">//ç«™ç‚¹åˆ«å</span>
    <span class="hljs-keyword">if</span>(!StringUtil.isNullOrEmpty(queryPageRequest.getPageAliase()))&#123;
        cmsPage.setPageAliase(queryPageRequest.getPageAliase());
    &#125;

    <span class="hljs-comment">//æ¡ä»¶åŒ¹é…å™¨ï¼Œç”¨äºæ¨¡ç³ŠæŸ¥è¯¢</span>
    ExampleMatcher exampleMatcher = ExampleMatcher.matching()
            .withMatcher(<span class="hljs-string">"pageAliase"</span>, ExampleMatcher.GenericPropertyMatchers.contains());


    <span class="hljs-comment">//æ¡ä»¶æŸ¥è¯¢å®ä¾‹</span>
    Example&lt;CmsPage&gt; example = Example.of(cmsPage, exampleMatcher);

    <span class="hljs-comment">//è¿‡æ»¤æ¡ä»¶</span>
    <span class="hljs-keyword">if</span>(page &lt;= <span class="hljs-number">0</span>)&#123;
        page = <span class="hljs-number">1</span>;
    &#125;
    <span class="hljs-keyword">if</span>(size &lt;= <span class="hljs-number">0</span>)&#123;
        size = <span class="hljs-number">10</span>;
    &#125;
    page = page - <span class="hljs-number">1</span>;

    <span class="hljs-comment">//åˆ›å»ºåˆ†é¡µæŸ¥è¯¢å‚æ•°</span>
    PageRequest pageable = PageRequest.of(page, size);

    <span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢æ•°æ®</span>
    Page&lt;CmsPage&gt; all = cmsPageRepository.findAll(example, pageable);

    <span class="hljs-comment">//æ•´ç†æŸ¥è¯¢åˆ°çš„æ•°æ®</span>
    QueryResult queryResult = <span class="hljs-keyword">new</span> QueryResult();
    queryResult.setList(all.getContent());
    queryResult.setTotal(all.getTotalElements());

    <span class="hljs-comment">//è¿”å›ç»“æœ</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult(CommonCode.SUCCESS,queryResult);
&#125;</code></pre></div>

<p>Controllerå±‚æ— éœ€ä¿®æ”¹</p>
<h3 id="ä½¿ç”¨SwaggerUIæµ‹è¯•"><a href="#ä½¿ç”¨SwaggerUIæµ‹è¯•" class="headerlink" title="ä½¿ç”¨SwaggerUIæµ‹è¯•"></a>ä½¿ç”¨SwaggerUIæµ‹è¯•</h3><p>å‚æ•°</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image3.png" srcset="/img/loading.gif" alt="img"></p>
<p>æŸ¥è¯¢ç»“æœ</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image4.png" srcset="/img/loading.gif" alt="img"></p>
<p>ä»æŸ¥è¯¢ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ ¹æ®æˆ‘ä»¬è¾“å…¥çš„æ¡ä»¶ï¼ŒæŸ¥è¯¢åˆ°äº†æŒ‡å®š <code>sizeId</code> å¹¶ä¸” <code>pageAliase</code> åŒ…å«é¢„è§ˆçš„ä¿¡æ¯ã€‚</p>
<h2 id="3-å‰ç«¯"><a href="#3-å‰ç«¯" class="headerlink" title="3. å‰ç«¯"></a>3. å‰ç«¯</h2><h3 id="é¡µé¢"><a href="#é¡µé¢" class="headerlink" title="é¡µé¢"></a>é¡µé¢</h3><p>1ã€å¢åŠ æŸ¥è¯¢è¡¨å•</p>
<blockquote>
<p>åœ¨el-tableä¸Šæ–¹æ·»åŠ è¯¥è¡¨å•</p>
</blockquote>
<div class="hljs"><pre><code class="hljs vue">&lt;!--æŸ¥è¯¢è¡¨å•--&gt;
&lt;el-form :model&#x3D;&quot;params&quot;&gt;
  &lt;el-select v-model&#x3D;&quot;params.siteId&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©ç«™ç‚¹&quot;&gt;
    &lt;el-option
    v-for&#x3D;&quot;item in siteList&quot;
    :key&#x3D;&quot;item.siteId&quot;
    :label&#x3D;&quot;item.siteName&quot;
    :value&#x3D;&quot;item.siteId&quot;&gt;
    &lt;&#x2F;el-option&gt;
  &lt;&#x2F;el-select&gt;
  é¡µé¢åˆ«å: &lt;el-input v-model&#x3D;&quot;params.pageAliase&quot; style&#x3D;&quot;width: 100px&quot;&gt;&lt;&#x2F;el-input&gt;
&lt;el-button type&#x3D;&quot;primary&quot; v-on:click&#x3D;&quot;query&quot; size&#x3D;&quot;small&quot;&gt;æŸ¥è¯¢&lt;&#x2F;el-button&gt;
&lt;&#x2F;el-form&gt;</code></pre></div>

<p>2ã€æ–°å¢æ•°æ®æ¨¡å‹å¯¹è±¡</p>
<div class="hljs"><pre><code class="hljs js">data() &#123;
  <span class="hljs-keyword">return</span> &#123;
    siteList:[],<span class="hljs-comment">//ç«™ç‚¹åˆ—è¡¨</span>
    list:[],
    total:<span class="hljs-number">0</span>,
    params:&#123;
      siteId:<span class="hljs-string">''</span>,
      pageAliase:<span class="hljs-string">''</span>,
      page:<span class="hljs-number">1</span>,<span class="hljs-comment">//é¡µç </span>
      size:<span class="hljs-number">10</span><span class="hljs-comment">//æ¯é¡µæ˜¾ç¤ºä¸ªæ•°</span>
    &#125;
  &#125;
&#125;,</code></pre></div>

<p>3ã€åœ¨é’©å­æ–¹æ³•ä¸­ è·å– <code>siteList</code> ç«™ç‚¹åˆ—è¡¨ï¼ˆè¿™é‡Œæš‚æ—¶ç”¨é™æ€æ•°æ®ä»£æ›¿ï¼‰</p>
<div class="hljs"><pre><code class="hljs js">mounted() &#123;
  <span class="hljs-comment">//é»˜è®¤æŸ¥è¯¢é¡µé¢</span>
  <span class="hljs-keyword">this</span>.query()
  <span class="hljs-comment">//åˆå§‹åŒ–ç«™ç‚¹åˆ—è¡¨</span>
  <span class="hljs-keyword">this</span>.siteList = [
    &#123;
      siteId:<span class="hljs-string">'5a751fab6abb5044e0d19ea1'</span>,
      siteName:<span class="hljs-string">'é—¨æˆ·ä¸»ç«™'</span>
    &#125;,
    &#123;
      siteId:<span class="hljs-string">'102'</span>,
      siteName:<span class="hljs-string">'æµ‹è¯•ç«™'</span>
    &#125;
  ]
&#125;,</code></pre></div>

<h3 id="APIè°ƒç”¨"><a href="#APIè°ƒç”¨" class="headerlink" title="APIè°ƒç”¨"></a>APIè°ƒç”¨</h3><p>1ã€å‘æœåŠ¡ç«¯ä¼ é€’æŸ¥è¯¢æ¡ä»¶ï¼Œä¿®æ”¹ cms.jsï¼Œå¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//publicæ˜¯å¯¹axiosçš„å·¥å…·ç±»å°è£…ï¼Œå®šä¹‰äº†httpè¯·æ±‚æ–¹æ³•</span>
<span class="hljs-keyword">import</span> http from <span class="hljs-string">'./../../../base/api/public'</span>  <span class="hljs-comment">//ES6 å¯¼å…¥</span>
<span class="hljs-keyword">import</span> querystring from <span class="hljs-string">"querystring"</span>
let sysConfig = require(<span class="hljs-string">'@/../config/sysConfig'</span>)
let apiUrl = sysConfig.xcApiUrlPre
<span class="hljs-comment">//é¡µé¢æŸ¥è¯¢</span>
export <span class="hljs-keyword">const</span> page_list = (page,size,params) =&gt; &#123;

  <span class="hljs-comment">//å°†jsonå¯¹è±¡è½¬æˆkey/valueå¯¹</span>
  let queryString = querystring.stringify(params);
  <span class="hljs-comment">//å®šä¹‰æ–¹æ³•ï¼Œè¯·æ±‚æœåŠ¡ç«¯æŸ¥è¯¢æ¥å£</span>
  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl + <span class="hljs-string">'/cms/page/list/'</span>+page+<span class="hljs-string">'/'</span>+ size +<span class="hljs-string">'?'</span> + queryString)
&#125;</code></pre></div>

<p>2ã€é¡µé¢è°ƒç”¨apiæ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æŸ¥è¯¢</span>
query:function () &#123;
  <span class="hljs-comment">//è°ƒç”¨æœåŠ¡ç«¯æ¥å£</span>
  cmsApi.page_list(<span class="hljs-keyword">this</span>.params.page, <span class="hljs-keyword">this</span>.params.size, <span class="hljs-keyword">this</span>.params).then((res) =&gt;&#123;
    console.log(res)
    <span class="hljs-comment">//å°†resç»“æœæ•°æ®èµ‹å€¼ç»™æ•°æ®æ¨¡å‹å¯¹è±¡</span>
    <span class="hljs-keyword">this</span>.list = res.queryResult.list
    <span class="hljs-keyword">this</span>.total = res.queryResult.total
  &#125;)
&#125;</code></pre></div>

<p>3ã€æµ‹è¯•</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image5.png" srcset="/img/loading.gif" alt="img"></p>
<h1 id="äºŒã€æ–°å¢é¡µé¢"><a href="#äºŒã€æ–°å¢é¡µé¢" class="headerlink" title="äºŒã€æ–°å¢é¡µé¢"></a>äºŒã€æ–°å¢é¡µé¢</h1><h2 id="1-å‡†å¤‡å·¥ä½œï¼Œé¡µé¢ç®¡ç†API"><a href="#1-å‡†å¤‡å·¥ä½œï¼Œé¡µé¢ç®¡ç†API" class="headerlink" title="1.å‡†å¤‡å·¥ä½œï¼Œé¡µé¢ç®¡ç†API"></a>1.å‡†å¤‡å·¥ä½œï¼Œé¡µé¢ç®¡ç†API</h2><p>åœ¨é…ç½®æ–°å¢é¡µé¢çš„åŠŸèƒ½ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆé…ç½®ä¸€ä¸ªæ¥å£ï¼Œç”¨äºè·å–é¡µé¢çš„ä¿¡æ¯</p>
<h3 id="Daoå±‚-1"><a href="#Daoå±‚-1" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h3><p>CmsPageRepository</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ç»§æ‰¿MongoDBè‡ªå¸¦çš„Repository</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  22:36</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsPage</span>,<span class="hljs-title">String</span>&gt; </span>&#123;
&#125;</code></pre></div>



<h3 id="å®šä¹‰æŸ¥è¯¢æ¨¡å‹"><a href="#å®šä¹‰æŸ¥è¯¢æ¨¡å‹" class="headerlink" title="å®šä¹‰æŸ¥è¯¢æ¨¡å‹"></a>å®šä¹‰æŸ¥è¯¢æ¨¡å‹</h3><p>QueryPageRequest</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.cms.request;

<span class="hljs-keyword">import</span> io.swagger.annotations.ApiModelProperty;
<span class="hljs-keyword">import</span> lombok.Data;



<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  21:13</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryPageRequest</span> </span>&#123;
    <span class="hljs-comment">//æ¥æ”¶é¡µé¢æŸ¥è¯¢çš„æŸ¥è¯¢æ¡ä»¶</span>
    <span class="hljs-comment">//ç«™ç‚¹id</span>
    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"ç«™ç‚¹id"</span>)
    <span class="hljs-keyword">private</span> String siteId;
    <span class="hljs-comment">//é¡µé¢id</span>
    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"é¡µé¢id"</span>)
    <span class="hljs-keyword">private</span> String pageId;
    <span class="hljs-comment">//é¡µé¢åç§°</span>
    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"é¡µé¢åç§°"</span>)
    <span class="hljs-keyword">private</span> String pageName;
    <span class="hljs-comment">//åˆ«å</span>
    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"åˆ«å"</span>)
    <span class="hljs-keyword">private</span> String pageAliase;
    <span class="hljs-comment">//æ¨¡æ¿id</span>
    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"æ¨¡æ¿id"</span>)
    <span class="hljs-keyword">private</span> String templateId;
    <span class="hljs-comment">//...</span>


&#125;</code></pre></div>

<h3 id="å®šä¹‰å“åº”æ¨¡å‹"><a href="#å®šä¹‰å“åº”æ¨¡å‹" class="headerlink" title="å®šä¹‰å“åº”æ¨¡å‹"></a>å®šä¹‰å“åº”æ¨¡å‹</h3><p>CmsPageResult</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPageResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;
    CmsPage cmsPage;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CmsPageResult</span><span class="hljs-params">(ResultCode resultCode,CmsPage cmsPage)</span> </span>&#123;
        <span class="hljs-keyword">super</span>(resultCode);
        <span class="hljs-keyword">this</span>.cmsPage = cmsPage;
    &#125;
&#125;</code></pre></div>

<h3 id="Serviceå±‚-1"><a href="#Serviceå±‚-1" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h3><p>PageService</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    CmsPageRepository cmsPageRepository;
    
&#125;</code></pre></div>

<h3 id="Controllerå±‚"><a href="#Controllerå±‚" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h3><p>å®šä¹‰é¡µé¢ç›¸å…³æ“ä½œçš„api</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  21:16</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Api</span>(value = <span class="hljs-string">"cmsé¡µé¢ç®¡ç†æ¥å£"</span>,description = <span class="hljs-string">"cmsé¡µé¢ç®¡ç†æ¥å£ï¼Œæä¾›é¡µé¢çš„å¢ï¼Œåˆ ï¼Œæ”¹ï¼ŒæŸ¥"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageControllerApi</span> </span>&#123;
    <span class="hljs-comment">//é¡µé¢æŸ¥è¯¢</span>
    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"åˆ†é¡µæŸ¥è¯¢é¡µé¢åˆ—è¡¨"</span>)
    <span class="hljs-meta">@ApiImplicitParams</span>(&#123;
            <span class="hljs-meta">@ApiImplicitParam</span>(name = <span class="hljs-string">"page"</span>,value = <span class="hljs-string">"é¡µç "</span>,required = <span class="hljs-keyword">true</span>,paramType = <span class="hljs-string">"path"</span>,dataType = <span class="hljs-string">"int"</span>),
            <span class="hljs-meta">@ApiImplicitParam</span>(name = <span class="hljs-string">"size"</span>,value = <span class="hljs-string">"æ¯é¡µè®°å½•æ•°"</span>,required = <span class="hljs-keyword">true</span>,paramType = <span class="hljs-string">"path"</span>,dataType = <span class="hljs-string">"int"</span>)
    &#125;)
    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, QueryPageRequest queryPageRequest)</span></span>;
 &#125;</code></pre></div>

<p>CmsPageController</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.controller;

<span class="hljs-keyword">import</span> com.xuecheng.api.cms.CmsPageControllerApi;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.request.QueryPageRequest;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.response.CmsPageResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.service.PageService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;


<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  22:04</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/cms/page"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPageController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CmsPageControllerApi</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    PageService pageService;

    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/list/&#123;page&#125;/&#123;size&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"page"</span>)</span> <span class="hljs-keyword">int</span> page, </span>
<span class="hljs-function">               @<span class="hljs-title">PathVariable</span><span class="hljs-params">(<span class="hljs-string">"size"</span>)</span> <span class="hljs-keyword">int</span> size, QueryPageRequest queryPageRequest) </span>&#123;
           
        QueryResponseResult responseResult = pageService.findList(page, size, queryPageRequest);
        <span class="hljs-keyword">return</span> responseResult;
    &#125;</code></pre></div>



<p>æµ‹è¯•</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image6.png" srcset="/img/loading.gif" alt="img"></p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image7.png" srcset="/img/loading.gif" alt="img"></p>
<h2 id="2-åç«¯æ¥å£å®šä¹‰"><a href="#2-åç«¯æ¥å£å®šä¹‰" class="headerlink" title="2.åç«¯æ¥å£å®šä¹‰"></a>2.åç«¯æ¥å£å®šä¹‰</h2><h3 id="1ã€å®šä¹‰å“åº”æ¨¡å‹"><a href="#1ã€å®šä¹‰å“åº”æ¨¡å‹" class="headerlink" title="1ã€å®šä¹‰å“åº”æ¨¡å‹"></a>1ã€å®šä¹‰å“åº”æ¨¡å‹</h3><blockquote>
<p>ç”¨äºæ¥å£çš„å“åº”è§„èŒƒï¼Œç»§æ‰¿äºé¡¹ç›®ä¸­çš„ResponseResult</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPageResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;
    CmsPage cmsPage;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CmsPageResult</span><span class="hljs-params">(ResultCode resultCode,CmsPage cmsPage)</span> </span>&#123;
        <span class="hljs-keyword">super</span>(resultCode);
        <span class="hljs-keyword">this</span>.cmsPage = cmsPage;
	&#125;
&#125;</code></pre></div>

<h3 id="2ã€å®šä¹‰æ·»åŠ Api"><a href="#2ã€å®šä¹‰æ·»åŠ Api" class="headerlink" title="2ã€å®šä¹‰æ·»åŠ Api"></a>2ã€å®šä¹‰æ·»åŠ Api</h3><p>åœ¨ <code>CmsPageControllerApi</code> ä¸­æ–°å¢ <code>addCmsPage</code> æ¥å£</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ·»åŠ é¡µé¢æ•°æ®</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æ·»åŠ é¡µé¢æ•°æ®"</span>)
<span class="hljs-meta">@ApiImplicitParams</span>(&#123;
        <span class="hljs-meta">@ApiImplicitParam</span>(name=<span class="hljs-string">"cmsPage"</span>,value = <span class="hljs-string">"è¯·æäº¤jsonå½¢å¼çš„é¡µé¢æ•°æ®"</span>,required=<span class="hljs-keyword">true</span>,paramType=<span class="hljs-string">"CmsPage"</span>,dataType=<span class="hljs-string">"CmsPage"</span>),
&#125;)
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span></span>;</code></pre></div>

<h2 id="3-æœåŠ¡ç«¯å¼€å‘"><a href="#3-æœåŠ¡ç«¯å¼€å‘" class="headerlink" title="3. æœåŠ¡ç«¯å¼€å‘"></a>3. æœåŠ¡ç«¯å¼€å‘</h2><h3 id="1ã€é¡µé¢å”¯ä¸€å€¼ç´¢å¼•"><a href="#1ã€é¡µé¢å”¯ä¸€å€¼ç´¢å¼•" class="headerlink" title="1ã€é¡µé¢å”¯ä¸€å€¼ç´¢å¼•"></a>1ã€é¡µé¢å”¯ä¸€å€¼ç´¢å¼•</h3><blockquote>
<p>ä¸ºäº†ä¿è¯ç«™ç‚¹çš„å”¯ä¸€æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ ¹æ® sizeIdã€pageNameã€pageWebPath è¿™ä¸‰ä¸ªå­—æ®µæ¥å†³å®šç«™ç‚¹çš„æ•°æ®æ˜¯å¦å”¯ä¸€ã€‚</p>
</blockquote>
<p>å³é”® <code>cms_page</code> é›†åˆï¼Œé€‰æ‹© <code>Add Index</code> æ·»åŠ ä¸€ä¸ªç´¢å¼•</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image8" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image8.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ ¹æ®ä¸‹å›¾æ‰€ç¤ºï¼Œç‚¹å‡» <code>Add Field</code> æŒ‰é’®ï¼Œé€‰æ‹© sizeIdã€pageNameã€pageWebPath è¿™ä¸‰ä¸ªå­—æ®µï¼Œç„¶åç‚¹å‡»æ·»åŠ ï¼Œé€‰æ‹©ç¬¬ä¸‰æ­¥æ‰€ç¤ºçš„ <code>Unique</code>ï¼Œæœ€åç‚¹å‡»å³è¾¹çš„ <code>Create Index</code> åˆ›å»ºç´¢å¼•ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image9" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image9.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>åˆ›å»ºæˆåŠŸå</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image10" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image10.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="2ã€Daoå±‚"><a href="#2ã€Daoå±‚" class="headerlink" title="2ã€Daoå±‚"></a>2ã€Daoå±‚</h3><p>1ã€æ·»åŠ æ ¹æ®é¡µé¢åç§°ã€ç«™ç‚¹Idã€é¡µé¢webpathæŸ¥è¯¢é¡µé¢æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ç”¨äºæ ¡éªŒé¡µé¢æ˜¯å¦å­˜åœ¨</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ ¹æ®ç«™ç‚¹idã€ç«™ç‚¹åç§°ã€ç«™ç‚¹è·¯å¾„æ¥æŸ¥è¯¢ç«™ç‚¹ä¿¡æ¯</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> siteId</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageName</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageWebPath</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function">CmsPage <span class="hljs-title">findBySiteIdAndPageNameAndPageWebPath</span><span class="hljs-params">(String siteId, String pageName, String pageWebPath)</span></span>;</code></pre></div>

<p>2ã€ä½¿ç”¨ CmsPageRepositoryæä¾›çš„saveæ–¹æ³• ã€‚</p>
<h3 id="3ã€Serviceå±‚"><a href="#3ã€Serviceå±‚" class="headerlink" title="3ã€Serviceå±‚"></a>3ã€Serviceå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ·»åŠ é¡µé¢æ•°æ®</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span></span>&#123;
    <span class="hljs-comment">//éªŒè¯æ•°æ®å”¯ä¸€æ€§ï¼šsizeIdã€pageNameã€pageWebPath</span>
    CmsPage cmsPage1 = cmsPageRepository.findBySiteIdAndPageNameAndPageWebPath(cmsPage.getSiteId(), cmsPage.getPageName(), cmsPage.getPageWebPath());
    <span class="hljs-keyword">if</span>(cmsPage1 == <span class="hljs-keyword">null</span>)&#123;
        <span class="hljs-comment">//ç«™ç‚¹idç”±mongoDBè‡ªåŠ¨ç”Ÿæˆï¼Œé˜²æ­¢å‰ç«¯ä¼ å€¼</span>
        cmsPage.setPageId(<span class="hljs-keyword">null</span>);
        CmsPage save = cmsPageRepository.save(cmsPage);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS,save);
    &#125;
    <span class="hljs-comment">//æ·»åŠ å¤±è´¥</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL,cmsPage);
&#125;</code></pre></div>

<h3 id="4ã€Controllerå±‚"><a href="#4ã€Controllerå±‚" class="headerlink" title="4ã€Controllerå±‚"></a>4ã€Controllerå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/add"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(@RequestBody CmsPage cmsPage)</span> </span>&#123;
    <span class="hljs-keyword">return</span> pageService.addCmsPage(cmsPage);
&#125;</code></pre></div>

<h3 id="5ã€æ¥å£æµ‹è¯•"><a href="#5ã€æ¥å£æµ‹è¯•" class="headerlink" title="5ã€æ¥å£æµ‹è¯•"></a>5ã€æ¥å£æµ‹è¯•</h3><p>æˆ‘ä»¬åœ¨ <code>swagger</code> è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£æ¥å£ä¸­è¿›è¡Œæµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image11" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image11.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç¬¬ä¸€æ¬¡æ·»åŠ ï¼Œæ·»åŠ æˆåŠŸ</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image12" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image12.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç¬¬äºŒæ¬¡æ·»åŠ é‡å¤çš„å†…å®¹ï¼Œç”±äºå”¯ä¸€æ€§çš„æ•ˆéªŒï¼Œè¿”å›æ·»åŠ å¤±è´¥</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image13" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image13.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="4-å‰ç«¯å¼€å‘"><a href="#4-å‰ç«¯å¼€å‘" class="headerlink" title="4. å‰ç«¯å¼€å‘"></a>4. å‰ç«¯å¼€å‘</h2><h3 id="æ„å»ºæ–°å¢é¡µé¢"><a href="#æ„å»ºæ–°å¢é¡µé¢" class="headerlink" title="æ„å»ºæ–°å¢é¡µé¢"></a>æ„å»ºæ–°å¢é¡µé¢</h3><h4 id="1ã€é¡µé¢åˆ›å»º"><a href="#1ã€é¡µé¢åˆ›å»º" class="headerlink" title="1ã€é¡µé¢åˆ›å»º"></a>1ã€é¡µé¢åˆ›å»º</h4><p>ä½¿ç”¨Element-UIçš„formç»„ä»¶ç¼–å†™æ·»åŠ è¡¨å•å†…å®¹ï¼Œé¡µé¢æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image14.png" srcset="/img/loading.gif" alt="img"></p>
<p><strong>1ï¼‰åˆ›å»ºé¡µé¢</strong></p>
<p>åˆ›å»ºpage_add.vueé¡µé¢</p>
<p><strong>2ï¼‰é…ç½®è·¯ç”±</strong></p>
<p>åœ¨cmsæ¨¡å—çš„è·¯ç”±æ–‡ä»¶ä¸­é…ç½®â€œæ·»åŠ é¡µé¢â€çš„è·¯ç”±ï¼š</p>
<div class="hljs"><pre><code class="hljs vue">&#123;path:&#39;&#x2F;cms&#x2F;page&#x2F;add&#39;,name:&#39;æ–°å¢é¡µé¢&#39;,component: page_add,hidden:true&#125;</code></pre></div>

<p>æ³¨æ„ï¼šç”±äº â€œæ·»åŠ é¡µé¢â€ ä¸éœ€è¦æ˜¾ç¤ºä¸ºä¸€ä¸ªèœå•ï¼Œè¿™é‡Œ <code>hidden</code> è®¾ç½®ä¸º <code>true</code> éšè—èœå•ã€‚</p>
<p>æµ‹è¯•ï¼Œåœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥<a href="http://localhost:11000/#/cms/page/add" target="_blank" rel="noopener">http://localhost:11000/#/cms/page/add</a></p>
<p><strong>3ï¼‰â€œæ·»åŠ é¡µé¢â€ çš„æŒ‰é’®</strong></p>
<p>å®é™…æƒ…å†µæ˜¯ç”¨æˆ·è¿›å…¥é¡µé¢æŸ¥è¯¢åˆ—è¡¨ï¼Œç‚¹å‡»â€œæ–°å¢é¡µé¢â€æŒ‰é’®è¿›å…¥æ–°å¢é¡µé¢çª—å£ã€‚</p>
<p>åœ¨æŸ¥è¯¢æŒ‰é’®çš„æ—è¾¹æ·»åŠ ï¼š</p>
<div class="hljs"><pre><code class="hljs vue">&lt;routerâ€link class&#x3D;&quot;muiâ€tabâ€item&quot; :to&#x3D;&quot;&#123;path:&#39;&#x2F;cms&#x2F;page&#x2F;add&#x2F;&#39;&#125;&quot;&gt;
	&lt;elâ€button type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot;&gt;æ–°å¢é¡µé¢&lt;&#x2F;elâ€button&gt;
&lt;&#x2F;routerâ€link&gt;</code></pre></div>

<blockquote>
<p>router-linkæ˜¯vueæä¾›çš„è·¯ç”±åŠŸèƒ½ï¼Œç”¨äºåœ¨é¡µé¢ç”Ÿæˆè·¯ç”±é“¾æ¥ï¼Œæœ€ç»ˆåœ¨htmlæ¸²æŸ“åå°±æ˜¯&lt;aæ ‡ç­¾ã€‚<br>toï¼šç›®æ ‡è·¯ç”±åœ°å€</p>
</blockquote>
<p><strong>4ï¼‰å®Œå–„é¡µé¢å†…å®¹</strong></p>
<div class="hljs"><pre><code class="hljs vue">&lt;el-form :model&#x3D;&quot;pageForm&quot; label-width&#x3D;&quot;80px&quot;&gt;
  &lt;el-form-item label&#x3D;&quot;æ‰€å±ç«™ç‚¹&quot; prop&#x3D;&quot;siteId&quot;&gt;
    &lt;el-select v-model&#x3D;&quot;pageForm.siteId&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©ç«™ç‚¹&quot;&gt;
      &lt;el-option
        v-for&#x3D;&quot;item in siteList&quot;
        :key&#x3D;&quot;item.siteId&quot;
        :label&#x3D;&quot;item.siteName&quot;
        :value&#x3D;&quot;item.siteId&quot;&gt;
      &lt;&#x2F;el-option&gt;
    &lt;&#x2F;el-select&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;é€‰æ‹©æ¨¡ç‰ˆ&quot; prop&#x3D;&quot;templateId&quot;&gt;
    &lt;el-select v-model&#x3D;&quot;pageForm.templateId&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©&quot;&gt;
      &lt;el-option
        v-for&#x3D;&quot;item in templateList&quot;
        :key&#x3D;&quot;item.templateId&quot;
        :label&#x3D;&quot;item.templateName&quot;
        :value&#x3D;&quot;item.templateId&quot;&gt;
      &lt;&#x2F;el-option&gt;
    &lt;&#x2F;el-select&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;é¡µé¢åç§°&quot; prop&#x3D;&quot;pageName&quot;&gt;
    &lt;el-input v-model&#x3D;&quot;pageForm.pageName&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;åˆ«å&quot; prop&#x3D;&quot;pageAliase&quot;&gt;
    &lt;el-input v-model&#x3D;&quot;pageForm.pageAliase&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;è®¿é—®è·¯å¾„&quot; prop&#x3D;&quot;pageWebPath&quot;&gt;
    &lt;el-input v-model&#x3D;&quot;pageForm.pageWebPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;ç‰©ç†è·¯å¾„&quot; prop&#x3D;&quot;pagePhysicalPath&quot;&gt;
    &lt;el-input v-model&#x3D;&quot;pageForm.pagePhysicalPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;ç±»å‹&quot;&gt;
    &lt;el-radio-group v-model&#x3D;&quot;pageForm.pageType&quot;&gt;
      &lt;el-radio label&#x3D;&quot;0&quot;&gt;é™æ€&lt;&#x2F;el-radio&gt;
      &lt;el-radio label&#x3D;&quot;1&quot;&gt;åŠ¨æ€&lt;&#x2F;el-radio&gt;
    &lt;&#x2F;el-radio-group&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot;&gt;
    &lt;el-date-picker type&#x3D;&quot;datetime&quot; placeholder&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot; v-model&#x3D;&quot;pageForm.pageCreateTime&quot;&gt;
    &lt;&#x2F;el-date-picker&gt;
  &lt;&#x2F;el-form-item&gt;
&lt;&#x2F;el-form&gt;
&lt;div slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;
  &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;addSubmit&quot;&gt;æäº¤&lt;&#x2F;el-button&gt;
&lt;&#x2F;div&gt;</code></pre></div>

<p>Form Attributesè¯´æ˜ï¼š</p>
<ul>
<li>model è¡¨å•æ•°æ®å¯¹è±¡</li>
<li>rules è¡¨å•éªŒè¯è§„åˆ™</li>
</ul>
<p>Form-Item Attributesè¯´æ˜ï¼š</p>
<ul>
<li>prop è¡¨å•åŸŸ model å­—æ®µï¼Œåœ¨ä½¿ç”¨ validateã€resetFields æ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œè¯¥å±æ€§æ˜¯å¿…å¡«çš„</li>
<li>label æ ‡ç­¾æ–‡æœ¬</li>
</ul>
<p>è¯¦æƒ…å±æ€§åŠäº‹ä»¶å‚è€ƒ <a href="http://element.eleme.io/#/zh-CN/component/form" target="_blank" rel="noopener">http://element.eleme.io/#/zh-CN/component/form</a></p>
<p><strong>5ï¼‰æ•°æ®å¯¹è±¡</strong></p>
<div class="hljs"><pre><code class="hljs js">  <span class="hljs-comment">//ç«™ç‚¹åˆ—è¡¨</span>
    siteList: [],
    <span class="hljs-comment">//æ¨¡ç‰ˆåˆ—è¡¨</span>
    templateList: [],
    <span class="hljs-comment">//æ–°å¢ç•Œé¢æ•°æ®</span>
    pageForm: &#123;
      siteId: <span class="hljs-string">''</span>,
      templateId: <span class="hljs-string">''</span>,
      pageName: <span class="hljs-string">''</span>,
      pageAliase: <span class="hljs-string">''</span>,
      pageWebPath: <span class="hljs-string">''</span>,
      pageParameter: <span class="hljs-string">''</span>,
      pagePhysicalPath: <span class="hljs-string">''</span>,
      pageType: <span class="hljs-string">'0'</span>,  <span class="hljs-comment">//é»˜è®¤é€‰ä¸­0</span>
      pageCreateTime: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
    &#125;
  &#125;
&#125;,
methods: &#123;
  addSubmit() &#123;
    alert(<span class="hljs-string">"æäº¤"</span>)
  &#125;,
&#125;</code></pre></div>

<p><strong>6ï¼‰ç«™ç‚¹åŠæ¨¡æ¿æ•°æ®</strong></p>
<p>å®šä¹‰è¯·æ±‚api</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//è·å–æ‰€æœ‰ç«™ç‚¹ä¿¡æ¯</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> site_list = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>&#123;
  <span class="hljs-keyword">return</span> http.requestGet(apiUrl + <span class="hljs-string">"/cms/site/list"</span>)
&#125;


<span class="hljs-comment">//è·å–æ‰€æœ‰æ¨¡æ¿ä¿¡æ¯</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> template_list = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>&#123;
  <span class="hljs-keyword">return</span> http.requestGet(apiUrl + <span class="hljs-string">"/cms/template/list"</span>)
&#125;</code></pre></div>

<blockquote>
<p>åœ¨createdé’©å­ä¸­å®šä¹‰ï¼ŒåŸè®²ä¹‰å†…ä½¿ç”¨çš„æ˜¯é™æ€æ•°æ®</p>
</blockquote>
<div class="hljs"><pre><code class="hljs js">created: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-comment">//åˆå§‹åŒ–ç«™ç‚¹æ•°æ®</span>
    cmsApi.site_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (res.success) &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"ç«™ç‚¹æ•°æ®"</span>,res)
            <span class="hljs-comment">//èµ‹å€¼ç»™ç«™ç‚¹ä¿¡æ¯åˆ—è¡¨</span>
            <span class="hljs-keyword">this</span>.siteList = res.queryResult.list
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"è·å–ç«™ç‚¹ä¿¡æ¯æ—¶å‘ç”Ÿäº†é”™è¯¯"</span>, res)
        &#125;
    &#125;)

    <span class="hljs-comment">//åˆå§‹åŒ–æ¨¡æ¿æ•°æ®</span>
    cmsApi.template_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (res.success) &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"æ¨¡æ¿æ•°æ®"</span>,res)
            <span class="hljs-comment">//èµ‹å€¼ç»™æ¨¡æ¿åˆ—è¡¨</span>
            <span class="hljs-keyword">this</span>.templateList = res.queryResult.list
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"è·å–æ¨¡æ¿ä¿¡æ¯æ—¶å‘ç”Ÿäº†é”™è¯¯"</span>, res)
        &#125;
    &#125;)
&#125;,</code></pre></div>

<p><strong>7ï¼‰æµ‹è¯•é¢„è§ˆ</strong></p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image15" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image15.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="2ã€æ·»åŠ è¿”å›"><a href="#2ã€æ·»åŠ è¿”å›" class="headerlink" title="2ã€æ·»åŠ è¿”å›"></a>2ã€æ·»åŠ è¿”å›</h4><blockquote>
<p>è¿›å…¥æ–°å¢é¡µé¢ååªèƒ½é€šè¿‡èœå•å†æ¬¡è¿›å…¥é¡µé¢åˆ—è¡¨ï¼Œå¯ä»¥åœ¨æ–°å¢é¡µé¢æ·»åŠ â€œè¿”å›â€æŒ‰é’®ï¼Œç‚¹å‡»è¿”å›æŒ‰é’®è¿”å›åˆ°é¡µé¢åˆ—è¡¨ã€‚</p>
</blockquote>
<ol>
<li>æ–°å¢é¡µé¢æŒ‰é’®å¸¦ä¸Šå‚æ•°</li>
</ol>
<div class="hljs"><pre><code class="hljs vue">&lt;router-link class&#x3D;&quot;mui-tab-item&quot;
             :to&#x3D;&quot;&#123;path:&#39;&#x2F;cms&#x2F;page&#x2F;add&#x2F;&#39;, query:&#123; page:this.params.page,siteId:this.params.siteId &#125;&#125;&quot;&gt;
  &lt;el-button type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot;&gt;æ–°å¢é¡µé¢&lt;&#x2F;el-button&gt;
&lt;&#x2F;router-link&gt;</code></pre></div>

<p>è¯´æ˜ï¼šqueryè¡¨ç¤ºåœ¨è·¯ç”±urlä¸Šå¸¦ä¸Šå‚æ•°</p>
<p>2ï¼‰å®šä¹‰è¿”å›æ–¹æ³•</p>
<p>åœ¨page_add.vueä¸Šå®šä¹‰è¿”å›æŒ‰é’®</p>
<div class="hljs"><pre><code class="hljs vue">&lt;elâ€button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;go_back&quot; &gt;è¿”å›&lt;&#x2F;elâ€button&gt;</code></pre></div>

<p>åœ¨page_add.vueä¸Šå®šä¹‰è¿”å›æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs js">go_back()&#123;
    <span class="hljs-keyword">this</span>.$router.push(&#123;
        path: <span class="hljs-string">'/cms/page/list'</span>, <span class="hljs-attr">query</span>: &#123;
        page: <span class="hljs-keyword">this</span>.$route.query.page,
        siteId:<span class="hljs-keyword">this</span>.$route.query.siteId
    &#125;
    &#125;)
&#125;</code></pre></div>

<p>è¯´æ˜ï¼šthis.$route.query è¡¨ç¤ºå–å‡ºè·¯ç”±ä¸Šçš„å‚æ•°åˆ—è¡¨ï¼Œæœ‰ä¸¤ä¸ªå–è·¯ç”±å‚æ•°çš„æ–¹æ³•ï¼š</p>
<blockquote>
<p>aã€é€šè¿‡åœ¨è·¯ç”±ä¸Šæ·»åŠ  key/value ä¸²ä½¿ç”¨ <code>this.$route.query</code> æ¥å–å‚æ•°ï¼Œä¾‹å¦‚ï¼š<code>/router1?id=123</code> , <code>/router1?id=456</code> å¯ä»¥é€šè¿‡ <code>this.$route.query.id</code> è·å–å‚æ•°idçš„å€¼ã€‚</p>
<p>bã€é€šè¿‡å°†å‚æ•°ä½œä¸ºè·¯ç”±ä¸€éƒ¨åˆ†è¿›è¡Œä¼ å‚æ•°ä½¿ç”¨ <code>this.$route.params</code> æ¥è·å–ï¼Œä¾‹å¦‚ï¼šå®šä¹‰çš„è·¯ç”±ä¸º <code>/router1/:id</code> ï¼Œè¯·æ±‚ <code>/router1/123</code> æ—¶å¯ä»¥é€šè¿‡ <code>this.$route.params.id</code> æ¥è·å–ï¼Œæ­¤ç§æƒ…å†µç”¨ <code>this.$route.query.id</code> æ˜¯æ‹¿ä¸åˆ°çš„ã€‚</p>
</blockquote>
<p>3ï¼‰æŸ¥è¯¢åˆ—è¡¨æ”¯æŒå›æ˜¾</p>
<p>è¿›å…¥æŸ¥è¯¢åˆ—è¡¨ï¼Œä»urlä¸­è·å–é¡µç å’Œç«™ç‚¹idå¹¶èµ‹å€¼ç»™æ•°æ®æ¨¡å‹å¯¹è±¡ï¼Œä»è€Œå®ç°é¡µé¢å›æ˜¾ã€‚</p>
<p>urlä¾‹å­ï¼š<a href="http://localhost:12000/#/cms/page/list?page=2&amp;siteId=5a751fab6abb5044e0d19ea1" target="_blank" rel="noopener">http://localhost:12000/#/cms/page/list?page=2&amp;siteId=5a751fab6abb5044e0d19ea1</a></p>
<div class="hljs"><pre><code class="hljs js">created() &#123;
    <span class="hljs-comment">//ä»è·¯ç”±ä¸Šè·å–å‚æ•°</span>
    <span class="hljs-keyword">this</span>.params.page = <span class="hljs-built_in">Number</span>.parseInt(<span class="hljs-keyword">this</span>.$route.query.page||<span class="hljs-number">1</span>);
    <span class="hljs-keyword">this</span>.params.siteId = <span class="hljs-keyword">this</span>.$route.query.siteId||<span class="hljs-string">''</span>;
    .....
&#125;</code></pre></div>

<blockquote>
<p>å°æŠ€å·§ï¼šä½¿ç”¨ ||è¿”å›ç¬¬ä¸€ä¸ªæœ‰æ•ˆå€¼</p>
</blockquote>
<h4 id="1-3ã€è¡¨å•éªŒè¯"><a href="#1-3ã€è¡¨å•éªŒè¯" class="headerlink" title="1.3ã€è¡¨å•éªŒè¯"></a>1.3ã€è¡¨å•éªŒè¯</h4><p>1ï¼‰é…ç½®æ ¡éªŒè§„åˆ™</p>
<p>Element-UIçš„Formç»„ä»¶æä¾›è¡¨å•æ ¡éªŒçš„æ–¹æ³•ï¼š</p>
<p>åœ¨formå±æ€§ä¸Šé…ç½®rulesï¼ˆè¡¨å•éªŒè¯è§„åˆ™ï¼‰</p>
<div class="hljs"><pre><code class="hljs vue">&lt;elâ€form :model&#x3D;&quot;pageForm&quot; :rules&#x3D;&quot;pageFormRules&quot; labelâ€width&#x3D;&quot;80px&quot; &gt;</code></pre></div>

<p>åœ¨æ•°æ®æ¨¡å‹ä¸­é…ç½®æ ¡éªŒè§„åˆ™ï¼š</p>
<div class="hljs"><pre><code class="hljs js">data() &#123;
    <span class="hljs-keyword">return</span> &#123;
        pageFormRules: &#123;
            siteId:[
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·é€‰æ‹©ç«™ç‚¹'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ],
            templateId:[
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·é€‰æ‹©æ¨¡ç‰ˆ'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ],
            pageName: [
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥é¡µé¢åç§°'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ],
            pageAliase: [
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥é¡µé¢åˆ«å'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ],
            pageWebPath: [
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥è®¿é—®è·¯å¾„'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ],
            pagePhysicalPath: [
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'è¯·è¾“å…¥ç‰©ç†è·¯å¾„'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ]
        &#125;,
    &#125;
&#125;</code></pre></div>

<p>æ›´å¤šçš„æ ¡éªŒè§„åˆ™å‚è€ƒ <a href="http://element.eleme.io/#/zh-CN/component/form" target="_blank" rel="noopener">http://element.eleme.io/#/zh-CN/component/form</a> ä¸­â€œè¡¨å•éªŒè¯â€çš„ä¾‹å­</p>
<p>2ï¼‰ç‚¹å‡»æäº¤æŒ‰é’®è§¦å‘æ ¡éªŒ</p>
<p>åœ¨formè¡¨å•ä¸Šæ·»åŠ  refå±æ€§ï¼ˆref=â€pageFormâ€ï¼‰åœ¨æ ¡éªŒæ—¶å¼•ç”¨æ­¤è¡¨å•å¯¹è±¡</p>
<div class="hljs"><pre><code class="hljs vue">&lt;elâ€form :model&#x3D;&quot;pageForm&quot; :rules&#x3D;&quot;pageFormRules&quot; labelâ€width&#x3D;&quot;80px&quot; ref&#x3D;&quot;pageForm&quot;&gt;</code></pre></div>

<p>åœ¨æäº¤è¡¨å•æ—¶æ‰§è¡Œæ ¡éªŒ</p>
<div class="hljs"><pre><code class="hljs js">addSubmit() &#123;
    <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (valid) &#123;
            alert(<span class="hljs-string">'æäº¤'</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            alert(<span class="hljs-string">'æ ¡éªŒå¤±è´¥'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        &#125;
    &#125;)
&#125;,</code></pre></div>

<p>æµ‹è¯•</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image16.png" srcset="/img/loading.gif" alt="img"></p>
<h3 id="APIè°ƒç”¨-1"><a href="#APIè°ƒç”¨-1" class="headerlink" title="APIè°ƒç”¨"></a>APIè°ƒç”¨</h3><h4 id="1ã€åœ¨cms-jsä¸­å®šä¹‰page-addæ–¹æ³•"><a href="#1ã€åœ¨cms-jsä¸­å®šä¹‰page-addæ–¹æ³•" class="headerlink" title="1ã€åœ¨cms.jsä¸­å®šä¹‰page_addæ–¹æ³•"></a>1ã€åœ¨cms.jsä¸­å®šä¹‰page_addæ–¹æ³•</h4><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_add = <span class="hljs-function"><span class="hljs-params">params</span> =&gt;</span>&#123;
  <span class="hljs-keyword">return</span> http.requestPost(apiUrl + <span class="hljs-string">"/cms/page/add"</span>,params)
&#125;</code></pre></div>

<h4 id="2ã€æ·»åŠ äº‹ä»¶"><a href="#2ã€æ·»åŠ äº‹ä»¶" class="headerlink" title="2ã€æ·»åŠ äº‹ä»¶"></a>2ã€æ·»åŠ äº‹ä»¶</h4><p>å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æäº¤è¡¨å•</span>
addSubmit()&#123;
  <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (valid) &#123;
      <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤æäº¤å—ï¼Ÿ'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
        cmsApi.page_add(<span class="hljs-keyword">this</span>.pageForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
          <span class="hljs-built_in">console</span>.log(res);
          <span class="hljs-keyword">if</span>(res.success)&#123;
            <span class="hljs-keyword">this</span>.$message(&#123;
              message: <span class="hljs-string">'æäº¤æˆåŠŸ'</span>,
              type: <span class="hljs-string">'success'</span>
          &#125;);
          <span class="hljs-keyword">this</span>.$refs[<span class="hljs-string">'pageForm'</span>].resetFields();
          &#125;<span class="hljs-keyword">else</span>&#123;
            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);
          &#125;
        &#125;);
      &#125;);
    &#125;
  &#125;)
&#125;,</code></pre></div>

<p>æœ¬åŠŸèƒ½ä½¿ç”¨åˆ°ä¸¤ä¸ªUIç»„ä»¶ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>element-ui</code> çš„ <code>message-box</code> ç»„ä»¶å¼¹å‡ºç¡®è®¤æäº¤çª—å£ï¼ˆ<a href="http://element.eleme.io/#/zhCN/component/message-box%EF%BC%89" target="_blank" rel="noopener">http://element.eleme.io/#/zhCN/component/message-boxï¼‰</a></li>
<li>ä½¿ç”¨ <code>message</code>ç»„ä»¶æç¤ºæ“ä½œç»“æœ ï¼ˆ<a href="http://element.eleme.io/#/zh-CN/component/message%EF%BC%89" target="_blank" rel="noopener">http://element.eleme.io/#/zh-CN/component/messageï¼‰</a></li>
</ul>
<h4 id="3ã€æµ‹è¯•"><a href="#3ã€æµ‹è¯•" class="headerlink" title="3ã€æµ‹è¯•"></a>3ã€æµ‹è¯•</h4><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image17.gif" srcset="/img/loading.gif" alt="img"></p>
<h1 id="ä¸‰ã€ä¿®æ”¹é¡µé¢"><a href="#ä¸‰ã€ä¿®æ”¹é¡µé¢" class="headerlink" title="ä¸‰ã€ä¿®æ”¹é¡µé¢"></a>ä¸‰ã€ä¿®æ”¹é¡µé¢</h1><p>ä¿®æ”¹é¡µé¢ç”¨æˆ·æ“ä½œæµç¨‹ï¼š</p>
<p>1ã€ç”¨æˆ·è¿›å…¥ä¿®æ”¹é¡µé¢ï¼Œåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºäº†ä¿®æ”¹é¡µé¢çš„ä¿¡æ¯</p>
<p>2ã€ç”¨æˆ·ä¿®æ”¹é¡µé¢çš„å†…å®¹ï¼Œç‚¹å‡»â€œæäº¤â€ï¼Œæç¤ºâ€œä¿®æ”¹æˆåŠŸâ€æˆ–â€œä¿®æ”¹å¤±è´¥â€</p>
<h2 id="1-åç«¯æ¥å£å®šä¹‰"><a href="#1-åç«¯æ¥å£å®šä¹‰" class="headerlink" title="1. åç«¯æ¥å£å®šä¹‰"></a>1. åç«¯æ¥å£å®šä¹‰</h2><p>ä¿®æ”¹é¡µé¢éœ€è¦å®šä¹‰çš„APIå¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ ¹æ®é¡µé¢idæŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>
    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"æ ¹æ®é¡µé¢idæŸ¥è¯¢é¡µé¢ä¿¡æ¯"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPage <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;

    <span class="hljs-comment">//ä¿®æ”¹é¡µé¢</span>
    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"ä¿®æ”¹é¡µé¢"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">edit</span><span class="hljs-params">(String id,CmsPage cmsPage)</span></span>;</code></pre></div>

<blockquote>
<p>æˆ‘ä»¬ä»å‰é¢å®šä¹‰çš„ findList ç”¨çš„æ˜¯ <code>QueryResponseResult</code> ä½œä¸ºå“åº”æ¨¡å‹ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬å®šä¹‰çš„ <code>CmsPageResult</code> ä½œä¸ºå“åº”æ¨¡å‹ï¼Œä¸¤è€…çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>æˆ‘ä¸ªäººçš„ç†è§£æ˜¯ï¼Œ<code>findList</code> æ˜¯åˆ†é¡µæŸ¥è¯¢å¹¶ä¸”è¿”å›äº†å¤šä¸ªå¯¹è±¡çš„ä¿¡æ¯ï¼Œè€Œ <code>findById</code> åˆ™æ˜¯æŸ¥è¯¢å•ä¸ªå¯¹è±¡çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ <code>CmsPageResult</code> ä½œä¸ºæ“ä½œæˆ–æŸ¥è¯¢å•ä¸ªå¯¹è±¡æ—¶çš„å“åº”æ¨¡å‹ï¼Œè€Œ <code>QueryResponseResult</code> åˆ™ä½œä¸ºæ“ä½œå¤šä¸ªå¯¹è±¡æ—¶çš„å“åº”æ¨¡å‹ã€‚</p>
</blockquote>
<p>è¯´æ˜ï¼šæäº¤æ•°æ®ä½¿ç”¨postã€putéƒ½å¯ä»¥ï¼Œåªæ˜¯æ ¹æ®httpæ–¹æ³•çš„è§„èŒƒï¼Œputæ–¹æ³•æ˜¯å¯¹æœåŠ¡å™¨æŒ‡å®šèµ„æºè¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨putæ–¹æ³•å¯¹é¡µé¢ä¿®æ”¹è¿›è¡Œä¿®æ”¹ã€‚</p>
<h2 id="2-æœåŠ¡ç«¯å¼€å‘"><a href="#2-æœåŠ¡ç«¯å¼€å‘" class="headerlink" title="2. æœåŠ¡ç«¯å¼€å‘"></a>2. æœåŠ¡ç«¯å¼€å‘</h2><h3 id="Daoå±‚-2"><a href="#Daoå±‚-2" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h3><p>ä½¿ç”¨ Spring Dataæä¾›çš„findByIdæ–¹æ³•å®Œæˆæ ¹æ®ä¸»é”®æŸ¥è¯¢ ã€‚<br>ä½¿ç”¨ Spring Dataæä¾›çš„saveæ–¹æ³•å®Œæˆæ•°æ®ä¿å­˜ ã€‚</p>
<h3 id="Serviceå±‚-2"><a href="#Serviceå±‚-2" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ ¹æ®é¡µé¢idæŸ¥è¯¢é¡µé¢</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPage <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span> </span>&#123;
        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(id);
        <span class="hljs-keyword">if</span> (optional.isPresent())&#123;
            CmsPage cmsPage = optional.get();
            <span class="hljs-keyword">return</span> cmsPage;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;

    <span class="hljs-comment">//ä¿®æ”¹é¡µé¢</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">edit</span><span class="hljs-params">(String id, CmsPage cmsPage)</span> </span>&#123;
        <span class="hljs-comment">//æ ¹æ®idä»æ•°æ®æŸ¥è¯¢é¡µé¢ä¿¡æ¯</span>
        CmsPage updateCmsPage = <span class="hljs-keyword">this</span>.findById(id);
        <span class="hljs-keyword">if</span> (updateCmsPage != <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-comment">//è®¾ç½®è¦ä¿®æ”¹çš„æ•°æ®</span>

            updateCmsPage.setTemplateId(cmsPage.getTemplateId());
            updateCmsPage.setSiteId(cmsPage.getSiteId());
            updateCmsPage.setPageAliase(cmsPage.getPageAliase());
            updateCmsPage.setPageName(cmsPage.getPageName());
            updateCmsPage.setPageWebPath(cmsPage.getPageWebPath());
            updateCmsPage.setPagePhysicalPath(cmsPage.getPagePhysicalPath());
            <span class="hljs-comment">//æäº¤ä¿®æ”¹</span>
            cmsPageRepository.save(updateCmsPage);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS,updateCmsPage);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);
    &#125;</code></pre></div>

<h3 id="Controllerå±‚-1"><a href="#Controllerå±‚-1" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/get/&#123;id&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPage <span class="hljs-title">findById</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id) </span>&#123;
        <span class="hljs-keyword">return</span> pageService.findById(id);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@PutMapping</span>(<span class="hljs-string">"/edit/&#123;id&#125;"</span>)<span class="hljs-comment">//putè¡¨ç¤ºæ›´æ–°</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">edit</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id,@RequestBody CmsPage cmsPage) </span>&#123;
        <span class="hljs-keyword">return</span> pageService.edit(id,cmsPage);
    &#125;</code></pre></div>

<h2 id="3-ä¿®æ”¹ï¼šå‰ç«¯å¼€å‘"><a href="#3-ä¿®æ”¹ï¼šå‰ç«¯å¼€å‘" class="headerlink" title="3. ä¿®æ”¹ï¼šå‰ç«¯å¼€å‘"></a>3. ä¿®æ”¹ï¼šå‰ç«¯å¼€å‘</h2><h3 id="é¡µé¢å¤„ç†æµç¨‹"><a href="#é¡µé¢å¤„ç†æµç¨‹" class="headerlink" title="é¡µé¢å¤„ç†æµç¨‹"></a>é¡µé¢å¤„ç†æµç¨‹</h3><blockquote>
<p>å¯ä»¥å‚è€ƒæ–°å¢çš„é€»è¾‘</p>
</blockquote>
<ol>
<li>è¿›å…¥é¡µé¢ï¼Œé€šè¿‡é’©å­æ–¹æ³•è¯·æ±‚æœåŠ¡ç«¯è·å–é¡µé¢ä¿¡æ¯ï¼Œå¹¶èµ‹å€¼ç»™æ•°æ®æ¨¡å‹å¯¹è±¡ã€‚</li>
<li>é¡µé¢ä¿¡æ¯é€šè¿‡æ•°æ®ç»‘å®šåœ¨è¡¨å•ä¸­æ˜¾ç¤ºã€‚</li>
<li>ç”¨æˆ·ä¿®æ”¹ä¿¡æ¯ç‚¹å‡» â€œæäº¤â€ è¯·æ±‚æœåŠ¡ç«¯ä¿®æ”¹é¡µé¢ä¿¡æ¯æ¥å£ã€‚</li>
</ol>
<h3 id="å‰ç«¯HTTP-APIæ„å»º"><a href="#å‰ç«¯HTTP-APIæ„å»º" class="headerlink" title="å‰ç«¯HTTP APIæ„å»º"></a>å‰ç«¯HTTP APIæ„å»º</h3><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æŸ¥è¯¢å•ä¸ªé¡µé¢ä¿¡æ¯</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_query = <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span>&#123;
  <span class="hljs-keyword">return</span> http.requestPut(apiUrl + <span class="hljs-string">"/cms/page/get/"</span> + id)
&#125;

<span class="hljs-comment">//æ›´æ–°æ¥å£</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_update = <span class="hljs-function">(<span class="hljs-params">id,params</span>) =&gt;</span>&#123;
  <span class="hljs-keyword">return</span> http.requestPut(apiUrl + <span class="hljs-string">"/cms/page/edit/"</span> + id,params)
&#125;

<span class="hljs-comment">//è·å–ç«™ç‚¹å’Œæ¨¡æ¿åˆ—è¡¨</span></code></pre></div>

<h3 id="æ·»åŠ é¡µé¢è·¯ç”±"><a href="#æ·»åŠ é¡µé¢è·¯ç”±" class="headerlink" title="æ·»åŠ é¡µé¢è·¯ç”±"></a>æ·»åŠ é¡µé¢è·¯ç”±</h3><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> page_update <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/cms/page/page_update.vue'</span>;
<span class="hljs-comment">//å­èœå•</span>
children: [
    &#123;
        path: <span class="hljs-string">'/cms/page/edit/:pageId'</span>, <span class="hljs-attr">name</span>:<span class="hljs-string">"ç¼–è¾‘é¡µé¢ä¿¡æ¯"</span>,<span class="hljs-attr">component</span>: page_edit, 	<span class="hljs-attr">hidden</span>:<span class="hljs-literal">true</span>
    &#125;,
]</code></pre></div>

<p>pathä¸­çš„ <code>:pageId</code> è¡¨ç¤ºåœ¨è·¯ç”±urlä¸­å®šä¹‰äº†ä¸€ä¸ªpageIdå˜é‡</p>
<h3 id="æ„å»ºå‰ç«¯é¡µé¢"><a href="#æ„å»ºå‰ç«¯é¡µé¢" class="headerlink" title="æ„å»ºå‰ç«¯é¡µé¢"></a>æ„å»ºå‰ç«¯é¡µé¢</h3><p>åœ¨ <code>page_list</code> é¡µé¢æ–°å¢ç¼–è¾‘æŒ‰é’®</p>
<div class="hljs"><pre><code class="hljs vue">&lt;el-table-column label&#x3D;&quot;ç¼–è¾‘&quot; width&#x3D;&quot;75&quot; fixed&#x3D;&quot;right&quot;&gt;
    &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
&lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;info&quot; @click&#x3D;&quot;toEdit(scope.row.pageId)&quot;&gt;ç¼–è¾‘&lt;&#x2F;el-button&gt;
    &lt;&#x2F;template&gt;
&lt;&#x2F;el-table-column&gt;</code></pre></div>

<p>å¢åŠ è·³è½¬edité¡µé¢çš„å‡½æ•°</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//è·³è½¬è‡³ç¼–è¾‘é¡µé¢</span>
toEdit(pageId)&#123;
  <span class="hljs-keyword">this</span>.$router.push(&#123;
    path:<span class="hljs-string">"/cms/page/edit/"</span> + pageId,
    query:&#123;
      page:<span class="hljs-keyword">this</span>.params.page,
      siteId:<span class="hljs-keyword">this</span>.params.siteId
    &#125;
  &#125;)
&#125;,</code></pre></div>

<p>ä½¿ç”¨ <code>scope</code> è·å–å½“å‰è¡Œæ•°æ®ä¸­çš„ <code>pageId</code> ä¼ å…¥ toEdit å‡½æ•°è¿›è¡Œé¡µé¢è·³è½¬</p>
<p>å®Œæˆ<code>page_edit.vue</code> é¡µé¢çš„åŸºæœ¬æ„é€ </p>
<div class="hljs"><pre><code class="hljs vue">&lt;template&gt;
  &lt;div&gt;
    &lt;el-form :model&#x3D;&quot;pageForm&quot; label-width&#x3D;&quot;80px&quot; :rules&#x3D;&quot;pageFormRules&quot; ref&#x3D;&quot;pageForm&quot;&gt;
      &lt;el-form-item label&#x3D;&quot;æ‰€å±ç«™ç‚¹&quot; prop&#x3D;&quot;siteId&quot;&gt;
        &lt;el-select v-model&#x3D;&quot;pageForm.siteId&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©ç«™ç‚¹&quot;&gt;
          &lt;el-option
            v-for&#x3D;&quot;item in siteList&quot;
            :key&#x3D;&quot;item.siteId&quot;
            :label&#x3D;&quot;item.siteName&quot;
            :value&#x3D;&quot;item.siteId&quot;&gt;
          &lt;&#x2F;el-option&gt;
        &lt;&#x2F;el-select&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;é€‰æ‹©æ¨¡ç‰ˆ&quot; prop&#x3D;&quot;templateId&quot;&gt;
        &lt;el-select v-model&#x3D;&quot;pageForm.templateId&quot; placeholder&#x3D;&quot;è¯·é€‰æ‹©&quot;&gt;
          &lt;el-option
            v-for&#x3D;&quot;item in templateList&quot;
            :key&#x3D;&quot;item.templateId&quot;
            :label&#x3D;&quot;item.templateName&quot;
            :value&#x3D;&quot;item.templateId&quot;&gt;
          &lt;&#x2F;el-option&gt;
        &lt;&#x2F;el-select&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;é¡µé¢åç§°&quot; prop&#x3D;&quot;pageName&quot;&gt;
        &lt;el-input v-model&#x3D;&quot;pageForm.pageName&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;åˆ«å&quot; prop&#x3D;&quot;pageAliase&quot;&gt;
        &lt;el-input v-model&#x3D;&quot;pageForm.pageAliase&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;è®¿é—®è·¯å¾„&quot; prop&#x3D;&quot;pageWebPath&quot;&gt;
        &lt;el-input v-model&#x3D;&quot;pageForm.pageWebPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;ç‰©ç†è·¯å¾„&quot; prop&#x3D;&quot;pagePhysicalPath&quot;&gt;
        &lt;el-input v-model&#x3D;&quot;pageForm.pagePhysicalPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;ç±»å‹&quot;&gt;
        &lt;el-radio-group v-model&#x3D;&quot;pageForm.pageType&quot;&gt;
          &lt;el-radio class&#x3D;&quot;radio&quot; label&#x3D;&quot;0&quot; &gt;é™æ€&lt;&#x2F;el-radio&gt;
          &lt;el-radio class&#x3D;&quot;radio&quot; label&#x3D;&quot;1&quot; &gt;åŠ¨æ€&lt;&#x2F;el-radio&gt;
        &lt;&#x2F;el-radio-group&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot;&gt;
        &lt;el-date-picker type&#x3D;&quot;datetime&quot; placeholder&#x3D;&quot;åˆ›å»ºæ—¶é—´&quot; v-model&#x3D;&quot;pageForm.pageCreateTime&quot;&gt;
        &lt;&#x2F;el-date-picker&gt;
      &lt;&#x2F;el-form-item&gt;
    &lt;&#x2F;el-form&gt;
    &lt;div slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;
      &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;addSubmit&quot;&gt;æäº¤&lt;&#x2F;el-button&gt;
      &lt;el-button type&#x3D;&quot;info&quot; @click&#x3D;&quot;goBack&quot;&gt;è¿”å›&lt;&#x2F;el-button&gt;
    &lt;&#x2F;div&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;
&lt;script&gt;
  import * as cmsApi from &#39;..&#x2F;api&#x2F;cms&#39;

  export default &#123;
    created: function () &#123;

    &#125;,
    mounted() &#123;

    &#125;,

    data() &#123;
      return &#123;
        pageFormRules: &#123;
          siteId: [
            &#123;required: true, message: &#39;è¯·é€‰æ‹©ç«™ç‚¹&#39;, trigger: &#39;blur&#39;&#125;
          ],
          templateId: [
            &#123;required: true, message: &#39;è¯·é€‰æ‹©æ¨¡ç‰ˆ&#39;, trigger: &#39;blur&#39;&#125;
          ],
          pageName: [
            &#123;required: true, message: &#39;è¯·è¾“å…¥é¡µé¢åç§°&#39;, trigger: &#39;blur&#39;&#125;
          ],
          pageAliase: [
            &#123;required: true, message: &#39;è¯·è¾“å…¥é¡µé¢åˆ«å&#39;, trigger: &#39;blur&#39;&#125;
          ],
          pageWebPath: [
            &#123;required: true, message: &#39;è¯·è¾“å…¥è®¿é—®è·¯å¾„&#39;, trigger: &#39;blur&#39;&#125;
          ],
          pagePhysicalPath: [
            &#123;required: true, message: &#39;è¯·è¾“å…¥ç‰©ç†è·¯å¾„&#39;, trigger: &#39;blur&#39;&#125;
          ]
        &#125;,
        &#x2F;&#x2F;ç«™ç‚¹åˆ—è¡¨
        siteList: [],
        &#x2F;&#x2F;æ¨¡ç‰ˆåˆ—è¡¨
        templateList: [],
        &#x2F;&#x2F;æ–°å¢ç•Œé¢æ•°æ®
        pageForm: &#123;
          siteId: &#39;&#39;,
          templateId: &#39;&#39;,
          pageName: &#39;&#39;,
          pageAliase: &#39;&#39;,
          pageWebPath: &#39;&#39;,
          pageParameter: &#39;&#39;,
          pagePhysicalPath: &#39;&#39;,
          pageType: &#39;&#39;,
          pageCreateTime: new Date()
        &#125;
      &#125;
    &#125;,
    methods: &#123;
      &#x2F;&#x2F;è¿”å›ä¸Šä¸€é¡µ
      goBack() &#123;
        this.$router.push(&#123;
          path: &quot;&#x2F;cms&#x2F;page&#x2F;list&quot;,
          query: &#123;
            page: this.$route.query.page,
            siteId: this.$route.query.siteId
          &#125;
        &#125;)
      &#125;
    &#125;
  &#125;
&lt;&#x2F;script&gt;</code></pre></div>

<h4 id="1ã€é¡µé¢åˆå§‹åŒ–"><a href="#1ã€é¡µé¢åˆå§‹åŒ–" class="headerlink" title="1ã€é¡µé¢åˆå§‹åŒ–"></a>1ã€é¡µé¢åˆå§‹åŒ–</h4><p>åœ¨é’©å­å‡½æ•° <code>created</code> ä¸­è¿›è¡Œä¸€äº›æ•°æ®çš„åˆå§‹åŒ–è¯·æ±‚ï¼Œä¾‹å¦‚ç«™ç‚¹ã€æ¨¡æ¿çš„ä¿¡æ¯ï¼Œç”¨äºä¸‹æ‹‰æ¡†çš„é€‰æ‹©ï¼Œä»¥åŠåœ¨æ‰“å¼€ç¼–è¾‘é¡µé¢ä¹‹å‰ï¼Œç”¨æˆ·éœ€è¦è·å–å½“å‰ç¼–è¾‘çš„é¡µé¢åŸæœ‰çš„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>page_list</code> é¡µé¢é€šè¿‡çš„ <code>pageId</code> æ¥è·å–å½“å‰ç¼–è¾‘çš„é¡µé¢çš„æ•°æ®ã€‚</p>
<div class="hljs"><pre><code class="hljs js">created: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123; 
    <span class="hljs-comment">//åˆå§‹åŒ–ç«™ç‚¹æ•°æ®</span>
    cmsApi.site_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (res.success) &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"ç«™ç‚¹æ•°æ®"</span>, res)
            <span class="hljs-keyword">this</span>.siteList = res.queryResult.list
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"è·å–ç«™ç‚¹ä¿¡æ¯æ—¶å‘ç”Ÿäº†é”™è¯¯"</span>, res)
        &#125;
    &#125;)

    <span class="hljs-comment">//åˆå§‹åŒ–æ¨¡æ¿æ•°æ®</span>
    cmsApi.template_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (res.success) &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"æ¨¡æ¿æ•°æ®"</span>, res)
            <span class="hljs-keyword">this</span>.templateList = res.queryResult.list
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"è·å–æ¨¡æ¿ä¿¡æ¯æ—¶å‘ç”Ÿäº†é”™è¯¯"</span>, res)
        &#125;
    &#125;)

    <span class="hljs-comment">//åˆå§‹åŒ–é¡µé¢çš„æ•°æ®</span>
    cmsApi.page_query(<span class="hljs-keyword">this</span>.$route.params.pageId).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span>&#123;

        <span class="hljs-keyword">if</span>(res.success)&#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"åˆå§‹åŒ–é¡µé¢æ•°æ®"</span>,res.cmsPage)
            <span class="hljs-keyword">this</span>.pageForm = res.cmsPage
        &#125;<span class="hljs-keyword">else</span>&#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"åˆå§‹åŒ–é¡µé¢æ•°æ®å¤±è´¥"</span>,res)
        &#125;
    &#125;)
&#125;,</code></pre></div>

<p>æˆ‘ä»¬åœ¨é¡µé¢è·¯ç”±å®šä¹‰äº†ä¸€ä¸ª:pageIdçš„å‚æ•°ï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–é¡µé¢çš„æ•°æ®éƒ¨åˆ†ä» <code>this.$route.params</code> å–å‡ºäº†<code>pageId</code></p>
<h4 id="2ã€æäº¤æ›´æ–°è¡¨å•"><a href="#2ã€æäº¤æ›´æ–°è¡¨å•" class="headerlink" title="2ã€æäº¤æ›´æ–°è¡¨å•"></a>2ã€æäº¤æ›´æ–°è¡¨å•</h4><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æäº¤è¡¨å•</span>
addSubmit() &#123;
    <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (valid) &#123;
            <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤æäº¤ä¿®æ”¹å—ï¼Ÿ'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
                cmsApi.page_edit(<span class="hljs-keyword">this</span>.$route.params.pageId,<span class="hljs-keyword">this</span>.pageForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
                    <span class="hljs-keyword">if</span> (res.success) &#123;
                        <span class="hljs-keyword">this</span>.$message(&#123;
                            message: <span class="hljs-string">'ä¿®æ”¹æäº¤æˆåŠŸ'</span>,
                            type: <span class="hljs-string">'success'</span>
                        &#125;);
                    &#125; <span class="hljs-keyword">else</span> &#123;
                        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);
                    &#125;
                &#125;);
            &#125;);
        &#125;
    &#125;)
&#125;,</code></pre></div>

<h1 id="å››ã€åˆ é™¤é¡µé¢"><a href="#å››ã€åˆ é™¤é¡µé¢" class="headerlink" title="å››ã€åˆ é™¤é¡µé¢"></a>å››ã€åˆ é™¤é¡µé¢</h1><p>ä¿®æ”¹é¡µé¢ç”¨æˆ·æ“ä½œæµç¨‹ï¼š</p>
<p>1ã€ç”¨æˆ·è¿›å…¥ä¿®æ”¹é¡µé¢ï¼Œåœ¨é¡µé¢ä¸Šæ˜¾ç¤ºäº†ä¿®æ”¹é¡µé¢çš„ä¿¡æ¯</p>
<p>2ã€ç”¨æˆ·ä¿®æ”¹é¡µé¢çš„å†…å®¹ï¼Œç‚¹å‡»â€œæäº¤â€ï¼Œæç¤ºâ€œä¿®æ”¹æˆåŠŸâ€æˆ–â€œä¿®æ”¹å¤±è´¥â€</p>
<h2 id="1-åç«¯æ¥å£å®šä¹‰-1"><a href="#1-åç«¯æ¥å£å®šä¹‰-1" class="headerlink" title="1. åç«¯æ¥å£å®šä¹‰"></a>1. åç«¯æ¥å£å®šä¹‰</h2><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * åˆ é™¤æ¥å£</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id é¡µé¢id</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"åˆ é™¤é¡µé¢"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">delete</span><span class="hljs-params">(String id)</span></span>;</code></pre></div>

<h2 id="2-æœåŠ¡ç«¯å¼€å‘-1"><a href="#2-æœåŠ¡ç«¯å¼€å‘-1" class="headerlink" title="2. æœåŠ¡ç«¯å¼€å‘"></a>2. æœåŠ¡ç«¯å¼€å‘</h2><h3 id="Daoå±‚-3"><a href="#Daoå±‚-3" class="headerlink" title="Daoå±‚"></a>Daoå±‚</h3><p><code>dao</code>å±‚ ä½¿ç”¨ <code>MongoDB</code> æä¾›çš„daoæ¥å£æ¥å®ç°</p>
<h3 id="Serviceå±‚-3"><a href="#Serviceå±‚-3" class="headerlink" title="Serviceå±‚"></a>Serviceå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ ¹æ®idåˆ é™¤</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">deleteCmsPage</span><span class="hljs-params">(String id)</span></span>&#123;
    <span class="hljs-comment">//æ£€ç´¢è¯¥é¡µé¢idæ˜¯å¦å­˜åœ¨</span>
    Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(id);
    <span class="hljs-keyword">if</span>(optional.isPresent())&#123;
        <span class="hljs-comment">//åˆ é™¤å¹¶è¿”å›ç»“æœ</span>
        cmsPageRepository.deleteById(id);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.FAIL);
&#125;</code></pre></div>

<h3 id="Controllerå±‚-2"><a href="#Controllerå±‚-2" class="headerlink" title="Controllerå±‚"></a>Controllerå±‚</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * åˆ é™¤é¡µé¢</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id é¡µé¢id</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@DeleteMapping</span>(<span class="hljs-string">"/delete/&#123;id&#125;"</span>)
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">delete</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id) </span>&#123;
    <span class="hljs-keyword">return</span> pageService.deleteCmsPage(id);
&#125;</code></pre></div>

<h3 id="æ¥å£æµ‹è¯•"><a href="#æ¥å£æµ‹è¯•" class="headerlink" title="æ¥å£æµ‹è¯•"></a>æ¥å£æµ‹è¯•</h3><p><a href="https://qnoss.codeyee.com/20200704_3/image18" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image18.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-å‰ç«¯å¼€å‘"><a href="#3-å‰ç«¯å¼€å‘" class="headerlink" title="3.å‰ç«¯å¼€å‘"></a>3.å‰ç«¯å¼€å‘</h2><h3 id="é¡µé¢ç¼–å†™"><a href="#é¡µé¢ç¼–å†™" class="headerlink" title="é¡µé¢ç¼–å†™"></a>é¡µé¢ç¼–å†™</h3><p>1ã€åœ¨ <code>page_list</code> é¡µé¢å†…æ–°å¢ä¸€ä¸ªåˆ é™¤æŒ‰é’®</p>
<div class="hljs"><pre><code class="hljs vue">&lt;el-table-column label&#x3D;&quot;åˆ é™¤&quot; width&#x3D;&quot;75&quot; fixed&#x3D;&quot;right&quot;&gt;
  &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
    &lt;el-button
      size&#x3D;&quot;mini&quot;
      type&#x3D;&quot;danger&quot;
      @click&#x3D;&quot;deletePage(scope.row.pageId)&quot;&gt;åˆ é™¤
    &lt;&#x2F;el-button&gt;
  &lt;&#x2F;template&gt;
&lt;&#x2F;el-table-column&gt;</code></pre></div>

<p>2ã€åœ¨ <code>cms.js</code> å®šä¹‰åˆ é™¤çš„api</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åˆ é™¤æ¥å£</span>
export <span class="hljs-keyword">const</span> page_delete = (id) =&gt;&#123;
  <span class="hljs-keyword">return</span> http.requestDelete(apiUrl + <span class="hljs-string">"/cms/page/delete/"</span> + id)
&#125;</code></pre></div>

<p>3ã€åˆ›å»º <code>deletePage</code> å‡½æ•°ï¼Œæ¥æ”¶åˆ° å½“å‰è¡Œçš„ <code>pageId</code></p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//åˆ é™¤é¡µé¢</span>
deletePage(pageId) &#123;
  <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">"æ­¤æ“ä½œå°†æ°¸ä¹…çš„åˆ é™¤è¯¥é¡µé¢"</span>, <span class="hljs-string">"æç¤º"</span>, &#123;
    confirmButtonText: <span class="hljs-string">'ç¡®å®š'</span>,
    cancelButtonText: <span class="hljs-string">'å–æ¶ˆ'</span>,
    type: <span class="hljs-string">'warning'</span>
  &#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    cmsApi.page_delete(pageId).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;
      <span class="hljs-keyword">if</span> (res.success) &#123;
        <span class="hljs-keyword">this</span>.$message(&#123;
          type: <span class="hljs-string">'success'</span>,
          message: <span class="hljs-string">'åˆ é™¤æˆåŠŸ!'</span>
        &#125;)
        <span class="hljs-keyword">this</span>.query()
      &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">this</span>.$message(&#123;
          type: <span class="hljs-string">'warning'</span>,
          message: <span class="hljs-string">'åˆ é™¤å¤±è´¥'</span>
        &#125;);
      &#125;
    &#125;)
  &#125;).catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    <span class="hljs-keyword">this</span>.$message(&#123;
      type: <span class="hljs-string">'info'</span>,
      message: <span class="hljs-string">'å·²å–æ¶ˆåˆ é™¤'</span>
    &#125;);
  &#125;);
&#125;,</code></pre></div>

<h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><a href="https://qnoss.codeyee.com/20200704_3/image19" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image19.gif" srcset="/img/loading.gif" alt="img"></a></p>
<h1 id="äº”ã€å¼‚å¸¸å¤„ç†"><a href="#äº”ã€å¼‚å¸¸å¤„ç†" class="headerlink" title="äº”ã€å¼‚å¸¸å¤„ç†"></a>äº”ã€å¼‚å¸¸å¤„ç†</h1><h2 id="1-å¼‚å¸¸å¤„ç†çš„é—®é¢˜åˆ†æ"><a href="#1-å¼‚å¸¸å¤„ç†çš„é—®é¢˜åˆ†æ" class="headerlink" title="1. å¼‚å¸¸å¤„ç†çš„é—®é¢˜åˆ†æ"></a>1. å¼‚å¸¸å¤„ç†çš„é—®é¢˜åˆ†æ</h2><p>ä»æ·»åŠ é¡µé¢çš„serviceæ–¹æ³•ä¸­æ‰¾é—®é¢˜ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">* æ·»åŠ é¡µé¢æ•°æ®</span>
<span class="hljs-comment">*/</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;
    <span class="hljs-comment">//éªŒè¯æ•°æ®å”¯ä¸€æ€§ï¼šsizeIdã€pageNameã€pageWebPath</span>
    CmsPage cmsPage1 = cmsPageRepository.findByPageNameAndSiteIdAndPageWebPath(cmsPage.getPageName(), cmsPage.getSiteId(), cmsPage.getPageWebPath());
    <span class="hljs-keyword">if</span> (cmsPage1 == <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-comment">//ç«™ç‚¹idç”±mongoDBè‡ªåŠ¨ç”Ÿæˆï¼Œé˜²æ­¢å‰ç«¯ä¼ å€¼</span>
        cmsPage.setPageId(<span class="hljs-keyword">null</span>);
        CmsPage save = cmsPageRepository.save(cmsPage);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS, save);
    &#125;
    <span class="hljs-comment">//æ·»åŠ å¤±è´¥</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL, cmsPage);
&#125;</code></pre></div>

<h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a><strong>é—®é¢˜</strong></h3><p>1ã€ä¸Šè¾¹çš„ä»£ç åªè¦æ“ä½œä¸æˆåŠŸä»…å‘ç”¨æˆ·è¿”å›â€œé”™è¯¯ä»£ç ï¼š11111ï¼Œå¤±è´¥ä¿¡æ¯ï¼šæ“ä½œå¤±è´¥â€ï¼Œæ— æ³•åŒºåˆ«å…·ä½“çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
<p>2ã€<code>service</code> æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹å‡ºç°å¼‚å¸¸åœ¨å“ªæ•è·ï¼Ÿåœ¨ <code>service</code> ä¸­éœ€è¦éƒ½åŠ  <code>try</code>/<code>catch</code>ï¼Œå¦‚æœåœ¨<code>controller</code> ä¹Ÿéœ€è¦æ·»åŠ  try/catchï¼Œä»£ç å†—ä½™ä¸¥é‡ä¸”ä¸æ˜“ç»´æŠ¤ã€‚</p>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>1ã€åœ¨ <code>Service</code> æ–¹æ³•ä¸­çš„ç¼–ç é¡ºåºæ˜¯å…ˆæ ¡éªŒåˆ¤æ–­ï¼Œæœ‰é—®é¢˜åˆ™æŠ›å‡ºå…·ä½“çš„å¼‚å¸¸ä¿¡æ¯ï¼Œæœ€åæ‰§è¡Œå…·ä½“çš„ä¸šåŠ¡æ“ä½œï¼Œè¿”å›æˆåŠŸä¿¡æ¯ã€‚</p>
<p>2ã€åœ¨ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»ä¸­å»æ•è·å¼‚å¸¸ï¼Œæ— éœ€<code>controller</code>æ•è·å¼‚å¸¸ï¼Œå‘ç”¨æˆ·è¿”å›ç»Ÿä¸€è§„èŒƒçš„å“åº”ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬çš„ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ·»åŠ é¡µé¢æ•°æ®</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;
    <span class="hljs-comment">//æ•ˆéªŒcmsPageæ˜¯å¦ä¸ºç©º</span>
    <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;
        <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸ï¼Œéæ³•å‚æ•°</span>

    &#125;

    <span class="hljs-comment">//éªŒè¯æ•°æ®å”¯ä¸€æ€§ï¼šsizeIdã€pageNameã€pageWebPath</span>
    CmsPage cmsPage1 = cmsPageRepository.findByPageNameAndSiteIdAndPageWebPath(cmsPage.getPageName(), cmsPage.getSiteId(), cmsPage.getPageWebPath());

    <span class="hljs-comment">//æ£€éªŒé¡µé¢æ˜¯å¦å·²å­˜åœ¨</span>
    <span class="hljs-keyword">if</span> (cmsPage1 != <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸</span>

    &#125;

    <span class="hljs-comment">//ç«™ç‚¹idç”±mongoDBè‡ªåŠ¨ç”Ÿæˆï¼Œé˜²æ­¢å‰ç«¯ä¼ å€¼</span>
    cmsPage.setPageId(<span class="hljs-keyword">null</span>);
    CmsPage save = cmsPageRepository.save(cmsPage);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS, save);
    <span class="hljs-comment">//æ·»åŠ å¤±è´¥</span>
&#125;</code></pre></div>

<p>åœ¨æ‰§è¡Œæ­£å¸¸çš„é€»è¾‘ä¹‹å‰ï¼Œè¦æŠŠå·²çŸ¥çš„å¼‚å¸¸è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯å…¨éƒ¨é€šè¿‡åæ‰ä¼šå»æ‰§è¡Œæ­£å¸¸çš„é€»è¾‘ä»£ç ã€‚</p>
<h2 id="2-å¼‚å¸¸å¤„ç†æµç¨‹"><a href="#2-å¼‚å¸¸å¤„ç†æµç¨‹" class="headerlink" title="2. å¼‚å¸¸å¤„ç†æµç¨‹"></a>2. å¼‚å¸¸å¤„ç†æµç¨‹</h2><p>ç³»ç»Ÿå¯¹å¼‚å¸¸çš„å¤„ç†ä½¿ç”¨ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†æµç¨‹ï¼š</p>
<p>1ã€è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹ã€‚</p>
<p>2ã€è‡ªå®šä¹‰é”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ã€‚</p>
<p>3ã€å¯¹äºå¯é¢„çŸ¥çš„å¼‚å¸¸ç”±ç¨‹åºå‘˜åœ¨ä»£ç ä¸­ä¸»åŠ¨æŠ›å‡ºï¼Œç”± <code>SpringMVC</code> ç»Ÿä¸€æ•è·ã€‚</p>
<p>å¯é¢„çŸ¥å¼‚å¸¸æ˜¯ç¨‹åºå‘˜åœ¨ä»£ç ä¸­æ‰‹åŠ¨æŠ›å‡ºæœ¬ç³»ç»Ÿå®šä¹‰çš„ç‰¹å®šå¼‚å¸¸ç±»å‹ï¼Œç”±äºæ˜¯ç¨‹åºå‘˜æŠ›å‡ºçš„å¼‚å¸¸ï¼Œé€šå¸¸å¼‚å¸¸ä¿¡æ¯æ¯”è¾ƒé½å…¨ï¼Œç¨‹åºå‘˜åœ¨æŠ›å‡ºæ—¶ä¼šæŒ‡å®šé”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ï¼Œè·å–å¼‚å¸¸ä¿¡æ¯ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿ã€‚</p>
<p>4ã€å¯¹äºä¸å¯é¢„çŸ¥çš„å¼‚å¸¸ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰ç”±<code>SpringMVC</code>ç»Ÿä¸€æ•è· <code>Exception</code> ç±»å‹çš„å¼‚å¸¸ã€‚</p>
<p>ä¸å¯é¢„çŸ¥å¼‚å¸¸é€šå¸¸æ˜¯ç”±äºç³»ç»Ÿå‡ºç°bugã€æˆ–ä¸€äº›ä¸è¦æŠ—æ‹’çš„é”™è¯¯ï¼ˆæ¯”å¦‚ç½‘ç»œä¸­æ–­ã€æœåŠ¡å™¨å®•æœºç­‰ï¼‰ï¼Œå¼‚å¸¸ç±»å‹ä¸º <code>RuntimeException</code>ç±»å‹ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼‰ã€‚</p>
<p>5ã€å¯é¢„çŸ¥çš„å¼‚å¸¸åŠä¸å¯é¢„çŸ¥çš„è¿è¡Œæ—¶å¼‚å¸¸æœ€ç»ˆä¼šé‡‡ç”¨ç»Ÿä¸€çš„ä¿¡æ¯æ ¼å¼ï¼ˆé”™è¯¯ä»£ç +é”™è¯¯ä¿¡æ¯ï¼‰æ¥è¡¨ç¤ºï¼Œæœ€ç»ˆä¹Ÿä¼šéšè¯·æ±‚å“åº”ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>å¼‚å¸¸æŠ›å‡ºåŠå¤„ç†æµç¨‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image20" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image20.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1ã€åœ¨ <code>controller</code>ã€<code>service</code>ã€<code>dao</code> ä¸­ç¨‹åºå‘˜æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ï¼›<code>springMVC</code> æ¡†æ¶æŠ›å‡ºæ¡†æ¶å¼‚å¸¸ç±»å‹</p>
<p>2ã€ç»Ÿä¸€ç”±å¼‚å¸¸æ•è·ç±»æ•è·å¼‚å¸¸ï¼Œå¹¶è¿›è¡Œå¤„ç†</p>
<p>3ã€æ•è·åˆ°è‡ªå®šä¹‰å¼‚å¸¸åˆ™ç›´æ¥å–å‡ºé”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ï¼Œå“åº”ç»™ç”¨æˆ·</p>
<p>4ã€æ•è·åˆ°éè‡ªå®šä¹‰å¼‚å¸¸ç±»å‹é¦–å…ˆä» <code>Map</code> ä¸­æ‰¾è¯¥å¼‚å¸¸ç±»å‹æ˜¯å¦å¯¹åº”å…·ä½“çš„é”™è¯¯ä»£ç ï¼Œå¦‚æœæœ‰åˆ™å–å‡ºé”™è¯¯ä»£ç å’Œé”™è¯¯ä¿¡æ¯å¹¶å“åº”ç»™ç”¨æˆ·ï¼Œå¦‚æœä» <code>Map</code> ä¸­æ‰¾ä¸åˆ°å¼‚å¸¸ç±»å‹æ‰€å¯¹åº”çš„é”™è¯¯ä»£ç åˆ™ç»Ÿä¸€ä¸º <code>99999</code> é”™è¯¯ä»£ç å¹¶å“åº”ç»™ç”¨æˆ·ã€‚</p>
<p>5ã€å°†é”™è¯¯ä»£ç åŠé”™è¯¯ä¿¡æ¯ä»¥ <code>Json</code> æ ¼å¼å“åº”ç»™ç”¨æˆ·ã€‚</p>
<h2 id="3-å¯é¢„çŸ¥å¼‚å¸¸å¤„ç†"><a href="#3-å¯é¢„çŸ¥å¼‚å¸¸å¤„ç†" class="headerlink" title="3. å¯é¢„çŸ¥å¼‚å¸¸å¤„ç†"></a>3. å¯é¢„çŸ¥å¼‚å¸¸å¤„ç†</h2><h3 id="è‡ªå®šä¹‰å¼‚å¸¸ç±»"><a href="#è‡ªå®šä¹‰å¼‚å¸¸ç±»" class="headerlink" title="è‡ªå®šä¹‰å¼‚å¸¸ç±»"></a>è‡ªå®šä¹‰å¼‚å¸¸ç±»</h3><p>åœ¨commonå·¥ç¨‹å®šä¹‰å¼‚å¸¸ç±»å‹ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;

<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>&#123;

    <span class="hljs-keyword">private</span> ResultCode resultCode;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomException</span><span class="hljs-params">(ResultCode resultCode)</span></span>&#123;
        <span class="hljs-comment">//å¼‚å¸¸ä¿¡æ¯ä¸ºé”™è¯¯ä»£ç +å¼‚å¸¸ä¿¡æ¯</span>
        <span class="hljs-keyword">super</span>(<span class="hljs-string">"é”™è¯¯ä»£ç : "</span> + resultCode.code() + <span class="hljs-string">" é”™è¯¯ä¿¡æ¯: "</span> + resultCode.message());
        <span class="hljs-keyword">this</span>.resultCode = resultCode;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultCode <span class="hljs-title">getResultCode</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.resultCode;
    &#125;
&#125;</code></pre></div>

<p>ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ªåä¸º <code>CustomException</code> çš„å¼‚å¸¸ï¼Œå¹¶ä¸”ç»§æ‰¿äº† <code>RuntimeException</code> å¼‚å¸¸ç±»ï¼Œæœ‰çš„äººå¯èƒ½ä¼šé—®ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸ç›´æ¥ç»§æ‰¿ <code>Exception</code> ç±»ï¼Ÿå› ä¸ºå¦‚æœç»§æ‰¿äº† <code>Exception</code> ç±»ï¼Œæˆ‘ä»¬åœ¨æŠ›å‡ºå¼‚å¸¸æ—¶å¯¹ä»£ç ä¼šæœ‰ä¸€å®šçš„ä¾µå…¥æ€§ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦åœ¨æŠ›å‡ºè¯¥å¼‚å¸¸çš„æ–¹æ³•å‰åŠ å…¥ <code>throws Exception</code> ï¼Œä¾‹å¦‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;

&#125;</code></pre></div>

<p>æˆ–è€…ä½¿ç”¨</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;
    <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸ï¼Œéæ³•å‚æ•°</span>
&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
    e.printStackTrace();
&#125;</code></pre></div>

<p>è€Œæˆ‘ä»¬å¦‚æœä½¿ç”¨ <code>RuntimeException</code> ,è‡³éœ€è¦åœ¨æŠ›å‡ºå¼‚å¸¸çš„åœ°æ–¹å†™å…¥ä¸‹é¢ä»£ç å°±èƒ½æŠ›å‡ºæˆ‘ä»¬è‡ªå®šä¹‰çš„å¼‚å¸¸</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomException(resultCode);</code></pre></div>

<h3 id="æŠ›å‡ºå¼‚å¸¸ç±»"><a href="#æŠ›å‡ºå¼‚å¸¸ç±»" class="headerlink" title="æŠ›å‡ºå¼‚å¸¸ç±»"></a>æŠ›å‡ºå¼‚å¸¸ç±»</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;

<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionCast</span> </span>&#123;

    <span class="hljs-comment">//ä½¿ç”¨æ­¤é™æ€æ–¹æ³•æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cast</span><span class="hljs-params">(ResultCode resultCode)</span> </span>&#123;
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomException(resultCode);
    &#125;
&#125;</code></pre></div>

<h3 id="å¼‚å¸¸æ•è·ç±»"><a href="#å¼‚å¸¸æ•è·ç±»" class="headerlink" title="å¼‚å¸¸æ•è·ç±»"></a>å¼‚å¸¸æ•è·ç±»</h3><p>ä½¿ç”¨ @ControllerAdviceå’Œ@ExceptionHandleræ³¨è§£æ¥æ•è·æŒ‡å®šç±»å‹çš„å¼‚å¸¸</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;

<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-meta">@ControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionCatch</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ExceptionCatch<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-comment">//æ•è· CustomException å¼‚å¸¸</span>
    <span class="hljs-meta">@ExceptionHandler</span>(CustomException<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">    @<span class="hljs-title">ResponseBody</span></span>
<span class="hljs-class">    <span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">customException</span>(<span class="hljs-title">CustomException</span> <span class="hljs-title">e</span>)</span>&#123;
        LOGGER.error(<span class="hljs-string">"catch exceptionï¼š&#123;&#125;\r\nExceptionï¼š"</span>,e.getMessage(),e);
        ResultCode resultCode = e.getResultCode();
        ResponseResult responseResult = <span class="hljs-keyword">new</span> ResponseResult(resultCode);
        <span class="hljs-keyword">return</span> responseResult;
    &#125;
&#125;</code></pre></div>

<h3 id="å¼‚å¸¸å¤„ç†æµ‹è¯•"><a href="#å¼‚å¸¸å¤„ç†æµ‹è¯•" class="headerlink" title="å¼‚å¸¸å¤„ç†æµ‹è¯•"></a>å¼‚å¸¸å¤„ç†æµ‹è¯•</h3><h4 id="1ï¼‰å®šä¹‰é”™è¯¯ä»£ç "><a href="#1ï¼‰å®šä¹‰é”™è¯¯ä»£ç " class="headerlink" title="1ï¼‰å®šä¹‰é”™è¯¯ä»£ç "></a>1ï¼‰å®šä¹‰é”™è¯¯ä»£ç </h4><p>æ¯ä¸ªä¸šåŠ¡æ“ä½œçš„å¼‚å¸¸ä½¿ç”¨å¼‚å¸¸ä»£ç å»æ ‡è¯†ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.model.response;
<span class="hljs-keyword">import</span> lombok.ToString;

<span class="hljs-meta">@ToString</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> CmsCode implements ResultCode &#123;

    CMS_ADDPAGE_EXISTS(<span class="hljs-keyword">false</span>,<span class="hljs-number">24001</span>,<span class="hljs-string">"é¡µé¢å·²å­˜åœ¨ï¼"</span>);

    <span class="hljs-comment">//æ“ä½œç»“æœ</span>
    <span class="hljs-keyword">boolean</span> success;

    <span class="hljs-comment">//æ“ä½œä»£ç </span>
    <span class="hljs-keyword">int</span> code;

    <span class="hljs-comment">//æç¤ºä¿¡æ¯</span>
    String message;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">CmsCode</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> success, <span class="hljs-keyword">int</span> code, String message)</span></span>&#123;
        <span class="hljs-keyword">this</span>.success = success;
        <span class="hljs-keyword">this</span>.code = code;
        <span class="hljs-keyword">this</span>.message = message;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">success</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> success;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">code</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> code;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">message</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> message;
    &#125;
&#125;</code></pre></div>

<h4 id="2ï¼‰å¼‚å¸¸å¤„ç†æµ‹è¯•"><a href="#2ï¼‰å¼‚å¸¸å¤„ç†æµ‹è¯•" class="headerlink" title="2ï¼‰å¼‚å¸¸å¤„ç†æµ‹è¯•"></a>2ï¼‰å¼‚å¸¸å¤„ç†æµ‹è¯•</h4><p>1ã€æŠ›å‡ºå¼‚å¸¸</p>
<p>å›åˆ°æˆ‘ä»¬ <code>PageService</code> ä¸­çš„ <code>addCmsPage</code> æŠ›å‡ºå¼‚å¸¸</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ£€éªŒé¡µé¢æ˜¯å¦å·²å­˜åœ¨</span>
<span class="hljs-keyword">if</span> (cmsPage1 != <span class="hljs-keyword">null</span>) &#123;
    <span class="hljs-comment">//æŠ›å‡ºå¼‚å¸¸</span>
    ExceptionCast.cast(CmsCode.CMS_ADDPAGE_EXISTS);
&#125;</code></pre></div>

<p>2ã€åœ¨å¯åŠ¨å·¥ç¨‹ä¸­æ‰«æå¼‚å¸¸æ•è·ç±»</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)  <span class="hljs-comment">// æ‰«æframeworkä¸‹çš„å¼‚å¸¸æ•è·ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCmsApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(ManageCmsApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;
    &#125;
&#125;</code></pre></div>

<p>3ã€å‰ç«¯å±•ç¤ºå¼‚å¸¸ä¿¡æ¯</p>
<p>åœ¨å‰ç«¯æ–°å¢é¡µé¢çš„è¡¨å•æäº¤ä¸­å¢åŠ åˆ¤æ–­</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(res.message)&#123;
	<span class="hljs-keyword">this</span>.$message.error(res.message)
&#125;</code></pre></div>

<p>å…¨éƒ¨ä»£ç å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//æäº¤è¡¨å•</span>
addSubmit() &#123;
  <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (valid) &#123;
      <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'ç¡®è®¤æäº¤å—ï¼Ÿ'</span>, <span class="hljs-string">'æç¤º'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
        cmsApi.page_add(<span class="hljs-keyword">this</span>.pageForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
          <span class="hljs-built_in">console</span>.log(res);
          <span class="hljs-keyword">if</span> (res.success) &#123;
            <span class="hljs-keyword">this</span>.$message(&#123;
              message: <span class="hljs-string">'æäº¤æˆåŠŸ'</span>,
              type: <span class="hljs-string">'success'</span>
            &#125;);
            <span class="hljs-keyword">this</span>.$refs[<span class="hljs-string">'pageForm'</span>].resetFields();
          &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(res.message)&#123;
            <span class="hljs-keyword">this</span>.$message.error(res.message)
          &#125;
          <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'æäº¤å¤±è´¥'</span>);
          &#125;
        &#125;);
      &#125;);
    &#125;
  &#125;)
&#125;,</code></pre></div>

<p>æµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image21" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image21.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="4-ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸å¤„ç†"><a href="#4-ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="4. ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸å¤„ç†"></a>4. ä¸å¯é¢„çŸ¥çš„å¼‚å¸¸å¤„ç†</h2><h4 id="1ï¼‰å®šä¹‰å¼‚å¸¸æ•è·æ–¹æ³•"><a href="#1ï¼‰å®šä¹‰å¼‚å¸¸æ•è·æ–¹æ³•" class="headerlink" title="1ï¼‰å®šä¹‰å¼‚å¸¸æ•è·æ–¹æ³•"></a>1ï¼‰å®šä¹‰å¼‚å¸¸æ•è·æ–¹æ³•</h4><h5 id="æŠ›å‡ºå¼‚å¸¸æµ‹è¯•"><a href="#æŠ›å‡ºå¼‚å¸¸æµ‹è¯•" class="headerlink" title="æŠ›å‡ºå¼‚å¸¸æµ‹è¯•"></a>æŠ›å‡ºå¼‚å¸¸æµ‹è¯•</h5><p>ä½¿ç”¨postmanæµ‹è¯•æ·»åŠ é¡µé¢ï¼Œä¸è¾“å…¥cmsPostä¿¡æ¯ï¼Œæäº¤ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs json">org.springframework.http.converter.HttpMessageNotReadableException
æ­¤å¼‚å¸¸æ˜¯springMVCåœ¨è¿›è¡Œå‚æ•°è½¬æ¢æ—¶æŠ¥çš„é”™è¯¯ã€‚

&#123;
    <span class="hljs-attr">"timestamp"</span>: <span class="hljs-number">1528712906727</span>,
    <span class="hljs-attr">"status"</span>: <span class="hljs-number">400</span>,
    <span class="hljs-attr">"error"</span>: <span class="hljs-string">"Bad Request"</span>,
    <span class="hljs-attr">"exception"</span>: <span class="hljs-string">"org.springframework.http.converter.HttpMessageNotReadableException"</span>,
    <span class="hljs-attr">"message"</span>: <span class="hljs-string">"Required request body is missing: public</span>
<span class="hljs-string">    com.xuecheng.framework.domain.cms.response.CmsPageResult</span>
<span class="hljs-string">    com.xuecheng.manage_cms.web.controller.CmsPageController.add(com.xuecheng.framework.domain.cms.C</span>
<span class="hljs-string">    msPage)"</span>,
    <span class="hljs-attr">"path"</span>: <span class="hljs-string">"/cms/page/add"</span>
&#125;</code></pre></div>

<p>ä¸Šè¾¹çš„å“åº”ä¿¡æ¯åœ¨å®¢æˆ·ç«¯æ˜¯æ— æ³•è§£æçš„ã€‚</p>
<p>åœ¨å¼‚å¸¸æ•è·ç±» <code>ExceptionCatch</code> ä¸­æ·»åŠ å¯¹Exceptionå¼‚å¸¸çš„æ•è·ï¼Œä¸‹é¢å¤§è‡´çš„ä»£ç ç»“æ„ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ExceptionHandler</span>(Exception<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">@<span class="hljs-title">ResponseBody</span></span>
<span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">exception</span>(<span class="hljs-title">Exception</span> <span class="hljs-title">exception</span>)</span>&#123;
    <span class="hljs-comment">//è®°å½•æ—¥å¿—</span>
    LOGGER.error(<span class="hljs-string">"catch exception:&#123;&#125;"</span>,exception.getMessage());
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
&#125;</code></pre></div>

<h5 id="å¼‚å¸¸æ•è·æ–¹æ³•"><a href="#å¼‚å¸¸æ•è·æ–¹æ³•" class="headerlink" title="å¼‚å¸¸æ•è·æ–¹æ³•"></a>å¼‚å¸¸æ•è·æ–¹æ³•</h5><p>é’ˆå¯¹ä¸Šè¾¹çš„é—®é¢˜å…¶è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p>
<ol>
<li>æˆ‘ä»¬åœ¨mapä¸­é…ç½®HttpMessageNotReadableExceptionå’Œé”™è¯¯ä»£ç ã€‚</li>
<li>åœ¨å¼‚å¸¸æ•è·ç±»ä¸­å¯¹Exceptionå¼‚å¸¸è¿›è¡Œæ•è·ï¼Œå¹¶ä»mapä¸­è·å–å¼‚å¸¸ç±»å‹å¯¹åº”çš„é”™è¯¯ä»£ç ï¼Œå¦‚æœå­˜åœ¨é”™è¯¯ä»£ç åˆ™è¿”å›æ­¤é”™è¯¯ï¼Œå¦åˆ™ç»Ÿä¸€è¿”å›99999é”™è¯¯ã€‚</li>
</ol>
<p>å…·ä½“çš„å¼€å‘å®ç°å¦‚ä¸‹ï¼š</p>
<p>1ã€åœ¨é€šç”¨é”™è¯¯ä»£ç ç±»CommCodeä¸­é…ç½®éæ³•å‚æ•°å¼‚å¸¸</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ToString</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> CommonCode implements ResultCode&#123;
    INVALID_PARAM(<span class="hljs-keyword">false</span>,<span class="hljs-number">10003</span>,<span class="hljs-string">"éæ³•å‚æ•°ï¼"</span>),

    <span class="hljs-comment">/**å…¶ä»–ä»£ç çœç•¥**/</span>
&#125;</code></pre></div>

<p>2ã€åœ¨å¼‚å¸¸æ•è·ç±»ä¸­é…ç½® HttpMessageNotReadableException ä¸ºéæ³•å‚æ•°å¼‚å¸¸ã€‚</p>
<p>å…·ä½“çš„è¯´æ˜æˆ‘éƒ½å†™åœ¨æ³¨é‡Šå½“ä¸­äº†ï¼Œå°±ä¸å¤šåšè§£é‡Šï¼Œç›´æ¥çœ‹ä»£ç </p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;

<span class="hljs-keyword">import</span> com.google.common.collect.ImmutableMap;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.http.converter.HttpMessageNotReadableException;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ç»Ÿä¸€å¼‚å¸¸æ•è·ç±»</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-09  11:12</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@ControllerAdvice</span><span class="hljs-comment">//æ§åˆ¶å™¨å¢å¼º</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionCatch</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ExceptionCatch<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-comment">//å®šä¹‰mapï¼Œé…ç½®å¼‚å¸¸ç±»å‹æ‰€å¯¹åº”çš„é”™è¯¯ä»£ç ï¼ˆImmutableMap åªè¯»ï¼Œçº¿ç¨‹å®‰å…¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ImmutableMap&lt;Class&lt;? extends Throwable&gt;,ResultCode&gt; EXCEPTIONS;
    <span class="hljs-comment">//å®šä¹‰mapçš„builderå¯¹è±¡ï¼Œå»æ„å»ºimmutablemap</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> ImmutableMap.Builder&lt;Class&lt;? extends Throwable&gt;,ResultCode&gt; builder = ImmutableMap.builder();

    <span class="hljs-comment">//æ•è·CustomExceptionç±»çš„å¼‚å¸¸</span>
    <span class="hljs-meta">@ExceptionHandler</span>(CustomException<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">    <span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">customException</span>(<span class="hljs-title">CustomException</span> <span class="hljs-title">customException</span>)</span>&#123;
        <span class="hljs-comment">//è®°å½•æ—¥å¿—</span>
        LOGGER.error(<span class="hljs-string">"catch exception:&#123;&#125;"</span>,customException.getMessage());
        ResultCode resultCode = customException.getResultCode();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(resultCode);
    &#125;

    <span class="hljs-comment">//æ•è·Exceptionç±»çš„å¼‚å¸¸</span>
    <span class="hljs-meta">@ExceptionHandler</span>(Exception<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">    @<span class="hljs-title">ResponseBody</span></span>
<span class="hljs-class">    <span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">exception</span>(<span class="hljs-title">Exception</span> <span class="hljs-title">exception</span>)</span>&#123;
        <span class="hljs-comment">//è®°å½•æ—¥å¿—</span>
        LOGGER.error(<span class="hljs-string">"catch exception:&#123;&#125;"</span>,exception.getMessage());
        <span class="hljs-keyword">if</span> (EXCEPTIONS == <span class="hljs-keyword">null</span>)&#123;
            EXCEPTIONS = builder.build();<span class="hljs-comment">//EXCEPTIONSæ„å»ºæˆåŠŸ</span>
        &#125;
        <span class="hljs-comment">//ä»EXCEPTIONSä¸­æ‰¾å‡ºå¼‚å¸¸ç±»å‹æ‰€å¯¹åº”çš„é”™è¯¯ä»£ç ï¼Œå¦‚æœæ‰¾åˆ°äº†å°†é”™è¯¯ä»£ç å“åº”ç»™ç”¨æˆ·</span>
        <span class="hljs-comment">// å¦‚æœæ‰¾ä¸åˆ°ç»™ç”¨æˆ·å“åº”99999å¼‚å¸¸</span>
        ResultCode resultCode = EXCEPTIONS.get(exception.getClass());
        <span class="hljs-keyword">if</span> (resultCode != <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(resultCode);
        &#125;<span class="hljs-keyword">else</span> &#123;
            <span class="hljs-comment">//å¦‚æœéé¢„å®šä¹‰çš„é”™è¯¯ï¼Œåˆ™è¿”å›æœåŠ¡å™¨é”™è¯¯</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SERVER_ERROR);
        &#125;
    &#125;

    <span class="hljs-keyword">static</span> &#123;
        builder.put(HttpMessageNotReadableException<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">CommonCode</span>.<span class="hljs-title">INVALID_PARAM</span>)</span>;
    &#125;

&#125;</code></pre></div>

<p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæ˜¯å¦èƒ½æˆåŠŸæ•æŠ“åˆ°è¯¥å¼‚å¸¸</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image22" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image22.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æˆ‘ä»¬æ”¹æˆ GET è¯·æ±‚è¿›è¡Œæµ‹è¯•ï¼Œç”±äºæˆ‘ä»¬æ²¡æœ‰é¢„å®šè¿™ç§å¼‚å¸¸çš„é”™è¯¯ä»£ç ï¼Œæ‰€ä»¥ç»Ÿä¸€è¿”å›99999é”™è¯¯ä»£ç </p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image23" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image23.png" srcset="/img/loading.gif" alt="img"></a></p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">å­¦æˆåœ¨çº¿</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Spring-Data-MongoDB/">Spring Data MongoDB</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day04ï¼šé¡µé¢é™æ€åŒ–</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/">
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day02ï¼šCMSå‰ç«¯å¼€å‘</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

ä»£ç å—js ç”¨ä¸åˆ°ï¼Œfulidè‡ªå¸¦æœ‰ï¼Œæ·»åŠ cssæ ·å¼å³å¯å®ç°
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®å­—</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å‹‰å¼ºè¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">äº¬ICPè¯123456å·</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>äº¬å…¬ç½‘å®‰å¤‡12345678å·</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "å­¦æˆåœ¨çº¿day03ï¼šCMSé¡µé¢ç®¡ç†å¼€å‘&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
