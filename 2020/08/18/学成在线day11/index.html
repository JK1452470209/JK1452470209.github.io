<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>å­¦æˆåœ¨çº¿day11ï¼šåŸºäº ElasticSearch æ„å»ºæœç´¢æœåŠ¡ - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ç§äººåšå®¢</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äºæˆ‘
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-18 10:08">
      2020-08-18
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      9.1k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      127
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p>
</blockquote>
<p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day11</code> çš„å†…å®¹</p>
<ul>
<li>åŸºäº <code>Java</code> å®¢æˆ·ç«¯å®ç° DSL æœç´¢</li>
<li>æ­å»º <code>ElasticSearch</code> é›†ç¾¤ç¯å¢ƒ</li>
<li>ä½¿ç”¨ <code>Logstash</code> è‡ªåŠ¨åˆ›å»º <code>ElasticSearch</code> çš„ç´¢å¼•ã€æ•°æ®æ–‡æ¡£</li>
<li>åŸºäº <code>ElasticSearch</code> å¼€å‘æœç´¢æœåŠ¡æ¥å£</li>
</ul>
<h1 id="ä¸€ã€æœç´¢ç®¡ç†"><a href="#ä¸€ã€æœç´¢ç®¡ç†" class="headerlink" title="ä¸€ã€æœç´¢ç®¡ç†"></a>ä¸€ã€æœç´¢ç®¡ç†</h1><h2 id="1-å‡†å¤‡ç¯å¢ƒ"><a href="#1-å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="1. å‡†å¤‡ç¯å¢ƒ"></a>1. å‡†å¤‡ç¯å¢ƒ</h2><h3 id="1ã€åˆ›å»ºæ˜ å°„"><a href="#1ã€åˆ›å»ºæ˜ å°„" class="headerlink" title="1ã€åˆ›å»ºæ˜ å°„"></a>1ã€åˆ›å»ºæ˜ å°„</h3><p>åˆ›å»º <code>xc_course</code> ç´¢å¼•åº“ï¼Œæ–¹å¼å¦‚ä¸‹</p>
<p>postï¼š<a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"properties"</span>: &#123;
        <span class="hljs-attr">"description"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>
        &#125;,
        <span class="hljs-attr">"name"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>
        &#125;,
        <span class="hljs-attr">"pic"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-attr">"index"</span>: <span class="hljs-literal">false</span>
        &#125;,
        <span class="hljs-attr">"price"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"float"</span>
        &#125;,
        <span class="hljs-attr">"studymodel"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"timestamp"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,
            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<h3 id="2ã€æ’å…¥åŸå§‹æ•°æ®"><a href="#2ã€æ’å…¥åŸå§‹æ•°æ®" class="headerlink" title="2ã€æ’å…¥åŸå§‹æ•°æ®"></a>2ã€æ’å…¥åŸå§‹æ•°æ®</h3><p>å‘ <code>xc_course/doc</code> ä¸­æ’å…¥ä»¥ä¸‹ä¸‰ä¸ªæ–‡æ¡£æ•°æ®ï¼š</p>
<p>PUTï¼š<a href="http://localhost:9200/xc_course/doc/1" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/1</a></p>
<div class="hljs"><pre><code class="hljs json">&#123; 
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bootstrapå¼€å‘"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Bootstrapæ˜¯ç”±Twitteræ¨å‡ºçš„ä¸€ä¸ªå‰å°é¡µé¢å¼€å‘æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„å¼€å‘æ¡†æ¶ï¼Œæ­¤æ¡†æ¶é›†æˆäº†å¤šç§é¡µé¢æ•ˆæœã€‚æ­¤å¼€å‘æ¡†æ¶åŒ…å«äº†å¤§é‡çš„CSSã€JSç¨‹åºä»£ç ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯ä¸æ“…é•¿é¡µé¢å¼€å‘çš„ç¨‹åºäººå‘˜ï¼‰è½»æ¾çš„å®ç°ä¸€ä¸ªä¸å—æµè§ˆå™¨é™åˆ¶çš„ç²¾ç¾ç•Œé¢æ•ˆæœã€‚"</span>,
    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201002"</span>,
    <span class="hljs-attr">"price"</span>:<span class="hljs-number">38.6</span>,
    <span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2018-04-25 19:11:35"</span>,
 <span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg"</span>
&#125;</code></pre></div>

<p>PUTï¼š<a href="http://localhost:9200/xc_course/doc/2" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/2</a></p>
<div class="hljs"><pre><code class="hljs json">&#123; 
	<span class="hljs-attr">"name"</span>: <span class="hljs-string">"javaç¼–ç¨‹åŸºç¡€"</span>,
<span class="hljs-attr">"description"</span>: <span class="hljs-string">"javaè¯­è¨€æ˜¯ä¸–ç•Œç¬¬ä¸€ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è½¯ä»¶å¼€å‘é¢†åŸŸä½¿ç”¨äººæ•°æœ€å¤šã€‚"</span>,
<span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,
<span class="hljs-attr">"price"</span>:<span class="hljs-number">68.6</span>,
<span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2018-03-25 19:11:35"</span>,
<span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg"</span>
&#125;</code></pre></div>

<p>PUTï¼š<a href="http://localhost:9200/xc_course/doc/3" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/3</a></p>
<div class="hljs"><pre><code class="hljs json">&#123; 
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"spring åœ¨javaé¢†åŸŸéå¸¸æµè¡Œï¼Œjavaç¨‹åºå‘˜éƒ½åœ¨ç”¨ã€‚"</span>,
    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,
    <span class="hljs-attr">"price"</span>:<span class="hljs-number">88.6</span>,
    <span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2018-02-24 19:11:35"</span>,
  <span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/00/wKhlQFs6RCeAY0pHAAJx5ZjNDEM428.jpg"</span>
&#125;</code></pre></div>

<h3 id="3ã€ç®€å•çš„æœç´¢ä¸€ä¸‹"><a href="#3ã€ç®€å•çš„æœç´¢ä¸€ä¸‹" class="headerlink" title="3ã€ç®€å•çš„æœç´¢ä¸€ä¸‹"></a>3ã€ç®€å•çš„æœç´¢ä¸€ä¸‹</h3><p>ç®€å•æœç´¢å°±æ˜¯é€šè¿‡ <code>url</code> è¿›è¡ŒæŸ¥è¯¢ï¼Œä»¥ <code>get</code> æ–¹å¼è¯·æ±‚ <code>ES</code>ã€‚</p>
<p>æ ¼å¼ï¼šGET ../_search?q=â€¦..</p>
<blockquote>
<p>qï¼šæœç´¢å­—ç¬¦ä¸²ã€‚</p>
</blockquote>
<p>ä¾‹å­ï¼š?q=name:spring</p>
<blockquote>
<p>æœç´¢nameä¸­åŒ…æ‹¬springçš„æ–‡æ¡£ã€‚</p>
</blockquote>
<h2 id="2-DSL-æœç´¢"><a href="#2-DSL-æœç´¢" class="headerlink" title="2. DSL æœç´¢"></a>2. DSL æœç´¢</h2><p>DSL(Domain Specific Language) æ˜¯ <code>ES</code> æå‡ºçš„åŸºäº <code>json</code> çš„æœç´¢æ–¹å¼ï¼Œåœ¨æœç´¢æ—¶ä¼ å…¥ç‰¹å®šçš„ <code>json</code> æ ¼å¼çš„æ•°æ®æ¥å®Œæˆä¸åŒçš„æœç´¢éœ€æ±‚ã€‚</p>
<p><code>DSL</code> æ¯” <code>URI</code> (åœ¨urlä¼ é€’æœç´¢å‚æ•°) æœç´¢æ–¹å¼åŠŸèƒ½å¼ºå¤§ï¼Œåœ¨é¡¹ç›®ä¸­å»ºè®®ä½¿ç”¨ <code>DSL</code> æ–¹å¼æ¥å®Œæˆæœç´¢ã€‚</p>
<h3 id="1ã€æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£"><a href="#1ã€æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£" class="headerlink" title="1ã€æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£"></a>1ã€æŸ¥è¯¢æ‰€æœ‰æ–‡æ¡£</h3><p>æŸ¥è¯¢æ‰€æœ‰ç´¢å¼•åº“çš„æ–‡æ¡£ã€‚</p>
<p>å‘é€ï¼špost <a href="http://localhost:9200/_search" target="_blank" rel="noopener">http://localhost:9200/_search</a></p>
<p>æŸ¥è¯¢æŒ‡å®šç´¢å¼•åº“ <strong>æŒ‡å®šç±»å‹</strong> ä¸‹çš„æ–‡æ¡£ã€‚ï¼ˆé€šè¿‡ä½¿ç”¨æ­¤æ–¹æ³•ï¼‰</p>
<p>å‘é€ï¼špost <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"query"</span>: &#123;
    	<span class="hljs-attr">"match_all"</span>: &#123;&#125;
    &#125;,
    <span class="hljs-attr">"_source"</span> : [<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>]
&#125;</code></pre></div>

<blockquote>
<p>_sourceï¼š<code>source</code> æºè¿‡è™‘è®¾ç½®ï¼ŒæŒ‡å®šç»“æœä¸­æ‰€åŒ…æ‹¬çš„å­—æ®µæœ‰å“ªäº›ã€‚</p>
</blockquote>
<p>æœç´¢ç»“æœï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"took"</span>: <span class="hljs-number">9</span>,
    <span class="hljs-attr">"timed_out"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"_shards"</span>: &#123;
        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"successful"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"skipped"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"failed"</span>: <span class="hljs-number">0</span>
    &#125;,
    <span class="hljs-attr">"hits"</span>: &#123;
        <span class="hljs-attr">"total"</span>: <span class="hljs-number">3</span>,
        <span class="hljs-attr">"max_score"</span>: <span class="hljs-number">1.0</span>,
        <span class="hljs-attr">"hits"</span>: [
            &#123;
                <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,
                <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"1"</span>,
                <span class="hljs-attr">"_score"</span>: <span class="hljs-number">1.0</span>,
                <span class="hljs-attr">"_source"</span>: &#123;
                    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201002"</span>,
                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bootstrapå¼€å‘"</span>
                &#125;
            &#125;,
            &#123;
                <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,
                <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"2"</span>,
                <span class="hljs-attr">"_score"</span>: <span class="hljs-number">1.0</span>,
                <span class="hljs-attr">"_source"</span>: &#123;
                    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,
                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"javaç¼–ç¨‹åŸºç¡€"</span>
                &#125;
            &#125;,
            &#123;
                <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,
                <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"3"</span>,
                <span class="hljs-attr">"_score"</span>: <span class="hljs-number">1.0</span>,
                <span class="hljs-attr">"_source"</span>: &#123;
                    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,
                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>
                &#125;
            &#125;
        ]
    &#125;
&#125;</code></pre></div>

<p>ç»“æœè¯´æ˜ï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µåç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>took</td>
<td>æœ¬æ¬¡æ“ä½œèŠ±è´¹çš„æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚</td>
</tr>
<tr>
<td>timed_out</td>
<td>è¯·æ±‚æ˜¯å¦è¶…æ—¶</td>
</tr>
<tr>
<td>_shards</td>
<td>è¯´æ˜æœ¬æ¬¡æ“ä½œå…±æœç´¢äº†å“ªäº›åˆ†ç‰‡</td>
</tr>
<tr>
<td>hits</td>
<td>æœç´¢å‘½ä¸­çš„è®°å½•</td>
</tr>
<tr>
<td>hits.total</td>
<td>ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£æ€»æ•° hits.hits ï¼šåŒ¹é…åº¦è¾ƒé«˜çš„å‰Nä¸ªæ–‡æ¡£</td>
</tr>
<tr>
<td>hits.max_score</td>
<td>æ–‡æ¡£åŒ¹é…å¾—åˆ†ï¼Œè¿™é‡Œä¸ºæœ€é«˜åˆ†</td>
</tr>
<tr>
<td>_score</td>
<td>æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªåŒ¹é…åº¦å¾—åˆ†ï¼ŒæŒ‰ç…§é™åºæ’åˆ—ã€‚</td>
</tr>
<tr>
<td>_source</td>
<td>æ˜¾ç¤ºäº†æ–‡æ¡£çš„åŸå§‹å†…å®¹ã€‚</td>
</tr>
</tbody></table>
<p><strong>ä½¿ç”¨JAVA å®¢æˆ·ç«¯å®ç°ï¼š</strong></p>
<ul>
<li>åˆ›å»ºæœç´¢è¯·æ±‚å¯¹è±¡</li>
<li>æŒ‡å®šç±»å‹ï¼ˆéƒ¨åˆ†ç‰ˆæœ¬ä¸éœ€è¦æŒ‡å®šç±»å‹ï¼Œè¿™é‡Œä»¥ <code>6.2.1</code> ä¸ºä¾‹ï¼‰</li>
<li>æ„å»ºæœç´¢æºå¯¹è±¡</li>
<li>é…ç½®æœç´¢æ–¹å¼ï¼Œè®¾ç½®éœ€è¦è¿‡æ»¤å­—æ®µ</li>
<li>å‘æœç´¢è¯·æ±‚ä¸­è®¾ç½®æœç´¢æº</li>
<li>æ‰§è¡Œæœç´¢ï¼Œå‘ESå‘èµ· <code>http</code> è¯·æ±‚</li>
<li>æœç´¢ç»“æœ <code>asd as</code></li>
<li>åŒ¹é…åˆ°çš„æ€»è®°å½•æ•°</li>
<li>å¾—åˆ°åŒ¹é…åº¦é«˜çš„æ–‡æ¡£</li>
<li>éå†ç»“æœï¼Œè·å– <code>SearchHit</code> å¯¹è±¡ä¸­çš„å±æ€§ï¼Œè¾“å‡ºæˆ–è€…å­˜æ¡£ã€‚</li>
</ul>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestSearch</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    RestHighLevelClient client;

    <span class="hljs-comment">//æœç´¢typeä¸‹çš„å…¨éƒ¨è®°å½•</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSearchAll</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
        <span class="hljs-comment">//è·å–æœç´¢è¯·æ±‚å¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®ç±»å‹</span>
        SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);
        searchRequest.types(<span class="hljs-string">"doc"</span>);
        SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();

        <span class="hljs-comment">//è®¾ç½®æœç´¢æ–¹å¼</span>
        searchSourceBuilder.query(QueryBuilders.matchAllQuery());

        <span class="hljs-comment">//é…ç½®sourceæºå­—æ®µè¿‡è™‘ï¼Œ1æ˜¾ç¤ºçš„ï¼Œ2æ’é™¤çš„</span>
        searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>&#125;, <span class="hljs-keyword">new</span> String[]&#123;&#125;);

        <span class="hljs-comment">//å°†æœç´¢æºé…ç½®åˆ°æœç´¢è¯·æ±‚ä¸­ï¼Œæ‰§è¡Œæœç´¢ï¼Œè·å–æœç´¢å“åº”ç»“æœ</span>
        searchRequest.source(searchSourceBuilder);
        SearchResponse searchResponse = client.search(searchRequest);

        <span class="hljs-comment">//è·å–æ‰€æœ‰æœç´¢ç»“æœã€æ€»åŒ¹é…æ•°é‡</span>
        SearchHits hits = searchResponse.getHits();
        <span class="hljs-keyword">long</span> totalHits = hits.getTotalHits();

        <span class="hljs-comment">//ç­›é€‰å‡ºåŒ¹é…åº¦é«˜çš„æ–‡æ¡£è®°å½•</span>
        SearchHit[] searchHits = hits.getHits();

        <span class="hljs-comment">//éå†ç»“æœ</span>
        <span class="hljs-keyword">for</span> (SearchHit hit : searchHits) &#123;
            String index = hit.getIndex();
            String type = hit.getType();
            String id = hit.getId();
            <span class="hljs-keyword">float</span> score = hit.getScore();
            String sourceAsString = hit.getSourceAsString();
            Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();
            String name = (String) sourceAsMap.get(<span class="hljs-string">"name"</span>);
            String studymodel = (String) sourceAsMap.get(<span class="hljs-string">"studymodel"</span>);
            String description = (String) sourceAsMap.get(<span class="hljs-string">"description"</span>);
            System.out.println(name);
            System.out.println(studymodel);
            System.out.println(description);
        &#125;
    &#125;
&#125;</code></pre></div>

<h3 id="2ã€åˆ†é¡µæŸ¥è¯¢"><a href="#2ã€åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="2ã€åˆ†é¡µæŸ¥è¯¢"></a>2ã€åˆ†é¡µæŸ¥è¯¢</h3><p><code>ES</code> æ”¯æŒåˆ†é¡µæŸ¥è¯¢ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š<code>from</code> å’Œ <code>size</code>ã€‚</p>
<ul>
<li>formï¼šè¡¨ç¤ºèµ·å§‹æ–‡æ¡£çš„ä¸‹æ ‡ï¼Œä»0å¼€å§‹ã€‚</li>
<li>sizeï¼šæŸ¥è¯¢çš„æ–‡æ¡£æ•°é‡ã€‚</li>
</ul>
<p>å‘é€ï¼špost <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"from"</span> : <span class="hljs-number">0</span>, 
    <span class="hljs-attr">"size"</span> : <span class="hljs-number">1</span>,
    <span class="hljs-attr">"query"</span>: &#123;
    	<span class="hljs-attr">"match_all"</span>: &#123;&#125;
    &#125;,
    <span class="hljs-attr">"_source"</span> : [<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>]
&#125;</code></pre></div>

<p><strong>ä½¿ç”¨JAVA å®¢æˆ·ç«¯å®ç°ï¼š</strong></p>
<div class="hljs"><pre><code class="hljs java"> <span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSearchPage</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    <span class="hljs-comment">//è·å–æœç´¢è¯·æ±‚å¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®ç±»å‹</span>
    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);
    searchRequest.types(<span class="hljs-string">"doc"</span>);
    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();

    <span class="hljs-comment">//è®¾ç½®æœç´¢æ–¹å¼</span>
    searchSourceBuilder.query(QueryBuilders.matchAllQuery());

    <span class="hljs-comment">//ESè¿™é‡Œæ˜¯æŒ‰èµ·å§‹åæ ‡æ¥å®ç°åˆ†é¡µæŸ¥è¯¢,æ‰€ä»¥æˆ‘ä»¬è¦æŒ‡å®šä¸€ä¸ªé¡µç </span>
    <span class="hljs-keyword">int</span> pageNum = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> size = <span class="hljs-number">2</span>;
    <span class="hljs-comment">//é€šè¿‡é¡µç å’ŒæŸ¥è¯¢æ•°é‡å¾—å‡ºèµ·å§‹ä½ç½®</span>
    <span class="hljs-keyword">int</span> fromNum = (pageNum - <span class="hljs-number">1</span>) * size;
    <span class="hljs-comment">//åˆ†é¡µæŸ¥è¯¢ï¼Œè®¾ç½®èµ·å§‹ä¸‹æ ‡ï¼Œä»0å¼€å§‹</span>
    searchSourceBuilder.from(<span class="hljs-number">0</span>);
    <span class="hljs-comment">//æ¯é¡µæ˜¾ç¤ºä¸ªæ•°</span>
    searchSourceBuilder.size(size);
    <span class="hljs-comment">//é…ç½®sourceæºå­—æ®µè¿‡è™‘ï¼Œ1æ˜¾ç¤ºçš„ï¼Œ2æ’é™¤çš„</span>
    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>&#125;, <span class="hljs-keyword">new</span> String[]&#123;&#125;);

    <span class="hljs-comment">//å°†æœç´¢æºé…ç½®åˆ°æœç´¢è¯·æ±‚ä¸­ï¼Œæ‰§è¡Œæœç´¢ï¼Œè·å–æœç´¢å“åº”ç»“æœ</span>
    searchRequest.source(searchSourceBuilder);
    SearchResponse searchResponse = restHighLevelClient.search(searchRequest);

    <span class="hljs-comment">//è·å–æ‰€æœ‰æœç´¢ç»“æœã€æ€»åŒ¹é…æ•°é‡</span>
    SearchHits hits = searchResponse.getHits();
    <span class="hljs-keyword">long</span> totalHits = hits.getTotalHits();

    <span class="hljs-comment">//ç­›é€‰å‡ºåŒ¹é…åº¦é«˜çš„æ–‡æ¡£è®°å½•</span>
    SearchHit[] searchHits = hits.getHits();

    <span class="hljs-comment">//éå†ç»“æœ</span>
    <span class="hljs-keyword">for</span>(SearchHit hit : searchHits)&#123;
        System.out.println(hit.toString());
    &#125;
&#125;</code></pre></div>

<h3 id="3ã€Term-Query"><a href="#3ã€Term-Query" class="headerlink" title="3ã€Term Query"></a>3ã€Term Query</h3><p><code>Term Query</code> ä¸ºç²¾ç¡®æŸ¥è¯¢ï¼Œåœ¨æœç´¢æ—¶ä¼šæ•´ä½“åŒ¹é…å…³é”®å­—ï¼Œä¸å†å°†å…³é”®å­—åˆ†è¯ã€‚</p>
<p>å‘é€ï¼špost <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"query"</span>: &#123;
        <span class="hljs-attr">"term"</span> : &#123;
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"spring"</span>
        &#125;
    &#125;,
    <span class="hljs-attr">"_source"</span> : [<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>]
&#125;</code></pre></div>

<p>ä¸Šè¾¹çš„æœç´¢ä¼šæŸ¥è¯¢ <code>name</code> åŒ…æ‹¬ <code>spring</code> è¿™ä¸ªè¯çš„æ–‡æ¡£ã€‚</p>
<p><strong>JAVAå®¢æˆ·ç«¯å®ç°ï¼š</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">     * Term Query ç²¾ç¡®æŸ¥è¯¢</span>
<span class="hljs-comment">     */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">TestSearchTermQuery</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);
    searchRequest.types(<span class="hljs-string">"doc"</span>);
    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();
    <span class="hljs-comment">//è®¾ç½®æŸ¥è¯¢ç±»å‹ä¸ºtermQuery,ç²¾ç¡®åŒ¹é…nameä¸­åŒ…å«springçš„æ–‡æ¡£</span>
    searchSourceBuilder.query(QueryBuilders.termQuery(<span class="hljs-string">"name"</span>,<span class="hljs-string">"spring"</span>));<span class="hljs-comment">//sourceæºå­—æ®µè¿‡è™‘</span>

    <span class="hljs-comment">//ä¸æŒ‡å®šè¿‡æ»¤æ¡ä»¶åˆ™é»˜è®¤æ˜¾ç¤ºæŸ¥è¯¢åˆ°çš„æ–‡æ¡£çš„æ‰€æœ‰å­—æ®µ</span>
    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;&#125;, <span class="hljs-keyword">new</span> String[]&#123;&#125;);

    <span class="hljs-comment">//è®¾ç½®æœç´¢æºå¹¶è·å–æœç´¢ç»“æœ</span>
    searchRequest.source(searchSourceBuilder);
    SearchResponse searchResponse = restHighLevelClient.search(searchRequest);

    <span class="hljs-comment">//è·å–æœç´¢ç»“æœ</span>
    <span class="hljs-comment">//  .getHits() å–æœ¬æ¬¡æ‰€æœ‰åŒ¹é…ç»“æœ</span>
    <span class="hljs-comment">//  .getHits().getHits() ç­›é€‰å‡ºåŒ¹é…åº¦é«˜çš„æ–‡æ¡£è®°å½•</span>
    SearchHits hits = searchResponse.getHits();
    <span class="hljs-keyword">long</span> totalHits = hits.getTotalHits();
    <span class="hljs-comment">//ç­›é€‰åŒ¹é…åº¦æœ€é«˜çš„ç»“æœ</span>
    SearchHit[] searchHits = hits.getHits();

    System.out.println(<span class="hljs-string">"ç»“æœæ•°é‡ä¸º: "</span> + totalHits);
    <span class="hljs-comment">//è¾“å‡ºæœç´¢ç»“æœ</span>
    <span class="hljs-keyword">for</span>(SearchHit hit : searchHits)&#123;
        System.out.println(hit.getSourceAsMap());
    &#125;
&#125;</code></pre></div>

<h3 id="4ã€æ ¹æ®idç²¾ç¡®åŒ¹é…"><a href="#4ã€æ ¹æ®idç²¾ç¡®åŒ¹é…" class="headerlink" title="4ã€æ ¹æ®idç²¾ç¡®åŒ¹é…"></a>4ã€æ ¹æ®idç²¾ç¡®åŒ¹é…</h3><p>ESæä¾›æ ¹æ®å¤šä¸ªidå€¼åŒ¹é…çš„æ–¹æ³•ï¼š</p>
<p>postï¼š <a href="http://127.0.0.1:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://127.0.0.1:9200/xc_course/doc/_search</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"query"</span>: &#123;
        <span class="hljs-attr">"ids"</span> : &#123;
            <span class="hljs-attr">"type"</span> : <span class="hljs-string">"doc"</span>,
            <span class="hljs-attr">"values"</span> : [<span class="hljs-string">"3"</span>, <span class="hljs-string">"4"</span>, <span class="hljs-string">"100"</span>]
        &#125;
    &#125;
&#125;</code></pre></div>

<p><strong>JAVAå®¢æˆ·ç«¯å®ç°ï¼š</strong></p>
<div class="hljs"><pre><code class="hljs java">String[] split = <span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"1"</span>,<span class="hljs-string">"2"</span>&#125;;
List&lt;String&gt; idList = Arrays.asList(split);
searchSourceBuilder.query(QueryBuilders.termsQuery(<span class="hljs-string">"_id"</span>, idList));</code></pre></div>

<h3 id="5ã€match-query-åŒ¹é…å•ä¸ªå­—æ®µ"><a href="#5ã€match-query-åŒ¹é…å•ä¸ªå­—æ®µ" class="headerlink" title="5ã€match query (åŒ¹é…å•ä¸ªå­—æ®µ)"></a>5ã€match query (åŒ¹é…å•ä¸ªå­—æ®µ)</h3><h4 id="1-åŸºæœ¬ä½¿ç”¨"><a href="#1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="(1) åŸºæœ¬ä½¿ç”¨"></a>(1) åŸºæœ¬ä½¿ç”¨</h4><p><code>match query</code> å³å…¨æ–‡æ£€ç´¢ï¼Œå®ƒçš„æœç´¢æ–¹å¼æ˜¯å…ˆå°†æœç´¢å­—ç¬¦ä¸²åˆ†è¯ï¼Œå†ä½¿ç”¨å„å„è¯æ¡ä»ç´¢å¼•ä¸­æœç´¢ã€‚</p>
<p><code>match query</code> ä¸ <code>Term query</code> åŒºåˆ«æ˜¯ <code>match query</code> åœ¨æœç´¢å‰å…ˆå°†æœç´¢å…³é”®å­—åˆ†è¯ï¼Œå†æ‹¿å„å„è¯è¯­å»ç´¢å¼•ä¸­æœç´¢ã€‚</p>
<p>éœ€æ±‚ï¼šæ£€ç´¢ <code>name</code> å­—æ®µä¸­åŒ…å« springå¼€å‘ çš„æ–‡æ¡£ï¼Œå¹¶ä¸”ç»“æœåªæ˜¾ç¤ºè¯¥æ–‡æ¡£çš„ name å­—æ®µ</p>
<p>å‘é€ï¼špost <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"query"</span>: &#123;
        <span class="hljs-attr">"match"</span>: &#123;
            <span class="hljs-attr">"name"</span>: &#123;
                <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springå¼€å‘"</span>,
                <span class="hljs-attr">"operator"</span>: <span class="hljs-string">"or"</span>
            &#125;
        &#125;
    &#125;,
	<span class="hljs-attr">"_source"</span> : [<span class="hljs-string">"name"</span>]
&#125;</code></pre></div>

<ul>
<li>queryï¼šæœç´¢çš„å…³é”®å­—ï¼Œå¯¹äºè‹±æ–‡å…³é”®å­—å¦‚æœæœ‰å¤šä¸ªå•è¯åˆ™ä¸­é—´è¦ç”¨åŠè§’é€—å·åˆ†éš”ï¼Œè€Œå¯¹äºä¸­æ–‡å…³é”®å­—ä¸­é—´å¯ä»¥ç”¨é€—å·åˆ†éš”ä¹Ÿå¯ä»¥ä¸ç”¨ã€‚</li>
<li>operatorï¼š<code>or</code> è¡¨ç¤º åªè¦æœ‰ä¸€ä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°åˆ™å°±ç¬¦åˆæ¡ä»¶, <code>and</code> è¡¨ç¤ºæ¯ä¸ªè¯éƒ½åœ¨æ–‡æ¡£ä¸­å‡ºç°åˆ™æ‰ç¬¦åˆæ¡ä»¶</li>
</ul>
<p><strong>operator</strong>ï¼š<code>or</code> è¡¨ç¤º åªè¦æœ‰ä¸€ä¸ªè¯åœ¨æ–‡æ¡£ä¸­å‡ºç°åˆ™å°±ç¬¦åˆæ¡ä»¶, <code>and</code> è¡¨ç¤ºæ¯ä¸ªè¯éƒ½åœ¨æ–‡æ¡£ä¸­å‡ºç°åˆ™æ‰ç¬¦åˆæ¡ä»¶</p>
<p>æœç´¢ç»“æœï¼š</p>
<div class="hljs"><pre><code class="hljs json">"hits": [
    &#123;
        <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,
        <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"3"</span>,
        <span class="hljs-attr">"_score"</span>: <span class="hljs-number">1.3802519</span>,
        <span class="hljs-attr">"_source"</span>: &#123;
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>
        &#125;
    &#125;,
    &#123;
        <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,
        <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"1"</span>,
        <span class="hljs-attr">"_score"</span>: <span class="hljs-number">0.52354836</span>,
        <span class="hljs-attr">"_source"</span>: &#123;
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bootstrapå¼€å‘"</span>
        &#125;
    &#125;
]</code></pre></div>

<p>ä¸Šè¾¹çš„æœç´¢çš„æ‰§è¡Œè¿‡ç¨‹æ˜¯ï¼š</p>
<p>1ã€å°† <code>springå¼€å‘</code> åˆ†è¯ï¼Œåˆ†ä¸º <code>spring</code>ã€<code>å¼€å‘</code> ä¸¤ä¸ªè¯</p>
<p>2ã€å†ä½¿ç”¨ <code>spring</code> å’Œå¼€å‘ä¸¤ä¸ªè¯å»åŒ¹é…ç´¢å¼•ä¸­æœç´¢ã€‚</p>
<p>3ã€ç”±äºè®¾ç½®äº† <code>operator</code> ä¸º <code>or</code>ï¼Œåªè¦æœ‰ä¸€ä¸ªè¯åŒ¹é…æˆåŠŸåˆ™å°±è¿”å›è¯¥æ–‡æ¡£ã€‚</p>
<p>æˆ‘ä»¬å°† operator è®¾ç½®ä¸º <code>and</code> å†æ¬¡è¿›è¡Œæœç´¢</p>
<div class="hljs"><pre><code class="hljs json">"hits": [
    &#123;
        <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,
        <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,
        <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"3"</span>,
        <span class="hljs-attr">"_score"</span>: <span class="hljs-number">1.3802519</span>,
        <span class="hljs-attr">"_source"</span>: &#123;
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>
        &#125;
    &#125;
]</code></pre></div>

<p>ä»ç»“æœä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ <code>and</code> è¿›è¡Œæœç´¢åï¼ŒESä¼šåŒ¹é…æŒ‡å®šçš„å­—æ®µåŒ…å« <code>spring</code>ã€<code>å¼€å‘</code> ä¸¤ä¸ªè¯çš„ç»“æœã€‚</p>
<p><strong>JAVAå®¢æˆ·ç«¯å®ç°ï¼š</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">     * æ ¹æ®å…³é”®å­—æœç´¢</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException</span>
<span class="hljs-comment">     */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testMatchQuery</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);
    searchRequest.types(<span class="hljs-string">"doc"</span>);
    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();
    <span class="hljs-comment">//sourceæºå­—æ®µè¿‡è™‘</span>
    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>&#125;, <span class="hljs-keyword">new</span> String[]&#123;&#125;);
    <span class="hljs-comment">//è®¾ç½®è¿‡æ»¤å™¨ï¼ŒåŒ¹é…å…³é”®å­—</span>
    searchSourceBuilder.query(QueryBuilders.matchQuery(<span class="hljs-string">"description"</span>, <span class="hljs-string">"springå¼€å‘"</span>).operator(Operator.OR));
    searchRequest.source(searchSourceBuilder);

    <span class="hljs-comment">//æ‰§è¡Œæœç´¢è¯·æ±‚</span>
    SearchResponse searchResponse = client.search(searchRequest);
    SearchHits hits = searchResponse.getHits();
    SearchHit[] searchHits = hits.getHits();

    <span class="hljs-comment">//è¾“å‡ºæœç´¢ç»“æœ</span>
    <span class="hljs-keyword">for</span>(SearchHit hit : searchHits)&#123;
        System.out.println(hit.getSourceAsMap());
    &#125;
&#125;</code></pre></div>

<h4 id="2-minimum-should-match"><a href="#2-minimum-should-match" class="headerlink" title="(2) minimum_should_match"></a>(2) minimum_should_match</h4><p>ä¸Šè¾¹ä½¿ç”¨çš„ <code>operator = or</code> è¡¨ç¤ºåªè¦æœ‰ä¸€ä¸ªè¯åŒ¹é…ä¸Šå°±å¾—åˆ†ï¼Œå¦‚æœå®ç°ä¸‰ä¸ªè¯è‡³å°‘æœ‰ä¸¤ä¸ªè¯åŒ¹é…å¦‚ä½•å®ç°ï¼Ÿä½¿ç”¨ <code>minimum_should_match</code> å¯ä»¥æŒ‡å®šæ–‡æ¡£åŒ¹é…è¯çš„å æ¯”ï¼š</p>
<p>æ¯”å¦‚æœç´¢è¯­å¥å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"query"</span>: &#123;
        <span class="hljs-attr">"match"</span>: &#123;
            <span class="hljs-attr">"description"</span>: &#123;
                <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springå¼€å‘æ¡†æ¶"</span>,
                <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"80%"</span>
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div>

<p><code>springå¼€å‘æ¡†æ¶</code> ä¼šè¢«åˆ†ä¸ºä¸‰ä¸ªè¯ï¼š<code>spring</code>ã€<code>å¼€å‘</code>ã€<code>æ¡†æ¶</code></p>
<p>è®¾ç½® <code>minimum_should_match:80%</code> è¡¨ç¤ºï¼Œä¸‰ä¸ªè¯åœ¨æ–‡æ¡£çš„åŒ¹é…å æ¯”ä¸º <strong>80%</strong>ï¼Œå³ 3<em>0.8=2.4ï¼Œå‘ä¸Šå–æ•´å¾—2ï¼Œè¡¨ç¤ºè‡³å°‘æœ‰ *</em>ä¸¤ä¸ªè¯** åœ¨æ–‡æ¡£ä¸­è¦åŒ¹é…æˆåŠŸã€‚</p>
<p>å¯¹åº”çš„ <code>RestClient</code> å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//åŒ¹é…å…³é”®å­—</span>
MatchQueryBuilder matchQueryBuilder = QueryBuilders.matchQuery(<span class="hljs-string">"description"</span>, <span class="hljs-string">"å‰å°é¡µé¢å¼€å‘æ¡†æ¶ æ¶æ„"</span>).minimumShouldMatch(<span class="hljs-string">"80%"</span>);<span class="hljs-comment">//è®¾ç½®åŒ¹é…å æ¯”</span>
searchSourceBuilder.query(matchQueryBuilder);</code></pre></div>

<h3 id="6ã€multi-query-åŒ¹é…å¤šä¸ªå­—æ®µ"><a href="#6ã€multi-query-åŒ¹é…å¤šä¸ªå­—æ®µ" class="headerlink" title="6ã€multi query (åŒ¹é…å¤šä¸ªå­—æ®µ)"></a>6ã€multi query (åŒ¹é…å¤šä¸ªå­—æ®µ)</h3><p>ä¸Šè¾¹å­¦ä¹ çš„ <code>termQuery</code> å’Œ <code>matchQuery</code> ä¸€æ¬¡åªèƒ½åŒ¹é…ä¸€ä¸ª <code>Field</code>ï¼Œæœ¬èŠ‚å­¦ä¹  <code>multiQuery</code>ï¼Œä¸€æ¬¡å¯ä»¥åŒ¹é…å¤šä¸ªå­—æ®µã€‚</p>
<h4 id="1-åŸºæœ¬ä½¿ç”¨-1"><a href="#1-åŸºæœ¬ä½¿ç”¨-1" class="headerlink" title="(1) åŸºæœ¬ä½¿ç”¨"></a>(1) åŸºæœ¬ä½¿ç”¨</h4><p>å•é¡¹åŒ¹é…æ˜¯åœ¨ä¸€ä¸ª <code>field</code> ä¸­å»åŒ¹é…ï¼Œå¤šé¡¹åŒ¹é…æ˜¯æ‹¿å…³é”®å­—å»å¤šä¸ª <code>Field</code> ä¸­åŒ¹é…ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p>
<p>å‘é€ï¼špost <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p>
<p>æ‹¿å…³é”®å­— <code>spring css</code>å»åŒ¹é… <code>name</code> å’Œ <code>description</code> å­—æ®µã€‚</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"query"</span>: &#123;
        <span class="hljs-attr">"multi_match"</span>: &#123;
            <span class="hljs-attr">"query"</span>: <span class="hljs-string">"spring css"</span>,
            <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"50%"</span>,
            <span class="hljs-attr">"fields"</span>: [
                <span class="hljs-string">"name"</span>,
                <span class="hljs-string">"description"</span>
            ]
        &#125;
    &#125;
&#125;</code></pre></div>

<h4 id="2-æå‡-boost-æƒé‡"><a href="#2-æå‡-boost-æƒé‡" class="headerlink" title="(2) æå‡ boost (æƒé‡)"></a>(2) æå‡ boost (æƒé‡)</h4><p>åŒ¹é…å¤šä¸ªå­—æ®µæ—¶å¯ä»¥æå‡å­—æ®µçš„ <code>boost</code>ï¼ˆæƒé‡ï¼‰æ¥æé«˜å¾—åˆ†</p>
<p>ä¾‹å­ï¼šæå‡ <code>boost</code>ä¹‹å‰ï¼Œæ‰§è¡Œä¸‹è¾¹çš„æŸ¥è¯¢ï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"query"</span>: &#123;
        <span class="hljs-attr">"multi_match"</span>: &#123;
            <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springæ¡†æ¶"</span>,
            <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"50%"</span>,
            <span class="hljs-attr">"fields"</span>: [
                <span class="hljs-string">"name"</span>,
                <span class="hljs-string">"description"</span>
            ]
        &#125;
    &#125;
&#125;</code></pre></div>

<p>é€šè¿‡æŸ¥è¯¢å‘ç° <code>Bootstrap</code> æ’åœ¨å‰è¾¹ã€‚</p>
<p>æå‡ <code>boost</code>ï¼Œé€šå¸¸å…³é”®å­—åŒ¹é…ä¸Š <code>name</code> çš„æƒé‡è¦æ¯”åŒ¹é…ä¸Š <code>description</code> çš„æƒé‡é«˜ï¼Œè¿™é‡Œå¯ä»¥å¯¹<code>name</code> çš„æƒé‡æå‡ã€‚</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"query"</span>: &#123;
        <span class="hljs-attr">"multi_match"</span>: &#123;
            <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springæ¡†æ¶"</span>,
            <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"50%"</span>,
            <span class="hljs-attr">"fields"</span>: [
                <span class="hljs-string">"name^10"</span>,
                <span class="hljs-string">"description"</span>
            ]
        &#125;
    &#125;
&#125;</code></pre></div>

<p><code>name^10</code> è¡¨ç¤ºæƒé‡æå‡ <code>10</code> å€ï¼Œæ‰§è¡Œä¸Šè¾¹çš„æŸ¥è¯¢ï¼Œå‘ç° <code>name</code> ä¸­åŒ…æ‹¬ <code>spring</code> å…³é”®å­—çš„æ–‡æ¡£æ’åœ¨å‰è¾¹ã€‚</p>
<p><strong>JAVA å®¢æˆ·ç«¯ï¼š</strong></p>
<div class="hljs"><pre><code class="hljs java">MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(<span class="hljs-string">"springæ¡†æ¶"</span>,<span class="hljs-string">"name"</span>, <span class="hljs-string">"description"</span>)
.minimumShouldMatch(<span class="hljs-string">"50%"</span>);
multiMatchQueryBuilder.field(<span class="hljs-string">"name"</span>,<span class="hljs-number">10</span>);<span class="hljs-comment">//æå‡boost</span></code></pre></div>

<h3 id="7ã€å¸ƒå°”æŸ¥è¯¢"><a href="#7ã€å¸ƒå°”æŸ¥è¯¢" class="headerlink" title="7ã€å¸ƒå°”æŸ¥è¯¢"></a>7ã€å¸ƒå°”æŸ¥è¯¢</h3><p>å¸ƒå°”æŸ¥è¯¢å¯¹åº”äº <code>Lucene</code> çš„ <code>BooleanQuery</code> æŸ¥è¯¢ï¼Œå®ç°å°†å¤šä¸ªæŸ¥è¯¢ç»„åˆèµ·æ¥ã€‚</p>
<p>ä¸‰ä¸ªå‚æ•°ï¼š</p>
<p><code>must</code>ï¼šæ–‡æ¡£å¿…é¡»åŒ¹é… <code>must</code> æ‰€åŒ…æ‹¬çš„æŸ¥è¯¢æ¡ä»¶ï¼Œç›¸å½“äº <code>AND</code></p>
<p><code>should</code>ï¼šæ–‡æ¡£åº”è¯¥åŒ¹é… <code>should</code> æ‰€åŒ…æ‹¬çš„æŸ¥è¯¢æ¡ä»¶å…¶ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œç›¸å½“äº <code>OR</code></p>
<p><code>must_not</code>ï¼šæ–‡æ¡£ä¸èƒ½åŒ¹é… <code>must_not</code> æ‰€åŒ…æ‹¬çš„è¯¥æŸ¥è¯¢æ¡ä»¶ï¼Œç›¸å½“äº <code>NOT</code></p>
<p>åˆ†åˆ«ä½¿ç”¨ <code>must</code>ã€<code>should</code>ã€<code>must_not</code> æµ‹è¯•ä¸‹è¾¹çš„æŸ¥è¯¢ï¼š</p>
<p>å‘é€ï¼šPOST <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"_source"</span>: [
        <span class="hljs-string">"name"</span>,
        <span class="hljs-string">"studymodel"</span>,
        <span class="hljs-string">"description"</span>
    ],
    <span class="hljs-attr">"from"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"size"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">"query"</span>: &#123;
        <span class="hljs-attr">"bool"</span>: &#123;
            <span class="hljs-attr">"must"</span>: [
                &#123;
                    <span class="hljs-attr">"multi_match"</span>: &#123;
                        <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springæ¡†æ¶"</span>,
                        <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"50%"</span>,
                        <span class="hljs-attr">"fields"</span>: [
                            <span class="hljs-string">"name^10"</span>,
                            <span class="hljs-string">"description"</span>
                        ]
                    &#125;
                &#125;,
                &#123;
                    <span class="hljs-attr">"term"</span>: &#123;
                        <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>
                    &#125;
                &#125;
            ]
        &#125;
    &#125;
&#125;</code></pre></div>

<p><code>must</code>ï¼šè¡¨ç¤ºå¿…é¡»ï¼Œå¤šä¸ªæŸ¥è¯¢æ¡ä»¶å¿…é¡»éƒ½æ»¡è¶³ã€‚ï¼ˆé€šå¸¸ä½¿ç”¨<code>must</code>ï¼‰</p>
<p><code>should</code>ï¼šè¡¨ç¤ºæˆ–è€…ï¼Œå¤šä¸ªæŸ¥è¯¢æ¡ä»¶åªè¦æœ‰ä¸€ä¸ªæ»¡è¶³å³å¯ã€‚</p>
<p><code>must_not</code>ï¼šè¡¨ç¤ºéã€‚</p>
<p><strong>JAVAå®¢æˆ·ç«¯å®ç°ï¼š</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//BoolQueryï¼Œå°†æœç´¢å…³é”®å­—åˆ†è¯ï¼Œæ‹¿åˆ†è¯å»ç´¢å¼•åº“æœç´¢</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testBoolQuery</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    <span class="hljs-comment">//åˆ›å»ºæœç´¢è¯·æ±‚å¯¹è±¡</span>
    SearchRequest searchRequest= <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);
    searchRequest.types(<span class="hljs-string">"doc"</span>);
    <span class="hljs-comment">//åˆ›å»ºæœç´¢æºé…ç½®å¯¹è±¡</span>
    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();
    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"pic"</span>,<span class="hljs-string">"studymodel"</span>&#125;,<span class="hljs-keyword">new</span> String[]&#123;&#125;);
    <span class="hljs-comment">//multiQuery</span>
    String keyword = <span class="hljs-string">"springå¼€å‘æ¡†æ¶"</span>;
    MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(<span class="hljs-string">"springæ¡†æ¶"</span>,
    <span class="hljs-string">"name"</span>, <span class="hljs-string">"description"</span>)
    .minimumShouldMatch(<span class="hljs-string">"50%"</span>);
    multiMatchQueryBuilder.field(<span class="hljs-string">"name"</span>,<span class="hljs-number">10</span>);
    <span class="hljs-comment">//TermQuery</span>
    TermQueryBuilder termQueryBuilder = QueryBuilders.termQuery(<span class="hljs-string">"studymodel"</span>, <span class="hljs-string">"201001"</span>);
    <span class="hljs-comment">//å¸ƒå°”æŸ¥è¯¢</span>
    BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();
    boolQueryBuilder.must(multiMatchQueryBuilder);
    boolQueryBuilder.must(termQueryBuilder);
    <span class="hljs-comment">//è®¾ç½®å¸ƒå°”æŸ¥è¯¢å¯¹è±¡</span>
    searchSourceBuilder.query(boolQueryBuilder);
    searchRequest.source(searchSourceBuilder);<span class="hljs-comment">//è®¾ç½®æœç´¢æºé…ç½®</span>
    SearchResponse searchResponse = client.search(searchRequest);
    SearchHits hits = searchResponse.getHits();
    SearchHit[] searchHits = hits.getHits();
    <span class="hljs-keyword">for</span>(SearchHit hit:searchHits)&#123;
        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();
        System.out.println(sourceAsMap);
    &#125;
&#125;</code></pre></div>

<h3 id="8ã€è¿‡æ»¤å™¨"><a href="#8ã€è¿‡æ»¤å™¨" class="headerlink" title="8ã€è¿‡æ»¤å™¨"></a>8ã€è¿‡æ»¤å™¨</h3><p>è¿‡è™‘æ˜¯é’ˆå¯¹ <strong>æœç´¢çš„ç»“æœ</strong> è¿›è¡Œè¿‡è™‘ï¼Œè¿‡è™‘å™¨ä¸»è¦åˆ¤æ–­çš„æ˜¯æ–‡æ¡£æ˜¯å¦åŒ¹é…ï¼Œä¸å» <strong>è®¡ç®—å’Œåˆ¤æ–­æ–‡æ¡£çš„åŒ¹é…åº¦å¾—åˆ†</strong>ï¼Œæ‰€ä»¥è¿‡è™‘å™¨çš„ <strong>æ€§èƒ½</strong> æ¯”æŸ¥è¯¢è¦é«˜ï¼Œä¸”æ–¹ä¾¿ç¼“å­˜ï¼Œæ¨èå°½é‡ä½¿ç”¨è¿‡è™‘å™¨å»å®ç°æŸ¥è¯¢æˆ–è€… <strong>è¿‡è™‘å™¨</strong> å’Œ <strong>æŸ¥è¯¢</strong> å…±åŒä½¿ç”¨ã€‚</p>
<p>è¿‡è™‘å™¨åœ¨å¸ƒå°”æŸ¥è¯¢ä¸­ä½¿ç”¨ï¼Œä¸‹è¾¹æ˜¯åœ¨æœç´¢ç»“æœçš„åŸºç¡€ä¸Šè¿›è¡Œè¿‡æ»¤</p>
<p>å‘é€ï¼šPOST <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"_source"</span>: [
        <span class="hljs-string">"name"</span>,
        <span class="hljs-string">"studymodel"</span>,
        <span class="hljs-string">"description"</span>,
        <span class="hljs-string">"price"</span>
    ],
    <span class="hljs-attr">"query"</span>: &#123;
        <span class="hljs-attr">"bool"</span>: &#123;
            <span class="hljs-attr">"must"</span>: [
                &#123;
                    <span class="hljs-attr">"multi_match"</span>: &#123;
                        <span class="hljs-attr">"query"</span>: <span class="hljs-string">"springæ¡†æ¶"</span>,
                        <span class="hljs-attr">"minimum_should_match"</span>: <span class="hljs-string">"50%"</span>,
                        <span class="hljs-attr">"fields"</span>: [
                            <span class="hljs-string">"name^10"</span>,
                            <span class="hljs-string">"description"</span>
                        ]
                    &#125;
                &#125;
            ],
            <span class="hljs-attr">"filter"</span>: [
                &#123;
                    <span class="hljs-attr">"term"</span>: &#123;
                        <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>
                    &#125;
                &#125;,
                &#123;
                    <span class="hljs-attr">"range"</span>: &#123;
                        <span class="hljs-attr">"price"</span>: &#123;
                            <span class="hljs-attr">"gte"</span>: <span class="hljs-number">60</span>,
                            <span class="hljs-attr">"lte"</span>: <span class="hljs-number">100</span>
                        &#125;
                    &#125;
                &#125;
            ]
        &#125;
    &#125;
&#125;</code></pre></div>

<p>rangeï¼šèŒƒå›´è¿‡è™‘ï¼Œä¿ç•™å¤§äºç­‰äº <code>60</code> å¹¶ä¸”å°äºç­‰äº <code>100</code> çš„è®°å½•ã€‚</p>
<p>termï¼šé¡¹åŒ¹é…è¿‡è™‘ï¼Œä¿ç•™ <code>studymodel</code> ç­‰äº <code>201001</code> çš„è®°å½•ã€‚</p>
<p>æ³¨æ„ï¼š<code>range</code> å’Œ <code>term</code> ä¸€æ¬¡åªèƒ½å¯¹ä¸€ä¸ª <code>Field</code> è®¾ç½®èŒƒå›´è¿‡è™‘ã€‚</p>
<p><strong>JAVA å®¢æˆ·ç«¯å®ç°ï¼š</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//å¸ƒå°”æŸ¥è¯¢ä½¿ç”¨è¿‡è™‘å™¨</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testFilter</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);
    searchRequest.types(<span class="hljs-string">"doc"</span>);
    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();
    <span class="hljs-comment">//sourceæºå­—æ®µè¿‡è™‘</span>
    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>,<span class="hljs-string">"price"</span>,<span class="hljs-string">"description"</span>&#125;,
    <span class="hljs-keyword">new</span> String[]&#123;&#125;);
    searchRequest.source(searchSourceBuilder);
    <span class="hljs-comment">//åŒ¹é…å…³é”®å­—</span>
    MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(<span class="hljs-string">"springæ¡†</span>
<span class="hljs-string">    æ¶"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"description"</span>);
    <span class="hljs-comment">//è®¾ç½®åŒ¹é…å æ¯”</span>
    multiMatchQueryBuilder.minimumShouldMatch(<span class="hljs-string">"50%"</span>);
    <span class="hljs-comment">//æå‡å¦ä¸ªå­—æ®µçš„Boostå€¼</span>
    multiMatchQueryBuilder.field(<span class="hljs-string">"name"</span>,<span class="hljs-number">10</span>);
    searchSourceBuilder.query(multiMatchQueryBuilder);
    <span class="hljs-comment">//å¸ƒå°”æŸ¥è¯¢</span>
    BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();
    boolQueryBuilder.must(searchSourceBuilder.query());
    <span class="hljs-comment">//è¿‡è™‘æ¡ä»¶</span>
    boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"studymodel"</span>, <span class="hljs-string">"201001"</span>));
    boolQueryBuilder.filter(QueryBuilders.rangeQuery(<span class="hljs-string">"price"</span>).gte(<span class="hljs-number">60</span>).lte(<span class="hljs-number">100</span>));
    <span class="hljs-comment">//æ‰§è¡Œæœç´¢</span>
	SearchResponse searchResponse = client.search(searchRequest);
    SearchHits hits = searchResponse.getHits();
    SearchHit[] searchHits = hits.getHits();
    <span class="hljs-keyword">for</span>(SearchHit hit:searchHits)&#123;
        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();
        System.out.println(sourceAsMap);
    &#125;
&#125;</code></pre></div>

<h3 id="9ã€æ’åº"><a href="#9ã€æ’åº" class="headerlink" title="9ã€æ’åº"></a>9ã€æ’åº</h3><p>å¯ä»¥åœ¨å­—æ®µä¸Šæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæ’åºï¼Œæ”¯æŒåœ¨ <code>keyword</code>ã€<code>date</code>ã€<code>float</code> ç­‰ç±»å‹ä¸Šæ·»åŠ ï¼Œ<code>text</code> ç±»å‹çš„å­—æ®µä¸Šä¸å…è®¸æ·»åŠ æ’åºã€‚</p>
<p>éœ€æ±‚ï¼šè¿‡è™‘ <code>0--10</code> å…ƒä»·æ ¼èŒƒå›´çš„æ–‡æ¡£ï¼Œå¹¶ä¸”å¯¹ç»“æœè¿›è¡Œæ’åºï¼Œå…ˆæŒ‰ <code>studymodel</code> é™åºï¼Œå†æŒ‰ä»·æ ¼å‡åº</p>
<p>å‘é€ POST <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"_source"</span>: [
        <span class="hljs-string">"name"</span>,
        <span class="hljs-string">"studymodel"</span>,
        <span class="hljs-string">"description"</span>,
        <span class="hljs-string">"price"</span>
    ],
    <span class="hljs-attr">"query"</span>: &#123;
        <span class="hljs-attr">"bool"</span>: &#123;
            <span class="hljs-attr">"filter"</span>: [
                &#123;
                    <span class="hljs-attr">"range"</span>: &#123;
                        <span class="hljs-attr">"price"</span>: &#123;
                            <span class="hljs-attr">"gte"</span>: <span class="hljs-number">0</span>,
                            <span class="hljs-attr">"lte"</span>: <span class="hljs-number">100</span>
                        &#125;
                    &#125;
                &#125;
            ]
        &#125;
    &#125;,
    <span class="hljs-attr">"sort"</span>: [
        &#123;
            <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"desc"</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"price"</span>: <span class="hljs-string">"asc"</span>
        &#125;
    ]
&#125;</code></pre></div>

<blockquote>
<p>dest è¡¨ç¤ºé™åºï¼Œä»å¤§åˆ°å°ï¼Œasc è¡¨ç¤ºå‡åºï¼Œä»å°åˆ°å¤§</p>
</blockquote>
<p><strong>JAVAå®¢æˆ·ç«¯å®ç°</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testSort</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);
    searchRequest.types(<span class="hljs-string">"doc"</span>);
    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();
    <span class="hljs-comment">//sourceæºå­—æ®µè¿‡è™‘</span>
    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>,<span class="hljs-string">"price"</span>,<span class="hljs-string">"description"</span>&#125;,
    <span class="hljs-keyword">new</span> String[]&#123;&#125;);
    searchRequest.source(searchSourceBuilder);
    <span class="hljs-comment">//å¸ƒå°”æŸ¥è¯¢</span>
    BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();
    <span class="hljs-comment">//è¿‡è™‘</span>
  boolQueryBuilder.filter(QueryBuilders.rangeQuery(<span class="hljs-string">"price"</span>).gte(<span class="hljs-number">0</span>).lte(<span class="hljs-number">100</span>));
    <span class="hljs-comment">//æ’åº</span>
    searchSourceBuilder.sort(<span class="hljs-keyword">new</span> FieldSortBuilder(<span class="hljs-string">"studymodel"</span>).order(SortOrder.DESC));
    searchSourceBuilder.sort(<span class="hljs-keyword">new</span> FieldSortBuilder(<span class="hljs-string">"price"</span>).order(SortOrder.ASC));
    SearchResponse searchResponse = client.search(searchRequest);
    SearchHits hits = searchResponse.getHits();
    SearchHit[] searchHits = hits.getHits();
    <span class="hljs-keyword">for</span>(SearchHit hit:searchHits)&#123;
        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();
        System.out.println(sourceAsMap);
    &#125;
&#125;</code></pre></div>

<h3 id="10ã€é«˜äº®æ˜¾ç¤º"><a href="#10ã€é«˜äº®æ˜¾ç¤º" class="headerlink" title="10ã€é«˜äº®æ˜¾ç¤º"></a>10ã€é«˜äº®æ˜¾ç¤º</h3><p><strong>JAVAå®¢æˆ·ç«¯å®ç°</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testHighlight</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(<span class="hljs-string">"xc_course"</span>);
    searchRequest.types(<span class="hljs-string">"doc"</span>);
    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();
    <span class="hljs-comment">//sourceæºå­—æ®µè¿‡è™‘</span>
    searchSourceBuilder.fetchSource(<span class="hljs-keyword">new</span> String[]&#123;<span class="hljs-string">"name"</span>,<span class="hljs-string">"studymodel"</span>,<span class="hljs-string">"price"</span>,<span class="hljs-string">"description"</span>&#125;,
    <span class="hljs-keyword">new</span> String[]&#123;&#125;);
    searchRequest.source(searchSourceBuilder);
    <span class="hljs-comment">//åŒ¹é…å…³é”®å­—</span>
    MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(<span class="hljs-string">"å¼€å‘"</span>,
    <span class="hljs-string">"name"</span>, <span class="hljs-string">"description"</span>);
    searchSourceBuilder.query(multiMatchQueryBuilder);
    <span class="hljs-comment">//å¸ƒå°”æŸ¥è¯¢</span>
    BoolQueryBuilder boolQueryBuilder = QueryBuilders.boolQuery();
    boolQueryBuilder.must(searchSourceBuilder.query());
    <span class="hljs-comment">//è¿‡è™‘</span>
    boolQueryBuilder.filter(QueryBuilders.rangeQuery(<span class="hljs-string">"price"</span>).gte(<span class="hljs-number">0</span>).lte(<span class="hljs-number">100</span>));
    <span class="hljs-comment">//æ’åº</span>
    searchSourceBuilder.sort(<span class="hljs-keyword">new</span> FieldSortBuilder(<span class="hljs-string">"studymodel"</span>).order(SortOrder.DESC));
    searchSourceBuilder.sort(<span class="hljs-keyword">new</span> FieldSortBuilder(<span class="hljs-string">"price"</span>).order(SortOrder.ASC));
    <span class="hljs-comment">//é«˜äº®è®¾ç½®</span>
    HighlightBuilder highlightBuilder = <span class="hljs-keyword">new</span> HighlightBuilder();
    highlightBuilder.preTags(<span class="hljs-string">"&lt;tag&gt;"</span>);<span class="hljs-comment">//è®¾ç½®å‰ç¼€</span>
    highlightBuilder.postTags(<span class="hljs-string">"&lt;/tag&gt;"</span>);<span class="hljs-comment">//è®¾ç½®åç¼€</span>
    <span class="hljs-comment">// è®¾ç½®é«˜äº®å­—æ®µ</span>
    highlightBuilder.fields().add(<span class="hljs-keyword">new</span> HighlightBuilder.Field(<span class="hljs-string">"name"</span>));
    <span class="hljs-comment">// highlightBuilder.fields().add(new HighlightBuilder.Field("description"));</span>
    searchSourceBuilder.highlighter(highlightBuilder);
    SearchResponse searchResponse = client.search(searchRequest);
    SearchHits hits = searchResponse.getHits();
    SearchHit[] searchHits = hits.getHits();
    <span class="hljs-keyword">for</span> (SearchHit hit : searchHits) &#123;
        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();
        <span class="hljs-comment">//åç§°</span>
        String name = (String) sourceAsMap.get(<span class="hljs-string">"name"</span>);
        <span class="hljs-comment">//å–å‡ºé«˜äº®å­—æ®µå†…å®¹</span>
        Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();
        <span class="hljs-keyword">if</span>(highlightFields!=<span class="hljs-keyword">null</span>)&#123;
            HighlightField nameField = highlightFields.get(<span class="hljs-string">"name"</span>);
            <span class="hljs-keyword">if</span>(nameField!=<span class="hljs-keyword">null</span>)&#123;
                Text[] fragments = nameField.getFragments();
                StringBuffer stringBuffer = <span class="hljs-keyword">new</span> StringBuffer();
                <span class="hljs-keyword">for</span> (Text str : fragments) &#123;
                    stringBuffer.append(str.string());
                &#125; 
                name = stringBuffer.toString();
            &#125;
        &#125;
        <span class="hljs-comment">//å–å‡ºæ‰€æœ‰ç»“æœ</span>
        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();
        System.out.println(sourceAsMap);
    &#125;
&#125;</code></pre></div>

<h1 id="äºŒã€é›†ç¾¤ç®¡ç†"><a href="#äºŒã€é›†ç¾¤ç®¡ç†" class="headerlink" title="äºŒã€é›†ç¾¤ç®¡ç†"></a>äºŒã€é›†ç¾¤ç®¡ç†</h1><p><code>ES</code> é€šå¸¸ä»¥é›†ç¾¤æ–¹å¼å·¥ä½œï¼Œè¿™æ ·åšä¸ä»…èƒ½å¤Ÿæé«˜ <code>ES</code> çš„æœç´¢èƒ½åŠ›è¿˜å¯ä»¥å¤„ç†å¤§æ•°æ®æœç´¢çš„èƒ½åŠ›ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†ç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›åŠé«˜å¯ç”¨ï¼Œ<code>ES</code> å¯ä»¥å®ç° <code>PB</code> çº§æ•°æ®çš„æœç´¢ã€‚</p>
<h2 id="1-é›†ç¾¤ç»“æ„"><a href="#1-é›†ç¾¤ç»“æ„" class="headerlink" title="1. é›†ç¾¤ç»“æ„"></a>1. é›†ç¾¤ç»“æ„</h2><p>ä¸‹å›¾æ˜¯ <code>ES</code> é›†ç¾¤ç»“æ„çš„ç¤ºæ„å›¾ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image1" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image1.png" srcset="/img/loading.gif" alt="image-20200423073305474.png"></a></p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image1" target="_blank" rel="noopener">image-20200423073305474.png</a></p>
<p>ä»ä¸Šå›¾æ€»ç»“ä»¥ä¸‹æ¦‚å¿µï¼š</p>
<p><strong>1ã€ç»“ç‚¹</strong></p>
<p><code>ES</code> é›†ç¾¤ç”±å¤šä¸ªæœåŠ¡å™¨ç»„æˆï¼Œæ¯ä¸ªæœåŠ¡å™¨å³ä¸ºä¸€ä¸ª <code>Node</code> ç»“ç‚¹(å¦‚æœè¯¥æœåŠ¡å™¨åªéƒ¨ç½²äº†ä¸€ä¸ª <code>ES</code> è¿›ç¨‹)ã€‚</p>
<p><strong>2ã€åˆ†ç‰‡</strong></p>
<p>å½“æˆ‘ä»¬çš„æ–‡æ¡£é‡å¾ˆå¤§æ—¶ï¼Œç”±äºå†…å­˜å’Œç¡¬ç›˜çš„é™åˆ¶ï¼ŒåŒæ—¶ä¹Ÿä¸ºäº†æé«˜ <code>ES</code> çš„å¤„ç†èƒ½åŠ›ã€å®¹é”™èƒ½åŠ›åŠé«˜å¯ç”¨èƒ½åŠ›ï¼Œæˆ‘ä»¬å°†ç´¢å¼•åˆ†æˆè‹¥å¹²åˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡å¯ä»¥æ”¾åœ¨ä¸åŒçš„æœåŠ¡å™¨ï¼Œè¿™æ ·å°±å®ç°äº†å¤šä¸ªæœåŠ¡å™¨å…±åŒå¯¹å¤–æä¾›ç´¢å¼•åŠæœç´¢æœåŠ¡ã€‚<br>ä¸€ä¸ªæœç´¢è¯·æ±‚è¿‡æ¥ï¼Œä¼šåˆ†åˆ«ä»å„å„åˆ†ç‰‡å»æŸ¥è¯¢ï¼Œæœ€åå°†æŸ¥è¯¢åˆ°çš„æ•°æ®åˆå¹¶è¿”å›ç»™ç”¨æˆ·ã€‚</p>
<p><strong>3ã€å‰¯æœ¬</strong></p>
<p>ä¸ºäº†æé«˜ <code>ES</code> çš„é«˜å¯ç”¨åŒæ—¶ä¹Ÿä¸ºäº†æé«˜æœç´¢çš„ååé‡ï¼Œæˆ‘ä»¬å°†åˆ†ç‰‡å¤åˆ¶ä¸€ä»½æˆ–å¤šä»½å­˜å‚¨åœ¨å…¶å®ƒçš„æœåŠ¡å™¨ï¼Œè¿™æ ·å³ä½¿å½“å‰çš„æœåŠ¡å™¨æŒ‚æ‰äº†ï¼Œæ‹¥æœ‰å‰¯æœ¬çš„æœåŠ¡å™¨ç…§å¸¸å¯ä»¥æä¾›æœåŠ¡ã€‚</p>
<p><strong>4ã€ä¸»ç»“ç‚¹</strong></p>
<p>ä¸€ä¸ªé›†ç¾¤ä¸­ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä¸»ç»“ç‚¹ï¼Œä¸»ç»“ç‚¹çš„ä½œç”¨æ˜¯é›†ç¾¤ç®¡ç†ï¼Œæ¯”å¦‚å¢åŠ èŠ‚ç‚¹ï¼Œç§»é™¤èŠ‚ç‚¹ç­‰ï¼Œä¸»ç»“ç‚¹æŒ‚æ‰åESä¼šé‡æ–°é€‰ä¸€ä¸ªä¸»ç»“ç‚¹ã€‚</p>
<p><strong>5ã€ç»“ç‚¹è½¬å‘</strong></p>
<p>æ¯ä¸ªç»“ç‚¹éƒ½çŸ¥é“å…¶å®ƒç»“ç‚¹çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä»»æ„ä¸€ä¸ªç»“ç‚¹å‘èµ·è¯·æ±‚ï¼Œæ¥æ”¶è¯·æ±‚çš„ç»“ç‚¹ä¼šè½¬å‘ç»™å…¶å®ƒç»“ç‚¹æŸ¥è¯¢æ•°æ®</p>
<h2 id="2-æ­å»ºé›†ç¾¤"><a href="#2-æ­å»ºé›†ç¾¤" class="headerlink" title="2. æ­å»ºé›†ç¾¤"></a>2. æ­å»ºé›†ç¾¤</h2><h3 id="1ã€èŠ‚ç‚¹çš„ä¸‰ä¸ªè§’è‰²"><a href="#1ã€èŠ‚ç‚¹çš„ä¸‰ä¸ªè§’è‰²" class="headerlink" title="1ã€èŠ‚ç‚¹çš„ä¸‰ä¸ªè§’è‰²"></a>1ã€èŠ‚ç‚¹çš„ä¸‰ä¸ªè§’è‰²</h3><p>ä¸‹è¾¹çš„ä¾‹å­å®ç°åˆ›å»ºä¸€ä¸ª 2ç»“ç‚¹çš„é›†ç¾¤ï¼Œå¹¶ä¸”ç´¢å¼•çš„åˆ†ç‰‡æˆ‘ä»¬è®¾ç½® 2ç‰‡ï¼Œæ¯ç‰‡ä¸€ä¸ªå‰¯æœ¬ã€‚</p>
<p>ä¸»ç»“ç‚¹ï¼š<code>master</code> èŠ‚ç‚¹ä¸»è¦ç”¨äºé›†ç¾¤çš„ç®¡ç†åŠç´¢å¼•ï¼Œæ¯”å¦‚æ–°å¢ç»“ç‚¹ã€åˆ†ç‰‡åˆ†é…ã€ç´¢å¼•çš„æ–°å¢å’Œåˆ é™¤ç­‰ã€‚</p>
<p>æ•°æ®ç»“ç‚¹ï¼š<code>data</code> èŠ‚ç‚¹ä¸Šä¿å­˜äº†æ•°æ®åˆ†ç‰‡ï¼Œå®ƒè´Ÿè´£ç´¢å¼•å’Œæœç´¢æ“ä½œã€‚ å®¢æˆ·ç«¯ç»“ç‚¹ï¼š<code>client</code> èŠ‚ç‚¹ä»…ä½œä¸ºè¯·æ±‚å®¢æˆ·ç«¯å­˜åœ¨ï¼Œ<code>client</code> çš„ä½œç”¨ä¹Ÿä½œä¸ºè´Ÿè½½å‡è¡¡å™¨ï¼Œ<code>client</code> èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼Œåªæ˜¯å°†è¯·æ±‚å‡è¡¡è½¬å‘åˆ°å…¶å®ƒç»“ç‚¹ã€‚</p>
<p>é€šè¿‡ä¸‹è¾¹ä¸¤é¡¹å‚æ•°æ¥é…ç½®ç»“ç‚¹çš„åŠŸèƒ½ï¼š</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">node.master:</span> <span class="hljs-comment">#æ˜¯å¦å…è®¸ä¸ºä¸»ç»“ç‚¹</span>
<span class="hljs-attr">node.data:</span> <span class="hljs-comment">#å…è®¸å­˜å‚¨æ•°æ®ä½œä¸ºæ•°æ®ç»“ç‚¹</span>
<span class="hljs-attr">node.ingest:</span> <span class="hljs-comment">#æ˜¯å¦å…è®¸æˆä¸ºåè°ƒèŠ‚ç‚¹ï¼Œ</span></code></pre></div>

<p>å››ç§ç»„åˆæ–¹å¼ï¼š</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-string">master=true,</span> <span class="hljs-string">data=trueï¼šå³æ˜¯ä¸»ç»“ç‚¹åˆæ˜¯æ•°æ®ç»“ç‚¹</span>
<span class="hljs-string">master=false,</span> <span class="hljs-string">data=trueï¼šä»…æ˜¯æ•°æ®ç»“ç‚¹</span>
<span class="hljs-string">master=true,</span> <span class="hljs-string">data=falseï¼šä»…æ˜¯ä¸»ç»“ç‚¹ï¼Œä¸å­˜å‚¨æ•°æ®</span>
<span class="hljs-string">master=false,</span> <span class="hljs-string">data=falseï¼šå³ä¸æ˜¯ä¸»ç»“ç‚¹ä¹Ÿä¸æ˜¯æ•°æ®ç»“ç‚¹ï¼Œæ­¤æ—¶å¯è®¾ç½®ingestä¸ºtrueè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯</span></code></pre></div>

<h3 id="2ã€åˆ›å»ºèŠ‚ç‚¹"><a href="#2ã€åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="2ã€åˆ›å»ºèŠ‚ç‚¹"></a>2ã€åˆ›å»ºèŠ‚ç‚¹</h3><h4 id="1-é…ç½®èŠ‚ç‚¹1"><a href="#1-é…ç½®èŠ‚ç‚¹1" class="headerlink" title="(1) é…ç½®èŠ‚ç‚¹1"></a>(1) é…ç½®èŠ‚ç‚¹1</h4><p>ç»“ç‚¹1 å¯¹å¤–æœåŠ¡çš„ <code>http</code> ç«¯å£æ˜¯ <code>9200</code>ï¼Œé›†ç¾¤ç®¡ç†ç«¯å£æ˜¯ <code>9300</code></p>
<p>é…ç½® elasticsearch.yml</p>
<p>ç»“ç‚¹åï¼š<code>xc_node_1</code></p>
<p><code>elasticsearch.yml</code> å†…å®¹å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">xuecheng</span>
<span class="hljs-attr">node.name:</span> <span class="hljs-string">xc_node_1</span>
<span class="hljs-comment"># ä¸»æœºç»‘å®šIPã€ç«¯å£ç­‰ä¿¡æ¯</span>
<span class="hljs-attr">network.host:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
<span class="hljs-attr">http.port:</span> <span class="hljs-number">9200</span>
<span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9300</span>
<span class="hljs-attr">node.master:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">node.data:</span> <span class="hljs-literal">true</span>
<span class="hljs-comment"># é…ç½®masterèŠ‚ç‚¹åˆ—è¡¨</span>
<span class="hljs-attr">discovery.zen.ping.unicast.hosts:</span> <span class="hljs-string">["0.0.0.0:9300",</span> <span class="hljs-string">"0.0.0.0:9301"</span><span class="hljs-string">]</span>
<span class="hljs-comment"># æœ€å°çš„ä¸»èŠ‚ç‚¹æ•°é‡</span>
<span class="hljs-attr">discovery.zen.minimum_master_nodes:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">node.ingest:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">bootstrap.memory_lock:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">node.max_local_storage_nodes:</span> <span class="hljs-number">1</span>

<span class="hljs-comment"># æ•°æ®ä¸æ—¥å¿—ç›®å½•</span>
<span class="hljs-attr">path.data:</span> <span class="hljs-string">D:\soft\elasticsearch\elasticsearch-6.8.8_1\data</span>
<span class="hljs-attr">path.logs:</span> <span class="hljs-string">D:\soft\elasticsearch\elasticsearch-6.8.8_1\logs</span>

<span class="hljs-comment"># è·¨åŸŸé…ç½®</span>
<span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">http.cors.allow-origin:</span> <span class="hljs-string">/.*/</span></code></pre></div>

<p>å¯åŠ¨èŠ‚ç‚¹1</p>
<h4 id="2-é…ç½®èŠ‚ç‚¹2"><a href="#2-é…ç½®èŠ‚ç‚¹2" class="headerlink" title="(2) é…ç½®èŠ‚ç‚¹2"></a>(2) é…ç½®èŠ‚ç‚¹2</h4><p>æˆ‘ä»¬æµ‹è¯•ç¯å¢ƒå°±åœ¨åŒä¸€å°æœºå™¨ä¸Šéƒ¨ç½²ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥éœ€è¦å°† <code>ES</code> çš„å®‰è£…åŒ…å†è§£å‹ä¸€ä»½ï¼Œå¹¶å¤åˆ¶èŠ‚ç‚¹1çš„ikæ’ä»¶å’Œä¸€äº›æ—¥å¿—é…ç½®æ–‡ä»¶åˆ° <strong>èŠ‚ç‚¹2</strong> çš„ç›®å½•ä¸‹</p>
<p>ç»“ç‚¹ <code>2</code>å¯¹å¤–æœåŠ¡çš„ <code>http</code> ç«¯å£æ˜¯ <code>9201</code>ï¼Œé›†ç¾¤ç®¡ç†ç«¯å£æ˜¯<code>9302</code></p>
<p>ç»“ç‚¹åï¼š<code>xc_node_2</code></p>
<p><code>elasticsearch.yml</code> å†…å®¹å¦‚ä¸‹ ï¼š</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">xuecheng</span>
<span class="hljs-attr">node.name:</span> <span class="hljs-string">xc_node_2</span>
<span class="hljs-comment"># ä¸»æœºç»‘å®šIPã€ç«¯å£ç­‰ä¿¡æ¯</span>
<span class="hljs-attr">network.host:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
<span class="hljs-attr">http.port:</span> <span class="hljs-number">9201</span>
<span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9301</span>
<span class="hljs-attr">node.master:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">node.data:</span> <span class="hljs-literal">true</span>
<span class="hljs-comment"># é…ç½®masterèŠ‚ç‚¹åˆ—è¡¨</span>
<span class="hljs-attr">discovery.zen.ping.unicast.hosts:</span> <span class="hljs-string">["0.0.0.0:9300",</span> <span class="hljs-string">"0.0.0.0:9301"</span><span class="hljs-string">]</span>
<span class="hljs-comment"># æœ€å°çš„ä¸»èŠ‚ç‚¹æ•°é‡</span>
<span class="hljs-attr">discovery.zen.minimum_master_nodes:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">node.ingest:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">bootstrap.memory_lock:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">node.max_local_storage_nodes:</span> <span class="hljs-number">1</span>

<span class="hljs-comment"># æ•°æ®ä¸æ—¥å¿—ç›®å½•</span>
<span class="hljs-attr">path.data:</span> <span class="hljs-string">D:\soft\elasticsearch\elasticsearch-6.8.8_1\data</span>
<span class="hljs-attr">path.logs:</span> <span class="hljs-string">D:\soft\elasticsearch\elasticsearch-6.8.8_2\logs</span>

<span class="hljs-comment"># è·¨åŸŸé…ç½®</span>
<span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">http.cors.allow-origin:</span> <span class="hljs-string">/.*/</span></code></pre></div>

<p>å¯åŠ¨ç»“ç‚¹2</p>
<h3 id="3ã€åˆ›å»ºç´¢å¼•åº“"><a href="#3ã€åˆ›å»ºç´¢å¼•åº“" class="headerlink" title="3ã€åˆ›å»ºç´¢å¼•åº“"></a>3ã€åˆ›å»ºç´¢å¼•åº“</h3><p>1ï¼‰ä½¿ç”¨headè¿ä¸Šå…¶ä¸­ä¸€ä¸ªç»“ç‚¹</p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image2" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image2.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¸Šå›¾è¡¨ç¤ºä¸¤ä¸ªç»“ç‚¹å·²ç»åˆ›å»ºæˆåŠŸã€‚</p>
<p>2ï¼‰ä¸‹è¾¹åˆ›å»ºç´¢å¼•åº“ï¼Œå…± <code>2</code> ä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡ä¸€ä¸ªå‰¯æœ¬ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image3" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image3.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>åˆ›å»ºæˆåŠŸï¼Œåˆ·æ–° head</p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image4" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image4.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¸Šå›¾å¯ä»¥çœ‹åˆ°å…±æœ‰4ä¸ªåˆ†ç‰‡ï¼Œå…¶ä¸­ä¸¤ä¸ªåˆ†ç‰‡æ˜¯å‰¯æœ¬ã€‚</p>
<h3 id="4ã€é›†ç¾¤çš„å¥åº·çŠ¶æ€"><a href="#4ã€é›†ç¾¤çš„å¥åº·çŠ¶æ€" class="headerlink" title="4ã€é›†ç¾¤çš„å¥åº·çŠ¶æ€"></a>4ã€é›†ç¾¤çš„å¥åº·çŠ¶æ€</h3><p>é€šè¿‡è®¿é—® GET <code>/_cluster/health</code> æ¥æŸ¥çœ‹ <code>Elasticsearch</code> çš„é›†ç¾¤å¥åº·æƒ…å†µã€‚</p>
<p>ç”¨ä¸‰ç§é¢œè‰²æ¥å±•ç¤ºå¥åº·çŠ¶æ€ï¼š <code>green</code> ã€ <code>yellow</code> æˆ–è€… <code>red</code> ã€‚</p>
<ul>
<li>greenï¼šæ‰€æœ‰çš„ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œã€‚</li>
<li>yellowï¼šæ‰€æœ‰çš„ä¸»åˆ†ç‰‡éƒ½æ­£å¸¸è¿è¡Œï¼Œä½†æœ‰äº›å‰¯æœ¬åˆ†ç‰‡è¿è¡Œä¸æ­£å¸¸ã€‚</li>
<li>edï¼šå­˜åœ¨ä¸»åˆ†ç‰‡è¿è¡Œä¸æ­£å¸¸ã€‚</li>
</ul>
<p>GET è¯·æ±‚ï¼š<a href="http://localhost:9200/_cluster/health" target="_blank" rel="noopener">http://localhost:9200/_cluster/health</a></p>
<p>å“åº”ç»“æœï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"cluster_name"</span>: <span class="hljs-string">"xuecheng"</span>,
    <span class="hljs-attr">"status"</span>: <span class="hljs-string">"green"</span>,
    <span class="hljs-attr">"timed_out"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"number_of_nodes"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">"number_of_data_nodes"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">"active_primary_shards"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"active_shards"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"relocating_shards"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"initializing_shards"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"unassigned_shards"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"delayed_unassigned_shards"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"number_of_pending_tasks"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"number_of_in_flight_fetch"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"task_max_waiting_in_queue_millis"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"active_shards_percent_as_number"</span>: <span class="hljs-number">100.0</span>
&#125;</code></pre></div>

<h2 id="3-æµ‹è¯•"><a href="#3-æµ‹è¯•" class="headerlink" title="3. æµ‹è¯•"></a>3. æµ‹è¯•</h2><p>1ï¼‰åˆ›å»ºæ˜ å°„å¹¶å†™å…¥æ–‡æ¡£</p>
<p>è¿æ¥ å…¶ä¸­ä»»æ„ä¸€å°ç»“ç‚¹ï¼Œåˆ›å»ºæ˜ å°„å†™å…¥æ–‡æ¡£ã€‚</p>
<p>POST <a href="http://localhost:9200/xc_course/doc/3" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/3</a></p>
<div class="hljs"><pre><code class="hljs json">&#123; 
	<span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"spring åœ¨javaé¢†åŸŸéå¸¸æµè¡Œï¼Œjavaè½¯ä»¶å¼€å‘äººå‘˜éƒ½åœ¨ç”¨ã€‚"</span>,
    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,
    <span class="hljs-attr">"price"</span>:<span class="hljs-number">66.6</span>
&#125;</code></pre></div>

<p>å“åº”ç»“æœï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,
    <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,
    <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"3"</span>,
    <span class="hljs-attr">"_version"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">"result"</span>: <span class="hljs-string">"created"</span>,
    <span class="hljs-attr">"_shards"</span>: &#123;
        <span class="hljs-attr">"total"</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">"successful"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"failed"</span>: <span class="hljs-number">0</span>
    &#125;,
    <span class="hljs-attr">"_seq_no"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"_primary_term"</span>: <span class="hljs-number">1</span>
&#125;</code></pre></div>

<p>ä»ä¸Šè¾¹çš„æç¤ºå¯çœ‹å‡ºï¼Œä¸¤ä¸ªåˆ†ç‰‡éƒ½ä¿å­˜æˆåŠŸã€‚</p>
<p>2ï¼‰æœç´¢</p>
<p>å‘å…¶å®ƒä¸€ä¸ªç»“ç‚¹å‘èµ·æœç´¢è¯·æ±‚ï¼ŒæŸ¥è¯¢å…¨éƒ¨æ•°æ®ã€‚</p>
<p>3ï¼‰å…³é—­ä¸€ä¸ªç»“ç‚¹</p>
<p>ESä¼šé‡æ–°é€‰ä¸­ä¸€ä¸ªä¸»ç»“ç‚¹ï¼ˆå‰æåœ¨é…ç½®ç»“ç‚¹æ—¶å…è®¸å®ƒå¯ä»¥ä¸ºä¸»ç»“ç‚¹ï¼‰</p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image5" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image5.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ­¤æ—¶å‘æ´»çš„ç»“ç‚¹å‘èµ·æœç´¢è¯·æ±‚ï¼Œä»ç„¶æ­£å¸¸ã€‚</p>
<p>4ï¼‰æ·»åŠ ä¸€ä¸ªç»“ç‚¹</p>
<p>æ·»åŠ ç»“ç‚¹ <code>3</code>ï¼Œç«¯å£è®¾ç½®ä¸ºï¼š</p>
<p><code>http</code> ç«¯å£æ˜¯ï¼š<code>9202</code></p>
<p>é›†ç¾¤ç®¡ç†ç«¯å£æ˜¯ <code>9302</code></p>
<p>ç»“ç‚¹åï¼š<code>xc_node_3</code></p>
<p>æ­¤ç»“ç‚¹çš„é…ç½®ï¼š</p>
<div class="hljs"><pre><code class="hljs json">node.master: false
node.data: true</code></pre></div>

<p>å¯åŠ¨ç»“ç‚¹3ï¼Œåˆ·æ–° <code>head</code>ï¼Œä¸‹å›¾æ˜¾ç¤º <code>ES</code> å°†åˆ†ç‰‡åˆ†åœ¨äº† <code>3</code> ä¸ªç»“ç‚¹</p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image6" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image6.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å‘ç»“ç‚¹3å‘èµ·æœç´¢è¯·æ±‚ï¼š</p>
<p>GETï¼š <a href="http://127.0.0.1:9202/xc_course/doc/_search" target="_blank" rel="noopener">http://127.0.0.1:9202/xc_course/doc/_search</a></p>
<p>å…¨éƒ¨æ•°æ®å¯è¢«æ­£å¸¸æœç´¢åˆ°ã€‚</p>
<h1 id="ä¸‰ã€æœç´¢æœåŠ¡å¼€å‘"><a href="#ä¸‰ã€æœç´¢æœåŠ¡å¼€å‘" class="headerlink" title="ä¸‰ã€æœç´¢æœåŠ¡å¼€å‘"></a>ä¸‰ã€æœç´¢æœåŠ¡å¼€å‘</h1><h2 id="1-è¯¾ç¨‹æœç´¢æœåŠ¡éœ€æ±‚åˆ†æ"><a href="#1-è¯¾ç¨‹æœç´¢æœåŠ¡éœ€æ±‚åˆ†æ" class="headerlink" title="1. è¯¾ç¨‹æœç´¢æœåŠ¡éœ€æ±‚åˆ†æ"></a>1. è¯¾ç¨‹æœç´¢æœåŠ¡éœ€æ±‚åˆ†æ</h2><h3 id="1ã€éœ€æ±‚åˆ†æ"><a href="#1ã€éœ€æ±‚åˆ†æ" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h3><p><a href="https://qnoss.codeyee.com/20200704_11/image7" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image7.png" srcset="/img/loading.gif" alt="img"></a></p>
<ol>
<li>æ ¹æ®åˆ†ç±»æœç´¢è¯¾ç¨‹ä¿¡æ¯ã€‚</li>
<li>æ ¹æ®å…³é”®å­—æœç´¢è¯¾ç¨‹ä¿¡æ¯ï¼Œæœç´¢æ–¹å¼ä¸ºå…¨æ–‡æ£€ç´¢ï¼Œå…³é”®å­—éœ€è¦åŒ¹é…è¯¾ç¨‹çš„åç§°ã€ è¯¾ç¨‹å†…å®¹ã€‚</li>
<li>æ ¹æ®éš¾åº¦ç­‰çº§æœç´¢è¯¾ç¨‹ã€‚</li>
<li>æœç´¢ç»“ç‚¹åˆ†é¡µæ˜¾ç¤ºã€‚</li>
</ol>
<h3 id="2ã€æœç´¢æµç¨‹"><a href="#2ã€æœç´¢æµç¨‹" class="headerlink" title="2ã€æœç´¢æµç¨‹"></a>2ã€æœç´¢æµç¨‹</h3><p><a href="https://qnoss.codeyee.com/20200704_11/image8" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image8.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡å°†æ•°æ®å†™åˆ° <code>MySQL</code> æ•°æ®åº“</p>
<p>2ã€ä½¿ç”¨ <code>Logstash</code> å°† <code>MySQL</code> æ•°æ®åº“ä¸­çš„æ•°æ®å†™åˆ° <code>ES</code> çš„ç´¢å¼•åº“ã€‚</p>
<p>3ã€ç”¨æˆ·åœ¨å‰ç«¯æœç´¢è¯¾ç¨‹ä¿¡æ¯ï¼Œè¯·æ±‚åˆ°æœç´¢æœåŠ¡ã€‚</p>
<p>4ã€æœç´¢æœåŠ¡è¯·æ±‚ <code>ES</code> æœç´¢è¯¾ç¨‹ä¿¡æ¯ã€‚</p>
<h2 id="2-è¯¾ç¨‹ç´¢å¼•"><a href="#2-è¯¾ç¨‹ç´¢å¼•" class="headerlink" title="2. è¯¾ç¨‹ç´¢å¼•"></a>2. è¯¾ç¨‹ç´¢å¼•</h2><h3 id="1ã€æŠ€æœ¯æ–¹æ¡ˆ"><a href="#1ã€æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="1ã€æŠ€æœ¯æ–¹æ¡ˆ"></a>1ã€æŠ€æœ¯æ–¹æ¡ˆ</h3><p>å¦‚ä½•ç»´æŠ¤è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯ï¼Ÿ</p>
<p>1ã€å½“è¯¾ç¨‹å‘ <code>MySQL</code> æ·»åŠ ååŒæ—¶å°†è¯¾ç¨‹ä¿¡æ¯æ·»åŠ åˆ°ç´¢å¼•åº“ã€‚é‡‡ç”¨ <code>Logstach</code> å®ç°ï¼Œ<code>Logstach</code>ä¼šä» <code>MySQL</code> ä¸­ å°†æ•°æ®é‡‡é›†åˆ° <code>ES</code> ç´¢å¼•åº“ã€‚</p>
<p>2ã€å½“è¯¾ç¨‹åœ¨ <code>MySQL</code> æ›´æ–°ä¿¡æ¯ååŒæ—¶æ›´æ–°è¯¥è¯¾ç¨‹åœ¨ç´¢å¼•åº“çš„ä¿¡æ¯ã€‚</p>
<p>é‡‡ç”¨ <code>Logstach</code> å®ç°ã€‚</p>
<p>3ã€å½“è¯¾ç¨‹åœ¨ <code>MySQL</code> åˆ é™¤ååŒæ—¶å°†è¯¥è¯¾ç¨‹ä»ç´¢å¼•åº“åˆ é™¤ã€‚</p>
<p>æ‰‹å·¥å†™ç¨‹åºå®ç°ï¼Œåœ¨åˆ é™¤è¯¾ç¨‹åå°†ç´¢å¼•åº“ä¸­è¯¥è¯¾ç¨‹ä¿¡æ¯åˆ é™¤ã€‚</p>
<h3 id="2ã€å‡†å¤‡è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯"><a href="#2ã€å‡†å¤‡è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯" class="headerlink" title="2ã€å‡†å¤‡è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯"></a>2ã€å‡†å¤‡è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯</h3><p>è¯¾ç¨‹å‘å¸ƒæˆåŠŸåœ¨ <code>MySQL</code> æ•°æ®åº“å­˜å‚¨è¯¾ç¨‹å‘å¸ƒä¿¡æ¯ï¼Œæ­¤ä¿¡æ¯ä½œä¸ºè¯¾ç¨‹ç´¢å¼•ä¿¡æ¯ã€‚</p>
<h4 id="åˆ›å»ºè¯¾ç¨‹å‘å¸ƒè¡¨"><a href="#åˆ›å»ºè¯¾ç¨‹å‘å¸ƒè¡¨" class="headerlink" title="åˆ›å»ºè¯¾ç¨‹å‘å¸ƒè¡¨"></a>åˆ›å»ºè¯¾ç¨‹å‘å¸ƒè¡¨</h4><p>è¯¾ç¨‹ä¿¡æ¯åˆ†å¸ƒåœ¨ <code>course_base</code>ã€<code>course_pic</code> ç­‰ä¸åŒçš„è¡¨ä¸­ã€‚</p>
<p>è¯¾ç¨‹å‘å¸ƒæˆåŠŸä¸ºäº†æ–¹ä¾¿è¿›è¡Œç´¢å¼•å°†è¿™å‡ å¼ è¡¨çš„æ•°æ®åˆå¹¶åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œä½œä¸ºè¯¾ç¨‹å‘å¸ƒä¿¡æ¯ã€‚</p>
<p>åˆ›å»º <code>course_pub</code> è¡¨</p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image9" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image9.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="åˆ›å»ºè¡¨æ¨¡å‹"><a href="#åˆ›å»ºè¡¨æ¨¡å‹" class="headerlink" title="åˆ›å»ºè¡¨æ¨¡å‹"></a>åˆ›å»ºè¡¨æ¨¡å‹</h4><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ToString</span>
<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table</span>(name=<span class="hljs-string">"course_pub"</span>)
<span class="hljs-meta">@GenericGenerator</span>(name = <span class="hljs-string">"jpa-assigned"</span>, strategy = <span class="hljs-string">"assigned"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoursePub</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Serializable</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">long</span> serialVersionUID = -<span class="hljs-number">916357110051689487L</span>;
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue</span>(generator = <span class="hljs-string">"jpa-assigned"</span>)
    <span class="hljs-meta">@Column</span>(length = <span class="hljs-number">32</span>)
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String users;
    <span class="hljs-keyword">private</span> String mt;
    <span class="hljs-keyword">private</span> String st;
    <span class="hljs-keyword">private</span> String grade;
    <span class="hljs-keyword">private</span> String studymodel;
    <span class="hljs-keyword">private</span> String teachmode;
    <span class="hljs-keyword">private</span> String description;
    <span class="hljs-keyword">private</span> String pic;<span class="hljs-comment">//å›¾ç‰‡</span>
    <span class="hljs-keyword">private</span> Date timestamp;<span class="hljs-comment">//æ—¶é—´æˆ³</span>
    <span class="hljs-keyword">private</span> String charge;+
    <span class="hljs-keyword">private</span> String valid;
    <span class="hljs-keyword">private</span> String qq;
    <span class="hljs-keyword">private</span> Float price;
    <span class="hljs-keyword">private</span> Float price_old;
    <span class="hljs-keyword">private</span> String expires;
    <span class="hljs-keyword">private</span> String teachplan;<span class="hljs-comment">//è¯¾ç¨‹è®¡åˆ’</span>
    <span class="hljs-meta">@Column</span>(name=<span class="hljs-string">"pub_time"</span>)
    <span class="hljs-keyword">private</span> String pubTime;<span class="hljs-comment">//è¯¾ç¨‹å‘å¸ƒæ—¶é—´</span>
&#125;</code></pre></div>

<h4 id="æ·»åŠ è¯¾ç¨‹ç´¢å¼•"><a href="#æ·»åŠ è¯¾ç¨‹ç´¢å¼•" class="headerlink" title="æ·»åŠ è¯¾ç¨‹ç´¢å¼•"></a>æ·»åŠ è¯¾ç¨‹ç´¢å¼•</h4><p>æˆ‘ä»¬éœ€è¦åœ¨è¯¾ç¨‹å‘æˆåŠŸåæ‰§è¡Œæ·»åŠ è¯¾ç¨‹ç´¢å¼•çš„æ“ä½œ</p>
<p>1ï¼‰åˆ›å»º <code>course_pub</code> è¡¨çš„ <code>dao</code></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CoursePubRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JpaRepository</span>&lt;<span class="hljs-title">CoursePub</span>, <span class="hljs-title">String</span>&gt; </span>&#123;&#125;</code></pre></div>

<ol>
<li>ä¿®æ”¹è¯¾ç¨‹å‘å¸ƒ</li>
</ol>
<p>æˆ‘ä»¬å…ˆå°†æ·»åŠ ç´¢å¼•æ‹†åˆ†ä¸ºä¸¤ä¸ªæ–¹æ³•ï¼šcreateCoursePubã€saveCoursePub</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//ä¿å­˜CoursePub</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> CoursePub <span class="hljs-title">saveCoursePub</span><span class="hljs-params">(String id, CoursePub coursePub)</span></span>&#123;
    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(id))&#123;
    ExceptionCast.cast(CourseCode.COURSE_PUBLISH_COURSEIDISNULL);
    &#125; 
    CoursePub coursePubNew = <span class="hljs-keyword">null</span>;
    Optional&lt;CoursePub&gt; coursePubOptional = coursePubRepository.findById(id);
    <span class="hljs-keyword">if</span>(coursePubOptional.isPresent())&#123;
    	coursePubNew = coursePubOptional.get();
    &#125; 
    <span class="hljs-keyword">if</span>(coursePubNew == <span class="hljs-keyword">null</span>)&#123;
    	coursePubNew = <span class="hljs-keyword">new</span> CoursePub();
    &#125; 
    BeanUtils.copyProperties(coursePub,coursePubNew);
    <span class="hljs-comment">//è®¾ç½®ä¸»é”®</span>
    coursePubNew.setId(id);
    <span class="hljs-comment">//æ›´æ–°æ—¶é—´æˆ³ä¸ºæœ€æ–°æ—¶é—´</span>
    coursePub.setTimestamp(<span class="hljs-keyword">new</span> Date());
    <span class="hljs-comment">//å‘å¸ƒæ—¶é—´</span>
    SimpleDateFormat simpleDateFormat = <span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"YYYY-MM-dd HH:mm:ss"</span>);
    String date = simpleDateFormat.format(<span class="hljs-keyword">new</span> Date());
    coursePub.setPubTime(date);
    coursePubRepository.save(coursePub);
    <span class="hljs-keyword">return</span> coursePub;
&#125;

<span class="hljs-comment">//åˆ›å»ºcoursePubå¯¹è±¡</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> CoursePub <span class="hljs-title">createCoursePub</span><span class="hljs-params">(String id)</span></span>&#123;
    CoursePub coursePub = <span class="hljs-keyword">new</span> CoursePub();
    coursePub.setId(id);
    <span class="hljs-comment">//åŸºç¡€ä¿¡æ¯</span>
    Optional&lt;CourseBase&gt; courseBaseOptional = courseBaseRepository.findById(id);
    <span class="hljs-keyword">if</span>(courseBaseOptional == <span class="hljs-keyword">null</span>)&#123;
        CourseBase courseBase = courseBaseOptional.get();
        BeanUtils.copyProperties(courseBase, coursePub);
    &#125; 
    <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹å›¾ç‰‡</span>
    Optional&lt;CoursePic&gt; picOptional = coursePicRepository.findById(id);
    <span class="hljs-keyword">if</span>(picOptional.isPresent())&#123;
        CoursePic coursePic = picOptional.get();
        BeanUtils.copyProperties(coursePic, coursePub);
    &#125; 
    <span class="hljs-comment">//è¯¾ç¨‹è¥é”€ä¿¡æ¯</span>
    Optional&lt;CourseMarket&gt; marketOptional = courseMarketRepository.findById(id);
    <span class="hljs-keyword">if</span>(marketOptional.isPresent())&#123;
        CourseMarket courseMarket = marketOptional.get();
        BeanUtils.copyProperties(courseMarket, coursePub);
    &#125; 
    <span class="hljs-comment">//è¯¾ç¨‹è®¡åˆ’</span>
    TeachplanNode teachplanNode = teachplanMapper.selectList(id);
    <span class="hljs-comment">//å°†è¯¾ç¨‹è®¡åˆ’è½¬æˆjson</span>
    String teachplanString = JSON.toJSONString(teachplanNode);
    coursePub.setTeachplan(teachplanString);
    <span class="hljs-keyword">return</span> coursePub;
&#125;</code></pre></div>

<p>3ï¼‰ä¿®æ”¹è¯¾ç¨‹æ–¹æ³•ï¼Œè°ƒç”¨ <code>createCoursePub</code> å’Œ <code>saveCoursePub</code> æ–¹æ³•</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//è¯¾ç¨‹å‘å¸ƒ</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">publish</span><span class="hljs-params">(String courseId)</span></span>&#123;
    ....
    <span class="hljs-comment">//åˆ›å»ºè¯¾ç¨‹ç´¢å¼•</span>
    <span class="hljs-comment">//åˆ›å»ºè¯¾ç¨‹ç´¢å¼•ä¿¡æ¯</span>
    CoursePub coursePub = createCoursePub(courseId);
    <span class="hljs-comment">//å‘æ•°æ®åº“ä¿å­˜è¯¾ç¨‹ç´¢å¼•ä¿¡æ¯</span>
    CoursePub newCoursePub = saveCoursePub(courseId, coursePub);
    <span class="hljs-keyword">if</span>(newCoursePub==<span class="hljs-keyword">null</span>)&#123;
    <span class="hljs-comment">//åˆ›å»ºè¯¾ç¨‹ç´¢å¼•ä¿¡æ¯å¤±è´¥			</span>
ExceptionCast.cast(CourseCode.COURSE_PUBLISH_CREATE_INDEX_ERROR);
    &#125;
    ....
&#125;</code></pre></div>

<h3 id="3ã€æ­å»ºESç¯å¢ƒ"><a href="#3ã€æ­å»ºESç¯å¢ƒ" class="headerlink" title="3ã€æ­å»ºESç¯å¢ƒ"></a>3ã€æ­å»ºESç¯å¢ƒ</h3><p>åˆ›å»ºç´¢å¼•åº“ ï¼Œ åˆ›å»º <code>xc_course</code> ç´¢å¼•åº“ï¼Œ1åˆ†ç‰‡ï¼Œ0ä¸ªå‰¯æœ¬ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image10" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image10.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>åˆ›å»ºæ˜ å°„</p>
<p>POST: <a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"properties"</span>: &#123;
        <span class="hljs-attr">"description"</span>: &#123;
            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>
        &#125;,
        <span class="hljs-attr">"grade"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"id"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"mt"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"name"</span>: &#123;
            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>
        &#125;,
        <span class="hljs-attr">"users"</span>: &#123;
            <span class="hljs-attr">"index"</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>
        &#125;,
        <span class="hljs-attr">"charge"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"valid"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"pic"</span>: &#123;
            <span class="hljs-attr">"index"</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"qq"</span>: &#123;
            <span class="hljs-attr">"index"</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"price"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"float"</span>
        &#125;,
        <span class="hljs-attr">"price_old"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"float"</span>
        &#125;,
        <span class="hljs-attr">"st"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"status"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"studymodel"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"teachmode"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"teachplan"</span>: &#123;
            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>
        &#125;,
        <span class="hljs-attr">"expires"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,
            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>
        &#125;,
        <span class="hljs-attr">"pub_time"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,
            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>
        &#125;,
        <span class="hljs-attr">"start_time"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,
            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>
        &#125;,
        <span class="hljs-attr">"end_time"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,
            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<h3 id="4ã€Logstashåˆ›å»ºç´¢å¼•"><a href="#4ã€Logstashåˆ›å»ºç´¢å¼•" class="headerlink" title="4ã€Logstashåˆ›å»ºç´¢å¼•"></a>4ã€Logstashåˆ›å»ºç´¢å¼•</h3><p>Logstashæ˜¯ESä¸‹çš„ä¸€æ¬¾å¼€æºè½¯ä»¶ï¼Œå®ƒèƒ½å¤ŸåŒæ—¶ ä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ã€è½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€ <code>Eleasticsearch</code> ä¸­åˆ›å»ºç´¢å¼•ã€‚</p>
<p>æœ¬é¡¹ç›®ä½¿ç”¨ <code>Logstash</code> å°† <code>MySQL</code> ä¸­çš„æ•°æ®é‡‡ç”¨åˆ°ESç´¢å¼•ä¸­ã€‚</p>
<h4 id="ä¸‹è½½-Logstash"><a href="#ä¸‹è½½-Logstash" class="headerlink" title="ä¸‹è½½ Logstash"></a>ä¸‹è½½ Logstash</h4><p>ä¸‹è½½çš„ <code>Logstash</code> è¦å’ŒESçš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œä¸‹è½½åœ°å€ <a href="https://www.elastic.co/cn/downloads/logstash" target="_blank" rel="noopener">https://www.elastic.co/cn/downloads/logstash</a></p>
<p>ä¸‹è½½å®Œæˆåè§£å‹å³å¯</p>
<h4 id="å®‰è£…-Logstash"><a href="#å®‰è£…-Logstash" class="headerlink" title="å®‰è£… Logstash"></a>å®‰è£… Logstash</h4><p><code>ogstash-input-jdbc</code> æ˜¯<code>ruby</code>å¼€å‘çš„ï¼Œå…ˆä¸‹è½½ <code>ruby</code> å¹¶å®‰è£…</p>
<p>ä¸‹è½½åœ°å€: <a href="https://rubyinstaller.org/downloads/" target="_blank" rel="noopener">https://rubyinstaller.org/downloads/</a></p>
<p>å®‰è£…å®ŒæˆæŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ <code>ruby -v</code></p>
<p><code>6.x</code> ç‰ˆæœ¬æœ¬èº«ä¸å¸¦ <code>logstash-input-jdbc</code> æ’ä»¶ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£… ï¼Œåœ¨binç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<div class="hljs"><pre><code class="hljs shell">.\logstash-plugin.bat install logstash-input-jdbc</code></pre></div>

<p><a href="https://qnoss.codeyee.com/20200704_11/image11" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image11.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å®‰è£…æˆåŠŸåæˆ‘ä»¬å¯ä»¥åœ¨ <code>logstash</code> æ ¹ç›®å½•ä¸‹çš„ <code>vendor\bundle\jruby\2.5.0\gems</code> ç›®å½•æŸ¥çœ‹å¯¹åº”çš„æ’ä»¶ç‰ˆæœ¬</p>
<h4 id="åˆ›å»ºæ¨¡æ¿æ–‡ä»¶"><a href="#åˆ›å»ºæ¨¡æ¿æ–‡ä»¶" class="headerlink" title="åˆ›å»ºæ¨¡æ¿æ–‡ä»¶"></a>åˆ›å»ºæ¨¡æ¿æ–‡ä»¶</h4><p><code>Logstash</code> çš„å·¥ä½œæ˜¯ä» <code>MySQL</code> ä¸­è¯»å–æ•°æ®ï¼Œå‘ESä¸­åˆ›å»ºç´¢å¼•ï¼Œè¿™é‡Œéœ€è¦æå‰åˆ›å»º <code>mapping</code> çš„æ¨¡æ¿æ–‡ä»¶ä»¥ä¾¿ <code>logstash</code> ä½¿ç”¨ã€‚</p>
<p>åœ¨ <code>logstach</code> çš„ <code>config</code> ç›®å½•åˆ›å»º <code>xc_course_template.json</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
   <span class="hljs-attr">"mappings"</span> : &#123;
      <span class="hljs-attr">"doc"</span> : &#123;
         <span class="hljs-attr">"properties"</span> : &#123;
            <span class="hljs-attr">"charge"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;,
            <span class="hljs-attr">"description"</span> : &#123;
               <span class="hljs-attr">"analyzer"</span> : <span class="hljs-string">"ik_max_word"</span>,
               <span class="hljs-attr">"search_analyzer"</span> : <span class="hljs-string">"ik_smart"</span>,
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>
            &#125;,
            <span class="hljs-attr">"end_time"</span> : &#123;
               <span class="hljs-attr">"format"</span> : <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>,
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"date"</span>
            &#125;,
            <span class="hljs-attr">"expires"</span> : &#123;
               <span class="hljs-attr">"format"</span> : <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>,
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"date"</span>
            &#125;,
            <span class="hljs-attr">"grade"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;,
            <span class="hljs-attr">"id"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;,
            <span class="hljs-attr">"mt"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;,
            <span class="hljs-attr">"name"</span> : &#123;
               <span class="hljs-attr">"analyzer"</span> : <span class="hljs-string">"ik_max_word"</span>,
               <span class="hljs-attr">"search_analyzer"</span> : <span class="hljs-string">"ik_smart"</span>,
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>
            &#125;,
            <span class="hljs-attr">"pic"</span> : &#123;
               <span class="hljs-attr">"index"</span> : <span class="hljs-literal">false</span>,
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;,
            <span class="hljs-attr">"price"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"float"</span>
            &#125;,
            <span class="hljs-attr">"price_old"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"float"</span>
            &#125;,
            <span class="hljs-attr">"pub_time"</span> : &#123;
               <span class="hljs-attr">"format"</span> : <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>,
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"date"</span>
            &#125;,
            <span class="hljs-attr">"qq"</span> : &#123;
               <span class="hljs-attr">"index"</span> : <span class="hljs-literal">false</span>,
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;,
            <span class="hljs-attr">"st"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;,
            <span class="hljs-attr">"start_time"</span> : &#123;
               <span class="hljs-attr">"format"</span> : <span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>,
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"date"</span>
            &#125;,
            <span class="hljs-attr">"status"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;,
            <span class="hljs-attr">"studymodel"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;,
            <span class="hljs-attr">"teachmode"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;,
            <span class="hljs-attr">"teachplan"</span> : &#123;
               <span class="hljs-attr">"analyzer"</span> : <span class="hljs-string">"ik_max_word"</span>,
               <span class="hljs-attr">"search_analyzer"</span> : <span class="hljs-string">"ik_smart"</span>,
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>
            &#125;,
            <span class="hljs-attr">"users"</span> : &#123;
               <span class="hljs-attr">"index"</span> : <span class="hljs-literal">false</span>,
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"text"</span>
            &#125;,
            <span class="hljs-attr">"valid"</span> : &#123;
               <span class="hljs-attr">"type"</span> : <span class="hljs-string">"keyword"</span>
            &#125;
         &#125;
      &#125;
   &#125;,
   <span class="hljs-attr">"template"</span> : <span class="hljs-string">"xc_course"</span>
&#125;</code></pre></div>

<p>è¯¥æ–‡ä»¶å¯¹äºçš„æ˜¯ESåº“ä¸­çš„æ˜ å°„</p>
<h4 id="é…ç½®-mysql-conf"><a href="#é…ç½®-mysql-conf" class="headerlink" title="é…ç½® mysql.conf"></a>é…ç½® mysql.conf</h4><p>åœ¨ <code>logstash</code> çš„ <code>config</code> ç›®å½•ä¸‹é…ç½® <code>mysql.conf</code>æ–‡ä»¶ä¾› <code>logstash</code> ä½¿ç”¨ï¼Œ<code>logstash</code> ä¼šæ ¹æ®<code>mysql.conf</code> æ–‡ä»¶çš„é…ç½®çš„åœ°å€ä» <code>MySQL</code> ä¸­è¯»å–æ•°æ®å‘ <code>ES</code> ä¸­å†™å…¥ç´¢å¼•ã€‚</p>
<p>å‚è€ƒ <a href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-jdbc.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/logstash/current/plugins-inputs-jdbc.html</a></p>
<p>é…ç½®è¾“å…¥æ•°æ®æºå’Œè¾“å‡ºæ•°æ®æºã€‚</p>
<div class="hljs"><pre><code class="hljs conf">input &#123;
    stdin &#123;
    &#125; 
    jdbc &#123;
        jdbc_connection_string &#x3D;&gt; &quot;jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;xc_course?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;useSSL&#x3D;true&amp;serverTimezone&#x3D;UTC&quot;
        # æ•°æ®åº“ä¿¡æ¯
        jdbc_user &#x3D;&gt; &quot;root&quot;
        jdbc_password &#x3D;&gt; 123123
        # MYSQL é©±åŠ¨åœ°å€,ä¿®æ”¹ä¸ºmavenä»“åº“å¯¹åº”çš„ä½ç½®
        jdbc_driver_library &#x3D;&gt; &quot;D:&#x2F;soft&#x2F;apache-maven-3.5.4&#x2F;repository&#x2F;mysql&#x2F;mysql-connector-java&#x2F;5.1.40&#x2F;mysql-
        connector-java-5.1.40.jar&quot;
        # the name of the driver class for mysql
        jdbc_driver_class &#x3D;&gt; &quot;com.mysql.jdbc.Driver&quot;
        jdbc_paging_enabled &#x3D;&gt; &quot;true&quot;
        jdbc_page_size &#x3D;&gt; &quot;50000&quot;
        #è¦æ‰§è¡Œçš„sqlæ–‡ä»¶
        #statement_filepath &#x3D;&gt; &quot;&#x2F;conf&#x2F;course.sql&quot;
		# è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨ç›´æ¥sqlè¯­å¥çš„å½¢å¼, å› ä¸ºlogstashé»˜è®¤é‡‡ç”¨çš„æ˜¯UTCæ ‡å‡†æ—¶é—´,æˆ‘ä»¬è¿™é‡Œéœ€è¦åŠ ä¸Š8å°æ—¶
        statement &#x3D;&gt; &quot;select * from course_pub where timestamp &gt; date_add(:sql_last_value,INTERVAL 8 HOUR)&quot;
        #å®šæ—¶é…ç½®
        schedule &#x3D;&gt; &quot;* * * * *&quot;
        record_last_run &#x3D;&gt; true
        last_run_metadata_path &#x3D;&gt; &quot;D:&#x2F;soft&#x2F;elasticsearch&#x2F;logstash-6.8.8&#x2F;config&#x2F;logstash_metadata&quot;
        &#125;
    &#125; 
    output &#123;
        elasticsearch &#123;
        #ESçš„ipåœ°å€å’Œç«¯å£
        hosts &#x3D;&gt; &quot;localhost:9200&quot;
        #hosts &#x3D;&gt; [&quot;localhost:9200&quot;,&quot;localhost:9202&quot;,&quot;localhost:9203&quot;]
        #ESç´¢å¼•åº“åç§°
        index &#x3D;&gt; &quot;xc_course&quot;
        document_id &#x3D;&gt; &quot;%&#123;id
        document_type &#x3D;&gt; &quot;doc&quot;
        template &#x3D;&gt;&quot;D:&#x2F;soft&#x2F;elasticsearch&#x2F;logstash-6.8.8&#x2F;config&#x2F;xc_course_template.json&quot;
        template_name &#x3D;&gt; &quot;xc_course&quot;
        template_overwrite &#x3D;&gt;&quot;true&quot;
    &#125; 
	stdout &#123;
    #æ—¥å¿—è¾“å‡º
    	codec &#x3D;&gt; json_lines
    &#125;
&#125;</code></pre></div>

<p>è¯´æ˜ï¼š</p>
<p>1ã€<code>ES</code> é‡‡ç”¨ <code>UTC</code> æ—¶åŒºé—®é¢˜</p>
<p><code>ES</code> é‡‡ç”¨ <code>UTC</code> æ—¶åŒºï¼Œæ¯”åŒ—äº¬æ—¶é—´æ—©8å°æ—¶ï¼Œæ‰€ä»¥ <code>ES</code> è¯»å–æ•°æ®æ—¶è®©æœ€åæ›´æ–°æ—¶é—´åŠ 8å°æ—¶<br><code>where timestamp &gt; date_add(:sql_last_value,INTERVAL 8 HOUR)</code></p>
<p>2ã€<code>logstash</code> æ¯ä¸ªæ‰§è¡Œå®Œæˆä¼šåœ¨ <code>config/logstash_metadata</code> è®°å½•æ‰§è¡Œæ—¶é—´ä¸‹æ¬¡ä»¥æ­¤æ—¶é—´ä¸ºåŸºå‡†è¿›è¡Œå¢é‡åŒæ­¥æ•°æ®åˆ°ç´¢å¼•åº“ã€‚</p>
<h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>å¯åŠ¨ <code>logstash.bat</code></p>
<div class="hljs"><pre><code class="hljs c">.\logstash.bat -f ..\<span class="hljs-built_in">config</span>\mysql.conf</code></pre></div>

<p><a href="https://qnoss.codeyee.com/20200704_11/image12" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image12.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¿®æ”¹ <code>course_pub</code> ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”ä¿®æ”¹ <code>timestamp</code> ä¸ºå½“å‰æ—¶é—´ï¼Œè§‚å¯Ÿ <code>Logstash</code> æ—¥å¿—æ˜¯å¦è¯»å–åˆ°è¦ç´¢å¼•çš„æ•°æ®ã€‚</p>
<p>æœ€åç”¨ <code>head</code> ç™»å½• <code>ES</code> æŸ¥çœ‹ç´¢å¼•æ–‡æ¡£å†…å®¹æ˜¯å¦ä¿®æ”¹ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image13" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image13.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-è¯¾ç¨‹æœç´¢å®æˆ˜"><a href="#3-è¯¾ç¨‹æœç´¢å®æˆ˜" class="headerlink" title="3. è¯¾ç¨‹æœç´¢å®æˆ˜"></a>3. è¯¾ç¨‹æœç´¢å®æˆ˜</h2><h3 id="1ã€éœ€æ±‚åˆ†æ-1"><a href="#1ã€éœ€æ±‚åˆ†æ-1" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h3><p>1ã€æ ¹æ® <strong>åˆ†ç±»</strong> æœç´¢è¯¾ç¨‹ä¿¡æ¯ã€‚</p>
<p>2ã€æ ¹æ® <strong>å…³é”®å­—</strong> æœç´¢è¯¾ç¨‹ä¿¡æ¯ï¼Œæœç´¢æ–¹å¼ä¸ºå…¨æ–‡æ£€ç´¢ï¼Œå…³é”®å­—éœ€è¦åŒ¹é…è¯¾ç¨‹çš„åç§°ã€ è¯¾ç¨‹å†…å®¹ã€‚</p>
<p>3ã€æ ¹æ® <strong>éš¾åº¦ç­‰çº§</strong> æœç´¢è¯¾ç¨‹ã€‚</p>
<p>4ã€æœç´¢ç»“ç‚¹åˆ†é¡µæ˜¾ç¤ºã€‚</p>
<h4 id="æŠ€æœ¯åˆ†æ"><a href="#æŠ€æœ¯åˆ†æ" class="headerlink" title="æŠ€æœ¯åˆ†æ"></a>æŠ€æœ¯åˆ†æ</h4><p>1ã€æ ¹æ®å…³é”®å­—æœç´¢ï¼Œé‡‡ç”¨ <code>MultiMatchQuery</code>ï¼Œæœç´¢ <code>name</code>ã€<code>description</code>ã€<code>teachplan</code></p>
<p>2ã€æ ¹æ®åˆ†ç±»ã€è¯¾ç¨‹ç­‰çº§æœç´¢é‡‡ç”¨è¿‡è™‘å™¨å®ç°ã€‚</p>
<p>3ã€åˆ†é¡µæŸ¥è¯¢ã€‚</p>
<p>4ã€é«˜äº®æ˜¾ç¤ºã€‚</p>
<h3 id="2ã€åˆ›å»ºæœç´¢æœåŠ¡å·¥ç¨‹"><a href="#2ã€åˆ›å»ºæœç´¢æœåŠ¡å·¥ç¨‹" class="headerlink" title="2ã€åˆ›å»ºæœç´¢æœåŠ¡å·¥ç¨‹"></a>2ã€åˆ›å»ºæœç´¢æœåŠ¡å·¥ç¨‹</h3><p>è¯¥å·¥ç¨‹ç¯å¢ƒæˆ‘ä»¬åœ¨ <code>day10</code> å·²ç»æ­å»ºå®Œæˆï¼Œå¦‚æœä½ æœªå­¦ä¹ å‰é¢çš„ç« èŠ‚ï¼Œè¯·å‚è€ƒ <code>day10 å…­ã€ç´¢å¼•ç®¡ç†</code> çš„å†…å®¹ã€‚</p>
<h3 id="3ã€æ„å»ºAPI"><a href="#3ã€æ„å»ºAPI" class="headerlink" title="3ã€æ„å»ºAPI"></a>3ã€æ„å»ºAPI</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.api.search;

<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.course.CoursePub;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.search.CourseSearchParam;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResponseResult;
<span class="hljs-keyword">import</span> io.swagger.annotations.Api;
<span class="hljs-keyword">import</span> io.swagger.annotations.ApiOperation;

<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-meta">@Api</span>(value = <span class="hljs-string">"è¯¾ç¨‹æœç´¢"</span>, description = <span class="hljs-string">"åŸºäºESæ„å»ºçš„è¯¾ç¨‹æœç´¢API"</span>,tags = &#123;<span class="hljs-string">"è¯¾ç¨‹æœç´¢"</span>&#125;)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">EsCourseConrollerApi</span> </span>&#123;
    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è¯¾ç¨‹è¯¦ç»†æœç´¢"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult&lt;CoursePub&gt; <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, CourseSearchParam courseSearchParam)</span> <span class="hljs-keyword">throws</span> IOException</span>;
&#125;</code></pre></div>

<h3 id="4ã€Service"><a href="#4ã€Service" class="headerlink" title="4ã€Service"></a>4ã€Service</h3><h4 id="æŒ‰å…³é”®è¯æœç´¢"><a href="#æŒ‰å…³é”®è¯æœç´¢" class="headerlink" title="æŒ‰å…³é”®è¯æœç´¢"></a>æŒ‰å…³é”®è¯æœç´¢</h4><p>åœ¨ <code>appliction.yml</code> ä¸­é…ç½® <code>source_field</code></p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">hostlist:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:9200</span> <span class="hljs-comment">#å¤šä¸ªç»“ç‚¹ä¸­é—´ç”¨é€—å·åˆ†éš”</span>
    <span class="hljs-attr">course:</span>
    <span class="hljs-attr">index:</span> <span class="hljs-string">xc_course</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">doc</span>
    <span class="hljs-attr">source_field:</span> <span class="hljs-string">id,name,grade,mt,st,charge,valid,pic,qq,price,price_old,status,studymodel,teachmode,expires,pub_time,start_time,end_time</span></code></pre></div>

<p><code>service</code> å®Œæ•´ä»£ç å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * è¯¾ç¨‹åˆ—è¡¨æœç´¢</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page é¡µç </span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> size æ¯é¡µæ•°é‡</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseSearchParam æœç´¢å‚æ•°</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IOException</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult&lt;CoursePub&gt; <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, CourseSearchParam courseSearchParam)</span> <span class="hljs-keyword">throws</span> IOException</span>&#123;
    <span class="hljs-comment">//è®¾ç½®ç´¢å¼•</span>
    SearchRequest searchRequest = <span class="hljs-keyword">new</span> SearchRequest(es_index);
    <span class="hljs-comment">//è®¾ç½®ç±»å‹</span>
    searchRequest.types(es_type);
    <span class="hljs-comment">//åˆ›å»ºæœç´¢æºå¯¹è±¡</span>
    SearchSourceBuilder searchSourceBuilder = <span class="hljs-keyword">new</span> SearchSourceBuilder();
    <span class="hljs-comment">//åˆ›å»ºå¸ƒå°”æŸ¥è¯¢å¯¹è±¡</span>
    BoolQueryBuilder boolQueryBuilder = <span class="hljs-keyword">new</span> BoolQueryBuilder();

    <span class="hljs-comment">//æºå­—æ®µè¿‡æ»¤</span>
    String[] fieldArr = source_field.split(<span class="hljs-string">","</span>);
    searchSourceBuilder.fetchSource(fieldArr,<span class="hljs-keyword">new</span> String[]&#123;&#125;);

    <span class="hljs-comment">//æ ¹æ®å…³é”®å­—è¿›è¡ŒæŸ¥è¯¢</span>
    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getKeyword()))&#123;
        <span class="hljs-comment">//åŒ¹é…å…³é”®è¯</span>
        MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders.multiMatchQuery(courseSearchParam.getKeyword(), <span class="hljs-string">"name"</span>, <span class="hljs-string">"teachplan"</span>, <span class="hljs-string">"description"</span>);
        <span class="hljs-comment">//è®¾ç½®åŒ¹é…å æ¯”</span>
        multiMatchQueryBuilder.minimumShouldMatch(<span class="hljs-string">"70%"</span>);
        <span class="hljs-comment">//æå‡å­—æ®µçš„æƒé‡å€¼</span>
        multiMatchQueryBuilder.field(<span class="hljs-string">"name"</span>,<span class="hljs-number">10</span>);
        boolQueryBuilder.must(multiMatchQueryBuilder);
    &#125;

    <span class="hljs-comment">//æ ¹æ®éš¾åº¦è¿›è¡Œè¿‡æ»¤</span>
    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getMt()))&#123;
        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"mt"</span>,courseSearchParam.getMt()));
    &#125;
    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getSt()))&#123;
        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"st"</span>,courseSearchParam.getSt()));
    &#125;
    <span class="hljs-comment">//æ ¹æ®ç­‰çº§è¿›è¡Œè¿‡æ»¤</span>
    <span class="hljs-keyword">if</span>(StringUtils.isNotEmpty(courseSearchParam.getGrade()))&#123;
        boolQueryBuilder.filter(QueryBuilders.termQuery(<span class="hljs-string">"grade"</span>,courseSearchParam.getGrade()));
    &#125;

    <span class="hljs-comment">//è®¾ç½®åˆ†é¡µå‚æ•°</span>
    <span class="hljs-keyword">if</span>(page&lt;=<span class="hljs-number">0</span>)&#123;
        page = <span class="hljs-number">1</span>;
    &#125;
    <span class="hljs-keyword">if</span>(size&lt;=<span class="hljs-number">0</span>)&#123;
        size = <span class="hljs-number">20</span>;
    &#125;
    <span class="hljs-comment">//è®¡ç®—æœç´¢èµ·å§‹ä½ç½®</span>
    <span class="hljs-keyword">int</span> start = (page-<span class="hljs-number">1</span>) * size;
    searchSourceBuilder.from(start);
    searchSourceBuilder.size(size);

    <span class="hljs-comment">//å°†å¸ƒå°”æŸ¥è¯¢å¯¹è±¡æ·»åŠ åˆ°æœç´¢æºå†…</span>
    searchSourceBuilder.query(boolQueryBuilder);

    <span class="hljs-comment">//é…ç½®é«˜äº®ä¿¡æ¯</span>
    HighlightBuilder highlightBuilder = <span class="hljs-keyword">new</span> HighlightBuilder();
    highlightBuilder.preTags(<span class="hljs-string">"&lt;font class='eslight'&gt;"</span>);
    highlightBuilder.postTags(<span class="hljs-string">"&lt;/font&gt;"</span>);
    <span class="hljs-comment">//è®¾ç½®é«˜äº®å­—æ®µ</span>
    highlightBuilder.fields().add(<span class="hljs-keyword">new</span> HighlightBuilder.Field(<span class="hljs-string">"name"</span>));
    searchSourceBuilder.highlighter(highlightBuilder);

    <span class="hljs-comment">//è¯·æ±‚æœç´¢</span>
    searchRequest.source(searchSourceBuilder);
    SearchResponse searchResponse = <span class="hljs-keyword">null</span>;
    <span class="hljs-keyword">try</span>&#123;
        searchResponse = restHighLevelClient.search(searchRequest);
    &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;
        <span class="hljs-comment">//æœç´¢å¼‚å¸¸</span>
        e.printStackTrace();
        LOGGER.error(<span class="hljs-string">"search error ...&#123;&#125;"</span>,e.getMessage());
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult&lt;&gt;(CommonCode.FAIL,<span class="hljs-keyword">null</span>);
    &#125;

    <span class="hljs-comment">//ç»“æœæ”¶é›†å¤„ç†</span>
    SearchHits hits = searchResponse.getHits();
    <span class="hljs-comment">//è·å–åŒ¹é…åº¦é«˜çš„ç»“æœ</span>
    SearchHit[] searchHits = hits.getHits();
    <span class="hljs-comment">//æ€»è®°å½•æ•°</span>
    <span class="hljs-keyword">long</span> totalHits = hits.getTotalHits();
    <span class="hljs-comment">//æ•°æ®åˆ—è¡¨</span>
    ArrayList&lt;CoursePub&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();

    <span class="hljs-comment">//æ·»åŠ æ•°æ®</span>
    <span class="hljs-keyword">for</span> (SearchHit hit: searchHits)&#123;
        CoursePub coursePub = <span class="hljs-keyword">new</span> CoursePub();

        Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();
        <span class="hljs-comment">//å–å‡ºåç§°</span>
        String name = (String) sourceAsMap.get(<span class="hljs-string">"name"</span>);
        coursePub.setName(name);
        <span class="hljs-comment">//å›¾ç‰‡</span>
        String pic = (String) sourceAsMap.get(<span class="hljs-string">"pic"</span>);
        coursePub.setPic(pic);
        <span class="hljs-comment">//ä¼˜æƒ åçš„ä»·æ ¼</span>
        Float price = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">if</span>(sourceAsMap.get(<span class="hljs-string">"price"</span>) !=<span class="hljs-keyword">null</span>)&#123;
                price = Float.parseFloat(String.format(<span class="hljs-string">"%.3f"</span>,sourceAsMap.get(<span class="hljs-string">"price"</span>)));
            &#125;
        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;
            e.printStackTrace();
        &#125;
        coursePub.setPrice(price);
        <span class="hljs-comment">//ä¼˜æƒ å‰çš„ä»·æ ¼</span>
        Float priceOld = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">try</span> &#123;
            <span class="hljs-keyword">if</span>(sourceAsMap.get(<span class="hljs-string">"price_old"</span>) !=<span class="hljs-keyword">null</span>)&#123;
                priceOld = Float.parseFloat(String.format(<span class="hljs-string">"%.3f"</span>,sourceAsMap.get(<span class="hljs-string">"price_old"</span>)));
            &#125;
        &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;
            e.printStackTrace();
        &#125;
        coursePub.setPrice_old(priceOld);

        list.add(coursePub);
    &#125;

    <span class="hljs-comment">//è¿”å›å“åº”ç»“æœ</span>
    QueryResult&lt;CoursePub&gt; queryResult = <span class="hljs-keyword">new</span> QueryResult&lt;&gt;();
    queryResult.setList(list);
    queryResult.setTotal(totalHits);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult&lt;&gt;(CommonCode.SUCCESS,queryResult);
&#125;</code></pre></div>

<p>servcice çš„ä»£ç ä¸­çš„æ³¨é‡Šå·²ç»å†™å¾—å¾ˆè¯¦ç»†äº†ï¼Œè¿™é‡Œæˆ‘å°±ä¸å†åšè¿‡å¤šçš„è§£é‡Šï¼Œè¯·è¯¦ç»†çš„é˜…è¯»ä¸Šè¿°çš„ä»£ç ã€‚</p>
<h3 id="5ã€Controller"><a href="#5ã€Controller" class="headerlink" title="5ã€Controller"></a>5ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * è¯¾ç¨‹ä¿¡æ¯æœç´¢</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page é¡µç </span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> size æ¯é¡µæ•°é‡</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseSearchParam æœç´¢å‚æ•°</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> IOException</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/list/&#123;page&#125;/&#123;size&#125;"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult&lt;CoursePub&gt; <span class="hljs-title">findList</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"page"</span>)</span> <span class="hljs-keyword">int</span> page,@<span class="hljs-title">PathVariable</span><span class="hljs-params">(<span class="hljs-string">"size"</span>)</span> <span class="hljs-keyword">int</span> size, CourseSearchParam courseSearchParam) <span class="hljs-keyword">throws</span> IOException </span>&#123;
    <span class="hljs-keyword">return</span> esCourseService.findList(page,size,courseSearchParam);
&#125;</code></pre></div>

<h3 id="6ã€æµ‹è¯•"><a href="#6ã€æµ‹è¯•" class="headerlink" title="6ã€æµ‹è¯•"></a>6ã€æµ‹è¯•</h3><h4 id="æ ¹æ®å…³é”®å­—æœç´¢"><a href="#æ ¹æ®å…³é”®å­—æœç´¢" class="headerlink" title="æ ¹æ®å…³é”®å­—æœç´¢"></a>æ ¹æ®å…³é”®å­—æœç´¢</h4><p>ä½¿ç”¨ <code>postman</code> æµ‹è¯•</p>
<p>GET: <a href="http://localhost:40100/search/course/list/1/20?keyword=java" target="_blank" rel="noopener">http://localhost:40100/search/course/list/1/20?keyword=java</a> å¼€å‘</p>
<p><a href="https://qnoss.codeyee.com/20200704_11/image14" target="_blank" rel="noopener"><img src="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/image14.gif" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="æ ¹æ®ä»·æ ¼ã€ç­‰çº§ã€éš¾åº¦è¿›è¡Œæœç´¢"><a href="#æ ¹æ®ä»·æ ¼ã€ç­‰çº§ã€éš¾åº¦è¿›è¡Œæœç´¢" class="headerlink" title="æ ¹æ®ä»·æ ¼ã€ç­‰çº§ã€éš¾åº¦è¿›è¡Œæœç´¢"></a>æ ¹æ®ä»·æ ¼ã€ç­‰çº§ã€éš¾åº¦è¿›è¡Œæœç´¢</h4><p>å¾…æµ‹è¯•</p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">å­¦æˆåœ¨çº¿</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/ElasticSearch/">ElasticSearch</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/19/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday12/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day12ï¼šåŸºäº Nuxt.js æ„å»ºæœç´¢å‰ç«¯å·¥ç¨‹</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/">
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day10ï¼šè¯¾ç¨‹å‘å¸ƒã€ElasticSearch</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

ä»£ç å—js ç”¨ä¸åˆ°ï¼Œfulidè‡ªå¸¦æœ‰ï¼Œæ·»åŠ cssæ ·å¼å³å¯å®ç°
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®å­—</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å‹‰å¼ºè¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">äº¬ICPè¯123456å·</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>äº¬å…¬ç½‘å®‰å¤‡12345678å·</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "å­¦æˆåœ¨çº¿day11ï¼šåŸºäº ElasticSearch æ„å»ºæœç´¢æœåŠ¡&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
