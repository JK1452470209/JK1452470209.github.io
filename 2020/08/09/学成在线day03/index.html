<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>学成在线day03：CMS页面管理开发 - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>私人博客</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                主页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于我
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-09 17:23">
      2020-08-09
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      9.2k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      135
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="😎知识点概览"><a href="#😎知识点概览" class="headerlink" title="😎知识点概览"></a>😎知识点概览</h1><blockquote>
<p>为了方便后续回顾该项目时能够清晰的知道本章节讲了哪些内容，并且能够从该章节的笔记中得到一些帮助，所以在完成本章节的学习后在此对本章节所涉及到的知识点进行总结概述。</p>
</blockquote>
<p>本章节为【学成在线】项目的 <code>day03</code> 的内容</p>
<ul>
<li>使用 <code>Spring data</code> 提供的 <code>PageRequest</code> 模块进行分页查询的应用</li>
<li>使用 <code>Spring data</code> 提供 <code>MongoDB</code> 的dao接口进行前后端联调的 CRUD 操作</li>
<li>基于 <code>VUE.JS</code> 的前端模块化开发</li>
<li>使用统一的响应模型、状态码进行 <code>RESTful</code> 风格的API开发</li>
<li>熟悉使用 <code>Swagger</code> 进行接口文档的生成与测试</li>
<li>异常处理以及如何自定义异常，根据不同的异常自定义返回的消息格式。</li>
</ul>
<h1 id="一、自定义条件查询"><a href="#一、自定义条件查询" class="headerlink" title="一、自定义条件查询"></a>一、自定义条件查询</h1><h2 id="1-需求分析"><a href="#1-需求分析" class="headerlink" title="1. 需求分析"></a>1. 需求分析</h2><p>在页面输入查询条件，查询符合条件的页面信息。</p>
<p>查询条件如下：</p>
<p>站点Id：精确匹配</p>
<p>模板Id：精确匹配</p>
<p>页面别名：模糊匹配</p>
<h2 id="2-服务端"><a href="#2-服务端" class="headerlink" title="2.服务端"></a>2.服务端</h2><h3 id="Dao层"><a href="#Dao层" class="headerlink" title="Dao层"></a>Dao层</h3><p>使用 <code>CmsPageRepository</code> 中的 <code>findAll(Example&lt;S&gt; var1, Pageable var2)</code> 方法实现，无需定义。</p>
<h3 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h3><p>下边测试findAll方法实现自定义条件查询：</p>
<p>1、指定站点id、模板id作为查询条件</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//自定义条件查询</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testDiyFindAll</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-comment">//精确匹配条件值</span>
    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();
    cmsPage.setSiteId(<span class="hljs-string">"5a751fab6abb5044e0d19ea1"</span>);
    cmsPage.setTemplateId(<span class="hljs-string">"5a925be7b00ffc4b3c1578b5"</span>);

    <span class="hljs-comment">//条件匹配器,用于模糊匹配</span>
    ExampleMatcher matching = ExampleMatcher.matching();

    <span class="hljs-comment">//条件查询实例</span>
    Example&lt;CmsPage&gt; example = Example.of(cmsPage, matching);

    <span class="hljs-comment">//分页参数</span>
    <span class="hljs-keyword">int</span> page = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> size = <span class="hljs-number">20</span>;
    Pageable pageable = PageRequest.of(page,size);

    <span class="hljs-comment">//调用dao</span>
    Page&lt;CmsPage&gt; all = cmsPageRepository.findAll(example, pageable);
    List&lt;CmsPage&gt; content = all.getContent();
    System.out.println(content);
&#125;</code></pre></div>

<p>查询结果</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image1.png" srcset="/img/loading.gif" alt></p>
<p>在上面的代码基础上，增加 <code>ExampleMatcher</code> 实例的一些属性作为模糊查询的参数，增加的代码如下</p>
<div class="hljs"><pre><code class="hljs java">cmsPage.setPageAliase(<span class="hljs-string">"详细"</span>);
<span class="hljs-comment">//条件匹配器,用于模糊匹配</span>
ExampleMatcher matching = ExampleMatcher.matching()
       .withMatcher(<span class="hljs-string">"pageAliase"</span>,ExampleMatcher.GenericPropertyMatchers.contains());</code></pre></div>

<p><code>.withMatcher</code> 的第一个参数表示要将哪个字段进行匹配，第二个则是要使用的匹配器；</p>
<p><code>ExampleMatcher.GenericPropertyMatchers</code> 有多个匹配器，这里我们用 <code>.contains()</code> 进行模糊匹配</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image2" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image2.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="Service层"><a href="#Service层" class="headerlink" title="Service层"></a>Service层</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span>
CmsPageRepository cmsPageRepository;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 分页查询</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> page 页号</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> size 每页大小</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> queryPageRequest 查询条件</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page,<span class="hljs-keyword">int</span> size,QueryPageRequest queryPageRequest)</span> </span>&#123;
    <span class="hljs-comment">//判断条件对象是否为空</span>
    <span class="hljs-keyword">if</span>(queryPageRequest == <span class="hljs-keyword">null</span>)&#123;
        queryPageRequest = <span class="hljs-keyword">new</span> QueryPageRequest();
    &#125;

    <span class="hljs-comment">//匹配条件值</span>
    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();

    <span class="hljs-comment">//设置条件值</span>
    <span class="hljs-comment">//站点ID</span>
    <span class="hljs-keyword">if</span>(!StringUtil.isNullOrEmpty(queryPageRequest.getSiteId()))&#123;
        cmsPage.setSiteId(queryPageRequest.getSiteId());
    &#125;
    <span class="hljs-comment">//模板ID</span>
    <span class="hljs-keyword">if</span>(!StringUtil.isNullOrEmpty(queryPageRequest.getTemplateId()))&#123;
        cmsPage.setTemplateId(queryPageRequest.getTemplateId());
    &#125;

    <span class="hljs-comment">//站点别名</span>
    <span class="hljs-keyword">if</span>(!StringUtil.isNullOrEmpty(queryPageRequest.getPageAliase()))&#123;
        cmsPage.setPageAliase(queryPageRequest.getPageAliase());
    &#125;

    <span class="hljs-comment">//条件匹配器，用于模糊查询</span>
    ExampleMatcher exampleMatcher = ExampleMatcher.matching()
            .withMatcher(<span class="hljs-string">"pageAliase"</span>, ExampleMatcher.GenericPropertyMatchers.contains());


    <span class="hljs-comment">//条件查询实例</span>
    Example&lt;CmsPage&gt; example = Example.of(cmsPage, exampleMatcher);

    <span class="hljs-comment">//过滤条件</span>
    <span class="hljs-keyword">if</span>(page &lt;= <span class="hljs-number">0</span>)&#123;
        page = <span class="hljs-number">1</span>;
    &#125;
    <span class="hljs-keyword">if</span>(size &lt;= <span class="hljs-number">0</span>)&#123;
        size = <span class="hljs-number">10</span>;
    &#125;
    page = page - <span class="hljs-number">1</span>;

    <span class="hljs-comment">//创建分页查询参数</span>
    PageRequest pageable = PageRequest.of(page, size);

    <span class="hljs-comment">//分页查询数据</span>
    Page&lt;CmsPage&gt; all = cmsPageRepository.findAll(example, pageable);

    <span class="hljs-comment">//整理查询到的数据</span>
    QueryResult queryResult = <span class="hljs-keyword">new</span> QueryResult();
    queryResult.setList(all.getContent());
    queryResult.setTotal(all.getTotalElements());

    <span class="hljs-comment">//返回结果</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> QueryResponseResult(CommonCode.SUCCESS,queryResult);
&#125;</code></pre></div>

<p>Controller层无需修改</p>
<h3 id="使用SwaggerUI测试"><a href="#使用SwaggerUI测试" class="headerlink" title="使用SwaggerUI测试"></a>使用SwaggerUI测试</h3><p>参数</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image3.png" srcset="/img/loading.gif" alt="img"></p>
<p>查询结果</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image4.png" srcset="/img/loading.gif" alt="img"></p>
<p>从查询结果中我们可以看出，根据我们输入的条件，查询到了指定 <code>sizeId</code> 并且 <code>pageAliase</code> 包含预览的信息。</p>
<h2 id="3-前端"><a href="#3-前端" class="headerlink" title="3. 前端"></a>3. 前端</h2><h3 id="页面"><a href="#页面" class="headerlink" title="页面"></a>页面</h3><p>1、增加查询表单</p>
<blockquote>
<p>在el-table上方添加该表单</p>
</blockquote>
<div class="hljs"><pre><code class="hljs vue">&lt;!--查询表单--&gt;
&lt;el-form :model&#x3D;&quot;params&quot;&gt;
  &lt;el-select v-model&#x3D;&quot;params.siteId&quot; placeholder&#x3D;&quot;请选择站点&quot;&gt;
    &lt;el-option
    v-for&#x3D;&quot;item in siteList&quot;
    :key&#x3D;&quot;item.siteId&quot;
    :label&#x3D;&quot;item.siteName&quot;
    :value&#x3D;&quot;item.siteId&quot;&gt;
    &lt;&#x2F;el-option&gt;
  &lt;&#x2F;el-select&gt;
  页面别名: &lt;el-input v-model&#x3D;&quot;params.pageAliase&quot; style&#x3D;&quot;width: 100px&quot;&gt;&lt;&#x2F;el-input&gt;
&lt;el-button type&#x3D;&quot;primary&quot; v-on:click&#x3D;&quot;query&quot; size&#x3D;&quot;small&quot;&gt;查询&lt;&#x2F;el-button&gt;
&lt;&#x2F;el-form&gt;</code></pre></div>

<p>2、新增数据模型对象</p>
<div class="hljs"><pre><code class="hljs js">data() &#123;
  <span class="hljs-keyword">return</span> &#123;
    siteList:[],<span class="hljs-comment">//站点列表</span>
    list:[],
    total:<span class="hljs-number">0</span>,
    params:&#123;
      siteId:<span class="hljs-string">''</span>,
      pageAliase:<span class="hljs-string">''</span>,
      page:<span class="hljs-number">1</span>,<span class="hljs-comment">//页码</span>
      size:<span class="hljs-number">10</span><span class="hljs-comment">//每页显示个数</span>
    &#125;
  &#125;
&#125;,</code></pre></div>

<p>3、在钩子方法中 获取 <code>siteList</code> 站点列表（这里暂时用静态数据代替）</p>
<div class="hljs"><pre><code class="hljs js">mounted() &#123;
  <span class="hljs-comment">//默认查询页面</span>
  <span class="hljs-keyword">this</span>.query()
  <span class="hljs-comment">//初始化站点列表</span>
  <span class="hljs-keyword">this</span>.siteList = [
    &#123;
      siteId:<span class="hljs-string">'5a751fab6abb5044e0d19ea1'</span>,
      siteName:<span class="hljs-string">'门户主站'</span>
    &#125;,
    &#123;
      siteId:<span class="hljs-string">'102'</span>,
      siteName:<span class="hljs-string">'测试站'</span>
    &#125;
  ]
&#125;,</code></pre></div>

<h3 id="API调用"><a href="#API调用" class="headerlink" title="API调用"></a>API调用</h3><p>1、向服务端传递查询条件，修改 cms.js，如下：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//public是对axios的工具类封装，定义了http请求方法</span>
<span class="hljs-keyword">import</span> http from <span class="hljs-string">'./../../../base/api/public'</span>  <span class="hljs-comment">//ES6 导入</span>
<span class="hljs-keyword">import</span> querystring from <span class="hljs-string">"querystring"</span>
let sysConfig = require(<span class="hljs-string">'@/../config/sysConfig'</span>)
let apiUrl = sysConfig.xcApiUrlPre
<span class="hljs-comment">//页面查询</span>
export <span class="hljs-keyword">const</span> page_list = (page,size,params) =&gt; &#123;

  <span class="hljs-comment">//将json对象转成key/value对</span>
  let queryString = querystring.stringify(params);
  <span class="hljs-comment">//定义方法，请求服务端查询接口</span>
  <span class="hljs-keyword">return</span> http.requestQuickGet(apiUrl + <span class="hljs-string">'/cms/page/list/'</span>+page+<span class="hljs-string">'/'</span>+ size +<span class="hljs-string">'?'</span> + queryString)
&#125;</code></pre></div>

<p>2、页面调用api方法</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//查询</span>
query:function () &#123;
  <span class="hljs-comment">//调用服务端接口</span>
  cmsApi.page_list(<span class="hljs-keyword">this</span>.params.page, <span class="hljs-keyword">this</span>.params.size, <span class="hljs-keyword">this</span>.params).then((res) =&gt;&#123;
    console.log(res)
    <span class="hljs-comment">//将res结果数据赋值给数据模型对象</span>
    <span class="hljs-keyword">this</span>.list = res.queryResult.list
    <span class="hljs-keyword">this</span>.total = res.queryResult.total
  &#125;)
&#125;</code></pre></div>

<p>3、测试</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image5.png" srcset="/img/loading.gif" alt="img"></p>
<h1 id="二、新增页面"><a href="#二、新增页面" class="headerlink" title="二、新增页面"></a>二、新增页面</h1><h2 id="1-准备工作，页面管理API"><a href="#1-准备工作，页面管理API" class="headerlink" title="1.准备工作，页面管理API"></a>1.准备工作，页面管理API</h2><p>在配置新增页面的功能之前，我们先配置一个接口，用于获取页面的信息</p>
<h3 id="Dao层-1"><a href="#Dao层-1" class="headerlink" title="Dao层"></a>Dao层</h3><p>CmsPageRepository</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 继承MongoDB自带的Repository</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  22:36</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsPage</span>,<span class="hljs-title">String</span>&gt; </span>&#123;
&#125;</code></pre></div>



<h3 id="定义查询模型"><a href="#定义查询模型" class="headerlink" title="定义查询模型"></a>定义查询模型</h3><p>QueryPageRequest</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.domain.cms.request;

<span class="hljs-keyword">import</span> io.swagger.annotations.ApiModelProperty;
<span class="hljs-keyword">import</span> lombok.Data;



<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  21:13</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">QueryPageRequest</span> </span>&#123;
    <span class="hljs-comment">//接收页面查询的查询条件</span>
    <span class="hljs-comment">//站点id</span>
    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"站点id"</span>)
    <span class="hljs-keyword">private</span> String siteId;
    <span class="hljs-comment">//页面id</span>
    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"页面id"</span>)
    <span class="hljs-keyword">private</span> String pageId;
    <span class="hljs-comment">//页面名称</span>
    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"页面名称"</span>)
    <span class="hljs-keyword">private</span> String pageName;
    <span class="hljs-comment">//别名</span>
    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"别名"</span>)
    <span class="hljs-keyword">private</span> String pageAliase;
    <span class="hljs-comment">//模板id</span>
    <span class="hljs-meta">@ApiModelProperty</span>(<span class="hljs-string">"模板id"</span>)
    <span class="hljs-keyword">private</span> String templateId;
    <span class="hljs-comment">//...</span>


&#125;</code></pre></div>

<h3 id="定义响应模型"><a href="#定义响应模型" class="headerlink" title="定义响应模型"></a>定义响应模型</h3><p>CmsPageResult</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPageResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;
    CmsPage cmsPage;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CmsPageResult</span><span class="hljs-params">(ResultCode resultCode,CmsPage cmsPage)</span> </span>&#123;
        <span class="hljs-keyword">super</span>(resultCode);
        <span class="hljs-keyword">this</span>.cmsPage = cmsPage;
    &#125;
&#125;</code></pre></div>

<h3 id="Service层-1"><a href="#Service层-1" class="headerlink" title="Service层"></a>Service层</h3><p>PageService</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PageService</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    CmsPageRepository cmsPageRepository;
    
&#125;</code></pre></div>

<h3 id="Controller层"><a href="#Controller层" class="headerlink" title="Controller层"></a>Controller层</h3><p>定义页面相关操作的api</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  21:16</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Api</span>(value = <span class="hljs-string">"cms页面管理接口"</span>,description = <span class="hljs-string">"cms页面管理接口，提供页面的增，删，改，查"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageControllerApi</span> </span>&#123;
    <span class="hljs-comment">//页面查询</span>
    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"分页查询页面列表"</span>)
    <span class="hljs-meta">@ApiImplicitParams</span>(&#123;
            <span class="hljs-meta">@ApiImplicitParam</span>(name = <span class="hljs-string">"page"</span>,value = <span class="hljs-string">"页码"</span>,required = <span class="hljs-keyword">true</span>,paramType = <span class="hljs-string">"path"</span>,dataType = <span class="hljs-string">"int"</span>),
            <span class="hljs-meta">@ApiImplicitParam</span>(name = <span class="hljs-string">"size"</span>,value = <span class="hljs-string">"每页记录数"</span>,required = <span class="hljs-keyword">true</span>,paramType = <span class="hljs-string">"path"</span>,dataType = <span class="hljs-string">"int"</span>)
    &#125;)
    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(<span class="hljs-keyword">int</span> page, <span class="hljs-keyword">int</span> size, QueryPageRequest queryPageRequest)</span></span>;
 &#125;</code></pre></div>

<p>CmsPageController</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.manage_cms.controller;

<span class="hljs-keyword">import</span> com.xuecheng.api.cms.CmsPageControllerApi;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.CmsPage;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.request.QueryPageRequest;
<span class="hljs-keyword">import</span> com.xuecheng.framework.domain.cms.response.CmsPageResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.QueryResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.manage_cms.service.PageService;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;


<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-06  22:04</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping</span>(<span class="hljs-string">"/cms/page"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPageController</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CmsPageControllerApi</span> </span>&#123;

    <span class="hljs-meta">@Autowired</span>
    PageService pageService;

    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/list/&#123;page&#125;/&#123;size&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> QueryResponseResult <span class="hljs-title">findList</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"page"</span>)</span> <span class="hljs-keyword">int</span> page, </span>
<span class="hljs-function">               @<span class="hljs-title">PathVariable</span><span class="hljs-params">(<span class="hljs-string">"size"</span>)</span> <span class="hljs-keyword">int</span> size, QueryPageRequest queryPageRequest) </span>&#123;
           
        QueryResponseResult responseResult = pageService.findList(page, size, queryPageRequest);
        <span class="hljs-keyword">return</span> responseResult;
    &#125;</code></pre></div>



<p>测试</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image6.png" srcset="/img/loading.gif" alt="img"></p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image7.png" srcset="/img/loading.gif" alt="img"></p>
<h2 id="2-后端接口定义"><a href="#2-后端接口定义" class="headerlink" title="2.后端接口定义"></a>2.后端接口定义</h2><h3 id="1、定义响应模型"><a href="#1、定义响应模型" class="headerlink" title="1、定义响应模型"></a>1、定义响应模型</h3><blockquote>
<p>用于接口的响应规范，继承于项目中的ResponseResult</p>
</blockquote>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPageResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;
    CmsPage cmsPage;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CmsPageResult</span><span class="hljs-params">(ResultCode resultCode,CmsPage cmsPage)</span> </span>&#123;
        <span class="hljs-keyword">super</span>(resultCode);
        <span class="hljs-keyword">this</span>.cmsPage = cmsPage;
	&#125;
&#125;</code></pre></div>

<h3 id="2、定义添加Api"><a href="#2、定义添加Api" class="headerlink" title="2、定义添加Api"></a>2、定义添加Api</h3><p>在 <code>CmsPageControllerApi</code> 中新增 <code>addCmsPage</code> 接口</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 添加页面数据</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"添加页面数据"</span>)
<span class="hljs-meta">@ApiImplicitParams</span>(&#123;
        <span class="hljs-meta">@ApiImplicitParam</span>(name=<span class="hljs-string">"cmsPage"</span>,value = <span class="hljs-string">"请提交json形式的页面数据"</span>,required=<span class="hljs-keyword">true</span>,paramType=<span class="hljs-string">"CmsPage"</span>,dataType=<span class="hljs-string">"CmsPage"</span>),
&#125;)
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span></span>;</code></pre></div>

<h2 id="3-服务端开发"><a href="#3-服务端开发" class="headerlink" title="3. 服务端开发"></a>3. 服务端开发</h2><h3 id="1、页面唯一值索引"><a href="#1、页面唯一值索引" class="headerlink" title="1、页面唯一值索引"></a>1、页面唯一值索引</h3><blockquote>
<p>为了保证站点的唯一性，所以我们要根据 sizeId、pageName、pageWebPath 这三个字段来决定站点的数据是否唯一。</p>
</blockquote>
<p>右键 <code>cms_page</code> 集合，选择 <code>Add Index</code> 添加一个索引</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image8" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image8.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>根据下图所示，点击 <code>Add Field</code> 按钮，选择 sizeId、pageName、pageWebPath 这三个字段，然后点击添加，选择第三步所示的 <code>Unique</code>，最后点击右边的 <code>Create Index</code> 创建索引。</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image9" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image9.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>创建成功后</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image10" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image10.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="2、Dao层"><a href="#2、Dao层" class="headerlink" title="2、Dao层"></a>2、Dao层</h3><p>1、添加根据页面名称、站点Id、页面webpath查询页面方法，此方法用于校验页面是否存在</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 根据站点id、站点名称、站点路径来查询站点信息</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> siteId</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageName</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> pageWebPath</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function">CmsPage <span class="hljs-title">findBySiteIdAndPageNameAndPageWebPath</span><span class="hljs-params">(String siteId, String pageName, String pageWebPath)</span></span>;</code></pre></div>

<p>2、使用 CmsPageRepository提供的save方法 。</p>
<h3 id="3、Service层"><a href="#3、Service层" class="headerlink" title="3、Service层"></a>3、Service层</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 添加页面数据</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span></span>&#123;
    <span class="hljs-comment">//验证数据唯一性：sizeId、pageName、pageWebPath</span>
    CmsPage cmsPage1 = cmsPageRepository.findBySiteIdAndPageNameAndPageWebPath(cmsPage.getSiteId(), cmsPage.getPageName(), cmsPage.getPageWebPath());
    <span class="hljs-keyword">if</span>(cmsPage1 == <span class="hljs-keyword">null</span>)&#123;
        <span class="hljs-comment">//站点id由mongoDB自动生成，防止前端传值</span>
        cmsPage.setPageId(<span class="hljs-keyword">null</span>);
        CmsPage save = cmsPageRepository.save(cmsPage);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS,save);
    &#125;
    <span class="hljs-comment">//添加失败</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL,cmsPage);
&#125;</code></pre></div>

<h3 id="4、Controller层"><a href="#4、Controller层" class="headerlink" title="4、Controller层"></a>4、Controller层</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>
<span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/add"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(@RequestBody CmsPage cmsPage)</span> </span>&#123;
    <span class="hljs-keyword">return</span> pageService.addCmsPage(cmsPage);
&#125;</code></pre></div>

<h3 id="5、接口测试"><a href="#5、接口测试" class="headerlink" title="5、接口测试"></a>5、接口测试</h3><p>我们在 <code>swagger</code> 自动生成的文档接口中进行测试</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image11" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image11.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>第一次添加，添加成功</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image12" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image12.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>第二次添加重复的内容，由于唯一性的效验，返回添加失败</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image13" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image13.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="4-前端开发"><a href="#4-前端开发" class="headerlink" title="4. 前端开发"></a>4. 前端开发</h2><h3 id="构建新增页面"><a href="#构建新增页面" class="headerlink" title="构建新增页面"></a>构建新增页面</h3><h4 id="1、页面创建"><a href="#1、页面创建" class="headerlink" title="1、页面创建"></a>1、页面创建</h4><p>使用Element-UI的form组件编写添加表单内容，页面效果如下：</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image14.png" srcset="/img/loading.gif" alt="img"></p>
<p><strong>1）创建页面</strong></p>
<p>创建page_add.vue页面</p>
<p><strong>2）配置路由</strong></p>
<p>在cms模块的路由文件中配置“添加页面”的路由：</p>
<div class="hljs"><pre><code class="hljs vue">&#123;path:&#39;&#x2F;cms&#x2F;page&#x2F;add&#39;,name:&#39;新增页面&#39;,component: page_add,hidden:true&#125;</code></pre></div>

<p>注意：由于 “添加页面” 不需要显示为一个菜单，这里 <code>hidden</code> 设置为 <code>true</code> 隐藏菜单。</p>
<p>测试，在浏览器地址栏输入<a href="http://localhost:11000/#/cms/page/add" target="_blank" rel="noopener">http://localhost:11000/#/cms/page/add</a></p>
<p><strong>3）“添加页面” 的按钮</strong></p>
<p>实际情况是用户进入页面查询列表，点击“新增页面”按钮进入新增页面窗口。</p>
<p>在查询按钮的旁边添加：</p>
<div class="hljs"><pre><code class="hljs vue">&lt;router‐link class&#x3D;&quot;mui‐tab‐item&quot; :to&#x3D;&quot;&#123;path:&#39;&#x2F;cms&#x2F;page&#x2F;add&#x2F;&#39;&#125;&quot;&gt;
	&lt;el‐button type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot;&gt;新增页面&lt;&#x2F;el‐button&gt;
&lt;&#x2F;router‐link&gt;</code></pre></div>

<blockquote>
<p>router-link是vue提供的路由功能，用于在页面生成路由链接，最终在html渲染后就是&lt;a标签。<br>to：目标路由地址</p>
</blockquote>
<p><strong>4）完善页面内容</strong></p>
<div class="hljs"><pre><code class="hljs vue">&lt;el-form :model&#x3D;&quot;pageForm&quot; label-width&#x3D;&quot;80px&quot;&gt;
  &lt;el-form-item label&#x3D;&quot;所属站点&quot; prop&#x3D;&quot;siteId&quot;&gt;
    &lt;el-select v-model&#x3D;&quot;pageForm.siteId&quot; placeholder&#x3D;&quot;请选择站点&quot;&gt;
      &lt;el-option
        v-for&#x3D;&quot;item in siteList&quot;
        :key&#x3D;&quot;item.siteId&quot;
        :label&#x3D;&quot;item.siteName&quot;
        :value&#x3D;&quot;item.siteId&quot;&gt;
      &lt;&#x2F;el-option&gt;
    &lt;&#x2F;el-select&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;选择模版&quot; prop&#x3D;&quot;templateId&quot;&gt;
    &lt;el-select v-model&#x3D;&quot;pageForm.templateId&quot; placeholder&#x3D;&quot;请选择&quot;&gt;
      &lt;el-option
        v-for&#x3D;&quot;item in templateList&quot;
        :key&#x3D;&quot;item.templateId&quot;
        :label&#x3D;&quot;item.templateName&quot;
        :value&#x3D;&quot;item.templateId&quot;&gt;
      &lt;&#x2F;el-option&gt;
    &lt;&#x2F;el-select&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;页面名称&quot; prop&#x3D;&quot;pageName&quot;&gt;
    &lt;el-input v-model&#x3D;&quot;pageForm.pageName&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;别名&quot; prop&#x3D;&quot;pageAliase&quot;&gt;
    &lt;el-input v-model&#x3D;&quot;pageForm.pageAliase&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;访问路径&quot; prop&#x3D;&quot;pageWebPath&quot;&gt;
    &lt;el-input v-model&#x3D;&quot;pageForm.pageWebPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;物理路径&quot; prop&#x3D;&quot;pagePhysicalPath&quot;&gt;
    &lt;el-input v-model&#x3D;&quot;pageForm.pagePhysicalPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;类型&quot;&gt;
    &lt;el-radio-group v-model&#x3D;&quot;pageForm.pageType&quot;&gt;
      &lt;el-radio label&#x3D;&quot;0&quot;&gt;静态&lt;&#x2F;el-radio&gt;
      &lt;el-radio label&#x3D;&quot;1&quot;&gt;动态&lt;&#x2F;el-radio&gt;
    &lt;&#x2F;el-radio-group&gt;
  &lt;&#x2F;el-form-item&gt;
  &lt;el-form-item label&#x3D;&quot;创建时间&quot;&gt;
    &lt;el-date-picker type&#x3D;&quot;datetime&quot; placeholder&#x3D;&quot;创建时间&quot; v-model&#x3D;&quot;pageForm.pageCreateTime&quot;&gt;
    &lt;&#x2F;el-date-picker&gt;
  &lt;&#x2F;el-form-item&gt;
&lt;&#x2F;el-form&gt;
&lt;div slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;
  &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;addSubmit&quot;&gt;提交&lt;&#x2F;el-button&gt;
&lt;&#x2F;div&gt;</code></pre></div>

<p>Form Attributes说明：</p>
<ul>
<li>model 表单数据对象</li>
<li>rules 表单验证规则</li>
</ul>
<p>Form-Item Attributes说明：</p>
<ul>
<li>prop 表单域 model 字段，在使用 validate、resetFields 方法的情况下，该属性是必填的</li>
<li>label 标签文本</li>
</ul>
<p>详情属性及事件参考 <a href="http://element.eleme.io/#/zh-CN/component/form" target="_blank" rel="noopener">http://element.eleme.io/#/zh-CN/component/form</a></p>
<p><strong>5）数据对象</strong></p>
<div class="hljs"><pre><code class="hljs js">  <span class="hljs-comment">//站点列表</span>
    siteList: [],
    <span class="hljs-comment">//模版列表</span>
    templateList: [],
    <span class="hljs-comment">//新增界面数据</span>
    pageForm: &#123;
      siteId: <span class="hljs-string">''</span>,
      templateId: <span class="hljs-string">''</span>,
      pageName: <span class="hljs-string">''</span>,
      pageAliase: <span class="hljs-string">''</span>,
      pageWebPath: <span class="hljs-string">''</span>,
      pageParameter: <span class="hljs-string">''</span>,
      pagePhysicalPath: <span class="hljs-string">''</span>,
      pageType: <span class="hljs-string">'0'</span>,  <span class="hljs-comment">//默认选中0</span>
      pageCreateTime: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()
    &#125;
  &#125;
&#125;,
methods: &#123;
  addSubmit() &#123;
    alert(<span class="hljs-string">"提交"</span>)
  &#125;,
&#125;</code></pre></div>

<p><strong>6）站点及模板数据</strong></p>
<p>定义请求api</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//获取所有站点信息</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> site_list = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>&#123;
  <span class="hljs-keyword">return</span> http.requestGet(apiUrl + <span class="hljs-string">"/cms/site/list"</span>)
&#125;


<span class="hljs-comment">//获取所有模板信息</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> template_list = <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>&#123;
  <span class="hljs-keyword">return</span> http.requestGet(apiUrl + <span class="hljs-string">"/cms/template/list"</span>)
&#125;</code></pre></div>

<blockquote>
<p>在created钩子中定义，原讲义内使用的是静态数据</p>
</blockquote>
<div class="hljs"><pre><code class="hljs js">created: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;
    <span class="hljs-comment">//初始化站点数据</span>
    cmsApi.site_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (res.success) &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"站点数据"</span>,res)
            <span class="hljs-comment">//赋值给站点信息列表</span>
            <span class="hljs-keyword">this</span>.siteList = res.queryResult.list
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"获取站点信息时发生了错误"</span>, res)
        &#125;
    &#125;)

    <span class="hljs-comment">//初始化模板数据</span>
    cmsApi.template_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (res.success) &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"模板数据"</span>,res)
            <span class="hljs-comment">//赋值给模板列表</span>
            <span class="hljs-keyword">this</span>.templateList = res.queryResult.list
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"获取模板信息时发生了错误"</span>, res)
        &#125;
    &#125;)
&#125;,</code></pre></div>

<p><strong>7）测试预览</strong></p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image15" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image15.png" srcset="/img/loading.gif" alt="img"></a></p>
<h4 id="2、添加返回"><a href="#2、添加返回" class="headerlink" title="2、添加返回"></a>2、添加返回</h4><blockquote>
<p>进入新增页面后只能通过菜单再次进入页面列表，可以在新增页面添加“返回”按钮，点击返回按钮返回到页面列表。</p>
</blockquote>
<ol>
<li>新增页面按钮带上参数</li>
</ol>
<div class="hljs"><pre><code class="hljs vue">&lt;router-link class&#x3D;&quot;mui-tab-item&quot;
             :to&#x3D;&quot;&#123;path:&#39;&#x2F;cms&#x2F;page&#x2F;add&#x2F;&#39;, query:&#123; page:this.params.page,siteId:this.params.siteId &#125;&#125;&quot;&gt;
  &lt;el-button type&#x3D;&quot;primary&quot; size&#x3D;&quot;small&quot;&gt;新增页面&lt;&#x2F;el-button&gt;
&lt;&#x2F;router-link&gt;</code></pre></div>

<p>说明：query表示在路由url上带上参数</p>
<p>2）定义返回方法</p>
<p>在page_add.vue上定义返回按钮</p>
<div class="hljs"><pre><code class="hljs vue">&lt;el‐button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;go_back&quot; &gt;返回&lt;&#x2F;el‐button&gt;</code></pre></div>

<p>在page_add.vue上定义返回方法</p>
<div class="hljs"><pre><code class="hljs js">go_back()&#123;
    <span class="hljs-keyword">this</span>.$router.push(&#123;
        path: <span class="hljs-string">'/cms/page/list'</span>, <span class="hljs-attr">query</span>: &#123;
        page: <span class="hljs-keyword">this</span>.$route.query.page,
        siteId:<span class="hljs-keyword">this</span>.$route.query.siteId
    &#125;
    &#125;)
&#125;</code></pre></div>

<p>说明：this.$route.query 表示取出路由上的参数列表，有两个取路由参数的方法：</p>
<blockquote>
<p>a、通过在路由上添加 key/value 串使用 <code>this.$route.query</code> 来取参数，例如：<code>/router1?id=123</code> , <code>/router1?id=456</code> 可以通过 <code>this.$route.query.id</code> 获取参数id的值。</p>
<p>b、通过将参数作为路由一部分进行传参数使用 <code>this.$route.params</code> 来获取，例如：定义的路由为 <code>/router1/:id</code> ，请求 <code>/router1/123</code> 时可以通过 <code>this.$route.params.id</code> 来获取，此种情况用 <code>this.$route.query.id</code> 是拿不到的。</p>
</blockquote>
<p>3）查询列表支持回显</p>
<p>进入查询列表，从url中获取页码和站点id并赋值给数据模型对象，从而实现页面回显。</p>
<p>url例子：<a href="http://localhost:12000/#/cms/page/list?page=2&amp;siteId=5a751fab6abb5044e0d19ea1" target="_blank" rel="noopener">http://localhost:12000/#/cms/page/list?page=2&amp;siteId=5a751fab6abb5044e0d19ea1</a></p>
<div class="hljs"><pre><code class="hljs js">created() &#123;
    <span class="hljs-comment">//从路由上获取参数</span>
    <span class="hljs-keyword">this</span>.params.page = <span class="hljs-built_in">Number</span>.parseInt(<span class="hljs-keyword">this</span>.$route.query.page||<span class="hljs-number">1</span>);
    <span class="hljs-keyword">this</span>.params.siteId = <span class="hljs-keyword">this</span>.$route.query.siteId||<span class="hljs-string">''</span>;
    .....
&#125;</code></pre></div>

<blockquote>
<p>小技巧：使用 ||返回第一个有效值</p>
</blockquote>
<h4 id="1-3、表单验证"><a href="#1-3、表单验证" class="headerlink" title="1.3、表单验证"></a>1.3、表单验证</h4><p>1）配置校验规则</p>
<p>Element-UI的Form组件提供表单校验的方法：</p>
<p>在form属性上配置rules（表单验证规则）</p>
<div class="hljs"><pre><code class="hljs vue">&lt;el‐form :model&#x3D;&quot;pageForm&quot; :rules&#x3D;&quot;pageFormRules&quot; label‐width&#x3D;&quot;80px&quot; &gt;</code></pre></div>

<p>在数据模型中配置校验规则：</p>
<div class="hljs"><pre><code class="hljs js">data() &#123;
    <span class="hljs-keyword">return</span> &#123;
        pageFormRules: &#123;
            siteId:[
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请选择站点'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ],
            templateId:[
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请选择模版'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ],
            pageName: [
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入页面名称'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ],
            pageAliase: [
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入页面别名'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ],
            pageWebPath: [
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入访问路径'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ],
            pagePhysicalPath: [
                &#123;<span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'请输入物理路径'</span>, <span class="hljs-attr">trigger</span>: <span class="hljs-string">'blur'</span>&#125;
            ]
        &#125;,
    &#125;
&#125;</code></pre></div>

<p>更多的校验规则参考 <a href="http://element.eleme.io/#/zh-CN/component/form" target="_blank" rel="noopener">http://element.eleme.io/#/zh-CN/component/form</a> 中“表单验证”的例子</p>
<p>2）点击提交按钮触发校验</p>
<p>在form表单上添加 ref属性（ref=”pageForm”）在校验时引用此表单对象</p>
<div class="hljs"><pre><code class="hljs vue">&lt;el‐form :model&#x3D;&quot;pageForm&quot; :rules&#x3D;&quot;pageFormRules&quot; label‐width&#x3D;&quot;80px&quot; ref&#x3D;&quot;pageForm&quot;&gt;</code></pre></div>

<p>在提交表单时执行校验</p>
<div class="hljs"><pre><code class="hljs js">addSubmit() &#123;
    <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (valid) &#123;
            alert(<span class="hljs-string">'提交'</span>);
        &#125; <span class="hljs-keyword">else</span> &#123;
            alert(<span class="hljs-string">'校验失败'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        &#125;
    &#125;)
&#125;,</code></pre></div>

<p>测试</p>
<p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image16.png" srcset="/img/loading.gif" alt="img"></p>
<h3 id="API调用-1"><a href="#API调用-1" class="headerlink" title="API调用"></a>API调用</h3><h4 id="1、在cms-js中定义page-add方法"><a href="#1、在cms-js中定义page-add方法" class="headerlink" title="1、在cms.js中定义page_add方法"></a>1、在cms.js中定义page_add方法</h4><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_add = <span class="hljs-function"><span class="hljs-params">params</span> =&gt;</span>&#123;
  <span class="hljs-keyword">return</span> http.requestPost(apiUrl + <span class="hljs-string">"/cms/page/add"</span>,params)
&#125;</code></pre></div>

<h4 id="2、添加事件"><a href="#2、添加事件" class="headerlink" title="2、添加事件"></a>2、添加事件</h4><p>完整的代码如下：</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//提交表单</span>
addSubmit()&#123;
  <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (valid) &#123;
      <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'确认提交吗？'</span>, <span class="hljs-string">'提示'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
        cmsApi.page_add(<span class="hljs-keyword">this</span>.pageForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
          <span class="hljs-built_in">console</span>.log(res);
          <span class="hljs-keyword">if</span>(res.success)&#123;
            <span class="hljs-keyword">this</span>.$message(&#123;
              message: <span class="hljs-string">'提交成功'</span>,
              type: <span class="hljs-string">'success'</span>
          &#125;);
          <span class="hljs-keyword">this</span>.$refs[<span class="hljs-string">'pageForm'</span>].resetFields();
          &#125;<span class="hljs-keyword">else</span>&#123;
            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'提交失败'</span>);
          &#125;
        &#125;);
      &#125;);
    &#125;
  &#125;)
&#125;,</code></pre></div>

<p>本功能使用到两个UI组件：</p>
<ul>
<li>使用 <code>element-ui</code> 的 <code>message-box</code> 组件弹出确认提交窗口（<a href="http://element.eleme.io/#/zhCN/component/message-box%EF%BC%89" target="_blank" rel="noopener">http://element.eleme.io/#/zhCN/component/message-box）</a></li>
<li>使用 <code>message</code>组件提示操作结果 （<a href="http://element.eleme.io/#/zh-CN/component/message%EF%BC%89" target="_blank" rel="noopener">http://element.eleme.io/#/zh-CN/component/message）</a></li>
</ul>
<h4 id="3、测试"><a href="#3、测试" class="headerlink" title="3、测试"></a>3、测试</h4><p><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image17.gif" srcset="/img/loading.gif" alt="img"></p>
<h1 id="三、修改页面"><a href="#三、修改页面" class="headerlink" title="三、修改页面"></a>三、修改页面</h1><p>修改页面用户操作流程：</p>
<p>1、用户进入修改页面，在页面上显示了修改页面的信息</p>
<p>2、用户修改页面的内容，点击“提交”，提示“修改成功”或“修改失败”</p>
<h2 id="1-后端接口定义"><a href="#1-后端接口定义" class="headerlink" title="1. 后端接口定义"></a>1. 后端接口定义</h2><p>修改页面需要定义的API如下：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//根据页面id查询页面信息</span>
    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"根据页面id查询页面信息"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPage <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span></span>;

    <span class="hljs-comment">//修改页面</span>
    <span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"修改页面"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">edit</span><span class="hljs-params">(String id,CmsPage cmsPage)</span></span>;</code></pre></div>

<blockquote>
<p>我们从前面定义的 findList 用的是 <code>QueryResponseResult</code> 作为响应模型，但是这里我们定义的 <code>CmsPageResult</code> 作为响应模型，两者的区别是什么？</p>
<p>我个人的理解是，<code>findList</code> 是分页查询并且返回了多个对象的信息，而 <code>findById</code> 则是查询单个对象的信息，所以 <code>CmsPageResult</code> 作为操作或查询单个对象时的响应模型，而 <code>QueryResponseResult</code> 则作为操作多个对象时的响应模型。</p>
</blockquote>
<p>说明：提交数据使用post、put都可以，只是根据http方法的规范，put方法是对服务器指定资源进行修改，所以这里使用put方法对页面修改进行修改。</p>
<h2 id="2-服务端开发"><a href="#2-服务端开发" class="headerlink" title="2. 服务端开发"></a>2. 服务端开发</h2><h3 id="Dao层-2"><a href="#Dao层-2" class="headerlink" title="Dao层"></a>Dao层</h3><p>使用 Spring Data提供的findById方法完成根据主键查询 。<br>使用 Spring Data提供的save方法完成数据保存 。</p>
<h3 id="Service层-2"><a href="#Service层-2" class="headerlink" title="Service层"></a>Service层</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//根据页面id查询页面</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPage <span class="hljs-title">findById</span><span class="hljs-params">(String id)</span> </span>&#123;
        Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(id);
        <span class="hljs-keyword">if</span> (optional.isPresent())&#123;
            CmsPage cmsPage = optional.get();
            <span class="hljs-keyword">return</span> cmsPage;
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    &#125;

    <span class="hljs-comment">//修改页面</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">edit</span><span class="hljs-params">(String id, CmsPage cmsPage)</span> </span>&#123;
        <span class="hljs-comment">//根据id从数据查询页面信息</span>
        CmsPage updateCmsPage = <span class="hljs-keyword">this</span>.findById(id);
        <span class="hljs-keyword">if</span> (updateCmsPage != <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-comment">//设置要修改的数据</span>

            updateCmsPage.setTemplateId(cmsPage.getTemplateId());
            updateCmsPage.setSiteId(cmsPage.getSiteId());
            updateCmsPage.setPageAliase(cmsPage.getPageAliase());
            updateCmsPage.setPageName(cmsPage.getPageName());
            updateCmsPage.setPageWebPath(cmsPage.getPageWebPath());
            updateCmsPage.setPagePhysicalPath(cmsPage.getPagePhysicalPath());
            <span class="hljs-comment">//提交修改</span>
            cmsPageRepository.save(updateCmsPage);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS,updateCmsPage);
        &#125;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);
    &#125;</code></pre></div>

<h3 id="Controller层-1"><a href="#Controller层-1" class="headerlink" title="Controller层"></a>Controller层</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@GetMapping</span>(<span class="hljs-string">"/get/&#123;id&#125;"</span>)
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPage <span class="hljs-title">findById</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id) </span>&#123;
        <span class="hljs-keyword">return</span> pageService.findById(id);
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-meta">@PutMapping</span>(<span class="hljs-string">"/edit/&#123;id&#125;"</span>)<span class="hljs-comment">//put表示更新</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">edit</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id,@RequestBody CmsPage cmsPage) </span>&#123;
        <span class="hljs-keyword">return</span> pageService.edit(id,cmsPage);
    &#125;</code></pre></div>

<h2 id="3-修改：前端开发"><a href="#3-修改：前端开发" class="headerlink" title="3. 修改：前端开发"></a>3. 修改：前端开发</h2><h3 id="页面处理流程"><a href="#页面处理流程" class="headerlink" title="页面处理流程"></a>页面处理流程</h3><blockquote>
<p>可以参考新增的逻辑</p>
</blockquote>
<ol>
<li>进入页面，通过钩子方法请求服务端获取页面信息，并赋值给数据模型对象。</li>
<li>页面信息通过数据绑定在表单中显示。</li>
<li>用户修改信息点击 “提交” 请求服务端修改页面信息接口。</li>
</ol>
<h3 id="前端HTTP-API构建"><a href="#前端HTTP-API构建" class="headerlink" title="前端HTTP API构建"></a>前端HTTP API构建</h3><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//查询单个页面信息</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_query = <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span>&#123;
  <span class="hljs-keyword">return</span> http.requestPut(apiUrl + <span class="hljs-string">"/cms/page/get/"</span> + id)
&#125;

<span class="hljs-comment">//更新接口</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> page_update = <span class="hljs-function">(<span class="hljs-params">id,params</span>) =&gt;</span>&#123;
  <span class="hljs-keyword">return</span> http.requestPut(apiUrl + <span class="hljs-string">"/cms/page/edit/"</span> + id,params)
&#125;

<span class="hljs-comment">//获取站点和模板列表</span></code></pre></div>

<h3 id="添加页面路由"><a href="#添加页面路由" class="headerlink" title="添加页面路由"></a>添加页面路由</h3><div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">import</span> page_update <span class="hljs-keyword">from</span> <span class="hljs-string">'@/module/cms/page/page_update.vue'</span>;
<span class="hljs-comment">//子菜单</span>
children: [
    &#123;
        path: <span class="hljs-string">'/cms/page/edit/:pageId'</span>, <span class="hljs-attr">name</span>:<span class="hljs-string">"编辑页面信息"</span>,<span class="hljs-attr">component</span>: page_edit, 	<span class="hljs-attr">hidden</span>:<span class="hljs-literal">true</span>
    &#125;,
]</code></pre></div>

<p>path中的 <code>:pageId</code> 表示在路由url中定义了一个pageId变量</p>
<h3 id="构建前端页面"><a href="#构建前端页面" class="headerlink" title="构建前端页面"></a>构建前端页面</h3><p>在 <code>page_list</code> 页面新增编辑按钮</p>
<div class="hljs"><pre><code class="hljs vue">&lt;el-table-column label&#x3D;&quot;编辑&quot; width&#x3D;&quot;75&quot; fixed&#x3D;&quot;right&quot;&gt;
    &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
&lt;el-button size&#x3D;&quot;small&quot; type&#x3D;&quot;info&quot; @click&#x3D;&quot;toEdit(scope.row.pageId)&quot;&gt;编辑&lt;&#x2F;el-button&gt;
    &lt;&#x2F;template&gt;
&lt;&#x2F;el-table-column&gt;</code></pre></div>

<p>增加跳转edit页面的函数</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//跳转至编辑页面</span>
toEdit(pageId)&#123;
  <span class="hljs-keyword">this</span>.$router.push(&#123;
    path:<span class="hljs-string">"/cms/page/edit/"</span> + pageId,
    query:&#123;
      page:<span class="hljs-keyword">this</span>.params.page,
      siteId:<span class="hljs-keyword">this</span>.params.siteId
    &#125;
  &#125;)
&#125;,</code></pre></div>

<p>使用 <code>scope</code> 获取当前行数据中的 <code>pageId</code> 传入 toEdit 函数进行页面跳转</p>
<p>完成<code>page_edit.vue</code> 页面的基本构造</p>
<div class="hljs"><pre><code class="hljs vue">&lt;template&gt;
  &lt;div&gt;
    &lt;el-form :model&#x3D;&quot;pageForm&quot; label-width&#x3D;&quot;80px&quot; :rules&#x3D;&quot;pageFormRules&quot; ref&#x3D;&quot;pageForm&quot;&gt;
      &lt;el-form-item label&#x3D;&quot;所属站点&quot; prop&#x3D;&quot;siteId&quot;&gt;
        &lt;el-select v-model&#x3D;&quot;pageForm.siteId&quot; placeholder&#x3D;&quot;请选择站点&quot;&gt;
          &lt;el-option
            v-for&#x3D;&quot;item in siteList&quot;
            :key&#x3D;&quot;item.siteId&quot;
            :label&#x3D;&quot;item.siteName&quot;
            :value&#x3D;&quot;item.siteId&quot;&gt;
          &lt;&#x2F;el-option&gt;
        &lt;&#x2F;el-select&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;选择模版&quot; prop&#x3D;&quot;templateId&quot;&gt;
        &lt;el-select v-model&#x3D;&quot;pageForm.templateId&quot; placeholder&#x3D;&quot;请选择&quot;&gt;
          &lt;el-option
            v-for&#x3D;&quot;item in templateList&quot;
            :key&#x3D;&quot;item.templateId&quot;
            :label&#x3D;&quot;item.templateName&quot;
            :value&#x3D;&quot;item.templateId&quot;&gt;
          &lt;&#x2F;el-option&gt;
        &lt;&#x2F;el-select&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;页面名称&quot; prop&#x3D;&quot;pageName&quot;&gt;
        &lt;el-input v-model&#x3D;&quot;pageForm.pageName&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;别名&quot; prop&#x3D;&quot;pageAliase&quot;&gt;
        &lt;el-input v-model&#x3D;&quot;pageForm.pageAliase&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;访问路径&quot; prop&#x3D;&quot;pageWebPath&quot;&gt;
        &lt;el-input v-model&#x3D;&quot;pageForm.pageWebPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;物理路径&quot; prop&#x3D;&quot;pagePhysicalPath&quot;&gt;
        &lt;el-input v-model&#x3D;&quot;pageForm.pagePhysicalPath&quot; auto-complete&#x3D;&quot;off&quot;&gt;&lt;&#x2F;el-input&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;类型&quot;&gt;
        &lt;el-radio-group v-model&#x3D;&quot;pageForm.pageType&quot;&gt;
          &lt;el-radio class&#x3D;&quot;radio&quot; label&#x3D;&quot;0&quot; &gt;静态&lt;&#x2F;el-radio&gt;
          &lt;el-radio class&#x3D;&quot;radio&quot; label&#x3D;&quot;1&quot; &gt;动态&lt;&#x2F;el-radio&gt;
        &lt;&#x2F;el-radio-group&gt;
      &lt;&#x2F;el-form-item&gt;
      &lt;el-form-item label&#x3D;&quot;创建时间&quot;&gt;
        &lt;el-date-picker type&#x3D;&quot;datetime&quot; placeholder&#x3D;&quot;创建时间&quot; v-model&#x3D;&quot;pageForm.pageCreateTime&quot;&gt;
        &lt;&#x2F;el-date-picker&gt;
      &lt;&#x2F;el-form-item&gt;
    &lt;&#x2F;el-form&gt;
    &lt;div slot&#x3D;&quot;footer&quot; class&#x3D;&quot;dialog-footer&quot;&gt;
      &lt;el-button type&#x3D;&quot;primary&quot; @click&#x3D;&quot;addSubmit&quot;&gt;提交&lt;&#x2F;el-button&gt;
      &lt;el-button type&#x3D;&quot;info&quot; @click&#x3D;&quot;goBack&quot;&gt;返回&lt;&#x2F;el-button&gt;
    &lt;&#x2F;div&gt;
  &lt;&#x2F;div&gt;
&lt;&#x2F;template&gt;
&lt;script&gt;
  import * as cmsApi from &#39;..&#x2F;api&#x2F;cms&#39;

  export default &#123;
    created: function () &#123;

    &#125;,
    mounted() &#123;

    &#125;,

    data() &#123;
      return &#123;
        pageFormRules: &#123;
          siteId: [
            &#123;required: true, message: &#39;请选择站点&#39;, trigger: &#39;blur&#39;&#125;
          ],
          templateId: [
            &#123;required: true, message: &#39;请选择模版&#39;, trigger: &#39;blur&#39;&#125;
          ],
          pageName: [
            &#123;required: true, message: &#39;请输入页面名称&#39;, trigger: &#39;blur&#39;&#125;
          ],
          pageAliase: [
            &#123;required: true, message: &#39;请输入页面别名&#39;, trigger: &#39;blur&#39;&#125;
          ],
          pageWebPath: [
            &#123;required: true, message: &#39;请输入访问路径&#39;, trigger: &#39;blur&#39;&#125;
          ],
          pagePhysicalPath: [
            &#123;required: true, message: &#39;请输入物理路径&#39;, trigger: &#39;blur&#39;&#125;
          ]
        &#125;,
        &#x2F;&#x2F;站点列表
        siteList: [],
        &#x2F;&#x2F;模版列表
        templateList: [],
        &#x2F;&#x2F;新增界面数据
        pageForm: &#123;
          siteId: &#39;&#39;,
          templateId: &#39;&#39;,
          pageName: &#39;&#39;,
          pageAliase: &#39;&#39;,
          pageWebPath: &#39;&#39;,
          pageParameter: &#39;&#39;,
          pagePhysicalPath: &#39;&#39;,
          pageType: &#39;&#39;,
          pageCreateTime: new Date()
        &#125;
      &#125;
    &#125;,
    methods: &#123;
      &#x2F;&#x2F;返回上一页
      goBack() &#123;
        this.$router.push(&#123;
          path: &quot;&#x2F;cms&#x2F;page&#x2F;list&quot;,
          query: &#123;
            page: this.$route.query.page,
            siteId: this.$route.query.siteId
          &#125;
        &#125;)
      &#125;
    &#125;
  &#125;
&lt;&#x2F;script&gt;</code></pre></div>

<h4 id="1、页面初始化"><a href="#1、页面初始化" class="headerlink" title="1、页面初始化"></a>1、页面初始化</h4><p>在钩子函数 <code>created</code> 中进行一些数据的初始化请求，例如站点、模板的信息，用于下拉框的选择，以及在打开编辑页面之前，用户需要获取当前编辑的页面原有的数据，所以我们需要使用 <code>page_list</code> 页面通过的 <code>pageId</code> 来获取当前编辑的页面的数据。</p>
<div class="hljs"><pre><code class="hljs js">created: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123; 
    <span class="hljs-comment">//初始化站点数据</span>
    cmsApi.site_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (res.success) &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"站点数据"</span>, res)
            <span class="hljs-keyword">this</span>.siteList = res.queryResult.list
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"获取站点信息时发生了错误"</span>, res)
        &#125;
    &#125;)

    <span class="hljs-comment">//初始化模板数据</span>
    cmsApi.template_list().then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (res.success) &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"模板数据"</span>, res)
            <span class="hljs-keyword">this</span>.templateList = res.queryResult.list
        &#125; <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"获取模板信息时发生了错误"</span>, res)
        &#125;
    &#125;)

    <span class="hljs-comment">//初始化页面的数据</span>
    cmsApi.page_query(<span class="hljs-keyword">this</span>.$route.params.pageId).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span>&#123;

        <span class="hljs-keyword">if</span>(res.success)&#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"初始化页面数据"</span>,res.cmsPage)
            <span class="hljs-keyword">this</span>.pageForm = res.cmsPage
        &#125;<span class="hljs-keyword">else</span>&#123;
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"初始化页面数据失败"</span>,res)
        &#125;
    &#125;)
&#125;,</code></pre></div>

<p>我们在页面路由定义了一个:pageId的参数，所以在初始化页面的数据部分从 <code>this.$route.params</code> 取出了<code>pageId</code></p>
<h4 id="2、提交更新表单"><a href="#2、提交更新表单" class="headerlink" title="2、提交更新表单"></a>2、提交更新表单</h4><div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//提交表单</span>
addSubmit() &#123;
    <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;
        <span class="hljs-keyword">if</span> (valid) &#123;
            <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'确认提交修改吗？'</span>, <span class="hljs-string">'提示'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
                cmsApi.page_edit(<span class="hljs-keyword">this</span>.$route.params.pageId,<span class="hljs-keyword">this</span>.pageForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
                    <span class="hljs-keyword">if</span> (res.success) &#123;
                        <span class="hljs-keyword">this</span>.$message(&#123;
                            message: <span class="hljs-string">'修改提交成功'</span>,
                            type: <span class="hljs-string">'success'</span>
                        &#125;);
                    &#125; <span class="hljs-keyword">else</span> &#123;
                        <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'提交失败'</span>);
                    &#125;
                &#125;);
            &#125;);
        &#125;
    &#125;)
&#125;,</code></pre></div>

<h1 id="四、删除页面"><a href="#四、删除页面" class="headerlink" title="四、删除页面"></a>四、删除页面</h1><p>修改页面用户操作流程：</p>
<p>1、用户进入修改页面，在页面上显示了修改页面的信息</p>
<p>2、用户修改页面的内容，点击“提交”，提示“修改成功”或“修改失败”</p>
<h2 id="1-后端接口定义-1"><a href="#1-后端接口定义-1" class="headerlink" title="1. 后端接口定义"></a>1. 后端接口定义</h2><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 删除接口</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id 页面id</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"删除页面"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">delete</span><span class="hljs-params">(String id)</span></span>;</code></pre></div>

<h2 id="2-服务端开发-1"><a href="#2-服务端开发-1" class="headerlink" title="2. 服务端开发"></a>2. 服务端开发</h2><h3 id="Dao层-3"><a href="#Dao层-3" class="headerlink" title="Dao层"></a>Dao层</h3><p><code>dao</code>层 使用 <code>MongoDB</code> 提供的dao接口来实现</p>
<h3 id="Service层-3"><a href="#Service层-3" class="headerlink" title="Service层"></a>Service层</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 根据id删除</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">deleteCmsPage</span><span class="hljs-params">(String id)</span></span>&#123;
    <span class="hljs-comment">//检索该页面id是否存在</span>
    Optional&lt;CmsPage&gt; optional = cmsPageRepository.findById(id);
    <span class="hljs-keyword">if</span>(optional.isPresent())&#123;
        <span class="hljs-comment">//删除并返回结果</span>
        cmsPageRepository.deleteById(id);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SUCCESS);
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.FAIL);
&#125;</code></pre></div>

<h3 id="Controller层-2"><a href="#Controller层-2" class="headerlink" title="Controller层"></a>Controller层</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 删除页面</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> id 页面id</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@DeleteMapping</span>(<span class="hljs-string">"/delete/&#123;id&#125;"</span>)
<span class="hljs-meta">@Override</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> ResponseResult <span class="hljs-title">delete</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String id) </span>&#123;
    <span class="hljs-keyword">return</span> pageService.deleteCmsPage(id);
&#125;</code></pre></div>

<h3 id="接口测试"><a href="#接口测试" class="headerlink" title="接口测试"></a>接口测试</h3><p><a href="https://qnoss.codeyee.com/20200704_3/image18" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image18.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-前端开发"><a href="#3-前端开发" class="headerlink" title="3.前端开发"></a>3.前端开发</h2><h3 id="页面编写"><a href="#页面编写" class="headerlink" title="页面编写"></a>页面编写</h3><p>1、在 <code>page_list</code> 页面内新增一个删除按钮</p>
<div class="hljs"><pre><code class="hljs vue">&lt;el-table-column label&#x3D;&quot;删除&quot; width&#x3D;&quot;75&quot; fixed&#x3D;&quot;right&quot;&gt;
  &lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
    &lt;el-button
      size&#x3D;&quot;mini&quot;
      type&#x3D;&quot;danger&quot;
      @click&#x3D;&quot;deletePage(scope.row.pageId)&quot;&gt;删除
    &lt;&#x2F;el-button&gt;
  &lt;&#x2F;template&gt;
&lt;&#x2F;el-table-column&gt;</code></pre></div>

<p>2、在 <code>cms.js</code> 定义删除的api</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//删除接口</span>
export <span class="hljs-keyword">const</span> page_delete = (id) =&gt;&#123;
  <span class="hljs-keyword">return</span> http.requestDelete(apiUrl + <span class="hljs-string">"/cms/page/delete/"</span> + id)
&#125;</code></pre></div>

<p>3、创建 <code>deletePage</code> 函数，接收到 当前行的 <code>pageId</code></p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//删除页面</span>
deletePage(pageId) &#123;
  <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">"此操作将永久的删除该页面"</span>, <span class="hljs-string">"提示"</span>, &#123;
    confirmButtonText: <span class="hljs-string">'确定'</span>,
    cancelButtonText: <span class="hljs-string">'取消'</span>,
    type: <span class="hljs-string">'warning'</span>
  &#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    cmsApi.page_delete(pageId).then(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;
      <span class="hljs-keyword">if</span> (res.success) &#123;
        <span class="hljs-keyword">this</span>.$message(&#123;
          type: <span class="hljs-string">'success'</span>,
          message: <span class="hljs-string">'删除成功!'</span>
        &#125;)
        <span class="hljs-keyword">this</span>.query()
      &#125; <span class="hljs-keyword">else</span> &#123;
        <span class="hljs-keyword">this</span>.$message(&#123;
          type: <span class="hljs-string">'warning'</span>,
          message: <span class="hljs-string">'删除失败'</span>
        &#125;);
      &#125;
    &#125;)
  &#125;).catch(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
    <span class="hljs-keyword">this</span>.$message(&#123;
      type: <span class="hljs-string">'info'</span>,
      message: <span class="hljs-string">'已取消删除'</span>
    &#125;);
  &#125;);
&#125;,</code></pre></div>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><a href="https://qnoss.codeyee.com/20200704_3/image19" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image19.gif" srcset="/img/loading.gif" alt="img"></a></p>
<h1 id="五、异常处理"><a href="#五、异常处理" class="headerlink" title="五、异常处理"></a>五、异常处理</h1><h2 id="1-异常处理的问题分析"><a href="#1-异常处理的问题分析" class="headerlink" title="1. 异常处理的问题分析"></a>1. 异常处理的问题分析</h2><p>从添加页面的service方法中找问题：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">* 添加页面数据</span>
<span class="hljs-comment">*/</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;
    <span class="hljs-comment">//验证数据唯一性：sizeId、pageName、pageWebPath</span>
    CmsPage cmsPage1 = cmsPageRepository.findByPageNameAndSiteIdAndPageWebPath(cmsPage.getPageName(), cmsPage.getSiteId(), cmsPage.getPageWebPath());
    <span class="hljs-keyword">if</span> (cmsPage1 == <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-comment">//站点id由mongoDB自动生成，防止前端传值</span>
        cmsPage.setPageId(<span class="hljs-keyword">null</span>);
        CmsPage save = cmsPageRepository.save(cmsPage);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS, save);
    &#125;
    <span class="hljs-comment">//添加失败</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.FAIL, cmsPage);
&#125;</code></pre></div>

<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a><strong>问题</strong></h3><p>1、上边的代码只要操作不成功仅向用户返回“错误代码：11111，失败信息：操作失败”，无法区别具体的错误信息。</p>
<p>2、<code>service</code> 方法在执行过程出现异常在哪捕获？在 <code>service</code> 中需要都加 <code>try</code>/<code>catch</code>，如果在<code>controller</code> 也需要添加 try/catch，代码冗余严重且不易维护。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>1、在 <code>Service</code> 方法中的编码顺序是先校验判断，有问题则抛出具体的异常信息，最后执行具体的业务操作，返回成功信息。</p>
<p>2、在统一异常处理类中去捕获异常，无需<code>controller</code>捕获异常，向用户返回统一规范的响应信息。</p>
<p>我们的代码应该是这样的</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 添加页面数据</span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;
    <span class="hljs-comment">//效验cmsPage是否为空</span>
    <span class="hljs-keyword">if</span>(cmsPage == <span class="hljs-keyword">null</span>)&#123;
        <span class="hljs-comment">//抛出异常，非法参数</span>

    &#125;

    <span class="hljs-comment">//验证数据唯一性：sizeId、pageName、pageWebPath</span>
    CmsPage cmsPage1 = cmsPageRepository.findByPageNameAndSiteIdAndPageWebPath(cmsPage.getPageName(), cmsPage.getSiteId(), cmsPage.getPageWebPath());

    <span class="hljs-comment">//检验页面是否已存在</span>
    <span class="hljs-keyword">if</span> (cmsPage1 != <span class="hljs-keyword">null</span>) &#123;
        <span class="hljs-comment">//抛出异常</span>

    &#125;

    <span class="hljs-comment">//站点id由mongoDB自动生成，防止前端传值</span>
    cmsPage.setPageId(<span class="hljs-keyword">null</span>);
    CmsPage save = cmsPageRepository.save(cmsPage);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPageResult(CommonCode.SUCCESS, save);
    <span class="hljs-comment">//添加失败</span>
&#125;</code></pre></div>

<p>在执行正常的逻辑之前，要把已知的异常进行验证，验证全部通过后才会去执行正常的逻辑代码。</p>
<h2 id="2-异常处理流程"><a href="#2-异常处理流程" class="headerlink" title="2. 异常处理流程"></a>2. 异常处理流程</h2><p>系统对异常的处理使用统一的异常处理流程：</p>
<p>1、自定义异常类型。</p>
<p>2、自定义错误代码及错误信息。</p>
<p>3、对于可预知的异常由程序员在代码中主动抛出，由 <code>SpringMVC</code> 统一捕获。</p>
<p>可预知异常是程序员在代码中手动抛出本系统定义的特定异常类型，由于是程序员抛出的异常，通常异常信息比较齐全，程序员在抛出时会指定错误代码及错误信息，获取异常信息也比较方便。</p>
<p>4、对于不可预知的异常（运行时异常）由<code>SpringMVC</code>统一捕获 <code>Exception</code> 类型的异常。</p>
<p>不可预知异常通常是由于系统出现bug、或一些不要抗拒的错误（比如网络中断、服务器宕机等），异常类型为 <code>RuntimeException</code>类型（运行时异常）。</p>
<p>5、可预知的异常及不可预知的运行时异常最终会采用统一的信息格式（错误代码+错误信息）来表示，最终也会随请求响应给客户端。</p>
<p>异常抛出及处理流程：</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image20" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image20.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1、在 <code>controller</code>、<code>service</code>、<code>dao</code> 中程序员抛出自定义异常；<code>springMVC</code> 框架抛出框架异常类型</p>
<p>2、统一由异常捕获类捕获异常，并进行处理</p>
<p>3、捕获到自定义异常则直接取出错误代码及错误信息，响应给用户</p>
<p>4、捕获到非自定义异常类型首先从 <code>Map</code> 中找该异常类型是否对应具体的错误代码，如果有则取出错误代码和错误信息并响应给用户，如果从 <code>Map</code> 中找不到异常类型所对应的错误代码则统一为 <code>99999</code> 错误代码并响应给用户。</p>
<p>5、将错误代码及错误信息以 <code>Json</code> 格式响应给用户。</p>
<h2 id="3-可预知异常处理"><a href="#3-可预知异常处理" class="headerlink" title="3. 可预知异常处理"></a>3. 可预知异常处理</h2><h3 id="自定义异常类"><a href="#自定义异常类" class="headerlink" title="自定义异常类"></a>自定义异常类</h3><p>在common工程定义异常类型。</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;

<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>&#123;

    <span class="hljs-keyword">private</span> ResultCode resultCode;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CustomException</span><span class="hljs-params">(ResultCode resultCode)</span></span>&#123;
        <span class="hljs-comment">//异常信息为错误代码+异常信息</span>
        <span class="hljs-keyword">super</span>(<span class="hljs-string">"错误代码: "</span> + resultCode.code() + <span class="hljs-string">" 错误信息: "</span> + resultCode.message());
        <span class="hljs-keyword">this</span>.resultCode = resultCode;
    &#125;

    <span class="hljs-function"><span class="hljs-keyword">public</span> ResultCode <span class="hljs-title">getResultCode</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.resultCode;
    &#125;
&#125;</code></pre></div>

<p>上面的代码中我们自定义了一个名为 <code>CustomException</code> 的异常，并且继承了 <code>RuntimeException</code> 异常类，有的人可能会问，我们为什么不直接继承 <code>Exception</code> 类？因为如果继承了 <code>Exception</code> 类，我们在抛出异常时对代码会有一定的侵入性，例如我们需要在抛出该异常的方法前加入 <code>throws Exception</code> ，例如</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> CmsPageResult <span class="hljs-title">addCmsPage</span><span class="hljs-params">(CmsPage cmsPage)</span> <span class="hljs-keyword">throws</span> Exception</span>&#123;

&#125;</code></pre></div>

<p>或者使用</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;
    <span class="hljs-comment">//抛出异常，非法参数</span>
&#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;
    e.printStackTrace();
&#125;</code></pre></div>

<p>而我们如果使用 <code>RuntimeException</code> ,至需要在抛出异常的地方写入下面代码就能抛出我们自定义的异常</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomException(resultCode);</code></pre></div>

<h3 id="抛出异常类"><a href="#抛出异常类" class="headerlink" title="抛出异常类"></a>抛出异常类</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;

<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionCast</span> </span>&#123;

    <span class="hljs-comment">//使用此静态方法抛出自定义异常</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">cast</span><span class="hljs-params">(ResultCode resultCode)</span> </span>&#123;
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> CustomException(resultCode);
    &#125;
&#125;</code></pre></div>

<h3 id="异常捕获类"><a href="#异常捕获类" class="headerlink" title="异常捕获类"></a>异常捕获类</h3><p>使用 @ControllerAdvice和@ExceptionHandler注解来捕获指定类型的异常</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;

<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;

<span class="hljs-meta">@ControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionCatch</span> </span>&#123;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ExceptionCatch<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-comment">//捕获 CustomException 异常</span>
    <span class="hljs-meta">@ExceptionHandler</span>(CustomException<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">    @<span class="hljs-title">ResponseBody</span></span>
<span class="hljs-class">    <span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">customException</span>(<span class="hljs-title">CustomException</span> <span class="hljs-title">e</span>)</span>&#123;
        LOGGER.error(<span class="hljs-string">"catch exception：&#123;&#125;\r\nException："</span>,e.getMessage(),e);
        ResultCode resultCode = e.getResultCode();
        ResponseResult responseResult = <span class="hljs-keyword">new</span> ResponseResult(resultCode);
        <span class="hljs-keyword">return</span> responseResult;
    &#125;
&#125;</code></pre></div>

<h3 id="异常处理测试"><a href="#异常处理测试" class="headerlink" title="异常处理测试"></a>异常处理测试</h3><h4 id="1）定义错误代码"><a href="#1）定义错误代码" class="headerlink" title="1）定义错误代码"></a>1）定义错误代码</h4><p>每个业务操作的异常使用异常代码去标识。</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.model.response;
<span class="hljs-keyword">import</span> lombok.ToString;

<span class="hljs-meta">@ToString</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> CmsCode implements ResultCode &#123;

    CMS_ADDPAGE_EXISTS(<span class="hljs-keyword">false</span>,<span class="hljs-number">24001</span>,<span class="hljs-string">"页面已存在！"</span>);

    <span class="hljs-comment">//操作结果</span>
    <span class="hljs-keyword">boolean</span> success;

    <span class="hljs-comment">//操作代码</span>
    <span class="hljs-keyword">int</span> code;

    <span class="hljs-comment">//提示信息</span>
    String message;

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">CmsCode</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> success, <span class="hljs-keyword">int</span> code, String message)</span></span>&#123;
        <span class="hljs-keyword">this</span>.success = success;
        <span class="hljs-keyword">this</span>.code = code;
        <span class="hljs-keyword">this</span>.message = message;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">success</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> success;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">code</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> code;
    &#125;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">message</span><span class="hljs-params">()</span> </span>&#123;
        <span class="hljs-keyword">return</span> message;
    &#125;
&#125;</code></pre></div>

<h4 id="2）异常处理测试"><a href="#2）异常处理测试" class="headerlink" title="2）异常处理测试"></a>2）异常处理测试</h4><p>1、抛出异常</p>
<p>回到我们 <code>PageService</code> 中的 <code>addCmsPage</code> 抛出异常</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//检验页面是否已存在</span>
<span class="hljs-keyword">if</span> (cmsPage1 != <span class="hljs-keyword">null</span>) &#123;
    <span class="hljs-comment">//抛出异常</span>
    ExceptionCast.cast(CmsCode.CMS_ADDPAGE_EXISTS);
&#125;</code></pre></div>

<p>2、在启动工程中扫描异常捕获类</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ComponentScan</span>(basePackages = &#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)  <span class="hljs-comment">// 扫描framework下的异常捕获类</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ManageCmsApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;
        SpringApplication.run(ManageCmsApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">args</span>)</span>;
    &#125;
&#125;</code></pre></div>

<p>3、前端展示异常信息</p>
<p>在前端新增页面的表单提交中增加判断</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(res.message)&#123;
	<span class="hljs-keyword">this</span>.$message.error(res.message)
&#125;</code></pre></div>

<p>全部代码如下</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">//提交表单</span>
addSubmit() &#123;
  <span class="hljs-keyword">this</span>.$refs.pageForm.validate(<span class="hljs-function">(<span class="hljs-params">valid</span>) =&gt;</span> &#123;
    <span class="hljs-keyword">if</span> (valid) &#123;
      <span class="hljs-keyword">this</span>.$confirm(<span class="hljs-string">'确认提交吗？'</span>, <span class="hljs-string">'提示'</span>, &#123;&#125;).then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> &#123;
        cmsApi.page_add(<span class="hljs-keyword">this</span>.pageForm).then(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;
          <span class="hljs-built_in">console</span>.log(res);
          <span class="hljs-keyword">if</span> (res.success) &#123;
            <span class="hljs-keyword">this</span>.$message(&#123;
              message: <span class="hljs-string">'提交成功'</span>,
              type: <span class="hljs-string">'success'</span>
            &#125;);
            <span class="hljs-keyword">this</span>.$refs[<span class="hljs-string">'pageForm'</span>].resetFields();
          &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(res.message)&#123;
            <span class="hljs-keyword">this</span>.$message.error(res.message)
          &#125;
          <span class="hljs-keyword">else</span> &#123;
            <span class="hljs-keyword">this</span>.$message.error(<span class="hljs-string">'提交失败'</span>);
          &#125;
        &#125;);
      &#125;);
    &#125;
  &#125;)
&#125;,</code></pre></div>

<p>测试</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image21" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image21.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="4-不可预知的异常处理"><a href="#4-不可预知的异常处理" class="headerlink" title="4. 不可预知的异常处理"></a>4. 不可预知的异常处理</h2><h4 id="1）定义异常捕获方法"><a href="#1）定义异常捕获方法" class="headerlink" title="1）定义异常捕获方法"></a>1）定义异常捕获方法</h4><h5 id="抛出异常测试"><a href="#抛出异常测试" class="headerlink" title="抛出异常测试"></a>抛出异常测试</h5><p>使用postman测试添加页面，不输入cmsPost信息，提交，报错信息如下：</p>
<div class="hljs"><pre><code class="hljs json">org.springframework.http.converter.HttpMessageNotReadableException
此异常是springMVC在进行参数转换时报的错误。

&#123;
    <span class="hljs-attr">"timestamp"</span>: <span class="hljs-number">1528712906727</span>,
    <span class="hljs-attr">"status"</span>: <span class="hljs-number">400</span>,
    <span class="hljs-attr">"error"</span>: <span class="hljs-string">"Bad Request"</span>,
    <span class="hljs-attr">"exception"</span>: <span class="hljs-string">"org.springframework.http.converter.HttpMessageNotReadableException"</span>,
    <span class="hljs-attr">"message"</span>: <span class="hljs-string">"Required request body is missing: public</span>
<span class="hljs-string">    com.xuecheng.framework.domain.cms.response.CmsPageResult</span>
<span class="hljs-string">    com.xuecheng.manage_cms.web.controller.CmsPageController.add(com.xuecheng.framework.domain.cms.C</span>
<span class="hljs-string">    msPage)"</span>,
    <span class="hljs-attr">"path"</span>: <span class="hljs-string">"/cms/page/add"</span>
&#125;</code></pre></div>

<p>上边的响应信息在客户端是无法解析的。</p>
<p>在异常捕获类 <code>ExceptionCatch</code> 中添加对Exception异常的捕获，下面大致的代码结构：</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ExceptionHandler</span>(Exception<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">@<span class="hljs-title">ResponseBody</span></span>
<span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">exception</span>(<span class="hljs-title">Exception</span> <span class="hljs-title">exception</span>)</span>&#123;
    <span class="hljs-comment">//记录日志</span>
    LOGGER.error(<span class="hljs-string">"catch exception:&#123;&#125;"</span>,exception.getMessage());
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
&#125;</code></pre></div>

<h5 id="异常捕获方法"><a href="#异常捕获方法" class="headerlink" title="异常捕获方法"></a>异常捕获方法</h5><p>针对上边的问题其解决方案是：</p>
<ol>
<li>我们在map中配置HttpMessageNotReadableException和错误代码。</li>
<li>在异常捕获类中对Exception异常进行捕获，并从map中获取异常类型对应的错误代码，如果存在错误代码则返回此错误，否则统一返回99999错误。</li>
</ol>
<p>具体的开发实现如下：</p>
<p>1、在通用错误代码类CommCode中配置非法参数异常</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ToString</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> CommonCode implements ResultCode&#123;
    INVALID_PARAM(<span class="hljs-keyword">false</span>,<span class="hljs-number">10003</span>,<span class="hljs-string">"非法参数！"</span>),

    <span class="hljs-comment">/**其他代码省略**/</span>
&#125;</code></pre></div>

<p>2、在异常捕获类中配置 HttpMessageNotReadableException 为非法参数异常。</p>
<p>具体的说明我都写在注释当中了，就不多做解释，直接看代码</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.framework.exception;

<span class="hljs-keyword">import</span> com.google.common.collect.ImmutableMap;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.CommonCode;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResponseResult;
<span class="hljs-keyword">import</span> com.xuecheng.framework.model.response.ResultCode;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.http.converter.HttpMessageNotReadableException;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * 统一异常捕获类</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Mr.JK</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@create</span> 2020-08-09  11:12</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@ControllerAdvice</span><span class="hljs-comment">//控制器增强</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExceptionCatch</span> </span>&#123;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(ExceptionCatch<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>;

    <span class="hljs-comment">//定义map，配置异常类型所对应的错误代码（ImmutableMap 只读，线程安全</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ImmutableMap&lt;Class&lt;? extends Throwable&gt;,ResultCode&gt; EXCEPTIONS;
    <span class="hljs-comment">//定义map的builder对象，去构建immutablemap</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> ImmutableMap.Builder&lt;Class&lt;? extends Throwable&gt;,ResultCode&gt; builder = ImmutableMap.builder();

    <span class="hljs-comment">//捕获CustomException类的异常</span>
    <span class="hljs-meta">@ExceptionHandler</span>(CustomException<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">    <span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">customException</span>(<span class="hljs-title">CustomException</span> <span class="hljs-title">customException</span>)</span>&#123;
        <span class="hljs-comment">//记录日志</span>
        LOGGER.error(<span class="hljs-string">"catch exception:&#123;&#125;"</span>,customException.getMessage());
        ResultCode resultCode = customException.getResultCode();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(resultCode);
    &#125;

    <span class="hljs-comment">//捕获Exception类的异常</span>
    <span class="hljs-meta">@ExceptionHandler</span>(Exception<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class">    @<span class="hljs-title">ResponseBody</span></span>
<span class="hljs-class">    <span class="hljs-title">public</span> <span class="hljs-title">ResponseResult</span> <span class="hljs-title">exception</span>(<span class="hljs-title">Exception</span> <span class="hljs-title">exception</span>)</span>&#123;
        <span class="hljs-comment">//记录日志</span>
        LOGGER.error(<span class="hljs-string">"catch exception:&#123;&#125;"</span>,exception.getMessage());
        <span class="hljs-keyword">if</span> (EXCEPTIONS == <span class="hljs-keyword">null</span>)&#123;
            EXCEPTIONS = builder.build();<span class="hljs-comment">//EXCEPTIONS构建成功</span>
        &#125;
        <span class="hljs-comment">//从EXCEPTIONS中找出异常类型所对应的错误代码，如果找到了将错误代码响应给用户</span>
        <span class="hljs-comment">// 如果找不到给用户响应99999异常</span>
        ResultCode resultCode = EXCEPTIONS.get(exception.getClass());
        <span class="hljs-keyword">if</span> (resultCode != <span class="hljs-keyword">null</span>)&#123;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(resultCode);
        &#125;<span class="hljs-keyword">else</span> &#123;
            <span class="hljs-comment">//如果非预定义的错误，则返回服务器错误</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ResponseResult(CommonCode.SERVER_ERROR);
        &#125;
    &#125;

    <span class="hljs-keyword">static</span> &#123;
        builder.put(HttpMessageNotReadableException<span class="hljs-class">.<span class="hljs-keyword">class</span>,<span class="hljs-title">CommonCode</span>.<span class="hljs-title">INVALID_PARAM</span>)</span>;
    &#125;

&#125;</code></pre></div>

<p>我们来测试一下，是否能成功捕抓到该异常</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image22" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image22.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>我们改成 GET 请求进行测试，由于我们没有预定这种异常的错误代码，所以统一返回99999错误代码</p>
<p><a href="https://qnoss.codeyee.com/20200704_3/image23" target="_blank" rel="noopener"><img src="/2020/08/09/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday03/image23.png" srcset="/img/loading.gif" alt="img"></a></p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">学成在线</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Spring-Data-MongoDB/">Spring Data MongoDB</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/10/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday04/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">学成在线day04：页面静态化</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/08/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday02/">
                        <span class="hidden-mobile">学成在线day02：CMS前端开发</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

代码块js 用不到，fulid自带有，添加css样式即可实现
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键字</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">载入天数...</span>
  <span id="times">载入时分秒...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//此处修改你的建站时间或者网站上线时间
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "本站勉强运行&nbsp"+dnum+"&nbsp天";
      document.getElementById("times").innerHTML = hnum + "&nbsp小时&nbsp" + mnum + "&nbsp分&nbsp" + snum + "&nbsp秒";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


    
  <!-- 备案信息 -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">京ICP证123456号</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>京公网安备12345678号</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "学成在线day03：CMS页面管理开发&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
