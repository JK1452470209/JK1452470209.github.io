<!DOCTYPE html>
<html lang="en">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.JK">
  <meta name="keywords" content="">
  <title>å­¦æˆåœ¨çº¿day10ï¼šè¯¾ç¨‹å‘å¸ƒã€ElasticSearch - Mr.JK</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/darcula.min.css" />
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_yg9cfy8wd6.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->

  
<link rel="stylesheet" href="/css/custom.css">



  <script  src="/js/utils.js" ></script>
<meta name="generator" content="Hexo 4.2.1"></head>





<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>ç§äººåšå®¢</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                ä¸»é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äºæˆ‘
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/banner.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-08-17 14:46">
      2020-08-17
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      11.6k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      156
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- ä¸è’œå­ç»Ÿè®¡æ–‡ç« PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
	
   
	
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <div class="post-content mx-auto" id="post">
            
            <article class="markdown-body">
              <h1 id="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"><a href="#ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ" class="headerlink" title="ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ"></a>ğŸ˜çŸ¥è¯†ç‚¹æ¦‚è§ˆ</h1><blockquote>
<p>ä¸ºäº†æ–¹ä¾¿åç»­å›é¡¾è¯¥é¡¹ç›®æ—¶èƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“æœ¬ç« èŠ‚è®²äº†å“ªäº›å†…å®¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä»è¯¥ç« èŠ‚çš„ç¬”è®°ä¸­å¾—åˆ°ä¸€äº›å¸®åŠ©ï¼Œæ‰€ä»¥åœ¨å®Œæˆæœ¬ç« èŠ‚çš„å­¦ä¹ ååœ¨æ­¤å¯¹æœ¬ç« èŠ‚æ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“æ¦‚è¿°ã€‚</p>
</blockquote>
<p>æœ¬ç« èŠ‚ä¸ºã€å­¦æˆåœ¨çº¿ã€‘é¡¹ç›®çš„ <code>day10</code> çš„å†…å®¹</p>
<ul>
<li>è¯¾ç¨‹å‘å¸ƒåŠŸèƒ½å¼€å‘</li>
<li><code>ElasticsSearch</code> å®‰è£…éƒ¨ç½²</li>
<li><code>ElasticsSearch</code> å¿«é€Ÿå…¥é—¨ã€<code>IK</code> åˆ†è¯å™¨ã€æ˜ å°„ã€ç´¢å¼•</li>
</ul>
<h1 id="ä¸€ã€è¯¾ç¨‹å‘å¸ƒ"><a href="#ä¸€ã€è¯¾ç¨‹å‘å¸ƒ" class="headerlink" title="ä¸€ã€è¯¾ç¨‹å‘å¸ƒ"></a>ä¸€ã€è¯¾ç¨‹å‘å¸ƒ</h1><h2 id="1-éœ€æ±‚åˆ†æ"><a href="#1-éœ€æ±‚åˆ†æ" class="headerlink" title="1. éœ€æ±‚åˆ†æ"></a>1. éœ€æ±‚åˆ†æ</h2><p>è¯¾ç¨‹å‘å¸ƒåå°†ç”Ÿæˆæ­£å¼çš„è¯¾ç¨‹è¯¦æƒ…é¡µé¢ï¼Œè¯¾ç¨‹å‘å¸ƒåç”¨æˆ·å³å¯æµè§ˆè¯¾ç¨‹è¯¦æƒ…é¡µé¢ï¼Œå¹¶å¼€å§‹è¯¾ç¨‹çš„å­¦ä¹ ã€‚è¯¾ç¨‹å‘å¸ƒç”Ÿæˆè¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„æµç¨‹ä¸è¯¾ç¨‹é¢„è§ˆä¸šåŠ¡æµç¨‹ç›¸åŒï¼Œå¦‚ä¸‹ï¼š</p>
<p>1ã€ç”¨æˆ·è¿›å…¥æ•™å­¦ç®¡ç†ä¸­å¿ƒï¼Œè¿›å…¥æŸä¸ªè¯¾ç¨‹çš„ç®¡ç†ç•Œé¢</p>
<p>2ã€ç‚¹å‡»è¯¾ç¨‹å‘å¸ƒï¼Œå‰ç«¯è¯·æ±‚åˆ°è¯¾ç¨‹ç®¡ç†æœåŠ¡</p>
<p>3ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡è¿œç¨‹è°ƒç”¨ <code>CMS</code> ç”Ÿæˆè¯¾ç¨‹å‘å¸ƒé¡µé¢ï¼Œ<code>CMS</code> å°†è¯¾ç¨‹è¯¦æƒ…é¡µé¢å‘å¸ƒåˆ°æœåŠ¡å™¨</p>
<p>4ã€è¯¾ç¨‹ç®¡ç†æœåŠ¡ä¿®æ”¹è¯¾ç¨‹å‘å¸ƒçŠ¶æ€ä¸º â€œ<strong>å·²å‘å¸ƒ</strong>â€ï¼Œå¹¶å‘å‰ç«¯è¿”å›å‘å¸ƒæˆåŠŸ</p>
<p>5ã€ç”¨æˆ·åœ¨æ•™å­¦ç®¡ç†ä¸­å¿ƒç‚¹å‡» â€œè¯¾ç¨‹è¯¦æƒ…é¡µé¢â€ é“¾æ¥ï¼ŒæŸ¥çœ‹è¯¾ç¨‹è¯¦æƒ…é¡µé¢å†…å®¹</p>
<p>æµç¨‹å›¾å¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image1" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image1.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="2-CMSä¸€é”®å‘å¸ƒæ¥å£"><a href="#2-CMSä¸€é”®å‘å¸ƒæ¥å£" class="headerlink" title="2. CMSä¸€é”®å‘å¸ƒæ¥å£"></a>2. CMSä¸€é”®å‘å¸ƒæ¥å£</h2><h3 id="1ã€éœ€æ±‚åˆ†æ"><a href="#1ã€éœ€æ±‚åˆ†æ" class="headerlink" title="1ã€éœ€æ±‚åˆ†æ"></a>1ã€éœ€æ±‚åˆ†æ</h3><p>æ ¹æ®éœ€æ±‚åˆ†æå†…å®¹ï¼Œéœ€è¦åœ¨ <code>cms</code> æœåŠ¡å¢åŠ é¡µé¢å‘å¸ƒæ¥å£ä¾›è¯¾ç¨‹ç®¡ç†æœåŠ¡è°ƒç”¨ï¼Œæ­¤æ¥å£çš„åŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<p>1ã€æ¥æ”¶è¯¾ç¨‹ç®¡ç†æœåŠ¡å‘å¸ƒçš„é¡µé¢ä¿¡æ¯</p>
<p>2ã€å°†é¡µé¢ä¿¡æ¯æ·»åŠ åˆ° æ•°æ®åº“<strong>ï¼ˆmongodbï¼‰</strong></p>
<p>3ã€å¯¹é¡µé¢ä¿¡æ¯è¿›è¡Œé™æ€åŒ–</p>
<p>4ã€å°†é¡µé¢ä¿¡æ¯å‘å¸ƒåˆ°æœåŠ¡å™¨</p>
<h3 id="2ã€æ¥å£å®šä¹‰"><a href="#2ã€æ¥å£å®šä¹‰" class="headerlink" title="2ã€æ¥å£å®šä¹‰"></a>2ã€æ¥å£å®šä¹‰</h3><p>1ã€åˆ›å»ºå“åº”ç»“æœç±»å‹</p>
<p>é¡µé¢å‘å¸ƒæˆåŠŸcmsè¿”å›é¡µé¢çš„ <code>url</code></p>
<p>é¡µé¢ <code>Url</code> = <code>cmsSite.siteDomain</code> + <code>cmsSite.siteWebPath</code> + <code>cmsPage.pageWebPath</code> + <code>cmsPage.pageName</code></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CmsPostPageResult</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ResponseResult</span> </span>&#123;
    String pageUrl;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CmsPostPageResult</span><span class="hljs-params">(ResultCode resultCode,String pageUrl)</span></span>&#123;
        <span class="hljs-keyword">super</span>(resultCode);
        <span class="hljs-keyword">this</span>.pageUrl = pageUrl;
    &#125;
&#125;</code></pre></div>

<p>2ã€åœ¨ <code>api</code> å·¥ç¨‹å®šä¹‰é¡µé¢å‘å¸ƒæ¥å£</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment">   * ä¸€é”®å‘å¸ƒé¡µé¢</span>
<span class="hljs-comment">*/</span>
<span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"ä¸€é”®å‘å¸ƒé¡µé¢"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPostPageResult <span class="hljs-title">postPageQuick</span><span class="hljs-params">(CmsPage cmsPage)</span></span>;</code></pre></div>

<h3 id="3ã€Dao"><a href="#3ã€Dao" class="headerlink" title="3ã€Dao"></a>3ã€Dao</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ç»§æ‰¿MongoDBè‡ªå¸¦çš„ä¸€äº›Repository</span>
<span class="hljs-comment"> */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsSiteRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">MongoRepository</span>&lt;<span class="hljs-title">CmsSite</span>,<span class="hljs-title">String</span></span>&#123;

&#125;</code></pre></div>

<h3 id="4ã€Service"><a href="#4ã€Service" class="headerlink" title="4ã€Service"></a>4ã€Service</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ä¸€é”®å‘å¸ƒé¡µé¢</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> cmsPage</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPostPageResult <span class="hljs-title">postPageQuick</span><span class="hljs-params">(CmsPage cmsPage)</span> </span>&#123;
    <span class="hljs-comment">//æ·»åŠ é¡µé¢ï¼Œè¿™é‡Œç›´æ¥è°ƒç”¨æˆ‘ä»¬åœ¨åšé¢„è§ˆé¡µé¢æ—¶å€™å¼€å‘çš„ä¿å­˜é¡µé¢æ–¹æ³•</span>
    CmsPageResult cmsPageResult = <span class="hljs-keyword">this</span>.saveCmsPage(cmsPage);
    <span class="hljs-keyword">if</span>(!cmsPageResult.isSuccess())&#123;
        <span class="hljs-comment">//æ·»åŠ é¡µé¢å¤±è´¥</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPostPageResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);
    &#125;

    CmsPage saveCmsPage = cmsPageResult.getCmsPage();
    String pageId = saveCmsPage.getPageId();

    <span class="hljs-comment">//å‘å¸ƒé¡µé¢,é€šçŸ¥cms clientå‘å¸ƒé¡µé¢</span>
    ResponseResult responseResult = <span class="hljs-keyword">this</span>.postPage(pageId);
    <span class="hljs-keyword">if</span>(!responseResult.isSuccess())&#123;
        <span class="hljs-comment">//å‘å¸ƒå¤±è´¥</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPostPageResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);
    &#125;

    <span class="hljs-comment">//å¾—åˆ°é¡µé¢çš„urlï¼Œé¡µé¢url=ç«™ç‚¹åŸŸå+ç«™ç‚¹webpath+é¡µé¢webpath+é¡µé¢åç§°</span>
    <span class="hljs-comment">//æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦è·å–ç«™ç‚¹ä¿¡æ¯</span>
    String siteId = saveCmsPage.getSiteId();
    Optional&lt;CmsSite&gt; cmsSiteOptional = cmsSiteRepository.findById(siteId);
    <span class="hljs-keyword">if</span>(!cmsSiteOptional.isPresent())&#123;
        <span class="hljs-comment">//è·å–ç«™ç‚¹å¼‚å¸¸</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPostPageResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);
    &#125;
    CmsSite cmsSite = cmsSiteOptional.get();
    <span class="hljs-comment">//ç«™ç‚¹å’Œé¡µé¢çš„ä¿¡æ¯</span>
    String siteDomain = cmsSite.getSiteDomain();
    String siteWebPath = cmsSite.getSiteWebPath();
    String pageWebPath = saveCmsPage.getPageWebPath();
    String pageName = saveCmsPage.getPageName();
    <span class="hljs-comment">//å‘å¸ƒé¡µé¢çš„è®¿é—®åœ°å€</span>
    String pageUrl = siteDomain + siteWebPath + pageWebPath + pageName;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CmsPostPageResult(CommonCode.SUCCESS, pageUrl);
&#125;</code></pre></div>

<p>2ã€é¡µé¢å‘å¸ƒæ–¹æ³•</p>
<h3 id="5ã€Controller"><a href="#5ã€Controller" class="headerlink" title="5ã€Controller"></a>5ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * ä¸€é”®å‘å¸ƒé¡µé¢</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> cmsPage</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/postPageQuick"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CmsPostPageResult <span class="hljs-title">postPageQuick</span><span class="hljs-params">(@RequestBody CmsPage cmsPage)</span> </span>&#123;
    <span class="hljs-keyword">return</span> pageService.postPageQuick(cmsPage);
&#125;</code></pre></div>

<h2 id="3-è¯¾ç¨‹å‘å¸ƒæ¥å£"><a href="#3-è¯¾ç¨‹å‘å¸ƒæ¥å£" class="headerlink" title="3. è¯¾ç¨‹å‘å¸ƒæ¥å£"></a>3. è¯¾ç¨‹å‘å¸ƒæ¥å£</h2><h3 id="1ã€APIæ¥å£"><a href="#1ã€APIæ¥å£" class="headerlink" title="1ã€APIæ¥å£"></a>1ã€APIæ¥å£</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@ApiOperation</span>(<span class="hljs-string">"è¯¾ç¨‹å‘å¸ƒ"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">CoursePublish</span><span class="hljs-params">(String courseId)</span></span>;</code></pre></div>

<h3 id="2ã€åˆ›å»ºFeign-Client"><a href="#2ã€åˆ›å»ºFeign-Client" class="headerlink" title="2ã€åˆ›å»ºFeign Client"></a>2ã€åˆ›å»ºFeign Client</h3><p>å®šä¹‰ä¸€ä¸ªè¿œç¨‹è°ƒç”¨çš„æ–¹æ³•ï¼Œç”¨äºè¿œç¨‹è°ƒç”¨åˆšæ‰æˆ‘ä»¬åœ¨ CMS æœåŠ¡ä¸­å®šä¹‰çš„ä¸€é”®å‘å¸ƒæ¥å£ã€‚</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient</span>(value = <span class="hljs-string">"XC-SERVICE-MANAGE-CMS"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">CmsPageClient</span> </span>&#123;
    <span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/cms/page/postPageQuick"</span>)
    <span class="hljs-function">CmsPostPageResult <span class="hljs-title">postPageQuick</span><span class="hljs-params">(@RequestBody CmsPage cmsPage)</span></span>;
&#125;</code></pre></div>

<h3 id="3ã€Service"><a href="#3ã€Service" class="headerlink" title="3ã€Service"></a>3ã€Service</h3><p><strong>1ã€é…ç½®è¯¾ç¨‹å‘å¸ƒé¡µé¢å‚æ•°</strong></p>
<p>æ–°å¢è¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„ç«™ç‚¹ä¿¡æ¯ï¼Œå¦‚æœå·²å¢åŠ è¯¾ç¨‹è¯¦æƒ…é¡µé¢çš„ç«™ç‚¹åˆ™å¿½ç•¥æ­¤æ­¥éª¤ã€‚</p>
<p>å‘ <code>mongodb</code> çš„ <code>cms_site</code> ä¸­æ–°å¢å¦‚ä¸‹ä¿¡æ¯</p>
<div class="hljs"><pre><code class="hljs json">&#123; 
    <span class="hljs-attr">"_id"</span> : ObjectId(<span class="hljs-string">"5b30b052f58b4411fc6cb1cf"</span>), 
    <span class="hljs-attr">"_class"</span> : <span class="hljs-string">"com.xuecheng.framework.domain.cms.CmsSite"</span>, 
    <span class="hljs-attr">"siteName"</span> : <span class="hljs-string">"è¯¾ç¨‹è¯¦æƒ…ç«™ç‚¹"</span>, 
    <span class="hljs-attr">"siteDomain"</span> : <span class="hljs-string">"http://www.xuecheng.com"</span>, 
    <span class="hljs-attr">"sitePort"</span> : <span class="hljs-string">"80"</span>, 
    <span class="hljs-attr">"siteWebPath"</span> : <span class="hljs-string">"/"</span>, 
    <span class="hljs-attr">"siteCreateTime"</span> : ISODate(<span class="hljs-string">"2018-02-03T02:34:19.113+0000"</span>)
&#125;</code></pre></div>

<p>åœ¨ <code>application.yml</code> ä¸­é…ç½®</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">course-publish:</span>
  <span class="hljs-attr">siteId:</span> <span class="hljs-string">5b30b052f58b4411fc6cb1cf</span>
  <span class="hljs-attr">templateId:</span> <span class="hljs-string">5e93d2e3d79e7d6ed1009b95</span>
  <span class="hljs-attr">previewUrl:</span> <span class="hljs-string">http://www.xuecheng.com/cms/preview/</span>
  <span class="hljs-attr">pageWebPath:</span> <span class="hljs-string">/course/detail/</span>
  <span class="hljs-attr">pagePhysicalPath:</span> <span class="hljs-string">G:/job/code/Project/XueChengOnline/xcEduUI01/xuecheng/static/course/detail/</span>
  <span class="hljs-attr">dataUrlPre:</span> <span class="hljs-string">http://localhost:31200/course/preview/model/</span></code></pre></div>

<ul>
<li><code>siteId</code>ï¼šç«™ç‚¹<code>id</code></li>
<li><code>templateId</code>ï¼šæ¨¡æ¿<code>id</code></li>
<li><code>dataurlPre</code>ï¼šæ•°æ®<code>url</code>çš„å‰ç¼€</li>
<li><code>pageWebPath</code>: é¡µé¢çš„ <code>web</code> è®¿é—®è·¯å¾„</li>
<li><code>pagePhysicalPath</code>ï¼š è¿™ä¸ªæŒ‡çš„æ˜¯é¡µé¢è¦å‘å¸ƒåˆ° <code>nginx</code> æœåŠ¡å™¨çš„ç‰©ç†è·¯å¾„ï¼Œæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå¯ä»¥åŠ¨æ€è°ƒæ•´ï¼Œä¾¿äºæ‰©å±•ã€‚</li>
</ul>
<p><strong>2ã€service æ–¹æ³•å¦‚ä¸‹</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">//æ‹¼è£…é¡µé¢ä¿¡æ¯</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> CmsPage <span class="hljs-title">setPageInfo</span><span class="hljs-params">(String courseId)</span></span>&#123;
    <span class="hljs-comment">//è·å–è¯¾ç¨‹ä¿¡æ¯</span>
    CourseBase courseBaseById = <span class="hljs-keyword">this</span>.findCourseBaseById(courseId);

    <span class="hljs-comment">//æ‹¼è£…é¡µé¢åŸºæœ¬ä¿¡æ¯</span>
    CmsPage cmsPage = <span class="hljs-keyword">new</span> CmsPage();
    cmsPage.setDataUrl(publish_dataUrlPre + courseId);
    cmsPage.setPagePhysicalPath(publish_page_physicalpath);
    cmsPage.setPageWebPath(publish_page_webpath);
    cmsPage.setSiteId(publish_siteId);
    cmsPage.setTemplateId(publish_templateId);
    cmsPage.setPageName(courseId + <span class="hljs-string">".html"</span>);

    <span class="hljs-comment">//é¡µé¢åˆ«å</span>
    cmsPage.setPageAliase(courseBaseById.getName());
    <span class="hljs-keyword">return</span> cmsPage;
&#125;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * è¯¾ç¨‹è¯¦ç»†é¡µé¢å‘å¸ƒ</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">coursePublish</span><span class="hljs-params">(String courseId)</span></span>&#123;
    <span class="hljs-comment">//æ‹¼è£…é¡µé¢ä¿¡æ¯</span>
    CmsPage cmsPage = setPageInfo(courseId);

    <span class="hljs-comment">//å‘å¸ƒè¯¾ç¨‹è¯¦ç»†é¡µé¢</span>
    CmsPostPageResult cmsPostPageResult = cmsPageClient.postPageQuick(cmsPage);
    <span class="hljs-keyword">if</span>(!cmsPostPageResult.isSuccess())&#123;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CoursePublishResult(CommonCode.FAIL,<span class="hljs-keyword">null</span>);
    &#125;

    <span class="hljs-comment">//æ›´æ–°è¯¾ç¨‹çŠ¶æ€</span>
    CourseBase courseBaseById = <span class="hljs-keyword">this</span>.findCourseBaseById(courseId);
    courseBaseById.setStatus(<span class="hljs-string">"202002"</span>);
    courseBaseRepository.save(courseBaseById);

    <span class="hljs-comment">//è¯¾ç¨‹ç´¢å¼•...</span>

    <span class="hljs-comment">//è¯¾ç¨‹ç¼“å­˜...</span>

    <span class="hljs-comment">//é¡µé¢url</span>
    String pageUrl = cmsPostPageResult.getPageUrl();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CoursePublishResult(CommonCode.SUCCESS,pageUrl);
&#125;</code></pre></div>

<h3 id="4ã€Controller"><a href="#4ã€Controller" class="headerlink" title="4ã€Controller"></a>4ã€Controller</h3><div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * è¯¾ç¨‹å‘å¸ƒ</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@param</span> courseId</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-meta">@PostMapping</span>(<span class="hljs-string">"/publish/&#123;id&#125;"</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> CoursePublishResult <span class="hljs-title">CoursePublish</span><span class="hljs-params">(@PathVariable(<span class="hljs-string">"id"</span>)</span> String courseId) </span>&#123;
    <span class="hljs-keyword">return</span> courseService.coursePublish(courseId);
&#125;</code></pre></div>

<p>5ã€æ¥å£æµ‹è¯•</p>
<h2 id="4-æµ‹è¯•CMSä¸€é”®å‘å¸ƒæ¥å£"><a href="#4-æµ‹è¯•CMSä¸€é”®å‘å¸ƒæ¥å£" class="headerlink" title="4. æµ‹è¯•CMSä¸€é”®å‘å¸ƒæ¥å£"></a>4. æµ‹è¯•CMSä¸€é”®å‘å¸ƒæ¥å£</h2><p><strong>æµ‹è¯•å‰å‡†å¤‡å·¥ä½œ</strong></p>
<p>1ã€å¯åŠ¨<code>RabbitMQ</code>æœåŠ¡<br>2ã€å¯åŠ¨ <code>cms</code> ã€<code>course</code> æœåŠ¡<br>3ã€å¯åŠ¨ <code>cms_client</code>ï¼Œæ³¨æ„é…ç½® <code>routingKey</code> å’Œé˜Ÿåˆ—åç§°ï¼Œ<code>routingKey</code> ä¸ºæ‰€ä½¿ç”¨çš„ç«™ç‚¹id</p>
<p>4ã€è¿™é‡Œæˆ‘ä»¬åˆ†åˆ«åœ¨ <code>course</code> ã€<code>cms</code>ã€cms client ä¸‰ä¸ªæœåŠ¡å†…å¯¹åº”çš„åœ°æ–¹æ‰“ä¸Šæ–­ç‚¹ï¼Œè§‚å¯Ÿå‘å¸ƒçš„æµç¨‹</p>
<p><code>course</code> æœåŠ¡æ–­ç‚¹ï¼Œæˆ‘ä»¬è®¾ç½®åœ¨è¿œç¨‹è°ƒç”¨ cms ä¸€é”®å‘å¸ƒæ¥å£è¿”å›ç»“æœä¹‹å</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image2" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image2.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>cms æœåŠ¡æ–­ç‚¹ï¼Œåœ¨ <strong>ä¸€é”®å‘å¸ƒæ¥å£</strong> å¼€å§‹æ‰§è¡Œçš„åœ°æ–¹æˆ‘ä»¬æ‰“ä¸Šæ–­ç‚¹</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image3" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image3.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å½“ cms å®¢æˆ·ç«¯æ¥æ”¶åˆ° cms é€šè¿‡ rabbitMQ å‘é€çš„æ¶ˆæ¯åï¼Œä¼šè°ƒç”¨è¯¥æ–¹æ³•å°†é¡µé¢ä¿å­˜åˆ° nginx æœåŠ¡å™¨çš„ç‰©ç†è·¯å¾„å†…</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image4" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image4.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å‡†å¤‡å·¥ä½œåšå®Œäº†ï¼Œæˆ‘ä»¬åœ¨ course æœåŠ¡ç”Ÿæˆçš„ sawgger-ui è¿›è¡Œæµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image5" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image5.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å‘é€è¯·æ±‚åï¼Œæˆ‘ä»¬åœ¨ idea ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ–­ç‚¹å·²ç»è·‘åˆ°äº† cms æœåŠ¡çš„ä¸€é”®å‘å¸ƒæ¥å£</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image6" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image6.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç»§ç»­æ‰§è¡Œçš„è¯ï¼Œ<code>cms</code> æœåŠ¡ä¼šè°ƒç”¨ <code>this.postPage</code> æ–¹æ³•ï¼Œè·å–è¯¥é¡µé¢çš„ æ•°æ®æ¨¡å‹ã€ä»¥åŠæ¨¡æ¿æ•°æ®ï¼Œå°†æ•°æ®é™æ€åŒ–åå¾—åˆ°å®Œæ•´çš„é¡µé¢æ•°æ®ï¼Œå¹¶ä¸”å†™å…¥åˆ° <code>GridFS</code> ä¸­ï¼›</p>
<p>å†™å…¥ <code>GridFS</code>åé€šè¿‡ <code>rabbitMQ</code> å‘é€æ¶ˆæ¯åˆ° <code>cms client</code> ï¼Œæ¶ˆæ¯çš„å†…å®¹åŒ…å«ä¸€ä¸ªé¡µé¢<code>id</code>ï¼Œå…¥ä¸‹å›¾ï¼Œæ–­ç‚¹å·²ç»èµ°åˆ°äº† <code>cms client</code> æœåŠ¡çš„ <code>savePageToServerPath</code> æ–¹æ³•ä¸­</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image7" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image7.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>``cms client<code>æ¥æ”¶åˆ°</code>pageId<code>åï¼Œè·å–è¯¥é¡µé¢æ•°æ®çš„ fileIdï¼Œé€šè¿‡è¯¥idåˆ°</code>GridFS` ä¸­æ‰¾åˆ°è¯¥é¡µé¢çš„æ•°æ®ï¼Œå¹¶å†™å…¥åˆ°é¡µé¢çš„ç‰©ç†è·¯å¾„å†…ï¼Œå†™å…¥å®Œæˆåï¼Œå›åˆ° cms æœåŠ¡å†…æ‹¼è£…å‘å¸ƒåçš„é¡µé¢åœ°å€ï¼Œå†è¿”å›åˆ° course æœåŠ¡</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image8" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image8.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>course æœåŠ¡æ¥æ”¶åˆ° cms çš„å“åº”ï¼Œå–å‡º pageUrl è¿”å›åˆ°å‰ç«¯ï¼Œå¦‚ä¸‹å›¾</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image9" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image9.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å›åˆ° swagger uiï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²ç»è¿”å›äº†ä¸€ä¸ªå‘å¸ƒæˆåŠŸçš„url</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image10" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image10.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>è®¿é—®é¡µé¢çœ‹ä¸‹æ•ˆæœ</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image11" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image11.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="5-å‰ç«¯é¡µé¢å¼€å‘ä¸æµ‹è¯•"><a href="#5-å‰ç«¯é¡µé¢å¼€å‘ä¸æµ‹è¯•" class="headerlink" title="5. å‰ç«¯é¡µé¢å¼€å‘ä¸æµ‹è¯•"></a>5. å‰ç«¯é¡µé¢å¼€å‘ä¸æµ‹è¯•</h2><p><strong>1ã€é¡µé¢å¼€å‘</strong></p>
<div class="hljs"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-card</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box-card"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">slot</span>=<span class="hljs-string">"header"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"clearfix"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>è¯¾ç¨‹å‘å¸ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text item"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"course.status == '202001'"</span>&gt;</span>
      çŠ¶æ€ï¼šåˆ¶ä½œä¸­<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>  @<span class="hljs-attr">click.native</span>=<span class="hljs-string">"publish"</span> &gt;</span>æ–°è¯¾ç¨‹å‘å¸ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"course.status == '202003'"</span>&gt;</span>
      çŠ¶æ€ï¼šå·²ä¸‹çº¿
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">"'http://www.xuecheng.com/course/detail/'+this.courseid+'.html'"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>ç‚¹æˆ‘æŸ¥çœ‹è¯¾ç¨‹è¯¦æƒ…é¡µé¢ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else-if</span>=<span class="hljs-string">"course.status == '202002'"</span>&gt;</span>
      çŠ¶æ€ï¼šå·²å‘å¸ƒ<span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>  @<span class="hljs-attr">click.native</span>=<span class="hljs-string">"publish"</span> &gt;</span>ä¿®æ”¹å‘å¸ƒ<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">br</span>/&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">"'http://www.xuecheng.com/course/detail/'+this.courseid+'.html'"</span> <span class="hljs-attr">target</span>=<span class="hljs-string">"_blank"</span>&gt;</span>ç‚¹æˆ‘æŸ¥çœ‹è¯¾ç¨‹è¯¦æƒ…é¡µé¢ <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">el-card</span>&gt;</span></code></pre></div>

<p><strong>2ã€è·å–è¯¾ç¨‹çŠ¶æ€</strong></p>
<div class="hljs"><pre><code class="hljs js">getCourseView()&#123;
  courseApi.findCourseView(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;
    <span class="hljs-keyword">if</span>(res)&#123;
        <span class="hljs-comment">//è·å–è¯¾ç¨‹çŠ¶æ€</span>
        <span class="hljs-keyword">this</span>.course.status = res.status;
    &#125;
  &#125;)
&#125;</code></pre></div>

<p>åœ¨é¡µé¢åˆå§‹åŒ–å®Œæˆå…¶å‰æ‰§è¡Œ</p>
<div class="hljs"><pre><code class="hljs js">mounted()&#123;
  <span class="hljs-comment">//è¯¾ç¨‹id</span>
  <span class="hljs-keyword">this</span>.courseid = <span class="hljs-keyword">this</span>.$route.params.courseid;
  <span class="hljs-comment">//æŸ¥è¯¢è¯¾ç¨‹ä¿¡æ¯</span>
  <span class="hljs-keyword">this</span>.getCourseView();
&#125;</code></pre></div>

<p><strong>3ã€é¡µé¢å‘å¸ƒæ¥å£</strong></p>
<p>apiæ¥å£å®šä¹‰</p>
<div class="hljs"><pre><code class="hljs js"><span class="hljs-comment">/*å‘å¸ƒè¯¾ç¨‹*/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> publish = <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> &#123;
  <span class="hljs-keyword">return</span> http.requestPost(apiUrl+<span class="hljs-string">'/course/publish/'</span>+id);
&#125;</code></pre></div>

<p>apiæ¥å£å®ç°</p>
<div class="hljs"><pre><code class="hljs js">publish()&#123;
  <span class="hljs-comment">//è¯¾ç¨‹å‘å¸ƒ</span>
  courseApi.publish(<span class="hljs-keyword">this</span>.courseid).then(<span class="hljs-function"><span class="hljs-params">res</span>=&gt;</span>&#123;
      <span class="hljs-keyword">if</span>(res.success)&#123;
          <span class="hljs-keyword">this</span>.$message.success(<span class="hljs-string">"å‘å¸ƒæˆåŠŸï¼Œè¯·ç‚¹å‡»ä¸‹è¾¹çš„é“¾æ¥æŸ¥è¯¢è¯¾ç¨‹è¯¦æƒ…é¡µé¢"</span>)
          <span class="hljs-keyword">this</span>.getCourseView();
      &#125;<span class="hljs-keyword">else</span>&#123;
        <span class="hljs-keyword">this</span>.$message.error(res.message)
      &#125;

  &#125;)
&#125;,</code></pre></div>

<p>æµ‹è¯•</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image12" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image12.gif" srcset="/img/loading.gif" alt="img"></a></p>
<h1 id="äºŒã€åˆè¯†-Elastic-Search"><a href="#äºŒã€åˆè¯†-Elastic-Search" class="headerlink" title="äºŒã€åˆè¯† Elastic Search"></a>äºŒã€åˆè¯† Elastic Search</h1><h2 id="1-æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"><a href="#1-æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ" class="headerlink" title="1. æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ"></a>1. æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</h2><h3 id="1ã€ç®€å†"><a href="#1ã€ç®€å†" class="headerlink" title="1ã€ç®€å†"></a>1ã€ç®€å†</h3><p>ç™¾åº¦ç™¾ç§‘</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image13" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image13.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>å®˜æ–¹ç½‘å€ï¼š<a href="https://www.elastic.co/cn/products/elasticsearch" target="_blank" rel="noopener">https://www.elastic.co/cn/products/elasticsearch</a></p>
<p>Github ï¼š<a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener">https://github.com/elastic/elasticsearch</a></p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>1ã€<code>elasticsearch</code>æ˜¯ä¸€ä¸ªåŸºäº<code>Lucene</code>çš„é«˜æ‰©å±•çš„åˆ†å¸ƒå¼æœç´¢æœåŠ¡å™¨ï¼Œæ”¯æŒå¼€ç®±å³ç”¨ã€‚<br>2ã€<code>elasticsearch</code> éšè—äº† <code>Lucene</code> çš„å¤æ‚æ€§ï¼Œå¯¹å¤–æä¾› <code>Restful</code> æ¥å£æ¥æ“ä½œç´¢å¼•ã€æœç´¢ã€‚</p>
<p><strong>çªå‡ºä¼˜ç‚¹ï¼š</strong></p>
<ol>
<li>æ‰©å±•æ€§å¥½ï¼Œå¯éƒ¨ç½²ä¸Šç™¾å°æœåŠ¡å™¨é›†ç¾¤ï¼Œå¤„ç†PBçº§æ•°æ®ã€‚</li>
<li>è¿‘å®æ—¶çš„å»ç´¢å¼•æ•°æ®ã€æœç´¢æ•°æ®ã€‚</li>
</ol>
<p>å¸‚é¢ä¸Šçš„åŒç±»å‹çš„äº§å“æœ‰ <code>solr</code> ï¼Œé‚£ä¹ˆ <code>es</code> å’Œ <code>solr</code> é€‰æ‹©å“ªä¸ªï¼Ÿ</p>
<p>å¦‚æœä½ å…¬å¸ç°åœ¨ç”¨çš„ <code>solr</code> å¯ä»¥æ»¡è¶³éœ€æ±‚å°±ä¸è¦æ¢äº†ã€‚</p>
<p>å¦‚æœä½ å…¬å¸å‡†å¤‡è¿›è¡Œå…¨æ–‡æ£€ç´¢é¡¹ç›®çš„å¼€å‘ï¼Œå»ºè®®ä¼˜å…ˆè€ƒè™‘ <code>elasticsearch</code>ï¼Œå› ä¸ºåƒ <code>Github</code>è¿™æ ·å¤§è§„æ¨¡çš„æœç´¢éƒ½åœ¨ç”¨å®ƒã€‚</p>
<h3 id="2ã€åŸç†äºåº”ç”¨"><a href="#2ã€åŸç†äºåº”ç”¨" class="headerlink" title="2ã€åŸç†äºåº”ç”¨"></a>2ã€åŸç†äºåº”ç”¨</h3><p>ç´¢å¼•ç»“æ„</p>
<p>ä¸‹å›¾æ˜¯ <code>ElasticSearch</code> çš„ç´¢å¼•ç»“æ„ï¼Œä¸‹è¾¹é»‘è‰²éƒ¨åˆ†æ˜¯ç‰©ç†ç»“æ„ï¼Œä¸Šè¾¹é»„è‰²éƒ¨åˆ†æ˜¯é€»è¾‘ç»“æ„ï¼Œé€»è¾‘ç»“æ„ä¹Ÿæ˜¯ä¸ºäº†æ›´å¥½çš„å»æè¿° <code>ElasticSearch</code> çš„å·¥ä½œåŸç†åŠå»ä½¿ç”¨ç‰©ç†ç»“æ„ä¸­çš„ç´¢å¼•æ–‡ä»¶ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image14" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image14.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>é€»è¾‘ç»“æ„éƒ¨åˆ†æ˜¯ä¸€ä¸ªå€’æ’ç´¢å¼•è¡¨ï¼š</p>
<p>1ã€å°†è¦æœç´¢çš„æ–‡æ¡£å†…å®¹åˆ†è¯ï¼Œæ‰€æœ‰ä¸é‡å¤çš„è¯ç»„æˆåˆ†è¯åˆ—è¡¨ã€‚</p>
<p>2ã€å°†æœç´¢çš„æ–‡æ¡£æœ€ç»ˆä»¥ <code>Document</code> æ–¹å¼å­˜å‚¨èµ·æ¥ã€‚</p>
<p>3ã€æ¯ä¸ªè¯å’Œ <code>docment</code> éƒ½æœ‰å…³è”ã€‚</p>
<p>å¦‚ä¸‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image15" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image15.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æœç´¢ <code>quick brown</code> ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥æ‰¾åŒ…å«æ¯ä¸ªè¯æ¡çš„æ–‡æ¡£ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image16" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image16.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¸¤ä¸ªæ–‡æ¡£éƒ½åŒ¹é…ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªåŒ¹é…åº¦æ›´é«˜ã€‚å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä»…è®¡ç®—åŒ¹é…è¯æ¡æ•°é‡çš„ç®€å• ç›¸ä¼¼æ€§ç®—æ³• ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥è¯´ï¼Œå¯¹äºæˆ‘ä»¬æŸ¥è¯¢çš„ç›¸å…³æ€§æ¥è®²ï¼Œç¬¬ä¸€ä¸ªæ–‡æ¡£æ¯”ç¬¬äºŒä¸ªæ–‡æ¡£æ›´ä½³ã€‚</p>
<blockquote>
<p>æ­£æ’ç´¢å¼•ï¼šæ ¹æ®è¯ä¸æ–‡ç« å†…å®¹çš„å…³ç³»è¿›è¡Œç´¢å¼•ã€‚</p>
<p>å€’æ’ç´¢å¼•ï¼šæ ¹æ®è¯ä¸æ–‡ç« çš„å…³ç³»è¿›è¡Œç´¢å¼•ï¼Œéœ€è¦æå‰å¯¹è¯å’Œæ–‡ç« è¿›è¡Œå…³è”ã€‚</p>
</blockquote>
<h3 id="3ã€å¦‚ä½•ä½¿ç”¨esï¼Ÿ"><a href="#3ã€å¦‚ä½•ä½¿ç”¨esï¼Ÿ" class="headerlink" title="3ã€å¦‚ä½•ä½¿ç”¨esï¼Ÿ"></a>3ã€å¦‚ä½•ä½¿ç”¨esï¼Ÿ</h3><p><code>Elasticsearch</code> æä¾› <code>RESTful Api</code> æ¥å£è¿›è¡Œç´¢å¼•ã€æœç´¢ï¼Œå¹¶ä¸”æ”¯æŒå¤šç§å®¢æˆ·ç«¯ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image17" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image17.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>ä¸‹å›¾æ˜¯esåœ¨é¡¹ç›®ä¸­çš„åº”ç”¨æ–¹å¼ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image18" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image18.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1ï¼‰ç”¨æˆ·åœ¨å‰ç«¯æœç´¢å…³é”®å­—</p>
<p>2ï¼‰é¡¹ç›®å‰ç«¯é€šè¿‡ <code>http</code> æ–¹å¼è¯·æ±‚é¡¹ç›®æœåŠ¡ç«¯</p>
<p>3ï¼‰é¡¹ç›®æœåŠ¡ç«¯é€šè¿‡ <code>Http RESTful</code> æ–¹å¼è¯·æ±‚ <code>ES</code> é›†ç¾¤è¿›è¡Œæœç´¢</p>
<p>4ï¼‰<code>ES</code> é›†ç¾¤ä»ç´¢å¼•åº“æ£€ç´¢æ•°æ®ã€‚</p>
<h2 id="2-å®‰è£…-Elastic-Search"><a href="#2-å®‰è£…-Elastic-Search" class="headerlink" title="2. å®‰è£… Elastic Search"></a>2. å®‰è£… Elastic Search</h2><h3 id="1ã€å®‰è£…"><a href="#1ã€å®‰è£…" class="headerlink" title="1ã€å®‰è£…"></a>1ã€å®‰è£…</h3><p>å®‰è£…é…ç½®ï¼š</p>
<p>1ã€æ–°ç‰ˆæœ¬è¦æ±‚è‡³å°‘ <code>jdk1.8</code> ä»¥ä¸Šã€‚</p>
<p>2ã€æ”¯æŒ<code>tar</code>ã€<code>zip</code>ã€<code>rpm</code>ç­‰å¤šç§å®‰è£…æ–¹å¼ã€‚åœ¨ <code>windows</code> ä¸‹å¼€å‘å»ºè®®ä½¿ç”¨ZIPå®‰è£…æ–¹å¼ã€‚</p>
<p>3ã€æ”¯æŒ <code>docker</code> æ–¹å¼å®‰è£…</p>
<p>è¯¦ç»†å‚è§ï¼š<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/current/install-elasticsearch.html</a></p>
<p>æ³¨æ„è§†é¢‘æ•™ç¨‹ä¸­ç”¨çš„æ˜¯6.2.1çš„ï¼Œä¸ºäº†é€‚åº”è¾ƒæ–°çš„ç‰ˆæœ¬è¿™é‡Œæˆ‘è¿™é‡Œä¸‹è½½ <code>6.8.8</code> çš„ç‰ˆæœ¬ä½œä¸ºæ¼”ç¤º</p>
<blockquote>
<p>æˆªè‡³ç°åœ¨å®˜æ–¹å·²ç»æ›´æ–° åˆ°äº† 7.7.*ï¼Œä»è¯­ä¹‰åŒ–ç‰ˆæœ¬è§„èŒƒæ¥çœ‹ï¼Œ6å’Œ7åº”è¯¥æœ‰æ¶æ„ä¸Šçš„é‡å¤§å˜åŒ–ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯é€‰æ‹©6ç³»çš„æœ€æ–°ä¸€ä¸ªç‰ˆæœ¬é¿å…è¸©å‘ï¼Œä»¥åæœ‰éœ€æ±‚å†å»å¯¹æ¯”7çš„å·®å¼‚ã€‚</p>
</blockquote>
<p><a href="https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.8.zip" target="_blank" rel="noopener">https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.8.zip</a></p>
<p>å…¶ä»–ç‰ˆæœ¬ä¸‹è½½ï¼š<a href="https://www.elastic.co/cn/downloads/past-releases" target="_blank" rel="noopener">https://www.elastic.co/cn/downloads/past-releases</a></p>
<p>ä¸‹è½½å®Œæˆåæˆ‘ä»¬è§£å‹ <code>elasticsearch-*.*.*.zip</code></p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image19" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image19.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><code>bin</code>ï¼šè„šæœ¬ç›®å½•ï¼ŒåŒ…æ‹¬ï¼šå¯åŠ¨ã€åœæ­¢ç­‰å¯æ‰§è¡Œè„šæœ¬</p>
<p><code>config</code>ï¼šé…ç½®æ–‡ä»¶ç›®å½•</p>
<p><code>data</code>ï¼šç´¢å¼•ç›®å½•ï¼Œå­˜æ”¾ç´¢å¼•æ–‡ä»¶çš„åœ°æ–¹</p>
<p><code>logs</code>ï¼šæ—¥å¿—ç›®å½•</p>
<p><code>modules</code>ï¼šæ¨¡å—ç›®å½•ï¼ŒåŒ…æ‹¬äº†esçš„åŠŸèƒ½æ¨¡å—</p>
<p><code>plugins</code> :æ’ä»¶ç›®å½•ï¼Œesæ”¯æŒæ’ä»¶æœºåˆ¶</p>
<h3 id="2ã€é…ç½®æ–‡ä»¶"><a href="#2ã€é…ç½®æ–‡ä»¶" class="headerlink" title="2ã€é…ç½®æ–‡ä»¶"></a>2ã€é…ç½®æ–‡ä»¶</h3><p>ESçš„é…ç½®æ–‡ä»¶çš„åœ°å€æ ¹æ®å®‰è£…å½¢å¼çš„ä¸åŒè€Œä¸åŒï¼š</p>
<p>1ã€ä½¿ç”¨ <code>zip</code>ã€<code>tar</code> å®‰è£…ï¼Œé…ç½®æ–‡ä»¶çš„åœ°å€åœ¨å®‰è£…ç›®å½•çš„ <code>config</code> ä¸‹ã€‚</p>
<p>2ã€ä½¿ç”¨ <code>RPM</code> å®‰è£…ï¼Œé…ç½®æ–‡ä»¶åœ¨ <code>/etc/elasticsearch</code> ä¸‹ã€‚</p>
<p>3ã€ä½¿ç”¨ <code>MSI</code> å®‰è£…ï¼Œé…ç½®æ–‡ä»¶çš„åœ°å€åœ¨å®‰è£…ç›®å½•çš„ <code>config</code> ä¸‹ï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å°† <code>config</code> ç›®å½•åœ°å€å†™å…¥ç¯å¢ƒå˜é‡<br><code>ES_PATH_CONF</code>ã€‚</p>
<p>æœ¬æ•™ç¨‹ä½¿ç”¨çš„ <code>zip</code> åŒ…å®‰è£…ï¼Œé…ç½®æ–‡ä»¶åœ¨ESå®‰è£…ç›®å½•çš„<code>config</code>ä¸‹ã€‚</p>
<p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>elasticsearch.yml</code> ï¼š ç”¨äºé…ç½®Elasticsearchè¿è¡Œå‚æ•°</li>
<li><code>jvm.options</code> ï¼š ç”¨äºé…ç½®Elasticsearch JVMè®¾ç½®</li>
<li><code>log4j2.properties</code>ï¼š ç”¨äºé…ç½®Elasticsearchæ—¥å¿—</li>
</ul>
<h4 id="elasticsearch-yml"><a href="#elasticsearch-yml" class="headerlink" title="elasticsearch.yml"></a><strong>elasticsearch.yml</strong></h4><p>é…ç½®æ ¼å¼æ˜¯ <code>YAML</code>ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<p><strong>æ–¹å¼1ï¼šå±‚æ¬¡æ–¹å¼</strong></p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">path:</span> 
  <span class="hljs-attr">data:</span> <span class="hljs-string">/var/lib/elasticsearch</span>
  <span class="hljs-attr">logs:</span> <span class="hljs-string">/var/log/elasticsearch</span></code></pre></div>

<p><strong>æ–¹å¼2ï¼šå±æ€§æ–¹å¼</strong></p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">path.data:</span> <span class="hljs-string">/var/lib/elasticsearch</span>
<span class="hljs-attr">path.logs:</span> <span class="hljs-string">/var/log/elasticsearch</span></code></pre></div>

<p>æœ¬é¡¹ç›®é‡‡ç”¨æ–¹å¼2ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">cluster.name:</span> <span class="hljs-string">xuecheng</span>
<span class="hljs-attr">node.name:</span> <span class="hljs-string">xc_node_1</span>
<span class="hljs-attr">network.host:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span>
<span class="hljs-attr">http.port:</span> <span class="hljs-number">9200</span>
<span class="hljs-attr">transport.tcp.port:</span> <span class="hljs-number">9300</span>
<span class="hljs-attr">node.master:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">node.data:</span> <span class="hljs-literal">true</span>
<span class="hljs-comment">#discovery.zen.ping.unicast.hosts: ["0.0.0.0:9300", "0.0.0.0:9301", "0.0.0.0:9302"]</span>
<span class="hljs-attr">discovery.zen.minimum_master_nodes:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">bootstrap.memory_lock:</span> <span class="hljs-literal">false</span>
<span class="hljs-attr">node.max_local_storage_nodes:</span> <span class="hljs-number">1</span>
<span class="hljs-attr">path.data:</span> <span class="hljs-string">D:\ElasticSearch\elasticsearchâ€6.2.1\data</span>
<span class="hljs-attr">path.logs:</span> <span class="hljs-string">D:\ElasticSearch\elasticsearchâ€6.2.1\logs</span>
<span class="hljs-attr">http.cors.enabled:</span> <span class="hljs-literal">true</span>
<span class="hljs-string">http.cors.allowâ€origin:</span> <span class="hljs-string">/.*/</span></code></pre></div>

<p>æ³¨æ„ <code>path.data</code> å’Œ <code>path.logs</code> è·¯å¾„é…ç½®æ­£ç¡®ã€‚</p>
<p>å¸¸ç”¨çš„é…ç½®é¡¹å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>é…ç½®å­—æ®µ</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>cluster.name</td>
<td>é…ç½® <code>elasticsearch</code> çš„é›†ç¾¤åç§°ï¼Œé»˜è®¤æ˜¯ <code>elasticsearch</code>ã€‚å»ºè®®ä¿®æ”¹æˆä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ã€‚</td>
</tr>
<tr>
<td>node.name</td>
<td>èŠ‚ç‚¹åï¼Œé€šå¸¸ä¸€å°ç‰©ç†æœåŠ¡å™¨å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œ<code>es</code> ä¼šé»˜è®¤éšæœºæŒ‡å®šä¸€ä¸ªåå­—ï¼Œå»ºè®®æŒ‡å®šä¸€ä¸ªæœ‰æ„ä¹‰çš„åç§°ï¼Œæ–¹ä¾¿ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆä¸€ä¸ª <code>cluster</code> é›†ç¾¤ï¼Œé›†ç¾¤æ˜¯ä¸€ä¸ªé€»è¾‘çš„æ¦‚å¿µï¼ŒèŠ‚ç‚¹æ˜¯ç‰©ç†æ¦‚å¿µï¼Œåè¾¹ç« èŠ‚ä¼šè¯¦ç»†ä»‹ç»ã€‚</td>
</tr>
<tr>
<td>path.conf</td>
<td>è®¾ç½®é…ç½®æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œtaræˆ–zipåŒ…å®‰è£…é»˜è®¤åœ¨ <code>es</code> æ ¹ç›®å½•ä¸‹çš„ <code>config</code> æ–‡ä»¶å¤¹ï¼Œ<code>rpm</code> å®‰è£…é»˜è®¤åœ¨ <code>/etc/</code></td>
</tr>
<tr>
<td>path.logs</td>
<td>è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„ <code>logs</code> æ–‡ä»¶å¤¹</td>
</tr>
<tr>
<td>path.plugins</td>
<td>è®¾ç½®æ’ä»¶çš„å­˜æ”¾è·¯å¾„ï¼Œé»˜è®¤æ˜¯ <code>es</code> æ ¹ç›®å½•ä¸‹çš„ <code>plugins</code> æ–‡ä»¶å¤¹</td>
</tr>
<tr>
<td>bootstrap.memory_lock</td>
<td><code>true</code> è®¾ç½®ä¸º <code>true</code> å¯ä»¥é”ä½ <code>ES</code> ä½¿ç”¨çš„å†…å­˜ï¼Œé¿å…å†…å­˜ä¸ <code>swap</code> åˆ†åŒºäº¤æ¢æ•°æ®ã€‚</td>
</tr>
<tr>
<td>elasticsearch path.data</td>
<td>è®¾ç½®ç´¢å¼•æ•°æ®çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯ <code>es</code> æ ¹ç›®å½•ä¸‹çš„ <code>data</code> æ–‡ä»¶å¤¹ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªå­˜å‚¨è·¯å¾„ï¼Œç”¨é€—å·éš”å¼€ã€‚ <code>path.logs</code>: è®¾ç½®æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ï¼Œé»˜è®¤æ˜¯esæ ¹ç›®å½•ä¸‹çš„ <code>logs</code> æ–‡ä»¶å¤¹</td>
</tr>
<tr>
<td>network.host</td>
<td>è®¾ç½®ç»‘å®šä¸»æœºçš„ <code>ip</code> åœ°å€ï¼Œè®¾ç½®ä¸º <code>0.0.0.0</code> è¡¨ç¤ºç»‘å®šä»»ä½• <code>ip</code>ï¼Œå…è®¸å¤–ç½‘è®¿é—®ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®ä¸ºå…·ä½“çš„ <code>ip</code>ã€‚</td>
</tr>
<tr>
<td>http.port</td>
<td><code>9200</code> è®¾ç½®å¯¹å¤–æœåŠ¡çš„ <code>http</code> ç«¯å£ï¼Œé»˜è®¤ä¸º <code>9200</code>ã€‚</td>
</tr>
<tr>
<td>transport.tcp.port</td>
<td><code>9300</code> é›†ç¾¤ç»“ç‚¹ä¹‹é—´é€šä¿¡ç«¯å£</td>
</tr>
<tr>
<td>node.master</td>
<td>æŒ‡å®šè¯¥èŠ‚ç‚¹æ˜¯å¦æœ‰èµ„æ ¼è¢«é€‰ä¸¾æˆä¸º <code>master</code> ç»“ç‚¹ï¼Œé»˜è®¤æ˜¯trueï¼Œå¦‚æœåŸæ¥çš„masterå®•æœºä¼šé‡æ–°é€‰ä¸¾æ–°çš„masterã€‚</td>
</tr>
<tr>
<td>node.data</td>
<td>æŒ‡å®šè¯¥èŠ‚ç‚¹æ˜¯å¦å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œé»˜è®¤ä¸º <code>true</code>ã€‚</td>
</tr>
<tr>
<td>discovery.zen.ping.unicast.hosts</td>
<td>[â€œhost1:portâ€, â€œhost2:portâ€, â€œâ€¦â€] è®¾ç½®é›†ç¾¤ä¸­ <code>master</code> èŠ‚ç‚¹çš„åˆå§‹åˆ—è¡¨ã€‚</td>
</tr>
<tr>
<td>discovery.zen.ping.timeout</td>
<td><code>3s</code> è®¾ç½® <code>ES</code> è‡ªåŠ¨å‘ç°èŠ‚ç‚¹è¿æ¥è¶…æ—¶çš„æ—¶é—´ï¼Œé»˜è®¤ä¸º3ç§’ï¼Œå¦‚æœç½‘ç»œå»¶è¿Ÿé«˜å¯è®¾ç½®å¤§äº›ã€‚</td>
</tr>
<tr>
<td>discovery.zen.minimum_master_nodes</td>
<td>ä¸»ç»“ç‚¹æ•°é‡çš„æœ€å°‘å€¼ ,æ­¤å€¼çš„å…¬å¼ä¸ºï¼š(<code>master_eligible_nodes</code> / 2) + 1 ï¼Œæ¯”å¦‚ï¼šæœ‰3ä¸ªç¬¦åˆè¦æ±‚çš„ä¸»ç»“ç‚¹ï¼Œé‚£ä¹ˆè¿™é‡Œè¦è®¾ç½®ä¸º2ã€‚</td>
</tr>
<tr>
<td>node.max_local_storage_nodes</td>
<td>å•æœºå…è®¸çš„æœ€å¤§å­˜å‚¨ç»“ç‚¹æ•°ï¼Œé€šå¸¸å•æœºå¯åŠ¨ä¸€ä¸ªç»“ç‚¹å»ºè®®è®¾ç½®ä¸º1ï¼Œå¼€å‘ç¯å¢ƒå¦‚æœå•æœºå¯åŠ¨å¤šä¸ªèŠ‚ç‚¹å¯è®¾ç½®å¤§äº1.</td>
</tr>
</tbody></table>
<h4 id="jvm-options"><a href="#jvm-options" class="headerlink" title="jvm.options"></a>jvm.options</h4><p>è®¾ç½®æœ€å°åŠæœ€å¤§çš„JVMå †å†…å­˜å¤§å°ï¼š</p>
<p>åœ¨ <code>jvm.options</code> ä¸­è®¾ç½® <code>-Xms</code> å’Œ <code>-Xmx</code>ï¼š</p>
<p>1ï¼‰ ä¸¤ä¸ªå€¼è®¾ç½®ä¸ºç›¸ç­‰</p>
<p>2ï¼‰ å°† <code>Xmx</code> è®¾ç½®ä¸ºä¸è¶…è¿‡ç‰©ç†å†…å­˜çš„ä¸€åŠã€‚</p>
<h4 id="log4j2-properties"><a href="#log4j2-properties" class="headerlink" title="log4j2.properties"></a>log4j2.properties</h4><p>æ—¥å¿—æ–‡ä»¶è®¾ç½®ï¼ŒESä½¿ç”¨ <code>log4j</code>ï¼Œæ³¨æ„æ—¥å¿—çº§åˆ«çš„é…ç½®ã€‚</p>
<h4 id="ç³»ç»Ÿé…ç½®"><a href="#ç³»ç»Ÿé…ç½®" class="headerlink" title="ç³»ç»Ÿé…ç½®"></a>ç³»ç»Ÿé…ç½®</h4><p>åœ¨<code>linux</code>ä¸Šæ ¹æ®ç³»ç»Ÿèµ„æºæƒ…å†µï¼Œå¯å°†æ¯ä¸ªè¿›ç¨‹æœ€å¤šå…è®¸æ‰“å¼€çš„æ–‡ä»¶æ•°è®¾ç½®å¤§äº›ã€‚</p>
<p><code>su limit -n</code> æŸ¥è¯¢å½“å‰æ–‡ä»¶æ•°</p>
<p>ä½¿ç”¨å‘½ä»¤è®¾ç½® <code>limit</code>:<br>å…ˆåˆ‡æ¢åˆ° <code>root</code>ï¼Œè®¾ç½®å®Œæˆå†åˆ‡å› <code>elasticsearch</code> ç”¨æˆ·ã€‚</p>
<div class="hljs"><pre><code class="hljs c">sudo su 
ulimit â€n <span class="hljs-number">65536</span>
su elasticsearch</code></pre></div>

<p>ä¹Ÿå¯é€šè¿‡ä¸‹è¾¹çš„æ–¹å¼ä¿®æ”¹æ–‡ä»¶è¿›è¡ŒæŒä¹…è®¾ç½®<br><code>/etc/security/limits.conf</code> å°†ä¸‹è¾¹çš„è¡ŒåŠ å…¥æ­¤æ–‡ä»¶ï¼š</p>
<div class="hljs"><pre><code class="hljs angelscript">elasticsearch  â€  nofile  <span class="hljs-number">65536</span></code></pre></div>

<h3 id="3ã€å¯åŠ¨ES"><a href="#3ã€å¯åŠ¨ES" class="headerlink" title="3ã€å¯åŠ¨ES"></a>3ã€å¯åŠ¨ES</h3><p>è¿›å…¥ <code>bin</code> ç›®å½•ï¼Œåœ¨ <code>cmd</code> ä¸‹è¿è¡Œï¼š<code>elasticsearch.bat</code></p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image20" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image20.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æµè§ˆå™¨è¾“å…¥ï¼š<a href="http://localhost:9200/" target="_blank" rel="noopener">http://localhost:9200</a></p>
<p>æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼ˆé…ç½®ä¸åŒå†…å®¹åˆ™ä¸åŒï¼‰è¯´æ˜ <code>ES</code> å¯åŠ¨æˆåŠŸï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
  <span class="hljs-attr">"name"</span> : <span class="hljs-string">"xc_node_1"</span>,
  <span class="hljs-attr">"cluster_name"</span> : <span class="hljs-string">"xuecheng"</span>,
  <span class="hljs-attr">"cluster_uuid"</span> : <span class="hljs-string">"J18wPybJREyx1kjOoH8Tâ€g"</span>,
  <span class="hljs-attr">"version"</span> : &#123;
    <span class="hljs-attr">"number"</span> : <span class="hljs-string">"6.2.1"</span>,
    <span class="hljs-attr">"build_hash"</span> : <span class="hljs-string">"7299dc3"</span>,
    <span class="hljs-attr">"build_date"</span> : <span class="hljs-string">"2018â€02â€07T19:34:26.990113Z"</span>,
    <span class="hljs-attr">"build_snapshot"</span> : <span class="hljs-literal">false</span>,
     <span class="hljs-attr">"lucene_version"</span> : <span class="hljs-string">"7.2.1"</span>,
    <span class="hljs-attr">"minimum_wire_compatibility_version"</span> : <span class="hljs-string">"5.6.0"</span>,
    <span class="hljs-attr">"minimum_index_compatibility_version"</span> : <span class="hljs-string">"5.0.0"</span>
  &#125;,
  <span class="hljs-attr">"tagline"</span> : <span class="hljs-string">"You Know, for Search"</span>
&#125;</code></pre></div>

<h3 id="4ã€å®‰è£…-head-æ’ä»¶"><a href="#4ã€å®‰è£…-head-æ’ä»¶" class="headerlink" title="4ã€å®‰è£… head æ’ä»¶"></a>4ã€å®‰è£… head æ’ä»¶</h3><p><code>head</code> æ’ä»¶æ˜¯ <code>ES</code> çš„ä¸€ä¸ªå¯è§†åŒ–ç®¡ç†æ’ä»¶ï¼Œç”¨æ¥ç›‘è§†ESçš„çŠ¶æ€ï¼Œå¹¶é€šè¿‡ <code>head</code> å®¢æˆ·ç«¯å’Œ <code>ES</code> æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚åˆ›å»ºæ˜ å°„ã€åˆ›å»ºç´¢å¼•ç­‰ï¼Œ<code>head</code> çš„é¡¹ç›®åœ°å€åœ¨ <a href="https://github.com/mobz/elasticsearch-head" target="_blank" rel="noopener">https://github.com/mobz/elasticsearch-head</a></p>
<p>ä»ES6.0 å¼€å§‹ï¼Œ<code>head</code> æ’ä»¶æ”¯æŒä½¿å¾— <code>node.js</code> è¿è¡Œã€‚</p>
<p><strong>1ã€å®‰è£… node.js</strong></p>
<p><strong>2ã€ä¸‹è½½ head å¹¶è¿è¡Œ</strong></p>
<div class="hljs"><pre><code class="hljs shell">git clone git://github.com/mobz/elasticsearch-head.git 
cd elasticsearch-head 
npm install 
npm run start open</code></pre></div>

<p>è®¿é—® <code>http://æœ¬åœ°ä¸»æœº:9100/</code></p>
<p><strong>3ã€è¿è¡Œ</strong></p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image21" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image21.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ‰“å¼€æµè§ˆå™¨è°ƒè¯•å·¥å…·å‘ç°æŠ¥é”™ï¼š</p>
<p>Origin null is not allowed by Access-Control-Allow-Origin.</p>
<p>åŸå› æ˜¯ï¼šheadæ’ä»¶ä½œä¸ºå®¢æˆ·ç«¯è¦è¿æ¥ESæœåŠ¡ï¼ˆlocalhost:9200ï¼‰ï¼Œæ­¤æ—¶å­˜åœ¨è·¨åŸŸé—®é¢˜ï¼Œelasticsearché»˜è®¤ä¸å…è®¸è·¨åŸŸè®¿é—®ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p>è®¾ç½® <code>elasticsearch</code> å…è®¸è·¨åŸŸè®¿é—®</p>
<div class="hljs"><pre><code class="hljs c"># è·¨åŸŸé…ç½®
http.cors.enabled: <span class="hljs-literal">true</span>
http.cors.allow-origin: /.*/</code></pre></div>

<p>è·¨åŸŸè®¿é—®å…è®¸çš„åŸŸååœ°å€ï¼Œ(å…è®¸æ‰€æœ‰åŸŸå) ä»¥ä¸Šä½¿ç”¨æ­£åˆ™ <code>http.cors.allow-origin: /.*/</code></p>
<p>æ³¨æ„ï¼šå°† <code>config/elasticsearch.yml</code> å¦å­˜ä¸ºutf-8ç¼–ç æ ¼å¼ã€‚</p>
<p>æˆåŠŸè¿æ¥ <code>ES</code> ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image22" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image22.png" srcset="/img/loading.gif" alt="img"></a></p>
<h1 id="ä¸‰ã€ES-å¿«é€Ÿå…¥é—¨"><a href="#ä¸‰ã€ES-å¿«é€Ÿå…¥é—¨" class="headerlink" title="ä¸‰ã€ES å¿«é€Ÿå…¥é—¨"></a>ä¸‰ã€ES å¿«é€Ÿå…¥é—¨</h1><p><code>ES</code> ä½œä¸ºä¸€ä¸ªç´¢å¼•åŠæœç´¢æœåŠ¡ï¼Œå¯¹å¤–æä¾›ä¸°å¯Œçš„ <code>REST</code> æ¥å£ï¼Œå¿«é€Ÿå…¥é—¨éƒ¨åˆ†çš„å®ä¾‹ä½¿ç”¨ <code>head</code> æ’ä»¶æ¥æµ‹è¯•ï¼Œç›®çš„æ˜¯å¯¹ <code>ES</code> çš„ä½¿ç”¨æ–¹æ³•åŠæµç¨‹æœ‰ä¸ªåˆæ­¥çš„è®¤è¯†ã€‚</p>
<h2 id="1-åˆ›å»ºç´¢å¼•åº“"><a href="#1-åˆ›å»ºç´¢å¼•åº“" class="headerlink" title="1. åˆ›å»ºç´¢å¼•åº“"></a>1. åˆ›å»ºç´¢å¼•åº“</h2><p><code>ES</code> çš„ç´¢å¼•åº“æ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼Œå®ƒåŒ…æ‹¬äº†åˆ†è¯åˆ—è¡¨åŠæ–‡æ¡£åˆ—è¡¨ï¼ŒåŒä¸€ä¸ªç´¢å¼•åº“ä¸­å­˜å‚¨äº†ç›¸åŒç±»å‹çš„æ–‡æ¡£ã€‚å®ƒå°±ç›¸å½“äº <code>MySQL</code> ä¸­çš„è¡¨ï¼Œæˆ–ç›¸å½“äº <code>Mongodb</code> ä¸­çš„é›†åˆã€‚</p>
<p>å…³äºç´¢å¼•è¿™ä¸ªè¯­ï¼š</p>
<p>ç´¢å¼•ï¼ˆåè¯ï¼‰ï¼š<code>ES</code> æ˜¯åŸºäº <code>Lucene</code> æ„å»ºçš„ä¸€ä¸ªæœç´¢æœåŠ¡ï¼Œå®ƒè¦ä»ç´¢å¼•åº“æœç´¢ç¬¦åˆæ¡ä»¶ç´¢å¼•æ•°æ®ã€‚</p>
<p>ç´¢å¼•ï¼ˆåŠ¨è¯ï¼‰ï¼šç´¢å¼•åº“åˆšåˆ›å»ºèµ·æ¥æ˜¯ç©ºçš„ï¼Œå°†æ•°æ®æ·»åŠ åˆ°ç´¢å¼•åº“çš„è¿‡ç¨‹ç§°ä¸ºç´¢å¼•ã€‚</p>
<p>ä¸‹è¾¹ä»‹ç»ä¸¤ç§åˆ›å»ºç´¢å¼•åº“çš„æ–¹æ³•ï¼Œå®ƒä»¬çš„å·¥ä½œåŸç†æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯å®¢æˆ·ç«¯å‘ <code>ES</code> æœåŠ¡å‘é€å‘½ä»¤ã€‚</p>
<p><strong>1ï¼‰ä½¿ç”¨ postman æˆ– curl è¿™æ ·çš„å·¥å…·åˆ›å»ºï¼š</strong></p>
<p><code>put http://localhost:9200/xc_course</code> ç´¢å¼•åº“åç§°</p>
<div class="hljs"><pre><code class="hljs json">&#123;
  <span class="hljs-attr">"settings"</span>:&#123;
  <span class="hljs-attr">"index"</span>:&#123;
      <span class="hljs-attr">"number_of_shards"</span>:<span class="hljs-number">1</span>,
      <span class="hljs-attr">"number_of_replicas"</span>:<span class="hljs-number">0</span>
   &#125;    
  &#125;
&#125;</code></pre></div>

<p><strong>number_of_shards</strong>ï¼šè®¾ç½®åˆ†ç‰‡çš„æ•°é‡ï¼Œåœ¨é›†ç¾¤ä¸­é€šå¸¸è®¾ç½®å¤šä¸ªåˆ†ç‰‡ï¼Œè¡¨ç¤ºä¸€ä¸ªç´¢å¼•åº“å°†æ‹†åˆ†æˆå¤šç‰‡åˆ†åˆ«å­˜å‚¨ä¸åŒçš„ç»“ç‚¹ï¼Œæé«˜äº† <code>ES</code> çš„å¤„ç†èƒ½åŠ›å’Œé«˜å¯ç”¨æ€§ï¼Œå…¥é—¨ç¨‹åºä½¿ç”¨å•æœºç¯å¢ƒï¼Œè¿™é‡Œè®¾ç½®ä¸º 1ã€‚</p>
<p><strong>number_of_replicas</strong>ï¼šè®¾ç½®å‰¯æœ¬çš„æ•°é‡ï¼Œè®¾ç½®å‰¯æœ¬æ˜¯ä¸ºäº†æé«˜ <code>ES</code> çš„é«˜å¯é æ€§ï¼Œå•æœºç¯å¢ƒè®¾ç½®ä¸º <code>0</code>.</p>
<p>å¦‚ä¸‹æ˜¯åˆ›å»ºçš„ä¾‹å­ï¼Œåˆ›å»º <code>xc_course</code> ç´¢å¼•åº“ï¼Œå…± <code>1</code> ä¸ªåˆ†ç‰‡ï¼Œ<code>0</code> ä¸ªå‰¯æœ¬ï¼š</p>
<p>ä½¿ç”¨ <code>postman</code> å‘é€ put è¯·æ±‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image23" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image23.png" srcset="/img/loading.gif" alt="img"></a></p>
<p><strong>2ï¼‰ä½¿ç”¨headæ’ä»¶åˆ›å»º</strong></p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image24" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image24.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ•ˆæœå¦‚ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image25" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image25.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="2-åˆ›å»ºæ˜ å°„"><a href="#2-åˆ›å»ºæ˜ å°„" class="headerlink" title="2. åˆ›å»ºæ˜ å°„"></a>2. åˆ›å»ºæ˜ å°„</h2><h3 id="1ã€æ¦‚å¿µè¯´æ˜"><a href="#1ã€æ¦‚å¿µè¯´æ˜" class="headerlink" title="1ã€æ¦‚å¿µè¯´æ˜"></a>1ã€æ¦‚å¿µè¯´æ˜</h3><p>åœ¨ç´¢å¼•ä¸­æ¯ä¸ªæ–‡æ¡£éƒ½åŒ…æ‹¬äº†ä¸€ä¸ªæˆ–å¤šä¸ª <code>field</code>ï¼Œåˆ›å»ºæ˜ å°„å°±æ˜¯å‘ç´¢å¼•åº“ä¸­åˆ›å»º <code>field</code> çš„è¿‡ç¨‹ï¼Œä¸‹è¾¹æ˜¯<code>document</code> å’Œ <code>field</code> ä¸å…³ç³»æ•°æ®åº“çš„æ¦‚å¿µçš„ç±»æ¯”ï¼š</p>
<p>æ–‡æ¡£ï¼ˆDocumentï¼‰â€”â€”â€”â€”â€”- <code>Row</code> è®°å½•</p>
<p>å­—æ®µï¼ˆFieldï¼‰â€”â€”â€”â€”â€”â€”- <code>Columns</code> åˆ—</p>
<p>æ³¨æ„ï¼š<code>6.0</code> ä¹‹å‰çš„ç‰ˆæœ¬æœ‰ <code>type</code>ï¼ˆç±»å‹ï¼‰æ¦‚å¿µï¼Œ<code>type</code> ç›¸å½“äºå…³ç³»æ•°æ®åº“çš„è¡¨ï¼Œ<code>ES</code> å®˜æ–¹å°†åœ¨ <code>ES9.0</code> ç‰ˆæœ¬ä¸­å½»åº•åˆ é™¤ <code>type</code>ã€‚</p>
<p>ä¸Šè¾¹è®²çš„åˆ›å»ºç´¢å¼•åº“ç›¸å½“äºå…³ç³»æ•°æ®åº“ä¸­çš„æ•°æ®åº“è¿˜æ˜¯è¡¨ï¼Ÿ</p>
<p>1ã€å¦‚æœç›¸å½“äºæ•°æ®åº“å°±è¡¨ç¤ºä¸€ä¸ªç´¢å¼•åº“å¯ä»¥åˆ›å»ºå¾ˆå¤šä¸åŒç±»å‹çš„æ–‡æ¡£ï¼Œè¿™åœ¨ <code>ES</code> ä¸­ä¹Ÿæ˜¯å…è®¸çš„ã€‚</p>
<p>2ã€å¦‚æœç›¸å½“äºè¡¨å°±è¡¨ç¤ºä¸€ä¸ªç´¢å¼•åº“åªèƒ½å­˜å‚¨ç›¸åŒç±»å‹çš„æ–‡æ¡£ï¼Œ<code>ES</code> å®˜æ–¹å»ºè®® åœ¨ä¸€ä¸ªç´¢å¼•åº“ä¸­åªå­˜å‚¨ç›¸åŒç±»å‹çš„æ–‡æ¡£ã€‚</p>
<h3 id="2ã€åˆ›å»ºæ˜ å°„"><a href="#2ã€åˆ›å»ºæ˜ å°„" class="headerlink" title="2ã€åˆ›å»ºæ˜ å°„"></a>2ã€åˆ›å»ºæ˜ å°„</h3><p>æˆ‘ä»¬è¦æŠŠè¯¾ç¨‹ä¿¡æ¯å­˜å‚¨åˆ° <code>ES</code> ä¸­ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºè¯¾ç¨‹ä¿¡æ¯çš„æ˜ å°„ï¼Œå…ˆæ¥ä¸€ä¸ªç®€å•çš„æ˜ å°„ï¼Œå¦‚ä¸‹ï¼š</p>
<p>å‘é€ï¼špost <code>http://localhost:9200/ç´¢å¼•åº“åç§°/ç±»å‹åç§°/_mapping</code></p>
<p>åˆ›å»ºç±»å‹ä¸º <code>xc_course</code> çš„æ˜ å°„ï¼Œå…±åŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼š<code>name</code>ã€<code>description</code>ã€<code>studymondel</code></p>
<p>ç”±äº <code>ES6.0</code> ç‰ˆæœ¬è¿˜æ²¡æœ‰å°† <code>type</code> å½»åº•åˆ é™¤ï¼Œæ‰€ä»¥æš‚æ—¶æŠŠ <code>type</code> èµ·ä¸€ä¸ªæ²¡æœ‰ç‰¹æ®Šæ„ä¹‰çš„åå­—ã€‚</p>
<p>å‘é€ post è¯·æ±‚ï¼š<a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p>
<blockquote>
<p>åœ¨ <code>xc_course</code> ç´¢å¼•åº“ä¸‹çš„ <code>doc</code> ç±»å‹ä¸‹åˆ›å»ºæ˜ å°„ã€‚<code>doc</code> æ˜¯ç±»å‹åï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œåœ¨ <code>ES6.0</code> ä¸­è¦å¼±åŒ–ç±»å‹çš„æ¦‚å¿µï¼Œç»™å®ƒèµ·ä¸€ä¸ªæ²¡æœ‰å…·ä½“ä¸šåŠ¡æ„ä¹‰çš„åç§°ã€‚</p>
</blockquote>
<p>body</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"properties"</span>: &#123;
        <span class="hljs-attr">"name"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>
        &#125;,
        <span class="hljs-attr">"description"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>
        &#125;,
        <span class="hljs-attr">"studymodel"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<p>æ˜ å°„åˆ›å»ºæˆåŠŸï¼ŒæŸ¥çœ‹ <code>head</code> ç•Œé¢ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image26" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image26.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="3-åˆ›å»ºæ–‡æ¡£"><a href="#3-åˆ›å»ºæ–‡æ¡£" class="headerlink" title="3. åˆ›å»ºæ–‡æ¡£"></a>3. åˆ›å»ºæ–‡æ¡£</h2><p>ESä¸­çš„æ–‡æ¡£ç›¸å½“äºMySQLæ•°æ®åº“è¡¨ä¸­çš„è®°å½•ã€‚</p>
<p>å‘é€ï¼šput æˆ– Post åˆ°<code>http://localhost:9200/xc_course/doc/idå€¼</code>ï¼ˆå¦‚æœä¸æŒ‡å®šidå€¼ESä¼šè‡ªåŠ¨ç”ŸæˆIDï¼‰</p>
<p><a href="http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"name"</span>:<span class="hljs-string">"Bootstrapå¼€å‘æ¡†æ¶"</span>,
    <span class="hljs-attr">"description"</span>:<span class="hljs-string">"Bootstrapæ˜¯ç”±Twitteræ¨å‡ºçš„ä¸€ä¸ªå‰å°é¡µé¢å¼€å‘æ¡†æ¶ï¼Œåœ¨è¡Œä¸šä¹‹ä¸­ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚æ­¤å¼€å‘æ¡†æ¶åŒ…å«äº†å¤§é‡çš„CSSã€JSç¨‹åºä»£ç ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯ä¸æ“…é•¿é¡µé¢å¼€å‘çš„ç¨‹åºäººå‘˜ï¼‰è½»æ¾çš„å®ç°ä¸€ä¸ªä¸å—æµè§ˆå™¨é™åˆ¶çš„ç²¾ç¾ç•Œé¢æ•ˆæœã€‚"</span>,
    <span class="hljs-attr">"studymodel"</span>:<span class="hljs-string">"201001"</span>
&#125;</code></pre></div>

<p>ä½¿ç”¨ <code>postman</code> æµ‹è¯•ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image27" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image27.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>é€šè¿‡ <code>head</code> æŸ¥è¯¢æ•°æ®ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image28" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image28.png" srcset="/img/loading.gif" alt="img"></a></p>
<h2 id="4-æœç´¢æ–‡æ¡£"><a href="#4-æœç´¢æ–‡æ¡£" class="headerlink" title="4. æœç´¢æ–‡æ¡£"></a>4. æœç´¢æ–‡æ¡£</h2><p>1ã€æ ¹æ®è¯¾ç¨‹idæŸ¥è¯¢æ–‡æ¡£<br>å‘é€ï¼šget <a href="http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000</a></p>
<p>ä½¿ç”¨ <code>postman</code> æµ‹è¯•ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image29" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image29.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>2ã€æŸ¥è¯¢æ‰€æœ‰è®°å½•</p>
<p>å‘é€ get <a href="http://localhost:9200/xc_course/doc/_search" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search</a></p>
<p>3ã€æŸ¥è¯¢åç§°ä¸­åŒ…æ‹¬ <code>bootstrap</code> å…³é”®å­—çš„çš„è®°å½•<br>å‘é€ï¼šget <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:9200/xc_course/doc/_search?q=name:bootstrap</p>
<p>4ã€æŸ¥è¯¢å­¦ä¹ æ¨¡å¼ä¸º <code>201001</code> çš„è®°å½•<br>å‘é€ get <a href="http://localhost:9200/xc_course/doc/_search?q=studymodel:201001" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_search?q=studymodel:201001</a></p>
<h3 id="æŸ¥è¯¢ç»“æœåˆ†æ"><a href="#æŸ¥è¯¢ç»“æœåˆ†æ" class="headerlink" title="æŸ¥è¯¢ç»“æœåˆ†æ"></a>æŸ¥è¯¢ç»“æœåˆ†æ</h3><p>åˆ†æä¸Šè¾¹æŸ¥è¯¢ç»“æœï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"took"</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">"timed_out"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"_shards"</span>: &#123;
        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"successful"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"skipped"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"failed"</span>: <span class="hljs-number">0</span>
    &#125;,
    <span class="hljs-attr">"hits"</span>: &#123;
        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"max_score"</span>: <span class="hljs-number">0.2876821</span>,
        <span class="hljs-attr">"hits"</span>: [
            &#123;
                <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course"</span>,
                <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"4028e58161bcf7f40161bcf8b77c0000"</span>,
                <span class="hljs-attr">"_score"</span>: <span class="hljs-number">0.2876821</span>,
                <span class="hljs-attr">"_source"</span>: &#123;
                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bootstrapå¼€å‘æ¡†æ¶"</span>,
                    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Bootstrapæ˜¯ç”±Twitteræ¨å‡ºçš„ä¸€ä¸ªå‰å°é¡µé¢å¼€å‘æ¡†æ¶ï¼Œåœ¨è¡Œä¸šä¹‹ä¸­ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚æ­¤å¼€å‘æ¡†æ¶åŒ…å«äº†å¤§é‡çš„CSSã€JSç¨‹åºä»£ç ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯ä¸æ“…é•¿é¡µé¢å¼€å‘çš„ç¨‹åºäººå‘˜ï¼‰è½»æ¾çš„å®ç°ä¸€ä¸ªä¸å—æµè§ˆå™¨é™åˆ¶çš„ç²¾ç¾ç•Œé¢æ•ˆæœã€‚"</span>,
                    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>
                &#125;
            &#125;
        ]
    &#125;
&#125;</code></pre></div>

<table>
<thead>
<tr>
<th>å­—æ®µåç§°</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td>took</td>
<td>æœ¬æ¬¡æ“ä½œèŠ±è´¹çš„æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚</td>
</tr>
<tr>
<td>timed_out</td>
<td>è¯·æ±‚æ˜¯å¦è¶…æ—¶</td>
</tr>
<tr>
<td>_shards</td>
<td>è¯´æ˜æœ¬æ¬¡æ“ä½œå…±æœç´¢äº†å“ªäº›åˆ†ç‰‡</td>
</tr>
<tr>
<td>hits</td>
<td>æœç´¢å‘½ä¸­çš„è®°å½•</td>
</tr>
<tr>
<td>hits.total</td>
<td>ç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£æ€»æ•° <code>hits.hits</code> ï¼šåŒ¹é…åº¦è¾ƒé«˜çš„å‰Nä¸ªæ–‡æ¡£</td>
</tr>
<tr>
<td>hits.max_score</td>
<td>æ–‡æ¡£åŒ¹é…å¾—åˆ†ï¼Œè¿™é‡Œä¸ºæœ€é«˜åˆ†</td>
</tr>
<tr>
<td>_score</td>
<td>æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ªåŒ¹é…åº¦å¾—åˆ†ï¼ŒæŒ‰ç…§é™åºæ’åˆ—ã€‚</td>
</tr>
<tr>
<td>_source</td>
<td>æ˜¾ç¤ºäº†æ–‡æ¡£çš„åŸå§‹å†…å®¹ã€‚</td>
</tr>
</tbody></table>
<h1 id="å››ã€IKåˆ†è¯å™¨"><a href="#å››ã€IKåˆ†è¯å™¨" class="headerlink" title="å››ã€IKåˆ†è¯å™¨"></a>å››ã€IKåˆ†è¯å™¨</h1><h2 id="1-æµ‹è¯•ESé»˜è®¤çš„åˆ†è¯å™¨"><a href="#1-æµ‹è¯•ESé»˜è®¤çš„åˆ†è¯å™¨" class="headerlink" title="1. æµ‹è¯•ESé»˜è®¤çš„åˆ†è¯å™¨"></a>1. æµ‹è¯•ESé»˜è®¤çš„åˆ†è¯å™¨</h2><p>åœ¨æ·»åŠ æ–‡æ¡£æ—¶ä¼šè¿›è¡Œåˆ†è¯ï¼Œç´¢å¼•ä¸­å­˜æ”¾çš„å°±æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„è¯ï¼ˆtermï¼‰ï¼Œå½“ä½ å»æœç´¢æ—¶å°±æ˜¯æ‹¿å…³é”®å­—å»åŒ¹é…è¯ï¼Œæœ€ç»ˆæ‰¾åˆ°è¯å…³è”çš„æ–‡æ¡£ã€‚</p>
<p>æµ‹è¯•å½“å‰ç´¢å¼•åº“ä½¿ç”¨çš„åˆ†è¯å™¨ï¼š</p>
<p>POST è¯·æ±‚ï¼š<a href="http://localhost:9200/_analyze" target="_blank" rel="noopener">http://localhost:9200/_analyze</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"text"</span>:<span class="hljs-string">"åˆ†è¯å™¨"</span>&#125;</code></pre></div>

<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"tokens"</span>: [
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"åˆ†"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"è¯"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"å™¨"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"&lt;IDEOGRAPHIC&gt;"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">2</span>
        &#125;
    ]
&#125;</code></pre></div>

<p>ä»å“åº”çš„ç»“æœæ¥çœ‹ï¼Œ<code>ES</code> çš„é»˜è®¤åˆ†è¯å™¨ä¼šå°†æˆ‘ä»¬æäº¤çš„å†…å®¹ä¸­çš„æ¯ä¸€ä¸ªè¯è¿›è¡Œåˆ†å‰²ï¼Œè¿™æ ·æ˜¾ç„¶ä¸å¤Ÿæ™ºèƒ½ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>IK</code> åˆ†è¯å™¨ã€‚</p>
<h2 id="2-å®‰è£…IKåˆ†è¯å™¨"><a href="#2-å®‰è£…IKåˆ†è¯å™¨" class="headerlink" title="2. å®‰è£…IKåˆ†è¯å™¨"></a>2. å®‰è£…IKåˆ†è¯å™¨</h2><p>ä½¿ç”¨IKåˆ†è¯å™¨å¯ä»¥å®ç°å¯¹ä¸­æ–‡åˆ†è¯çš„æ•ˆæœã€‚<br>ä¸‹è½½IKåˆ†è¯å™¨ï¼šï¼ˆGithubåœ°å€ï¼š<a href="https://github.com/medcl/elasticsearch-analysis-ik%EF%BC%89" target="_blank" rel="noopener">https://github.com/medcl/elasticsearch-analysis-ikï¼‰</a></p>
<blockquote>
<p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼ŒIKåˆ†è¯å™¨çš„ç‰ˆæœ¬çš„ESçš„ç‰ˆæœ¬çš„ç›¸å¯¹åº”çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬ ES çš„ç‰ˆæœ¬ç”¨çš„æ˜¯ v6.8.8 é‚£ä¹ˆIKåˆ†è¯å™¨çš„ç‰ˆæœ¬ä¹Ÿè¦å¯¹åº”ä½¿ç”¨ v6.8.8ã€‚</p>
</blockquote>
<p>è§£å‹ï¼Œå¹¶å°†è§£å‹çš„æ–‡ä»¶æ‹·è´åˆ° <code>ES</code> å®‰è£…ç›®å½•çš„ <code>plugins</code> ä¸‹çš„ikç›®å½•ä¸‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image30" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image30.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æµ‹è¯•åˆ†è¯æ•ˆæœï¼š</p>
<p>POSTè¯·æ±‚ï¼š <a href="http://localhost:9200/_analyze" target="_blank" rel="noopener">http://localhost:9200/_analyze</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"text"</span>:<span class="hljs-string">"æµ‹è¯•åˆ†è¯å™¨ï¼Œåè¾¹æ˜¯æµ‹è¯•å†…å®¹ï¼šspringcloudå®æˆ˜"</span>,<span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span>&#125;</code></pre></div>

<p>è¯·æ±‚ç»“æœ</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"tokens"</span>: [
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æµ‹è¯•"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"åˆ†è¯å™¨"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">5</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"åˆ†è¯"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">4</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">2</span>
        &#125;,
		<span class="hljs-comment">//...çœç•¥ä¸€éƒ¨åˆ†ç»“æœ</span>
    ]
&#125;</code></pre></div>

<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåœ¨æˆ‘ä»¬å¼•å…¥ IK æ’ä»¶ä¹‹åï¼Œåˆ†è¯å™¨èƒ½è¯†åˆ«å‡ºæˆ‘ä»¬æäº¤çš„å†…å®¹ä¸­çš„è¯è¯­ï¼Œç»†å¿ƒçš„è€é“ä¼šæ³¨æ„åˆ°æˆ‘ä»¬åœ¨ <code>analyzer</code> å­—æ®µä¸­å¼•å…¥äº† <code>ik_max_word</code> ï¼Œè¿™æ˜¯ <code>IK</code> æ’ä»¶ä¸­çš„ä¸€ä¸ªåˆ†è¯æ¨¡å¼ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä»”ç»†ä»‹ç»ä¸€ä¸‹ <code>IK</code> æ’ä»¶ä¸­çš„å‡ ç§åˆ†è¯æ¨¡å¼ã€‚</p>
<h2 id="3-ä¸¤ç§åˆ†è¯æ¨¡å¼"><a href="#3-ä¸¤ç§åˆ†è¯æ¨¡å¼" class="headerlink" title="3. ä¸¤ç§åˆ†è¯æ¨¡å¼"></a>3. ä¸¤ç§åˆ†è¯æ¨¡å¼</h2><p>ikåˆ†è¯å™¨æœ‰ä¸¤ç§åˆ†è¯æ¨¡å¼ï¼š<code>ik_max_word</code> å’Œ <code>ik_smart</code> æ¨¡å¼ï¼Œä¸‹é¢æˆ‘ä»¬æ¥æµ‹è¯•è¿™ä¸¤ç§æ¨¡å¼ã€‚</p>
<p><strong>1ã€ik_max_word</strong></p>
<p>ä¼šå°†æ–‡æœ¬åšæœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°† â€œ<strong>ä¸­åäººæ°‘å…±å’Œå›½äººæ°‘å¤§ä¼šå ‚</strong> â€ æ‹†åˆ†ä¸ºâ€œ <strong>ä¸­åäººæ°‘å…±å’Œå›½</strong>ã€<strong>ä¸­åäººæ°‘</strong>ã€<strong>ä¸­å</strong>ã€<strong>åäºº</strong>ã€<strong>äººæ°‘å…±å’Œå›½</strong>ã€<strong>äººæ°‘</strong>ã€<strong>å…±å’Œå›½</strong>ã€<strong>å¤§ä¼šå ‚</strong>ã€<strong>å¤§ä¼š</strong>ã€<strong>ä¼šå ‚ç­‰è¯è¯­</strong>ã€‚</p>
<p>å‘é€ <code>post</code> è¯·æ±‚ï¼š <a href="http://localhost:9200/_analyze" target="_blank" rel="noopener">http://localhost:9200/_analyze</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"text"</span>:<span class="hljs-string">"ä¸­åäººæ°‘å…±å’Œå›½äººæ°‘å¤§ä¼šå ‚"</span>,<span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span>&#125;</code></pre></div>

<p>è¯·æ±‚ç»“æœ</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"tokens"</span>: [
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"ä¸­åäººæ°‘å…±å’Œå›½"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">7</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"ä¸­åäººæ°‘"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">4</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"ä¸­å"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">2</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"åäºº"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">3</span>
        &#125;,
        <span class="hljs-comment">//çœç•¥éƒ¨åˆ†ç»“æœ...</span>
    ]
&#125;</code></pre></div>

<p><strong>2ã€ik_smart</strong></p>
<p>ä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼Œæ¯”å¦‚ä¼šå°† â€œ<strong>ä¸­åäººæ°‘å…±å’Œå›½äººæ°‘å¤§ä¼šå ‚</strong>â€ æ‹†åˆ†ä¸º <strong>ä¸­åäººæ°‘å…±å’Œå›½</strong>ã€<strong>äººæ°‘å¤§ä¼šå ‚</strong>ã€‚</p>
<div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"text"</span>:<span class="hljs-string">"ä¸­åäººæ°‘å…±å’Œå›½äººæ°‘å¤§ä¼šå ‚"</span>,<span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_smart"</span>&#125;</code></pre></div>

<p>è¯·æ±‚ç»“æœ</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"tokens"</span>: [
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"ä¸­åäººæ°‘å…±å’Œå›½"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">7</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"äººæ°‘å¤§ä¼šå ‚"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">7</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">12</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>
        &#125;
    ]
&#125;</code></pre></div>

<h2 id="4-è‡ªå®šä¹‰è¯åº“"><a href="#4-è‡ªå®šä¹‰è¯åº“" class="headerlink" title="4. è‡ªå®šä¹‰è¯åº“"></a>4. è‡ªå®šä¹‰è¯åº“</h2><p>å¦‚æœè¦è®©åˆ†è¯å™¨æ”¯æŒä¸€äº›ä¸“æœ‰è¯è¯­ï¼Œå¯ä»¥è‡ªå®šä¹‰è¯åº“ã€‚<br><code>iK</code> åˆ†è¯å™¨è‡ªå¸¦ä¸€ä¸ª <code>main.dic</code> çš„æ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶ä¸ºè¯åº“æ–‡ä»¶ã€‚</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image31" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image31.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æˆ‘ä»¬åœ¨ä¸Šè¾¹çš„ç›®å½•ä¸­æ–°å»ºä¸€ä¸ª <code>my.dic</code> æ–‡ä»¶ï¼ˆæ³¨æ„æ–‡ä»¶æ ¼å¼ä¸º <code>utf-8</code>ï¼Œä¸è¦é€‰æ‹©<code>utf-8 BOM</code>ï¼‰<br>å¯ä»¥åœ¨å…¶ä¸­è‡ªå®šä¹‰è¯æ±‡</p>
<p>å®šä¹‰ <code>my.dic</code> , ä»¥æ¯è¡Œä¸ºå•ä½</p>
<div class="hljs"><pre><code class="hljs plain">æ¡‚åŒ—æ±‡</code></pre></div>

<p>ç¼–è¾‘ <code>config</code> ä¸­çš„é…ç½®æ–‡ä»¶ <code>IKAnalyzer.cfg.xml</code> ä¸­é…ç½® <code>my.dic</code></p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">properties</span> <span class="hljs-meta-keyword">SYSTEM</span> <span class="hljs-meta-string">"http://java.sun.com/dtd/properties.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>IK Analyzer æ‰©å±•é…ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span>
	<span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ext_dict"</span>&gt;</span>my.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>
	 <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ext_stopwords"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>
	<span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•å­—å…¸ --&gt;</span>
	<span class="hljs-comment">&lt;!-- &lt;entry key="remote_ext_dict"&gt;words_location&lt;/entry&gt; --&gt;</span>
	<span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span>
	<span class="hljs-comment">&lt;!-- &lt;entry key="remote_ext_stopwords"&gt;words_location&lt;/entry&gt; --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span></code></pre></div>

<p>åœ¨é€‚è‡ªå®šä¹‰é…ç½®ç”Ÿæ•ˆä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹æœªè‡ªå®šä¹‰ä¹‹å‰çš„æ•ˆæœ</p>
<p>å‘é€ï¼špost <a href="http://localhost:9200/_analyze" target="_blank" rel="noopener">http://localhost:9200/_analyze</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;<span class="hljs-attr">"text"</span>:<span class="hljs-string">"æ¡‚åŒ—æ±‡"</span>, <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span> &#125;</code></pre></div>

<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"tokens"</span>: [
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æ¡‚åŒ—"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æ±‡"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_CHAR"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>
        &#125;
    ]
&#125;</code></pre></div>

<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è‡ªå®šä¹‰çš„åˆ†è¯æœªç”Ÿæ•ˆä¹‹å‰ï¼ŒESè¿˜æ˜¯å°†æˆ‘ä»¬çš„æäº¤çš„ â€œæ¡‚åŒ—æ±‡â€ æ‹†åˆ†äº†ï¼Œå› ä¸ºå¸¸ç”¨çš„è¯è¯­ç»„åˆã€‚</p>
<p>æˆ‘ä»¬é‡å¯ <code>ES</code>ï¼Œä½¿åˆšæ‰ä¿®æ”¹çš„è‡ªå®šä¹‰é…ç½®ç”Ÿæ•ˆå†æ¬¡æµ‹è¯•åˆ†è¯æ•ˆæœï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"tokens"</span>: [
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æ¡‚åŒ—æ±‡"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æ¡‚åŒ—"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_WORD"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">1</span>
        &#125;,
        &#123;
            <span class="hljs-attr">"token"</span>: <span class="hljs-string">"æ±‡"</span>,
            <span class="hljs-attr">"start_offset"</span>: <span class="hljs-number">2</span>,
            <span class="hljs-attr">"end_offset"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CN_CHAR"</span>,
            <span class="hljs-attr">"position"</span>: <span class="hljs-number">2</span>
        &#125;
    ]
&#125;</code></pre></div>

<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬åœ¨ <code>my.dic</code> ä¸­æ·»åŠ çš„ â€œæ¡‚åŒ—æ±‡â€ åˆ†è¯è¢«è¯†åˆ«å‡ºæ¥äº†ï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>ik_max_word</code> åˆ†è¯æ¨¡å¼ï¼Œæ‰€ä»¥ <code>ES</code> çš„ <code>IK</code> æ’ä»¶ä¼šè¿›è¡Œæ›´ <strong>ç»†ç²’åº¦</strong> çš„è¯†åˆ«ã€‚</p>
<h1 id="äº”ã€æ˜ å°„"><a href="#äº”ã€æ˜ å°„" class="headerlink" title="äº”ã€æ˜ å°„"></a>äº”ã€æ˜ å°„</h1><p>ä¸Šè¾¹ç« èŠ‚å®‰è£…äº† <code>ik</code> åˆ†è¯å™¨ï¼Œå¦‚æœåœ¨ç´¢å¼•å’Œæœç´¢æ—¶å»ä½¿ç”¨ <code>ik</code> åˆ†è¯å™¨å‘¢ï¼Ÿå¦‚ä½•æŒ‡å®šå…¶å®ƒç±»å‹çš„ <code>field</code>ï¼Œæ¯”å¦‚æ—¥æœŸç±»å‹ã€æ•°å€¼ç±»å‹ç­‰ã€‚æœ¬ç« èŠ‚å­¦ä¹ å„ç§æ˜ å°„ç±»å‹åŠæ˜ å°„ç»´æŠ¤æ–¹æ³•ã€‚</p>
<h2 id="1-æ˜ å°„ç»´æŠ¤æ–¹æ³•"><a href="#1-æ˜ å°„ç»´æŠ¤æ–¹æ³•" class="headerlink" title="1. æ˜ å°„ç»´æŠ¤æ–¹æ³•"></a>1. æ˜ å°„ç»´æŠ¤æ–¹æ³•</h2><p>1ã€æŸ¥è¯¢æ‰€æœ‰ç´¢å¼•çš„æ˜ å°„</p>
<p>GET è¯·æ±‚ï¼š <a href="http://localhost:9200/_mapping" target="_blank" rel="noopener">http://localhost:9200/_mapping</a></p>
<p>2ã€åˆ›å»ºæ˜ å°„</p>
<p>POST è¯·æ±‚ï¼š<a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"properties"</span>: &#123;
        <span class="hljs-attr">"name"</span>: &#123;
        	<span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>
        &#125;,
        <span class="hljs-attr">"description"</span>: &#123;
        	<span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>
        &#125;,
        <span class="hljs-attr">"studymodel"</span>: &#123;
        	<span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<p>è¿™é‡Œè¦æ³¨æ„å¾—æ˜¯ï¼Œæ˜ å°„åªèƒ½ <strong>åˆ›å»º</strong>ï¼Œä¸èƒ½åˆ é™¤ï¼Œä»¥åŠç±»å‹ä¹Ÿä¸èƒ½ä¿®æ”¹ï¼Œå› ä¸ºå¦‚æœè¿™ä¸ªæ˜ å°„ä¸€æ—¦åˆ›å»ºåï¼Œä½ å¯èƒ½ä¼šå…³è”äº†å¤§é‡çš„æ•°æ®ï¼Œæ‰€ä»¥ä¿®æ”¹æ˜¯ä¸å¯å–çš„ã€‚</p>
<h2 id="2-å¸¸ç”¨æ˜ å°„ç±»å‹"><a href="#2-å¸¸ç”¨æ˜ å°„ç±»å‹" class="headerlink" title="2. å¸¸ç”¨æ˜ å°„ç±»å‹"></a>2. å¸¸ç”¨æ˜ å°„ç±»å‹</h2><p>ä¸‹å›¾æ˜¯ES6.2æ ¸å¿ƒçš„å­—æ®µç±»å‹å¦‚ä¸‹ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image32" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image32.png" srcset="/img/loading.gif" alt="img"></a></p>
<h3 id="1ã€text-æ–‡æœ¬å­—æ®µ"><a href="#1ã€text-æ–‡æœ¬å­—æ®µ" class="headerlink" title="1ã€text æ–‡æœ¬å­—æ®µ"></a>1ã€text æ–‡æœ¬å­—æ®µ</h3><p>å­—ç¬¦ä¸²åŒ…æ‹¬ <code>text</code> å’Œ <code>keyword</code> ä¸¤ç§ç±»å‹</p>
<p><strong>analyzer å±æ€§</strong></p>
<p>é€šè¿‡ <code>analyzer</code> å±æ€§æŒ‡å®šåˆ†è¯å™¨ã€‚</p>
<p>ä¸‹è¾¹æŒ‡å®š <code>name</code> çš„å­—æ®µç±»å‹ä¸º <code>text</code>ï¼Œä½¿ç”¨ <code>ik</code> åˆ†è¯å™¨çš„ <code>ik_max_word</code> åˆ†è¯æ¨¡å¼ã€‚</p>
<div class="hljs"><pre><code class="hljs json">"name": &#123;
    "type": "text",
    "analyzer":"ik_max_word"
&#125;</code></pre></div>

<p>ä¸Šè¾¹æŒ‡å®šäº† <code>analyzer</code> æ˜¯æŒ‡åœ¨ç´¢å¼•å’Œæœç´¢éƒ½ä½¿ç”¨ <code>ik_max_word</code>ï¼Œå¦‚æœå•ç‹¬æƒ³å®šä¹‰æœç´¢æ—¶ä½¿ç”¨çš„åˆ†è¯å™¨åˆ™å¯ä»¥é€šè¿‡<br><code>search_analyzer</code> å±æ€§ã€‚å¯¹äº <code>ik</code> åˆ†è¯å™¨å»ºè®®æ˜¯ç´¢å¼•æ—¶ä½¿ç”¨ <code>ik_max_word</code> å°†æœç´¢å†…å®¹è¿›è¡Œç»†ç²’åº¦åˆ†è¯ï¼Œæœç´¢æ—¶ä½¿ç”¨ <code>ik_smart</code> æé«˜æœç´¢ç²¾ç¡®æ€§ ã€‚</p>
<div class="hljs"><pre><code class="hljs json">"name": &#123;
    "type": "text",
    "analyzer":"ik_max_word",
    "search_analyzer":"ik_smart"
&#125;</code></pre></div>

<p><strong>index å±æ€§</strong></p>
<p>é€šè¿‡ <code>index</code> å±æ€§æŒ‡å®šæ˜¯å¦ç´¢å¼•ã€‚</p>
<p>é»˜è®¤ä¸º <code>index=true</code>ï¼Œå³è¦è¿›è¡Œç´¢å¼•ï¼Œåªæœ‰è¿›è¡Œç´¢å¼•æ‰å¯ä»¥ä»ç´¢å¼•åº“æœç´¢åˆ°ã€‚</p>
<p>ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›å†…å®¹ä¸éœ€è¦ç´¢å¼•ï¼Œæ¯”å¦‚ï¼šå•†å“å›¾ç‰‡åœ°å€åªè¢«ç”¨æ¥å±•ç¤ºå›¾ç‰‡ï¼Œä¸è¿›è¡Œæœç´¢å›¾ç‰‡ï¼Œæ­¤æ—¶å¯ä»¥å°† <code>index</code>è®¾ç½®ä¸º <code>false</code>ã€‚åˆ é™¤ç´¢å¼•ï¼Œé‡æ–°åˆ›å»ºæ˜ å°„ï¼Œå°† <code>pic</code> çš„ <code>index</code> è®¾ç½®ä¸º <code>false</code>ï¼Œå°è¯•æ ¹æ® <code>pic</code> å»æœç´¢ï¼Œç»“æœæœç´¢ä¸åˆ°æ•°æ®</p>
<div class="hljs"><pre><code class="hljs json">"pic": &#123;
    "type": "text",
    "index":false
&#125;</code></pre></div>

<p><strong>store å±æ€§</strong></p>
<p>æ˜¯å¦åœ¨ <code>source</code> ä¹‹å¤–å­˜å‚¨ï¼Œæ¯ä¸ªæ–‡æ¡£ç´¢å¼•åä¼šåœ¨ <code>ES</code> ä¸­ä¿å­˜ä¸€ä»½åŸå§‹æ–‡æ¡£ï¼Œå­˜æ”¾åœ¨ <code>_source</code> ä¸­ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦è®¾ç½® <code>store</code> ä¸º <code>true</code>ï¼Œå› ä¸ºåœ¨ <code>source</code> ä¸­å·²ç»æœ‰ä¸€ä»½åŸå§‹æ–‡æ¡£äº†ã€‚</p>
<h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>åˆ é™¤ <code>xc_course/doc</code> ä¸‹çš„æ˜ å°„ ï¼Œå‘é€ DELETE è¯·æ±‚åˆ° <code>http://10.1.1.168:9200/xc_course</code></p>
<p>åˆ›å»ºï¼Œå‘é€PUTè¯·æ±‚ <code>http://localhost:9200/xc_course</code> ç´¢å¼•åº“åç§°</p>
<div class="hljs"><pre><code class="hljs json">&#123;
  <span class="hljs-attr">"settings"</span>:&#123;
  <span class="hljs-attr">"index"</span>:&#123;
      <span class="hljs-attr">"number_of_shards"</span>:<span class="hljs-number">1</span>,
      <span class="hljs-attr">"number_of_replicas"</span>:<span class="hljs-number">0</span>
   &#125;    
  &#125;
&#125;</code></pre></div>

<p>åˆ›å»ºæ–°æ˜ å°„ï¼šPOST <a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"properties"</span>: &#123;
        <span class="hljs-attr">"name"</span>: &#123;
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
        <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span>,
        <span class="hljs-attr">"search_analyzer"</span>:<span class="hljs-string">"ik_smart"</span>
    &#125;,
    <span class="hljs-attr">"description"</span>: &#123;
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
        <span class="hljs-attr">"analyzer"</span>:<span class="hljs-string">"ik_max_word"</span>,
        <span class="hljs-attr">"search_analyzer"</span>:<span class="hljs-string">"ik_smart"</span>
    &#125;,
    <span class="hljs-attr">"pic"</span>:&#123;
        <span class="hljs-attr">"type"</span>:<span class="hljs-string">"text"</span>,
        <span class="hljs-attr">"index"</span>:<span class="hljs-literal">false</span>
    &#125;,
    <span class="hljs-attr">"studymodel"</span>:&#123;
        <span class="hljs-attr">"type"</span>:<span class="hljs-string">"text"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<p>æ’å…¥æ–‡æ¡£ï¼š</p>
<p>POST <a href="http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/4028e58161bcf7f40161bcf8b77c0000</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"name"</span>:<span class="hljs-string">"Bootstrapå¼€å‘æ¡†æ¶"</span>,
    <span class="hljs-attr">"description"</span>:<span class="hljs-string">"Bootstrapæ˜¯ç”±Twitteræ¨å‡ºçš„ä¸€ä¸ªå‰å°é¡µé¢å¼€å‘æ¡†æ¶ï¼Œåœ¨è¡Œä¸šä¹‹ä¸­ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›ã€‚æ­¤å¼€å‘æ¡†æ¶åŒ…å«äº†å¤§é‡çš„CSSã€JSç¨‹åºä»£ç ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯ä¸æ“…é•¿é¡µé¢å¼€å‘çš„ç¨‹åºäººå‘˜ï¼‰è½»æ¾çš„å®ç°ä¸€ä¸ªä¸å—æµè§ˆå™¨é™åˆ¶çš„ç²¾ç¾ç•Œé¢æ•ˆæœã€‚"</span>,
    <span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/01/wKhlQFqO4MmAOP53AAAcwDwm6SU490.jpg"</span>,
    <span class="hljs-attr">"studymodel"</span>:<span class="hljs-string">"201002"</span>
&#125;</code></pre></div>

<p><strong>æŸ¥è¯¢æµ‹è¯•ï¼š</strong></p>
<p>GETè¯·æ±‚ï¼š <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:9200/xc_course/_search?q=name:å¼€å‘</p>
<p>æŸ¥è¯¢ç»“æœï¼šè·å–åˆ° <code>name</code> ä¸­åŒ…å« â€œå¼€å‘â€ çš„æ–‡æ¡£</p>
<p>GETè¯·æ±‚ï¼š <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:9200/xc_course/_search?q=description:å¼€å‘</p>
<p>æŸ¥è¯¢ç»“æœï¼šè·å–åˆ° <code>description</code> ä¸­åŒ…å« â€œå¼€å‘â€ çš„æ–‡æ¡£</p>
<p>GETè¯·æ±‚ï¼š <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:9200/xc_course/_search?q=pic:group1/M00/00/01/wKhlQFqO4MmAOP53AAAcwDwm6SU490.jpg</p>
<p>æŸ¥è¯¢ç»“æœï¼šç”±äºå‰é¢ <code>pic</code> å­—æ®µ è®¾ç½®äº† <code>index</code> å±æ€§ä¸º <code>false</code></p>
<p>GETè¯·æ±‚ï¼š <a href="http://localhost:9200/xc_course/_search?q=studymodel:201002" target="_blank" rel="noopener">http://localhost:9200/xc_course/_search?q=studymodel:201002</a></p>
<p>æŸ¥è¯¢ç»“æœ: ç”±äºæ²¡æœ‰ä¸º <code>studymodel</code> å­—æ®µä½¿ç”¨çš„æ˜¯é»˜è®¤çš„åˆ†è¯å™¨ï¼Œé»˜è®¤åˆ†è¯å™¨ä¼šå°†æˆ‘ä»¬å‰é¢æ’å…¥çš„ â€œ<code>201002</code>â€ ç´¢å¼•ä¸ºä¸€ä¸ªè¯ï¼Œæ‰€ä»¥éœ€è¦å…¨éƒ¨åŒ¹é…æ‰èƒ½æœç´¢åˆ°ã€‚</p>
<p>é€šè¿‡æµ‹è¯•å‘ç°ï¼š<code>name</code> å’Œ <code>description</code> éƒ½æ”¯æŒå…¨æ–‡æ£€ç´¢ï¼Œ<code>pic</code> ä¸å¯ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€‚</p>
<h3 id="2ã€keyword-å…³é”®è¯å­—æ®µ"><a href="#2ã€keyword-å…³é”®è¯å­—æ®µ" class="headerlink" title="2ã€keyword å…³é”®è¯å­—æ®µ"></a>2ã€keyword å…³é”®è¯å­—æ®µ</h3><p>ä¸Šè¾¹ä»‹ç»çš„ <code>text</code> æ–‡æœ¬å­—æ®µåœ¨æ˜ å°„æ—¶è¦è®¾ç½®åˆ†è¯å™¨ï¼Œ<code>keyword</code> å­—æ®µä¸ºå…³é”®å­—å­—æ®µï¼Œé€šå¸¸æœç´¢ <code>keyword</code> æ˜¯æŒ‰ç…§æ•´ä½“æœç´¢ï¼Œæ‰€ä»¥åˆ›å»º <code>keyword</code> å­—æ®µçš„ç´¢å¼•æ—¶æ˜¯ä¸è¿›è¡Œåˆ†è¯çš„ï¼Œæ¯”å¦‚ï¼šé‚®æ”¿ç¼–ç ã€æ‰‹æœºå·ç ã€èº«ä»½è¯ç­‰ã€‚<code>keyword</code> å­—æ®µé€šå¸¸ç”¨äºè¿‡è™‘ã€æ’åºã€èšåˆç­‰ã€‚</p>
<h4 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>åˆ›å»ºä¸€ä¸ªæ–°çš„ç´¢å¼•åº“è¿›è¡Œæµ‹è¯•ï¼Œæˆ–è€…åˆ é™¤åŸæ¥çš„ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„</p>
<p>1ã€åˆ›å»ºç´¢å¼•åº“ <code>xc_course2</code></p>
<p>PUT <a href="http://10.1.1.168:9200/xc_course2" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course2</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
  <span class="hljs-attr">"settings"</span>:&#123;
  <span class="hljs-attr">"index"</span>:&#123;
      <span class="hljs-attr">"number_of_shards"</span>:<span class="hljs-number">1</span>,
      <span class="hljs-attr">"number_of_replicas"</span>:<span class="hljs-number">0</span>
   &#125;    
  &#125;
&#125;</code></pre></div>

<p>2ã€åˆ›å»ºæ˜ å°„</p>
<p>è¿™é‡Œæˆ‘ä»¬å°† <code>name</code> å’Œ <code>studymodel</code> è¿™ä¸¤ä¸ªå­—æ®µçš„ <code>type</code> è®¾ç½®ä¸º <code>keyword</code></p>
<p>POST <a href="http://10.1.1.168:9200/xc_course2/doc/_mapping" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course2/doc/_mapping</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"properties"</span>: &#123;
        <span class="hljs-attr">"name"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"description"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>
        &#125;,
        <span class="hljs-attr">"studymodel"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<p>3ã€åˆ›å»ºæ–‡æ¡£</p>
<p>åˆ›å»ºæ˜ å°„åï¼Œæˆ‘ä»¬åˆ›å»ºæ–‡æ¡£æ•°æ®ç”¨äºæµ‹è¯•</p>
<p>POST <a href="http://10.1.1.168:9200/xc_course2/doc/4028e58161bcf7f40161bcf8b77c0000" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course2/doc/4028e58161bcf7f40161bcf8b77c0000</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"javaç¼–ç¨‹åŸºç¡€"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"javaè¯­è¨€æ˜¯ä¸–ç•Œç¬¬ä¸€ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è½¯ä»¶å¼€å‘é¢†åŸŸä½¿ç”¨äººæ•°æœ€å¤šã€‚"</span>,
    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>
&#125;</code></pre></div>

<p>4ã€æµ‹è¯•æŸ¥è¯¢</p>
<p>GET <a href="http://localhost/" target="_blank" rel="noopener">http://localhost</a>:9200/xc_course2/_search?q=name:java</p>
<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"took"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">"timed_out"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"_shards"</span>: &#123;
        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"successful"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"skipped"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"failed"</span>: <span class="hljs-number">0</span>
    &#125;,
    <span class="hljs-attr">"hits"</span>: &#123;
        <span class="hljs-attr">"total"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"max_score"</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">"hits"</span>: []
    &#125;
&#125;</code></pre></div>

<p><code>name</code>æ˜¯ <code>keyword</code> ç±»å‹ï¼Œæ‰€ä»¥æŸ¥è¯¢æ–¹å¼æ˜¯ç²¾ç¡®æŸ¥è¯¢ï¼Œæ‰€ä»¥æŸ¥è¯¢ä¸åˆ°ä»»ä½•æ•°æ®ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬å°è¯•ä¸€ä¸‹ç²¾ç¡®çš„æŸ¥è¯¢</p>
<p>GET <a href="http://10.1.1.168:9200/xc_course2/_search?q=name:java%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course2/_search?q=name:javaç¼–ç¨‹åŸºç¡€</a></p>
<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"took"</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">"timed_out"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"_shards"</span>: &#123;
        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"successful"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"skipped"</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">"failed"</span>: <span class="hljs-number">0</span>
    &#125;,
    <span class="hljs-attr">"hits"</span>: &#123;
        <span class="hljs-attr">"total"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"max_score"</span>: <span class="hljs-number">0.2876821</span>,
        <span class="hljs-attr">"hits"</span>: [
            &#123;
                <span class="hljs-attr">"_index"</span>: <span class="hljs-string">"xc_course2"</span>,
                <span class="hljs-attr">"_type"</span>: <span class="hljs-string">"doc"</span>,
                <span class="hljs-attr">"_id"</span>: <span class="hljs-string">"4028e58161bcf7f40161bcf8b77c0000"</span>,
                <span class="hljs-attr">"_score"</span>: <span class="hljs-number">0.2876821</span>,
                <span class="hljs-attr">"_source"</span>: &#123;
                    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"javaç¼–ç¨‹åŸºç¡€"</span>,
                    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"javaè¯­è¨€æ˜¯ä¸–ç•Œç¬¬ä¸€ç¼–ç¨‹è¯­è¨€ï¼Œåœ¨è½¯ä»¶å¼€å‘é¢†åŸŸä½¿ç”¨äººæ•°æœ€å¤šã€‚"</span>,
                    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>
                &#125;
            &#125;
        ]
    &#125;
&#125;</code></pre></div>

<p>æŸ¥è¯¢æˆåŠŸã€‚</p>
<h3 id="3ã€date-æ—¥æœŸç±»å‹"><a href="#3ã€date-æ—¥æœŸç±»å‹" class="headerlink" title="3ã€date æ—¥æœŸç±»å‹"></a>3ã€date æ—¥æœŸç±»å‹</h3><p>æ—¥æœŸç±»å‹ä¸ç”¨è®¾ç½®åˆ†è¯å™¨ï¼Œé€šå¸¸æ—¥æœŸç±»å‹çš„å­—æ®µç”¨äºæ’åºã€‚</p>
<p><strong>format å±æ€§</strong></p>
<p>é€šè¿‡ <code>format</code> è®¾ç½®æ—¥æœŸæ ¼å¼</p>
<p>ä¾‹å­ï¼š</p>
<p>ä¸‹è¾¹çš„è®¾ç½®å…è®¸ <code>date</code>å­—æ®µå­˜å‚¨å¹´æœˆæ—¥æ—¶åˆ†ç§’ã€å¹´æœˆæ—¥åŠæ¯«ç§’ä¸‰ç§æ ¼å¼ã€‚</p>
<p>POST: <a href="http://10.1.1.168:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course/doc/_mapping</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"properties"</span>: &#123;
        <span class="hljs-attr">"timestamp"</span>: &#123;
	        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,
	        <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyyâ€MMâ€dd HH:mm:ss||yyyyâ€MMâ€dd"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<p>æ’å…¥æ–‡æ¡£ï¼š</p>
<p>POST: <a href="http://localhost:9200/xc_course/doc/00002" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/00002</a></p>
<div class="hljs"><pre><code class="hljs json">&#123; 
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"spring åœ¨javaé¢†åŸŸéå¸¸æµè¡Œï¼Œjavaç¨‹åºå‘˜éƒ½åœ¨ç”¨ã€‚"</span>,
    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,
    <span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/01/wKhlQFqO4MmAOP53AAAcwDwm6SU490.jpg"</span>,
    <span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2018â€07â€04 18:28:58"</span>
&#125;</code></pre></div>

<p>æŸ¥è¯¢æµ‹è¯•</p>
<p>GET <a href="http://10.1.1.168:9200/xc_course/_search?q=name:%E5%BC%80%E5%8F%91" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course/_search?q=name:å¼€å‘</a></p>
<h3 id="4ã€æ•°å€¼ç±»å‹"><a href="#4ã€æ•°å€¼ç±»å‹" class="headerlink" title="4ã€æ•°å€¼ç±»å‹"></a>4ã€æ•°å€¼ç±»å‹</h3><p>ä¸‹è¾¹æ˜¯ESæ”¯æŒçš„æ•°å€¼ç±»å‹</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image33" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image33.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>1ã€å°½é‡é€‰æ‹©èŒƒå›´å°çš„ç±»å‹ï¼Œæé«˜æœç´¢æ•ˆç‡</p>
<p>2ã€å¯¹äºæµ®ç‚¹æ•°å°½é‡ç”¨ <strong>æ¯”ä¾‹å› å­</strong>ï¼Œæ¯”å¦‚ä¸€ä¸ªä»·æ ¼å­—æ®µï¼Œå•ä½ä¸ºå…ƒï¼Œæˆ‘ä»¬å°†æ¯”ä¾‹å› å­è®¾ç½®ä¸º <code>100</code>è¿™åœ¨ <code>ES</code> ä¸­ä¼šæŒ‰ åˆ† å­˜å‚¨ï¼Œæ˜ å°„å¦‚ä¸‹</p>
<div class="hljs"><pre><code class="hljs json">"price": &#123;
    "type": "scaled_float",
    "scaling_factor": 100
&#125;,</code></pre></div>

<p>ç”±äºæ¯”ä¾‹å› å­ä¸º100ï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥çš„ä»·æ ¼æ˜¯ <code>23.45</code> åˆ™ <code>ES</code> ä¸­ä¼šå°† <code>23.45</code> ä¹˜ä»¥ <code>100</code> å­˜å‚¨åœ¨ESä¸­ã€‚</p>
<p>å¦‚æœè¾“å…¥çš„ä»·æ ¼æ˜¯ <code>23.456</code>ï¼ŒES ä¼šå°† <code>23.456</code> ä¹˜ä»¥ <code>100</code> å†å–ä¸€ä¸ªæ¥è¿‘åŸå§‹å€¼çš„æ•°ï¼Œå¾—å‡º <code>2346</code>ã€‚</p>
<p>ä½¿ç”¨æ¯”ä¾‹å› å­çš„å¥½å¤„æ˜¯ <strong>æ•´å‹æ¯”æµ®ç‚¹å‹æ›´æ˜“å‹ç¼©</strong>ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´ã€‚</p>
<p>å¦‚æœæ¯”ä¾‹å› å­ä¸é€‚åˆï¼Œåˆ™ä»ä¸‹è¡¨é€‰æ‹©èŒƒå›´å°çš„å»ç”¨ï¼š</p>
<p><a href="https://qnoss.codeyee.com/20200704_10/image34" target="_blank" rel="noopener"><img src="/2020/08/17/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday10/image34.png" srcset="/img/loading.gif" alt="img"></a></p>
<p>æ›´æ–°å·²æœ‰æ˜ å°„ï¼Œå¹¶æ’å…¥æ–‡æ¡£ï¼š</p>
<p>POST: <a href="http://localhost:9200/xc_course/doc/3" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/3</a></p>
<div class="hljs"><pre><code class="hljs json">&#123; 
	<span class="hljs-attr">"name"</span>: <span class="hljs-string">"springå¼€å‘åŸºç¡€"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"spring åœ¨javaé¢†åŸŸéå¸¸æµè¡Œï¼Œjavaç¨‹åºå‘˜éƒ½åœ¨ç”¨ã€‚"</span>,
    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201001"</span>,
    <span class="hljs-attr">"pic"</span>:<span class="hljs-string">"group1/M00/00/01/wKhlQFqO4MmAOP53AAAcwDwm6SU490.jpg"</span>,
    <span class="hljs-attr">"timestamp"</span>:<span class="hljs-string">"2018â€07â€04 18:28:58"</span>,
    <span class="hljs-attr">"price"</span>:<span class="hljs-number">38.6</span>
&#125;</code></pre></div>

<h3 id="5ã€ç»¼åˆä¾‹å­"><a href="#5ã€ç»¼åˆä¾‹å­" class="headerlink" title="5ã€ç»¼åˆä¾‹å­"></a>5ã€ç»¼åˆä¾‹å­</h3><p>1ã€å‘é€ DELETE è¯·æ±‚åˆ° <code>http://10.1.1.168:9200/xc_course</code></p>
<p>2ã€åˆ›å»ºï¼Œå‘é€PUTè¯·æ±‚ <code>http://localhost:9200/xc_course</code> ç´¢å¼•åº“åç§°</p>
<div class="hljs"><pre><code class="hljs json">&#123;
  <span class="hljs-attr">"settings"</span>:&#123;
  <span class="hljs-attr">"index"</span>:&#123;
      <span class="hljs-attr">"number_of_shards"</span>:<span class="hljs-number">1</span>,
      <span class="hljs-attr">"number_of_replicas"</span>:<span class="hljs-number">0</span>
   &#125;    
  &#125;
&#125;</code></pre></div>

<p>3ã€åˆ›å»ºå¦‚ä¸‹æ˜ å°„</p>
<p>postï¼š<a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"properties"</span>: &#123;
        <span class="hljs-attr">"name"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>
        &#125;,
        <span class="hljs-attr">"description"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>
        &#125;,
        <span class="hljs-attr">"pic"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-attr">"index"</span>: <span class="hljs-literal">false</span>
        &#125;,
        <span class="hljs-attr">"studymodel"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<p>4ã€æ’å…¥æ–‡æ¡£</p>
<p>POST: <a href="http://localhost:9200/xc_course/doc/1" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/1</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bootstrapå¼€å‘"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Bootstrapæ˜¯ç”±Twitteræ¨å‡ºçš„ä¸€ä¸ªå‰å°é¡µé¢å¼€å‘æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªéå¸¸æµè¡Œçš„å¼€å‘æ¡†æ¶ï¼Œæ­¤æ¡†æ¶é›†æˆäº†å¤šç§é¡µé¢æ•ˆæœã€‚æ­¤å¼€å‘æ¡†æ¶åŒ…å«äº†å¤§é‡çš„CSSã€JSç¨‹åºä»£ç ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…ï¼ˆå°¤å…¶æ˜¯ä¸æ“…é•¿é¡µé¢å¼€å‘çš„ç¨‹åºäººå‘˜ï¼‰è½»æ¾çš„å®ç°ä¸€ä¸ªä¸å—æµè§ˆå™¨é™åˆ¶çš„ç²¾ç¾ç•Œé¢æ•ˆæœã€‚"</span>,
    <span class="hljs-attr">"studymodel"</span>: <span class="hljs-string">"201002"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">38.6</span>,
    <span class="hljs-attr">"timestamp"</span>: <span class="hljs-string">"2018-04-25 19:11:35"</span>,
    <span class="hljs-attr">"pic"</span>: <span class="hljs-string">"group1/M00/00/00/wKhlQFs6RCeAY0pHAA Jx5ZjNDEM428.jpg"</span>
&#125;</code></pre></div>

<p>5ã€æœç´¢æµ‹è¯•</p>
<p>GET: <a href="http://10.1.1.168:9200/xc_course/doc/_search?q=name:%E5%BC%80%E5%8F%91" target="_blank" rel="noopener">http://10.1.1.168:9200/xc_course/doc/_search?q=name:å¼€å‘</a></p>
<h1 id="å…­ã€ç´¢å¼•ç®¡ç†ï¼ˆJava-APIï¼‰"><a href="#å…­ã€ç´¢å¼•ç®¡ç†ï¼ˆJava-APIï¼‰" class="headerlink" title="å…­ã€ç´¢å¼•ç®¡ç†ï¼ˆJava APIï¼‰"></a>å…­ã€ç´¢å¼•ç®¡ç†ï¼ˆJava APIï¼‰</h1><h2 id="1-æ­å»ºå·¥ç¨‹"><a href="#1-æ­å»ºå·¥ç¨‹" class="headerlink" title="1. æ­å»ºå·¥ç¨‹"></a>1. æ­å»ºå·¥ç¨‹</h2><h3 id="1ã€ESå®¢æˆ·ç«¯ç®€ä»‹"><a href="#1ã€ESå®¢æˆ·ç«¯ç®€ä»‹" class="headerlink" title="1ã€ESå®¢æˆ·ç«¯ç®€ä»‹"></a>1ã€ESå®¢æˆ·ç«¯ç®€ä»‹</h3><p>ESæä¾›å¤šç§ä¸åŒçš„å®¢æˆ·ç«¯ï¼š</p>
<p><strong>TransportClient</strong></p>
<p>ESæä¾›çš„ä¼ ç»Ÿå®¢æˆ·ç«¯ï¼Œå®˜æ–¹è®¡åˆ’8.0ç‰ˆæœ¬åˆ é™¤æ­¤å®¢æˆ·ç«¯ã€‚</p>
<p><strong>RestClient</strong></p>
<p><code>RestClient</code> æ˜¯å®˜æ–¹æ¨èä½¿ç”¨çš„ï¼Œå®ƒåŒ…æ‹¬ä¸¤ç§ï¼š<code>Java Low Level REST Client</code> å’Œ <code>Java High Level REST Client</code>ã€‚</p>
<p>ESåœ¨ <strong>6.0</strong> ä¹‹åæä¾› <code>Java High Level REST Client</code>ï¼Œ ä¸¤ç§å®¢æˆ·ç«¯å®˜æ–¹æ›´æ¨èä½¿ç”¨ J<code>ava High Level REST Client</code>ï¼Œä¸è¿‡å½“å‰å®ƒè¿˜å¤„äºå®Œå–„ä¸­ï¼Œæœ‰äº›åŠŸèƒ½è¿˜æ²¡æœ‰ã€‚</p>
<p>æ–‡ç« ä¸­å‡†å¤‡é‡‡ç”¨ <code>Java High Level REST Client</code>ï¼Œå¦‚æœå®ƒæœ‰ä¸æ”¯æŒçš„åŠŸèƒ½ï¼Œåˆ™ä½¿ç”¨ <code>Java Low Level REST Client</code>ã€‚</p>
<p>æ·»åŠ ä¾èµ–ï¼š</p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearchâ€restâ€highâ€levelâ€client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre></div>

<h3 id="2ã€åˆ›å»ºæœç´¢å·¥ç¨‹"><a href="#2ã€åˆ›å»ºæœç´¢å·¥ç¨‹" class="headerlink" title="2ã€åˆ›å»ºæœç´¢å·¥ç¨‹"></a>2ã€åˆ›å»ºæœç´¢å·¥ç¨‹</h3><p>åˆ›å»ºæœç´¢å·¥ç¨‹ï¼ˆmavenå·¥ç¨‹ï¼‰ï¼š<code>xc-service-search</code>ï¼Œæ·»åŠ  <code>RestHighLevelClient</code> ä¾èµ–åŠ<code>junit</code> ä¾èµ–ã€‚</p>
<p><strong>1ï¼‰å®Œæ•´ä¾èµ–æ–‡ä»¶å¦‚ä¸‹</strong></p>
<p><code>pom.xml</code></p>
<div class="hljs"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span>
<span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span>
<span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>&gt;</span>../xc-framework-parent/pom.xml<span class="hljs-tag">&lt;/<span class="hljs-name">relativePath</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-search<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-model<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-framework-common<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuecheng<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xc-service-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.8.8<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span></code></pre></div>

<p><strong>2ï¼‰é…ç½®æ–‡ä»¶</strong></p>
<p><code>application.yml</code></p>
<div class="hljs"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-string">$&#123;port:40100&#125;</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">xc-search-service</span>
<span class="hljs-attr">xuecheng:</span>
  <span class="hljs-attr">elasticsearch:</span>
    <span class="hljs-attr">hostlist:</span> <span class="hljs-string">$&#123;eshostlist:127.0.0.1:9200&#125;</span> <span class="hljs-comment">#å¤šä¸ªç»“ç‚¹ä¸­é—´ç”¨é€—å·åˆ†éš”</span></code></pre></div>

<p><strong>3ï¼‰é…ç½®ç±»</strong></p>
<p>åˆ›å»º <code>com.xuecheng.search.config</code> åŒ…åœ¨å…¶ä¸‹åˆ›å»ºé…ç½®ç±»</p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.search.config;

<span class="hljs-keyword">import</span> org.apache.http.HttpHost;
<span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;
<span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span>
<span class="hljs-comment"> **/</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ElasticsearchConfig</span> </span>&#123;

    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"$&#123;xuecheng.elasticsearch.hostlist&#125;"</span>)
    <span class="hljs-keyword">private</span> String hostlist;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * restHighLevelClient</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title">restHighLevelClient</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-comment">//è§£æhostlisté…ç½®ä¿¡æ¯</span>
        String[] split = hostlist.split(<span class="hljs-string">","</span>);
        <span class="hljs-comment">//åˆ›å»ºHttpHostæ•°ç»„ï¼Œå…¶ä¸­å­˜æ”¾esä¸»æœºå’Œç«¯å£çš„é…ç½®ä¿¡æ¯</span>
        HttpHost[] httpHostArray = <span class="hljs-keyword">new</span> HttpHost[split.length];
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;split.length;i++)&#123;
            String item = split[i];
            httpHostArray[i] = <span class="hljs-keyword">new</span> HttpHost(item.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">0</span>], Integer.parseInt(item.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">1</span>]), <span class="hljs-string">"http"</span>);
        &#125;
        <span class="hljs-comment">//åˆ›å»ºRestHighLevelClientå®¢æˆ·ç«¯</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RestHighLevelClient(RestClient.builder(httpHostArray));
    &#125;

    <span class="hljs-comment">/**</span>
<span class="hljs-comment">     * é¡¹ç›®ä¸»è¦ä½¿ç”¨RestHighLevelClientï¼Œå¯¹äºä½çº§çš„å®¢æˆ·ç«¯æš‚æ—¶ä¸ç”¨</span>
<span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span>
<span class="hljs-comment">     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> RestClient <span class="hljs-title">restClient</span><span class="hljs-params">()</span></span>&#123;
        <span class="hljs-comment">//è§£æhostlisté…ç½®ä¿¡æ¯</span>
        String[] split = hostlist.split(<span class="hljs-string">","</span>);
        <span class="hljs-comment">//åˆ›å»ºHttpHostæ•°ç»„ï¼Œå…¶ä¸­å­˜æ”¾esä¸»æœºå’Œç«¯å£çš„é…ç½®ä¿¡æ¯</span>
        HttpHost[] httpHostArray = <span class="hljs-keyword">new</span> HttpHost[split.length];
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;split.length;i++)&#123;
            String item = split[i];
            httpHostArray[i] = <span class="hljs-keyword">new</span> HttpHost(item.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">0</span>], Integer.parseInt(item.split(<span class="hljs-string">":"</span>)[<span class="hljs-number">1</span>]), <span class="hljs-string">"http"</span>);
        &#125;
        <span class="hljs-keyword">return</span> RestClient.builder(httpHostArray).build();
    &#125;

&#125;</code></pre></div>

<p><strong>4ã€å¯åŠ¨ç±»</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.search;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.domain.EntityScan;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.ComponentScan;

<span class="hljs-comment">/**</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@author</span> Administrator</span>
<span class="hljs-comment"> * <span class="hljs-doctag">@version</span> 1.0</span>
<span class="hljs-comment"> **/</span>
<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EntityScan</span>(<span class="hljs-string">"com.xuecheng.framework.domain.search"</span>)<span class="hljs-comment">//æ‰«æå®ä½“ç±»</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.api"</span>&#125;)<span class="hljs-comment">//æ‰«ææ¥å£</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.search"</span>&#125;)<span class="hljs-comment">//æ‰«ææœ¬é¡¹ç›®ä¸‹çš„æ‰€æœ‰ç±»</span>
<span class="hljs-meta">@ComponentScan</span>(basePackages=&#123;<span class="hljs-string">"com.xuecheng.framework"</span>&#125;)<span class="hljs-comment">//æ‰«æcommonä¸‹çš„æ‰€æœ‰ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchApplication</span> </span>&#123;
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception </span>&#123;
        SpringApplication.run(SearchApplication<span class="hljs-class">.<span class="hljs-keyword">class</span>, <span class="hljs-title">args</span>)</span>;
    &#125;
&#125;</code></pre></div>

<h2 id="2-åˆ›å»ºç´¢å¼•åº“"><a href="#2-åˆ›å»ºç´¢å¼•åº“" class="headerlink" title="2. åˆ›å»ºç´¢å¼•åº“"></a>2. åˆ›å»ºç´¢å¼•åº“</h2><p><strong>1ã€API</strong></p>
<p>åˆ›å»ºç´¢å¼•ï¼š</p>
<p>PUTï¼š <a href="http://localhost:9200/%E7%B4%A2%E5%BC%95%E5%90%8D%E7%A7%B0" target="_blank" rel="noopener">http://localhost:9200/ç´¢å¼•åç§°</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"settings"</span>:&#123;
        <span class="hljs-attr">"index"</span>:&#123;
            "number_of_shards":1, #åˆ†ç‰‡çš„æ•°é‡
            "number_of_replicas":0 #å‰¯æœ¬æ•°é‡
        &#125;,
    &#125;,
&#125;</code></pre></div>

<p>åˆ›å»ºæ˜ å°„ï¼š</p>
<p><a href="http://localhost:9200/%E7%B4%A2%E5%BC%95%E5%BA%93%E5%90%8D%E7%A7%B0/%E7%B1%BB%E5%9E%8B%E5%90%8D%E7%A7%B0/" target="_blank" rel="noopener">http://localhost:9200/ç´¢å¼•åº“åç§°/ç±»å‹åç§°/</a><em>mapping</em></p>
<p>åˆ›å»ºç±»å‹ä¸º <code>xc_course</code> çš„æ˜ å°„ï¼Œå…±åŒ…æ‹¬ä¸‰ä¸ªå­—æ®µï¼šnameã€descriptionã€studymodel</p>
<p>PUT: <a href="http://localhost:9200/xc_course/doc/_mapping" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/_mapping</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"properties"</span>: &#123;
        <span class="hljs-attr">"name"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>
        &#125;,
        <span class="hljs-attr">"description"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-attr">"analyzer"</span>: <span class="hljs-string">"ik_max_word"</span>,
            <span class="hljs-attr">"search_analyzer"</span>: <span class="hljs-string">"ik_smart"</span>
        &#125;,
        <span class="hljs-attr">"studymodel"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"keyword"</span>
        &#125;,
        <span class="hljs-attr">"price"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"float"</span>
        &#125;,
        <span class="hljs-attr">"timestamp"</span>: &#123;
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"date"</span>,
            <span class="hljs-attr">"format"</span>: <span class="hljs-string">"yyyyâ€MMâ€dd HH:mm:ss||yyyyâ€MMâ€dd||epoch_millis"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<p><strong>2ã€Java Client</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.xuecheng.search;

<span class="hljs-keyword">import</span> org.elasticsearch.action.admin.indices.create.CreateIndexRequest;
<span class="hljs-keyword">import</span> org.elasticsearch.action.admin.indices.create.CreateIndexResponse;
<span class="hljs-keyword">import</span> org.elasticsearch.client.IndicesClient;
<span class="hljs-keyword">import</span> org.elasticsearch.client.RestClient;
<span class="hljs-keyword">import</span> org.elasticsearch.client.RestHighLevelClient;
<span class="hljs-keyword">import</span> org.elasticsearch.common.settings.Settings;
<span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContent;
<span class="hljs-keyword">import</span> org.elasticsearch.common.xcontent.XContentType;
<span class="hljs-keyword">import</span> org.junit.Test;
<span class="hljs-keyword">import</span> org.junit.runner.RunWith;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;
<span class="hljs-keyword">import</span> org.springframework.test.context.junit4.SpringRunner;

<span class="hljs-keyword">import</span> java.io.IOException;

<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-meta">@RunWith</span>(SpringRunner<span class="hljs-class">.<span class="hljs-keyword">class</span>)</span>
<span class="hljs-class"><span class="hljs-title">public</span> <span class="hljs-title">class</span> <span class="hljs-title">TestIndex</span> </span>&#123;
    <span class="hljs-meta">@Autowired</span>
    RestHighLevelClient restHighLevelClient;

    <span class="hljs-meta">@Autowired</span>
    RestClient restClient;

    <span class="hljs-comment">//åˆ›å»ºç´¢å¼•åº“</span>
    <span class="hljs-meta">@Test</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testCreateIndex</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
        <span class="hljs-comment">//åˆ›å»ºç´¢å¼•è¯·æ±‚å¯¹è±¡</span>
        CreateIndexRequest createIndexRequest = <span class="hljs-keyword">new</span> CreateIndexRequest(<span class="hljs-string">"xc_course"</span>);

        <span class="hljs-comment">//è®¾ç½®ç´¢å¼•å‚æ•°</span>
        createIndexRequest.settings(Settings.builder()
                .put(<span class="hljs-string">"number_of_shards"</span>,<span class="hljs-number">1</span>)
                .put(<span class="hljs-string">"number_of_replicas"</span>,<span class="hljs-number">0</span>)
        );

        <span class="hljs-comment">//è®¾ç½®ç´¢å¼•åº“çš„æ˜ å°„</span>
        <span class="hljs-comment">//è¿™é‡Œçš„æ˜ å°„æ•°æ®ç›´æ¥å‰é¢æµ‹è¯•APIçš„JSONå­—ç¬¦ä¸²</span>
        createIndexRequest.mapping(<span class="hljs-string">"doc"</span>,<span class="hljs-string">"&#123;\n"</span> +
                <span class="hljs-string">"    \"properties\": &#123;\n"</span> +
                <span class="hljs-string">"        \"name\": &#123;\n"</span> +
                <span class="hljs-string">"            \"type\": \"text\",\n"</span> +
                <span class="hljs-string">"            \"analyzer\": \"ik_max_word\",\n"</span> +
                <span class="hljs-string">"            \"search_analyzer\": \"ik_smart\"\n"</span> +
                <span class="hljs-string">"        &#125;,\n"</span> +
                <span class="hljs-string">"        \"description\": &#123;\n"</span> +
                <span class="hljs-string">"            \"type\": \"text\",\n"</span> +
                <span class="hljs-string">"            \"analyzer\": \"ik_max_word\",\n"</span> +
                <span class="hljs-string">"            \"search_analyzer\": \"ik_smart\"\n"</span> +
                <span class="hljs-string">"        &#125;,\n"</span> +
                <span class="hljs-string">"        \"studymodel\": &#123;\n"</span> +
                <span class="hljs-string">"            \"type\": \"keyword\"\n"</span> +
                <span class="hljs-string">"        &#125;,\n"</span> +
                <span class="hljs-string">"        \"price\": &#123;\n"</span> +
                <span class="hljs-string">"            \"type\": \"float\"\n"</span> +
                <span class="hljs-string">"        &#125;,\n"</span> +
                <span class="hljs-string">"        \"timestamp\": &#123;\n"</span> +
                <span class="hljs-string">"            \"type\": \"date\",\n"</span> +
                <span class="hljs-string">"            \"format\": \"yyyyâ€MMâ€dd HH:mm:ss||yyyyâ€MMâ€dd||epoch_millis\"\n"</span> +
                <span class="hljs-string">"        &#125;\n"</span> +
                <span class="hljs-string">"    &#125;\n"</span> +
                <span class="hljs-string">"&#125;"</span>,XContentType.JSON);
        <span class="hljs-comment">//æ“ä½œå®¢æˆ·ç«¯</span>
        IndicesClient indices = restHighLevelClient.indices();
        <span class="hljs-comment">//åˆ›å»ºå“åº”å¯¹è±¡</span>
        CreateIndexResponse createIndexResponse = indices.create(createIndexRequest);
        <span class="hljs-comment">//å¾—åˆ°å“åº”ç»“æœ</span>
        <span class="hljs-keyword">boolean</span> shardsAcknowledged = createIndexResponse.isShardsAcknowledged();
        System.out.println(shardsAcknowledged);
    &#125;
&#125;</code></pre></div>

<p>è¿è¡ŒåæˆåŠŸåˆ›å»ºæ˜ å°„</p>
<h2 id="3-æ·»åŠ æ–‡æ¡£"><a href="#3-æ·»åŠ æ–‡æ¡£" class="headerlink" title="3. æ·»åŠ æ–‡æ¡£"></a>3. æ·»åŠ æ–‡æ¡£</h2><p><strong>1ã€API</strong></p>
<p>æ ¼å¼å¦‚ä¸‹ï¼š PUT <code>/{index}/{type}/{id} { &quot;field&quot;: &quot;value&quot;, ... }</code></p>
<p>å¦‚æœä¸æŒ‡å®š <code>id</code>ï¼Œ<code>ES</code> ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚</p>
<p>ä¸€ä¸ªä¾‹å­ï¼š<br>put <a href="http://localhost:9200/xc_course/doc/3" target="_blank" rel="noopener">http://localhost:9200/xc_course/doc/3</a></p>
<div class="hljs"><pre><code class="hljs json">&#123; 
    <span class="hljs-attr">"name"</span>:<span class="hljs-string">"spring cloudå®æˆ˜"</span>,
    <span class="hljs-attr">"description"</span>:<span class="hljs-string">"æœ¬è¯¾ç¨‹ä¸»è¦ä»å››ä¸ªç« èŠ‚è¿›è¡Œè®²è§£ï¼š 1.å¾®æœåŠ¡æ¶æ„å…¥é—¨ 2.spring cloud åŸºç¡€å…¥é—¨ 3.å®æˆ˜Spring</span>
<span class="hljs-string">    Boot 4.æ³¨å†Œä¸­å¿ƒeurekaã€‚"</span>,
    <span class="hljs-attr">"studymodel"</span>:<span class="hljs-string">"201001"</span>
    <span class="hljs-string">"price"</span>:<span class="hljs-number">5.6</span>
&#125;</code></pre></div>

<p><strong>2ã€Java Client</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ·»åŠ æ–‡æ¡£</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">testAddDoc</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    <span class="hljs-comment">//å‡†å¤‡jsonæ•°æ®</span>
    Map&lt;String, Object&gt; jsonMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();
    jsonMap.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"spring cloudå®æˆ˜"</span>);
    jsonMap.put(<span class="hljs-string">"description"</span>, <span class="hljs-string">"æœ¬è¯¾ç¨‹ä¸»è¦ä»å››ä¸ªç« èŠ‚è¿›è¡Œè®²è§£ï¼š 1.å¾®æœåŠ¡æ¶æ„å…¥é—¨ 2.spring cloud åŸºç¡€å…¥é—¨ 3.å®æˆ˜Spring Boot 4.æ³¨å†Œä¸­å¿ƒeurekaã€‚"</span>);
    jsonMap.put(<span class="hljs-string">"studymodel"</span>, <span class="hljs-string">"201001"</span>);
    SimpleDateFormat dateFormat =<span class="hljs-keyword">new</span> SimpleDateFormat(<span class="hljs-string">"yyyyâ€MMâ€dd HH:mm:ss"</span>);
    jsonMap.put(<span class="hljs-string">"timestamp"</span>, dateFormat.format(<span class="hljs-keyword">new</span> Date()));
    jsonMap.put(<span class="hljs-string">"price"</span>, <span class="hljs-number">5.6f</span>);
    <span class="hljs-comment">//ç´¢å¼•è¯·æ±‚å¯¹è±¡</span>
    IndexRequest indexRequest = <span class="hljs-keyword">new</span> IndexRequest(<span class="hljs-string">"xc_course"</span>,<span class="hljs-string">"doc"</span>);
    <span class="hljs-comment">//æŒ‡å®šç´¢å¼•æ–‡æ¡£å†…å®¹</span>
    indexRequest.source(jsonMap);
    <span class="hljs-comment">//ç´¢å¼•å“åº”å¯¹è±¡</span>
    IndexResponse indexResponse = restHighLevelClient.index(indexRequest);
    <span class="hljs-comment">//è·å–å“åº”ç»“æœ</span>
    DocWriteResponse.Result result = indexResponse.getResult();
    System.out.println(result);
&#125;</code></pre></div>

<h2 id="4-æŸ¥è¯¢æ–‡æ¡£"><a href="#4-æŸ¥è¯¢æ–‡æ¡£" class="headerlink" title="4. æŸ¥è¯¢æ–‡æ¡£"></a>4. æŸ¥è¯¢æ–‡æ¡£</h2><p><strong>1ã€API</strong></p>
<p>æ ¼å¼å¦‚ä¸‹ï¼š GET <code>/{index}/{type}/{id}</code></p>
<p><strong>2ã€Java Client</strong></p>
<div class="hljs"><pre><code class="hljs java"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æŸ¥è¯¢æ–‡æ¡£</span>
<span class="hljs-comment"> */</span>
<span class="hljs-meta">@Test</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">getDoc</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;
    GetRequest getRequest = <span class="hljs-keyword">new</span> GetRequest(
            <span class="hljs-string">"xc_course"</span>,
            <span class="hljs-string">"doc"</span>,
            <span class="hljs-string">"eWb_kXEB39nW0xAzs9Pd"</span>
    );
    GetResponse getResponse = restHighLevelClient.get(getRequest);
    <span class="hljs-keyword">boolean</span> exists = getResponse.isExists();
    <span class="hljs-keyword">if</span>(!exists)&#123;
        System.out.println(<span class="hljs-string">"æ–‡æ¡£ä¸å­˜åœ¨"</span>);
    &#125;<span class="hljs-keyword">else</span>&#123;
        Map&lt;String, Object&gt; sourceAsMap = getResponse.getSourceAsMap();
        System.out.println(sourceAsMap);
    &#125;
&#125;</code></pre></div>

<h2 id="5-æ›´æ–°æ–‡æ¡£"><a href="#5-æ›´æ–°æ–‡æ¡£" class="headerlink" title="5. æ›´æ–°æ–‡æ¡£"></a>5. æ›´æ–°æ–‡æ¡£</h2><p><strong>1ã€API</strong></p>
<p><code>ES</code> æ›´æ–°æ–‡æ¡£çš„é¡ºåºæ˜¯ï¼šå…ˆæ£€ç´¢åˆ°æ–‡æ¡£ã€å°†åŸæ¥çš„æ–‡æ¡£æ ‡è®°ä¸ºåˆ é™¤ã€åˆ›å»ºæ–°æ–‡æ¡£ã€åˆ é™¤æ—§æ–‡æ¡£ï¼Œåˆ›å»ºæ–°æ–‡æ¡£å°±ä¼šé‡å»ºç´¢å¼•ã€‚</p>
<p>é€šè¿‡è¯·æ±‚ <code>Url</code> æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<p>1ï¼‰å®Œå…¨æ›¿æ¢</p>
<p>POSTï¼š<a href="http://localhost:9200/xc_test/doc/3" target="_blank" rel="noopener">http://localhost:9200/xc_test/doc/3</a></p>
<div class="hljs"><pre><code class="hljs json">&#123; 
	<span class="hljs-attr">"name"</span>:<span class="hljs-string">"spring cloudå®æˆ˜"</span>,
    <span class="hljs-attr">"description"</span>:<span class="hljs-string">"æœ¬è¯¾ç¨‹ä¸»è¦ä»å››ä¸ªç« èŠ‚è¿›è¡Œè®²è§£ï¼š 1.å¾®æœåŠ¡æ¶æ„å…¥é—¨ 2.spring cloud åŸºç¡€å…¥é—¨ 3.å®æˆ˜SpringBoot 4.æ³¨å†Œä¸­å¿ƒeurekaã€‚"</span>,
    <span class="hljs-attr">"studymodel"</span>:<span class="hljs-string">"201001"</span>,
    <span class="hljs-attr">"price"</span>:<span class="hljs-number">5.6</span>
&#125;</code></pre></div>

<p>2ï¼‰å±€éƒ¨æ›´æ–°</p>
<p>ä¸‹è¾¹çš„ä¾‹å­æ˜¯åªæ›´æ–° <code>price</code> å­—æ®µã€‚</p>
<p>post: <a href="http://localhost:9200/xc_test/doc/3/_update" target="_blank" rel="noopener">http://localhost:9200/xc_test/doc/3/_update</a></p>
<div class="hljs"><pre><code class="hljs json">&#123;
	<span class="hljs-attr">"doc"</span>:&#123;<span class="hljs-attr">"price"</span>:<span class="hljs-number">66.6</span>&#125;
&#125;</code></pre></div>

<p><strong>2ã€Java Client</strong></p>
<p>ä½¿ç”¨ <code>Client Api</code> æ›´æ–°æ–‡æ¡£çš„æ–¹æ³•åŒä¸Šè¾¹ç¬¬äºŒç§å±€éƒ¨æ›´æ–°æ–¹æ³•ã€‚<br>å¯ä»¥æŒ‡å®šæ–‡æ¡£çš„éƒ¨åˆ†å­—æ®µä¹Ÿå¯ä»¥æŒ‡å®šå®Œæ•´çš„æ–‡æ¡£å†…å®¹ã€‚</p>
<div class="hljs"><pre><code class="hljs json"><span class="hljs-comment">/**</span>
<span class="hljs-comment"> * æ›´æ–°æ–‡æ¡£</span>
<span class="hljs-comment"> */</span>
@Test
public void updateDoc() throws IOException &#123;
    UpdateRequest updateRequest = new UpdateRequest("xc_course", "doc","eWb_kXEB39nW0xAzs9Pd");
    Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
    map.put("name", "spring cloud alibaba");
    updateRequest.doc(map);
    UpdateResponse update = restHighLevelClient.update(updateRequest);
    RestStatus status = update.status();
    System.out.println(status);
&#125;</code></pre></div>

<h2 id="6-åˆ é™¤æ–‡æ¡£"><a href="#6-åˆ é™¤æ–‡æ¡£" class="headerlink" title="6. åˆ é™¤æ–‡æ¡£"></a>6. åˆ é™¤æ–‡æ¡£</h2><p><strong>1ã€API</strong></p>
<p>æ ¹æ® <code>id</code> åˆ é™¤ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<p>DELETEï¼š <code>/{index}/{type}/{id}</code></p>
<p>æœç´¢åŒ¹é…åˆ é™¤ï¼Œå°†æœç´¢å‡ºæ¥çš„è®°å½•åˆ é™¤ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<p>POSTï¼š <code>/{index}/{type}/_delete_by_query</code></p>
<p>ä¸‹è¾¹æ˜¯æœç´¢æ¡ä»¶ä¾‹å­ï¼š</p>
<div class="hljs"><pre><code class="hljs json">&#123;
    <span class="hljs-attr">"query"</span>:&#123;
        <span class="hljs-attr">"term"</span>:&#123;
        <span class="hljs-attr">"studymodel"</span>:<span class="hljs-string">"201001"</span>
        &#125;
    &#125;
&#125;</code></pre></div>

<p>ä¸Šè¾¹ä¾‹å­çš„æœç´¢åŒ¹é…åˆ é™¤ä¼šå°† <code>studymodel</code> ä¸º <code>201001</code> çš„è®°å½•å…¨éƒ¨åˆ é™¤ã€‚</p>
<p><strong>2ã€Java Client</strong></p>
<div class="hljs"><pre><code class="hljs json"><span class="hljs-comment">//æ ¹æ®idåˆ é™¤æ–‡æ¡£</span>
@Test
public void testDelDoc() throws IOException &#123;
    <span class="hljs-comment">//åˆ é™¤æ–‡æ¡£id</span>
    String id = "eqP_amQBKsGOdwJ4fHiC";
    <span class="hljs-comment">//åˆ é™¤ç´¢å¼•è¯·æ±‚å¯¹è±¡</span>
    DeleteRequest deleteRequest = new DeleteRequest("xc_course","doc",id);
    <span class="hljs-comment">//å“åº”å¯¹è±¡</span>
    DeleteResponse deleteResponse = client.delete(deleteRequest);
    <span class="hljs-comment">//è·å–å“åº”ç»“æœ</span>
    DocWriteResponse.Result result = deleteResponse.getResult();
    System.out.println(result);
&#125;</code></pre></div>

<p>æœç´¢åŒ¹é…åˆ é™¤è¿˜æ²¡æœ‰å…·ä½“çš„ <code>api</code>ï¼Œå¯ä»¥é‡‡ç”¨å…ˆæœç´¢å‡ºæ–‡æ¡£ <code>id</code>ï¼Œæ ¹æ®æ–‡æ¡£ <code>id</code> åˆ é™¤ã€‚</p>

            </article>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BF/">å­¦æˆåœ¨çº¿</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/ElasticSearch/">ElasticSearch</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" target="_blank" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/18/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday11/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day11ï¼šåŸºäº ElasticSearch æ„å»ºæœç´¢æœåŠ¡</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/08/16/%E5%AD%A6%E6%88%90%E5%9C%A8%E7%BA%BFday09/">
                        <span class="hidden-mobile">å­¦æˆåœ¨çº¿day09ï¼šEurekaã€Feignã€è¯¾ç¨‹é¢„è§ˆå®ç°</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

            
          </div>
        </div>
      </div>
    </div>
    
  </div>
</div>
<!--

ä»£ç å—js ç”¨ä¸åˆ°ï¼Œfulidè‡ªå¸¦æœ‰ï¼Œæ·»åŠ cssæ ·å¼å³å¯å®ç°
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 

<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>

-->




<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®å­—</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
	<div>
  <span id="timeDate">è½½å…¥å¤©æ•°...</span>
  <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
  <script>
  var now = new Date();
  function createtime(){
      var grt= new Date("06/20/2020 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
      now.setTime(now.getTime()+250);
      days = (now - grt ) / 1000 / 60 / 60 / 24;
      dnum = Math.floor(days);
      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
      hnum = Math.floor(hours);
      if(String(hnum).length ==1 ){
          hnum = "0" + hnum;
      }
      minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
      mnum = Math.floor(minutes);
      if(String(mnum).length ==1 ){
                mnum = "0" + mnum;
      }
      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
      snum = Math.round(seconds);
      if(String(snum).length ==1 ){
                snum = "0" + snum;
      }
      document.getElementById("timeDate").innerHTML = "æœ¬ç«™å‹‰å¼ºè¿è¡Œ&nbsp"+dnum+"&nbspå¤©";
      document.getElementById("times").innerHTML = hnum + "&nbspå°æ—¶&nbsp" + mnum + "&nbspåˆ†&nbsp" + snum + "&nbspç§’";
  }
  setInterval("createtime()",250);
  </script>
</div>
    
  <div class="statistics">
    
    

    
      
        <!-- ä¸è’œå­ç»Ÿè®¡PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="busuanzi_value_site_pv"></span>
             æ¬¡
          </span>
      
      
        <!-- ä¸è’œå­ç»Ÿè®¡UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="busuanzi_value_site_uv"></span>
             äºº
          </span>
      
    
  </div>


    
  <!-- å¤‡æ¡ˆä¿¡æ¯ -->
  <div class="beian">
    <a href="http://beian.miit.gov.cn/" target="_blank"
       rel="nofollow noopener">äº¬ICPè¯123456å·</a>
    
      <a
        href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12345678"
        rel="nofollow noopener"
        class="beian-police"
        target="_blank"
      >
        <span class="beian-police-sep">&nbsp;|&nbsp;</span>
        
          <img src="/img/police_beian.png" srcset="/img/loading.gif" alt="police-icon" />
        
        <span>äº¬å…¬ç½‘å®‰å¤‡12345678å·</span>
      </a>
     
  </div>


    
	
  </div>
  

</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>



  
<script src="/js/custom.js"></script>




  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: 'article.markdown-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "å­¦æˆåœ¨çº¿day10ï¼šè¯¾ç¨‹å‘å¸ƒã€ElasticSearch&nbsp;",
      ],
      cursorChar: "|",
      typeSpeed: 65,
      loop: true,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
      icon: "<"
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>







  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  
















<script type="text/javascript"
color="107,160,220" opacity='0.7' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
